"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1036],{99929:(B,M,e)=>{e.d(M,{Y:()=>m});var a=e(74848),D=e(96540),i=e(41053),r=e(73427),E=e(96673),O=e(59812),A=e(12037);const m=({teamId:c,roleOptions:s,disabled:d,roles:_,onApplyRoles:P,pendingRoles:p,apply:I=!1,maxWidth:U,width:K,isLoading:x})=>{const[{loading:L,value:f=_||[]},u]=(0,i.A)(async()=>{try{if(_)return _;if(I&&p?.length)return p;if(r.TP.hasPermission(E.AccessControlAction.ActionTeamsRolesList)&&c>0)return await(0,A.xN)(c)}catch(t){console.error("Error loading options",t)}return[]},[c,p,_]);(0,D.useEffect)(()=>{u()},[u]);const h=async t=>{I?P&&P(t):(await(0,A.G3)(t,c),await u())},n=r.TP.hasPermission(E.AccessControlAction.ActionTeamsRolesAdd)&&r.TP.hasPermission(E.AccessControlAction.ActionTeamsRolesRemove);return(0,a.jsx)(O.n,{apply:I,onRolesChange:h,roleOptions:s,appliedRoles:f,isLoading:L||x,disabled:d,basicRoleDisabled:!0,canUpdateRoles:n,maxWidth:U,width:K})}},25096:(B,M,e)=>{e.d(M,{J:()=>O});var a=e(74848),D=e(22803),i=e(96540),r=e(27489),E=e(63142);const O=({text:m="PRO",className:c,experimentId:s,eventVariant:d="",..._})=>{const P=(0,E.of)(A);return(0,i.useEffect)(()=>{s&&(0,r.Xp)(s,"test",d)},[s,d]),(0,a.jsx)("span",{className:(0,D.cx)(P.badge,c),..._,children:m})},A=m=>({badge:(0,D.css)({marginLeft:m.spacing(1.25),borderRadius:m.shape.borderRadius(5),backgroundColor:m.colors.success.main,padding:m.spacing(.25,.75),color:"white",fontWeight:m.typography.fontWeightMedium,fontSize:m.typography.pxToRem(10)})})},42939:(B,M,e)=>{e.d(M,{pL:()=>D,z5:()=>r});var a=e(43173);const D=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function i(){const E=a.$.licenseInfo?.trialExpiry;return!!(E&&E>0)}const r=()=>i()&&a.$.featureToggles.featureHighlights},34314:(B,M,e)=>{e.r(M),e.d(M,{TeamList:()=>T,default:()=>S});var a=e(74848),D=e(22803),i=e(96540),r=e(70255),E=e(71468),O=e(63142),A=e(71555),m=e(89640),c=e(94018),s=e(41654),d=e(45861),_=e(44458),P=e(50201),p=e(18027),I=e(12737),U=e(27594),K=e(34213),x=e(13791),L=e(12037),f=e(56840),u=e(15130),h=e(96673),n=e(99929),t=e(77174);const l=new Array(3).fill(null).map((g,R)=>({id:R,uid:"",memberCount:0,name:"",orgId:0,isProvisioned:!1})),T=({teams:g,query:R,noTeams:Z,hasFetched:C,loadTeams:Y,deleteTeam:Q,changeQuery:X,totalPages:F,page:w,rolesLoading:J,changePage:k,changeSort:q})=>{const[V,ee]=(0,i.useState)([]),j=(0,O.of)(N);(0,i.useEffect)(()=>{Y(!0)},[Y]),(0,i.useEffect)(()=>{u.TP.licensedAccessControlEnabled()&&u.TP.hasPermission(h.AccessControlAction.ActionRolesList)&&(0,L.RL)().then(o=>ee(o))},[]);const b=u.TP.hasPermission(h.AccessControlAction.ActionTeamsCreate),H=y(),ae=(0,i.useMemo)(()=>[{id:"avatarUrl",header:"",disableGrow:!0,cell:({cell:{value:o}})=>C?o&&(0,a.jsx)(A.e,{src:o,alt:"User avatar"}):(0,a.jsx)(r.A,{containerClassName:j.blockSkeleton,width:24,height:24,circle:!0})},{id:"name",header:"Name",cell:({cell:{value:o},row:{original:v}})=>C?u.TP.hasPermissionInMetadata(h.AccessControlAction.ActionTeamsRead,v)?(0,a.jsx)(m.Y,{color:"primary",inline:!1,href:`/org/teams/edit/${v.uid}`,title:(0,f.t)("teams.team-list.columns.title-edit-team","Edit team"),children:o}):o:(0,a.jsx)(r.A,{width:100}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:o}})=>C?o:(0,a.jsx)(r.A,{width:60}),sortType:"string"},{id:"memberCount",header:"Members",disableGrow:!0,cell:({cell:{value:o}})=>C?o:(0,a.jsx)(r.A,{width:40}),sortType:"number"},...H?[{id:"role",header:"Role",cell:({cell:{value:o},row:{original:v}})=>C?u.TP.hasPermissionInMetadata(h.AccessControlAction.ActionTeamsRolesList,v)&&(0,a.jsx)(n.Y,{teamId:v.id,roles:v.roles||[],isLoading:J,roleOptions:V,width:40}):(0,a.jsx)(r.A,{width:320,height:32,containerClassName:j.blockSkeleton})}]:[],{id:"isProvisioned",header:"",cell:({cell:{value:o}})=>C?!!o&&(0,a.jsx)(c.v,{colorIndex:14,name:"Provisioned"}):(0,a.jsx)(r.A,{width:240})},{id:"actions",header:"",disableGrow:!0,cell:({row:{original:o}})=>{if(!C)return(0,a.jsxs)(s.B,{direction:"row",justifyContent:"flex-end",alignItems:"center",children:[(0,a.jsx)(r.A,{containerClassName:j.blockSkeleton,width:16,height:16}),(0,a.jsx)(r.A,{containerClassName:j.blockSkeleton,width:22,height:24})]});const v=u.TP.hasPermissionInMetadata(h.AccessControlAction.ActionTeamsRead,o),G=u.TP.hasPermissionInMetadata(h.AccessControlAction.ActionTeamsDelete,o)&&!o.isProvisioned;return(0,a.jsxs)(s.B,{direction:"row",justifyContent:"flex-end",gap:2,children:[v&&(0,a.jsx)(d.z9,{href:`org/teams/edit/${o.uid}`,"aria-label":(0,f.t)("teams.team-list.columns.aria-label-edit-team","Edit team {{teamName}}",{teamName:o.name}),icon:"pen",size:"sm",variant:"secondary",tooltip:(0,f.t)("teams.team-list.columns.tooltip-edit-team","Edit team")}),(0,a.jsx)(_.e,{"aria-label":(0,f.t)("teams.team-list.columns.aria-label-delete-button","Delete team {{teamName}}",{teamName:o.name}),size:"sm",disabled:!G,onConfirm:()=>Q(o.uid)})]})}}],[H,C,J,V,Q,j]);return(0,a.jsx)(x.Y,{navId:"teams",actions:Z?void 0:(0,a.jsx)(d.z9,{href:b?"org/teams/new":"#",disabled:!b,children:(0,a.jsx)(f.x6,{i18nKey:"teams.team-list.new-team",children:"New Team"})}),children:(0,a.jsx)(x.Y.Contents,{children:Z?(0,a.jsx)(P.p,{variant:"call-to-action",button:(0,a.jsx)(d.z9,{disabled:!b,href:"org/teams/new",icon:"users-alt",size:"lg",children:(0,a.jsx)(f.x6,{i18nKey:"teams.empty-state.button-title",children:"New team"})}),message:(0,f.t)("teams.empty-state.title","You haven't created any teams yet"),children:(0,a.jsxs)(f.x6,{i18nKey:"teams.empty-state.pro-tip",children:["Assign folder and dashboard permissions to teams instead of users to ease administration."," ",(0,a.jsx)(m.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/team-management",children:"Learn more"})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"page-action-bar",children:(0,a.jsx)(p.I,{grow:!0,children:(0,a.jsx)(I.Z,{placeholder:(0,f.t)("teams.team-list.placeholder-search-teams","Search teams"),value:R,onChange:X})})}),C&&g.length===0?(0,a.jsx)(P.p,{variant:"not-found",message:(0,f.t)("teams.empty-state.message","No teams found")}):(0,a.jsxs)(s.B,{direction:"column",gap:2,children:[(0,a.jsx)(U.j,{columns:ae,data:C?g:l,getRowId:o=>String(o.id),fetchData:q}),(0,a.jsx)(s.B,{justifyContent:"flex-end",children:(0,a.jsx)(K.d,{hideWhenSinglePage:!0,currentPage:w,numberOfPages:F,onNavigate:k})})]})]})})})};function y(){return u.TP.licensedAccessControlEnabled()&&u.TP.hasPermission(h.AccessControlAction.ActionTeamsRolesList)&&u.TP.hasPermission(h.AccessControlAction.ActionRolesList)}function $(g){return{teams:g.teams.teams,query:g.teams.query,perPage:g.teams.perPage,page:g.teams.page,noTeams:g.teams.noTeams,totalPages:g.teams.totalPages,hasFetched:g.teams.hasFetched,rolesLoading:g.teams.rolesLoading}}const z={loadTeams:t.Bu,deleteTeam:t.To,changePage:t.yd,changeQuery:t.nM,changeSort:t.Vk},S=(0,E.connect)($,z)(T),N=g=>({blockSkeleton:(0,D.css)({lineHeight:1,display:"flex"})})},77174:(B,M,e)=>{e.d(M,{Bu:()=>s,It:()=>f,To:()=>P,Vk:()=>U,aK:()=>L,eo:()=>_,n7:()=>x,nC:()=>u,nM:()=>p,yd:()=>I});var a=e(2543),D=e.n(a),i=e(68143),r=e(6890),E=e(73427),O=e(81871),A=e(96673),m=e(66191),c=e(27104);function s(n=!1){return async(t,l)=>{const{query:T,page:y,perPage:$,sort:z}=l().teams;if(!E.TP.hasPermission(A.AccessControlAction.ActionTeamsRead)){t((0,c.Q9)({teams:[],totalCount:0,page:1,perPage:$,noTeams:!0}));return}const W=await(0,i.AI)().get("/api/teams/search",(0,O.F)({query:T,page:y,perpage:$,sort:z}));let S=!1;if(n&&(S=W.teams.length===0),E.TP.licensedAccessControlEnabled()&&E.TP.hasPermission(A.AccessControlAction.ActionTeamsRolesList)){t((0,c.dJ)());const N=W?.teams.map(R=>R.id),g=await(0,i.AI)().post("/api/access-control/teams/roles/search",{teamIds:N});W.teams.forEach(R=>{R.roles=g?g[R.id]||[]:[]}),t((0,c.jE)())}t((0,c.Q9)({noTeams:S,...W}))}}const d=(0,a.debounce)(n=>n(s()),500);function _(n){return async t=>{const l=await(0,i.AI)().get(`/api/teams/${n}`,(0,O.F)());t((0,c.$T)(l)),t((0,r.Vz)((0,m.R)(l)))}}function P(n){return async t=>{await(0,i.AI)().delete(`/api/teams/${n}`),await E.TP.fetchUserPermissions(),t(s())}}function p(n){return async t=>{t((0,c.L5)(n)),d(t)}}function I(n){return async t=>{t((0,c.EC)(n)),t(s())}}function U({sortBy:n}){const t=n.length?`${n[0].id}-${n[0].desc?"desc":"asc"}`:void 0;return async l=>{l((0,c.$u)(t)),l(s())}}function K(){return async(n,t)=>{const l=t().team.team,T=await getBackendSrv().get(`/api/teams/${l.uid}/members`);n(teamMembersLoaded(T))}}function x(n,t){return async(l,T)=>{const y=T().team.team;await(0,i.AI)().put(`/api/teams/${y.uid}`,{name:n,email:t}),l(_(y.uid))}}function L(){return async(n,t)=>{const l=t().team.team,T=await(0,i.AI)().get(`/api/teams/${l.uid}/groups`);n((0,c.tC)(T))}}function f(n){return async(t,l)=>{const T=l().team.team;await(0,i.AI)().post(`/api/teams/${T.uid}/groups`,{groupId:n}),t(L())}}function u(n){return async(t,l)=>{const T=l().team.team;await(0,i.AI)().delete(`/api/teams/${T.uid}/groups?groupId=${encodeURIComponent(n)}`),t(L())}}function h(n){return async t=>{await getBackendSrv().put(`/api/teams/${n.teamId}/members/${n.userId}`,{permission:n.permission}),t(K())}}},66191:(B,M,e)=>{e.d(M,{R:()=>m,X:()=>c});var a=e(62061),D=e(25096),i=e(65642),r=e(15130),E=e(42939),O=e(96673);const A={avatarUrl:"public/img/user_profile.png",id:1,uid:"",name:"Loading",email:"loading",memberCount:0,permission:O.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:"",isProvisioned:!1};function m(s){const d={img:s.avatarUrl,id:"team-"+s.uid,subTitle:"Manage members and settings",url:`org/teams/edit/${s.uid}`,text:s.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${s.uid}`,text:"Settings",url:`org/teams/edit/${s.uid}/settings`}]};(s===A||r.TP.hasPermissionInMetadata(O.AccessControlAction.ActionTeamsPermissionsRead,s))&&d.children.unshift({active:!1,icon:"users-alt",id:`team-members-${s.uid}`,text:"Members",url:`org/teams/edit/${s.uid}/members`});const _={active:!1,icon:"sync",id:`team-groupsync-${s.uid}`,text:"External group sync",url:`org/teams/edit/${s.uid}/groupsync`},P=s===A;return(0,E.z5)()&&(_.tabSuffix=()=>(0,D.J)({experimentId:P?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,a.a)("teamsync")?(P||r.TP.hasPermissionInMetadata(O.AccessControlAction.ActionTeamsPermissionsRead,s))&&d.children.push(_):i.Ay.featureToggles.featureHighlights&&d.children.push({..._,tabSuffix:()=>(0,D.J)({experimentId:P?"":"feature-highlights-team-sync-badge"})}),d}function c(s){const d=m(A);let _;for(const P of d.children)if(P.id.indexOf(s)>0){P.active=!0,_=P;break}return{main:d,node:_}}}}]);

//# sourceMappingURL=TeamList.051642fa2876b4e52ed8.js.map