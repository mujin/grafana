"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9996],{74410:(A,u,s)=>{s.d(u,{l:()=>v});var n=s(74848),t=s(22803),g=s(96540),f=s(49785);function v({defaultValues:w,onSubmit:p,validateOnMount:h=!1,validateFieldsOnMount:d,children:E,validateOn:l="onSubmit",maxWidth:o=600,...y}){const{handleSubmit:e,trigger:i,formState:P,...c}=(0,f.mN)({mode:l,defaultValues:w});return(0,g.useEffect)(()=>{h&&i(d)},[i,d,h]),(0,n.jsx)("form",{className:(0,t.css)({maxWidth:o!=="none"?o+"px":o,width:"100%"}),onSubmit:e(p),...y,children:E({errors:P.errors,formState:P,trigger:i,...c})})}},10180:(A,u,s)=>{s.d(u,{s:()=>w});var n=s(74848),t=s(96540),g=s(85629),f=s(63527),v=s(76319);const w=(0,t.forwardRef)((p,h)=>{const[d,E]=(0,t.useState)(!1);return(0,n.jsx)(f.p,{...p,type:d?"text":"password","data-testid":g.Tp.pages.Login.password,ref:h,suffix:(0,n.jsx)(v.K,{name:d?"eye-slash":"eye","aria-controls":p.id,role:"switch","aria-checked":d,onClick:()=>{E(!d)},tooltip:d?"Hide password":"Show password"})})});w.displayName="PasswordField"},10501:(A,u,s)=>{s.d(u,{DP:()=>E,NQ:()=>d,zJ:()=>l});var n=s(74848),t=s(22803),g=s(31286),f=s(63142),v=s(30703),w=s(66404),p=s(65642),h=s(56840);const d=[{message:"At least 12 characters",validation:e=>e.length>=12},{message:"One uppercase letter",validation:e=>/[A-Z]+/.test(e)},{message:"One lowercase letter",validation:e=>/[a-z]+/.test(e)},{message:"One number",validation:e=>/[0-9]+/.test(e)},{message:"One symbol",validation:e=>/[\W]/.test(e)}],E=e=>!p.Ay.auth.basicAuthStrongPasswordPolicy||d.every(i=>i.validation(e))||(0,h.t)("profile.change-password.strong-password-validation-register","Password does not comply with the strong password policy"),l=({strongPasswordValidations:e,password:i,pristine:P})=>(0,n.jsx)(g.a,{marginBottom:2,children:e.map(c=>(0,n.jsx)(o,{strongPasswordValidation:c,password:i,pristine:P},c.message))}),o=({strongPasswordValidation:e,password:i,pristine:P})=>{const c=(0,f.of)(y),{basicAuthStrongPasswordPolicy:M}=p.Ay.auth;if(!M)return null;const{message:O,validation:U}=e,m=i.length>0&&U(i),a=m||P?"check":"exclamation-triangle",r=m?"secondary":P?"primary":"error";let x;return m?x=c.icon.valid:P?x=c.icon.pending:x=c.icon.error,(0,n.jsxs)(g.a,{display:"flex",alignItems:"center",marginTop:1,children:[(0,n.jsx)(v.I,{className:(0,t.cx)(c.icon.style,x),name:a}),(0,n.jsx)(w.E,{color:r,children:O})]},O)},y=e=>({icon:{style:(0,t.css)({marginRight:e.spacing(1)}),valid:(0,t.css)({color:e.colors.success.text}),pending:(0,t.css)({color:e.colors.secondary.text}),error:(0,t.css)({color:e.colors.error.text})}})},9996:(A,u,s)=>{s.r(u),s.d(u,{ChangePasswordPage:()=>O,default:()=>U});var n=s(74848),t=s(71468),g=s(4392),f=s(13791),v=s(96540),w=s(37386),p=s(41654),h=s(45861),d=s(74410),E=s(10501),l=s(65642),o=s(56840),y=s(10180);const e=({user:m,onChangePassword:a,isSaving:r})=>{const[x,S]=(0,v.useState)(!1),[T,B]=(0,v.useState)(!0),{disableLoginForm:K}=l.Ay,C=m.authLabels?.length&&m.authLabels[0];return C==="LDAP"||C==="Auth Proxy"?(0,n.jsx)("p",{children:(0,n.jsx)(o.x6,{i18nKey:"profile.change-password.ldap-auth-proxy-message",children:"You cannot change password when signed in with LDAP or auth proxy."})}):C&&K?(0,n.jsx)("p",{children:(0,n.jsx)(o.x6,{i18nKey:"profile.change-password.cannot-change-password-message",children:"Password cannot be changed here."})}):(0,n.jsx)(d.l,{onSubmit:a,maxWidth:400,children:({register:L,errors:D,getValues:I,watch:R})=>{const N=R("newPassword");return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.D,{label:(0,o.t)("profile.change-password.old-password-label","Old password"),invalid:!!D.oldPassword,error:D?.oldPassword?.message,children:(0,n.jsx)(y.s,{id:"current-password",autoComplete:"current-password",...L("oldPassword",{required:(0,o.t)("profile.change-password.old-password-required","Old password is required")})})}),(0,n.jsx)(w.D,{label:(0,o.t)("profile.change-password.new-password-label","New password"),invalid:!!D.newPassword,error:D?.newPassword?.message,children:(0,n.jsx)(y.s,{id:"new-password",autoComplete:"new-password",onFocus:()=>S(!0),...L("newPassword",{onBlur:()=>B(!1),required:(0,o.t)("profile.change-password.new-password-required","New password is required"),validate:{strongPasswordValidationRegister:E.DP,confirm:j=>j===I().confirmNew||(0,o.t)("profile.change-password.passwords-must-match","Passwords must match"),old:j=>j!==I().oldPassword||(0,o.t)("profile.change-password.new-password-same-as-old","New password can't be the same as the old one.")}})})}),x&&(0,n.jsx)(E.zJ,{pristine:T,password:N,strongPasswordValidations:E.NQ}),(0,n.jsx)(w.D,{label:(0,o.t)("profile.change-password.confirm-password-label","Confirm password"),invalid:!!D.confirmNew,error:D?.confirmNew?.message,children:(0,n.jsx)(y.s,{id:"confirm-new-password",autoComplete:"new-password",...L("confirmNew",{required:(0,o.t)("profile.change-password.confirm-password-required","New password confirmation is required"),validate:j=>j===I().newPassword||(0,o.t)("profile.change-password.passwords-must-match","Passwords must match")})})}),(0,n.jsxs)(p.B,{children:[(0,n.jsx)(h.$n,{variant:"primary",disabled:r,type:"submit",children:(0,n.jsx)(o.x6,{i18nKey:"profile.change-password.change-password-button",children:"Change Password"})}),(0,n.jsx)(h.z9,{variant:"secondary",href:`${l.Ay.appSubUrl}/profile`,fill:"outline",children:(0,n.jsx)(o.x6,{i18nKey:"profile.change-password.cancel-button",children:"Cancel"})})]})]})}})};var i=s(88482);function P(m){const a=m.user,{isUpdating:r,user:x}=a;return{isUpdating:r,user:x}}const c={loadUser:i.YW,changePassword:i.ec},M=(0,t.connect)(P,c);function O({loadUser:m,isUpdating:a,user:r,changePassword:x}){return(0,g.A)(()=>m()),(0,n.jsx)(f.Y,{navId:"profile/password",children:(0,n.jsx)(f.Y.Contents,{isLoading:!r,children:r?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(e,{user:r,onChangePassword:x,isSaving:a})}):null})})}const U=M(O)},88482:(A,u,s)=>{s.d(u,{ec:()=>y,Aj:()=>U,Qe:()=>e,YW:()=>i,_O:()=>O,eg:()=>m});var n=s(43173),t=s(68143);async function g(a){try{await(0,t.AI)().put("/api/user/password",a)}catch(r){console.error(r)}}function f(){return(0,t.AI)().get("/api/user")}function v(){return(0,t.AI)().get("/api/user/teams")}function w(){return(0,t.AI)().get("/api/user/orgs")}function p(){return(0,t.AI)().get("/api/user/auth-tokens")}async function h(a){await(0,t.AI)().post("/api/user/revoke-auth-token",{authTokenId:a})}async function d(a){await(0,t.AI)().post("/api/user/using/"+a.orgId,{})}async function E(a){try{await(0,t.AI)().put("/api/user",a)}catch(r){console.error(r)}}const l={changePassword:g,revokeUserSession:h,loadUser:f,loadSessions:p,loadOrgs:w,loadTeams:v,setUserOrg:d,updateUserProfile:E};var o=s(69289);function y(a){return async function(r){r((0,o.Nm)({updating:!0})),await l.changePassword(a),r((0,o.Nm)({updating:!1}))}}function e(){return async function(a){await a(i()),a(P()),a(c()),a(M())}}function i(){return async function(a){const r=await l.loadUser();a((0,o.HO)({user:r}))}}function P(){return async function(a){a((0,o.ri)());const r=await l.loadTeams();a((0,o.Q9)({teams:r}))}}function c(){return async function(a){a((0,o.Mj)());const r=await l.loadOrgs();a((0,o.ny)({orgs:r}))}}function M(){return async function(a){a((0,o.uh)());const r=await l.loadSessions();a((0,o.RS)({sessions:r}))}}function O(a){return async function(r){r((0,o.Nm)({updating:!0})),await l.revokeUserSession(a),r((0,o.g$)({tokenId:a}))}}function U(a){return async function(r){r((0,o.Nm)({updating:!0})),await l.setUserOrg(a),window.location.href=n.$.appSubUrl+"/profile"}}function m(a){return async function(r){r((0,o.Nm)({updating:!0})),await l.updateUserProfile(a),await r(i()),r((0,o.Nm)({updating:!1}))}}},4392:(A,u,s)=>{s.d(u,{A:()=>g});var n=s(94701),t=function(f){(0,n.A)(function(){f()})};const g=t}}]);

//# sourceMappingURL=9996.74ed1c414958bc2b29bd.js.map