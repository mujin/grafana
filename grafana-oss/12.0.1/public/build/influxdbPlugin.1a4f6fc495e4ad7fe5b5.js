(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9404],{63930:(Fr,Et,$)=>{"use strict";$.d(Et,{d$:()=>ww,M$:()=>zE,XK:()=>nh,Aq:()=>xw});var tt={};$.r(tt),$.d(tt,{applyToJS:()=>Ol,cleanJSX:()=>Fl,clone:()=>yr(),deepEqual:()=>Ys,deepFreeze:()=>ud,escapeRegExp:()=>id,getFirstDefined:()=>cd,getLogger:()=>ld,getOpCardinality:()=>Jt,isDirtyJSX:()=>_o,isImmutable:()=>wi,isImmutableList:()=>Ks,isJSX:()=>Cl,isJsonCompatible:()=>gy,isJsonLogic:()=>Ir,isObject:()=>dr,isObjectOrArray:()=>ad,isTypeOf:()=>Ba,logger:()=>Ro,mergeArraysSmart:()=>Lo,mergeCustomizerNoArrays:()=>od,mergeIn:()=>fy,moment:()=>Ga(),omit:()=>Yr,opDefKeysToOmit:()=>Ci,setIn:()=>dy,shallowCopy:()=>Wa,shallowEqual:()=>To,sleep:()=>sd,toImmutableList:()=>Yt,typeOf:()=>Ei,uuid:()=>Tt,widgetDefKeysToOmit:()=>Ua});var N={};$.r(N),$.d(N,{_fixImmutableValue:()=>xl,expandTreePath:()=>fe,expandTreeSubpath:()=>Tl,fixEmptyGroupsInTree:()=>iu,fixPathsInTree:()=>gn,getAncestorRuleGroups:()=>_l,getFlatTree:()=>Ll,getItemByPath:()=>ca,getLightTree:()=>Od,getSwitchValues:()=>Fd,getTotalReordableNodesCountInTree:()=>wy,getTotalRulesCountInTree:()=>ou,hasChildren:()=>jl,immutableToJs:()=>Ol,isEmptyTree:()=>Rl,isImmutable:()=>wi,jsToImmutable:()=>Ai,removeIsLockedInTree:()=>Sd,toImmutableList:()=>Yt});var ce={};$.r(ce),$.d(ce,{calculateValueType:()=>Ad,completeFuncValue:()=>_d,completeValue:()=>Ha,formatFieldName:()=>Qn,getDefaultArgValue:()=>lu,getFieldPathLabels:()=>Io,getFuncPathLabels:()=>Ly,getOneChildOrDescendant:()=>kl,getValueLabel:()=>Ry,isEmptyGroupChildren:()=>Nl,isEmptyItem:()=>Pl,isEmptyRuleGroupExtPropertiesAndChildren:()=>Td,isEmptyRuleProperties:()=>Vl,setArgValue:()=>cu,setFuncDefaultArg:()=>Do,setFuncDefaultArgs:()=>Gl,whatRulePropertiesAreCompleted:()=>Ml});var ie={};$.r(ie),$.d(ie,{LINEAR_REGRESSION:()=>Jy,LOWER:()=>Hy,NOW:()=>zy,RELATIVE_DATETIME:()=>qy,UPPER:()=>Qy});var Je={};$.r(Je),$.d(Je,{SqlString:()=>Jn,mongoEmptyValue:()=>bf,spelEscape:()=>Li,spelFixList:()=>Sf,spelFormatConcat:()=>T0,spelImportConcat:()=>_0,sqlEmptyValue:()=>yf,stringifyForDisplay:()=>Of,wrapWithBrackets:()=>Ff});var te={};$.r(te),$.d(te,{_mongodbFormat:()=>hf,_spelFormat:()=>Pf,_sqlFormat:()=>Af,elasticSearchFormat:()=>ep,jsonLogicFormat:()=>p0,mongodbFormat:()=>b0,queryBuilderFormat:()=>Dy,queryString:()=>qf,spelFormat:()=>V0,sqlFormat:()=>j0});var ne={};$.r(ne),$.d(ne,{_getFromConfigCache:()=>tu,_getWidgetsAndSrcsForFieldOp:()=>nu,_saveToConfigCache:()=>ru,_widgetDefKeysToOmit:()=>Fy,applyJsonLogic:()=>Uy,cleanJSX:()=>Fl,compileConfig:()=>qd,compressConfig:()=>Wd,configKeys:()=>An,createConfigMemo:()=>Xd,decompressConfig:()=>zd,extendConfig:()=>rn,filterValueSourcesForField:()=>qa,findExtendedConfigInAllMemos:()=>Kd,getCommonMemo:()=>Yd,getFieldConfig:()=>_e,getFieldId:()=>eu,getFieldParts:()=>Ut,getFieldPartsConfigs:()=>bd,getFieldPath:()=>Tn,getFieldPathParts:()=>Cy,getFieldRawConfig:()=>vn,getFieldSrc:()=>gd,getFieldWidgetConfig:()=>br,getFirstField:()=>hd,getFirstOperator:()=>Al,getFuncArgConfig:()=>Zs,getFuncConfig:()=>nr,getFuncSignature:()=>wl,getOperatorConfig:()=>st,getOperatorsForField:()=>au,getOperatorsForType:()=>yd,getValueSourcesForFieldOp:()=>md,getWidgetForFieldOp:()=>Nt,getWidgetsForFieldOp:()=>Ey,isDirtyJSX:()=>_o,isFieldDescendantOfField:()=>vd,isJSX:()=>Cl,iterateFields:()=>fd,iterateFuncs:()=>jo,normalizeField:()=>pd,selectTypes:()=>Xs});var Oe={};$.r(Oe),$.d(Oe,{getItemInListValues:()=>Go,getListValue:()=>Cu,getTitleInListValues:()=>ov,getValueInListValues:()=>eS,listValuesToArray:()=>vc,makeCustomListValue:()=>pc,mapListValues:()=>gc,searchListValue:()=>tS,toListValue:()=>Kn});var le={};$.r(le),$.d(le,{_validateTree:()=>$o,checkTree:()=>cv,getTreeBadFields:()=>lv,isValidTree:()=>uv,sanitizeTree:()=>fv,translateValidation:()=>hn,validateAndFixTree:()=>pv,validateRange:()=>ga,validateTree:()=>dv,validateValue:()=>Rn});var Ee={};$.r(Ee),$.d(Ee,{getCompatibleArgsOnFuncChange:()=>Sv,getDefaultArgValue:()=>lu,setArgValue:()=>cu,setArgValueAsyncListValues:()=>bv,setArgValueSrc:()=>yv,setFunc:()=>mv,setFuncDefaultArg:()=>Do,setFuncDefaultArgs:()=>Gl});var Te={};$.r(Te),$.d(Te,{createListFromArray:()=>wd,createListWithOneElement:()=>Ay,defaultConjunction:()=>da,defaultGroupConjunction:()=>fa,defaultGroupProperties:()=>pa,defaultItemProperties:()=>Fv,defaultOperatorOptions:()=>xo,defaultRoot:()=>uS,defaultRule:()=>Cv,defaultRuleProperties:()=>jn,emptyProperties:()=>Ty,getDefaultField:()=>Cd,getDefaultFieldSrc:()=>Il,getDefaultOperator:()=>Dl,getDefaultSubField:()=>Ed});var Me={};$.r(Me),$.d(Me,{fixListValuesGroupOrder:()=>bS,getListValue:()=>Cu,listValueToOption:()=>yS,mergeListValues:()=>gS,optionToListValue:()=>hS,optionsToListValues:()=>mS,simulateAsyncFetch:()=>vS});var ye={};$.r(ye),$.d(ye,{Autocomplete:()=>Me,ConfigUtils:()=>ne,DefaultUtils:()=>Te,ExportUtils:()=>Je,FuncUtils:()=>Ee,ListUtils:()=>Oe,OtherUtils:()=>tt,RuleUtils:()=>ce,TreeUtils:()=>N,Validation:()=>le,checkTree:()=>cv,clone:()=>yr(),compressConfig:()=>Wd,decompressConfig:()=>zd,getSwitchValues:()=>Fd,i18n:()=>Kb,isValidTree:()=>uv,moment:()=>Ga(),sanitizeTree:()=>fv,uuid:()=>Tt,validateAndFixTree:()=>pv,validateTree:()=>dv});var wt={};$.r(wt),$.d(wt,{_loadFromJsonLogic:()=>cp,_loadFromSpel:()=>Xv,getTree:()=>rb,isImmutableTree:()=>tp,isJsonLogic:()=>Ir,isTree:()=>rp,jsToImmutable:()=>Ai,loadFromJsonLogic:()=>ub,loadFromSpel:()=>qS,loadTree:()=>rc});var bt={};$.r(bt),$.d(bt,{addCaseGroup:()=>xO,addDefaultCaseGroup:()=>jO,addGroup:()=>IO,addRule:()=>LO,moveItem:()=>PO,removeGroup:()=>DO,removeRule:()=>RO,setTree:()=>_O});var xe={};$.r(xe),$.d(xe,{setConjunction:()=>NO,setLock:()=>MO,setNot:()=>VO});var vt={};$.r(vt),$.d(vt,{setField:()=>kO,setFieldSrc:()=>GO,setFuncValue:()=>WO,setOperator:()=>$O,setOperatorOption:()=>zO,setValue:()=>UO,setValueSrc:()=>BO});var Xr={};$.r(Xr),$.d(Xr,{bindActionCreators:()=>Jg,isUsingLegacyReactDomRender:()=>Qg,liteShouldComponentUpdate:()=>Pu,pureShouldComponentUpdate:()=>Mi,useOnPropsChanged:()=>Dr});var er={};$.r(er),$.d(er,{FuncWidget:()=>Pc,ValueFieldWidget:()=>Nm,VanillaBooleanWidget:()=>YE,VanillaButton:()=>dw,VanillaButtonGroup:()=>pw,VanillaConjs:()=>lw,VanillaDateTimeWidget:()=>tw,VanillaDateWidget:()=>ZE,VanillaFieldSelect:()=>uw,VanillaIcon:()=>fw,VanillaMultiSelectWidget:()=>nw,VanillaNumberWidget:()=>ow,VanillaProvider:()=>mw,VanillaSelectWidget:()=>iw,VanillaSliderWidget:()=>sw,VanillaSwitch:()=>gw,VanillaTextAreaWidget:()=>XE,VanillaTextWidget:()=>KE,VanillaTimeWidget:()=>ew,VanillaValueSources:()=>vw,vanillaConfirm:()=>hw});var mn={};$.r(mn),$.d(mn,{ProximityOperator:()=>$c});var Ie=$(23029),Ke=$(92901),Ge=$(56822),ge=$(53954),it=$(85501),I=$(96540),X=$(64467),ve=$(5544),ue=$(60436),ft=$(82284),ma="delete",St=5,kr=1<<St,It=kr-1,we={};function ya(){return{value:!1}}function qe(n){n&&(n.value=!0)}function ri(){}function Ze(n){return n.size===void 0&&(n.size=n.__iterate(as)),n.size}function Zr(n,e){if(typeof e!="number"){var r=e>>>0;if(""+r!==e||r===4294967295)return NaN;e=r}return e<0?Ze(n)+e:e}function as(){return!0}function ea(n,e,r){return(n===0&&!os(n)||r!==void 0&&n<=-r)&&(e===void 0||r!==void 0&&e>=r)}function $t(n,e){return is(n,e,0)}function vr(n,e){return is(n,e,e)}function is(n,e,r){return n===void 0?r:os(n)?e===1/0?e:Math.max(0,e+n)|0:e===void 0||e===n?n:Math.min(e,n)|0}function os(n){return n<0||n===0&&1/n===-1/0}var ss="@@__IMMUTABLE_ITERABLE__@@";function Lt(n){return!!(n&&n[ss])}var qr="@@__IMMUTABLE_KEYED__@@";function gt(n){return!!(n&&n[qr])}var us="@@__IMMUTABLE_INDEXED__@@";function lr(n){return!!(n&&n[us])}function ba(n){return gt(n)||lr(n)}var At=function(e){return Lt(e)?e:hr(e)},Gr=function(n){function e(r){return gt(r)?r:cn(r)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e}(At),Vn=function(n){function e(r){return lr(r)?r:Ur(r)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e}(At),ta=function(n){function e(r){return Lt(r)&&!ba(r)?r:Sn(r)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e}(At);At.Keyed=Gr,At.Indexed=Vn,At.Set=ta;var Sa="@@__IMMUTABLE_SEQ__@@";function ln(n){return!!(n&&n[Sa])}var Mn="@@__IMMUTABLE_RECORD__@@";function kn(n){return!!(n&&n[Mn])}function gr(n){return Lt(n)||kn(n)}var ra="@@__IMMUTABLE_ORDERED__@@";function qt(n){return!!(n&&n[ra])}var Oa=0,Hr=1,$r=2,Fa=typeof Symbol=="function"&&Symbol.iterator,ni="@@iterator",ai=Fa||ni,rt=function(e){this.next=e};rt.prototype.toString=function(){return"[Iterator]"},rt.KEYS=Oa,rt.VALUES=Hr,rt.ENTRIES=$r,rt.prototype.inspect=rt.prototype.toSource=function(){return this.toString()},rt.prototype[ai]=function(){return this};function pt(n,e,r,t){var a=n===0?e:n===1?r:[e,r];return t?t.value=a:t={value:a,done:!1},t}function Cr(){return{value:void 0,done:!0}}function Hi(n){return Array.isArray(n)?!0:!!bn(n)}function ii(n){return n&&typeof n.next=="function"}function yn(n){var e=bn(n);return e&&e.call(n)}function bn(n){var e=n&&(Fa&&n[Fa]||n[ni]);if(typeof e=="function")return e}function Qi(n){var e=bn(n);return e&&e===n.entries}function zu(n){var e=bn(n);return e&&e===n.keys}var na=Object.prototype.hasOwnProperty;function Ji(n){return Array.isArray(n)||typeof n=="string"?!0:n&&typeof n=="object"&&Number.isInteger(n.length)&&n.length>=0&&(n.length===0?Object.keys(n).length===1:n.hasOwnProperty(n.length-1))}var hr=function(n){function e(r){return r==null?oi():gr(r)?r.toSeq():Hu(r)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.toSeq=function(){return this},e.prototype.toString=function(){return this.__toString("Seq {","}")},e.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},e.prototype.__iterate=function(t,a){var i=this._cache;if(i){for(var o=i.length,s=0;s!==o;){var u=i[a?o-++s:s++];if(t(u[1],u[0],this)===!1)break}return s}return this.__iterateUncached(t,a)},e.prototype.__iterator=function(t,a){var i=this._cache;if(i){var o=i.length,s=0;return new rt(function(){if(s===o)return Cr();var u=i[a?o-++s:s++];return pt(t,u[0],u[1])})}return this.__iteratorUncached(t,a)},e}(At),cn=function(n){function e(r){return r==null?oi().toKeyedSeq():Lt(r)?gt(r)?r.toSeq():r.fromEntrySeq():kn(r)?r.toSeq():Ki(r)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.toKeyedSeq=function(){return this},e}(hr),Ur=function(n){function e(r){return r==null?oi():Lt(r)?gt(r)?r.entrySeq():r.toIndexedSeq():kn(r)?r.toSeq().entrySeq():Xi(r)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return e(arguments)},e.prototype.toIndexedSeq=function(){return this},e.prototype.toString=function(){return this.__toString("Seq [","]")},e}(hr),Sn=function(n){function e(r){return(Lt(r)&&!ba(r)?r:Ur(r)).toSetSeq()}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return e(arguments)},e.prototype.toSetSeq=function(){return this},e}(hr);hr.isSeq=ln,hr.Keyed=cn,hr.Set=Sn,hr.Indexed=Ur,hr.prototype[Sa]=!0;var On=function(n){function e(r){this._array=r,this.size=r.length}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.get=function(t,a){return this.has(t)?this._array[Zr(this,t)]:a},e.prototype.__iterate=function(t,a){for(var i=this._array,o=i.length,s=0;s!==o;){var u=a?o-++s:s++;if(t(i[u],u,this)===!1)break}return s},e.prototype.__iterator=function(t,a){var i=this._array,o=i.length,s=0;return new rt(function(){if(s===o)return Cr();var u=a?o-++s:s++;return pt(t,u,i[u])})},e}(Ur),Yi=function(n){function e(r){var t=Object.keys(r).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(r):[]);this._object=r,this._keys=t,this.size=t.length}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.get=function(t,a){return a!==void 0&&!this.has(t)?a:this._object[t]},e.prototype.has=function(t){return na.call(this._object,t)},e.prototype.__iterate=function(t,a){for(var i=this._object,o=this._keys,s=o.length,u=0;u!==s;){var l=o[a?s-++u:u++];if(t(i[l],l,this)===!1)break}return u},e.prototype.__iterator=function(t,a){var i=this._object,o=this._keys,s=o.length,u=0;return new rt(function(){if(u===s)return Cr();var l=o[a?s-++u:u++];return pt(t,l,i[l])})},e}(cn);Yi.prototype[ra]=!0;var qu=function(n){function e(r){this._collection=r,this.size=r.length||r.size}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.__iterateUncached=function(t,a){if(a)return this.cacheResult().__iterate(t,a);var i=this._collection,o=yn(i),s=0;if(ii(o))for(var u;!(u=o.next()).done&&t(u.value,s++,this)!==!1;);return s},e.prototype.__iteratorUncached=function(t,a){if(a)return this.cacheResult().__iterator(t,a);var i=this._collection,o=yn(i);if(!ii(o))return new rt(Cr);var s=0;return new rt(function(){var u=o.next();return u.done?u:pt(t,s++,u.value)})},e}(Ur),ls;function oi(){return ls||(ls=new On([]))}function Ki(n){var e=Zi(n);if(e)return e.fromEntrySeq();if(typeof n=="object")return new Yi(n);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+n)}function Xi(n){var e=Zi(n);if(e)return e;throw new TypeError("Expected Array or collection object of values: "+n)}function Hu(n){var e=Zi(n);if(e)return Qi(n)?e.fromEntrySeq():zu(n)?e.toSetSeq():e;if(typeof n=="object")return new Yi(n);throw new TypeError("Expected Array or collection object of values, or keyed object: "+n)}function Zi(n){return Ji(n)?new On(n):Hi(n)?new qu(n):void 0}var cs="@@__IMMUTABLE_MAP__@@";function si(n){return!!(n&&n[cs])}function ds(n){return si(n)&&qt(n)}function fs(n){return!!(n&&typeof n.equals=="function"&&typeof n.hashCode=="function")}function tr(n,e){if(n===e||n!==n&&e!==e)return!0;if(!n||!e)return!1;if(typeof n.valueOf=="function"&&typeof e.valueOf=="function"){if(n=n.valueOf(),e=e.valueOf(),n===e||n!==n&&e!==e)return!0;if(!n||!e)return!1}return!!(fs(n)&&fs(e)&&n.equals(e))}var Ca=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(e,r){e|=0,r|=0;var t=e&65535,a=r&65535;return t*a+((e>>>16)*a+t*(r>>>16)<<16>>>0)|0};function eo(n){return n>>>1&1073741824|n&3221225471}var Qu=Object.prototype.valueOf;function Lr(n){if(n==null)return Ju(n);if(typeof n.hashCode=="function")return eo(n.hashCode(n));var e=ms(n);if(e==null)return Ju(e);switch(typeof e){case"boolean":return e?1108378657:1108378656;case"number":return ps(e);case"string":return e.length>zc?Wc(e):to(e);case"object":case"function":return Yu(e);case"symbol":return Rt(e);default:if(typeof e.toString=="function")return to(e.toString());throw new Error("Value type "+typeof e+" cannot be hashed.")}}function Ju(n){return n===null?1108378658:1108378659}function ps(n){if(n!==n||n===1/0)return 0;var e=n|0;for(e!==n&&(e^=n*4294967295);n>4294967295;)n/=4294967295,e^=n;return eo(e)}function Wc(n){var e=$n[n];return e===void 0&&(e=to(n),ao===Ku&&(ao=0,$n={}),ao++,$n[n]=e),e}function to(n){for(var e=0,r=0;r<n.length;r++)e=31*e+n.charCodeAt(r)|0;return eo(e)}function Rt(n){var e=bs[n];return e!==void 0||(e=ys(),bs[n]=e),e}function Yu(n){var e;if(ro&&(e=Ea.get(n),e!==void 0)||(e=n[Gn],e!==void 0)||!gs&&(e=n.propertyIsEnumerable&&n.propertyIsEnumerable[Gn],e!==void 0||(e=hs(n),e!==void 0)))return e;if(e=ys(),ro)Ea.set(n,e);else{if(vs!==void 0&&vs(n)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(gs)Object.defineProperty(n,Gn,{enumerable:!1,configurable:!1,writable:!1,value:e});else if(n.propertyIsEnumerable!==void 0&&n.propertyIsEnumerable===n.constructor.prototype.propertyIsEnumerable)n.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},n.propertyIsEnumerable[Gn]=e;else if(n.nodeType!==void 0)n[Gn]=e;else throw new Error("Unable to set a non-enumerable property on object.")}return e}var vs=Object.isExtensible,gs=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function hs(n){if(n&&n.nodeType>0)switch(n.nodeType){case 1:return n.uniqueID;case 9:return n.documentElement&&n.documentElement.uniqueID}}function ms(n){return n.valueOf!==Qu&&typeof n.valueOf=="function"?n.valueOf(n):n}function ys(){var n=++no;return no&1073741824&&(no=0),n}var ro=typeof WeakMap=="function",Ea;ro&&(Ea=new WeakMap);var bs=Object.create(null),no=0,Gn="__immutablehash__";typeof Symbol=="function"&&(Gn=Symbol(Gn));var zc=16,Ku=255,ao=0,$n={},ui=function(n){function e(r,t){this._iter=r,this._useKeys=t,this.size=r.size}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.get=function(t,a){return this._iter.get(t,a)},e.prototype.has=function(t){return this._iter.has(t)},e.prototype.valueSeq=function(){return this._iter.valueSeq()},e.prototype.reverse=function(){var t=this,a=oo(this,!0);return this._useKeys||(a.valueSeq=function(){return t._iter.toSeq().reverse()}),a},e.prototype.map=function(t,a){var i=this,o=Fs(this,t,a);return this._useKeys||(o.valueSeq=function(){return i._iter.toSeq().map(t,a)}),o},e.prototype.__iterate=function(t,a){var i=this;return this._iter.__iterate(function(o,s){return t(o,s,i)},a)},e.prototype.__iterator=function(t,a){return this._iter.__iterator(t,a)},e}(cn);ui.prototype[ra]=!0;var Ss=function(n){function e(r){this._iter=r,this.size=r.size}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.includes=function(t){return this._iter.includes(t)},e.prototype.__iterate=function(t,a){var i=this,o=0;return a&&Ze(this),this._iter.__iterate(function(s){return t(s,a?i.size-++o:o++,i)},a)},e.prototype.__iterator=function(t,a){var i=this,o=this._iter.__iterator(Hr,a),s=0;return a&&Ze(this),new rt(function(){var u=o.next();return u.done?u:pt(t,a?i.size-++s:s++,u.value,u)})},e}(Ur),io=function(n){function e(r){this._iter=r,this.size=r.size}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.has=function(t){return this._iter.includes(t)},e.prototype.__iterate=function(t,a){var i=this;return this._iter.__iterate(function(o){return t(o,o,i)},a)},e.prototype.__iterator=function(t,a){var i=this._iter.__iterator(Hr,a);return new rt(function(){var o=i.next();return o.done?o:pt(t,o.value,o.value,o)})},e}(Sn),Os=function(n){function e(r){this._iter=r,this.size=r.size}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.entrySeq=function(){return this._iter.toSeq()},e.prototype.__iterate=function(t,a){var i=this;return this._iter.__iterate(function(o){if(o){Ta(o);var s=Lt(o);return t(s?o.get(1):o[1],s?o.get(0):o[0],i)}},a)},e.prototype.__iterator=function(t,a){var i=this._iter.__iterator(Hr,a);return new rt(function(){for(;;){var o=i.next();if(o.done)return o;var s=o.value;if(s){Ta(s);var u=Lt(s);return pt(t,u?s.get(0):s[0],u?s.get(1):s[1],o)}}})},e}(cn);Ss.prototype.cacheResult=ui.prototype.cacheResult=io.prototype.cacheResult=Os.prototype.cacheResult=di;function li(n){var e=mr(n);return e._iter=n,e.size=n.size,e.flip=function(){return n},e.reverse=function(){var r=n.reverse.apply(this);return r.flip=function(){return n.reverse()},r},e.has=function(r){return n.includes(r)},e.includes=function(r){return n.has(r)},e.cacheResult=di,e.__iterateUncached=function(r,t){var a=this;return n.__iterate(function(i,o){return r(o,i,a)!==!1},t)},e.__iteratorUncached=function(r,t){if(r===$r){var a=n.__iterator(r,t);return new rt(function(){var i=a.next();if(!i.done){var o=i.value[0];i.value[0]=i.value[1],i.value[1]=o}return i})}return n.__iterator(r===Hr?Oa:Hr,t)},e}function Fs(n,e,r){var t=mr(n);return t.size=n.size,t.has=function(a){return n.has(a)},t.get=function(a,i){var o=n.get(a,we);return o===we?i:e.call(r,o,a,n)},t.__iterateUncached=function(a,i){var o=this;return n.__iterate(function(s,u,l){return a(e.call(r,s,u,l),u,o)!==!1},i)},t.__iteratorUncached=function(a,i){var o=n.__iterator($r,i);return new rt(function(){var s=o.next();if(s.done)return s;var u=s.value,l=u[0];return pt(a,l,e.call(r,u[1],l,n),s)})},t}function oo(n,e){var r=this,t=mr(n);return t._iter=n,t.size=n.size,t.reverse=function(){return n},n.flip&&(t.flip=function(){var a=li(n);return a.reverse=function(){return n.flip()},a}),t.get=function(a,i){return n.get(e?a:-1-a,i)},t.has=function(a){return n.has(e?a:-1-a)},t.includes=function(a){return n.includes(a)},t.cacheResult=di,t.__iterate=function(a,i){var o=this,s=0;return i&&Ze(n),n.__iterate(function(u,l){return a(u,e?l:i?o.size-++s:s++,o)},!i)},t.__iterator=function(a,i){var o=0;i&&Ze(n);var s=n.__iterator($r,!i);return new rt(function(){var u=s.next();if(u.done)return u;var l=u.value;return pt(a,e?l[0]:i?r.size-++o:o++,l[1],u)})},t}function ci(n,e,r,t){var a=mr(n);return t&&(a.has=function(i){var o=n.get(i,we);return o!==we&&!!e.call(r,o,i,n)},a.get=function(i,o){var s=n.get(i,we);return s!==we&&e.call(r,s,i,n)?s:o}),a.__iterateUncached=function(i,o){var s=this,u=0;return n.__iterate(function(l,c,d){if(e.call(r,l,c,d))return u++,i(l,t?c:u-1,s)},o),u},a.__iteratorUncached=function(i,o){var s=n.__iterator($r,o),u=0;return new rt(function(){for(;;){var l=s.next();if(l.done)return l;var c=l.value,d=c[0],f=c[1];if(e.call(r,f,d,n))return pt(i,t?d:u++,f,l)}})},a}function so(n,e,r){var t=yt().asMutable();return n.__iterate(function(a,i){t.update(e.call(r,a,i,n),0,function(o){return o+1})}),t.asImmutable()}function Xu(n,e,r){var t=gt(n),a=(qt(n)?Wr():yt()).asMutable();n.__iterate(function(o,s){a.update(e.call(r,o,s,n),function(u){return u=u||[],u.push(t?[s,o]:o),u})});var i=co(n);return a.map(function(o){return ht(n,i(o))}).asImmutable()}function Zu(n,e,r){var t=gt(n),a=[[],[]];n.__iterate(function(o,s){a[e.call(r,o,s,n)?1:0].push(t?[s,o]:o)});var i=co(n);return a.map(function(o){return ht(n,i(o))})}function uo(n,e,r,t){var a=n.size;if(ea(e,r,a))return n;if(typeof a>"u"&&(e<0||r<0))return uo(n.toSeq().cacheResult(),e,r,t);var i=$t(e,a),o=vr(r,a),s=o-i,u;s===s&&(u=s<0?0:s);var l=mr(n);return l.size=u===0?u:n.size&&u||void 0,!t&&ln(n)&&u>=0&&(l.get=function(c,d){return c=Zr(this,c),c>=0&&c<u?n.get(c+i,d):d}),l.__iterateUncached=function(c,d){var f=this;if(u===0)return 0;if(d)return this.cacheResult().__iterate(c,d);var p=0,g=!0,h=0;return n.__iterate(function(m,y){if(!(g&&(g=p++<i)))return h++,c(m,t?y:h-1,f)!==!1&&h!==u}),h},l.__iteratorUncached=function(c,d){if(u!==0&&d)return this.cacheResult().__iterator(c,d);if(u===0)return new rt(Cr);var f=n.__iterator(c,d),p=0,g=0;return new rt(function(){for(;p++<i;)f.next();if(++g>u)return Cr();var h=f.next();return t||c===Hr||h.done?h:c===Oa?pt(c,g-1,void 0,h):pt(c,g-1,h.value[1],h)})},l}function el(n,e,r){var t=mr(n);return t.__iterateUncached=function(a,i){var o=this;if(i)return this.cacheResult().__iterate(a,i);var s=0;return n.__iterate(function(u,l,c){return e.call(r,u,l,c)&&++s&&a(u,l,o)}),s},t.__iteratorUncached=function(a,i){var o=this;if(i)return this.cacheResult().__iterator(a,i);var s=n.__iterator($r,i),u=!0;return new rt(function(){if(!u)return Cr();var l=s.next();if(l.done)return l;var c=l.value,d=c[0],f=c[1];return e.call(r,f,d,o)?a===$r?l:pt(a,d,f,l):(u=!1,Cr())})},t}function Cs(n,e,r,t){var a=mr(n);return a.__iterateUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterate(i,o);var u=!0,l=0;return n.__iterate(function(c,d,f){if(!(u&&(u=e.call(r,c,d,f))))return l++,i(c,t?d:l-1,s)}),l},a.__iteratorUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterator(i,o);var u=n.__iterator($r,o),l=!0,c=0;return new rt(function(){var d,f,p;do{if(d=u.next(),d.done)return t||i===Hr?d:i===Oa?pt(i,c++,void 0,d):pt(i,c++,d.value[1],d);var g=d.value;f=g[0],p=g[1],l&&(l=e.call(r,p,f,s))}while(l);return i===$r?d:pt(i,f,p,d)})},a}function tl(n,e){var r=gt(n),t=[n].concat(e).map(function(o){return Lt(o)?r&&(o=Gr(o)):o=r?Ki(o):Xi(Array.isArray(o)?o:[o]),o}).filter(function(o){return o.size!==0});if(t.length===0)return n;if(t.length===1){var a=t[0];if(a===n||r&&gt(a)||lr(n)&&lr(a))return a}var i=new On(t);return r?i=i.toKeyedSeq():lr(n)||(i=i.toSetSeq()),i=i.flatten(!0),i.size=t.reduce(function(o,s){if(o!==void 0){var u=s.size;if(u!==void 0)return o+u}},0),i}function Es(n,e,r){var t=mr(n);return t.__iterateUncached=function(a,i){if(i)return this.cacheResult().__iterate(a,i);var o=0,s=!1;function u(l,c){l.__iterate(function(d,f){return(!e||c<e)&&Lt(d)?u(d,c+1):(o++,a(d,r?f:o-1,t)===!1&&(s=!0)),!s},i)}return u(n,0),o},t.__iteratorUncached=function(a,i){if(i)return this.cacheResult().__iterator(a,i);var o=n.__iterator(a,i),s=[],u=0;return new rt(function(){for(;o;){var l=o.next();if(l.done!==!1){o=s.pop();continue}var c=l.value;if(a===$r&&(c=c[1]),(!e||s.length<e)&&Lt(c))s.push(o),o=c.__iterator(a,i);else return r?l:pt(a,u++,c,l)}return Cr()})},t}function rl(n,e,r){var t=co(n);return n.toSeq().map(function(a,i){return t(e.call(r,a,i,n))}).flatten(!0)}function nl(n,e){var r=mr(n);return r.size=n.size&&n.size*2-1,r.__iterateUncached=function(t,a){var i=this,o=0;return n.__iterate(function(s){return(!o||t(e,o++,i)!==!1)&&t(s,o++,i)!==!1},a),o},r.__iteratorUncached=function(t,a){var i=n.__iterator(Hr,a),o=0,s;return new rt(function(){return(!s||o%2)&&(s=i.next(),s.done)?s:o%2?pt(t,o++,e):pt(t,o++,s.value,s)})},r}function Er(n,e,r){e||(e=fi);var t=gt(n),a=0,i=n.toSeq().map(function(o,s){return[s,o,a++,r?r(o,s,n):o]}).valueSeq().toArray();return i.sort(function(o,s){return e(o[3],s[3])||o[2]-s[2]}).forEach(t?function(o,s){i[s].length=2}:function(o,s){i[s]=o[1]}),t?cn(i):lr(n)?Ur(i):Sn(i)}function wa(n,e,r){if(e||(e=fi),r){var t=n.toSeq().map(function(a,i){return[a,r(a,i,n)]}).reduce(function(a,i){return lo(e,a[1],i[1])?i:a});return t&&t[0]}return n.reduce(function(a,i){return lo(e,a,i)?i:a})}function lo(n,e,r){var t=n(r,e);return t===0&&r!==e&&(r==null||r!==r)||t>0}function Aa(n,e,r,t){var a=mr(n),i=new On(r).map(function(o){return o.size});return a.size=t?i.max():i.min(),a.__iterate=function(o,s){for(var u=this.__iterator(Hr,s),l,c=0;!(l=u.next()).done&&o(l.value,c++,this)!==!1;);return c},a.__iteratorUncached=function(o,s){var u=r.map(function(d){return d=At(d),yn(s?d.reverse():d)}),l=0,c=!1;return new rt(function(){var d;return c||(d=u.map(function(f){return f.next()}),c=t?d.every(function(f){return f.done}):d.some(function(f){return f.done})),c?Cr():pt(o,l++,e.apply(null,d.map(function(f){return f.value})))})},a}function ht(n,e){return n===e?n:ln(n)?e:n.constructor(e)}function Ta(n){if(n!==Object(n))throw new TypeError("Expected [K, V] tuple: "+n)}function co(n){return gt(n)?Gr:lr(n)?Vn:ta}function mr(n){return Object.create((gt(n)?cn:lr(n)?Ur:Sn).prototype)}function di(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):hr.prototype.cacheResult.call(this)}function fi(n,e){return n===void 0&&e===void 0?0:n===void 0?1:e===void 0?-1:n>e?1:n<e?-1:0}function en(n,e){e=e||0;for(var r=Math.max(0,n.length-e),t=new Array(r),a=0;a<r;a++)t[a]=n[a+e];return t}function Un(n,e){if(!n)throw new Error(e)}function Rr(n){Un(n!==1/0,"Cannot perform this action with an infinite size.")}function ws(n){if(Ji(n)&&typeof n!="string")return n;if(qt(n))return n.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+n)}var al=Object.prototype.toString;function fo(n){if(!n||typeof n!="object"||al.call(n)!=="[object Object]")return!1;var e=Object.getPrototypeOf(n);if(e===null)return!0;for(var r=e,t=Object.getPrototypeOf(e);t!==null;)r=t,t=Object.getPrototypeOf(r);return r===e}function dn(n){return typeof n=="object"&&(gr(n)||Array.isArray(n)||fo(n))}function aa(n){try{return typeof n=="string"?JSON.stringify(n):String(n)}catch{return JSON.stringify(n)}}function jr(n,e){return gr(n)?n.has(e):dn(n)&&na.call(n,e)}function Bn(n,e,r){return gr(n)?n.get(e,r):jr(n,e)?typeof n.get=="function"?n.get(e):n[e]:r}function pi(n){if(Array.isArray(n))return en(n);var e={};for(var r in n)na.call(n,r)&&(e[r]=n[r]);return e}function As(n,e){if(!dn(n))throw new TypeError("Cannot update non-data-structure value: "+n);if(gr(n)){if(!n.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+n);return n.remove(e)}if(!na.call(n,e))return n;var r=pi(n);return Array.isArray(r)?r.splice(e,1):delete r[e],r}function Ts(n,e,r){if(!dn(n))throw new TypeError("Cannot update non-data-structure value: "+n);if(gr(n)){if(!n.set)throw new TypeError("Cannot update immutable value without .set() method: "+n);return n.set(e,r)}if(na.call(n,e)&&r===n[e])return n;var t=pi(n);return t[e]=r,t}function Fn(n,e,r,t){t||(t=r,r=void 0);var a=_s(gr(n),n,ws(e),0,r,t);return a===we?r:a}function _s(n,e,r,t,a,i){var o=e===we;if(t===r.length){var s=o?a:e,u=i(s);return u===s?e:u}if(!o&&!dn(e))throw new TypeError("Cannot update within non-data-structure value in path ["+r.slice(0,t).map(aa)+"]: "+e);var l=r[t],c=o?we:Bn(e,l,we),d=_s(c===we?n:gr(c),c,r,t+1,a,i);return d===c?e:d===we?As(e,l):Ts(o?n?Qr():{}:e,l,d)}function vi(n,e,r){return Fn(n,e,we,function(){return r})}function gi(n,e){return vi(this,n,e)}function Ls(n,e){return Fn(n,e,function(){return we})}function _a(n){return Ls(this,n)}function po(n,e,r,t){return Fn(n,[e],r,t)}function vo(n,e,r){return arguments.length===1?n(this):po(this,n,e,r)}function La(n,e,r){return Fn(this,n,e,r)}function Rs(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];return xs(this,n)}function js(n){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];if(typeof n!="function")throw new TypeError("Invalid merger function: "+n);return xs(this,e,n)}function xs(n,e,r){for(var t=[],a=0;a<e.length;a++){var i=Gr(e[a]);i.size!==0&&t.push(i)}return t.length===0?n:n.toSeq().size===0&&!n.__ownerID&&t.length===1?n.constructor(t[0]):n.withMutations(function(o){for(var s=r?function(l,c){po(o,c,we,function(d){return d===we?l:r(d,l,c)})}:function(l,c){o.set(c,l)},u=0;u<t.length;u++)t[u].forEach(s)})}function Is(n){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];return ja(n,e)}function Ds(n,e){for(var r=[],t=arguments.length-2;t-- >0;)r[t]=arguments[t+2];return ja(e,r,n)}function il(n){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];return Ra(n,e)}function ol(n,e){for(var r=[],t=arguments.length-2;t-- >0;)r[t]=arguments[t+2];return Ra(e,r,n)}function Ra(n,e,r){return ja(n,e,sl(r))}function ja(n,e,r){if(!dn(n))throw new TypeError("Cannot merge into non-data-structure value: "+n);if(gr(n))return typeof r=="function"&&n.mergeWith?n.mergeWith.apply(n,[r].concat(e)):n.merge?n.merge.apply(n,e):n.concat.apply(n,e);for(var t=Array.isArray(n),a=n,i=t?Vn:Gr,o=t?function(u){a===n&&(a=pi(a)),a.push(u)}:function(u,l){var c=na.call(a,l),d=c&&r?r(a[l],u,l):u;(!c||d!==a[l])&&(a===n&&(a=pi(a)),a[l]=d)},s=0;s<e.length;s++)i(e[s]).forEach(o);return a}function sl(n){function e(r,t,a){return dn(r)&&dn(t)&&Cn(r,t)?ja(r,[t],e):n?n(r,t,a):t}return e}function Cn(n,e){var r=hr(n),t=hr(e);return lr(r)===lr(t)&&gt(r)===gt(t)}function Ps(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];return Ra(this,n)}function xa(n){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];return Ra(this,e,n)}function go(n){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];return Fn(this,n,Qr(),function(t){return ja(t,e)})}function ho(n){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];return Fn(this,n,Qr(),function(t){return Ra(t,e)})}function Ia(n){var e=this.asMutable();return n(e),e.wasAltered()?e.__ensureOwner(this.__ownerID):this}function ia(){return this.__ownerID?this:this.__ensureOwner(new ri)}function Da(){return this.__ensureOwner()}function mo(){return this.__altered}var yt=function(n){function e(r){return r==null?Qr():si(r)&&!qt(r)?r:Qr().withMutations(function(t){var a=n(r);Rr(a.size),a.forEach(function(i,o){return t.set(o,i)})})}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){for(var t=[],a=arguments.length;a--;)t[a]=arguments[a];return Qr().withMutations(function(i){for(var o=0;o<t.length;o+=2){if(o+1>=t.length)throw new Error("Missing value for key: "+t[o]);i.set(t[o],t[o+1])}})},e.prototype.toString=function(){return this.__toString("Map {","}")},e.prototype.get=function(t,a){return this._root?this._root.get(0,void 0,t,a):a},e.prototype.set=function(t,a){return Ms(this,t,a)},e.prototype.remove=function(t){return Ms(this,t,we)},e.prototype.deleteAll=function(t){var a=At(t);return a.size===0?this:this.withMutations(function(i){a.forEach(function(o){return i.remove(o)})})},e.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Qr()},e.prototype.sort=function(t){return Wr(Er(this,t))},e.prototype.sortBy=function(t,a){return Wr(Er(this,a,t))},e.prototype.map=function(t,a){var i=this;return this.withMutations(function(o){o.forEach(function(s,u){o.set(u,t.call(a,s,u,i))})})},e.prototype.__iterator=function(t,a){return new ul(this,t,a)},e.prototype.__iterate=function(t,a){var i=this,o=0;return this._root&&this._root.iterate(function(s){return o++,t(s[1],s[0],i)},a),o},e.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?bo(this.size,this._root,t,this.__hash):this.size===0?Qr():(this.__ownerID=t,this.__altered=!1,this)},e}(Gr);yt.isMap=si;var Ot=yt.prototype;Ot[cs]=!0,Ot[ma]=Ot.remove,Ot.removeAll=Ot.deleteAll,Ot.setIn=gi,Ot.removeIn=Ot.deleteIn=_a,Ot.update=vo,Ot.updateIn=La,Ot.merge=Ot.concat=Rs,Ot.mergeWith=js,Ot.mergeDeep=Ps,Ot.mergeDeepWith=xa,Ot.mergeIn=go,Ot.mergeDeepIn=ho,Ot.withMutations=Ia,Ot.wasAltered=mo,Ot.asImmutable=Da,Ot["@@transducer/init"]=Ot.asMutable=ia,Ot["@@transducer/step"]=function(n,e){return n.set(e[0],e[1])},Ot["@@transducer/result"]=function(n){return n.asImmutable()};var oa=function(e,r){this.ownerID=e,this.entries=r};oa.prototype.get=function(e,r,t,a){for(var i=this.entries,o=0,s=i.length;o<s;o++)if(tr(t,i[o][0]))return i[o][1];return a},oa.prototype.update=function(e,r,t,a,i,o,s){for(var u=i===we,l=this.entries,c=0,d=l.length;c<d&&!tr(a,l[c][0]);c++);var f=c<d;if(f?l[c][1]===i:u)return this;if(qe(s),(u||!f)&&qe(o),!(u&&l.length===1)){if(!f&&!u&&l.length>=hi)return ll(e,l,a,i);var p=e&&e===this.ownerID,g=p?l:en(l);return f?u?c===d-1?g.pop():g[c]=g.pop():g[c]=[a,i]:g.push([a,i]),p?(this.entries=g,this):new oa(e,g)}};var Wn=function(e,r,t){this.ownerID=e,this.bitmap=r,this.nodes=t};Wn.prototype.get=function(e,r,t,a){r===void 0&&(r=Lr(t));var i=1<<((e===0?r:r>>>e)&It),o=this.bitmap;return(o&i)===0?a:this.nodes[Gs(o&i-1)].get(e+St,r,t,a)},Wn.prototype.update=function(e,r,t,a,i,o,s){t===void 0&&(t=Lr(a));var u=(r===0?t:t>>>r)&It,l=1<<u,c=this.bitmap,d=(c&l)!==0;if(!d&&i===we)return this;var f=Gs(c&l-1),p=this.nodes,g=d?p[f]:void 0,h=So(g,e,r+St,t,a,i,o,s);if(h===g)return this;if(!d&&h&&p.length>=vl)return dl(e,p,c,u,h);if(d&&!h&&p.length===2&&ks(p[f^1]))return p[f^1];if(d&&h&&p.length===1&&ks(h))return h;var m=e&&e===this.ownerID,y=d?h?c:c^l:c|l,S=d?h?$s(p,f,h,m):pl(p,f,m):fl(p,f,h,m);return m?(this.bitmap=y,this.nodes=S,this):new Wn(e,y,S)};var sa=function(e,r,t){this.ownerID=e,this.count=r,this.nodes=t};sa.prototype.get=function(e,r,t,a){r===void 0&&(r=Lr(t));var i=(e===0?r:r>>>e)&It,o=this.nodes[i];return o?o.get(e+St,r,t,a):a},sa.prototype.update=function(e,r,t,a,i,o,s){t===void 0&&(t=Lr(a));var u=(r===0?t:t>>>r)&It,l=i===we,c=this.nodes,d=c[u];if(l&&!d)return this;var f=So(d,e,r+St,t,a,i,o,s);if(f===d)return this;var p=this.count;if(!d)p++;else if(!f&&(p--,p<gl))return cl(e,c,p,u);var g=e&&e===this.ownerID,h=$s(c,u,f,g);return g?(this.count=p,this.nodes=h,this):new sa(e,p,h)};var zn=function(e,r,t){this.ownerID=e,this.keyHash=r,this.entries=t};zn.prototype.get=function(e,r,t,a){for(var i=this.entries,o=0,s=i.length;o<s;o++)if(tr(t,i[o][0]))return i[o][1];return a},zn.prototype.update=function(e,r,t,a,i,o,s){t===void 0&&(t=Lr(a));var u=i===we;if(t!==this.keyHash)return u?this:(qe(s),qe(o),Oo(this,e,r,t,[a,i]));for(var l=this.entries,c=0,d=l.length;c<d&&!tr(a,l[c][0]);c++);var f=c<d;if(f?l[c][1]===i:u)return this;if(qe(s),(u||!f)&&qe(o),u&&d===2)return new fn(e,this.keyHash,l[c^1]);var p=e&&e===this.ownerID,g=p?l:en(l);return f?u?c===d-1?g.pop():g[c]=g.pop():g[c]=[a,i]:g.push([a,i]),p?(this.entries=g,this):new zn(e,this.keyHash,g)};var fn=function(e,r,t){this.ownerID=e,this.keyHash=r,this.entry=t};fn.prototype.get=function(e,r,t,a){return tr(t,this.entry[0])?this.entry[1]:a},fn.prototype.update=function(e,r,t,a,i,o,s){var u=i===we,l=tr(a,this.entry[0]);if(l?i===this.entry[1]:u)return this;if(qe(s),u){qe(o);return}return l?e&&e===this.ownerID?(this.entry[1]=i,this):new fn(e,this.keyHash,[a,i]):(qe(o),Oo(this,e,r,Lr(a),[a,i]))},oa.prototype.iterate=zn.prototype.iterate=function(n,e){for(var r=this.entries,t=0,a=r.length-1;t<=a;t++)if(n(r[e?a-t:t])===!1)return!1},Wn.prototype.iterate=sa.prototype.iterate=function(n,e){for(var r=this.nodes,t=0,a=r.length-1;t<=a;t++){var i=r[e?a-t:t];if(i&&i.iterate(n,e)===!1)return!1}},fn.prototype.iterate=function(n,e){return n(this.entry)};var ul=function(n){function e(r,t,a){this._type=t,this._reverse=a,this._stack=r._root&&Ns(r._root)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.next=function(){for(var t=this._type,a=this._stack;a;){var i=a.node,o=a.index++,s=void 0;if(i.entry){if(o===0)return yo(t,i.entry)}else if(i.entries){if(s=i.entries.length-1,o<=s)return yo(t,i.entries[this._reverse?s-o:o])}else if(s=i.nodes.length-1,o<=s){var u=i.nodes[this._reverse?s-o:o];if(u){if(u.entry)return yo(t,u.entry);a=this._stack=Ns(u,a)}continue}a=this._stack=this._stack.__prev}return Cr()},e}(rt);function yo(n,e){return pt(n,e[0],e[1])}function Ns(n,e){return{node:n,index:0,__prev:e}}function bo(n,e,r,t){var a=Object.create(Ot);return a.size=n,a._root=e,a.__ownerID=r,a.__hash=t,a.__altered=!1,a}var Vs;function Qr(){return Vs||(Vs=bo(0))}function Ms(n,e,r){var t,a;if(n._root){var i=ya(),o=ya();if(t=So(n._root,n.__ownerID,0,void 0,e,r,i,o),!o.value)return n;a=n.size+(i.value?r===we?-1:1:0)}else{if(r===we)return n;a=1,t=new oa(n.__ownerID,[[e,r]])}return n.__ownerID?(n.size=a,n._root=t,n.__hash=void 0,n.__altered=!0,n):t?bo(a,t):Qr()}function So(n,e,r,t,a,i,o,s){return n?n.update(e,r,t,a,i,o,s):i===we?n:(qe(s),qe(o),new fn(e,t,[a,i]))}function ks(n){return n.constructor===fn||n.constructor===zn}function Oo(n,e,r,t,a){if(n.keyHash===t)return new zn(e,t,[n.entry,a]);var i=(r===0?n.keyHash:n.keyHash>>>r)&It,o=(r===0?t:t>>>r)&It,s,u=i===o?[Oo(n,e,r+St,t,a)]:(s=new fn(e,t,a),i<o?[n,s]:[s,n]);return new Wn(e,1<<i|1<<o,u)}function ll(n,e,r,t){n||(n=new ri);for(var a=new fn(n,Lr(r),[r,t]),i=0;i<e.length;i++){var o=e[i];a=a.update(n,0,void 0,o[0],o[1])}return a}function cl(n,e,r,t){for(var a=0,i=0,o=new Array(r),s=0,u=1,l=e.length;s<l;s++,u<<=1){var c=e[s];c!==void 0&&s!==t&&(a|=u,o[i++]=c)}return new Wn(n,a,o)}function dl(n,e,r,t,a){for(var i=0,o=new Array(kr),s=0;r!==0;s++,r>>>=1)o[s]=r&1?e[i++]:void 0;return o[t]=a,new sa(n,i+1,o)}function Gs(n){return n-=n>>1&1431655765,n=(n&858993459)+(n>>2&858993459),n=n+(n>>4)&252645135,n+=n>>8,n+=n>>16,n&127}function $s(n,e,r,t){var a=t?n:en(n);return a[e]=r,a}function fl(n,e,r,t){var a=n.length+1;if(t&&e+1===a)return n[e]=r,n;for(var i=new Array(a),o=0,s=0;s<a;s++)s===e?(i[s]=r,o=-1):i[s]=n[s+o];return i}function pl(n,e,r){var t=n.length-1;if(r&&e===t)return n.pop(),n;for(var a=new Array(t),i=0,o=0;o<t;o++)o===e&&(i=1),a[o]=n[o+i];return a}var hi=kr/4,vl=kr/2,gl=kr/4,Br="@@__IMMUTABLE_LIST__@@";function Fo(n){return!!(n&&n[Br])}var Jr=function(n){function e(r){var t=mi();if(r==null)return t;if(Fo(r))return r;var a=n(r),i=a.size;return i===0?t:(Rr(i),i>0&&i<kr?Na(0,i,St,null,new pn(a.toArray())):t.withMutations(function(o){o.setSize(i),a.forEach(function(s,u){return o.set(u,s)})}))}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return this(arguments)},e.prototype.toString=function(){return this.__toString("List [","]")},e.prototype.get=function(t,a){if(t=Zr(this,t),t>=0&&t<this.size){t+=this._origin;var i=zs(this,t);return i&&i.array[t&It]}return a},e.prototype.set=function(t,a){return Ws(this,t,a)},e.prototype.remove=function(t){return this.has(t)?t===0?this.shift():t===this.size-1?this.pop():this.splice(t,1):this},e.prototype.insert=function(t,a){return this.splice(t,0,a)},e.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=St,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):mi()},e.prototype.push=function(){var t=arguments,a=this.size;return this.withMutations(function(i){En(i,0,a+t.length);for(var o=0;o<t.length;o++)i.set(a+o,t[o])})},e.prototype.pop=function(){return En(this,0,-1)},e.prototype.unshift=function(){var t=arguments;return this.withMutations(function(a){En(a,-t.length);for(var i=0;i<t.length;i++)a.set(i,t[i])})},e.prototype.shift=function(){return En(this,1)},e.prototype.concat=function(){for(var t=arguments,a=[],i=0;i<arguments.length;i++){var o=t[i],s=n(typeof o!="string"&&Hi(o)?o:[o]);s.size!==0&&a.push(s)}return a.length===0?this:this.size===0&&!this.__ownerID&&a.length===1?this.constructor(a[0]):this.withMutations(function(u){a.forEach(function(l){return l.forEach(function(c){return u.push(c)})})})},e.prototype.setSize=function(t){return En(this,0,t)},e.prototype.map=function(t,a){var i=this;return this.withMutations(function(o){for(var s=0;s<i.size;s++)o.set(s,t.call(a,o.get(s),s,i))})},e.prototype.slice=function(t,a){var i=this.size;return ea(t,a,i)?this:En(this,$t(t,i),vr(a,i))},e.prototype.__iterator=function(t,a){var i=a?this.size:0,o=Us(this,a);return new rt(function(){var s=o();return s===Pa?Cr():pt(t,a?--i:i++,s)})},e.prototype.__iterate=function(t,a){for(var i=a?this.size:0,o=Us(this,a),s;(s=o())!==Pa&&t(s,a?--i:i++,this)!==!1;);return i},e.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?Na(this._origin,this._capacity,this._level,this._root,this._tail,t,this.__hash):this.size===0?mi():(this.__ownerID=t,this.__altered=!1,this)},e}(Vn);Jr.isList=Fo;var Dt=Jr.prototype;Dt[Br]=!0,Dt[ma]=Dt.remove,Dt.merge=Dt.concat,Dt.setIn=gi,Dt.deleteIn=Dt.removeIn=_a,Dt.update=vo,Dt.updateIn=La,Dt.mergeIn=go,Dt.mergeDeepIn=ho,Dt.withMutations=Ia,Dt.wasAltered=mo,Dt.asImmutable=Da,Dt["@@transducer/init"]=Dt.asMutable=ia,Dt["@@transducer/step"]=function(n,e){return n.push(e)},Dt["@@transducer/result"]=function(n){return n.asImmutable()};var pn=function(e,r){this.array=e,this.ownerID=r};pn.prototype.removeBefore=function(e,r,t){if(t===r?1<<r:this.array.length===0)return this;var a=t>>>r&It;if(a>=this.array.length)return new pn([],e);var i=a===0,o;if(r>0){var s=this.array[a];if(o=s&&s.removeBefore(e,r-St,t),o===s&&i)return this}if(i&&!o)return this;var u=qn(this,e);if(!i)for(var l=0;l<a;l++)u.array[l]=void 0;return o&&(u.array[a]=o),u},pn.prototype.removeAfter=function(e,r,t){if(t===(r?1<<r:0)||this.array.length===0)return this;var a=t-1>>>r&It;if(a>=this.array.length)return this;var i;if(r>0){var o=this.array[a];if(i=o&&o.removeAfter(e,r-St,t),i===o&&a===this.array.length-1)return this}var s=qn(this,e);return s.array.splice(a+1),i&&(s.array[a]=i),s};var Pa={};function Us(n,e){var r=n._origin,t=n._capacity,a=Va(t),i=n._tail;return o(n._root,n._level,0);function o(l,c,d){return c===0?s(l,d):u(l,c,d)}function s(l,c){var d=c===a?i&&i.array:l&&l.array,f=c>r?0:r-c,p=t-c;return p>kr&&(p=kr),function(){if(f===p)return Pa;var g=e?--p:f++;return d&&d[g]}}function u(l,c,d){var f,p=l&&l.array,g=d>r?0:r-d>>c,h=(t-d>>c)+1;return h>kr&&(h=kr),function(){for(;;){if(f){var m=f();if(m!==Pa)return m;f=null}if(g===h)return Pa;var y=e?--h:g++;f=o(p&&p[y],c-St,d+(y<<c))}}}}function Na(n,e,r,t,a,i,o){var s=Object.create(Dt);return s.size=e-n,s._origin=n,s._capacity=e,s._level=r,s._root=t,s._tail=a,s.__ownerID=i,s.__hash=o,s.__altered=!1,s}var Bs;function mi(){return Bs||(Bs=Na(0,0,St))}function Ws(n,e,r){if(e=Zr(n,e),e!==e)return n;if(e>=n.size||e<0)return n.withMutations(function(o){e<0?En(o,e).set(0,r):En(o,0,e+1).set(e,r)});e+=n._origin;var t=n._tail,a=n._root,i=ya();return e>=Va(n._capacity)?t=Co(t,n.__ownerID,0,e,r,i):a=Co(a,n.__ownerID,n._level,e,r,i),i.value?n.__ownerID?(n._root=a,n._tail=t,n.__hash=void 0,n.__altered=!0,n):Na(n._origin,n._capacity,n._level,a,t):n}function Co(n,e,r,t,a,i){var o=t>>>r&It,s=n&&o<n.array.length;if(!s&&a===void 0)return n;var u;if(r>0){var l=n&&n.array[o],c=Co(l,e,r-St,t,a,i);return c===l?n:(u=qn(n,e),u.array[o]=c,u)}return s&&n.array[o]===a?n:(i&&qe(i),u=qn(n,e),a===void 0&&o===u.array.length-1?u.array.pop():u.array[o]=a,u)}function qn(n,e){return e&&n&&e===n.ownerID?n:new pn(n?n.array.slice():[],e)}function zs(n,e){if(e>=Va(n._capacity))return n._tail;if(e<1<<n._level+St){for(var r=n._root,t=n._level;r&&t>0;)r=r.array[e>>>t&It],t-=St;return r}}function En(n,e,r){e!==void 0&&(e|=0),r!==void 0&&(r|=0);var t=n.__ownerID||new ri,a=n._origin,i=n._capacity,o=a+e,s=r===void 0?i:r<0?i+r:a+r;if(o===a&&s===i)return n;if(o>=s)return n.clear();for(var u=n._level,l=n._root,c=0;o+c<0;)l=new pn(l&&l.array.length?[void 0,l]:[],t),u+=St,c+=1<<u;c&&(o+=c,a+=c,s+=c,i+=c);for(var d=Va(i),f=Va(s);f>=1<<u+St;)l=new pn(l&&l.array.length?[l]:[],t),u+=St;var p=n._tail,g=f<d?zs(n,s-1):f>d?new pn([],t):p;if(p&&f>d&&o<i&&p.array.length){l=qn(l,t);for(var h=l,m=u;m>St;m-=St){var y=d>>>m&It;h=h.array[y]=qn(h.array[y],t)}h.array[d>>>St&It]=p}if(s<i&&(g=g&&g.removeAfter(t,0,s)),o>=f)o-=f,s-=f,u=St,l=null,g=g&&g.removeBefore(t,0,o);else if(o>a||f<d){for(c=0;l;){var S=o>>>u&It;if(S!==f>>>u&It)break;S&&(c+=(1<<u)*S),u-=St,l=l.array[S]}l&&o>a&&(l=l.removeBefore(t,u,o-c)),l&&f<d&&(l=l.removeAfter(t,u,f-c)),c&&(o-=c,s-=c)}return n.__ownerID?(n.size=s-o,n._origin=o,n._capacity=s,n._level=u,n._root=l,n._tail=g,n.__hash=void 0,n.__altered=!0,n):Na(o,s,u,l,g)}function Va(n){return n<kr?0:n-1>>>St<<St}var Wr=function(n){function e(r){return r==null?Ma():ds(r)?r:Ma().withMutations(function(t){var a=Gr(r);Rr(a.size),a.forEach(function(i,o){return t.set(o,i)})})}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return this(arguments)},e.prototype.toString=function(){return this.__toString("OrderedMap {","}")},e.prototype.get=function(t,a){var i=this._map.get(t);return i!==void 0?this._list.get(i)[1]:a},e.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):Ma()},e.prototype.set=function(t,a){return Hs(this,t,a)},e.prototype.remove=function(t){return Hs(this,t,we)},e.prototype.__iterate=function(t,a){var i=this;return this._list.__iterate(function(o){return o&&t(o[1],o[0],i)},a)},e.prototype.__iterator=function(t,a){return this._list.fromEntrySeq().__iterator(t,a)},e.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var a=this._map.__ensureOwner(t),i=this._list.__ensureOwner(t);return t?Eo(a,i,t,this.__hash):this.size===0?Ma():(this.__ownerID=t,this.__altered=!1,this._map=a,this._list=i,this)},e}(yt);Wr.isOrderedMap=ds,Wr.prototype[ra]=!0,Wr.prototype[ma]=Wr.prototype.remove;function Eo(n,e,r,t){var a=Object.create(Wr.prototype);return a.size=n?n.size:0,a._map=n,a._list=e,a.__ownerID=r,a.__hash=t,a.__altered=!1,a}var qs;function Ma(){return qs||(qs=Eo(Qr(),mi()))}function Hs(n,e,r){var t=n._map,a=n._list,i=t.get(e),o=i!==void 0,s,u;if(r===we){if(!o)return n;a.size>=kr&&a.size>=t.size*2?(u=a.filter(function(l,c){return l!==void 0&&i!==c}),s=u.toKeyedSeq().map(function(l){return l[0]}).flip().toMap(),n.__ownerID&&(s.__ownerID=u.__ownerID=n.__ownerID)):(s=t.remove(e),u=i===a.size-1?a.pop():a.set(i,void 0))}else if(o){if(r===a.get(i)[1])return n;s=t,u=a.set(i,[e,r])}else s=t.set(e,a.size),u=a.set(a.size,[e,r]);return n.__ownerID?(n.size=s.size,n._map=s,n._list=u,n.__hash=void 0,n.__altered=!0,n):Eo(s,u)}var Qs="@@__IMMUTABLE_STACK__@@";function yi(n){return!!(n&&n[Qs])}var O=function(n){function e(r){return r==null?A():yi(r)?r:A().pushAll(r)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return this(arguments)},e.prototype.toString=function(){return this.__toString("Stack [","]")},e.prototype.get=function(t,a){var i=this._head;for(t=Zr(this,t);i&&t--;)i=i.next;return i?i.value:a},e.prototype.peek=function(){return this._head&&this._head.value},e.prototype.push=function(){var t=arguments;if(arguments.length===0)return this;for(var a=this.size+arguments.length,i=this._head,o=arguments.length-1;o>=0;o--)i={value:t[o],next:i};return this.__ownerID?(this.size=a,this._head=i,this.__hash=void 0,this.__altered=!0,this):b(a,i)},e.prototype.pushAll=function(t){if(t=n(t),t.size===0)return this;if(this.size===0&&yi(t))return t;Rr(t.size);var a=this.size,i=this._head;return t.__iterate(function(o){a++,i={value:o,next:i}},!0),this.__ownerID?(this.size=a,this._head=i,this.__hash=void 0,this.__altered=!0,this):b(a,i)},e.prototype.pop=function(){return this.slice(1)},e.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):A()},e.prototype.slice=function(t,a){if(ea(t,a,this.size))return this;var i=$t(t,this.size),o=vr(a,this.size);if(o!==this.size)return n.prototype.slice.call(this,t,a);for(var s=this.size-i,u=this._head;i--;)u=u.next;return this.__ownerID?(this.size=s,this._head=u,this.__hash=void 0,this.__altered=!0,this):b(s,u)},e.prototype.__ensureOwner=function(t){return t===this.__ownerID?this:t?b(this.size,this._head,t,this.__hash):this.size===0?A():(this.__ownerID=t,this.__altered=!1,this)},e.prototype.__iterate=function(t,a){var i=this;if(a)return new On(this.toArray()).__iterate(function(u,l){return t(u,l,i)},a);for(var o=0,s=this._head;s&&t(s.value,o++,this)!==!1;)s=s.next;return o},e.prototype.__iterator=function(t,a){if(a)return new On(this.toArray()).__iterator(t,a);var i=0,o=this._head;return new rt(function(){if(o){var s=o.value;return o=o.next,pt(t,i++,s)}return Cr()})},e}(Vn);O.isStack=yi;var v=O.prototype;v[Qs]=!0,v.shift=v.pop,v.unshift=v.push,v.unshiftAll=v.pushAll,v.withMutations=Ia,v.wasAltered=mo,v.asImmutable=Da,v["@@transducer/init"]=v.asMutable=ia,v["@@transducer/step"]=function(n,e){return n.unshift(e)},v["@@transducer/result"]=function(n){return n.asImmutable()};function b(n,e,r,t){var a=Object.create(v);return a.size=n,a._head=e,a.__ownerID=r,a.__hash=t,a.__altered=!1,a}var E;function A(){return E||(E=b(0))}var x="@@__IMMUTABLE_SET__@@";function k(n){return!!(n&&n[x])}function Q(n){return k(n)&&qt(n)}function K(n,e){if(n===e)return!0;if(!Lt(e)||n.size!==void 0&&e.size!==void 0&&n.size!==e.size||n.__hash!==void 0&&e.__hash!==void 0&&n.__hash!==e.__hash||gt(n)!==gt(e)||lr(n)!==lr(e)||qt(n)!==qt(e))return!1;if(n.size===0&&e.size===0)return!0;var r=!ba(n);if(qt(n)){var t=n.entries();return e.every(function(u,l){var c=t.next().value;return c&&tr(c[1],u)&&(r||tr(c[0],l))})&&t.next().done}var a=!1;if(n.size===void 0)if(e.size===void 0)typeof n.cacheResult=="function"&&n.cacheResult();else{a=!0;var i=n;n=e,e=i}var o=!0,s=e.__iterate(function(u,l){if(r?!n.has(u):a?!tr(u,n.get(l,we)):!tr(n.get(l,we),u))return o=!1,!1});return o&&n.size===s}function ae(n,e){var r=function(t){n.prototype[t]=e[t]};return Object.keys(e).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(e).forEach(r),n}function de(n){if(!n||typeof n!="object")return n;if(!Lt(n)){if(!dn(n))return n;n=hr(n)}if(gt(n)){var e={};return n.__iterate(function(t,a){e[a]=de(t)}),e}var r=[];return n.__iterate(function(t){r.push(de(t))}),r}var me=function(n){function e(r){return r==null?He():k(r)&&!qt(r)?r:He().withMutations(function(t){var a=n(r);Rr(a.size),a.forEach(function(i){return t.add(i)})})}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return this(arguments)},e.fromKeys=function(t){return this(Gr(t).keySeq())},e.intersect=function(t){return t=At(t).toArray(),t.length?De.intersect.apply(e(t.pop()),t):He()},e.union=function(t){return t=At(t).toArray(),t.length?De.union.apply(e(t.pop()),t):He()},e.prototype.toString=function(){return this.__toString("Set {","}")},e.prototype.has=function(t){return this._map.has(t)},e.prototype.add=function(t){return We(this,this._map.set(t,t))},e.prototype.remove=function(t){return We(this,this._map.remove(t))},e.prototype.clear=function(){return We(this,this._map.clear())},e.prototype.map=function(t,a){var i=this,o=!1,s=We(this,this._map.mapEntries(function(u){var l=u[1],c=t.call(a,l,l,i);return c!==l&&(o=!0),[c,c]},a));return o?s:this},e.prototype.union=function(){for(var t=[],a=arguments.length;a--;)t[a]=arguments[a];return t=t.filter(function(i){return i.size!==0}),t.length===0?this:this.size===0&&!this.__ownerID&&t.length===1?this.constructor(t[0]):this.withMutations(function(i){for(var o=0;o<t.length;o++)typeof t[o]=="string"?i.add(t[o]):n(t[o]).forEach(function(s){return i.add(s)})})},e.prototype.intersect=function(){for(var t=[],a=arguments.length;a--;)t[a]=arguments[a];if(t.length===0)return this;t=t.map(function(o){return n(o)});var i=[];return this.forEach(function(o){t.every(function(s){return s.includes(o)})||i.push(o)}),this.withMutations(function(o){i.forEach(function(s){o.remove(s)})})},e.prototype.subtract=function(){for(var t=[],a=arguments.length;a--;)t[a]=arguments[a];if(t.length===0)return this;t=t.map(function(o){return n(o)});var i=[];return this.forEach(function(o){t.some(function(s){return s.includes(o)})&&i.push(o)}),this.withMutations(function(o){i.forEach(function(s){o.remove(s)})})},e.prototype.sort=function(t){return Oi(Er(this,t))},e.prototype.sortBy=function(t,a){return Oi(Er(this,a,t))},e.prototype.wasAltered=function(){return this._map.wasAltered()},e.prototype.__iterate=function(t,a){var i=this;return this._map.__iterate(function(o){return t(o,o,i)},a)},e.prototype.__iterator=function(t,a){return this._map.__iterator(t,a)},e.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var a=this._map.__ensureOwner(t);return t?this.__make(a,t):this.size===0?this.__empty():(this.__ownerID=t,this._map=a,this)},e}(ta);me.isSet=k;var De=me.prototype;De[x]=!0,De[ma]=De.remove,De.merge=De.concat=De.union,De.withMutations=Ia,De.asImmutable=Da,De["@@transducer/init"]=De.asMutable=ia,De["@@transducer/step"]=function(n,e){return n.add(e)},De["@@transducer/result"]=function(n){return n.asImmutable()},De.__empty=He,De.__make=xr;function We(n,e){return n.__ownerID?(n.size=e.size,n._map=e,n):e===n._map?n:e.size===0?n.__empty():n.__make(e)}function xr(n,e){var r=Object.create(De);return r.size=n?n.size:0,r._map=n,r.__ownerID=e,r}var ua;function He(){return ua||(ua=xr(Qr()))}var Pt=function(n){function e(r,t,a){if(!(this instanceof e))return new e(r,t,a);if(Un(a!==0,"Cannot step a Range by 0"),r=r||0,t===void 0&&(t=1/0),a=a===void 0?1:Math.abs(a),t<r&&(a=-a),this._start=r,this._end=t,this._step=a,this.size=Math.max(0,Math.ceil((t-r)/a-1)+1),this.size===0){if(cr)return cr;cr=this}}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},e.prototype.get=function(t,a){return this.has(t)?this._start+Zr(this,t)*this._step:a},e.prototype.includes=function(t){var a=(t-this._start)/this._step;return a>=0&&a<this.size&&a===Math.floor(a)},e.prototype.slice=function(t,a){return ea(t,a,this.size)?this:(t=$t(t,this.size),a=vr(a,this.size),a<=t?new e(0,0):new e(this.get(t,this._end),this.get(a,this._end),this._step))},e.prototype.indexOf=function(t){var a=t-this._start;if(a%this._step===0){var i=a/this._step;if(i>=0&&i<this.size)return i}return-1},e.prototype.lastIndexOf=function(t){return this.indexOf(t)},e.prototype.__iterate=function(t,a){for(var i=this.size,o=this._step,s=a?this._start+(i-1)*o:this._start,u=0;u!==i&&t(s,a?i-++u:u++,this)!==!1;)s+=a?-o:o;return u},e.prototype.__iterator=function(t,a){var i=this.size,o=this._step,s=a?this._start+(i-1)*o:this._start,u=0;return new rt(function(){if(u===i)return Cr();var l=s;return s+=a?-o:o,pt(t,a?i-++u:u++,l)})},e.prototype.equals=function(t){return t instanceof e?this._start===t._start&&this._end===t._end&&this._step===t._step:K(this,t)},e}(Ur),cr;function wo(n,e,r){for(var t=ws(e),a=0;a!==t.length;)if(n=Bn(n,t[a++],we),n===we)return r;return n}function Js(n,e){return wo(this,n,e)}function qc(n,e){return wo(n,e,we)!==we}function Qm(n){return qc(this,n)}function Hc(){Rr(this.size);var n={};return this.__iterate(function(e,r){n[r]=e}),n}At.isIterable=Lt,At.isKeyed=gt,At.isIndexed=lr,At.isAssociative=ba,At.isOrdered=qt,At.Iterator=rt,ae(At,{toArray:function(){Rr(this.size);var e=new Array(this.size||0),r=gt(this),t=0;return this.__iterate(function(a,i){e[t++]=r?[i,a]:a}),e},toIndexedSeq:function(){return new Ss(this)},toJS:function(){return de(this)},toKeyedSeq:function(){return new ui(this,!0)},toMap:function(){return yt(this.toKeyedSeq())},toObject:Hc,toOrderedMap:function(){return Wr(this.toKeyedSeq())},toOrderedSet:function(){return Oi(gt(this)?this.valueSeq():this)},toSet:function(){return me(gt(this)?this.valueSeq():this)},toSetSeq:function(){return new io(this)},toSeq:function(){return lr(this)?this.toIndexedSeq():gt(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return O(gt(this)?this.valueSeq():this)},toList:function(){return Jr(gt(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(e,r){return this.size===0?e+r:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+r},concat:function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return ht(this,tl(this,e))},includes:function(e){return this.some(function(r){return tr(r,e)})},entries:function(){return this.__iterator($r)},every:function(e,r){Rr(this.size);var t=!0;return this.__iterate(function(a,i,o){if(!e.call(r,a,i,o))return t=!1,!1}),t},filter:function(e,r){return ht(this,ci(this,e,r,!0))},partition:function(e,r){return Zu(this,e,r)},find:function(e,r,t){var a=this.findEntry(e,r);return a?a[1]:t},forEach:function(e,r){return Rr(this.size),this.__iterate(r?e.bind(r):e)},join:function(e){Rr(this.size),e=e!==void 0?""+e:",";var r="",t=!0;return this.__iterate(function(a){t?t=!1:r+=e,r+=a!=null?a.toString():""}),r},keys:function(){return this.__iterator(Oa)},map:function(e,r){return ht(this,Fs(this,e,r))},reduce:function(e,r,t){return Qc(this,e,r,t,arguments.length<2,!1)},reduceRight:function(e,r,t){return Qc(this,e,r,t,arguments.length<2,!0)},reverse:function(){return ht(this,oo(this,!0))},slice:function(e,r){return ht(this,uo(this,e,r,!0))},some:function(e,r){Rr(this.size);var t=!1;return this.__iterate(function(a,i,o){if(e.call(r,a,i,o))return t=!0,!1}),t},sort:function(e){return ht(this,Er(this,e))},values:function(){return this.__iterator(Hr)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(e,r){return Ze(e?this.toSeq().filter(e,r):this)},countBy:function(e,r){return so(this,e,r)},equals:function(e){return K(this,e)},entrySeq:function(){var e=this;if(e._cache)return new On(e._cache);var r=e.toSeq().map(Ym).toIndexedSeq();return r.fromEntrySeq=function(){return e.toSeq()},r},filterNot:function(e,r){return this.filter(hl(e),r)},findEntry:function(e,r,t){var a=t;return this.__iterate(function(i,o,s){if(e.call(r,i,o,s))return a=[o,i],!1}),a},findKey:function(e,r){var t=this.findEntry(e,r);return t&&t[0]},findLast:function(e,r,t){return this.toKeyedSeq().reverse().find(e,r,t)},findLastEntry:function(e,r,t){return this.toKeyedSeq().reverse().findEntry(e,r,t)},findLastKey:function(e,r){return this.toKeyedSeq().reverse().findKey(e,r)},first:function(e){return this.find(as,null,e)},flatMap:function(e,r){return ht(this,rl(this,e,r))},flatten:function(e){return ht(this,Es(this,e,!0))},fromEntrySeq:function(){return new Os(this)},get:function(e,r){return this.find(function(t,a){return tr(a,e)},void 0,r)},getIn:Js,groupBy:function(e,r){return Xu(this,e,r)},has:function(e){return this.get(e,we)!==we},hasIn:Qm,isSubset:function(e){return e=typeof e.includes=="function"?e:At(e),this.every(function(r){return e.includes(r)})},isSuperset:function(e){return e=typeof e.isSubset=="function"?e:At(e),e.isSubset(this)},keyOf:function(e){return this.findKey(function(r){return tr(r,e)})},keySeq:function(){return this.toSeq().map(Jm).toIndexedSeq()},last:function(e){return this.toSeq().reverse().first(e)},lastKeyOf:function(e){return this.toKeyedSeq().reverse().keyOf(e)},max:function(e){return wa(this,e)},maxBy:function(e,r){return wa(this,r,e)},min:function(e){return wa(this,e?Jc(e):Kc)},minBy:function(e,r){return wa(this,r?Jc(r):Kc,e)},rest:function(){return this.slice(1)},skip:function(e){return e===0?this:this.slice(Math.max(0,e))},skipLast:function(e){return e===0?this:this.slice(0,-Math.max(0,e))},skipWhile:function(e,r){return ht(this,Cs(this,e,r,!0))},skipUntil:function(e,r){return this.skipWhile(hl(e),r)},sortBy:function(e,r){return ht(this,Er(this,r,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return this.slice(-Math.max(0,e))},takeWhile:function(e,r){return ht(this,el(this,e,r))},takeUntil:function(e,r){return this.takeWhile(hl(e),r)},update:function(e){return e(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=Km(this))}});var wr=At.prototype;wr[ss]=!0,wr[ai]=wr.values,wr.toJSON=wr.toArray,wr.__toStringMapper=aa,wr.inspect=wr.toSource=function(){return this.toString()},wr.chain=wr.flatMap,wr.contains=wr.includes,ae(Gr,{flip:function(){return ht(this,li(this))},mapEntries:function(e,r){var t=this,a=0;return ht(this,this.toSeq().map(function(i,o){return e.call(r,[o,i],a++,t)}).fromEntrySeq())},mapKeys:function(e,r){var t=this;return ht(this,this.toSeq().flip().map(function(a,i){return e.call(r,a,i,t)}).flip())}});var Ao=Gr.prototype;Ao[qr]=!0,Ao[ai]=wr.entries,Ao.toJSON=Hc,Ao.__toStringMapper=function(n,e){return aa(e)+": "+aa(n)},ae(Vn,{toKeyedSeq:function(){return new ui(this,!1)},filter:function(e,r){return ht(this,ci(this,e,r,!1))},findIndex:function(e,r){var t=this.findEntry(e,r);return t?t[0]:-1},indexOf:function(e){var r=this.keyOf(e);return r===void 0?-1:r},lastIndexOf:function(e){var r=this.lastKeyOf(e);return r===void 0?-1:r},reverse:function(){return ht(this,oo(this,!1))},slice:function(e,r){return ht(this,uo(this,e,r,!1))},splice:function(e,r){var t=arguments.length;if(r=Math.max(r||0,0),t===0||t===2&&!r)return this;e=$t(e,e<0?this.count():this.size);var a=this.slice(0,e);return ht(this,t===1?a:a.concat(en(arguments,2),this.slice(e+r)))},findLastIndex:function(e,r){var t=this.findLastEntry(e,r);return t?t[0]:-1},first:function(e){return this.get(0,e)},flatten:function(e){return ht(this,Es(this,e,!1))},get:function(e,r){return e=Zr(this,e),e<0||this.size===1/0||this.size!==void 0&&e>this.size?r:this.find(function(t,a){return a===e},void 0,r)},has:function(e){return e=Zr(this,e),e>=0&&(this.size!==void 0?this.size===1/0||e<this.size:this.indexOf(e)!==-1)},interpose:function(e){return ht(this,nl(this,e))},interleave:function(){var e=[this].concat(en(arguments)),r=Aa(this.toSeq(),Ur.of,e),t=r.flatten(!0);return r.size&&(t.size=r.size*e.length),ht(this,t)},keySeq:function(){return Pt(0,this.size)},last:function(e){return this.get(-1,e)},skipWhile:function(e,r){return ht(this,Cs(this,e,r,!1))},zip:function(){var e=[this].concat(en(arguments));return ht(this,Aa(this,Yc,e))},zipAll:function(){var e=[this].concat(en(arguments));return ht(this,Aa(this,Yc,e,!0))},zipWith:function(e){var r=en(arguments);return r[0]=this,ht(this,Aa(this,e,r))}});var bi=Vn.prototype;bi[us]=!0,bi[ra]=!0,ae(ta,{get:function(e,r){return this.has(e)?e:r},includes:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}});var Si=ta.prototype;Si.has=wr.includes,Si.contains=Si.includes,Si.keys=Si.values,ae(cn,Ao),ae(Ur,bi),ae(Sn,Si);function Qc(n,e,r,t,a,i){return Rr(n.size),n.__iterate(function(o,s,u){a?(a=!1,r=o):r=e.call(t,r,o,s,u)},i),r}function Jm(n,e){return e}function Ym(n,e){return[e,n]}function hl(n){return function(){return!n.apply(this,arguments)}}function Jc(n){return function(){return-n.apply(this,arguments)}}function Yc(){return en(arguments)}function Kc(n,e){return n<e?1:n>e?-1:0}function Km(n){if(n.size===1/0)return 0;var e=qt(n),r=gt(n),t=e?1:0,a=n.__iterate(r?e?function(i,o){t=31*t+Xc(Lr(i),Lr(o))|0}:function(i,o){t=t+Xc(Lr(i),Lr(o))|0}:e?function(i){t=31*t+Lr(i)|0}:function(i){t=t+Lr(i)|0});return Xm(a,t)}function Xm(n,e){return e=Ca(e,3432918353),e=Ca(e<<15|e>>>-15,461845907),e=Ca(e<<13|e>>>-13,5),e=(e+3864292196|0)^n,e=Ca(e^e>>>16,2246822507),e=Ca(e^e>>>13,3266489909),e=eo(e^e>>>16),e}function Xc(n,e){return n^e+2654435769+(n<<6)+(n>>2)|0}var Oi=function(n){function e(r){return r==null?ml():Q(r)?r:ml().withMutations(function(t){var a=ta(r);Rr(a.size),a.forEach(function(i){return t.add(i)})})}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.of=function(){return this(arguments)},e.fromKeys=function(t){return this(Gr(t).keySeq())},e.prototype.toString=function(){return this.__toString("OrderedSet {","}")},e}(me);Oi.isOrderedSet=Q;var ka=Oi.prototype;ka[ra]=!0,ka.zip=bi.zip,ka.zipWith=bi.zipWith,ka.zipAll=bi.zipAll,ka.__empty=ml,ka.__make=Zc;function Zc(n,e){var r=Object.create(ka);return r.size=n?n.size:0,r._map=n,r.__ownerID=e,r}var ed;function ml(){return ed||(ed=Zc(Ma()))}var Zm={LeftThenRight:-1,RightThenLeft:1};function ey(n){if(kn(n))throw new Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.");if(gr(n))throw new Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.");if(n===null||typeof n!="object")throw new Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}var rr=function(e,r){var t;ey(e);var a=function(s){var u=this;if(s instanceof a)return s;if(!(this instanceof a))return new a(s);if(!t){t=!0;var l=Object.keys(e),c=i._indices={};i._name=r,i._keys=l,i._defaultValues=e;for(var d=0;d<l.length;d++){var f=l[d];c[f]=d,i[f]?typeof console=="object"&&console.warn&&console.warn("Cannot define "+bl(this)+' with property "'+f+'" since that property name is part of the Record API.'):ty(i,f)}}return this.__ownerID=void 0,this._values=Jr().withMutations(function(p){p.setSize(u._keys.length),Gr(s).forEach(function(g,h){p.set(u._indices[h],g===u._defaultValues[h]?void 0:g)})}),this},i=a.prototype=Object.create(Ft);return i.constructor=a,r&&(a.displayName=r),a};rr.prototype.toString=function(){for(var e=bl(this)+" { ",r=this._keys,t,a=0,i=r.length;a!==i;a++)t=r[a],e+=(a?", ":"")+t+": "+aa(this.get(t));return e+" }"},rr.prototype.equals=function(e){return this===e||kn(e)&&Fi(this).equals(Fi(e))},rr.prototype.hashCode=function(){return Fi(this).hashCode()},rr.prototype.has=function(e){return this._indices.hasOwnProperty(e)},rr.prototype.get=function(e,r){if(!this.has(e))return r;var t=this._indices[e],a=this._values.get(t);return a===void 0?this._defaultValues[e]:a},rr.prototype.set=function(e,r){if(this.has(e)){var t=this._values.set(this._indices[e],r===this._defaultValues[e]?void 0:r);if(t!==this._values&&!this.__ownerID)return yl(this,t)}return this},rr.prototype.remove=function(e){return this.set(e)},rr.prototype.clear=function(){var e=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:yl(this,e)},rr.prototype.wasAltered=function(){return this._values.wasAltered()},rr.prototype.toSeq=function(){return Fi(this)},rr.prototype.toJS=function(){return de(this)},rr.prototype.entries=function(){return this.__iterator($r)},rr.prototype.__iterator=function(e,r){return Fi(this).__iterator(e,r)},rr.prototype.__iterate=function(e,r){return Fi(this).__iterate(e,r)},rr.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var r=this._values.__ensureOwner(e);return e?yl(this,r,e):(this.__ownerID=e,this._values=r,this)},rr.isRecord=kn,rr.getDescriptiveName=bl;var Ft=rr.prototype;Ft[Mn]=!0,Ft[ma]=Ft.remove,Ft.deleteIn=Ft.removeIn=_a,Ft.getIn=Js,Ft.hasIn=wr.hasIn,Ft.merge=Rs,Ft.mergeWith=js,Ft.mergeIn=go,Ft.mergeDeep=Ps,Ft.mergeDeepWith=xa,Ft.mergeDeepIn=ho,Ft.setIn=gi,Ft.update=vo,Ft.updateIn=La,Ft.withMutations=Ia,Ft.asMutable=ia,Ft.asImmutable=Da,Ft[ai]=Ft.entries,Ft.toJSON=Ft.toObject=wr.toObject,Ft.inspect=Ft.toSource=function(){return this.toString()};function yl(n,e,r){var t=Object.create(Object.getPrototypeOf(n));return t._values=e,t.__ownerID=r,t}function bl(n){return n.constructor.displayName||n.constructor.name||"Record"}function Fi(n){return Ki(n._keys.map(function(e){return[e,n.get(e)]}))}function ty(n,e){try{Object.defineProperty(n,e,{get:function(){return this.get(e)},set:function(r){Un(this.__ownerID,"Cannot set on an immutable record."),this.set(e,r)}})}catch{}}var ry=function(n){function e(r,t){if(!(this instanceof e))return new e(r,t);if(this._value=r,this.size=t===void 0?1/0:Math.max(0,t),this.size===0){if(Sl)return Sl;Sl=this}}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},e.prototype.get=function(t,a){return this.has(t)?this._value:a},e.prototype.includes=function(t){return tr(this._value,t)},e.prototype.slice=function(t,a){var i=this.size;return ea(t,a,i)?this:new e(this._value,vr(a,i)-$t(t,i))},e.prototype.reverse=function(){return this},e.prototype.indexOf=function(t){return tr(this._value,t)?0:-1},e.prototype.lastIndexOf=function(t){return tr(this._value,t)?this.size:-1},e.prototype.__iterate=function(t,a){for(var i=this.size,o=0;o!==i&&t(this._value,a?i-++o:o++,this)!==!1;);return o},e.prototype.__iterator=function(t,a){var i=this,o=this.size,s=0;return new rt(function(){return s===o?Cr():pt(t,a?o-++s:s++,i._value)})},e.prototype.equals=function(t){return t instanceof e?tr(this._value,t._value):K(this,t)},e}(Ur),Sl;function la(n,e){return td([],e||ny,n,"",e&&e.length>2?[]:void 0,{"":n})}function td(n,e,r,t,a,i){if(typeof r!="string"&&!gr(r)&&(Ji(r)||Hi(r)||fo(r))){if(~n.indexOf(r))throw new TypeError("Cannot convert circular structure to Immutable");n.push(r),a&&t!==""&&a.push(t);var o=e.call(i,t,hr(r).map(function(s,u){return td(n,e,s,u,a,r)}),a&&a.slice());return n.pop(),a&&a.pop(),o}return r}function ny(n,e){return lr(e)?e.toList():gt(e)?e.toMap():e.toSet()}var ay="4.3.7",iy={version:ay,Collection:At,Iterable:At,Seq:hr,Map:yt,OrderedMap:Wr,List:Jr,Stack:O,Set:me,OrderedSet:Oi,PairSorting:Zm,Record:rr,Range:Pt,Repeat:ry,is:tr,fromJS:la,hash:Lr,isImmutable:gr,isCollection:Lt,isKeyed:gt,isIndexed:lr,isAssociative:ba,isOrdered:qt,isValueObject:fs,isPlainObject:fo,isSeq:ln,isList:Fo,isMap:si,isOrderedMap:ds,isStack:yi,isSet:k,isOrderedSet:Q,isRecord:kn,get:Bn,getIn:wo,has:jr,hasIn:qc,merge:Is,mergeDeep:il,mergeWith:Ds,mergeDeepWith:ol,remove:As,removeIn:Ls,set:Ts,setIn:vi,update:po,updateIn:Fn},Dw=null;const Ne=iy;var oy=0;const Tt=function(){var n=(new Date().getTime().toString(16)+"FF").substr(0,11),e="ssssssss-xxxx-4xxx-yxxx-x".replace(/[xys]/g,function(r){var t=r==="s"?Math.floor(Math.random()*16):oy++&15,a=r==="x"?t:t&3|8;return a.toString(16)});return e+n};var sy=$(1779),yr=$.n(sy),uy=$(95093),Ga=$.n(uy);function ly(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=cy(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function cy(n,e){if(n){if(typeof n=="string")return rd(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rd(n,e)}}function rd(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function nd(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function $a(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?nd(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):nd(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var Ua=["formatValue","mongoFormatValue","sqlFormatValue","jsonLogic","elasticSearchFormatValue","spelFormatValue","spelImportFuncs","spelImportValue"],Ci=["formatOp","mongoFormatOp","sqlFormatOp","jsonLogic","spelFormatOp"],dr=function(e){return(0,ft.A)(e)==="object"&&e!==null&&Object.prototype.toString.call(e)==="[object Object]"},ad=function(e){return(0,ft.A)(e)==="object"&&e!==null},Ei=function(e){var r=(0,ft.A)(e);return r&&e!==null&&Array.isArray(e)?"array":r},Ba=function(e,r){return Ei(e)===r||r==="number"&&!isNaN(e)},Wa=function(e){if((0,ft.A)(e)==="object"&&e!==null){if(Array.isArray(e))return(0,ue.A)(e);if(dr(e))return $a({},e)}return e},dy=function(e,r,t,a){var i,o={canCreate:!1,canIgnore:!1,canChangeType:!1};a=$a($a({},o),(i=a)!==null&&i!==void 0?i:{});var s=a,u=s.canCreate,l=s.canIgnore,c=s.canChangeType;if(!Array.isArray(r))throw new Error("path is not an array");if(!r.length)throw new Error("path is empty");var d=typeof r[0]=="number"?"array":"object";if(!Ba(e,d))throw new Error("obj is not of type ".concat(d));var f=Wa(e),p=f,g=(0,ue.A)(r),h=g.pop(),m=[],y=ly(g),S;try{for(y.s();!(S=y.n()).done;){var C=S.value,F=r[m.length],T=typeof F=="number"?"array":"object";if(!Ba(p[C],T))if(p[C]?c:u)p[C]=T==="array"?[]:{};else if(l){p=void 0,f=e;break}else throw new Error("Value by path ".concat(m.join(".")," should have type ").concat(T," but got ").concat(Ei(p[C])));m.push(C),p[C]=Wa(p[C]),p=p[C]}}catch(_){y.e(_)}finally{y.f()}if(p)if(t===void 0)delete p[h];else{var w=p[h];typeof t=="function"?p[h]=t(w):p[h]=t}return f},fy=function(e,r,t){var a,i={canCreate:!0,canChangeType:!0,deepCopyObj:!1,deepCopyMixin:!1,arrayMergeMode:"merge",circularRefs:!1,specialSymbols:!0};t=$a($a({},i),(a=t)!==null&&a!==void 0?a:{});var o=t,s=o.deepCopyObj,u=o.deepCopyMixin,l=o.circularRefs,c=o.specialSymbols;if(!Ba(e,"object"))throw new Error("obj is not an object");if(!Ba(r,"object"))throw new Error("mixin is not an object");var d=Symbol.for("_v"),f=Symbol.for("_type"),p=Symbol.for("_canCreate"),g=Symbol.for("_canChangeType"),h=Symbol.for("_arrayMergeMode"),m=s?yr()(e,l):Wa(e),y=!1,S=function C(F,T,w){var _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},M=_.isMixingArray,D=_.isMixingRealArray,j=0,P=function(){var U=M?Number(V)+j:V,B=c&&ad(T[V]),G=t.canCreate,W=t.canChangeType,z=t.arrayMergeMode,H=T[V],q=!1,J=Ei(H);if(B){var Y,Z,se,re,ee,Fe,pe;d in T[V]&&(q=!0,H=T[V][d]),J=((Y=T[V])===null||Y===void 0?void 0:Y[f])||Ei(H),G=(Z=(se=T[V])===null||se===void 0?void 0:se[p])!==null&&Z!==void 0?Z:G,W=(re=(ee=T[V])===null||ee===void 0?void 0:ee[g])!==null&&re!==void 0?re:W,z=(Fe=(pe=T[V])===null||pe===void 0?void 0:pe[h])!==null&&Fe!==void 0?Fe:z,J==="array"&&z==="overwrite"&&(q=!0)}if(J!=="array"&&(z=void 0),!Ba(w[U],J))if(w[U]?W:G)(J==="array"||J==="object")&&(w[U]=J==="array"?[]:{},y=!0);else return 1;if(J==="array"||J==="object")if(q)y=!0,w[U]=u?yr()(H,l):Wa(H);else if(z&&["join","joinMissing","joinRespectOrder"].includes(z)){y=!0;var oe=s?w[U]:yr()(w[U],l),Se=u?yr()(H,l):H;z==="joinRespectOrder"?w[U]=Lo(oe,Se):(z==="joinMissing"&&(Se=Se.filter(function(Ae){return!oe.includes(Ae)})),w[U]=[].concat((0,ue.A)(oe),(0,ue.A)(Se)))}else{var he;s||(w[U]=Wa(w[U])),C([].concat((0,ue.A)(F),[V]),H,w[U],{isMixingArray:J==="array",isMixingRealArray:J==="array"&&!((he=T[V])!==null&&he!==void 0&&he[f])})}else{var be=H===void 0&&!D&&!q,Le=U in w;be?Le&&(y=!0,Array.isArray(w)?(w.splice(U,1),j--):delete w[U]):(y=!0,w[U]=H)}};for(var V in T)P()};return S([],r,m),y?m:e},Yr=function(e,r){return Object.fromEntries(Object.entries(e).filter(function(t){var a=(0,ve.A)(t,1),i=a[0];return!r.includes(i)}))},Jt=function(e){var r;return(r=e?.cardinality)!==null&&r!==void 0?r:1},Ys=function(e,r){return e===r?!0:yt.isMap(e)?e.equals(r):JSON.stringify(e)==JSON.stringify(r)},To=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e===r?!0:Array.isArray(e)?py(e,r,t):yt.isMap(e)?e.equals(r):(0,ft.A)(e)=="object"?vy(e,r,t):e===r};function py(n,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(n===e)return!0;if(!n||!e)return!1;var t=n.length;if(e.length!==t)return!1;for(var a=0;a<t;a++){var i=r?To(n[a],e[a],r):n[a]===e[a];if(!i)return!1}return!0}function vy(n,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(n===e)return!0;if(!n||!e)return!1;var t=Object.keys(n),a=Object.keys(e),i=t.length;if(a.length!==i)return!1;for(var o=0;o<i;o++){var s=t[o],u=r?To(n[s],e[s],r):n[s]===e[s];if(!u)return!1}return!0}var wi=function(e){return(0,ft.A)(e)==="object"&&e!==null&&typeof e.toJS=="function"},Ks=function(e){return wi(e)&&Ne.isList(e)};function Yt(n){return Ks(n)?n:new Ne.List(n)}function Ol(n){return wi(n)?n.toJS():n}var id=function(e){return e.replace(/[.*+?^${}()|[\]\\/]/g,"\\$&")},od=function(e,r,t,a,i,o){if(Array.isArray(e))return r},Fl=function n(e){var r=["$$typeof","_owner","_store","ref","key"],t=function(s){return typeof s=="string"?s:typeof s=="function"?s.name:s};if(e instanceof Array)return e.map(function(o,s){return n(o)});if((0,ft.A)(e)==="object"&&e!==null&&_o(e)){var a,i=Yr(e,r);return i.type&&(i.type=t(i.type)),i!=null&&(a=i.props)!==null&&a!==void 0&&a.children&&(i.props.children=n(i.props.children)),i}return e},_o=function(e){return(0,ft.A)(e)==="object"&&e!==null&&!Array.isArray(e)&&Object.keys(e).includes("type")&&Object.keys(e).includes("props")&&Object.keys(e).includes("key")&&Object.keys(e).includes("ref")&&Object.keys(e).includes("$$typeof")},Cl=function(e){return(0,ft.A)(e)==="object"&&e!==null&&!Array.isArray(e)&&typeof e.type=="string"&&Object.keys(e).includes("props")},Ir=function(e){var r=(0,ft.A)(e)==="object"&&e!==null&&!Array.isArray(e)&&Object.keys(e).length===1;return r};function sd(n){return new Promise(function(e){setTimeout(e,n)})}function Lo(n,e){return n||(n=[]),e||(e=[]),e.map(function(r){return[r,n.indexOf(r)]}).map(function(r,t,a){var i=(0,ve.A)(r,2),o=i[0],s=i[1];if(s==-1){var u=a.slice(t+1),l=a.slice(0,t),c=(0,ue.A)(l).reverse().find(function(h){var m=(0,ve.A)(h,2),y=m[0],S=m[1];return S!=-1}),d=l[l.length-1],f=u.find(function(h){var m=(0,ve.A)(h,2),y=m[0],S=m[1];return S!=-1}),p=c&&c===l[l.length-1],g=f&&u===u[0];return p?[o,"after",c[0]]:g?[o,"before",f[0]]:c?d?[o,"after",d[0]]:[o,"after",c[0]]:f?[o,"before",f[0]]:[o,"append",null]}else return null}).filter(function(r){return r!==null}).reduce(function(r,t){var a=(0,ve.A)(t,3),i=a[0],o=a[1],s=a[2],u=r.indexOf(s);if(r.indexOf(i)===-1)if(u>-1){var l=o==="after"?1:0;r.splice(u+l,0,i)}else r.splice(o==="append"?1/0:0,0,i);return r},n.slice())}var ud=function n(e){(0,ft.A)(e)==="object"&&e!==null&&!_o(e)&&(Object.keys(e).forEach(function(r){r!=="__cache"&&n(e[r])}),Object.freeze(e))},gy=function n(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(dr(e)){if(e.var)return t[e.var]=r,!0;if(!dr(r))return!1;for(var i in e){var o=e[i],s=r[i];if(!n(o,s,t,[].concat((0,ue.A)(a),[i])))return!1}return!0}else if(Array.isArray(e)){if(!Array.isArray(r))return!1;for(var u=0;u<e.length;u++){var l=e[u],c=r[u];if(!n(l,c,t,[].concat((0,ue.A)(a),[u])))return!1}return!0}else return e===r},hy=function(){var e;return typeof process<"u"&&((e=process)===null||e===void 0||(e=e.env)===null||e===void 0?void 0:"production")=="development"},my=function(){var e;return typeof process<"u"&&((e=process)===null||e===void 0||(e=e.env)===null||e===void 0?void 0:e.NODE_ENV_TEST)=="true"},ld=function(e){if(my())return $a($a({},console),{},{log:function(){},debug:function(){},info:function(){}});var r=e??hy();return r?console:{error:function(){},log:function(){},warn:function(){},debug:function(){},info:function(){}}},cd=function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r,t=0;t<e.length;t++){var a=e[t];if(a!==void 0){r=a;break}}return r},Ro=ld(),yy=$(54756),Hn=$.n(yy),by=$(44383),wn=$.n(by);function dd(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function za(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?dd(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):dd(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var Sy=Hn().mark(jo),Oy=Hn().mark(fd),Fy=Ua,An=["conjunctions","fields","types","operators","widgets","settings","funcs","ctx"],Xs=["select","multiselect","treeselect","treemultiselect"];function jo(n){return Hn().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.delegateYield(El(n,n.funcs||{},[]),"t0",1);case 1:case"end":return r.stop()}},Sy)}function fd(n){return Hn().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.delegateYield(El(n,n.fields||{},[]),"t0",1);case 1:case"end":return r.stop()}},Oy)}function El(n,e,r){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"subfields";return Hn().mark(function a(i){var o,s,u;return Hn().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:o=(n==null||(i=n.settings)===null||i===void 0?void 0:i.fieldSeparator)||".",c.t0=Hn().keys(e);case 2:if((c.t1=c.t0()).done){c.next=13;break}if(s=c.t1.value,u=e[s],!u[t]){c.next=9;break}return c.delegateYield(El(n,u[t],[].concat((0,ue.A)(r),[s]),t),"t2",7);case 7:c.next=11;break;case 9:return c.next=11,[[].concat((0,ue.A)(r),[s]).join(o),u,s];case 11:c.next=2;break;case 13:case"end":return c.stop()}},a)})()}var vn=function(e,r){var t,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"fields",i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"subfields";if(!r)return null;if(r==="!case_value"){var o;return e==null||(o=e.settings)===null||o===void 0?void 0:o.caseValueField}var s=(e==null||(t=e.settings)===null||t===void 0?void 0:t.fieldSeparator)||".",u=Ut(r,e),l=e[a];if(!l)return null;for(var c=l,d=null,f=[],p=0;p<u.length;p++){var g=u[p];f.push(g);var h=f.join(s);d=c[h],p<u.length-1&&(d&&d[i]?(c=d[i],f=[]):d=null)}return d},pd=function(e,r){var t,a,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,o=e.settings.fieldSeparator,s=[i].concat((0,ue.A)(r.split(o))).filter(function(c){return c!=null}),u=r,l=(t=e.__fieldNames[u])===null||t===void 0||(a=t.find)===null||a===void 0||(a=a.call(t,function(c){var d=c.inGroup;return d?i?.startsWith(d):!0}))===null||a===void 0?void 0:a.fullPath;return(l||s).join(o)},wl=function(e,r){if(!r)return null;var t=vn(e,r,"funcs","subfields");if(!t)return null;var a=t.returnType,i=t.args,o=Object.fromEntries(Object.entries(i||{}).map(function(u){var l=(0,ve.A)(u,2),c=l[0],d=l[1],f=wn()(d,["type","valueSources","defaultValue","fieldSettings","isOptional","_funcKey","_argKey","_isFuncArg"]);return[c,f]})),s={returnType:a,args:o};return s},nr=function(e,r){if(!r)return null;var t=vn(e,r,"funcs","subfields");return t||null},Zs=function(e,r,t){var a=nr(e,r);if(!a)return null;var i=a.args&&a.args[t]||null;return i||null},vd=function(e,r){var t,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!r)return!1;var i=(a==null||(t=a.settings)===null||t===void 0?void 0:t.fieldSeparator)||".",o=Tn(e,a),s=Tn(r,a);return o.startsWith(s+i)},Tn=function(e){var r,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof e=="string")return e;var a=(t==null||(r=t.settings)===null||r===void 0?void 0:r.fieldSeparator)||".";return Ut(e,t).join(a)},Ut=function(e){var r,t,a,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!e)return[];if(Array.isArray(e))return e;var o=(i==null||(r=i.settings)===null||r===void 0?void 0:r.fieldSeparator)||".";if(e!=null&&e.func)return Array.isArray(e.func)?e.func:e.func.split(o);if(e!=null&&(t=e.get)!==null&&t!==void 0&&t.call(e,"func")){var s;return e==null||(s=e.get)===null||s===void 0?void 0:s.call(e,"func").split(o)}return(e==null||(a=e.split)===null||a===void 0?void 0:a.call(e,o))||[]},Cy=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!e)return null;var a=r.settings.fieldSeparator,i=Ut(e,r);return t?i:i.map(function(o,s,u){return u.slice(0,s+1)}).map(function(o){return o.join(a)})},eu=function(e){var r;if(typeof e=="string"||Array.isArray(e))return"field:".concat(Tn(e));if((0,ft.A)(e)==="object"&&e){if(e._funcKey&&e._argKey)return"arg:".concat(Tn(e._funcKey),"__").concat(e._argKey);if(e._funcKey)return"func:".concat(Tn(e._funcKey));if(e.func&&e.arg)return"arg:".concat(Tn(e.func),"__").concat(e.arg);if(e.func)return"func:".concat(Tn(e.func));if(e.type)return null}return e!=null&&(r=e.get)!==null&&r!==void 0&&r.call(e,"func")?e!=null&&e.get("arg")?"arg:".concat(Tn(e.get("func")),"__").concat(e.get("arg")):"func:".concat(Tn(e.get("func"))):null},tu=function(e,r,t){var a;return(a=e.__cache)===null||a===void 0||(a=a[r])===null||a===void 0?void 0:a[t]},ru=function(e,r,t,a){!e.__cache||!t||(e.__cache[r]||(e.__cache[r]={}),e.__cache[r][t]=a)},gd=function(e){var r;if(!e)return null;if((0,ft.A)(e)==="object"){if(!e.func&&e.type)return"field";if(e.func)return e.func&&e.arg?null:"func"}return e!=null&&(r=e.get)!==null&&r!==void 0&&r.call(e,"func")?e!=null&&e.get("arg")?null:"func":"field"},_e=function(e,r){var t;if(!r)return null;if((0,ft.A)(r)=="object"){if(!r.func&&r.type&&r.widgets)return r;if(r._isFuncArg)return Zs(e,r._funcKey,r._argKey);if(r._isFunc)return nr(e,r._funcKey);if(r.func)return r.func&&r.arg?Zs(e,r.func,r.arg):nr(e,r.func)}if(r!=null&&(t=r.get)!==null&&t!==void 0&&t.call(r,"func"))return r!=null&&r.get("arg")?Zs(e,r.get("func"),r.get("arg")):nr(e,r.get("func"));var a=vn(e,r);return a||null},st=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!r)return null;var a=e.operators[r];if(t){var i,o,s=eu(t),u=s?"".concat(s,"__").concat(r):null,l=tu(e,"getOperatorConfig",u);if(l)return l;var c=_e(e,t),d=Nt(e,t,r,null),f=e.widgets[d]||{},p=(c&&c.widgets?c.widgets[d]:{})||{},g=((i=f.opProps)===null||i===void 0?void 0:i[r])||{},h=((o=p.opProps)===null||o===void 0?void 0:o[r])||{},m=za(za(za({},a),g),h);return ru(e,"getOperatorConfig",u,m),m}else return a},br=function(e,r){var t,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(!r)return null;var u=_e(e,r),l=eu(r);i||(i=Nt(e,r,a,o));var c=l?"".concat(l,"__").concat(a,"__").concat(i,"__").concat(o):null,d=tu(e,"getFieldWidgetConfig",c);if(d)return d;var f=e.widgets[i]||{},p=(u==null||(t=u.widgets)===null||t===void 0?void 0:t[i])||{},g=p.widgetProps||{},h=o==="value"||!o?u?.fieldSettings:{},m=za(za(za(za({},f),p),g),h);return ru(e,"getFieldWidgetConfig",c,m),s.forExport&&(m=Yr(m,"factory")),m},hd=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=e.settings.fieldSeparator,a=Ut(r,e),i=r?vn(e,r):e,o=i,s=null,u=[];do{var l,c=o===e?e.fields:(l=o)===null||l===void 0?void 0:l.subfields;if(!c||!Object.keys(c).length){o=s=null;break}s=Object.keys(c)[0],u.push(s),o=c[s]}while(o.type=="!struct"||o.type=="!group");return(a||[]).concat(u).join(t)};function nu(n,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a=[],i=[];if(!e)return{widgets:a,valueSrcs:i};var o=eu(e),s=o?"".concat(o,"__").concat(r,"__").concat(t):null,u=tu(n,"_getWidgetsAndSrcsForFieldOp",s);if(u)return u;var l=(0,ft.A)(e)==="object"&&(!!e.func&&!!e.arg||e._isFuncArg),c=_e(n,e),d=r?n.operators[r]:null;if(c!=null&&c.widgets){var f=function(){var y=c.widgets[p];if(!n.widgets[p])return 1;var S=n.widgets[p].valueSrc||"value",C=!0;if(p==="field"&&(C=C&&qa(n,["field"],c,r).length>0),p==="func"&&(C=C&&qa(n,["func"],c,r).length>0),t==="value"&&!y.operators&&!l&&e!=="!case_value"&&(C=!1),y.operators&&r&&(C=C&&y.operators.indexOf(r)!=-1),t&&t!=S&&t!=="const"&&(C=!1),d&&d.cardinality==0&&S!=="value"&&(C=!1),C){var F,T;a.push(p);var w=((F=c.valueSources)===null||F===void 0?void 0:F.indexOf(S))!=-1;(d==null||(T=d.valueSources)===null||T===void 0?void 0:T.indexOf(S))==-1&&(w=!1),w&&!i.find(function(_){return _==S})&&i.push(S)}};for(var p in c.widgets)f()}var g=function(y){var S=0;return c.preferWidgets?c.preferWidgets.includes(y)&&(S+=10-c.preferWidgets.indexOf(y)):y==c.mainWidget&&(S+=100),y==="field"&&(S-=1),y==="func"&&(S-=2),S};a.sort(function(m,y){return g(y)-g(m)});var h={widgets:a,valueSrcs:i};return ru(n,"_getWidgetsAndSrcsForFieldOp",s,h),h}var qa=function(e,r,t){var a,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!t)return r;var o=(a=t.type)!==null&&a!==void 0?a:t.returnType;o==="!group"&&(o="number");var s=!1;if(i){var u=e.operators[i];u.valueTypes&&(o=u.valueTypes[0],s=!0)}return r||(r=Object.keys(e.settings.valueSourcesInfo)),r.filter(function(l){var c=!0;if(l==="field"&&e.__fieldsCntByType){var d=t._isFuncArg||s?0:1;c=c&&e.__fieldsCntByType[o]>d}return l==="func"&&(t.funcs&&(c=c&&t.funcs.length>0),e.__funcsCntByType&&(c=c&&e.__funcsCntByType[o]>0)),c})},Nt=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=nu(e,r,t,a),o=i.widgets,s=null;return o.length&&(s=o[0]),s},md=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=nu(e,r,t,null),o=i.valueSrcs,s=qa(e,o,a,t);return s},Ey=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=nu(e,r,t,a),o=i.widgets;return o},yd=function(e,r){var t;return((t=e.types[r])===null||t===void 0?void 0:t.operators)||null},au=function(e,r){var t=_e(e,r),a=t?t.operators:[];return a},Al=function(e,r){var t,a=au(e,r);return(t=a?.[0])!==null&&t!==void 0?t:null},bd=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!e)return null;var a=t&&vn(r,t)||null,i=r.settings.fieldSeparator,o=Ut(e,r),s=vd(e,t,r),u=s?Ut(t,r):[];return o.slice(u.length).map(function(l,c,d){return d.slice(0,c+1)}).map(function(l){return{part:[].concat((0,ue.A)(u),(0,ue.A)(l)).join(i),key:l[l.length-1]}}).map(function(l){var c=l.part,d=l.key,f=vn(r,c);return{key:d,cnf:f}}).map(function(l,c,d){var f=l.key,p=l.cnf,g=c>0?d[c-1].cnf:a;return[f,p,g]})},fe=function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),a=1;a<r;a++)t[a-1]=arguments[a];return e.interpose("children1").withMutations(function(i){return i.skip(1),i.push.apply(i,t),i})},Tl=function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),a=1;a<r;a++)t[a-1]=arguments[a];return e.interpose("children1").withMutations(function(i){return i.push.apply(i,t),i})},ca=function(e,r){var t=new Ne.OrderedMap((0,X.A)({},e.get("id"),e)),a=e;return r.forEach(function(i){var o,s;a=(o=t)===null||o===void 0?void 0:o.get(i),t=(s=a)===null||s===void 0?void 0:s.get("children1")}),a},_l=function(e,r){var t=r.map(function(a,i){return r.take(i+1)}).reverse().toJS().map(function(a){return{item:ca(e,a),path:a}}).filter(function(a){var i=a.item;return i?.get("type")==="rule_group"});return t.length?t.map(function(a){var i=a.item,o=a.path;return{path:o,field:i.get("properties").get("field")}}):[]},Sd=function(e){var r=e;function t(a,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=i.push(a.get("id")),u=a.getIn(["properties","isLocked"]);o&&u&&(r=r.deleteIn(fe(s,"properties","isLocked")));var l=a.get("children1");l&&l.map(function(c,d){t(c,s,u||o)})}return t(e,new Ne.List),r},gn=function(e){var r=e;function t(a,i,o,s){if(a){var u=a.get("path"),l=a.get("id"),c=l||s||Tt(),d=i.push(c);(!u||!u.equals(d))&&(r=r.setIn(fe(d,"path"),d)),l||(r=r.setIn(fe(d,"id"),c));var f=a.get("children1");f&&(f.constructor.name==="Map"&&(r=r.setIn(fe(d,"children1"),new Ne.OrderedMap(f))),f.map(function(p,g){t(p,d,o+1,g)}))}}return t(e,new Ne.List,0),r},iu=function(e){var r=e;function t(a,i,o,s){if(!a)return!1;var u=a.get("id")||s,l=i.push(u),c=a.get("children1");if(c){var d=c.map(function(f,p){return t(f,l,o+1,p)}).reduce(function(f,p){return f&&p},!0);if((c.size==0||d)&&o>0)return r=r.deleteIn(fe(l)),!0}return!1}return t(e,new Ne.List,0),r},Ll=function(e,r){var t=[],a={},i=[],o=0,s=0,u=0,l=0,c={};function d(m,y,S,C,F,T,w,_,M){var D,j,P,V=m===e,L=m.get("type"),U=m.get("collapsed"),B=m.get("id"),G=m.get("children1"),W=m.getIn(["properties","isLocked"]),z=G?G.map(function(Ht,Xt){return Xt}).valueSeq().toArray():null,H=L==="rule_group",q=L==="rule",J=L==="group",Y=L==="case_group",Z=!F&&(!G||H),se=z?.length>0,re=y.length?y[y.length-1]:null,ee=(0,ue.A)(y).reverse().find(function(Ht){return a[Ht].type=="rule_group"}),Fe=m.getIn(["properties","field"]),pe=Fe&&r&&_e(r,Fe),oe=pe?pe?.canRegroup!==!1:void 0,Se=pe?.maxNesting,he=a==null||(D=a[ee])===null||D===void 0?void 0:D.canRegroup,be=a==null||(j=a[ee])===null||j===void 0?void 0:j.maxNesting,Le=a==null||(P=a[ee])===null||P===void 0?void 0:P.lev,Ae=Y?B:_;Y&&(i.push(B),s=0,u=0,l=0,c={});var ke=Ae?i.indexOf(Ae):null,Ve=t.length,Re=o,Ce;V||(Ce={},Ce.caseNo=ke,Ce.globalNoByType=Y?ke:c[L]||0,Ce.indexPath=[].concat((0,ue.A)(y.slice(1).map(function(Ht){return a[Ht].childNo})),[M]),q?Ce.globalLeafNo=s:J&&(Ce.globalGroupNo=l));var jt=F||H?w:w+1;t.push(B),a[B]={node:m,index:Ve,id:B,type:L,parent:re,children:z,childNo:M,caseId:Ae,caseNo:ke,closestRuleGroupId:ee,closestRuleGroupLev:Le,closestRuleGroupMaxNesting:be,closestRuleGroupCanRegroup:he,maxNesting:Se,canRegroup:oe,path:y.concat(B),lev:T,atomicLev:w,nextAtomicLev:jt,isLeaf:!G,isAtomicRule:Z,isLocked:W||C,top:S?null:Re,isDefaultCase:Y?!G:void 0,atomicRulesCountInCase:Y?0:void 0,position:Ce,collapsed:U,_top:Ve,parentType:re?a[re].type:null,leaf:!G};var ot=0,mt=0;S||(o+=1,ot+=1,se&&!U&&!H&&(mt+=1),!V&&!Y&&(J&&l++,Z&&u++,q&&s++,c[L]=(c[L]||0)+1)),_&&Z&&a[_].atomicRulesCountInCase++;var Ue=0,Mt=0;if(se){var kt=0;G.map(function(Ht,Xt){if(Ht){d(Ht,y.concat(B),S||U,C||W,F||H,T+1,jt,Ae,kt);var Zt=a[Xt];Ue=Math.max(Ue,Zt.depth||0),Mt+=Zt.height,kt++}})}ot+=Mt,mt+=Ue;var ir=t.length,xt=ir-Ve,Xe=S?null:Re+ot;Object.assign(a[B],{depth:G?mt:void 0,_height:xt,height:ot,bottom:Xe})}d(e,[],!1,!1,!1,0,0,null,null);for(var f=0;f<t.length;f++){var p=f>0?t[f-1]:null,g=f<t.length-1?t[f+1]:null,h=a[t[f]];h.prev=p,h.next=g}return{flat:t,items:a,cases:i}},wy=function(e){if(!e)return-1;var r=0;function t(a,i,o){var s,u,l;typeof a.get=="function"?(s=a.get("id"),u=a.get("children1"),l=a.get("type")):(s=a.id,u=a.children1,l=a.type),r++,l=="rule_group"&&o>0||u&&u.map(function(c,d){c&&t(c,i.concat(s),o+1)})}return t(e,[],0),r-1},ou=function(e){if(!e)return-1;var r=0;function t(a,i,o){var s,u,l;typeof a.get=="function"?(s=a.get("id"),u=a.get("children1"),l=a.get("type")):(s=a.id,u=a.children1,l=a.type),l=="rule"||l=="rule_group"&&o>0?r++:u&&u.map(function(c,d){c&&t(c,i.concat(s),o+1)})}return t(e,[],0),r},Od=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=e;function i(o,s){r&&o.path&&delete o.path,r&&!t&&s&&delete o.id;var u=o.properties;u&&u.operatorOptions==null&&delete u.operatorOptions;var l=o.children1;if(l){for(var c in l)l[c]&&i(l[c],c);t&&(o.children1=Object.values(l))}}return i(e,null),a},Fd=function(e){var r=[],t=e.get("children1");return t&&t.map(function(a){var i=a.getIn(["properties","value"]),o;i&&i.size==1?(o=i.get(0),Array.isArray(o)&&o.length==0&&(o=null)):o=null,r=[].concat((0,ue.A)(r),[o])}),r},Rl=function(e){return!e.get("children1")||e.get("children1").size==0},jl=function(e,r){return e.getIn(fe(r,"children1")).size>0},xl=function(e){if(e!=null&&e.toJS){var r,t=e==null||(r=e.toJS)===null||r===void 0?void 0:r.call(e);return t!=null&&t.func?e.toOrderedMap():t}else return e};function Ai(n){var e=la(n,function(r,t,a){var i=a&&a.length>3&&a[a.length-1]==="value"&&a[a.length-3]==="args",o=a&&a.length>3&&a[a.length-1]==="value"&&a[a.length-2]==="properties",s;if(r=="properties"){s=t.toOrderedMap();for(var u=0;u<2;u++){var l,c,d;((l=s.get("value"))===null||l===void 0||(c=(d=l).get)===null||c===void 0?void 0:c.call(d,u))===null&&(s=s.setIn(["value",u],void 0))}}else i?s=xl(t):(a?o:r=="value")&&Ne.Iterable.isIndexed(t)?s=t.map(xl).toList():r=="asyncListValues"?s=t.toJS():r=="children1"&&Ne.Iterable.isIndexed(t)?s=new Ne.OrderedMap(t.map(function(f){return[f?.get("id")||Tt(),f]})):s=Ne.Iterable.isIndexed(t)?t.toList():t.toOrderedMap();return s});return e}var da=function(e){return fa(e)},xo=function(e,r,t){var a=r?st(e,r,t):null;return a&&a.options?new Ne.Map(a.options&&a.options.defaults||{}):null},fa=function(e){var r,t,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;a=_e(e,a);var i=((r=a)===null||r===void 0?void 0:r.conjunctions)||Object.keys(e.conjunctions);return i.length==1?i[0]:((t=a)===null||t===void 0?void 0:t.defaultConjunction)||e.settings.defaultConjunction||e.settings.defaultGroupConjunction||i[0]},pa=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return new Ne.Map({conjunction:fa(e,r),not:!1})},Cd=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=e.settings.defaultField,i=(t?Ed(e,t):a)||r&&hd(e,t)||null;return i!=null&&typeof i!="string"&&!wi(i)&&(i=Ai(i)),i},Ed=function(e){var r,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!t)return null;var a=(e==null||(r=e.settings)===null||r===void 0?void 0:r.fieldSeparator)||".",i=_e(e,t),o=i?.defaultField;return o&&(o=[].concat((0,ue.A)(Ut(t)),[o]).join(a)),o},Il=function(e){var r,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return t&&((r=e.settings.fieldSources)===null||r===void 0?void 0:r[0])||"field"},Dl=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=_e(e,r),i=a?.operators||[],o=e.settings.defaultOperator;o&&!i.includes(o)&&(o=null);var s=a?.defaultOperator,u=a?.ownDefaultOperator,l=t?Al(e,r):null,c=u||o||s||l;return c},Ay=function(e){return Ks(e)?e:wd([e])},wd=function(e){return Ks(e)?e:new Ne.List(e)},Ty=function(){return new Ne.Map},_y=$(68090),su=$.n(_y),Ad=function(e,r,t){var a=null;if(e){if(r==="field"){var i=_e(t,e);i&&(a=i.type)}else if(r==="func"){var o=e.get("func");if(o){var s=nr(t,o);s&&(a=s.returnType||s.type)}}}return a},Ly=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return Io(e,r,t,"funcs","subfields")},Io=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"fields",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"subfields";if(!e)return null;var o=r.settings.fieldSeparator,s=Ut(e,r),u=Ut(t,r),l=s.slice(u.length).map(function(c,d,f){return f.slice(0,d+1)}).map(function(c){return[].concat((0,ue.A)(u),(0,ue.A)(c)).join(o)}).map(function(c){var d=vn(r,c,a,i);return d&&d.label||su()(c.split(o))}).filter(function(c){return c!=null});return l},Ry=function(e,r,t,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,s=br(e,r,t,null,i)||{},u=st(e,t,r)||{},l=o?1:u.cardinality,c=null;if(l>1){var d=s.valueLabels||u.valueLabels;d&&(c=d[a]),c&&(0,ft.A)(c)!=="object"&&(c={label:c,placeholder:c}),c||(c={label:e.settings.valueLabel+" "+(a+1),placeholder:e.settings.valuePlaceholder+" "+(a+1)})}else{var f=s.valueLabel,p=s.valuePlaceholder;c={label:f||e.settings.valueLabel,placeholder:p||e.settings.valuePlaceholder}}return c},Qn=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};if(e){var o=_e(r,e)||{},s=r.settings.fieldSeparator,u=Ut(e,r),l=Array.isArray(e)?e.join(s):e;if(i!=null&&i.useTableName&&o.tableName){var c=(0,ue.A)(u);c[0]=o.tableName,l=c.join(s)}if(o.fieldName&&(l=o.fieldName),a){var d=_e(r,a)||{},f=a;l.indexOf(f+s)==0?l=l.slice((f+s).length):o.fieldName||t.errors.push("Can't cut group ".concat(f," from field ").concat(l))}return l}},Pl=function(e,r){var t=e.get("type"),a=e.getIn(["properties","mode"]);return t=="rule_group"&&a=="array"?jy(e,r):t=="group"||t=="rule_group"?xy(e,r):Iy(e,r)},jy=function(e,r){var t=e.get("children1"),a=e.get("properties");return Td(a.toObject(),t,r)},Td=function(e,r,t){var a,i,o=e.operator,s=(a=(i=t.operators[o])===null||i===void 0?void 0:i.cardinality)!==null&&a!==void 0?a:1,u=s==0,l={group:!Vl(e,t),children:!Nl(r,t)},c=l.group&&(u?l.children:!0);return!c},xy=function(e,r){var t=e.get("children1");return Nl(t,r)},Nl=function(e,r){var t=e?.size>0&&e.filter(function(a){return!Pl(a,r)}).size>0;return!t},Iy=function(e,r){var t=e.get("properties");return Vl(t?.toObject()||{},r)},Vl=function(e,r){var t=!0,a=3,i=Ml(e,r,t),o=i.score>=a;return!o},Ml=function(e,r){var t,a,i,o=e.field,s=e.fieldSrc,u=e.fieldType,l=e.operator,c=e.value,d=e.valueSrc,f=e.valueType,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,g=(t=(a=r.operators[l])===null||a===void 0?void 0:a.cardinality)!==null&&t!==void 0?t:1,h=d!=null&&d.get?d.toJS():d,m={parts:{},score:0};if(m.parts.field=p?o!=null:uu(o,s,r),m.parts.operator=!!l,m.parts.value=(c==null||(i=c.filter(function(S,C){return uu(S,h?.[C],r,p)}))===null||i===void 0?void 0:i.size)>=(p?Math.min(g,1):g),m.score=Object.keys(m.parts).filter(function(S){return!!m.parts[S]}).length,p&&m.score<3){var y=!0;!m.parts.value&&s==="func"&&uu(o,s,r,!1,y)&&m.score++,m.parts.field||c?.map(function(S,C){h?.[C]==="func"&&uu(S,h?.[C],r,!1,y)&&m.score++})}return m},uu=function n(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;if(!a&&r=="func"&&e){var o,s=(o=e.get)===null||o===void 0?void 0:o.call(e,"func"),u=nr(t,s);if(u){var l=e.get("args");for(var c in u.args){var d=u.args[c],f=l?l.get(c):void 0,p=f?f.get("value"):void 0,g=f?f.get("valueSrc"):void 0;if(p==null&&d?.defaultValue===void 0&&!(d!=null&&d.isOptional)||p!=null&&!n(p,g,t,i?a:!0))return!1}return!0}}return e!=null},Ha=function(e,r,t){return r=="func"?_d(e,t):e},_d=function(e,r){if(e){var t=e.get("func"),a=t&&nr(r,t);if(a){var i=e,o=!1;for(var s in a.args){var u=a.args[s],l=u.valueSources,c=u.isOptional,d=u.defaultValue,f=qa(r,l,u),p=i.get("args"),g=f.length==1?f[0]:void 0,h=p?p.get(s):void 0,m=h?h.get("value"):void 0,y=(h?h.get("valueSrc"):void 0)||g;if(m!==void 0){var S=Ha(m,y,r);if(S===void 0||(S!==m&&(i=i.setIn(["args",s,"value"],S)),o))return}else if(d!==void 0&&!dr(d))i=i.setIn(["args",s,"value"],lu(u)),i=i.setIn(["args",s,"valueSrc"],"value");else if(c)o=!0;else return}return i}}},kl=function n(e){var r=e.get("children1");if(r?.size==1){var t=r.first(),a=t.get("type");return a==="group"?n(t):t}return null},lu=function(e){var r=e.defaultValue;return dr(r)&&!Ne.Map.isMap(r)&&r.func?Ne.fromJS(r,function(t,a){return Ne.Iterable.isIndexed(a)?a.toList():a.toOrderedMap()}):r},cu=function(e,r,t,a,i){if(e&&e.get("func")){e=e.setIn(["args",r,"value"],t);var o=e.getIn(["args",r,"valueSrc"]),s=a.valueSources,u=qa(i,s,a),l=u.length==1?u[0]:void 0;!l&&u.includes("value")&&(l="value"),!o&&l&&(e=e.setIn(["args",r,"valueSrc"],l))}return e},Gl=function(e,r,t){if(t)for(var a in t.args)r=Do(e,r,t,a);return r},Do=function(e,r,t,a){var i=t.args[a],o=i.valueSources,s=i.defaultValue,u=qa(e,o,i),l=u.length?u[0]:void 0,c=s?dr(s)&&s.func?"func":"value":void 0,d=c||l,f=r.getIn(["args",a]);return f||(s!==void 0&&(r=r.setIn(["args",a,"value"],lu(i))),d&&(r=r.setIn(["args",a,"valueSrc"],d))),r};function Ld(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Rd(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ld(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Ld(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var Dy=function(e,r){var t={usedFields:[]},a=jd(e,r,t);if(a)return Rd(Rd({},a),t)},jd=function(e,r,t){if(e){var a=e.get("type"),i=e.get("children1");if((a==="group"||a==="rule_group")&&i&&i.size)return Py(e,r,t);if(a==="rule")return Ny(e,r,t)}},Py=function(e,r,t){var a=e.get("properties")||new yt,i=e.get("children1"),o=e.get("id"),s=i.map(function(d){return jd(d,r,t)}).filter(function(d){return typeof d<"u"});if(s.size){var u=a.get("conjunction");u||(u=da(r));var l=a.get("not"),c={id:o,rules:s.toList(),condition:u.toUpperCase(),not:l};return c}},Ny=function(e,r,t){var a,i=e.get("properties")||new yt,o=e.get("id"),s=i.get("operator"),u=i.get("operatorOptions"),l=i.get("field"),c=i.get("value"),d=i.get("valueSrc"),f=i.get("valueType"),p=c.filter(function(j){return j===void 0}).size>0;if(!(l==null||s==null||p)){var g=_e(r,l)||{},h=st(r,s,l)||{},m=g.type||"undefined",y=Jt(h),S=r.types[g.type]||{},C=Qn(l,r,t);if(!(c.size<y)){t.usedFields.indexOf(l)==-1&&t.usedFields.push(l),c=c.toArray(),d=d.toArray(),f=((a=f)===null||a===void 0?void 0:a.toArray())||[];for(var F=[],T=0;T<c.length;T++){var w={type:f[T],value:c[T]};if(F.push(w),d[T]=="field"){var _=c[T];t.usedFields.indexOf(_)==-1&&t.usedFields.push(_)}}var M=u?u.toJS():null;M&&!Object.keys(M).length&&(M=null);var D={id:o,fieldName:C,type:m,input:S.mainWidget,operator:s};return M&&(D.operatorOptions=M),D.values=F,D}}},Vy=$(6924),My=$.n(Vy),xd={reverseOperatorsForNot:!1,canShortMongoQuery:!0,formatField:function(e,r,t,a,i,o){return o?t:e},caseValueField:{type:"case_value"},fieldSources:["field"],keepInputOnChangeFieldSrc:!0,fieldItemKeysForSearch:["label","path","altLabel","grouplabel"],listKeysForSearch:["title","value"],valueSourcesInfo:{value:{}},fieldSeparator:".",fieldSeparatorDisplay:".",canReorder:!0,canRegroup:!0,canDeleteLocked:!1,canLeaveEmptyGroup:!0,shouldCreateEmptyGroup:!1,exportPreserveGroups:!1,removeEmptyGroupsOnLoad:!0,removeEmptyRulesOnLoad:!0,removeIncompleteRulesOnLoad:!1,removeInvalidMultiSelectValuesOnLoad:!0,showErrorMessage:!1,setOpOnChangeField:["keep","default"],groupOperators:["some","all","none"],defaultConjunction:"AND",defaultGroupConjunction:"AND",locale:{moment:"en"},valueLabel:"Value",valuePlaceholder:"Value",fieldLabel:"Field",operatorLabel:"Operator",funcLabel:"Function",fieldPlaceholder:"Select field",funcPlaceholder:"Select function",operatorPlaceholder:"Select operator",lockLabel:"Lock",lockedLabel:"Locked",deleteLabel:"Delete",addGroupLabel:"Add group",addCaseLabel:"Add condition",addDefaultCaseLabel:"Add default condition",defaultCaseLabel:"Default:",addRuleLabel:"Add rule",addSubRuleLabel:"Add sub rule",addSubGroupLabel:"Add sub group",delGroupLabel:"Delete",notLabel:"Not",fieldSourcesPopupTitle:"Select source",valueSourcesPopupTitle:"Select value source",removeRuleConfirmOptions:null,removeGroupConfirmOptions:null,loadMoreLabel:"Load more...",loadingMoreLabel:"Loading more...",typeToSearchLabel:"Type to search",loadingLabel:"Loading...",notFoundLabel:"Not found"},ky=$(55364),Gy=$.n(ky),$y=$(18678),$l=$.n($y);function Id(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Dd(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Id(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Id(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function Uy(n,e){return $l().apply(n,e)}function By(n,e){return $l().add_operation(n,e)}var Pd={CALL:function(e,r){for(var t=arguments.length,a=new Array(t>2?t-2:0),i=2;i<t;i++)a[i-2]=arguments[i];return e.call.apply(e,[r].concat(a))},JSX:function(e,r){return{type:e,props:r}},mergeObjects:function(e,r){return Dd(Dd({},e),r)},fromEntries:function(e){return Object.fromEntries(e)},strlen:function(e){return e?.length||0},regexTest:function(e,r,t){return e?.match(new RegExp(r,t))!=null},now:function(){return new Date},date_add:function(e,r,t){return Ga()(e).add(r,t).toDate()},toLowerCase:function(e){return e.toLowerCase()},toUpperCase:function(e){return e.toUpperCase()}};function Wy(){for(var n in Pd)By(n,Pd[n])}var zy={label:"Now",returnType:"datetime",jsonLogic:"now",jsonLogicCustomOps:{now:{}},spelFunc:"T(java.time.LocalDateTime).now()",sqlFormatFunc:function(){return"NOW()"},sqlFunc:"NOW",mongoFormatFunc:function(){return new Date},formatFunc:function(){return"NOW"}},qy={label:"Relative",returnType:"datetime",renderBrackets:["",""],renderSeps:["","",""],spelFormatFunc:function(e){var r=e.date,t=e.op,a=e.val,i=e.dim,o=i.charAt(0).toUpperCase()+i.slice(1)+"s",s=t+o;return"".concat(r,".").concat(s,"(").concat(a,")")},spelImport:function(e){var r,t,a,i,o,s=(r=e.methodName)===null||r===void 0?void 0:r.match(/^(minus|plus)(\w+)s$/);if(s&&(o=s[2].toLowerCase(),a=s[1],["minus","plus"].includes(a)&&["day","week","month","year"].includes(o)))return a={type:"string",val:a},o={type:"string",val:o},i=e.args[0],t=e.obj,{date:t,op:a,val:i,dim:o}},jsonLogic:function(e){var r=e.date,t=e.op,a=e.val,i=e.dim;return{date_add:[r,a*(t=="minus"?-1:1),i]}},jsonLogicImport:function(e){var r=e.date_add[0],t=Math.abs(e.date_add[1]),a=e.date_add[1]>=0?"plus":"minus",i=e.date_add[2];return[r,a,t,i]},jsonLogicCustomOps:{date_add:{}},sqlFormatFunc:function(e){var r=e.date,t=e.op,a=e.val,i=e.dim;return"DATE_ADD(".concat(r,", INTERVAL ").concat(parseInt(a)*(t=="minus"?-1:1)," ").concat(i.replace(/^'|'$/g,""),")")},sqlImport:function(e,r,t){var a;if(["DATE_ADD","DATE_SUB"].includes(e?.func)&&((a=e.children)===null||a===void 0?void 0:a.length)===2){var i=(0,ve.A)(e.children,2),o=i[0],s=i[1];if(s._type=="interval")return{args:{date:o,op:e?.func==="DATE_ADD"?"plus":"minus",val:s.value,dim:s.unit}}}},mongoFormatFunc:null,formatFunc:function(e){var r=e.date,t=e.op,a=e.val,i=e.dim;return a?"".concat(r," ").concat(t=="minus"?"-":"+"," ").concat(a," ").concat(i):r},args:{date:{label:"Date",type:"datetime",defaultValue:{func:"NOW",args:[]},valueSources:["func","field","value"],escapeForFormat:!0},op:{label:"Op",type:"select",defaultValue:"plus",valueSources:["value"],mainWidgetProps:{customProps:{showSearch:!1}},fieldSettings:{listValues:{plus:"+",minus:"-"}},escapeForFormat:!1},val:{label:"Value",type:"number",fieldSettings:{min:0},defaultValue:0,valueSources:["value"],escapeForFormat:!1},dim:{label:"Dimension",type:"select",defaultValue:"day",valueSources:["value"],mainWidgetProps:{customProps:{showSearch:!1}},fieldSettings:{listValues:{day:"day",week:"week",month:"month",year:"year"}},escapeForFormat:!1}}},Hy={label:"Lowercase",mongoFunc:"$toLower",jsonLogic:"toLowerCase",sqlFunc:"LOWER",spelFunc:"${str}.toLowerCase()",jsonLogicCustomOps:{toLowerCase:{}},returnType:"text",args:{str:{label:"String",type:"text",valueSources:["value","field","func"]}}},Qy={label:"Uppercase",mongoFunc:"$toUpper",jsonLogic:"toUpperCase",sqlFunc:"UPPER",spelFunc:"${str}.toUpperCase()",jsonLogicCustomOps:{toUpperCase:{}},returnType:"text",args:{str:{label:"String",type:"text",valueSources:["value","field","func"]}}},Jy={label:"Linear regression",returnType:"number",formatFunc:function(e,r){var t=e.coef,a=e.bias,i=e.val;return"(".concat(t," * ").concat(i," + ").concat(a,")")},sqlFormatFunc:function(e){var r=e.coef,t=e.bias,a=e.val;return"(".concat(r," * ").concat(a," + ").concat(t,")")},spelFormatFunc:function(e){var r=e.coef,t=e.bias,a=e.val;return"(".concat(r," * ").concat(a," + ").concat(t,")")},spelImport:function(e){var r,t,a,i;if(e.type==="op-plus"){var o=(0,ve.A)(e.children,2);if(i=o[0],a=o[1],i.type==="op-multiply"){var s=(0,ve.A)(i.children,2);return r=s[0],t=s[1],{coef:r,val:t,bias:a}}}},sqlImport:function(e,r,t){var a;if(["+"].includes(e?.operator)&&((a=e.children)===null||a===void 0?void 0:a.length)===2){var i,o=(0,ve.A)(e.children,2),s=o[0],u=o[1];if(["*"].includes(s?.operator)&&((i=s.children)===null||i===void 0?void 0:i.length)===2){var l=(0,ve.A)(s.children,2),c=l[0],d=l[1];return{args:{coef:c,val:d,bias:u}}}}},mongoFormatFunc:function(e){var r=e.coef,t=e.bias,a=e.val;return{$sum:[{$multiply:[r,a]},t]}},jsonLogic:function(e){var r=e.coef,t=e.bias,a=e.val;return{"+":[{"*":[r,a]},t]}},jsonLogicImport:function(e){var r=e["+"][0]["*"][0],t=e["+"][0]["*"][1],a=e["+"][1];return[r,t,a]},renderBrackets:["",""],renderSeps:[" * "," + "],args:{coef:{label:"Coef",type:"number",defaultValue:1,valueSources:["value"]},val:{label:"Value",type:"number",valueSources:["value","field"]},bias:{label:"Bias",type:"number",defaultValue:0,valueSources:["value"]}}};function Ul(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=Yy(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function Yy(n,e){if(n){if(typeof n=="string")return Nd(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Nd(n,e)}}function Nd(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function Vd(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Ar(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Vd(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Vd(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}Wy();function Md(n,e,r){var t;try{t=$l().apply(n,e)}catch(a){throw a.message="".concat(r.join(".")," :: ").concat(a.message),a}return t}function kd(n,e,r,t){var a;try{a=e.call.apply(e,[n].concat((0,ue.A)(r)))}catch(i){throw i.message="".concat(t.join(".")," :: ").concat(i.message),i}return a}var Po={asyncFetch:{type:"f",args:["searchOrValues","offset"]},labelYes:{type:"r"},labelNo:{type:"r"},marks:{type:"r",isArr:!0},validateValue:{type:"f",args:["val","fieldSettings","op","opDef","rightFieldDef"]}},Bl=Ar(Ar({},Po),{},{factory:{type:"rf"},formatValue:{type:"f",args:["val","fieldDef","wgtDef","isForDisplay","op","opDef","rightFieldDef"]},sqlFormatValue:{type:"f",args:["val","fieldDef","wgtDef","op","opDef","rightFieldDef","sqlDialect"]},spelFormatValue:{type:"f",args:["val","fieldDef","wgtDef","op","opDef","rightFieldDef"]},spelImportValue:{type:"f",args:["val","wgtDef","args"]},sqlImport:{type:"f",args:["sqlObj","wgtDef","sqlDialect"]},mongoFormatValue:{type:"f",args:["val","fieldDef","wgtDef","op","opDef"]},elasticSearchFormatValue:{type:"f",args:["queryType","val","op","field","config"]},jsonLogic:{type:"f",args:["val","fieldDef","wgtDef","op","opDef"]},jsonLogicImport:{type:"f",args:["val","wgtDef"]},validateValue:{type:"f",args:["val","fieldSettings","op","opDef","rightFieldDef"]},toJS:{type:"f",args:["val"]}}),Gd={options:{factory:{type:"rf"}},formatOp:{type:"f",args:["field","op","vals","valueSrc","valueType","opDef","operatorOptions","isForDisplay","fieldDef"]},mongoFormatOp:{type:"f",args:["field","op","vals","useExpr","valueSrc","valueType","opDef","operatorOptions","fieldDef"]},sqlFormatOp:{type:"f",args:["field","op","vals","valueSrc","valueType","opDef","operatorOptions","fieldDef"]},spelFormatOp:{type:"f",args:["field","op","vals","valueSrc","valueType","opDef","operatorOptions","fieldDef"]},jsonLogic:{type:"f",ignore:"string",args:["field","op","vals","opDef","operatorOptions","fieldDef"]},sqlImport:{type:"f",args:["sqlObj","_","sqlDialect"]},elasticSearchQueryType:{type:"f",ignore:"string",args:["valueType"]},textSeparators:{type:"r",isArr:!0}},Ky={formatConj:{type:"f",args:["children","conj","not","isForDisplay"]},sqlFormatConj:{type:"f",args:["children","conj","not"]},spelFormatConj:{type:"f",args:["children","conj","not","omitBrackets"]}},$d={widgetProps:Bl,opProps:Gd},Xy={renderBrackets:{type:"r",isArr:!0},renderSeps:{type:"r",isArr:!0},jsonLogic:{type:"f",ignore:"string",args:["formattedArgs"]},jsonLogicImport:{type:"f",args:["val"]},spelImport:{type:"f",args:["spel"]},sqlImport:{type:"f",args:["sqlObj","_","sqlDialect"]},formatFunc:{type:"f",args:["formattedArgs","isForDisplay"]},sqlFormatFunc:{type:"f",args:["formattedArgs"]},mongoFormatFunc:{type:"f",args:["formattedArgs"]},spelFormatFunc:{type:"f",args:["formattedArgs"]}},Ud=Ar(Ar({},Po),{},{fieldSettings:Po}),Bd=Ar(Ar({},Po),{},{fieldSettings:Po,widgets:{x:$d},mainWidgetProps:Bl}),Zy={locale:{mui:{type:"f",args:[],invokeWith:[],ignore:"jl"}},caseValueField:Bd,canCompareFieldWithField:{type:"f",args:["leftField","leftFieldConfig","rightField","rightFieldConfig","op"]},formatReverse:{type:"f",args:["q","op","reversedOp","operatorDefinition","revOperatorDefinition","isForDisplay"]},sqlFormatReverse:{type:"f",args:["q"]},spelFormatReverse:{type:"f",args:["q"]},formatField:{type:"f",args:["field","parts","label2","fieldDefinition","config","isForDisplay"]},formatSpelField:{type:"f",args:["field","parentField","parts","partsExt","fieldDefinition","config"]},formatAggr:{type:"f",args:["whereStr","aggrField","operator","value","valueSrc","valueType","opDef","operatorOptions","isForDisplay","aggrFieldDef"]},normalizeListValues:{type:"f",args:["listValues","type","fieldSettings"]},renderConfirm:{type:"f",args:["props"]},useConfirm:{type:"f",args:[]},renderField:{type:"rf"},renderOperator:{type:"rf"},renderFunc:{type:"rf"},renderConjs:{type:"rf"},renderButton:{type:"rf"},renderIcon:{type:"rf"},renderButtonGroup:{type:"rf"},renderValueSources:{type:"rf"},renderFieldSources:{type:"rf"},renderProvider:{type:"rf"},renderSwitch:{type:"rf"},renderSwitchPrefix:{type:"r"},renderItem:{type:"rf"},renderBeforeWidget:{type:"rf"},renderAfterWidget:{type:"rf"},renderBeforeActions:{type:"rf"},renderAfterActions:{type:"rf"},renderBeforeCaseValue:{type:"rf"},renderAfterCaseValue:{type:"rf"},renderRuleError:{type:"rf"}},e0={fields:{x:Bd},widgets:{x:Bl},conjunctions:{x:Ky},operators:{x:Gd},types:{x:{widgets:{x:$d}}},funcs:{x:Ar(Ar(Ar({},Ud),Xy),{},{args:{x:Ar({},Ud)}})},settings:Zy},Wd=function(e,r){if(e.__fieldNames)throw new Error("Don't apply `compressConfig()` to extended config");var t=wn()(e,An);delete t.ctx;var a=function l(c,d,f,p){if(dr(c)){if(_o(c)&&(c=Fl(c)),f[0]==="funcs"&&!d){var g=f[f.length-1];d=vn({funcs:p.BasicFuncs},g,"funcs","subfields")||void 0,d&&(c.$$key=g)}if(d!==void 0&&dr(d))for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(!Object.keys(c).includes(h)||c[h]===void 0&&d[h]!==void 0?c[h]="$$deleted":(c[h]=l(c[h],d[h],[].concat((0,ue.A)(f),[h]),p),c[h]===void 0&&delete c[h]));for(var m in c)if(Object.prototype.hasOwnProperty.call(c,m)){if(!d||!Object.keys(d).includes(m)){var y;c[m]=l(c[m],(y=d)===null||y===void 0?void 0:y[m],[].concat((0,ue.A)(f),[m]),p)}c[m]===void 0&&delete c[m]}Object.keys(c).length===0&&(c=void 0)}else Array.isArray(c)&&c.forEach(function(S,C){c[C]=l(c[C],void 0,[].concat((0,ue.A)(f),[C]),p)});if(!(d!==void 0&&To(c,d,!0))){if(typeof c=="function")throw new Error("compressConfig: function at ".concat(f.join(".")," should be converted to JsonLogic"));return c}},i=Ul(An),o;try{for(i.s();!(o=i.n()).done;){var s=o.value;if(s!=="ctx")if(s==="fields")t[s]=yr()(t[s]),a(t[s],{},[s]);else if(s==="funcs"){t[s]=yr()(t[s]||{});for(var u in t[s])a(t[s][u],null,[s,u],{BasicFuncs:ie})}else t[s]=yr()(t[s]),a(t[s],r[s],[s])}}catch(l){i.e(l)}finally{i.f()}return t},zd=function(e,r,t){if(!e.settings.useConfigCompress)throw new Error("Please enable `useConfigCompress` in config settings to use decompressConfig()");var a={},i=function c(d,f,p){if(dr(f)){dr(d)||(d={});for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(f[g]==="$$deleted"?delete d[g]:d[g]=c(d[g],f[g],[].concat((0,ue.A)(p),[g])))}else Array.isArray(f)?d=yr()(f):d=f;return d},o=function c(d,f,p){var g=!1;if(dr(d)&&Object.prototype.hasOwnProperty.call(d,"$$key")&&d.$$key){var h=vn({funcs:p.BasicFuncs},d.$$key,"funcs","subfields");if(h)delete d.$$key,d=i(yr()(h),d,f),g=!0;else throw new Error("decompressConfig: basic function not found by key ".concat(d.$$key," at ").concat(f.join(".")))}if(!g){if(dr(d))for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(d[m]=c(d[m],[].concat((0,ue.A)(f),[m]),p));else if(Array.isArray(d)){var y=Ul(d),S;try{for(y.s();!(S=y.n()).done;){var C=S.value;d[C]=c(d[C],[].concat((0,ue.A)(f),[C]),p)}}catch(F){y.e(F)}finally{y.f()}}}return d},s=Ul(An),u;try{for(s.s();!(u=s.n()).done;){var l=u.value;l==="ctx"?a[l]=Gy()({},r.ctx||{},t||{}):l==="funcs"?(a[l]=yr()(e[l]||{}),o(a[l],[l],{BasicFuncs:ie})):l==="fields"?a[l]=yr()(e[l]||{}):(a[l]=yr()(r[l]||{}),i(a[l],e[l]||{},[l]))}}catch(c){s.e(c)}finally{s.f()}return a},qd=function(e){if(e.__compliled)return e;e=yr()(e);var r={ctx:e.ctx},t=[];return du(e,e,r,e0,t),Object.defineProperty(e,"__compliled",{enumerable:!1,writable:!1,value:!0}),e};function du(n,e,r,t,a){var i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];if(e){var o=!i.length;for(var s in t){var u=t[s],l=s==="x"?i:[].concat((0,ue.A)(i),[s]);if(u.type==="r"){var c=e,d=c[s];if(u.isArr)for(var f in d){var p=Ti(d[f],r,[].concat((0,ue.A)(l),[f]));p!==d[f]&&(a.push("Compiled ".concat(l.join("."),"[").concat(f,"]")),d[f]=p)}else{var g=Ti(d,r,l,void 0);g!==d&&(a.push("Compiled R ".concat(l.join("."))),c[s]=g)}}else if(u.type==="rf"){var h=e,m=h[s],y=t0(m,r,l,u.ignore);y!==m&&(a.push("Compiled JL-RF ".concat(l.join("."))),h[s]=y)}else if(u.type==="f"){var S=e,C=S[s],F=r0(C,r,l,u.args,u.ignore);if(u.invokeWith&&F&&typeof F=="function"){var T;F=(T=F).call.apply(T,[null].concat((0,ue.A)(u.invokeWith)))}F!==C&&(a.push("Compiled JL-F ".concat(l.join("."))),S[s]=F)}else if(s==="x")for(var w in e){l=[].concat((0,ue.A)(i),[w]);var _=e[w];du(n,_,r,u,a,l),_.subfields&&du(n,_.subfields,r,t,a,l)}else{var M=e[s];du(n,M,r,u,a,l)}}}}function t0(n,e,r){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:void 0;return Ir(n)?function(a,i){i=i||e?.ctx;var o={props:a,ctx:i},s=Md(n,o,r);typeof s=="string"&&(s={type:s,props:a});var u=Ti(s,{ctx:i},r);return u}:typeof n=="string"?function(a,i){i=i||e?.ctx;var o=n.split(".").reduce(function(l,c){return l?.[c]},i);if(o)return kd(this,o,[a,i],r);var s={type:n,props:a},u=Ti(s,{ctx:i},r);return u}:n}function r0(n,e,r,t){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;return Ir(n)&&a!=="jl"?function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];var u=this||e?.ctx,l=(t||[]).reduce(function(d,f,p){return Ar(Ar({},d),{},(0,X.A)({},f,o[p]))},{args:o,ctx:u}),c=Md(n,l,r);return c}.bind(e?.ctx):typeof n=="string"&&a!=="string"?function(){var i=this||e?.ctx,o=n.split(".").reduce(function(c,d){return c?.[d]},i);if(o){for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];return kd(this,o,u,r)}else throw new Error("".concat(r.join(".")," :: Function ").concat(n," is not found in ctx"))}.bind(e?.ctx):n}function n0(n,e){var r;return(e==null||(r=e.components)===null||r===void 0?void 0:r[n])||e.W[n]||e.O[n]}function Ti(n,e,r){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:void 0;if(Cl(n)){var a,i=n.type,o=n.props;if(typeof i!="string")throw new Error("renderReactElement for ".concat(r.join("."),": type should be string"));var s=n0(i,e.ctx)||i.toLowerCase(),u;t!==void 0&&(o=Ar(Ar({},o),{},{key:t})),(a=o)!==null&&a!==void 0&&a.children&&(u=Ti(o.children,e,r),o=Ar(Ar({},o),{},{children:u}));var l=e.ctx.RCE(s,o);return l}else if(n instanceof Array)return n.map(function(c,d){return Ti(c,e,r,""+d)});return n}function Wl(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=a0(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function a0(n,e){if(n){if(typeof n=="string")return Hd(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hd(n,e)}}function Hd(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function Qd(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function i0(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Qd(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Qd(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var o0=0,Jd=0,_i,fu={},Yd=function(e){return _i||(_i=Xd({reactIndex:void 0,maxSize:3,canCompile:void 0,extendConfig:e})),_i},Kd=function(e,r){var t;for(var a in fu){var i=fu[a].findExtendedConfig(e,r);if(i){t=i;break}}return t},Xd=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{reactIndex:void 0,maxSize:2,canCompile:!0,extendConfig:void 0},r=new Map,t=e.maxSize||2,a=++o0,i,o=!0,s=function(m){return wn()(m,An)},u=function(m){var y=e.extendConfig(m,++Jd,e.canCompile);return c(m,y),y},l=function(){return r.size},c=function(m,y){r.size+1>t&&r.delete(r.keys().next().value),r.set(i0({},m),y)},d=function(m){var y=Wl(r.keys()),S;try{var C=function(){var w=S.value,_=r.get(w),M=An.map(function(D){return _[D]===m[D]}).filter(function(D){return!D}).length===0;if(M)return{v:w}},F;for(y.s();!(S=y.n()).done;)if(F=C(),F)return F.v}catch(T){y.e(T)}finally{y.f()}return m},f=function(m,y){var S=Wl(r.keys()),C;try{var F=function(){var P=C.value,V=An.filter(function(U){return P[U]===m[U]}),L=V.length===An.length&&(y?P.__compliled:!0);if(L)return{v:r.get(P)}},T;for(S.s();!(C=S.n()).done;)if(T=F(),T)return T.v}catch(j){S.e(j)}finally{S.f()}var w=Wl(r.values()),_;try{var M=function(){var P=_.value,V=An.filter(function(U){return P[U]===m[U]}),L=V.length===An.length&&(y?P.__compliled:!0);if(L)return{v:P}},D;for(w.s();!(_=w.n()).done;)if(D=M(),D)return D.v}catch(j){w.e(j)}finally{w.f()}return null},p=function(m){return f(m)||u(m)},g=function(){o=!1,r.clear(),delete fu[a],_i===i&&(_i=void 0)};return i={getExtendedConfig:function(m){return p(s(m))},findExtendedConfig:f,getBasicConfig:d,clearConfigMemo:g,configId:Jd,storeConfigPair:c,getSize:l,configStore:r,memoId:a,meta:e},e.reactIndex===void 0&&(_i=i),fu[a]=i,i};function zl(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=s0(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function s0(n,e){if(n){if(typeof n=="string")return Zd(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zd(n,e)}}function Zd(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function ef(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function tn(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ef(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):ef(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var rn=function n(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(t=t&&e.settings.useConfigCompress,e.__configId)return e;var a=Kd(e,t);if(a)return a;var i=e;t?e.__compliled?e=yr()(e):e=qd(e):e=yr()(e),e.settings=My()({},xd,e.settings,od),e.__fieldsCntByType={},e.__funcsCntByType={},e.__fieldNames={},u0(e.types,e),tf(e.fields,e),rf(e.funcs,e);var o=e.settings.caseValueField;o&&pu(o,e,[],!1,!0);var s=e.settings.locale.moment;s&&Ga().locale(s),Object.defineProperty(e,"__configId",{enumerable:!1,writable:!1,value:r||Tt()}),e.__cache={},ud(e);var u=Yd(n);return u.storeConfigPair(i,e),e};function u0(n,e){for(var r in n){var t=n[r];l0(r,t,e)}}function l0(n,e,r){var t=null,a=null;e.mainWidget=e.mainWidget||Object.keys(e.widgets).filter(function(p){return p!="field"&&p!="func"})[0];var i=e.excludeOperators||[];for(var o in e.widgets){var s=e.widgets[o],u=s.defaultOperator;if(s.operators){var l=s.operators.filter(function(p){return!i.includes(p)});t=Lo(t,l)}u&&!i.includes(u)&&(!a||o===e.mainWidget)&&(a=u),o==e.mainWidget&&(s.widgetProps=tn(tn({},e.mainWidgetProps||{}),s.widgetProps||{})),e.widgets[o]=s}e.valueSources||(e.valueSources=Object.keys(r.settings.valueSourcesInfo));var c=zl(e.valueSources),d;try{for(c.s();!(d=c.n()).done;){var f=d.value;f!="value"&&!e.widgets[f]&&(e.widgets[f]={})}}catch(p){c.e(p)}finally{c.f()}!e.operators&&t&&(e.operators=Array.from(new Set(t))),!e.defaultOperator&&a&&(e.defaultOperator=a)}function tf(n,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];for(var t in n){var a=[].concat((0,ue.A)(r),[t]);pu(n[t],e,a),n[t].subfields&&tf(n[t].subfields,e,a)}}function rf(n,e){var r,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(n){var a=(e==null||(r=e.settings)===null||r===void 0?void 0:r.fieldSeparator)||".";for(var i in n){var o=[].concat((0,ue.A)(t),[i]),s=o.join(a),u=n[i];if(u.returnType&&(u.type=u.returnType,e.__funcsCntByType[u.returnType]||(e.__funcsCntByType[u.returnType]=0),e.__funcsCntByType[u.returnType]++),pu(u,e,o,!1),u.args){for(var l in u.args)pu(u.args[l],e,[].concat((0,ue.A)(o),[l]),!0);var c=Object.keys(u.args),d=!0,f=zl(c.reverse()),p;try{for(f.s();!(p=f.n()).done;){var g=p.value,h=u.args[g];!d&&h.isOptional&&(Ro.info("Arg ".concat(g," for func ").concat(s," can't be optional")),delete h.isOptional),h.isOptional||(d=!1)}}catch(m){f.e(m)}finally{f.f()}}u.subfields&&rf(u.subfields,e,[].concat((0,ue.A)(t),[i]))}}}function c0(n,e,r){for(var t,a,i=["listValues","treeValues","allowCustomValues","validateValue"],o=0,s=i;o<s.length;o++){var u=s[o];n[u]&&(n.fieldSettings||(n.fieldSettings={}),n.fieldSettings[u]=n[u],delete n[u])}(t=n.fieldSettings)!==null&&t!==void 0&&t.listValues&&e.settings.normalizeListValues&&(n.fieldSettings.listValues=e.settings.normalizeListValues.call(e.ctx,n.fieldSettings.listValues,r,n.fieldSettings)),(a=n.fieldSettings)!==null&&a!==void 0&&a.treeValues&&e.settings.normalizeListValues&&(n.fieldSettings.treeValues=e.settings.normalizeListValues.call(e.ctx,n.fieldSettings.treeValues,r,n.fieldSettings))}function pu(n,e){var r,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=e.settings,s=o.showLabels,u=o.fieldSeparator;u=(r=u)!==null&&r!==void 0?r:".";var l=t[t.length-1],c=a?t.slice(0,t.length-1).join(u):t.join(u),d=!!n.returnType,f=n.type||n.returnType,p=e.types[f],g=n.excludeOperators||[],h=(n.operators||p?.operators||[]).filter(function(D){return!g.includes(D)}),m=n.defaultOperator||p?.defaultOperator;g.includes(m)&&(m=void 0);var y=!!m&&m==n.defaultOperator;if(y&&(n.ownDefaultOperator=n.defaultOperator),!p){n.type!=="!struct"&&(n.disabled=!0);return}!a&&!d&&!i&&(e.__fieldsCntByType[f]||(e.__fieldsCntByType[f]=0),e.__fieldsCntByType[f]++),a&&(n._isFuncArg=!0,n._argKey=l,n._funcKey=c),d&&(n._isFunc=!0,n._funcKey=c),i&&(n._isCaseValue=!0),c0(n,e,f);var S=["widgets","operators","defaultOperator"];Object.keys(p).filter(function(D){return!S.includes(D)}).map(function(D){n[D]||(n[D]=Wa(p[D]))});var C=p.excludeOperators||[];n.operators&&(C=C.filter(function(D){return!n.operators.includes(D)})),n.widgets||(n.widgets={});var F=function(){var j=tn({},n.widgets[T]||{}),P=p.widgets[T]||{};if(!a){var V=j.defaultOperator,L=[].concat((0,ue.A)(g),(0,ue.A)(C)),U=n.preferWidgets&&(T==="field"||n.preferWidgets.includes(T))||L.length>0;if(j.operators){var B=j.operators.filter(function(Fe){return!L.includes(Fe)});j.operators=B,h=Lo(h,B)}else if(U&&P.operators){var G=P.operators.filter(function(Fe){return!L.includes(Fe)});j.operators=G,h=Lo(h,G)}V&&!L.includes(V)&&(!m||!y&&T===n.mainWidget)&&(m=V)}T===n.mainWidget?j.widgetProps=tn(tn(tn({},P.widgetProps||{}),n.mainWidgetProps||{}),j.widgetProps||{}):j.widgetProps=tn(tn({},P.widgetProps||{}),j.widgetProps||{});var W=Array.from(new Set([].concat((0,ue.A)(Object.keys(P.opProps||{})),(0,ue.A)(Object.keys(j.opProps||{})))));if(W.length){var z={},H=zl(W),q;try{for(H.s();!(q=H.n()).done;){var J,Y,Z=q.value;z[Z]=tn(tn({},((J=P.opProps)===null||J===void 0?void 0:J[Z])||{}),((Y=j.opProps)===null||Y===void 0?void 0:Y[Z])||{})}}catch(Fe){H.e(Fe)}finally{H.f()}j.opProps=z}var se=j,re=se.valueLabel,ee=se.valuePlaceholder;a&&(re||(j.valueLabel=n.label||l),!ee&&!s&&(j.valuePlaceholder=n.label||l)),j=tn(tn({},P),j),n.widgets[T]=j};for(var T in p.widgets)F();if(a||(n.operators||(n.operators=Array.from(new Set(h))),n.defaultOperator||(n.defaultOperator=m)),!a&&!d&&!i){var w=d0(e,t),_=w.fieldName,M=w.inGroup;_&&(n.fieldName=_,e.__fieldNames[_]||(e.__fieldNames[_]=[]),e.__fieldNames[_].push({fullPath:t,inGroup:M}))}}function d0(n,e){if(!e)return{};var r=n.settings.fieldSeparator,t=(0,ue.A)(e).reduce(function(s,u,l,c){var d=s.computedPath,f=s.computed,p=s.inGroup,g=[].concat((0,ue.A)(c.slice(0,l)),[u]),h=vn(n,g);return h?.type==="!group"&&l<c.length-1?(p=g.join(r),d=[]):h!=null&&h.fieldName?(f=!0,d=[h.fieldName]):d=[].concat((0,ue.A)(d),[u]),{computedPath:d,computed:f,inGroup:p}},{computedPath:[],computed:!1,inGroup:void 0}),a=t.computedPath,i=t.computed,o=t.inGroup;return i?{fieldName:a.join(r),inGroup:o}:{}}function nf(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function af(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?nf(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):nf(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function of(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=f0(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function f0(n,e){if(n){if(typeof n=="string")return sf(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sf(n,e)}}function sf(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}var p0=function(e,r){var t={usedFields:[],errors:[]},a=rn(r,void 0,!1),i=uf(e,a,t,!1,!0),o=t.errors,s=t.usedFields,u=a.settings.fieldSeparator,l={},c=of(s),d;try{for(c.s();!(d=c.n()).done;)for(var f=d.value,p=Ut(f,r),g=_e(a,f)||{},h=l,m=0;m<p.length;m++){var y=p[m],S=_e(a,p.slice(0,m+1))||{};m!=p.length-1?S.type=="!group"&&S.mode!="struct"?(h[y]||(h[y]=[{}]),h=h[y][0]):(h[y]||(h[y]={}),h=h[y]):h[y]||(h[y]=null)}}catch(C){c.e(C)}finally{c.f()}return{errors:o,logic:i,data:l}},uf=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null;if(e){var s=e.get("type"),u=e.get("properties")||new yt,l=u.get("isLocked"),c=r.settings.jsonLogic.lockedOp,d;return s==="group"||s==="rule_group"?d=lf(e,r,t,a,i,o):s==="rule"?d=v0(e,r,t,a,o):s=="switch_group"?d=g0(e,r,t,a):s=="case_group"&&(d=cf(e,r,t,a,o)),l&&d&&c&&(d=(0,X.A)({},c,d)),d}},lf=function(e,r,t){var a,i,o,s,u,l,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,f=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,p=e.get("type"),g=e.get("properties")||new yt,h=g.get("mode"),m=e.get("children1")||new Jr,y=g.get("field"),S=_e(r,y),C=g.get("conjunction");C||(C=da(r));var F=r.conjunctions[C],T=F?.jsonLogicConj||C.toLowerCase(),w=!!g.get("not"),_=p==="rule_group"&&!d,M=_&&h!="struct",D=M?y:f,j=g.get("operator"),P=j&&st(r,j,y)||null,V=ql(r,g,t,j,f),L=_&&(!j||((a=P)===null||a===void 0?void 0:a.cardinality)==0),U=_&&m?.size>0,B=_&&!(m!=null&&m.size),G=w,W=!1;U?(W=w,G=c):c&&(G=!G);var z=!1,H=(i=P)===null||i===void 0?void 0:i.reversedOp,q=st(r,H,y),J=!((o=P)!==null&&o!==void 0&&o.jsonLogic)&&!!((s=q)!==null&&s!==void 0&&s.jsonLogic),Y=!!((u=q)!==null&&u!==void 0&&u.jsonLogic),Z=(l=kl(e))===null||l===void 0?void 0:l.get("type"),se=!!r.settings.reverseOperatorsForNot&&(!_&&G&&Z==="rule"||W&&m?.size===1);se&&(U?W=!W:G=!G,z=!0);var re=G&&_&&Y&&(!!r.settings.reverseOperatorsForNot||J);if(re){G=!G;var ee=[H,j];j=ee[0],H=ee[1];var Fe=[q,P];P=Fe[0],q=Fe[1]}var pe=m.map(function(Ve){return uf(Ve,r,t,z,!1,D)}).filter(function(Ve){return typeof Ve<"u"}),oe=!!r.settings.exportPreserveGroups;if(M&&!L){if(V==null)return}else if(!pe.size&&!oe)return;var Se=d||oe||pe.size!=1;!Se&&w&&!z&&(Se=m.some(function(Ve){var Re,Ce,jt,ot,mt=(Re=Ve.get("properties"))===null||Re===void 0?void 0:Re.get("operator"),Ue=(Ce=r.operators)===null||Ce===void 0||(Ce=Ce[mt])===null||Ce===void 0?void 0:Ce.reversedOp;return(jt=(ot=r.operators)===null||ot===void 0||(ot=ot[Ue])===null||ot===void 0?void 0:ot._jsonLogicIsExclamationOp)!==null&&jt!==void 0?jt:!1}));var he={};if(Se?he[T]=pe.toList().toJS():he=pe.first(),W&&(he={"!":he}),M){var be=Ql(t,r,y,f);if(L){var Le=j||"some";he=(0,X.A)({},Le,[be,he])}else{var Ae=pe.size?{filter:[be,he]}:be,ke={reduce:[Ae,{"+":[1,{var:"accumulator"}]},0]};he=ff(r,g,ke,V,j,null,S)}}return G&&(he={"!":he}),he},v0=function(e,r,t){var a,i,o,s,u,l,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,f=e.get("properties")||new yt,p=f.get("field"),g=f.get("fieldSrc"),h=f.get("operator"),m=f.get("operatorOptions");if(m=m?m.toJS():null,m&&!Object.keys(m).length&&(m=null),!(p==null||h==null)){var y=_e(r,p),S=st(r,h,p),C=(a=S)===null||a===void 0?void 0:a.reversedOp,F=st(r,C,p);if(!((i=S)!==null&&i!==void 0&&i.jsonLogic)&&!((o=F)!==null&&o!==void 0&&o.jsonLogic)){t.errors.push("Operator ".concat(h," is not supported"));return}var T=c,w=!((s=S)!==null&&s!==void 0&&s.jsonLogic)&&!!((u=F)!==null&&u!==void 0&&u.jsonLogic),_=!!((l=F)!==null&&l!==void 0&&l.jsonLogic),M=_&&(!!r.settings.reverseOperatorsForNot||w),D=T&&M||w;if(D){T=!T;var j=[C,h];h=j[0],C=j[1];var P=[F,S];S=P[0],F=P[1]}var V=ql(r,f,t,h,d);if(V!==void 0){var L=g==="func"?df(t,r,p,d):Ql(t,r,p,d);if(L!==void 0)return ff(r,f,L,V,h,m,y,T)}}},g0=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=e.get("children1");if(i){for(var o=i.map(function(w){return cf(w,r,t,a,null)}).filter(function(w){return typeof w<"u"}).valueSeq().toArray(),s=[],u=0;u<o.length;u++)u!==o.length-1&&!o[u][0]?t.errors.push("No condition for case ".concat(u)):(s.push(o[u]),u===o.length-1&&o[u][0]&&s.push([void 0,null]));if(s.length){if(s.length===1){var l=(0,ve.A)(s[0],2),c=l[0],d=l[1];return d==null&&(d=null),d}for(var f={if:[]},p=f.if,g=(0,ve.A)(s[s.length-1],2),h=g[0],m=g[1],y=0;y<s.length-1;y++){var S=y===s.length-2,C=(0,ve.A)(s[y],2),F=C[0],T=C[1];T==null&&(T=null),F==null&&(F=!0),p.push(F),p.push(T),S?p.push(m):(p.push({if:[]}),p=p[p.length-1].if)}return f}}},cf=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o=e.get("type");if(o!="case_group"){t.errors.push("Unexpected child of type ".concat(o," inside switch"));return}var s=e.get("properties")||new yt,u=lf(e,r,t,a,i),l=ql(r,s,t,null,i,"!case_value");return[u,l]},ql=function(e,r,t,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,s=r.get("field"),u=r.get("valueSrc"),l=r.get("valueType");(o=="!case_value"||l&&l.get(0)=="case_value")&&(s="!case_value");var c=_e(e,s),d=st(e,a,s),f=Jt(d),p=r.get("value"),g=r.get("asyncListValues");if(p!=null){var h=[],m=[],y=t.usedFields,S=p.map(function(F,T){var w=u?u.get(T):null,_=l?l.get(T):null,M=Ha(F,w,e),D=Nt(e,s,a,w),j=br(e,s,a,D,w,{forExport:!0}),P=Hl(t,e,M,w,_,j,c,a,d,i,g);return P!==void 0&&(h.push(w),m.push(_)),P}),C=S.filter(function(F){return F===void 0}).size>0;if(S.size<f||C){t.usedFields=y;return}return f>1?S.toArray():f==1?S.first():null}},Hl=function(e,r,t,a,i,o,s,u,l){var c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:null,d=arguments.length>10?arguments[10]:void 0;if(t!==void 0){var f;if(a=="field")f=Ql(e,r,t,c);else if(a=="func")f=df(e,r,t,c);else if(typeof o?.jsonLogic=="function"){var p=o.jsonLogic,g=[t,af(af({},s?wn()(s,["fieldSettings","listValues"]):{}),{},{asyncListValues:d}),Yr(o,Ua)];u&&(g.push(u),g.push(l)),f=p.call.apply(p,[r.ctx].concat(g))}else f=t;return f}},df=function(e,r,t){var a,i,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,s=(a=t.get)===null||a===void 0?void 0:a.call(t,"func"),u=(i=t.get)===null||i===void 0?void 0:i.call(t,"args"),l=nr(r,s),c=Ut(s,r),d=c[c.length-1];if(!l){e.errors.push("Func ".concat(s," is not defined in config"));return}if(!(l!=null&&l.jsonLogic)){e.errors.push("Func ".concat(s," is not supported"));return}var f={},p=[],g=[];for(var h in l.args){var m,y=l.args[h],S=_e(r,y),C=y.defaultValue,F=y.isOptional,T=C!=null&&C.func?"func":"value",w=u?u.get(h):void 0,_=w?w.get("value"):void 0,M=w?w.get("valueSrc"):void 0;M!=="func"&&(m=_)!==null&&m!==void 0&&m.toJS&&(_=_.toJS());var D=null,j=Nt(r,y,D,M),P=br(r,y,D,j,M,{forExport:!0}),V=Hl(e,r,_,M,y.type,P,S,null,null,o);if(_!=null&&V===void 0){M!="func"&&e.errors.push("Can't format value of arg ".concat(h," for func ").concat(s));return}var L=void 0;if(V===void 0&&!F&&C!=null){var U=Nt(r,y,D,T),B=br(r,y,D,U,T,{forExport:!0});if(L=Hl(e,r,C,T,y.type,B,S,null,null,o),L===void 0){T!="func"&&e.errors.push("Can't format default value of arg ".concat(h," for func ").concat(s));return}}var G=V??L;if(G!==void 0){if(p.length){var W=of(p),z;try{for(W.s();!(z=W.n()).done;){var H=z.value;f[H]=void 0}}catch(pe){W.e(pe)}finally{W.f()}p=[]}f[h]=G}else F||g.push(h),p.push(h)}if(!g.length){var q=Object.values(f),J;if(typeof l.jsonLogic=="function"){var Y=l.jsonLogic,Z=[f];J=Y.call.apply(Y,[r.ctx].concat(Z))}else{var se=l.jsonLogic||d,re=!!l.jsonLogicIsMethod;if(re){var ee=q[0],Fe=q.slice(1);Fe.length?J={method:[ee,se,Fe]}:J={method:[ee,se]}}else J=(0,X.A)({},se,q)}return J}},Ql=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=r.settings,o=i.fieldSeparator,s=i.jsonLogic,u;if(t){Array.isArray(t)&&(t=t.join(o));var l=_e(r,t)||{},c=Qn(t,r,e,a),d=l.jsonLogicVar||(l.type=="!group"?s.groupVarKey:"var");u=(0,X.A)({},d,c),e.usedFields.indexOf(t)==-1&&e.usedFields.push(t)}return u},h0=function(e,r,t,a){var i=e,o=Jt(r);typeof r.jsonLogic=="string"&&(i=r.jsonLogic);var s=["<","<=",">",">="],u=["==","!="],l=function(d,f,p,g,h){return o==0&&u.includes(i)?(0,X.A)({},i,[t,null]):o==0?(0,X.A)({},i,t):o==1?(0,X.A)({},i,[t,a]):o==2&&s.includes(i)?(0,X.A)({},i,[a[0],t,a[1]]):(0,X.A)({},i,[t].concat((0,ue.A)(a)))};return l},ff=function(e,r,t,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1,l=r.get("field"),c=st(e,i,l)||{},d=typeof c.jsonLogic=="function"?c.jsonLogic:h0(i,c,t,a),f=[t,i,a,Yr(c,Ci),o,s],p=d.call.apply(d,[e.ctx].concat(f));return u&&(p={"!":p}),p};function m0(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=y0(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function y0(n,e){if(n){if(typeof n=="string")return pf(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pf(n,e)}}function pf(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function vf(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function gf(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?vf(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):vf(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var b0=function(e,r){return hf(e,r,!1)},hf=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={errors:[]},i=rn(r,void 0,!1),o=Jl([],e,i,a);return t?[o,a.errors]:(a.errors.length&&console.warn("Errors while exporting to MongoDb:",a.errors),o)},Jl=function(e,r,t,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:void 0,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:void 0;if(r){var l=r.get("type");if(l==="group"||l==="rule_group")return S0(e,r,t,a,i,o,s,u);if(l==="rule")return O0(e,r,t,a,i,o,s,u)}},S0=function(e,r,t,a){var i,o,s,u,l,c,d,f,p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,g=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,h=arguments.length>6&&arguments[6]!==void 0?arguments[6]:void 0,m=arguments.length>7&&arguments[7]!==void 0?arguments[7]:void 0,y=r.get("type"),S=r.get("properties")||new yt,C=!!S.get("not"),F=r.get("children1")||new Jr,T=t.settings,w=T.canShortMongoQuery,_=T.fieldSeparator,M=_,D=e.filter(function(Xe){return Xe.get("type")=="rule_group"}).length>0,j=e.filter(function(Xe){return Xe.get("type")=="rule_group"}).map(function(Xe){return Xe.get("properties").get("field")}).slice(-1).pop(),P=D&&j,V=y==="rule_group",L=V?S.get("field"):null,U=V?S.get("operator"):null,B=U&&st(t,U,L)||null,G=U?(i=(o=B)===null||o===void 0?void 0:o.cardinality)!==null&&i!==void 0?i:1:void 0,W=Qn(L,t,a,P),z=_e(t,L)||{},H=z.mode,q=L&&H==="array"&&G>=1,J=V&&H!="struct",Y=V&&F?.size>0,Z=V&&!(F!=null&&F.size),se=!1,re=C,ee=!1;Y?(ee=C,re=p):p&&(re=!re);var Fe=(s=B)===null||s===void 0?void 0:s.reversedOp,pe=st(t,Fe,L),oe=!((u=B)!==null&&u!==void 0&&u.mongoFormatOp)&&!!((l=pe)!==null&&l!==void 0&&l.mongoFormatOp),Se=!!((c=pe)!==null&&c!==void 0&&c.mongoFormatOp),he=(d=kl(r))===null||d===void 0?void 0:d.get("type"),be=!!t.settings.reverseOperatorsForNot&&(!V&&re&&he==="rule"||ee&&F?.size===1);be&&(Y?ee=!ee:re=!re,se=!0);var Le=re&&V&&Se&&(!!t.settings.reverseOperatorsForNot||oe);if(Le){re=!re;var Ae=[Fe,U];U=Ae[0],Fe=Ae[1];var ke=[pe,B];B=ke[0],pe=ke[1]}var Ve=S.get("conjunction");Ve||(Ve=da(t));var Re=t.conjunctions[Ve];if(Re){var Ce=Re.reversedConj,jt=re&&((f=Ve)===null||f===void 0?void 0:f.toLowerCase())==="or"&&Ce&&!V&&!!t.settings.canShortMongoQuery&&!!t.settings.reverseOperatorsForNot;jt&&(Ve=Ce,Re=t.conjunctions[Ve],re=!re,se=!0);var ot=Re.mongoConj,mt=F.map(function(Xe){return Jl([].concat((0,ue.A)(e),[r]),Xe,t,a,se,H!="array",H=="array"?function(Ht){return"$$el".concat(M).concat(Ht)}:void 0)}).filter(function(Xe){return typeof Xe<"u"});if(!(!q&&!mt.size)){var Ue;if(mt.size==1)Ue=mt.first();else if(mt.size>1){var Mt=mt.toList().toJS(),kt=w&&ot=="$and";kt&&(Ue=Mt.reduce(function(Xe,Ht){if(Xe){for(var Xt in Ht){if(Xt[0]=="$"){Xe=void 0;break}if(Xe[Xt]==null)Xe[Xt]=Ht[Xt];else{var Zt=Xe[Xt],Vr=Ht[Xt];dr(Zt)||(Zt={$eq:Zt}),dr(Vr)||(Vr={$eq:Vr});var at=Object.keys(Zt)[0],Qt=Object.keys(Vr)[0];if(at==Qt){Xe=void 0;break}Xe[Xt]=Object.assign({},Zt,Vr)}}return Xe}},{})),Ue||(Ue=(0,X.A)({},ot,Mt))}if(L)if(H=="array"){var ir={$size:{$ifNull:["$"+W,[]]}},xt=Ue?{$size:{$ifNull:[{$filter:{input:"$"+W,as:"el",cond:Ue}},[]]}}:ir;Ue=Jl(e,r.set("type","rule"),t,a,ee,!1,function(Xe){return xt},ir),Ue={$expr:Ue}}else Ue=(0,X.A)({},W,{$elemMatch:Ue});return re&&(Ue={$not:Ue}),Ue}}},O0=function(e,r,t,a){var i,o,s,u,l,c,d,f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,p=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,g=arguments.length>6&&arguments[6]!==void 0?arguments[6]:void 0,h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:void 0,m=r.get("properties")||new yt,y=e.filter(function(Ce){return Ce.get("type")=="rule_group"}).length>0,S=e.filter(function(Ce){return Ce.get("type")=="rule_group"}).map(function(Ce){return Ce.get("properties").get("field")}).slice(-1).pop(),C=y&&S,F=m.get("operator"),T=m.get("operatorOptions"),w=m.get("field"),_=m.get("fieldSrc"),M=m.get("value"),D=m.get("valueSrc"),j=m.get("valueType"),P=m.get("asyncListValues");if(!(w==null||F==null||M===void 0)){var V=_e(t,w),L=st(t,F,w),U=(i=L)===null||i===void 0?void 0:i.reversedOp,B=st(t,U,w),G=Jt(L);if(!((o=L)!==null&&o!==void 0&&o.mongoFormatOp)&&!((s=B)!==null&&s!==void 0&&s.mongoFormatOp)){a.errors.push("Operator ".concat(F," is not supported"));return}var W=f,z=!((u=L)!==null&&u!==void 0&&u.mongoFormatOp)&&!!((l=B)!==null&&l!==void 0&&l.mongoFormatOp),H=!!((c=B)!==null&&c!==void 0&&c.mongoFormatOp),q=H&&(!!t.settings.reverseOperatorsForNot||z),J=q&&W||z,Y=!1;if(J){var Z=[U,F];F=Z[0],U=Z[1];var se=[B,L];L=se[0],B=se[1],W=!W,Y=!0}var re,ee=!1;if(_=="func"){var Fe=mf(a,t,w,C),pe=(0,ve.A)(Fe,2);re=pe[0],ee=pe[1]}else re=Qn(w,t,a,C),g&&(ee=!0,re=g(re));if(re!=null){var oe=[],Se=[],he;if(M!=null){var be=M.map(function(Ce,jt){var ot=D?D.get(jt):null,mt=j?j.get(jt):null,Ue=Ha(Ce,ot,t),Mt=Nt(t,w,F,ot),kt=br(t,w,F,Mt,ot,{forExport:!0}),ir=Yl(a,t,Ue,ot,mt,kt,V,C,F,L,P),xt=(0,ve.A)(ir,2),Xe=xt[0],Ht=xt[1];return Xe!==void 0&&(ee=ee||Ht,oe.push(ot),Se.push(mt)),Xe}),Le=be.filter(function(Ce){return Ce===void 0}).size>0;if(be.size<G||Le)return;he=G>1?be.toArray():G==1?be.first():null}var Ae=ee&&p,ke=(d=L)===null||d===void 0?void 0:d.mongoFormatOp,Ve=[re,F,h!==void 0&&he==null?h:he,ee,oe.length>1?oe:oe[0],Se.length>1?Se:Se[0],Yr(L,Ci),T,V],Re=ke.call.apply(ke,[t.ctx].concat(Ve));return Ae&&(Re={$expr:Re}),W&&(Re={$not:Re}),Re}}},Yl=function(e,r,t,a,i,o,s,u,l,c,d){if(t===void 0)return[void 0,!1];var f,p=!1;if(a=="field"){var g=F0(e,r,t,u),h=(0,ve.A)(g,2);f=h[0],p=h[1]}else if(a=="func"){var m=mf(e,r,t,u),y=(0,ve.A)(m,2);f=y[0],p=y[1]}else if(typeof o?.mongoFormatValue=="function"){var S=o.mongoFormatValue,C=[t,gf(gf({},s?wn()(s,["fieldSettings","listValues"]):{}),{},{asyncListValues:d}),Yr(o,Ua)];l&&(C.push(l),C.push(c)),f=S.call.apply(S,[r.ctx].concat(C))}else f=t;return[f,p]},F0=function(e,r,t,a){var i=r.settings.fieldSeparator,o,s=!0;if(t){var u=_e(r,t)||{},l=Ut(t,r),c=Io(t,r),d=c?c.join(i):null,f=r.settings.formatField,p=Qn(t,r,e,a),g=f(p,l,d,u,r,!1);o="$"+g}return[o,s]},mf=function(e,r,t,a){var i,o,s=!0,u,l=(i=t.get)===null||i===void 0?void 0:i.call(t,"func"),c=(o=t.get)===null||o===void 0?void 0:o.call(t,"args"),d=nr(r,l);if(!d)return e.errors.push("Func ".concat(l," is not defined in config")),[void 0,!1];var f=Ut(l,r),p=f[f.length-1],g=d.mongoFunc||p,h=d.mongoArgsAsObject,m={},y=0,S=void 0,C=[],F=[];for(var T in d.args){var w;y++;var _=d.args[T],M=_e(r,_),D=_.defaultValue,j=_.isOptional,P=D!=null&&D.func?"func":"value",V=c?c.get(T):void 0,L=V?V.get("value"):void 0,U=V?V.get("valueSrc"):void 0;U!=="func"&&(w=L)!==null&&w!==void 0&&w.toJS&&(L=L.toJS());var B=V?V.get("asyncListValues"):void 0,G=null,W=Nt(r,_,G,U),z=br(r,_,G,W,U,{forExport:!0}),H=Yl(e,r,L,U,_.type,z,M,a,null,null,B),q=(0,ve.A)(H,2),J=q[0],Y=q[1];if(L!=null&&J===void 0)return U!="func"&&e.errors.push("Can't format value of arg ".concat(T," for func ").concat(l)),[void 0,!1];var Z=void 0;if(J===void 0&&!j&&D!=null){var se=Nt(r,_,G,P),re=br(r,_,G,se,P,{forExport:!0}),ee=void 0,Fe=Yl(e,r,D,P,_.type,re,M,a,null,null,B),pe=(0,ve.A)(Fe,2);if(Z=pe[0],ee=pe[1],Z===void 0)return P!="func"&&e.errors.push("Can't format default value of arg ".concat(T," for func ").concat(l)),[void 0,!1]}var oe=J??Z;if(oe!==void 0){if(C.length){var Se=m0(C),he;try{for(Se.s();!(he=Se.n()).done;){var be=he.value;m[be]=void 0}}catch(ke){Se.e(ke)}finally{Se.f()}C=[]}m[T]=oe,S=oe}else j||F.push(T),C.push(T)}if(F.length)return[void 0,!1];if(typeof d.mongoFormatFunc=="function"){var Le=d.mongoFormatFunc,Ae=[m];u=Le.call.apply(Le,[r.ctx].concat(Ae))}else{if(d.mongoFormatFunc===null)return e.errors.push("Functon ".concat(g," is not supported")),[void 0,!1];h?u=(0,X.A)({},g,m):y==1&&S!==void 0?u=(0,X.A)({},g,S):u=(0,X.A)({},g,Object.values(m))}return[u,s]},C0=$(61526),E0=$.n(C0),Jn=E0();Jn.trim=function(n){return n?.charAt(0)=="'"?n.substring(1,n.length-1):n},Jn.unescapeLike=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;if(typeof n!="string")return n;var r=n;return e==="BigQuery"?r=r.replace(/\\\\([%_])/g,"$1"):r=r.replace(/\\([%_])/g,"$1"),r},Jn.escapeLike=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:void 0;if(typeof n!="string")return n;var a=Jn.escape(n);return a=Jn.trim(a),t==="BigQuery"?a=a.replace(/[%_\\]/g,"\\\\$&"):a=a.replace(/[%_]/g,"\\$&"),a=(e?"%":"")+a+(r?"%":""),a="'"+a+"'",a};var yf=function(e){var r="''",t=e?.type;return t=="date"?r="'0000-00-00'":t=="datetime"?r="'0000-00-00 00:00'":t=="time"?r="'00:00'":t=="number"&&(r="0"),r},bf=function(e){var r="",t=e?.type;return t=="number"&&(r=0),r},w0=function(e){return"'"+e.replace(/'/g,"''")+"'"},A0=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t,a,i=["int","float"];e.map(function(u){if(u!=null){if(typeof u=="string")a="String";else if(typeof u=="number")a=Number.isInteger(u)?"int":"float";else throw new Error("spelEscape: Can't use value ".concat(u," in array"));if(!t)t=a;else if(t!=a)if(i.includes(t)&&i.includes(a))t="float";else throw new Error("spelEscape: Can't use different types in array: found ".concat(t," and ").concat(a))}}),t||(t="String");var o;t=="float"?o=e.map(function(u){return Li(u,!0)}):o=e.map(function(u){return Li(u)});var s;return r?s="new ".concat(t,"[]{").concat(o.join(", "),"}"):s="{".concat(o.join(", "),"}"),s},Sf=function(e){return"".concat(e,".?[true]")},Li=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e==null)return"null";switch((0,ft.A)(e)){case"boolean":return e?"true":"false";case"number":return!Number.isFinite(e)||isNaN(e)?void 0:e+(!Number.isInteger(e)||r?"f":"");case"object":if(Array.isArray(e))return A0(e,t);throw new Error("spelEscape: Object is not supported");default:return w0(e)}},T0=function(e){return e&&Array.isArray(e)&&e.length?e.map(function(r){if(r.type=="const")return Li(r.value);if(r.type=="property")return""+r.value;if(r.type=="variable")return"#"+r.value}).filter(function(r){return r!=null}).join(" + "):"null"},_0=function(e){if(e==null)return[void 0,[]];var r=[],t=e.valueType=="case_value"?e.value:e,a=Array.isArray(t)?t:[t],i=a.map(function(o){if(o.valueSrc==="value")return o.value===null?void 0:{type:"const",value:o.value};if(o.valueSrc==="field")return{type:o.isVariable?"variable":"property",value:o.value};r.push("Unsupported valueSrc ".concat(o.valueSrc," in concatenation"))}).filter(function(o){return o!=null});return[i,r]},Of=function(e){return e==null?"NULL":e.toString()},Ff=function(e){return e==null||e?.[0]==="("&&e?.[e?.length-1]===")"?e:"("+e+")"};function L0(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=R0(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function R0(n,e){if(n){if(typeof n=="string")return Cf(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Cf(n,e)}}function Cf(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function Ef(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function wf(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ef(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Ef(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var j0=function(e,r){return Af(e,r,!1)},Af=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={errors:[]},i=rn(r,void 0,!1),o=Tf(e,i,a);return t?[o,a.errors]:(a.errors.length&&console.warn("Errors while exporting to SQL:",a.errors),o)},Tf=function(e,r,t){if(e){var a=e.get("type"),i=e.get("children1");if(a==="group"||a==="rule_group")return x0(e,r,t);if(a==="rule")return D0(e,r,t)}},x0=function(e,r,t){var a=e.get("type"),i=e.get("properties")||new yt,o=e.get("children1")||new Jr,s=a==="rule_group",u=s?i.get("field"):null,l=_e(r,u)||{},c=l.mode;c=="array"&&t.errors.push("Aggregation is not supported for ".concat(u));var d=i.get("not"),f=!1,p=o.map(function(m){return Tf(m,r,t)}).filter(function(m){return typeof m<"u"});if(!(!f&&!p.size)){var g=i.get("conjunction");g||(g=da(r));var h=r.conjunctions[g];return h.sqlFormatConj.call(r.ctx,p,g,d)}},I0=function(e,r){var t=r.sqlOp||e,a=Jt(r),i;return a==0?i=function(s,u,l,c,d,f,p,g){return"".concat(s," ").concat(t)}:a==1?i=function(s,u,l,c,d,f,p,g){return"".concat(s," ").concat(t," ").concat(l)}:a==2&&(i=function(s,u,l,c,d,f,p,g){var h,m,y=l==null||(h=l.first)===null||h===void 0?void 0:h.call(l),S=l==null||(m=l.get)===null||m===void 0?void 0:m.call(l,1);return"".concat(s," ").concat(t," ").concat(y," AND ").concat(S)}),i},D0=function(e,r,t){var a=e.get("properties")||new yt,i=a.get("field"),o=a.get("fieldSrc"),s=a.get("operator"),u=a.get("operatorOptions"),l=a.get("valueSrc"),c=a.get("valueType"),d=a.get("value"),f=a.get("asyncListValues");if(!(i==null||s==null)){var p=_e(r,i)||{},g=st(r,s,i)||{},h=g.reversedOp,m=st(r,h,i)||{},y=Jt(g),S=!1,C=g.sqlOp||g.sqlFormatOp,F=m.sqlOp||m.sqlFormatOp;if(!C&&!F){t.errors.push("Operator ".concat(s," is not supported"));return}if(!C&&F){S=!0;var T=[h,s];s=T[0],h=T[1];var w=[m,g];g=w[0],m=w[1]}var _=[],M=[],D;if(d!=null){var j=d.map(function(G,W){var z=l?l.get(W):null,H=c?c.get(W):null,q=Ha(G,z,r),J=Nt(r,i,s,z),Y=br(r,i,s,J,z,{forExport:!0}),Z=Kl(t,r,q,z,H,Y,p,s,g,f);return Z!==void 0&&(_.push(z),M.push(H)),Z}),P=j.filter(function(G){return G===void 0}).size>0;if(P||j.size<y)return;D=y==1?j.first():j}var V=g.sqlFormatOp||I0(s,g);if(!V){t.errors.push("Operator ".concat(s," is not supported"));return}var L=o=="func"?Lf(t,r,i):_f(t,r,i);if(L!=null){var U=[L,s,D,_.length>1?_:_[0],M.length>1?M:M[0],Yr(g,Ci),u,p],B;if(B=V.call.apply(V,[r.ctx].concat(U)),S&&(B=r.settings.sqlFormatReverse.call(r.ctx,B)),B===void 0){t.errors.push("Operator ".concat(s," is not supported for value source ").concat(_.join(", ")));return}return B}}},Kl=function(e,r,t,a,i,o,s,u,l,c){if(t!==void 0){var d;if(a=="field")d=_f(e,r,t);else if(a=="func")d=Lf(e,r,t);else if(t==null)d=void 0;else if(typeof o?.sqlFormatValue=="function"){var f=o.sqlFormatValue,p=a=="field"&&_e(r,t)||{},g=[t,wf(wf({},wn()(s,["fieldSettings","listValues"])),{},{asyncListValues:c}),Yr(o,Ua),u,l,p,r.settings.sqlDialect];d=f.call.apply(f,[r.ctx].concat(g))}else Array.isArray(t)?d=t.map(function(h){return Jn.escape(h)}):d=Jn.escape(t);return d}},_f=function(e,r,t){if(t){var a=r.settings.fieldSeparator,i=_e(r,t)||{},o=Ut(t,r),s=Io(t,r),u=s?s.join(a):null,l=r.settings.formatField,c=Qn(t,r,e,null,{useTableName:!0}),d=l(c,o,u,i,r);return d}},Lf=function(e,r,t){var a,i,o=(a=t.get)===null||a===void 0?void 0:a.call(t,"func"),s=(i=t.get)===null||i===void 0?void 0:i.call(t,"args"),u=nr(r,o);if(!u){e.errors.push("Func ".concat(o," is not defined in config"));return}var l=Ut(o,r),c=l[l.length-1],d=u.sqlFunc||c,f={},p=[],g=[];for(var h in u.args){var m,y=u.args[h],S=_e(r,y),C=y.defaultValue,F=y.isOptional,T=C!=null&&C.func?"func":"value",w=s?s.get(h):void 0,_=w?w.get("value"):void 0,M=w?w.get("valueSrc"):void 0;M!=="func"&&(m=_)!==null&&m!==void 0&&m.toJS&&(_=_.toJS());var D=w?w.get("asyncListValues"):void 0,j=Kl(e,r,_,M,y.type,S,y,null,null,D);if(_!=null&&j===void 0){M!="func"&&e.errors.push("Can't format value of arg ".concat(h," for func ").concat(o));return}var P=void 0;if(j===void 0&&!F&&C!=null&&(P=Kl(e,r,C,T,y.type,S,y,null,null,D),P===void 0)){T!="func"&&e.errors.push("Can't format default value of arg ".concat(h," for func ").concat(o));return}var V=j??P;if(V!==void 0){if(p.length){var L=L0(h),U;try{for(L.s();!(U=L.n()).done;){var B=U.value;f[B]=void 0}}catch(q){L.e(q)}finally{L.f()}p=[]}f[h]=V}else F||g.push(h),p.push(h)}if(!g.length){var G;if(typeof u.sqlFormatFunc=="function"){var W=u.sqlFormatFunc,z=[f];G=W.call.apply(W,[r.ctx].concat(z))}else{var H=Object.entries(f).map(function(q){var J=(0,ve.A)(q,2),Y=J[0],Z=J[1];return Z}).join(", ");G="".concat(d,"(").concat(H,")")}return G}};function Rf(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=P0(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function P0(n,e){if(n){if(typeof n=="string")return jf(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jf(n,e)}}function jf(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function xf(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function If(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?xf(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):xf(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var Df="${0}.compareTo(${1})",N0={datetime:!0,time:!0,date:!0},V0=function(e,r){return Pf(e,r,!1)},Pf=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={errors:[]},i=rn(r,void 0,!1),o=Nf(e,i,a,null);return t?[o,a.errors]:(a.errors.length&&console.warn("Errors while exporting to SpEL:",a.errors),o)},Nf=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(e){var i=e.get("type");if(i==="group"||i==="rule_group")return Mf(e,r,t,a);if(i==="rule")return G0(e,r,t,a);if(i=="switch_group")return M0(e,r,t,a);if(i=="case_group")return Vf(e,r,t,a)}},Vf=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=e.get("type");if(i!="case_group"){t.errors.push("Unexpected child of type ".concat(i," inside switch"));return}var o=e.get("properties")||new yt,s=Xl(r,o,t,null,a,"!case_value"),u=(0,ve.A)(s,3),l=u[0],c=u[1],d=u[2],f=Mf(e,r,t,a);return[f,l]},M0=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=e.get("properties")||new yt,o=e.get("children1");if(o){var s=o.map(function(m){return Vf(m,r,t,null)}).filter(function(m){return typeof m<"u"}).valueSeq().toArray();if(s.length){if(s.length==1&&!s[0][0])return s[0][1];for(var u=[],l=0;l<s.length;l++)l!=s.length-1&&!s[l][0]?t.errors.push("No condition for case ".concat(l)):(u.push(s[l]),l==s.length-1&&s[l][0]&&u.push([void 0,null]));for(var c="",d="",f=0;f<u.length;f++){var p=(0,ve.A)(u[f],2),g=p[0],h=p[1];h==null&&(h="null"),g==null&&(g="true"),f!=u.length-1?(c+="(".concat(g," ? ").concat(h," : "),d+=")"):c+="".concat(h)}return c+d}}},Mf=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=e.get("type"),o=e.get("properties")||new yt,s=o.get("mode"),u=e.get("children1")||new Jr,l=o.get("field"),c=o.get("conjunction");c||(c=da(r));var d=r.conjunctions[c],f=o.get("not"),p=i==="rule_group",g=p&&s!="struct",h=g?l:a,m=_e(r,h)||{},y=m.isSpelArray,S=r.settings.fieldSeparator,C=o.get("operator");!C&&(!s||s=="some")&&(C="some");var F=Gf(r,C,l),T=F!=C,w=C&&st(r,F,l)||null,_=p&&(!F||w.cardinality==0),M=Xl(r,o,t,F,a,null),D=(0,ve.A)(M,3),j=D[0],P=D[1],V=D[2],L=u.map(function(Z){return Nf(Z,r,t,h)}).filter(function(Z){return typeof Z<"u"});if(g&&!_){if(j==null)return}else if(!L.size)return;var U=p,B=L.size?d.spelFormatConj.call(r.ctx,L,c,f,U):null,G;if(g){var W=ec(t,r,l,a),z=S||".",H=z+(y?"length":"size()"),q="".concat(W).concat(H),J=B?"".concat(W,".?[").concat(B,"]").concat(H):q,Y=_?q:j;G=kf(t,r,o,J,Y,F,P,V,T)}else G=B;return G},k0=function(e,r,t){var a=r.spelOp;if(a){var i=a.includes("${0}"),o=N0[t],s=a,u,l=Jt(r);return o?u=function(d,f,p,g,h,m,y,S){var C=Df.replace(/\${(\w+)}/g,function(F,T){return T==0?d:l>1?p[T-1]:p});return"".concat(C," ").concat(s," 0")}:i?u=function(d,f,p,g,h,m,y,S){return a.replace(/\${(\w+)}/g,function(C,F){return F==0?d:l>1?p[F-1]:p})}:l==0?u=function(d,f,p,g,h,m,y,S){return"".concat(d," ").concat(s)}:l==1&&(u=function(d,f,p,g,h,m,y,S){return"".concat(d," ").concat(s," ").concat(p)}),u}},kf=function(e,r,t,a,i,o,s,u){var l=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,c=t.get("field"),d=st(r,o,c)||{},f=_e(r,c)||{},p=t.get("operatorOptions"),g=d.spelFormatOp||k0(o,d,u);if(!g){e.errors.push("Operator ".concat(o," is not supported"));return}var h=[a,o,i,s,u,Yr(d,Ci),p,f],m;return m=g.call.apply(g,[r.ctx].concat(h)),l&&(m=r.settings.spelFormatReverse.call(r.ctx,m)),m===void 0&&e.errors.push("Operator ".concat(o," is not supported for value source ").concat(s)),m},Gf=function(e,r,t){if(r){var a=st(e,r,t)||{},i=a.reversedOp,o=st(e,i,t)||{},s=!1,u=a.spelOp||a.spelFormatOp,l=o.spelOp||o.spelFormatOp;if(!(!u&&!l)){if(!u&&l){s=!0;var c=[i,r];r=c[0],i=c[1];var d=[o,a];a=d[0],o=d[1]}return r}}},G0=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=e.get("properties")||new yt,o=i.get("field"),s=i.get("fieldSrc"),u=i.get("operator");if(!(o==null||u==null)){var l=Gf(r,u,o);if(!l){t.errors.push("Operator ".concat(u," is not supported"));return}var c=l!=u,d=Xl(r,i,t,l,a,null),f=(0,ve.A)(d,3),p=f[0],g=f[1],h=f[2];if(p!==void 0){var m=$0(t,r,o,s,a);if(m!==void 0){var y=kf(t,r,i,m,p,l,g,h,c);return y}}}},$0=function(e,r,t,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;return a==="func"?$f(e,r,t,i):ec(e,r,t,i)},Xl=function(e,r,t,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,s=r.get("field"),u=r.get("valueSrc"),l=r.get("valueType");(o=="!case_value"||l&&l.get(0)=="case_value")&&(s="!case_value");var c=_e(e,s)||{},d=st(e,a,s)||{},f=Jt(d),p=r.get("value"),g=r.get("asyncListValues"),h=[],m=[],y;if(p!=null){var S=p.map(function(F,T){var w=u?u.get(T):null,_=l?l.get(T):null,M=Ha(F,w,e),D=Nt(e,s,a,w),j=br(e,s,a,D,w,{forExport:!0}),P=Zl(t,e,M,w,_,j,c,a,d,i,g);return P!==void 0&&(h.push(w),m.push(_)),P}),C=S.filter(function(F){return F===void 0}).size>0;S.size<f||C||(y=f>1?S.toArray():f==1?S.first():null)}return[y,h.length>1?h:h[0],m.length>1?m:m[0]]},Zl=function(e,r,t,a,i,o,s,u,l){var c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:null,d=arguments.length>10?arguments[10]:void 0;if(t!==void 0){var f;if(a==="field")f=ec(e,r,t,c);else if(a==="func")f=$f(e,r,t,c);else if(typeof o?.spelFormatValue=="function"){var p=o.spelFormatValue,g=[t,If(If({},wn()(s,["fieldSettings","listValues"])),{},{asyncListValues:d}),Yr(o,Ua)];if(u&&(g.push(u),g.push(l)),a=="field"){var h=_e(r,t)||{};g.push(h)}f=p.call.apply(p,[r.ctx].concat(g))}else f=Li(t);return f}},ec=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(t){var i=r.settings.fieldSeparator,o=_e(r,t)||{},s=Ut(t,r),u=bd(t,r,a),l=r.settings.formatSpelField,c=Qn(t,r,e,a),d=u.map(function(p){var g=(0,ve.A)(p,3),h=g[0],m=g[1],y=g[2],S;y&&(y.type=="!struct"||y.type=="!group"&&y.mode=="struct"?S=m.isSpelMap?"map":"class":y.type=="!group"?S=m.isSpelItemMap?"[map]":"[class]":S="class");var C=m?.isSpelVariable;return{key:h,parent:S,isSpelVariable:C,fieldSeparator:i}}),f=l.call(r.ctx,c,a,s,d,o,r);return f}},$f=function(e,r,t){var a,i,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,s=(a=t.get)===null||a===void 0?void 0:a.call(t,"func"),u=(i=t.get)===null||i===void 0?void 0:i.call(t,"args"),l=nr(r,s);if(!l){e.errors.push("Func ".concat(s," is not defined in config"));return}var c={},d=[],f=[];for(var p in l.args){var g,h,m=l.args[p],y=_e(r,m),S=m.defaultValue,C=m.isOptional,F=S!=null&&S.func?"func":"value",T=u?u.get(p):void 0,w=T?T.get("value"):void 0,_=T?T.get("valueSrc"):void 0;_!=="func"&&(g=w)!==null&&g!==void 0&&g.toJS&&(w=w.toJS());var M=T?T.get("asyncListValues"):void 0,D=(h=m.escapeForFormat)!==null&&h!==void 0?h:!0,j=null,P=Nt(r,m,j,_),V=br(r,m,j,P,_,{forExport:!0}),L=Zl(e,r,w,_,m.type,V,y,null,null,o,M);if(w!=null&&L===void 0){_!="func"&&e.errors.push("Can't format value of arg ".concat(p," for func ").concat(s));return}var U=void 0;if(L===void 0&&!C&&S!=null){var B=Nt(r,m,j,F),G=br(r,m,j,B,F,{forExport:!0});if(U=Zl(e,r,S,F,m.type,G,y,null,null,o,M),U===void 0){F!="func"&&e.errors.push("Can't format default value of arg ".concat(p," for func ").concat(s));return}}var W=L??U;if(W!==void 0){var z;if(d.length){var H=Rf(d),q;try{for(H.s();!(q=H.n()).done;){var J=q.value;c[J]=void 0}}catch(oe){H.e(oe)}finally{H.f()}d=[]}c[p]=D?W:(z=w)!==null&&z!==void 0?z:S}else C||f.push(p),d.push(p)}if(!f.length){var Y;if(typeof l.spelFormatFunc=="function"){var Z=l.spelFormatFunc,se=[c];Y=Z.call.apply(Z,[r.ctx].concat(se))}else if(l.spelFunc){Y=l.spelFunc.replace(/\${(\w+)}/g,function(oe,Se){var he;return(he=c[Se])!==null&&he!==void 0?he:oe});var re=Object.keys(l.args||{}).reverse().filter(function(oe){return!!l.args[oe].isOptional}),ee=Rf(re),Fe;try{for(ee.s();!(Fe=ee.n()).done;){var pe=Fe.value;if(c[pe]!=null)break;Y=Y.replace(new RegExp("(, )?\\${"+pe+"}","g"),"")}}catch(oe){ee.e(oe)}finally{ee.f()}Y=Y.replace(/\${(\w+)}/g,"null")}else e.errors.push("Func ".concat(s," is not supported"));return Y}};function Uf(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=U0(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function U0(n,e){if(n){if(typeof n=="string")return Bf(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bf(n,e)}}function Bf(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function Wf(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function zf(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Wf(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Wf(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var qf=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i={errors:[],settings:{isForDisplay:t,isDebugMode:a}},o=rn(r,void 0,!1),s=Hf(e,o,i,null);return i.errors.length&&console.warn("Errors while exporting to string:",i.errors),s},Hf=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(e){var i=e.get("type"),o=e.get("children1");if(i==="group"||i==="rule_group")return B0(e,r,t,a);if(i==="rule")return Qf(e,r,t,a)}},B0=function(e,r,t){var a,i,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,s=t.settings,u=s.isForDisplay,l=s.isDebugMode,c=e.get("type"),d=e.get("properties")||new yt,f=d.get("mode"),p=e.get("children1")||new Jr,g=c==="rule_group",h=g&&f=="array"?d.get("field"):null,m=c==="rule_group"?d.get("operator"):null,y=m?(a=(i=r.operators[m])===null||i===void 0?void 0:i.cardinality)!==null&&a!==void 0?a:1:void 0,S=g&&f==="array"&&y>=1,C=d.get("not"),F=p.map(function(L){return Hf(L,r,t,h)}).filter(function(L){return typeof L<"u"});if(!(!S&&!F.size&&!l)){var T=d.get("conjunction");T||(T=da(r));var w=r.conjunctions[T],_=F.size?w.formatConj.call(r.ctx,F,T,C,u):null,M;if(h){var D=Qf(e,r,t,o,!0);if(D){var j,P=D.pop(),V=[_].concat((0,ue.A)(D));M=(j=r.settings.formatAggr).call.apply(j,[r.ctx].concat((0,ue.A)(V))),P&&(M=r.settings.formatReverse.call(r.ctx,M,null,null,null,null,u))}}else M=_;return l&&M==null&&(M="?"),M}},W0=function(e,r,t,a,i){var o=t.settings,s=o.isForDisplay,u=o.isDebugMode,l=r.get("field"),c=r.get("valueSrc"),d=r.get("valueType"),f=_e(e,l)||{},p=a||r.get("operator"),g=st(e,p,l)||{},h=Jt(g),m=r.get("value"),y=r.get("asyncListValues"),S=[],C=[],F,T;if(m!=null){T=m.map(function(M,D){var j=c?c.get(D):null,P=d?d.get(D):null,V=u?M:Ha(M,j,e),L=Nt(e,l,p,j),U=br(e,l,p,L,j,{forExport:!0}),B=tc(e,t,V,j,P,U,f,p,g,i,y);return B!==void 0&&(S.push(j),C.push(P)),B});var w=T.filter(function(M){return M===void 0}).size>0,_=!w&&T.size===h;_&&(F=h==1?T.first():T)}return u&&!F&&(F=h>1?new Jr(Array.from({length:h}).map(function(M,D){var j,P;return(j=(P=T)===null||P===void 0?void 0:P.get(D))!==null&&j!==void 0?j:"?"})):"?"),[F,S.length>1?S:S[0],C.length>1?C:C[0]]},z0=function(e,r,t){var a=t.settings.isDebugMode,i=r?.labelForFormat||e,o=Jt(r),s;return o==0?s=function(l,c,d,f,p,g,h,m){return"".concat(l," ").concat(i)}:o==1?s=function(l,c,d,f,p,g,h,m){return a&&c==="?"&&d==="?"?l&&l!=="?"?"".concat(l," ?"):"?":"".concat(l," ").concat(i," ").concat(d)}:o==2&&(s=function(l,c,d,f,p,g,h,m){var y,S,C=d==null||(y=d.first)===null||y===void 0?void 0:y.call(d),F=d==null||(S=d.get)===null||S===void 0?void 0:S.call(d,1);return"".concat(l," ").concat(i," ").concat(C," AND ").concat(F)}),s},Qf=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=t.settings,s=o.isForDisplay,u=o.isDebugMode,l=e.get("properties")||new yt,c=l.get("field"),d=l.get("fieldSrc"),f=l.get("operator"),p=l.get("operatorOptions");if(!((c==null||f==null)&&!u)){var g=_e(r,c)||{},h=st(r,f,c)||{},m=h.reversedOp,y=st(r,m,c)||{},S=!1,C=h.formatOp;if(!C&&m&&(C=y.formatOp,C)){S=!0;var F=[m,f];f=F[0],m=F[1];var T=[y,h];h=T[0],y=T[1]}if(u&&!f&&(f="?"),C||(C=z0(f,h,t)),!!C){var w=d==="func"?Yf(r,t,c,a):Jf(r,t,c,a);if(w!=null){var _=W0(r,l,t,f,a),M=(0,ve.A)(_,3),D=M[0],j=M[1],P=M[2];if(D!==void 0){var V=[w,f,D,j,P,Yr(h,Ci),p,s,g,S];if(i)return V;var L,U=(L=C).call.apply(L,[r.ctx].concat(V));return S&&(U=r.settings.formatReverse.call(r.ctx,U,f,m,h,y,s)),U}}}}},tc=function(e,r,t,a,i,o,s,u,l){var c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:null,d=arguments.length>10?arguments[10]:void 0,f=r.settings,p=f.isForDisplay,g=f.isDebugMode;if(t===void 0)return g?o?.jsType==="array"?[]:"?":void 0;var h;if(a=="field")h=Jf(e,r,t,c);else if(a=="func")h=Yf(e,r,t,c);else if(t==null)h=void 0;else if(typeof o?.formatValue=="function"){var m,y=o.formatValue,S=[t,zf(zf({},wn()(s,["fieldSettings","listValues"])),{},{asyncListValues:d}),Yr(o,Ua),p];if(u&&(S.push(u),S.push(l)),a=="field"){var C=_e(e,t)||{};S.push(C)}var F=(m=s?.escapeForFormat)!==null&&m!==void 0?m:!0;F?h=y.call.apply(y,[e.ctx].concat(S)):h=t}else h=t;return h},Jf=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=r.settings,s=o.isForDisplay,u=o.isDebugMode,l=e.settings,c=l.fieldSeparator,d=l.fieldSeparatorDisplay,f=null;if(t){var p=_e(e,t)||{},g=Ut(t,e),h=Io(t,e,i?a:null),m=h?h.join(d):null,y=p.label2||m,S=e.settings.formatField,C=Qn(t,e,r,i?a:null,{useTableName:!0});f=S(C,g,y,p,e,s)}else u&&(f="?");return f},Yf=function(e,r,t){var a,i,o,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=r.settings,l=u.isForDisplay,c=u.isDebugMode,d=t==null||(a=t.get)===null||a===void 0?void 0:a.call(t,"func");if(!d)return c?"?()":void 0;var f=(i=t.get)===null||i===void 0?void 0:i.call(t,"args"),p=nr(e,d);if(!p&&!c){r.errors.push("Func ".concat(d," is not defined in config"));return}var g=Ut(d,e),h=g[g.length-1],m=l&&p?.label||h,y={},S=[],C=[],F={},T=p?Object.keys(p.args||{}):(f==null||(o=f.keySeq)===null||o===void 0?void 0:o.call(f).toArray())||[],w=Uf(T),_;try{for(w.s();!(_=w.n()).done;){var M,D=_.value,j=p?.args[D],P=_e(e,j),V=j||{},L=V.defaultValue,U=V.isOptional,B=L!=null&&L.func?"func":"value",G=br(e,j,void 0,void 0,B,{forExport:!0}),W=l&&j?.label||D,z=f?f.get(D):void 0,H=z?z.get("value"):void 0,q=z?z.get("valueSrc"):void 0;q!=="func"&&(M=H)!==null&&M!==void 0&&M.toJS&&(H=H.toJS());var J=z?z.get("asyncListValues"):void 0,Y=tc(e,r,H,q,j?.type,G,j,null,null,s,J);H!=null&&Y===void 0&&q!="func"&&r.errors.push("Can't format value of arg ".concat(D," for func ").concat(d));var Z=void 0;if(Y===void 0&&!U&&L!=null&&(Z=tc(e,r,L,B,j?.type,G,j,null,null,s,J),Z===void 0)){B!="func"&&r.errors.push("Can't format default value of arg ".concat(D," for func ").concat(d));return}var se=Y??Z;if(se!==void 0){if(S.length){var re=Uf(D),ee;try{for(re.s();!(ee=re.n()).done;){var Fe=(0,ve.A)(ee.value,2),pe=Fe[0],oe=Fe[1];y[pe]=void 0}}catch(Ae){re.e(Ae)}finally{re.f()}S=[]}y[D]=se,F[W]=se}else U||C.push(D),S.push([D,W])}}catch(Ae){w.e(Ae)}finally{w.f()}if(!(C.length&&!c)){var Se=null;if(typeof p?.formatFunc=="function"){var he=p.formatFunc,be=[y,l];Se=he.call.apply(he,[e.ctx].concat(be))}else{var Le=Object.entries(l?F:y).map(function(Ae){var ke=(0,ve.A)(Ae,2),Ve=ke[0],Re=ke[1];return l?"".concat(Ve,": ").concat(Re):"".concat(Re)}).join(", ");Se="".concat(m,"(").concat(Le,")")}return Se}};function Kf(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Xf(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Kf(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Kf(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function q0(n){if(n==null)return null;var e=n.split(",").map(Number);return{top_left:{lat:e[0],lon:e[1]},bottom_right:{lat:e[2],lon:e[3]}}}function H0(n,e){if(n.length>1)return{gte:"".concat(n[0]),lte:"".concat(n[1])};var r=n[0];switch(e){case"on_date":case"not_on_date":case"equal":case"select_equals":case"not_equal":return{gte:"".concat(r,"||/d"),lte:"".concat(r,"||+1d")};case"less_or_equal":return{lte:"".concat(r)};case"greater_or_equal":return{gte:"".concat(r)};case"less":return{lt:"".concat(r)};case"greater":return{gt:"".concat(r)};default:return}}function Q0(n){return{value:"*"+n+"*"}}function J0(n,e){switch(n){case"AND":return e?"must_not":"must";case"OR":return e?"should_not":"should";case"NOT":return e?"must":"must_not";default:return}}function Y0(n){return{value:n}}function K0(n,e){return n}function X0(n,e,r,t,a,i){var o=K0(t,a);switch(n){case"filter":return{script:a.operators[r].elasticSearchScript(t,e)};case"exists":return{field:t};case"match":return(0,X.A)({},o,e[0]);case"term":return i===eb?(0,X.A)({},t,{value:e[0]}):(0,X.A)({},t,e[0]);case"geo_bounding_box":return(0,X.A)({},t,q0(e[0]));case"range":return(0,X.A)({},t,H0(e,r));case"wildcard":return(0,X.A)({},t,Q0(e[0]));case"regexp":return(0,X.A)({},t,Y0(e[0]));default:return}}function Zf(n,e,r,t,a,i){if(!(!n||!r||e==null)){var o=r,s=t.operators[o];if(s){var u=s,l=u.elasticSearchQueryType,c=!1;if(!l&&s.reversedOp){c=!0,o=s.reversedOp,s=t.operators[o];var d=s;l=d.elasticSearchQueryType}var f=Nt(t,n,o,a),p=t.widgets[f];if(p){var g=p.elasticSearchFormatValue,h;if(typeof l=="function"?h=l(f):h=l,!!h){var m;return typeof g=="function"?m=g(h,e,o,n,t):m=X0(h,e,o,n,t,i),c?{bool:{must_not:(0,X.A)({},h,Xf({},m))}}:(0,X.A)({},h,Xf({},m))}}}}}function Z0(n,e,r,t,a,i){if(!(!n||!n.size)){var o=n.valueSeq().toArray(),s=J0(e,r),u=o.map(function(c){return t(c,a,i)}).filter(function(c){return c!==void 0});if(u.length){var l=u.flat(1/0);return{bool:(0,X.A)({},s,l)}}}}var eb="ES_7_SYNTAX",tb="ES_6_SYNTAX";function ep(n,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:tb,t=rn(e,void 0,!1);if(n){var a=n.get("type"),i=n.get("properties")||new Map;if(a==="rule"&&i.get("field")){var o,s,u,l=i.get("operator"),c=i.get("field"),d=i.get("fieldSrc"),f=(o=i.get("value"))===null||o===void 0?void 0:o.toJS(),p=(s=i.get("valueType"))===null||s===void 0?void 0:s.get(0),g=(u=i.get("valueSrc"))===null||u===void 0?void 0:u.get(0);return g==="func"||d=="func"?void 0:f&&Array.isArray(f[0])?f[0].map(function(S){return Zf(c,[S],l,t,g,r)}):Zf(c,f,l,t,g,r)}if(a==="group"||a==="rule_group"){var h=i.get("not"),m=i.get("conjunction");m||(m=da(t));var y=n.get("children1");return Z0(y,m,h,ep,t,r)}}}var rb=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(e){var a=e;return a=a.toJS(),a=Od(a,r,t),a}},rc=function(e){if(tp(e))return e;if(rp(e))return gn(Ai(e));if(typeof e=="string"&&e.startsWith('["~#iM"'))throw new Error("You are trying to load query in obsolete serialization format (Immutable string) which is not supported in versions starting from 2.1.17");if(typeof e=="string")return gn(Ai(JSON.parse(e)));throw new Error("Can't load tree!")},tp=function(e){return yt.isMap(e)},rp=function(e){return(0,ft.A)(e)=="object"&&(e.type=="group"||e.type=="switch_group")},np=$(87695);function ap(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function _n(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ap(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):ap(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function nc(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=nb(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function nb(n,e){if(n){if(typeof n=="string")return ip(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ip(n,e)}}function ip(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}var ab=function(e){return Array.from(new Set(e))},op="jlField",sp="jlArgs",ib=["==","!="],ob=["<","<=",">",">="],up=["in","!in"],sb=["multiselect_equals","multiselect_not_equals","multiselect_contains","multiselect_not_contains"],lp=function(e){return{errors:[],settings:e?.settings}},ub=function(e,r){return cp(e,r,!1)},cp=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=lp();a.settings={allowUnknownFields:!1,returnErrors:t};var i=rn(r,void 0,!1),o=lb(i),s=e?Ri(e,o,i,["rule","group","switch"],a):void 0,u=s?rc(s):void 0;return a.errors=Array.from(new Set(a.errors)),t?[u,a.errors]:(a.errors.length&&console.warn("Errors while importing from JsonLogic:",a.errors),u)},lb=function(e){var r={},t={};for(var a in e.operators){var i=e.operators[a];if(typeof i.jsonLogic=="string"){var o=i.jsonLogic+"/"+Jt(i);r[o]||(r[o]=[]),r[o].push(a)}else if(typeof i.jsonLogic2=="string"){var s=i.jsonLogic2.startsWith("#"),u=(""+i.jsonLogic2).replace(/^#/,""),l=u+"/"+Jt(i);r[l]||(r[l]=[]),r[l].push(a),t[a]||(t[a]={}),t[a]={template:i.jsonLogic(op,a,sp),jsonLogic2:u,_jsonLogicIsExclamationOp:!!i._jsonLogicIsExclamationOp,isRevArgs:s}}}var c={};for(var d in e.conjunctions){var f=e.conjunctions[d],p=f.jsonLogicConj||d.toLowerCase();c[p]=d}var g={},h=nc(jo(e)),m;try{for(h.s();!(m=h.n()).done;){var y=(0,ve.A)(m.value,2),S=y[0],C=y[1],F=void 0;C.jsonLogicIsMethod?F="#"+C.jsonLogic:typeof C.jsonLogic=="string"&&(F=C.jsonLogic),F&&(g[F]||(g[F]=[]),g[F].push(S))}}catch(M){h.e(M)}finally{h.f()}var T=e.settings.jsonLogic,w=T.groupVarKey,_=T.altVarKey;return{operators:r,conjunctions:c,funcs:g,varKeys:["var",w,_],combinationOperators:t}},ac=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i;if(r!=null&&r.combinationOperators)for(var o=0,s=Object.entries(r.combinationOperators);o<s.length;o++){var u=(0,ve.A)(s[o],2),l=u[0],c=u[1];if(a==null||a.includes(l)){var d=cb(c.template,e);d.match&&(i?t.errors.push("Operator matched against 2 templates: ".concat(i.newOp," and ").concat(l)):i=d,i.newOp=c.jsonLogic2)}}return i},cb=function n(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{match:!0,jlField:null,jlArgs:[]};if(e==null||r==null)return t.match=!1,t;var a=Object.keys(e),i=Object.keys(r);if(a.length!==i.length)return t.match=!1,t;t.vals=[];for(var o=0;o<a.length;o++){var s=a[o],u=e[s];if(t.vals.push(r[s]),s!==i[o])return t.match=!1,t;if(u===op&&Ir(r[s]))t.jlField=r[s];else if(u===sp)t.jlArgs.push(r[s]);else if((0,ft.A)(u)==="object"&&u!==null||Array.isArray(u))t=n(u,r[s],t);else if(u!==r[s])return t.match=!1,t}return t},Ri=function n(e,r,t,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,s=arguments.length>6?arguments[6]:void 0,u=arguments.length>7?arguments[7]:void 0,l=arguments.length>8&&arguments[8]!==void 0?arguments[8]:null,c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,d,f;Ir(e)&&(d=Object.keys(e)[0],f=e[d],Array.isArray(f)||(f=[f]));var p,g=i.errors.length,h=t.settings.jsonLogic.lockedOp,m=d=="!"&&f.length==1&&f[0]&&Ir(f[0])&&r.varKeys.includes(Object.keys(f[0])[0]),y=ac(e,r,i);y&&(f=[],f[0]=y.jlField,y.jlArgs.forEach(function(_){return f.push(_)}),d=y.newOp,up.includes(d)&&(f=y.vals));var S=d=="!"&&!m,C=h&&d==h,F=a.includes("switch"),T=F;C?p=n(f[0],r,t,a,i,o,s,u,l,!0):S?p=n(f[0],r,t,a,i,!o,s,u,l):a.includes("val")?p=dp(d,f,r,t,o,i,l)||fp(d,f,r,t,o,s,i,l)||db(e,s,u,t,i):(a.includes("switch")&&(p=bb(d,f,r,t,o,i,l)),p==null&&a.includes("group")&&(p=pp(d,f,r,t,o,i,l,!1)),p==null&&a.includes("rule")&&(p=yb(d,f,r,t,o,i,l)),p&&T&&!["group","switch_group"].includes(p.type)&&(p=No(p,t)));var w=i.errors.length;return d!="!"&&p===void 0&&w==g&&i.errors.push("Can't parse logic ".concat(JSON.stringify(e))),C&&(p.properties.isLocked=!0),p},db=function(e,r,t,a,i){var o;if(e===void 0&&(e=r?.defaultValue),e!==void 0){t=t||r?.mainWidget;var s=a.widgets[t],u=r?.type;if(u&&!s){i.errors.push("No widget for type ".concat(u));return}if(Ir(e)){i.errors.push("Unexpected logic in value: ".concat(JSON.stringify(e)));return}if(s!=null&&s.jsonLogicImport)try{var l;e=s.jsonLogicImport.call(a.ctx,e,_n(_n({},s),(l=r?.fieldSettings)!==null&&l!==void 0?l:{}))}catch(w){var c;i.errors.push("Can't import value ".concat(e," using import func of widget ").concat(t,": ").concat((c=w?.message)!==null&&c!==void 0?c:w)),e=void 0}else{if(u==="time"&&typeof e=="number"){var d=Math.floor(e/60/60)%24,f=Math.floor(e/60)%60,p=e%60,g=s.valueFormat;if(g){var h=new Date(e);h.setMilliseconds(0),h.setHours(d),h.setMinutes(f),h.setSeconds(p),e=Ga()(h).format(g)}else e="".concat(d,":").concat(f,":").concat(p)}if(["date","datetime"].includes(u)&&e&&!(e instanceof Date))try{var m=typeof e=="number"||typeof e=="string"&&!isNaN(e),y=m&&typeof e=="string"?parseInt(e):e,S=new Date(m?y:e);if(S instanceof Date&&(e=S),isNaN(S))throw new Error("Invalid date")}catch{i.errors.push("Can't convert value ".concat(e," as Date")),e=void 0}}if(e instanceof Date&&r){var C=s.valueFormat;C&&(e=Ga()(e).format(C))}var F;if(e&&r!==null&&r!==void 0&&(o=r.fieldSettings)!==null&&o!==void 0&&o.asyncFetch){var T=Array.isArray(e)?e:[e];F=T}return{valueSrc:"value",value:e,valueType:s?.type,asyncListValues:F}}},dp=function(e,r,t,a,i,o){var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;if(t.varKeys.includes(e)&&typeof r[0]=="string"){var u,l=pd(a,r[0],s),c=_e(a,l);if(!c&&!((u=o.settings)!==null&&u!==void 0&&u.allowUnknownFields)){o.errors.push("No config for field ".concat(l));return}return{valueSrc:"field",value:l,valueType:c?.type}}},fb=function(e,r,t,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,u=arguments.length>7?arguments[7]:void 0,l=arguments.length>8&&arguments[8]!==void 0?arguments[8]:null,c=Object.keys(r)[0],d=Object.values(r)[0],f=function(G,W){return pb(G,W,a,i,o,u,l)||vb(G,W,a,i,o,s,u,l)},p=u.errors.length,g,h,m,y,S=f(c,d);if(S&&(g=S.field,h=S.fieldSrc),e&&(y=!0,m=t[0],t=[]),c=="reduce"&&Array.isArray(d)&&d.length==3){var C=d,F=(0,ve.A)(C,3),T=F[0],w=F[1],_=F[2];if(Ir(T)&&_==0&&Ir(w)&&Array.isArray(w["+"])&&w["+"][0]==1&&Ir(w["+"][1])&&w["+"][1].var=="accumulator")if(c=Object.keys(T)[0],d=Object.values(T)[0],c=="filter"){var M=d,D=(0,ve.A)(M,2),j=D[0],P=D[1];if(Ir(j)){c=Object.keys(j)[0],d=Object.values(j)[0];var V=f(c,d);V&&(g=V.field,h=V.fieldSrc,m=P,y=!0)}}else{var L=f(c,d);L&&(g=L.field,h=L.fieldSrc,y=!0)}}var U=u.errors.length;if(!g&&U==p&&u.errors.push("Unknown LHS ".concat(JSON.stringify(r))),!!g)return{field:g,fieldSrc:h,having:m,isGroup:y,args:t}},pb=function(e,r,t,a,i,o){var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;Array.isArray(r)||(r=[r]);var u=dp(e,r,t,a,i,o,s);if(u)return{fieldSrc:"field",field:u.value}},vb=function(e,r,t,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,s=arguments.length>6?arguments[6]:void 0,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null,l=fp(e,r,t,a,i,o,s,u);if(l)return{fieldSrc:"func",field:l.value}},fp=function(e,r,t,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,s=arguments.length>6?arguments[6]:void 0,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null;if(e){var l,c,d,f=e=="method";if(f){var p,g,h=(0,np.A)(r);p=h[0],l=h[1],g=h.slice(2),c=[p].concat((0,ue.A)(g))}else l=e,c=r;var m=(f?"#":"")+l,y=o?.type||o?.returnType,S=(t.funcs[m]||[]).filter(function(W){return o?nr(a,W).returnType==y:!0});if(S.length)d=S[0];else{var C=(0,X.A)({},e,r),F=nc(jo(a)),T;try{for(F.s();!(T=F.n()).done;){var w=(0,ve.A)(T.value,2),_=w[0],M=w[1];if(M.jsonLogicImport&&(!y||M.returnType==y)){var D=void 0;try{D=M.jsonLogicImport.call(a.ctx,C)}catch{}D&&(d=_,c=D)}}}catch(W){F.e(W)}finally{F.f()}}if(d&&d){var j=nr(a,d),P=Object.keys(j.args||{}),V=c.reduce(function(W,z,H){var q=P[H],J=j.args[q],Y;return J&&(Y=Ri(z,t,a,["val"],s,!1,J,null,u)),Y!==void 0?_n(_n({},W),{},(0,X.A)({},q,Y)):W},{});for(var L in j.args){var U=j.args[L],B=V[L];if(B===void 0){if(B=U?.defaultValue,B!==void 0){var G;B={value:B,valueSrc:(G=B)!==null&&G!==void 0&&G.func?"func":"value",valueType:U.type}}if(B===void 0){if(!(U!=null&&U.isOptional)){s.errors.push("No value for arg ".concat(L," of func ").concat(d));return}}else V[L]=B}}return{valueSrc:"func",value:{func:d,args:V},valueType:j.returnType}}}},pp=function(e,r,t,a,i,o){var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1,l=t.conjunctions[e],c=a.settings.fieldSeparator;if(l){var d="group",f=r.map(function(C){return Ri(C,t,a,["rule","group"],o,!1,null,null,s)}).filter(function(C){return C!==void 0}).reduce(function(C,F){return _n(_n({},C),{},(0,X.A)({},F.id,F))},{}),p=Object.values(f).map(function(C){var F,T;return(C==null||(F=C.properties)===null||F===void 0?void 0:F.fieldSrc)=="field"&&(C==null||(T=C.properties)===null||T===void 0?void 0:T.field)}).filter(function(C){var F;return C==null||(F=C.includes)===null||F===void 0?void 0:F.call(C,c)}),g=Object.fromEntries(ab(p).map(function(C){var F=C.split(c),T=Object.fromEntries(F.slice(0,-1).map(function(w,_,M){return[].concat((0,ue.A)(M.slice(0,_)),[w])}).map(function(w){return[w.join(c),_e(a,w)]}).filter(function(w){var _=(0,ve.A)(w,2),M=_[0],D=_[1];return D?.type=="!group"}));return[C,Object.keys(T)]})),h={conjunction:l,not:i},m=Tt(),y={},S={};return Object.entries(f).map(function(C){var F=(0,ve.A)(C,2),T=F[0],w=F[1];if(w?.type=="group"||w?.type=="rule_group")y[T]=w;else{var _,M=w==null||(_=w.properties)===null||_===void 0?void 0:_.field,D=g[M]||[],j=D[D.length-1];if(!j)w&&(y[T]=w);else{var P=y,V=Ut(s,a),L=Ut(j,a),U=To(V,L.slice(0,V.length));U||(V=[]);var B=j.split(c).slice(V.length).map(function(G,W,z){return[].concat((0,ue.A)(V),(0,ue.A)(z.slice(0,W)),[G]).join(c)}).map(function(G){return{f:G,fc:_e(a,G)||{}}}).filter(function(G){var W=G.fc;return W.type!="!struct"});B.map(function(G,W){var z=G.f,H=G.fc,q=S[z];q||(q=Tt(),S[z]=q,P[q]={type:"rule_group",id:q,children1:{},properties:{conjunction:l,not:!1,field:z,fieldSrc:"field",mode:H.mode}}),P=P[q].children1}),P[T]=w}}}),{type:d,id:m,children1:y,properties:h}}},gb=function(e,r,t,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(e)return{type:"rule_group",id:Tt(),children1:(0,X.A)({},e.id,e),properties:{conjunction:i||fa(a,t),not:o,field:r}}},No=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return{type:"group",id:Tt(),children1:(0,X.A)({},e.id,e),properties:{conjunction:fa(r),not:t}}},hb=function(e,r,t,a,i,o,s){var u=lp(s),l=mb(e,r,t,a,i,o,u);if(!l){s.errors.push(Array.from(new Set(u.errors)).join("; ")||"Unknown op ".concat(e,"/").concat(r));return}return l},mb=function(e,r,t,a,i,o,s){var u=sb.map(function(B){var G;return(G=o.operators[B])===null||G===void 0?void 0:G.jsonLogic2}).includes(e),l=o.settings.groupOperators.includes(e)&&!u,c=l?0:r-1;l?c=0:ib.includes(e)&&c==1&&t[1]===null&&(r=1,c=0,t=[t[0]]);var d=e+"/"+c,f=i.operators[d];if(f){var p=[],g=nc(f),h;try{for(g.s();!(h=g.n()).done;){var m,y,S=h.value,C=void 0,F=[];if(ob.includes(e)&&r==3)C=t[1],F=[t[0],t[2]];else{var T=t,w=(0,np.A)(T);C=w[0],F=w.slice(1)}if((m=i.combinationOperators[S])!==null&&m!==void 0&&m.isRevArgs&&(C=t[t.length-1],F=t.slice(0,t.length-1)),!!Ir(C)){var _=fb(l,C,F,i,o,null,null,s,a);if(_){var M=_.field,D=_.fieldSrc,j=_.having,P=_.isGroup,V=_.args,L=_e(o,M);if(!L&&!((y=s.settings)!==null&&y!==void 0&&y.allowUnknownFields)){s.errors.push("No config for LHS ".concat(M));return}var U=L?.operators&&L.operators.includes(S);p.push({field:M,fieldSrc:D,fieldConfig:L,opKey:S,args:V,having:j,isValidOp:U})}}}}catch(B){g.e(B)}finally{g.f()}return p.sort(function(B){var G=B.isValidOp;return G?-1:1}),p[0]}},yb=function n(e,r,t,a,i,o){var s,u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1;if(e){var c=Object.values(a.conjunctions).map(function(ee){var Fe=ee.jsonLogicConj;return Fe}),d=r.length,f=hb(e,d,r,u,t,a,o);if(f){var p=f.field,g=f.fieldSrc,h=f.fieldConfig,m=f.opKey,y=f.args,S=f.having,C=_e(a,u),F=a.operators[m],T=a.operators[(s=F)===null||s===void 0?void 0:s.reversedOp],w=!1,_=!!T,M=h.type=="!group",D=C?.type=="!group",j=_&&(!!a.settings.reverseOperatorsForNot||w||M&&!S||!M&&D&&!l),P=i&&j||w,V,L,U=!1,B=!!a.settings.reverseOperatorsForNot;if(h?.type=="!group"&&S){V=Object.keys(S)[0],L=S[V],Array.isArray(L)||(L=[L]);for(var G=ac(S,t,o);V=="!"&&!G;){var W=V=="!"&&L.length==1&&L[0]&&Ir(L[0])&&t.varKeys.includes(Object.keys(L[0])[0]);if(W)break;U=!U,S=S["!"],V=Object.keys(S)[0],L=S[V],B&&c.includes(V)&&L.length==1&&(S=S[V][0],V=Object.keys(S)[0],L=S[V]);var z=ac(S,t,o);G=z||G}Array.isArray(L)||(L=[L]),G&&(L=[],L[0]=G.jlField,G.jlArgs.forEach(function(ee){return L.push(ee)}),V=G.newOp,up.includes(G.newOp)&&(L=G.vals))}P&&(i=!i,m=F.reversedOp,F=a.operators[m]);var H=Nt(a,p,m,null),q=y.map(function(ee){return Ri(ee,t,a,["val"],o,!1,h,H,u)});if(!q.filter(function(ee){return ee===void 0}).length){var J,Y=h?.type;if((Y==="!group"||Y==="!struct")&&(Y=null),h?.type=="!group"&&S){if(t.conjunctions[V]!==void 0)J=pp(V,L,t,a,U,o,p,!0);else if(J=n(V,L,t,a,U,o,p,!0),J){var Z;J.type==="rule_group"&&((Z=J.properties)===null||Z===void 0?void 0:Z.field)!==p&&(J=gb(J,p,h,a)),Object.assign(J.properties,{conjunction:fa(a,h)})}if(!J)return;J.type="rule_group",Object.assign(J.properties,{field:p,mode:h.mode,operator:m}),h.mode=="array"&&Object.assign(J.properties,{value:q.map(function(ee){return ee.value}),valueSrc:q.map(function(ee){return ee.valueSrc}),valueType:q.map(function(ee){return ee.valueType})}),i&&(J=No(J,a,i))}else if(h?.type=="!group"&&!S)J={type:"rule_group",id:Tt(),children1:{},properties:{conjunction:fa(a,h),not:!1,mode:h.mode,field:p,operator:m}},h.mode==="array"&&Object.assign(J.properties,{value:q.map(function(ee){return ee.value}),valueSrc:q.map(function(ee){return ee.valueSrc}),valueType:q.map(function(ee){return ee.valueType})}),i&&(J=No(J,a,i));else{var se=q.map(function(ee){return ee.asyncListValues}).filter(function(ee){return ee!=null}),re=se.length?se[0]:void 0;J={type:"rule",id:Tt(),properties:_n({field:p,fieldSrc:g,operator:m,value:q.map(function(ee){return ee.value}),valueSrc:q.map(function(ee){return ee.valueSrc}),valueType:q.map(function(ee){return ee.valueType})},re?{asyncListValues:re}:{})},(i||l)&&(J=No(J,a,i))}return J}}}},bb=function(e,r,t,a,i,o){var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;if(e?.toLowerCase()==="if"){var u=Sb(r),l=u.map(function(f){var p=(0,ve.A)(f,2),g=p[0],h=p[1];return[g?Ri(g,t,a,["rule","group"],o,!1,null,null,s):null,Fb(a,o,t,h)]}),c=l.map(function(f){var p=(0,ve.A)(f,2),g=p[0],h=p[1];return Ob(g,h,a,o)}),d={type:"switch_group",id:Tt(),children1:c,properties:{}};return d}},Sb=function(e){var r=[];function t(a){var i=(0,ve.A)(a,3),o=i[0],s=i[1],u=i[2];r.push([o,s]);var l=Ir(u)?Object.keys(u)[0]:null;l?.toLowerCase()==="if"?t(u[l]):r.push([void 0,u])}return t(e),r},Ob=function(e,r,t,a){var i;return e?(i=_n({},e),i.type?(i.type!="group"&&(i=No(i,t)),i.type="case_group"):(a.errors.push("Unexpected case: ".concat(JSON.stringify(i))),i=void 0)):i={id:Tt(),type:"case_group",properties:{}},i&&(i.properties=_n(_n({},i.properties),r)),i},Fb=function(e,r,t,a){var i=_e(e,"!case_value");if(!i){r.errors.push("Missing caseValueField in settings");return}var o=i.mainWidget,s=e.widgets[o];if(!s){r.errors.push("No widget ".concat(o," for case value"));return}var u=Ri(a,t,e,["val","case_val"],r,!1,i,o);if(u!=null){var l=u.value,c=u.valueSrc,d=u.valueType,f={value:[l],valueSrc:[c??"value"],valueType:[d??s?.type],field:"!case_value"};return f}},Cb=$(21450),Eb=$(90179),vu=$.n(Eb);const Ye=n=>typeof n=="string",Vo=()=>{let n,e;const r=new Promise((t,a)=>{n=t,e=a});return r.resolve=n,r.reject=e,r},vp=n=>n==null?"":""+n,wb=(n,e,r)=>{n.forEach(t=>{e[t]&&(r[t]=e[t])})},Ab=/###/g,gp=n=>n&&n.indexOf("###")>-1?n.replace(Ab,"."):n,hp=n=>!n||Ye(n),Mo=(n,e,r)=>{const t=Ye(e)?e.split("."):e;let a=0;for(;a<t.length-1;){if(hp(n))return{};const i=gp(t[a]);!n[i]&&r&&(n[i]=new r),Object.prototype.hasOwnProperty.call(n,i)?n=n[i]:n={},++a}return hp(n)?{}:{obj:n,k:gp(t[a])}},mp=(n,e,r)=>{const{obj:t,k:a}=Mo(n,e,Object);if(t!==void 0||e.length===1){t[a]=r;return}let i=e[e.length-1],o=e.slice(0,e.length-1),s=Mo(n,o,Object);for(;s.obj===void 0&&o.length;)i=`${o[o.length-1]}.${i}`,o=o.slice(0,o.length-1),s=Mo(n,o,Object),s&&s.obj&&typeof s.obj[`${s.k}.${i}`]<"u"&&(s.obj=void 0);s.obj[`${s.k}.${i}`]=r},Tb=(n,e,r,t)=>{const{obj:a,k:i}=Mo(n,e,Object);a[i]=a[i]||[],a[i].push(r)},gu=(n,e)=>{const{obj:r,k:t}=Mo(n,e);if(r)return r[t]},_b=(n,e,r)=>{const t=gu(n,r);return t!==void 0?t:gu(e,r)},yp=(n,e,r)=>{for(const t in e)t!=="__proto__"&&t!=="constructor"&&(t in n?Ye(n[t])||n[t]instanceof String||Ye(e[t])||e[t]instanceof String?r&&(n[t]=e[t]):yp(n[t],e[t],r):n[t]=e[t]);return n},ji=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Lb={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Rb=n=>Ye(n)?n.replace(/[&<>"'\/]/g,e=>Lb[e]):n;class jb{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const r=this.regExpMap.get(e);if(r!==void 0)return r;const t=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,t),this.regExpQueue.push(e),t}}const xb=[" ",",","?","!",";"],Ib=new jb(20),Db=(n,e,r)=>{e=e||"",r=r||"";const t=xb.filter(o=>e.indexOf(o)<0&&r.indexOf(o)<0);if(t.length===0)return!0;const a=Ib.getRegExp(`(${t.map(o=>o==="?"?"\\?":o).join("|")})`);let i=!a.test(n);if(!i){const o=n.indexOf(r);o>0&&!a.test(n.substring(0,o))&&(i=!0)}return i},ic=function(n,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!n)return;if(n[e])return n[e];const t=e.split(r);let a=n;for(let i=0;i<t.length;){if(!a||typeof a!="object")return;let o,s="";for(let u=i;u<t.length;++u)if(u!==i&&(s+=r),s+=t[u],o=a[s],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&u<t.length-1)continue;i+=u-i+1;break}a=o}return a},hu=n=>n&&n.replace("_","-"),Pb={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){console&&console[n]&&console[n].apply(console,e)}};class mu{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,r)}init(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=r.prefix||"i18next:",this.logger=e||Pb,this.options=r,this.debug=r.debug}log(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return this.forward(r,"log","",!0)}warn(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return this.forward(r,"warn","",!0)}error(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return this.forward(r,"error","")}deprecate(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return this.forward(r,"warn","WARNING DEPRECATED: ",!0)}forward(e,r,t,a){return a&&!this.debug?null:(Ye(e[0])&&(e[0]=`${t}${this.prefix} ${e[0]}`),this.logger[r](e))}create(e){return new mu(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new mu(this.logger,e)}}var Ln=new mu;class yu{constructor(){this.observers={}}on(e,r){return e.split(" ").forEach(t=>{this.observers[t]||(this.observers[t]=new Map);const a=this.observers[t].get(r)||0;this.observers[t].set(r,a+1)}),this}off(e,r){if(this.observers[e]){if(!r){delete this.observers[e];return}this.observers[e].delete(r)}}emit(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),a=1;a<r;a++)t[a-1]=arguments[a];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(o=>{let[s,u]=o;for(let l=0;l<u;l++)s(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(o=>{let[s,u]=o;for(let l=0;l<u;l++)s.apply(s,[e,...t])})}}class bp extends yu{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const r=this.options.ns.indexOf(e);r>-1&&this.options.ns.splice(r,1)}getResource(e,r,t){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator,o=a.ignoreJSONStructure!==void 0?a.ignoreJSONStructure:this.options.ignoreJSONStructure;let s;e.indexOf(".")>-1?s=e.split("."):(s=[e,r],t&&(Array.isArray(t)?s.push(...t):Ye(t)&&i?s.push(...t.split(i)):s.push(t)));const u=gu(this.data,s);return!u&&!r&&!t&&e.indexOf(".")>-1&&(e=s[0],r=s[1],t=s.slice(2).join(".")),u||!o||!Ye(t)?u:ic(this.data&&this.data[e]&&this.data[e][r],t,i)}addResource(e,r,t,a){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const o=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let s=[e,r];t&&(s=s.concat(o?t.split(o):t)),e.indexOf(".")>-1&&(s=e.split("."),a=r,r=s[1]),this.addNamespaces(r),mp(this.data,s,a),i.silent||this.emit("added",e,r,t,a)}addResources(e,r,t){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const i in t)(Ye(t[i])||Array.isArray(t[i]))&&this.addResource(e,r,i,t[i],{silent:!0});a.silent||this.emit("added",e,r,t)}addResourceBundle(e,r,t,a,i){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},s=[e,r];e.indexOf(".")>-1&&(s=e.split("."),a=t,t=r,r=s[1]),this.addNamespaces(r);let u=gu(this.data,s)||{};o.skipCopy||(t=JSON.parse(JSON.stringify(t))),a?yp(u,t,i):u={...u,...t},mp(this.data,s,u),o.silent||this.emit("added",e,r,t)}removeResourceBundle(e,r){this.hasResourceBundle(e,r)&&delete this.data[e][r],this.removeNamespaces(r),this.emit("removed",e,r)}hasResourceBundle(e,r){return this.getResource(e,r)!==void 0}getResourceBundle(e,r){return r||(r=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,r)}:this.getResource(e,r)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const r=this.getDataByLanguage(e);return!!(r&&Object.keys(r)||[]).find(a=>r[a]&&Object.keys(r[a]).length>0)}toJSON(){return this.data}}var Sp={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,r,t,a){return n.forEach(i=>{this.processors[i]&&(e=this.processors[i].process(e,r,t,a))}),e}};const Op={};class bu extends yu{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),wb(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Ln.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const t=this.resolve(e,r);return t&&t.res!==void 0}extractFromKey(e,r){let t=r.nsSeparator!==void 0?r.nsSeparator:this.options.nsSeparator;t===void 0&&(t=":");const a=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let i=r.ns||this.options.defaultNS||[];const o=t&&e.indexOf(t)>-1,s=!this.options.userDefinedKeySeparator&&!r.keySeparator&&!this.options.userDefinedNsSeparator&&!r.nsSeparator&&!Db(e,t,a);if(o&&!s){const u=e.match(this.interpolator.nestingRegexp);if(u&&u.length>0)return{key:e,namespaces:Ye(i)?[i]:i};const l=e.split(t);(t!==a||t===a&&this.options.ns.indexOf(l[0])>-1)&&(i=l.shift()),e=l.join(a)}return{key:e,namespaces:Ye(i)?[i]:i}}translate(e,r,t){if(typeof r!="object"&&this.options.overloadTranslationOptionHandler&&(r=this.options.overloadTranslationOptionHandler(arguments)),typeof r=="object"&&(r={...r}),r||(r={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const a=r.returnDetails!==void 0?r.returnDetails:this.options.returnDetails,i=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,{key:o,namespaces:s}=this.extractFromKey(e[e.length-1],r),u=s[s.length-1],l=r.lng||this.language,c=r.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(l&&l.toLowerCase()==="cimode"){if(c){const F=r.nsSeparator||this.options.nsSeparator;return a?{res:`${u}${F}${o}`,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:u,usedParams:this.getUsedParamsDetails(r)}:`${u}${F}${o}`}return a?{res:o,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:u,usedParams:this.getUsedParamsDetails(r)}:o}const d=this.resolve(e,r);let f=d&&d.res;const p=d&&d.usedKey||o,g=d&&d.exactUsedKey||o,h=Object.prototype.toString.apply(f),m=["[object Number]","[object Function]","[object RegExp]"],y=r.joinArrays!==void 0?r.joinArrays:this.options.joinArrays,S=!this.i18nFormat||this.i18nFormat.handleAsObject,C=!Ye(f)&&typeof f!="boolean"&&typeof f!="number";if(S&&f&&C&&m.indexOf(h)<0&&!(Ye(y)&&Array.isArray(f))){if(!r.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const F=this.options.returnedObjectHandler?this.options.returnedObjectHandler(p,f,{...r,ns:s}):`key '${o} (${this.language})' returned an object instead of string.`;return a?(d.res=F,d.usedParams=this.getUsedParamsDetails(r),d):F}if(i){const F=Array.isArray(f),T=F?[]:{},w=F?g:p;for(const _ in f)if(Object.prototype.hasOwnProperty.call(f,_)){const M=`${w}${i}${_}`;T[_]=this.translate(M,{...r,joinArrays:!1,ns:s}),T[_]===M&&(T[_]=f[_])}f=T}}else if(S&&Ye(y)&&Array.isArray(f))f=f.join(y),f&&(f=this.extendTranslation(f,e,r,t));else{let F=!1,T=!1;const w=r.count!==void 0&&!Ye(r.count),_=bu.hasDefaultValue(r),M=w?this.pluralResolver.getSuffix(l,r.count,r):"",D=r.ordinal&&w?this.pluralResolver.getSuffix(l,r.count,{ordinal:!1}):"",j=w&&!r.ordinal&&r.count===0&&this.pluralResolver.shouldUseIntlApi(),P=j&&r[`defaultValue${this.options.pluralSeparator}zero`]||r[`defaultValue${M}`]||r[`defaultValue${D}`]||r.defaultValue;!this.isValidLookup(f)&&_&&(F=!0,f=P),this.isValidLookup(f)||(T=!0,f=o);const L=(r.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&T?void 0:f,U=_&&P!==f&&this.options.updateMissing;if(T||F||U){if(this.logger.log(U?"updateKey":"missingKey",l,u,o,U?P:f),i){const z=this.resolve(o,{...r,keySeparator:!1});z&&z.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let B=[];const G=this.languageUtils.getFallbackCodes(this.options.fallbackLng,r.lng||this.language);if(this.options.saveMissingTo==="fallback"&&G&&G[0])for(let z=0;z<G.length;z++)B.push(G[z]);else this.options.saveMissingTo==="all"?B=this.languageUtils.toResolveHierarchy(r.lng||this.language):B.push(r.lng||this.language);const W=(z,H,q)=>{const J=_&&q!==f?q:L;this.options.missingKeyHandler?this.options.missingKeyHandler(z,u,H,J,U,r):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(z,u,H,J,U,r),this.emit("missingKey",z,u,H,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&w?B.forEach(z=>{const H=this.pluralResolver.getSuffixes(z,r);j&&r[`defaultValue${this.options.pluralSeparator}zero`]&&H.indexOf(`${this.options.pluralSeparator}zero`)<0&&H.push(`${this.options.pluralSeparator}zero`),H.forEach(q=>{W([z],o+q,r[`defaultValue${q}`]||P)})}):W(B,o,P))}f=this.extendTranslation(f,e,r,d,t),T&&f===o&&this.options.appendNamespaceToMissingKey&&(f=`${u}:${o}`),(T||F)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?f=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${u}:${o}`:o,F?f:void 0):f=this.options.parseMissingKeyHandler(f))}return a?(d.res=f,d.usedParams=this.getUsedParamsDetails(r),d):f}extendTranslation(e,r,t,a,i){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...t},t.lng||this.language||a.usedLng,a.usedNS,a.usedKey,{resolved:a});else if(!t.skipInterpolation){t.interpolation&&this.interpolator.init({...t,interpolation:{...this.options.interpolation,...t.interpolation}});const l=Ye(e)&&(t&&t.interpolation&&t.interpolation.skipOnVariables!==void 0?t.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let c;if(l){const f=e.match(this.interpolator.nestingRegexp);c=f&&f.length}let d=t.replace&&!Ye(t.replace)?t.replace:t;if(this.options.interpolation.defaultVariables&&(d={...this.options.interpolation.defaultVariables,...d}),e=this.interpolator.interpolate(e,d,t.lng||this.language||a.usedLng,t),l){const f=e.match(this.interpolator.nestingRegexp),p=f&&f.length;c<p&&(t.nest=!1)}!t.lng&&this.options.compatibilityAPI!=="v1"&&a&&a.res&&(t.lng=this.language||a.usedLng),t.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var f=arguments.length,p=new Array(f),g=0;g<f;g++)p[g]=arguments[g];return i&&i[0]===p[0]&&!t.context?(o.logger.warn(`It seems you are nesting recursively key: ${p[0]} in key: ${r[0]}`),null):o.translate(...p,r)},t)),t.interpolation&&this.interpolator.reset()}const s=t.postProcess||this.options.postProcess,u=Ye(s)?[s]:s;return e!=null&&u&&u.length&&t.applyPostProcessor!==!1&&(e=Sp.handle(u,e,r,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...a,usedParams:this.getUsedParamsDetails(t)},...t}:t,this)),e}resolve(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t,a,i,o,s;return Ye(e)&&(e=[e]),e.forEach(u=>{if(this.isValidLookup(t))return;const l=this.extractFromKey(u,r),c=l.key;a=c;let d=l.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const f=r.count!==void 0&&!Ye(r.count),p=f&&!r.ordinal&&r.count===0&&this.pluralResolver.shouldUseIntlApi(),g=r.context!==void 0&&(Ye(r.context)||typeof r.context=="number")&&r.context!=="",h=r.lngs?r.lngs:this.languageUtils.toResolveHierarchy(r.lng||this.language,r.fallbackLng);d.forEach(m=>{this.isValidLookup(t)||(s=m,!Op[`${h[0]}-${m}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(s)&&(Op[`${h[0]}-${m}`]=!0,this.logger.warn(`key "${a}" for languages "${h.join(", ")}" won't get resolved as namespace "${s}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),h.forEach(y=>{if(this.isValidLookup(t))return;o=y;const S=[c];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(S,c,y,m,r);else{let F;f&&(F=this.pluralResolver.getSuffix(y,r.count,r));const T=`${this.options.pluralSeparator}zero`,w=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(f&&(S.push(c+F),r.ordinal&&F.indexOf(w)===0&&S.push(c+F.replace(w,this.options.pluralSeparator)),p&&S.push(c+T)),g){const _=`${c}${this.options.contextSeparator}${r.context}`;S.push(_),f&&(S.push(_+F),r.ordinal&&F.indexOf(w)===0&&S.push(_+F.replace(w,this.options.pluralSeparator)),p&&S.push(_+T))}}let C;for(;C=S.pop();)this.isValidLookup(t)||(i=C,t=this.getResource(y,m,C,r))}))})}),{res:t,usedKey:a,exactUsedKey:i,usedLng:o,usedNS:s}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,r,t){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,r,t,a):this.resourceStore.getResource(e,r,t,a)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],t=e.replace&&!Ye(e.replace);let a=t?e.replace:e;if(t&&typeof e.count<"u"&&(a.count=e.count),this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),!t){a={...a};for(const i of r)delete a[i]}return a}static hasDefaultValue(e){const r="defaultValue";for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&r===t.substring(0,r.length)&&e[t]!==void 0)return!0;return!1}}const oc=n=>n.charAt(0).toUpperCase()+n.slice(1);class Fp{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Ln.create("languageUtils")}getScriptPartFromCode(e){if(e=hu(e),!e||e.indexOf("-")<0)return null;const r=e.split("-");return r.length===2||(r.pop(),r[r.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(r.join("-"))}getLanguagePartFromCode(e){if(e=hu(e),!e||e.indexOf("-")<0)return e;const r=e.split("-");return this.formatLanguageCode(r[0])}formatLanguageCode(e){if(Ye(e)&&e.indexOf("-")>-1){if(typeof Intl<"u"&&typeof Intl.getCanonicalLocales<"u")try{let a=Intl.getCanonicalLocales(e)[0];if(a&&this.options.lowerCaseLng&&(a=a.toLowerCase()),a)return a}catch{}const r=["hans","hant","latn","cyrl","cans","mong","arab"];let t=e.split("-");return this.options.lowerCaseLng?t=t.map(a=>a.toLowerCase()):t.length===2?(t[0]=t[0].toLowerCase(),t[1]=t[1].toUpperCase(),r.indexOf(t[1].toLowerCase())>-1&&(t[1]=oc(t[1].toLowerCase()))):t.length===3&&(t[0]=t[0].toLowerCase(),t[1].length===2&&(t[1]=t[1].toUpperCase()),t[0]!=="sgn"&&t[2].length===2&&(t[2]=t[2].toUpperCase()),r.indexOf(t[1].toLowerCase())>-1&&(t[1]=oc(t[1].toLowerCase())),r.indexOf(t[2].toLowerCase())>-1&&(t[2]=oc(t[2].toLowerCase()))),t.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let r;return e.forEach(t=>{if(r)return;const a=this.formatLanguageCode(t);(!this.options.supportedLngs||this.isSupportedCode(a))&&(r=a)}),!r&&this.options.supportedLngs&&e.forEach(t=>{if(r)return;const a=this.getLanguagePartFromCode(t);if(this.isSupportedCode(a))return r=a;r=this.options.supportedLngs.find(i=>{if(i===a)return i;if(!(i.indexOf("-")<0&&a.indexOf("-")<0)&&(i.indexOf("-")>0&&a.indexOf("-")<0&&i.substring(0,i.indexOf("-"))===a||i.indexOf(a)===0&&a.length>1))return i})}),r||(r=this.getFallbackCodes(this.options.fallbackLng)[0]),r}getFallbackCodes(e,r){if(!e)return[];if(typeof e=="function"&&(e=e(r)),Ye(e)&&(e=[e]),Array.isArray(e))return e;if(!r)return e.default||[];let t=e[r];return t||(t=e[this.getScriptPartFromCode(r)]),t||(t=e[this.formatLanguageCode(r)]),t||(t=e[this.getLanguagePartFromCode(r)]),t||(t=e.default),t||[]}toResolveHierarchy(e,r){const t=this.getFallbackCodes(r||this.options.fallbackLng||[],e),a=[],i=o=>{o&&(this.isSupportedCode(o)?a.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return Ye(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(e))):Ye(e)&&i(this.formatLanguageCode(e)),t.forEach(o=>{a.indexOf(o)<0&&i(this.formatLanguageCode(o))}),a}}let Nb=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],Vb={1:n=>+(n>1),2:n=>+(n!=1),3:n=>0,4:n=>n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2,5:n=>n==0?0:n==1?1:n==2?2:n%100>=3&&n%100<=10?3:n%100>=11?4:5,6:n=>n==1?0:n>=2&&n<=4?1:2,7:n=>n==1?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2,8:n=>n==1?0:n==2?1:n!=8&&n!=11?2:3,9:n=>+(n>=2),10:n=>n==1?0:n==2?1:n<7?2:n<11?3:4,11:n=>n==1||n==11?0:n==2||n==12?1:n>2&&n<20?2:3,12:n=>+(n%10!=1||n%100==11),13:n=>+(n!==0),14:n=>n==1?0:n==2?1:n==3?2:3,15:n=>n%10==1&&n%100!=11?0:n%10>=2&&(n%100<10||n%100>=20)?1:2,16:n=>n%10==1&&n%100!=11?0:n!==0?1:2,17:n=>n==1||n%10==1&&n%100!=11?0:1,18:n=>n==0?0:n==1?1:2,19:n=>n==1?0:n==0||n%100>1&&n%100<11?1:n%100>10&&n%100<20?2:3,20:n=>n==1?0:n==0||n%100>0&&n%100<20?1:2,21:n=>n%100==1?1:n%100==2?2:n%100==3||n%100==4?3:0,22:n=>n==1?0:n==2?1:(n<0||n>10)&&n%10==0?2:3};const Mb=["v1","v2","v3"],kb=["v4"],Cp={zero:0,one:1,two:2,few:3,many:4,other:5},Gb=()=>{const n={};return Nb.forEach(e=>{e.lngs.forEach(r=>{n[r]={numbers:e.nr,plurals:Vb[e.fc]}})}),n};class $b{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=r,this.logger=Ln.create("pluralResolver"),(!this.options.compatibilityJSON||kb.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=Gb(),this.pluralRulesCache={}}addRule(e,r){this.rules[e]=r}clearCache(){this.pluralRulesCache={}}getRule(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi()){const t=hu(e==="dev"?"en":e),a=r.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:t,type:a});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let o;try{o=new Intl.PluralRules(t,{type:a})}catch{if(!e.match(/-|_/))return;const u=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(u,r)}return this.pluralRulesCache[i]=o,o}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=this.getRule(e,r);return this.shouldUseIntlApi()?t&&t.resolvedOptions().pluralCategories.length>1:t&&t.numbers.length>1}getPluralFormsOfKey(e,r){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,t).map(a=>`${r}${a}`)}getSuffixes(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=this.getRule(e,r);return t?this.shouldUseIntlApi()?t.resolvedOptions().pluralCategories.sort((a,i)=>Cp[a]-Cp[i]).map(a=>`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${a}`):t.numbers.map(a=>this.getSuffix(e,a,r)):[]}getSuffix(e,r){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const a=this.getRule(e,t);return a?this.shouldUseIntlApi()?`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${a.select(r)}`:this.getSuffixRetroCompatible(a,r):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,r){const t=e.noAbs?e.plurals(r):e.plurals(Math.abs(r));let a=e.numbers[t];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(a===2?a="plural":a===1&&(a=""));const i=()=>this.options.prepend&&a.toString()?this.options.prepend+a.toString():a.toString();return this.options.compatibilityJSON==="v1"?a===1?"":typeof a=="number"?`_plural_${a.toString()}`:i():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?i():this.options.prepend&&t.toString()?this.options.prepend+t.toString():t.toString()}shouldUseIntlApi(){return!Mb.includes(this.options.compatibilityJSON)}}const Ep=function(n,e,r){let t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,i=_b(n,e,r);return!i&&a&&Ye(r)&&(i=ic(n,r,t),i===void 0&&(i=ic(e,r,t))),i},sc=n=>n.replace(/\$/g,"$$$$");class Ub{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Ln.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(r=>r),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:r,escapeValue:t,useRawValueToEscape:a,prefix:i,prefixEscaped:o,suffix:s,suffixEscaped:u,formatSeparator:l,unescapeSuffix:c,unescapePrefix:d,nestingPrefix:f,nestingPrefixEscaped:p,nestingSuffix:g,nestingSuffixEscaped:h,nestingOptionsSeparator:m,maxReplaces:y,alwaysFormat:S}=e.interpolation;this.escape=r!==void 0?r:Rb,this.escapeValue=t!==void 0?t:!0,this.useRawValueToEscape=a!==void 0?a:!1,this.prefix=i?ji(i):o||"{{",this.suffix=s?ji(s):u||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=f?ji(f):p||ji("$t("),this.nestingSuffix=g?ji(g):h||ji(")"),this.nestingOptionsSeparator=m||",",this.maxReplaces=y||1e3,this.alwaysFormat=S!==void 0?S:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(r,t)=>r&&r.source===t?(r.lastIndex=0,r):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,r,t,a){let i,o,s;const u=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=p=>{if(p.indexOf(this.formatSeparator)<0){const y=Ep(r,u,p,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(y,void 0,t,{...a,...r,interpolationkey:p}):y}const g=p.split(this.formatSeparator),h=g.shift().trim(),m=g.join(this.formatSeparator).trim();return this.format(Ep(r,u,h,this.options.keySeparator,this.options.ignoreJSONStructure),m,t,{...a,...r,interpolationkey:h})};this.resetRegExp();const c=a&&a.missingInterpolationHandler||this.options.missingInterpolationHandler,d=a&&a.interpolation&&a.interpolation.skipOnVariables!==void 0?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:p=>sc(p)},{regex:this.regexp,safeValue:p=>this.escapeValue?sc(this.escape(p)):sc(p)}].forEach(p=>{for(s=0;i=p.regex.exec(e);){const g=i[1].trim();if(o=l(g),o===void 0)if(typeof c=="function"){const m=c(e,i,a);o=Ye(m)?m:""}else if(a&&Object.prototype.hasOwnProperty.call(a,g))o="";else if(d){o=i[0];continue}else this.logger.warn(`missed to pass in variable ${g} for interpolating ${e}`),o="";else!Ye(o)&&!this.useRawValueToEscape&&(o=vp(o));const h=p.safeValue(o);if(e=e.replace(i[0],h),d?(p.regex.lastIndex+=o.length,p.regex.lastIndex-=i[0].length):p.regex.lastIndex=0,s++,s>=this.maxReplaces)break}}),e}nest(e,r){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a,i,o;const s=(u,l)=>{const c=this.nestingOptionsSeparator;if(u.indexOf(c)<0)return u;const d=u.split(new RegExp(`${c}[ ]*{`));let f=`{${d[1]}`;u=d[0],f=this.interpolate(f,o);const p=f.match(/'/g),g=f.match(/"/g);(p&&p.length%2===0&&!g||g.length%2!==0)&&(f=f.replace(/'/g,'"'));try{o=JSON.parse(f),l&&(o={...l,...o})}catch(h){return this.logger.warn(`failed parsing options string in nesting for key ${u}`,h),`${u}${c}${f}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,u};for(;a=this.nestingRegexp.exec(e);){let u=[];o={...t},o=o.replace&&!Ye(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;let l=!1;if(a[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(a[1])){const c=a[1].split(this.formatSeparator).map(d=>d.trim());a[1]=c.shift(),u=c,l=!0}if(i=r(s.call(this,a[1].trim(),o),o),i&&a[0]===e&&!Ye(i))return i;Ye(i)||(i=vp(i)),i||(this.logger.warn(`missed to resolve ${a[1]} for nesting ${e}`),i=""),l&&(i=u.reduce((c,d)=>this.format(c,d,t.lng,{...t,interpolationkey:a[1].trim()}),i.trim())),e=e.replace(a[0],i),this.regexp.lastIndex=0}return e}}const Bb=n=>{let e=n.toLowerCase().trim();const r={};if(n.indexOf("(")>-1){const t=n.split("(");e=t[0].toLowerCase().trim();const a=t[1].substring(0,t[1].length-1);e==="currency"&&a.indexOf(":")<0?r.currency||(r.currency=a.trim()):e==="relativetime"&&a.indexOf(":")<0?r.range||(r.range=a.trim()):a.split(";").forEach(o=>{if(o){const[s,...u]=o.split(":"),l=u.join(":").trim().replace(/^'+|'+$/g,""),c=s.trim();r[c]||(r[c]=l),l==="false"&&(r[c]=!1),l==="true"&&(r[c]=!0),isNaN(l)||(r[c]=parseInt(l,10))}})}return{formatName:e,formatOptions:r}},xi=n=>{const e={};return(r,t,a)=>{let i=a;a&&a.interpolationkey&&a.formatParams&&a.formatParams[a.interpolationkey]&&a[a.interpolationkey]&&(i={...i,[a.interpolationkey]:void 0});const o=t+JSON.stringify(i);let s=e[o];return s||(s=n(hu(t),a),e[o]=s),s(r)}};class Wb{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Ln.create("formatter"),this.options=e,this.formats={number:xi((r,t)=>{const a=new Intl.NumberFormat(r,{...t});return i=>a.format(i)}),currency:xi((r,t)=>{const a=new Intl.NumberFormat(r,{...t,style:"currency"});return i=>a.format(i)}),datetime:xi((r,t)=>{const a=new Intl.DateTimeFormat(r,{...t});return i=>a.format(i)}),relativetime:xi((r,t)=>{const a=new Intl.RelativeTimeFormat(r,{...t});return i=>a.format(i,t.range||"day")}),list:xi((r,t)=>{const a=new Intl.ListFormat(r,{...t});return i=>a.format(i)})},this.init(e)}init(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=r.interpolation.formatSeparator||","}add(e,r){this.formats[e.toLowerCase().trim()]=r}addCached(e,r){this.formats[e.toLowerCase().trim()]=xi(r)}format(e,r,t){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=r.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(s=>s.indexOf(")")>-1)){const s=i.findIndex(u=>u.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,s)].join(this.formatSeparator)}return i.reduce((s,u)=>{const{formatName:l,formatOptions:c}=Bb(u);if(this.formats[l]){let d=s;try{const f=a&&a.formatParams&&a.formatParams[a.interpolationkey]||{},p=f.locale||f.lng||a.locale||a.lng||t;d=this.formats[l](s,p,{...c,...a,...f})}catch(f){this.logger.warn(f)}return d}else this.logger.warn(`there was no format function for ${l}`);return s},e)}}const zb=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class qb extends yu{constructor(e,r,t){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=r,this.services=t,this.languageUtils=t.languageUtils,this.options=a,this.logger=Ln.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=a.maxParallelReads||10,this.readingCalls=0,this.maxRetries=a.maxRetries>=0?a.maxRetries:5,this.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(t,a.backend,a)}queueLoad(e,r,t,a){const i={},o={},s={},u={};return e.forEach(l=>{let c=!0;r.forEach(d=>{const f=`${l}|${d}`;!t.reload&&this.store.hasResourceBundle(l,d)?this.state[f]=2:this.state[f]<0||(this.state[f]===1?o[f]===void 0&&(o[f]=!0):(this.state[f]=1,c=!1,o[f]===void 0&&(o[f]=!0),i[f]===void 0&&(i[f]=!0),u[d]===void 0&&(u[d]=!0)))}),c||(s[l]=!0)}),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:a}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(u)}}loaded(e,r,t){const a=e.split("|"),i=a[0],o=a[1];r&&this.emit("failedLoading",i,o,r),!r&&t&&this.store.addResourceBundle(i,o,t,void 0,void 0,{skipCopy:!0}),this.state[e]=r?-1:2,r&&t&&(this.state[e]=0);const s={};this.queue.forEach(u=>{Tb(u.loaded,[i],o),zb(u,e),r&&u.errors.push(r),u.pendingCount===0&&!u.done&&(Object.keys(u.loaded).forEach(l=>{s[l]||(s[l]={});const c=u.loaded[l];c.length&&c.forEach(d=>{s[l][d]===void 0&&(s[l][d]=!0)})}),u.done=!0,u.errors.length?u.callback(u.errors):u.callback())}),this.emit("loaded",s),this.queue=this.queue.filter(u=>!u.done)}read(e,r,t){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:r,fcName:t,tried:a,wait:i,callback:o});return}this.readingCalls++;const s=(l,c)=>{if(this.readingCalls--,this.waitingReads.length>0){const d=this.waitingReads.shift();this.read(d.lng,d.ns,d.fcName,d.tried,d.wait,d.callback)}if(l&&c&&a<this.maxRetries){setTimeout(()=>{this.read.call(this,e,r,t,a+1,i*2,o)},i);return}o(l,c)},u=this.backend[t].bind(this.backend);if(u.length===2){try{const l=u(e,r);l&&typeof l.then=="function"?l.then(c=>s(null,c)).catch(s):s(null,l)}catch(l){s(l)}return}return u(e,r,s)}prepareLoading(e,r){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();Ye(e)&&(e=this.languageUtils.toResolveHierarchy(e)),Ye(r)&&(r=[r]);const i=this.queueLoad(e,r,t,a);if(!i.toLoad.length)return i.pending.length||a(),null;i.toLoad.forEach(o=>{this.loadOne(o)})}load(e,r,t){this.prepareLoading(e,r,{},t)}reload(e,r,t){this.prepareLoading(e,r,{reload:!0},t)}loadOne(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const t=e.split("|"),a=t[0],i=t[1];this.read(a,i,"read",void 0,void 0,(o,s)=>{o&&this.logger.warn(`${r}loading namespace ${i} for language ${a} failed`,o),!o&&s&&this.logger.log(`${r}loaded namespace ${i} for language ${a}`,s),this.loaded(e,o,s)})}saveMissing(e,r,t,a,i){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(r)){this.logger.warn(`did not save key "${t}" as the namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(t==null||t==="")){if(this.backend&&this.backend.create){const u={...o,isUpdate:i},l=this.backend.create.bind(this.backend);if(l.length<6)try{let c;l.length===5?c=l(e,r,t,a,u):c=l(e,r,t,a),c&&typeof c.then=="function"?c.then(d=>s(null,d)).catch(s):s(null,c)}catch(c){s(c)}else l(e,r,t,a,s,u)}!e||!e[0]||this.store.addResource(e[0],r,t,a)}}}const wp=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),Ye(n[1])&&(e.defaultValue=n[1]),Ye(n[2])&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const r=n[3]||n[2];Object.keys(r).forEach(t=>{e[t]=r[t]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),Ap=n=>(Ye(n.ns)&&(n.ns=[n.ns]),Ye(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),Ye(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),n.supportedLngs&&n.supportedLngs.indexOf("cimode")<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),n),Su=()=>{},Hb=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(r=>{typeof n[r]=="function"&&(n[r]=n[r].bind(n))})};class ko extends yu{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;if(super(),this.options=Ap(e),this.services={},this.logger=Ln,this.modules={external:[]},Hb(this),r&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,r),this;setTimeout(()=>{this.init(e,r)},0)}}init(){var e=this;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof r=="function"&&(t=r,r={}),!r.defaultNS&&r.defaultNS!==!1&&r.ns&&(Ye(r.ns)?r.defaultNS=r.ns:r.ns.indexOf("translation")<0&&(r.defaultNS=r.ns[0]));const a=wp();this.options={...a,...this.options,...Ap(r)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...a.interpolation,...this.options.interpolation}),r.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=r.keySeparator),r.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=r.nsSeparator);const i=c=>c?typeof c=="function"?new c:c:null;if(!this.options.isClone){this.modules.logger?Ln.init(i(this.modules.logger),this.options):Ln.init(null,this.options);let c;this.modules.formatter?c=this.modules.formatter:typeof Intl<"u"&&(c=Wb);const d=new Fp(this.options);this.store=new bp(this.options.resources,this.options);const f=this.services;f.logger=Ln,f.resourceStore=this.store,f.languageUtils=d,f.pluralResolver=new $b(d,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),c&&(!this.options.interpolation.format||this.options.interpolation.format===a.interpolation.format)&&(f.formatter=i(c),f.formatter.init(f,this.options),this.options.interpolation.format=f.formatter.format.bind(f.formatter)),f.interpolator=new Ub(this.options),f.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},f.backendConnector=new qb(i(this.modules.backend),f.resourceStore,f,this.options),f.backendConnector.on("*",function(p){for(var g=arguments.length,h=new Array(g>1?g-1:0),m=1;m<g;m++)h[m-1]=arguments[m];e.emit(p,...h)}),this.modules.languageDetector&&(f.languageDetector=i(this.modules.languageDetector),f.languageDetector.init&&f.languageDetector.init(f,this.options.detection,this.options)),this.modules.i18nFormat&&(f.i18nFormat=i(this.modules.i18nFormat),f.i18nFormat.init&&f.i18nFormat.init(this)),this.translator=new bu(this.services,this.options),this.translator.on("*",function(p){for(var g=arguments.length,h=new Array(g>1?g-1:0),m=1;m<g;m++)h[m-1]=arguments[m];e.emit(p,...h)}),this.modules.external.forEach(p=>{p.init&&p.init(this)})}if(this.format=this.options.interpolation.format,t||(t=Su),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const c=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);c.length>0&&c[0]!=="dev"&&(this.options.lng=c[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(c=>{this[c]=function(){return e.store[c](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(c=>{this[c]=function(){return e.store[c](...arguments),e}});const u=Vo(),l=()=>{const c=(d,f)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),u.resolve(f),t(d,f)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return c(null,this.t.bind(this));this.changeLanguage(this.options.lng,c)};return this.options.resources||!this.options.initImmediate?l():setTimeout(l,0),u}loadResources(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Su;const a=Ye(e)?e:this.language;if(typeof e=="function"&&(t=e),!this.options.resources||this.options.partialBundledLanguages){if(a&&a.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return t();const i=[],o=s=>{if(!s||s==="cimode")return;this.services.languageUtils.toResolveHierarchy(s).forEach(l=>{l!=="cimode"&&i.indexOf(l)<0&&i.push(l)})};a?o(a):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(u=>o(u)),this.options.preload&&this.options.preload.forEach(s=>o(s)),this.services.backendConnector.load(i,this.options.ns,s=>{!s&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),t(s)})}else t(null)}reloadResources(e,r,t){const a=Vo();return typeof e=="function"&&(t=e,e=void 0),typeof r=="function"&&(t=r,r=void 0),e||(e=this.languages),r||(r=this.options.ns),t||(t=Su),this.services.backendConnector.reload(e,r,i=>{a.resolve(),t(i)}),a}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&Sp.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let r=0;r<this.languages.length;r++){const t=this.languages[r];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}}changeLanguage(e,r){var t=this;this.isLanguageChangingTo=e;const a=Vo();this.emit("languageChanging",e);const i=u=>{this.language=u,this.languages=this.services.languageUtils.toResolveHierarchy(u),this.resolvedLanguage=void 0,this.setResolvedLanguage(u)},o=(u,l)=>{l?(i(l),this.translator.changeLanguage(l),this.isLanguageChangingTo=void 0,this.emit("languageChanged",l),this.logger.log("languageChanged",l)):this.isLanguageChangingTo=void 0,a.resolve(function(){return t.t(...arguments)}),r&&r(u,function(){return t.t(...arguments)})},s=u=>{!e&&!u&&this.services.languageDetector&&(u=[]);const l=Ye(u)?u:this.services.languageUtils.getBestMatchFromCodes(u);l&&(this.language||i(l),this.translator.language||this.translator.changeLanguage(l),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(l)),this.loadResources(l,c=>{o(c,l)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?s(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(e),a}getFixedT(e,r,t){var a=this;const i=function(o,s){let u;if(typeof s!="object"){for(var l=arguments.length,c=new Array(l>2?l-2:0),d=2;d<l;d++)c[d-2]=arguments[d];u=a.options.overloadTranslationOptionHandler([o,s].concat(c))}else u={...s};u.lng=u.lng||i.lng,u.lngs=u.lngs||i.lngs,u.ns=u.ns||i.ns,u.keyPrefix!==""&&(u.keyPrefix=u.keyPrefix||t||i.keyPrefix);const f=a.options.keySeparator||".";let p;return u.keyPrefix&&Array.isArray(o)?p=o.map(g=>`${u.keyPrefix}${f}${g}`):p=u.keyPrefix?`${u.keyPrefix}${f}${o}`:o,a.t(p,u)};return Ye(e)?i.lng=e:i.lngs=e,i.ns=r,i.keyPrefix=t,i}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const t=r.lng||this.resolvedLanguage||this.languages[0],a=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(t.toLowerCase()==="cimode")return!0;const o=(s,u)=>{const l=this.services.backendConnector.state[`${s}|${u}`];return l===-1||l===0||l===2};if(r.precheck){const s=r.precheck(this,o);if(s!==void 0)return s}return!!(this.hasResourceBundle(t,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(t,e)&&(!a||o(i,e)))}loadNamespaces(e,r){const t=Vo();return this.options.ns?(Ye(e)&&(e=[e]),e.forEach(a=>{this.options.ns.indexOf(a)<0&&this.options.ns.push(a)}),this.loadResources(a=>{t.resolve(),r&&r(a)}),t):(r&&r(),Promise.resolve())}loadLanguages(e,r){const t=Vo();Ye(e)&&(e=[e]);const a=this.options.preload||[],i=e.filter(o=>a.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return i.length?(this.options.preload=a.concat(i),this.loadResources(o=>{t.resolve(),r&&r(o)}),t):(r&&r(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const r=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],t=this.services&&this.services.languageUtils||new Fp(wp());return r.indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;return new ko(e,r)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Su;const t=e.forkResourceStore;t&&delete e.forkResourceStore;const a={...this.options,...e,isClone:!0},i=new ko(a);return(e.debug!==void 0||e.prefix!==void 0)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(s=>{i[s]=this[s]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},t&&(i.store=new bp(this.store.data,a),i.services.resourceStore=i.store),i.translator=new bu(i.services,a),i.translator.on("*",function(s){for(var u=arguments.length,l=new Array(u>1?u-1:0),c=1;c<u;c++)l[c-1]=arguments[c];i.emit(s,...l)}),i.init(a,r),i.translator.options=a,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Tr=ko.createInstance();Tr.createInstance=ko.createInstance;const Pw=Tr.createInstance,Nw=Tr.dir,Vw=Tr.init,Mw=Tr.loadResources,kw=Tr.reloadResources,Gw=Tr.use,$w=Tr.changeLanguage,Uw=Tr.getFixedT,Bw=Tr.t,Ww=Tr.exists,zw=Tr.setDefaultNamespace,qw=Tr.hasLoadedNamespace,Hw=Tr.loadNamespaces,Qw=Tr.loadLanguages;var Tp="EMPTY_GROUP",_p="EMPTY_RULE_GROUP",Lp="EMPTY_QUERY",Rp="EMPTY_CASE",jp="NO_CONFIG_FOR_FIELD",xp="NO_CONFIG_FOR_OPERATOR",Qb="FIXED_OPERATOR",Ip="NO_CONFIG_FOR_FUNCTION",Dp="INVALID_VALUE",Pp="INVALID_FUNC_ARG_VALUE",Np="UNSUPPORTED_FIELD_TYPE",Vp="UNSUPPORTED_OPERATOR_FOR_FIELD",Mp="INVALID_VALUE_SRC",uc="INCOMPLETE_RULE",kp="INCOMPLETE_LHS",Gp="INCOMPLETE_RHS",lc="BAD_MULTISELECT_VALUES",$p="BAD_SELECT_VALUE",Up="INCORRECT_VALUE_TYPE",Bp="INCORRECT_VALUE_JS_TYPE",Wp="VALUE_LENGTH_CONSTRAINT_FAIL",cc="VALUE_MIN_CONSTRAINT_FAIL",dc="VALUE_MAX_CONSTRAINT_FAIL",zp="NO_CONFIG_FOR_FIELD_VALUE",qp="CANT_COMPARE_FIELD_WITH_ITSELF",Hp="CANT_COMPARE_FIELD_WITH_FIELD",Qp="INCORRECT_FIELD_TYPE",Jp="UNSUPPORTED_FUNCTION_FOR_FIELD",Yp="REQUIRED_FUNCTION_ARG",Kp="INCORRECT_FUNCTION_RETURN_TYPE",Xp="INVALID_RANGE",Yn="ITEM_POSITION",Zp="ITEM_POSITION_ROOT",ev="ITEM_POSITION_WITH_INDEX_PATH",tv="ITEM_POSITION_IN_CASE",fc="range",Ii,Jb=(Ii={},(0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)(Ii,Tp,"Empty group"),_p,"No conditions for group field {{field}}"),Lp,"Empty query"),Rp,"Empty case"),jp,"No config for field {{field}}"),Qb,"Fixed operator {{from}} to {{to}} for field {{field}}"),xp,"No config for operator {{operator}}"),Ip,"No config for function {{funcKey}}"),Dp,"Invalid value"),Pp,"Invalid value of arg {{argName}} for func {{funcName}}: {{argValidationError}}"),(0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)(Ii,Np,"Type of field {{field}} is not supported"),Vp,"Operator {{operator}} is not supported for field {{field}}"),uc,"Incomplete rule"),kp,"Incomplete LHS"),Gp,"Incomplete RHS"),Mp,"Invalid value src {{valueSrcs, list}}"),lc+"_one","Value {{badValues, list}} is not in the list of allowed values"),lc+"_other","Values {{badValues, list}} are not in the list of allowed values"),$p,"Value {{value}} is not in the list of allowed values"),Up,"Value should have type {{wType}}, but got value of type {{valueType}}"),(0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)(Ii,Bp,"Value should have JS type {{jsType}}, but got value of type {{valueTypeof}}"),Wp,"Value {{value}} should have max length {{fieldSettings.maxLength}} but got {{length}}"),cc,"Value {{value}} should be greater than or equal to {{fieldSettings.min}}"),cc+"_"+fc,"Value {{value}} should be from {{fieldSettings.min}} to {{fieldSettings.max}}"),dc,"Value {{value}} should be less than or equal to {{fieldSettings.max}}"),dc+"_"+fc,"Value {{value}} should be from {{fieldSettings.min}} to {{fieldSettings.max}}"),zp,"No config for field {{field}}"),qp,"Can't compare field {{field}} with itself"),Hp,"Can't compare field {{leftField}} with {{rightField}}"),Qp,"Field {{field}} is of type {{type}}, but expected {{expected}}"),(0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)(Ii,Jp,"Unsupported function {{funcKey}} for field {{field}}"),Yp,"Value of arg {{argName}} for func {{funcName}} is required"),Kp,"Function {{funcKey}} should return value of type {{returnType}}, but got {{valueType}}"),Xp,"Invalid range"),Zp,"Root"),Yn+"__rule","Leaf #{{globalLeafNo}}"),Yn+"__group","Group #{{globalGroupNo}}"),Yn+"__rule_group","Rule-group #{{globalNoByType}}"),Yn+"__case_group","Case #{{globalNoByType}}"),Yn+"__rule__deleted","Deleted leaf #{{globalLeafNo}}"),(0,X.A)((0,X.A)((0,X.A)((0,X.A)((0,X.A)(Ii,Yn+"__group__deleted","Deleted group #{{globalGroupNo}}"),Yn+"__rule_group__deleted","Deleted rule-group #{{globalNoByType}}"),Yn+"__case_group__deleted","Deleted case #{{globalNoByType}}"),tv,"{{str}} in case #{{caseNo}}"),ev,"{{str}} (index path: {{indexPath, list}})")),rv="raqbvalidation",Yb="".concat(rv,":"),Ou=Tr.createInstance();Ou.init({fallbackLng:"en"}),Ou.addResources("en",rv,Jb);var hn=function n(e,r){return e!=null&&e.str?e.str:e!=null&&e.key?n(e.key,e.args):r===null?e:Ou.t(e.includes(":")?e:Yb+e,r)};const Kb=Ou;function nv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Di(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?nv(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):nv(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var Pi=function(e,r){var t,a,i,o,s=e.validateValue,u=e.validateRange,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,c=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0,p=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,g=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1,h=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,m=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1;l||(l=r);var y=r.settings,S=y.keepInputOnChangeFieldSrc,C=y.convertableWidgets,F=y.clearValueOnChangeField,T=y.clearValueOnChangeOp,w=d=="!case_value",_=c.get("field");!_&&w&&(_=d);var M=c.get("fieldType"),D=c.get("fieldSrc"),j=c.get("operator"),P=c.get("value"),V=c.get("valueSrc",new Ne.List),L=c.get("valueType",new Ne.List),U=c.get("valueError",new Ne.List),B=c.get("asyncListValues"),G=w,W=st(l,j),z=st(r,f,d),H=w?1:j?Jt(W):null,q=w?1:f?Jt(z):null,J=_e(l,_),Y=_e(r,d),Z=!_&&M&&S,se=J?.type||M,re=Y?.type||!d&&Z&&se,ee=J?.listValuesType,Fe=Y?.listValuesType,pe=((t=_)===null||t===void 0||(a=t.get)===null||a===void 0?void 0:a.call(t,"func"))||_,oe=((i=d)===null||i===void 0||(o=i.get)===null||o===void 0?void 0:o.call(i,"func"))||d,Se=oe!=pe,he=[],be=(_||Z)&&(j&&f||G)&&P!=null;(!(se&&re&&se==re)||p==="field"&&Se&&F||p==="operator"&&T)&&(be=!1),Se&&Xs.includes(re)&&(Fe&&Fe===ee||(be=!1)),!G&&(!(P!=null&&P.size)&&q||P!=null&&P.size&&!q)&&(be=!1);var Le;if(D==="func"&&d){var Ae=s(r,null,null,f,d,re,D,B,g,h,m),ke=(0,ve.A)(Ae,2),Ve=ke[0],Re=ke[1],Ce=!(Re!=null&&Re.length),jt=Ve!==d,ot=!Ce&&jt&&!Re.find(function(Bt){return!Bt.fixed}),mt=g&&!Ce&&!ot&&!!p&&d!==_,Ue=!1;if(Ue?d=null:mt?d=_:jt&&(d=Ve),!Ce){var Mt=!Ce&&!ot&&!Ue&&!mt,kt=Re.find(function(Bt){return!Bt.fixed&&!Bt.ignore});Mt&&kt&&(Le=hn(kt)),Re.map(function(Bt){return he.push(Di(Di({side:"lhs"},Bt),{},{fixed:Bt.fixed||mt||Ue}))})}}for(var ir=0;ir<q;ir++){var xt=V.get(ir)||null,Xe=Nt(l,_,j,xt),Ht=Nt(r,d,f,xt),Xt=xt==="value"?Xe:Nt(l,_,j,"value"),Zt=xt==="value"?Ht:Nt(r,d,f,"value"),Vr=Zt==Xt||(C[Xt]||[]).includes(Zt)||!Xt&&Z;Vr||(be=!1)}j!=f&&[j,f].includes("proximity")&&(be=!1);var at=V.first(),Qt=br(r,d,f,null,at),Sr=md(r,d,f,null);!d&&Z&&(Sr=Object.keys(r.settings.valueSourcesInfo));var Dn=Sr[0],Mr;q===1&&Qt&&Qt.type!==void 0?Mr=Qt.type:q===1&&Y&&Y.type!==void 0&&(Mr=Y.type==="!group"?"number":Y.type);var Xn=be&&p==="operator"&&H===1&&q===2,_t=[],Pn=[],Za=[],Zn=Array.from({length:q},function(){return null});if(be)for(var Bc=function(dt){var Wt=P.get(dt),ti=L.get(dt)||null,Or=V.get(dt)||null;Xn&&dt===1&&(Wt=_t[0]!==void 0?_t[0]:P.get(0),_t[dt]=Wt,ti=L.get(0)||null,Or=V.get(0)||null);var Bu=Or?Sr.find(function(un){return un==Or})!==void 0:!0,Wu=s(r,d,d,f,Wt,ti,Or,B,g,h,m),zi=(0,ve.A)(Wu,2),rs=zi[0],pr=zi[1],qi=!(pr!=null&&pr.length),zt=rs!==Wt,sn=!qi&&zt&&!(pr!=null&&pr.find(function(un){return!un.fixed})),ns=!(pr!=null&&pr.find(function(un){return!un.fixed&&!un.ignore})),qm=!Bu||g&&!qi&&!sn&&(!ns||Se);qi||pr?.map(function(un){return he.push(Di(Di({side:"rhs",delta:dt},un),{},{fixed:un.fixed||qm}))}),qm&&(_t[dt]=null,dt===0&&delete _t[1]);var Iw=!qi&&!zt,Hm=pr?.find(function(un){return!un.fixed&&!un.ignore});Iw&&Hm&&(Zn[dt]=hn(Hm)),zt&&(_t[dt]=rs),Xn&&dt===0&&!qi&&!zt&&(Xn=!1),Xn&&dt===0&&["func","field"].includes(Or)&&(Xn=!1)},ei=0;ei<q;ei++)Bc(ei);if(!be){for(var Wi=0;Wi<q;Wi++)if(q===1){var Zo,es,Nn=cd([Y?.defaultValue,Y==null||(Zo=Y.fieldSettings)===null||Zo===void 0?void 0:Zo.defaultValue,Qt?.defaultValue]);_t[Wi]=Nn,(Nn!=null&&Nn.func||Nn!=null&&(es=Nn.get)!==null&&es!==void 0&&es.call(Nn,"func"))&&(Pn[Wi]="func")}}for(var fr=0;fr<q;fr++){var ts=be&&V.get(fr)||null,ct=be&&L.get(fr)||null,Pe=_t[fr]!==void 0?_t[fr]:be?P.get(fr):void 0;if(be&&Xn&&fr===1){var je,$e;ts=(je=Pn[fr])!==null&&je!==void 0?je:V.get(0),ct=($e=Za[fr])!==null&&$e!==void 0?$e:L.get(0),Pn[fr]=ts,Za[fr]=ct}var ze=Sr.includes(ts);ze||(Pn[fr]=Dn),ct||(Za[fr]=Mr),Pe!=null&&Pe.func&&(_t[fr]=Ai(Pe),Pn[fr]="func")}var et=P;(_t.length>0||!be||q<H)&&(et=new Ne.List(Array.from({length:q},function(Bt,dt){return _t[dt]!==void 0?_t[dt]:be?P.get(dt):void 0})));var Gt=V;(Pn.length>0||!be||q<H)&&(Gt=new Ne.List(Array.from({length:q},function(Bt,dt){var Wt;return(Wt=Pn[dt])!==null&&Wt!==void 0?Wt:be&&V.get(dt)||null})));var Ct=L;(Za.length>0||!be||q<H)&&(Ct=new Ne.List(Array.from({length:q},function(Bt,dt){var Wt;return(Wt=Za[dt])!==null&&Wt!==void 0?Wt:be&&L.get(dt)||null})));var or=u(r,d,f,et,Gt);if(or){var sr=hn(or),ur=g&&q>=2,Kr=et;ur&&(_t[1]=et.get(0),et=et.set(1,_t[1]),Zn[1]=Zn[0]);var ut=!ur;ut&&Zn.push(sr),he.push(Di(Di({side:"rhs",delta:-1},or),{},{fixed:ur,fixedFrom:ur?[Kr.get(0),Kr.get(1)]:void 0,fixedTo:ur?[et.get(0),et.get(1)]:void 0}))}var on=U,zr=U?.size!==Zn.length||Zn.filter(function(Bt,dt){return Bt!=U.get(dt)}).length>0;return zr&&(on=new Ne.List(Zn)),{canReuseValue:be,newValue:et,newValueSrc:Gt,newValueType:Ct,operatorCardinality:q,fixedField:d,newValueError:on,newFieldError:Le,validationErrors:he}};function Xb(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=Zb(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function Zb(n,e){if(n){if(typeof n=="string")return av(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return av(n,e)}}function av(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function iv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Fu(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?iv(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):iv(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var Kn=function(e,r){if(!(e==null||e==""))return dr(e)?Fu(Fu({},e),{},{title:e.title||e.value}):{value:e,title:r!==void 0?r:""+e}},pc=function(e){var r=Kn(e);return dr(r)?Fu(Fu({},Kn(e)),{},{isCustom:!0}):r},vc=function(e){if(Array.isArray(e))return e.map(function(i){return Kn(i)});if(!dr(e))return e;var r=[];for(var t in e){var a=e[t];r.push(Kn(t,a))}return r},Go=function(e,r){if(Array.isArray(e)){var t=e.map(function(a){return Kn(a)});return t.find(function(a){return""+a.value==""+r})}else return e[r]!==void 0?Kn(r,e[r]):void 0},ov=function(e,r){if(e==null)return r;var t=Go(e,r);return t!==void 0?t.title:r},eS=function(e,r){if(e==null)return r;var t=Go(e,r);return t!==void 0?t.value:r},gc=function(e,r){var t=[];if(Array.isArray(e)){var a=Xb(e),i;try{for(a.s();!(i=a.n()).done;){var o=i.value,s=r(Kn(o));s!=null&&t.push(s)}}catch(c){a.e(c)}finally{a.f()}}else for(var u in e){var l=r(Kn(u,e[u]));l!=null&&t.push(l)}return t},tS=function(e,r){return gc(r,function(t){return"".concat(t.value).indexOf(e)!=-1||t.title.indexOf(e)!=-1?t:null}).filter(function(t){return t!==null}).shift()},Cu=function(e,r){return gc(r,function(t){return""+t.value==""+e?t:null}).filter(function(t){return t!==null}).shift()};function sv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function ar(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?sv(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):sv(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var uv=function(e,r){return lv(e,r).length===0},lv=function(e,r){var t=r.settings.showErrorMessage,a=[];function i(o,s,u){var l,c,d=o.get("id"),f=o.get("children1"),p=o.getIn(["properties","valueError"]),g=o.getIn(["properties","fieldError"]),h=o.getIn(["properties","field"]),m=(l=h==null||(c=h.get)===null||c===void 0?void 0:c.call(h,"func"))!==null&&l!==void 0?l:h,y=p?.size>0&&p.filter(function(C){return C!=null}).size>0,S=y||!!g;S&&t&&a.push(m),f&&f.map(function(C,F){C&&i(C,s.concat(d),u+1)})}return e&&i(e,[],0),Array.from(new Set(a))},cv=function(e,r){var t=rn(r,void 0,!0),a={removeEmptyGroups:r.settings.removeEmptyGroupsOnLoad,removeIncompleteRules:r.settings.removeIncompleteRulesOnLoad,removeEmptyRules:r.settings.removeEmptyRulesOnLoad,forceFix:!1},i=$o(e,null,t,t,a),o=i.fixedTree,s=i.allErrors,u=i.isSanitized;return u&&s.length&&console.warn("Tree check errors: ",s),o},dv=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=rn(r,void 0,!0),i=ar(ar({},t),{},{removeEmptyGroups:!1,removeEmptyRules:!1,removeIncompleteRules:!1,forceFix:!1}),o=$o(e,null,a,a,i),s=o.allErrors;return s},fv=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=rn(r,void 0,!0),i=ar({removeEmptyGroups:!0,removeEmptyRules:!0,removeIncompleteRules:!0,forceFix:!1},t),o=$o(e,null,a,a,i),s=o.fixedTree,u=o.fixedErrors,l=o.nonFixedErrors,c=o.allErrors;return{fixedTree:s,fixedErrors:u,nonFixedErrors:l,allErrors:c}},pv=function(e,r,t,a,i,o,s){i===void 0&&(i=t.settings.removeEmptyGroupsOnLoad),o===void 0&&(o=t.settings.removeEmptyRulesOnLoad),s===void 0&&(s=t.settings.removeIncompleteRulesOnLoad);var u={removeEmptyGroups:i,removeEmptyRules:o,removeIncompleteRules:s,forceFix:!1},l=$o(e,r,t,a,u),c=l.fixedTree,d=l.allErrors,f=l.fixedErrors,p=l.nonFixedErrors,g=l.isSanitized;return g&&f.length&&console.warn("Fixed tree errors: ",f),c=gn(c),c},$o=function(e,r,t,a,i){if(!e)return{fixedTree:e,allErrors:[],fixedErrors:[],nonFixedErrors:[],isSanitized:!1};var o=i||{},s=o.removeEmptyGroups,u=o.removeEmptyRules,l=o.removeIncompleteRules,c=o.forceFix,d=o.translateErrors,f=d===void 0?!0:d,p=o.includeStringifiedItems,g=p===void 0?!0:p,h=o.stringifyFixedItems,m=h===void 0?!1:h,y=o.stringifyItemsUserFriendly,S=y===void 0?!0:y,C=o.includeItemsPositions,F=C===void 0?!0:C,T={config:t,oldConfig:a,removeEmptyGroups:s,removeEmptyRules:u,removeIncompleteRules:l,forceFix:c},w={errors:{}},_=gv(e,[],null,w,T),M=w.sanitized,D=[],j,P;F&&(j=Ll(_,t).items);for(var V in w.errors){var L=w.errors[V],U=L.path,B=L.errors;f&&(B=B.map(function(Ce){return ar(ar({},Ce),{},{str:hn(Ce)})}));var G={path:U,errors:B};if(g){var W=ca(m?_:e,U),z=U.length===1;if(!z&&W.get("type")!=="group"){var H=!0,q=S,J=qf(W,t,q,H);G.itemStr=J}}if(F){var Y=j[V],Z=!Y;if(Z&&(P||(P=Ll(e,t).items),Y=P[V]),Y){var se=ar(ar({},Y.position),{},{index:Y.index,type:Y.type,isDeleted:Z});G.itemPosition=se;var re=Y.index?Yn+"__"+Y.type+(Z?"__deleted":""):Zp,ee=ar({},se);if(S){for(var Fe,pe=0,oe=["caseNo","globalLeafNo","globalGroupNo","globalNoByType"];pe<oe.length;pe++){var Se=oe[pe];ee[Se]!=null&&(ee[Se]=ee[Se]+1)}ee.indexPath=(Fe=se.indexPath)===null||Fe===void 0?void 0:Fe.map(function(Ce){return Ce+1})}G.itemPositionStr=hn(re,ee),Y.index&&(Y.caseId&&Y.type!=="case_group"&&(G.itemPositionStr=hn(tv,ar(ar({},ee),{},{str:G.itemPositionStr}))),Y.type!=="case_group"&&(G.itemPositionStr=hn(ev,ar(ar({},ee),{},{str:G.itemPositionStr}))))}}D.push(G)}for(var he=[],be=[],Le=0,Ae=D;Le<Ae.length;Le++){var ke=Ae[Le],Ve=ke.errors.filter(function(Ce){return!!Ce.fixed}),Re=ke.errors.filter(function(Ce){return!Ce.fixed&&Ce.key!=="EMPTY_QUERY"});Ve.length&&he.push(ar(ar({},ke),{},{errors:Ve})),Re.length&&be.push(ar(ar({},ke),{},{errors:Re}))}return{fixedTree:_,allErrors:D,fixedErrors:he,nonFixedErrors:be,isSanitized:M}};function va(n,e,r,t){var a=e.get("id");n.errors[a]||(n.errors[a]={path:[].concat((0,ue.A)(r),[a]),errors:[]}),n.errors[a].errors.push(t)}function vv(n,e){var r=e.get("id");n.errors[r]&&n.errors[r].errors.map(function(t){t.fixed=!0})}function gv(n,e,r,t,a){var i=n?.get("type");return i==="group"||i==="rule_group"||i=="case_group"||i=="switch_group"?rS(n,e,r,t,a):i==="rule"?hv(n,e,r,t,a):n}function rS(n,e,r,t,a){var i,o,s,u,l,c,d=a.removeEmptyGroups,f=a.removeIncompleteRules,p=a.forceFix,g=a.config,h=g.settings.showErrorMessage,m=!h||p,y=n.get("id"),S=n.get("children1"),C=!e.length,F=S,T=n.get("type"),w=n.get("properties"),_=w?.get("field"),M=w?.get("mode"),D=w==null||(i=w.get)===null||i===void 0?void 0:i.call(w,"operator"),j=T==="rule_group"&&M==="array",P=T==="case_group",V=P&&S==null,L=D?(o=(s=g.operators[D])===null||s===void 0?void 0:s.cardinality)!==null&&o!==void 0?o:1:void 0,U=P?!V:j?L==0:d,B=j||P;!y&&r&&(y=r,n=n.set("id",y),t.sanitized=!0),B&&(n=hv(n,e,r,t,a));var G={errors:{}};S=(u=S)===null||u===void 0?void 0:u.map(function(J,Y){return gv(J,e.concat(y),Y,G,a)});var W=(l=S)===null||l===void 0?void 0:l.filter(function(J){return J!=null});d&&(S=W);var z=G.sanitized||F?.size!=((c=S)===null||c===void 0?void 0:c.size),H=!(W!=null&&W.size),q=d&&!C;return j&&_&&(q=f),H&&U&&(va(t,n,e,{key:C?Lp:P?Rp:j?_p:Tp,args:{field:_},fixed:q}),q&&(vv(t,n),n=void 0)),z&&(t.sanitized=!0),z&&n&&(n=n.set("children1",S)),t.errors=ar(ar({},t.errors),G?.errors||{}),n}function hv(n,e,r,t,a){var i=a.removeIncompleteRules,o=a.removeEmptyRules,s=a.forceFix,u=a.config,l=a.oldConfig,c=u.settings.showErrorMessage,d=!c||s,f=n,p=n.get("id"),g=n.get("type"),h=g==="case_group",m=n.get("properties");if(!m)if(h)m=new Ne.Map;else{var y={key:uc,args:{},fixed:i||o};va(t,n,e,y);return}var S=m.get("field")||null;h&&(S="!case_value");var C=m.get("fieldSrc")||null,F=m.get("operator")||null,T=m.get("operatorOptions"),w=m.get("valueSrc"),_=m.get("value"),M=m.get("valueError"),D=m.get("fieldError"),j=function(){var Ae,ke;return{field:((Ae=S)===null||Ae===void 0||(ke=Ae.toJS)===null||ke===void 0?void 0:ke.call(Ae))||S,fieldSrc:C,operator:F,operatorOptions:T?T.toJS():{},valueSrc:w?w.toJS():null,value:_?_.toJS():null,valueError:M?M.toJS():null,fieldError:D||null}},P=j();!p&&r&&(p=r,n=n.set("id",p),t.sanitized=!0);var V=S?_e(u,S):null;S&&!V&&(va(t,n,e,{key:jp,args:{field:S},side:"lhs",fixed:i||o}),S=null),S==null&&!h&&(m=["operator","operatorOptions","valueSrc","value","valueError","fieldError","field"].reduce(function(Le,Ae){return Le.delete(Ae)},m),F=null),!C&&S&&!h&&(C=gd(S),m=m.set("fieldSrc",C)),(F==="range_between"||F==="range_not_between")&&(F=F==="range_between"?"between":"not_between",m=m.set("operator",F));var L=F?st(u,F,S):null;F&&!L&&(va(t,n,e,{key:xp,args:{operator:F},side:"op",fixed:i||o}),F=null);var U=S?au(u,S):[];S&&!h&&(U!=null&&U.length?F&&U.indexOf(F)==-1&&(F==="is_empty"||F==="is_not_empty"?(F=F==="is_empty"?"is_null":"is_not_null",m=m.set("operator",F)):(va(t,n,e,{key:Vp,args:{operator:F,field:S},side:"lhs",fixed:i||o}),F=null)):(va(t,n,e,{key:Np,args:{field:S},side:"lhs",fixed:i||o}),F=null)),F==null&&!h&&(m=["operatorOptions","valueSrc","value","valueError"].reduce(function(Le,Ae){return Le.delete(Ae)},m)),T=m.get("operatorOptions"),!F||T&&!L.options?(T=null,m=m.delete("operatorOptions")):F&&!T&&L.options&&(T=xo(u,F,S),m=m.set("operatorOptions",T)),w=m.get("valueSrc"),_=m.get("value");var B=!0,G=Pi({validateValue:Rn,validateRange:ga},u,l,m,S,F,null,d,B),W=G.newValue,z=G.newValueSrc,H=G.newValueError,q=G.validationErrors,J=G.newFieldError,Y=G.fixedField;_=W,w=z,M=H,D=J,S=Y,m=m.set("field",S),m=m.set("value",_),m=m.set("valueSrc",w),c?m=m.set("valueError",M).set("fieldError",D):m=m.delete("valueError").delete("fieldError");var Z=j(),se=!Ys(P,Z),re=Ml(m.toObject(),u),ee=h?re.parts.value:re.score>=3;if(se&&(t.sanitized=!0,n=n.set("properties",m)),q?.map(function(Le){return va(t,n,e,Le)}),!ee&&!h){var Fe=re.score?i:o,pe={key:uc,args:{}};if(!re.parts.field)pe.key=kp,pe.side="lhs";else if(!re.parts.value){var oe,Se,he,be;pe.key=Gp,pe.side="rhs",(oe=Z.valueSrc)!==null&&oe!==void 0&&oe[0]&&((Se=Z.valueSrc)===null||Se===void 0?void 0:Se[0])!=((he=P.valueSrc)===null||he===void 0?void 0:he[0])&&((be=Z.value)===null||be===void 0?void 0:be[0])!=null&&(pe.key=Mp,pe.args={valueSrcs:Z.valueSrc})}pe.fixed=Fe,va(t,n,e,pe),Fe&&(vv(t,n),n=void 0)}return n}var Rn=function(e,r,t,a,i,o,s,u){var l=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,d=arguments.length>10&&arguments[10]!==void 0?arguments[10]:!1,f=[],p=i;if(i!=null){var g,h,m,y;if(s==="field"){var S=iS(r,t,i,s,o,u,e,a,l,c),C=(0,ve.A)(S,2);p=C[0],f=C[1]}else if(s==="func"){var F=oS(r,t,i,s,o,u,e,a,l,c,d),T=(0,ve.A)(F,2);p=T[0],f=T[1]}else if(s==="value"||!s){var w=aS(t,i,s,o,u,e,a,l,c),_=(0,ve.A)(w,2);p=_[0],f=_[1]}var M=!((g=f)!==null&&g!==void 0&&g.find(function(se){return!se.fixed})),D=!!t&&!["field","func"].includes(s)&&(!((h=f)!==null&&h!==void 0&&h.length)||M);if(D){var j=Nt(e,t,a,s),P=a?st(e,a,t):null,V=br(e,t,a,j,s,{forExport:!0}),L=s==="field"?_e(e,i):null,U=V,B=V.validateValue;if(typeof B=="function"){var G=[p,U,a,P];s==="field"&&G.push(L);var W=B.call.apply(B,[e.ctx].concat(G));if((0,ft.A)(W)==="object"&&W!==null&&!Array.isArray(W)){var z,H;(z=W.error)!==null&&z!==void 0&&z.key?H=ar({},W.error):H={key:W.error,args:null},W.fixedValue!==void 0&&l&&(H.fixed=!0,H.fixedFrom=p,H.fixedTo=W.fixedValue,p=W.fixedValue),f.push(H)}else typeof W=="boolean"?W==!1&&f.push({key:Dp,args:{}}):typeof W=="string"&&f.push({key:W,args:null})}}if(M=!((m=f)!==null&&m!==void 0&&m.find(function(se){return!se.fixed})),(y=f)!==null&&y!==void 0&&y.length&&!M&&l){var q=_e(e,t),J=q?.fieldSettings,Y=J?.defaultValue;if(Y!==void 0){var Z=f[f.length-1];Z.fixed=!0,Z.fixedFrom=p,Z.fixedTo=Y,p=Y,f.map(function(se){se.fixed=!0})}}}return[p,f]},nS=function(e,r,t,a,i){var o=Ne.List.isList(e)?e.toJS():e instanceof Array?(0,ue.A)(e):void 0,s=e,u=[];if(o){var l=o.reduce(function(m,y){var S=(0,ve.A)(m,2),C=S[0],F=S[1],T=Go(r,y);return T==null?[C,[].concat((0,ue.A)(F),[y])]:[[].concat((0,ue.A)(C),[T.value]),F]},[[],[]]),c=(0,ve.A)(l,2),d=c[0],f=c[1],p=f.length>0;if(t=t||i===!0,s=t&&p?d:e,f.length){var g=t&&p;u.push({key:lc,args:{badValues:f,count:f.length},fixed:g,fixedFrom:g?o:void 0,fixedTo:g?s:void 0})}return[s,u]}else{var h=Go(r,e);return h==null?(s=t?null:e,u.push({key:$p,args:{value:e},fixed:t,fixedFrom:t?e:void 0,fixedTo:t?s:void 0})):s=h.value,[s,u]}},aS=function(e,r,t,a,i,o){var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:!1,l=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,c=[],d=r;if(e){var f=_e(o,e),p=Nt(o,e,s,t),g=o.widgets[p],h=g?.type,m=g?.jsType,y=f?.fieldSettings,S=y?.treeValues||y?.listValues,C=!!(y!=null&&y.asyncFetch),F=S||C;if(a&&h&&a!=h)return c.push({key:Up,args:{wType:h,valueType:a}}),[r,c];if(m&&!Ba(r,m)&&!F)return c.push({key:Bp,args:{jsType:m,valueTypeof:Ei(r)}}),[r,c];if(y){var T=i||S;if(T&&!y.allowCustomValues&&p!=="case_value"){var w=nS(r,T,u,l,o.settings.removeInvalidMultiSelectValuesOnLoad),_=(0,ve.A)(w,2);d=_[0],c=_[1]}y.maxLength>0&&r!=null&&String(r).length>y.maxLength&&(d=u?String(r).substring(0,y.maxLength):r,c.push({key:Wp,args:{value:r,length:String(r).length,fieldSettings:y},fixed:u,fixedFrom:u?r:void 0,fixedTo:u?d:void 0}));var M=y.min!=null&&y.max!=null?fc:void 0;y.min!=null&&r<y.min&&(d=u?y.min:r,c.push({key:cc,args:{value:r,fieldSettings:y,context:M},fixed:u,fixedFrom:u?r:void 0,fixedTo:u?d:void 0})),y.max!=null&&r>y.max&&(d=u?y.max:r,c.push({key:dc,args:{value:r,fieldSettings:y,context:M},fixed:u,fixedFrom:u?r:void 0,fixedTo:u?d:void 0}))}}return[d,c]},iS=function(e,r,t,a,i,o,s){var u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null,l=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,d=[],f=s.settings,p=f.fieldSeparator,g=f.canCompareFieldWithField,h=(0,ft.A)(r)=="object"&&r?._isFuncArg,m=Array.isArray(e)?e.join(p):e,y=_e(s,e),S=Array.isArray(t)?t.join(p):t,C=_e(s,t);if(!C)return d.push({key:zp,args:{field:S}}),[t,d];if(e&&S===m&&!h)return d.push({key:qp,args:{field:m}}),[t,d];if(i&&i!=C.type)return d.push({key:Qp,args:{field:S,type:C.type,expected:i}}),[t,d];if(e&&!h&&g){var F=g(m,y,S,C,u);if(!F)return d.push({key:Hp,args:{leftField:m,rightField:S}}),[t,d]}return[t]},oS=function(e,r,t,a,i,o,s){var u,l,c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:null,d=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!1,f=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,p=arguments.length>10&&arguments[10]!==void 0?arguments[10]:!1,g=t,h=[];if(!t)return[t];var m=(u=t.get)===null||u===void 0?void 0:u.call(t,"func");if(!m)return[t];var y=_e(s,r);if(y!=null&&y.funcs&&!y.funcs.includes(m))return h.push({key:Jp,args:{funcKey:m,field:r}}),[t,h];var S=nr(s,m);if(!S)return h.push({key:Ip,args:{funcKey:m}}),[t,h];var C=(l=S.label)!==null&&l!==void 0?l:m;if(i&&S.returnType!=i)return h.push({key:Kp,args:{funcKey:m,funcName:C,returnType:S.returnType,valueType:i}}),[t,h];d=d||p;for(var F in S.args){var T,w=S.args[F],_=g.get("args"),M=_?_.get(F):void 0,D=_e(s,w),j=(T=D?.label)!==null&&T!==void 0?T:F,P=M?M.get("value"):void 0,V=M?M.get("valueSrc"):void 0;if(P!==void 0){var L=Rn(s,e,D,c,P,w.type,V,o,d,f,p),U=(0,ve.A)(L,2),B=U[0],G=U[1],W=!(G!=null&&G.length),z=d&&B!==P,H=d&&!W&&!z&&(f||p);if(z&&(g=g.setIn(["args",F,"value"],B)),H&&(g=g.deleteIn(["args",F]),g=Do(s,g,S,F)),!W){var q,J,Y=(q=(J=G.find(function(pe){return!pe.fixed&&!pe.ignore}))!==null&&J!==void 0?J:G.find(function(pe){return!pe.fixed}))!==null&&q!==void 0?q:G[0],Z=z||H,se=G.filter(function(pe){return!pe.ignore}).length===0;if(Y){var re=hn(Y);h.push({key:Pp,args:{funcKey:m,funcName:C,argKey:F,argName:j,argValidationError:re,argErrors:G},ignore:se,fixed:Z,fixedFrom:Z?P:void 0,fixedTo:Z?z?B:w.defaultValue:void 0})}}}else if(!w.isOptional&&(f||p)){var ee=d&&w.defaultValue!==void 0&&(f||p),Fe=f;Fe&&h.push({key:Yp,args:{funcKey:m,funcName:C,argKey:F,argName:j},fixed:ee,fixedTo:ee?w.defaultValue:void 0,ignore:!ee}),ee&&(g=g.deleteIn(["args",F]),g=Do(s,g,S,F))}}return[g,h]},ga=function(e,r,t,a,i){var o=st(e,t,r),s=t?Jt(o):null,u=i.toJS?i.toJS():i,l=a.toJS?a.toJS():a,c=u.filter(function(y){return y=="value"||y==null}).length==s,d;if(o!=null&&o.validateValues&&c){var f=u[0],p=Nt(e,r,t,f),g=br(e,r,t,p,f),h=g!=null&&g.toJS?l.map(function(y){var S=g.toJS.call(e.ctx,y,g);return S instanceof Date&&(S=S.getTime()),S}):l,m=o.validateValues(h);typeof m=="boolean"&&m==!1&&(d={key:Xp,args:{jsValues:h,values:l}})}return d},mv=function(e,r,t,a){var i=t.settings.fieldSeparator;e=e||new Ne.Map,Array.isArray(r)&&(r=r.join(i));var o=e.get("func"),s=e.get("args");e=e.set("func",r);var u=r&&nr(t,r),l=r&&wl(t,r),c=o&&wl(t,o),d=Sv(c,l,s,t,a);if(d.length){var f=Object.keys(l.args),p=f.filter(function(g){return!d.includes(g)});e=p.reduce(function(g,h){return g.deleteIn(["args",h])},e)}else e=e.set("args",new Ne.Map);return e=Gl(t,e,u),e},yv=function(e,r,t,a,i){return e&&e.get("func")&&(e=e.setIn(["args",r],new Ne.Map({valueSrc:t}))),e},bv=function(e,r,t,a,i){return e&&e.get("func")&&(e=e.setIn(["args",r,"asyncListValues"],t)),e},Sv=function(e,r,t,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(e?.returnType!=r?.returnType)return[];var o=!1,s=Object.keys(r.args),u=s.filter(function(l,c){var d=r.args[l],f=e.args[l],p=Object.keys(e.args).indexOf(l);if(!f&&(d.defaultValue!==void 0||d.isOptional))return!0;if(o&&c!==p||f?.type!=d.type||Xs.includes(d.type)&&(!f.listValuesType||f.listValuesType!==d.listValuesType))return!1;if(t){var g,h=t.get(l),m=h?.get("value"),y=h?.get("valueSrc");if(y&&d.valueSources&&!d.valueSources.includes(y))return!1;var S=null,C=null,F=d,T=null,w=!0,_=Rn(a,S,F,C,m,F.type,y,T,i,w),M=(0,ve.A)(_,2),D=M[0],j=M[1];if(j!=null&&(g=j.filter(function(P){return!P.fixed}))!==null&&g!==void 0&&g.length)return!1}return!0});return u};function Ov(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function sS(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ov(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Ov(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var jn=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=null,s=null,u=null,l=e.settings.showErrorMessage;if(t){var c,d,f;u=t==null||(c=t.properties)===null||c===void 0?void 0:c.fieldSrc,o=t==null||(d=t.properties)===null||d===void 0?void 0:d.field,s=t==null||(f=t.properties)===null||f===void 0?void 0:f.operator}else a?(o=Cd(e,i,r),o?u=wi(o)?"func":"field":u=Il(e),s=Dl(e,o,!0)):u=Il(e);var p=new Ne.Map({fieldSrc:u,field:o,operator:s,value:new Ne.List,valueSrc:new Ne.List,operatorOptions:xo(e,s,o)});if(l&&(p=p.set("valueError",new Ne.List)),o&&s){var g=!1,h=Pi({validateValue:Rn,validateRange:ga},e,e,p,o,s,"operator",g),m=h.newValue,y=h.newValueSrc,S=h.newValueType,C=h.newValueError,F=h.newFieldError;p=p.set("value",m).set("valueSrc",y).set("valueType",S),l&&(p=p.set("valueError",C).set("fieldError",F))}var T=_e(e,o);if(T?.type==="!group"){var w=fa(e,T);p=p.set("conjunction",w)}return p},Fv=function(e,r){return r?.type=="group"?pa(e):jn(e,null,r)},Cv=function(e,r){return(0,X.A)({},e,new Ne.Map({type:"rule",id:e,properties:jn(r)}))},uS=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return new Ne.Map({type:"group",id:Tt(),children1:new Ne.OrderedMap(r?sS({},Cv(Tt(),e)):{}),properties:pa(e)})},Qa=$(80045);function Ev(n,e,r,t,a,i,o){try{var s=n[i](o),u=s.value}catch(l){return void r(l)}s.done?e(u):Promise.resolve(u).then(t,a)}function lS(n){return function(){var e=this,r=arguments;return new Promise(function(t,a){var i=n.apply(e,r);function o(u){Ev(i,t,a,o,s,"next",u)}function s(u){Ev(i,t,a,o,s,"throw",u)}o(void 0)})}}var cS=["title","value","disabled","groupTitle","grouplabel","renderTitle","children","label","isCustom","isHidden"];function dS(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=fS(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function fS(n,e){if(n){if(typeof n=="string")return wv(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wv(n,e)}}function wv(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function Av(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function ha(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Av(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Av(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var pS=function(e,r){if(e.findLastIndex)return e.findLastIndex(r);var t=(0,ue.A)(e).reverse().findIndex(r);return t==-1?-1:e.length-1-t},vS=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;return function(){var a=lS(Hn().mark(function i(o,s,u){var l,c,d,f,p,g,h,m,y,S;return Hn().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(!t){F.next=3;break}return F.next=3,sd(t);case 3:if(l=!!(u!=null&&u.fetchSelectedValues)&&Array.isArray(o),!l){F.next=7;break}return c=vc(e).filter(function(T){var w=T.value;return o.includes(w)}),F.abrupt("return",{values:c});case 7:return d=u?.pageSize!=null?u.pageSize:r,f=vc(e).filter(function(T){var w=T.title,_=T.value;return o==null?!0:w.toUpperCase().indexOf(o.toUpperCase())!=-1||"".concat(_).toUpperCase().indexOf(o.toUpperCase())!=-1}),p=d?Math.ceil(f.length/d):0,g=s||0,h=d?Math.ceil(g/d):null,m=d?f.slice(g,g+d):f,y=d?g+m.length:null,S=d?y<f.length:!1,F.abrupt("return",{values:m,hasMore:S});case 16:case"end":return F.stop()}},i)}));return function(i,o,s){return a.apply(this,arguments)}}()},gS=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!r)return e;var i=e||[],o=r.filter(function(u){return i.find(function(l){return""+l.value==""+u.value})==null}).map(function(u){return a?ha(ha({},u),{},{isHidden:!0}):u}),s=t?[].concat((0,ue.A)(o),(0,ue.A)(i)):[].concat((0,ue.A)(i),(0,ue.A)(o));return s},hS=function(e,r,t){var a,i=e==null||e==""?void 0:(a=e?.value)!==null&&a!==void 0?a:e,o=Cu(i,r),s=t&&!o?pc(i):void 0,u=o||s,l=u?[u]:void 0;return[i,l]},mS=function(e,r,t){var a=e.map(function(o,s){var u,l=o==null||o==""?void 0:(u=o?.value)!==null&&u!==void 0?u:o,c=Cu(l,r),d=t&&!c?pc(l):void 0,f=c||d;return f}).filter(function(o){return o!=null}),i=a.map(function(o){var s;return(s=o?.value)!==null&&s!==void 0?s:o});return i.length||(i=void 0),[i,a]},yS=function(e){if(e==null)return null;var r=e.title,t=e.value,a=e.disabled,i=e.groupTitle,o=e.grouplabel,s=e.renderTitle,u=e.children,l=e.label,c=e.isCustom,d=e.isHidden,f=(0,Qa.A)(e,cS),p={value:t,title:r||l||u};return a&&(p.disabled=a),c&&(p.isCustom=c),d&&(p.isHidden=d),(i||o)&&(p.groupTitle=i||o),s&&(p.renderTitle=s),p=ha(ha({},p),f),p},bS=function(e){var r=[],t=[],a=dS(e),i;try{var o=function(){var u=i.value,l=pS(r,function(c){var d,f;return((d=c.groupTitle)!==null&&d!==void 0?d:"")==((f=u.groupTitle)!==null&&f!==void 0?f:"")});u.groupTitle!=null&&!t.includes(u.groupTitle)&&(t.push(u.groupTitle),t.length===1&&(r=r.map(function(c){return ha(ha({},c),{},{groupTitle:""})}))),u.groupTitle==null&&t.length&&(u=ha(ha({},u),{},{groupTitle:""})),l!=-1?r.splice(l+1,0,u):r.push(u)};for(a.s();!(i=a.n()).done;)o()}catch(s){a.e(s)}finally{a.f()}return r};function Tv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Eu(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Tv(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Tv(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function wu(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=SS(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function SS(n,e){if(n){if(typeof n=="string")return _v(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _v(n,e)}}function _v(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}var OS=jo,FS=Ro,CS=function(e){return["length"].includes(e)},Lv=["between","not_between","is_empty","is_not_empty","is_null","is_not_null","some","all","none"],ES=["proximity"],wS=function(e){var r={},t=function(P){var V=e.operators[P],L=V.spelOps?V.spelOps:V.spelOp?[V.spelOp]:void 0;if(L)L.forEach(function(z){var H=z;r[H]||(r[H]=[]),r[H].push(P)});else{var U,B=(U=e.operators)===null||U===void 0?void 0:U[V.reversedOp],G=B?.spelOp||B?.spelOps,W=G||Lv.includes(P)||Lv.includes(V.reversedOp)||ES.includes(P);W||FS.warn("[spel] No spelOp for operator ".concat(P))}};for(var a in e.operators)t(a);var i={};for(var o in e.conjunctions){var s=e.conjunctions[o],u=s.spelConj||o.toLowerCase();i[u]=o}var l={},c=wu(OS(e)),d;try{var f=function(){var P=(0,ve.A)(d.value,2),V=P[0],L=P[1],U=[],B=L.spelFunc;if(typeof B=="string"){var G=Object.keys(L.args||{}).reverse().filter(function(Y){return!!L.args[Y].isOptional||L.args[Y].defaultValue!=null}),W=B.replace(/\?\./g,".").replace(/\${(\w+)}/g,function(Y,Z){return"?"}),z=G.reduce(function(Y,Z){return[].concat((0,ue.A)(Y),[[Z].concat((0,ue.A)(Y[Y.length-1]||[]))])},[]).map(function(Y){return B.replace(/(?:, )?\${(\w+)}/g,function(Z,se){return Y.includes(se)?"":Z}).replace(/\?\./g,".").replace(/\${(\w+)}/g,function(Z,se){return"?"})});U=[W].concat((0,ue.A)(z))}var H=wu(U),q;try{for(H.s();!(q=H.n()).done;){var J=q.value;l[J]||(l[J]=[]),l[J].push(V)}}catch(Y){H.e(Y)}finally{H.f()}};for(c.s();!(d=c.n()).done;)f()}catch(j){c.e(j)}finally{c.f()}var p={};for(var g in e.widgets){var h=e.widgets[g],m=h.spelImportFuncs;if(m){var y=wu(m),S;try{for(y.s();!(S=y.n()).done;){var C=S.value;if(typeof C=="string"){var F=C.replace(/\?\./g,".").replace(/\${(\w+)}/g,function(j,P){return"?"}),T=(0,ue.A)(C.matchAll(/\${(\w+)}/g)).map(function(j){var P=(0,ve.A)(j,2),V=P[0],L=P[1];return L});p[F]||(p[F]=[]),p[F].push({w:g,argsOrder:T})}}}catch(j){y.e(j)}finally{y.f()}}}var w={},_=function(P){var V=e.operators[P],L=V.spelOps?V.spelOps:V.spelOp?[V.spelOp]:void 0;L?.forEach(function(U){if(U!=null&&U.includes("${0}")){var B=U.replace(/\?\./g,".").replace(/\${(\w+)}/g,function(W,z){return"?"}),G=(0,ue.A)(U.matchAll(/\${(\w+)}/g)).map(function(W){var z=(0,ve.A)(W,2),H=z[0],q=z[1];return q});w[B]||(w[B]=[]),w[B].push({op:P,argsOrder:G})}})};for(var M in e.operators)_(M);var D=Df.replace(/\?\./g,".").replace(/\${(\w+)}/g,function(j,P){return"?"});return w[D]=[{op:"!compare",argsOrder:["0","1"]}],{operators:r,conjunctions:i,funcs:l,valueFuncs:p,opFuncs:w}},AS=function(e){var r=[{s:"",params:[],objs:[]}];return TS(e,r),r.map(function(t){var a=t.s,i=t.params;return{s:a,params:i}}).reverse().filter(function(t){var a=t.s;return a!==""&&a!=="?"})},TS=function n(e,r){var t=[],a="",i=e.type,o=e.methodName,s=e.val,u=e.obj,l=e.args,c=e.isVar,d=e.cls,f=e.children,p=f?.[f.length-1],g=r[r.length-1];if(i==="!func"){for(var h=u;h;){var m,y=n(Eu(Eu({},h),{},{obj:null}),[{}]),S=(0,ve.A)(y,2),C=S[0],F=S[1];if(C!=="?"){var T={s:g.s,params:(0,ue.A)(g.params),objs:(0,ue.A)(g.objs)};g.objs.unshift("?"),g.params.unshift(h),r.push(T),g=r[r.length-1]}g.objs.unshift(C),(m=g.params).unshift.apply(m,(0,ue.A)(F)),h=h.type==="!func"?h.obj:null}var w=wu(r),_;try{for(w.s();!(_=w.n()).done;){var M,D=_.value;t=[].concat((0,ue.A)(D?.params||[]),(0,ue.A)(l||[])),a="",D!=null&&(M=D.objs)!==null&&M!==void 0&&M.length&&(a+=D.objs.join(".")+"."),a+=(c?"#":"")+o,a+="("+(l||[]).map(function(j){return"?"}).join(", ")+")",D.s=a,D.params=t}}catch(j){w.e(j)}finally{w.f()}}else i==="!new"?(t=l||[],a="new ".concat(d.join("."),"(").concat(t.map(function(j){return"?"}).join(", "),")")):i==="!type"?a="T(".concat(d.join("."),")"):i==="compound"&&p.type==="property"&&CS(p.val)?a=f.map(function(j){var P;if(j===p)return j.val;var V=n(Eu(Eu({},j),{},{obj:null}),[{}]),L=(0,ve.A)(V,2),U=L[0],B=L[1];return(P=t).push.apply(P,(0,ue.A)(B)),U}).join("."):(t=[e],a="?");return g&&(g.s=a,g.params=t),[a,t]};function Rv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function _r(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Rv(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Rv(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var jv=tt,_S=jv.isObject,Uo=jv.uuid,xv=Te,LS=xv.defaultConjunction,Jw=xv.defaultGroupConjunction,Iv=ne,Au=Iv.getFieldConfig,RS=Iv.getWidgetForFieldOp,Bo=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return{type:"group",id:Uo(),children1:(0,X.A)({},e.id,e),properties:{conjunction:LS(r),not:t||!1}}},Dv=function(e,r,t,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null,s=xS(a,i,t,r,o),u;return e?(u=e,u.type?(u.type!="group"&&u.type!="case_group"&&(u=Bo(u,a)),u.type="case_group"):(i.errors.push("Unexpected case: ".concat(JSON.stringify(u))),u=void 0)):u={id:Uo(),type:"case_group",properties:{}},u&&(u.properties=_r(_r({},u.properties),s)),u},Pv=function(e,r,t,a){var i={},o=Dv(null,e,r,t,a);o&&(i[o.id]=o);var s={type:"switch_group",id:Uo(),children1:i,properties:{}};return s},jS=function(e,r,t,a,i){var o=e.groupFilter,s=e.groupFieldValue;if(s.valueSrc!="field")throw"Bad groupFieldValue: ".concat(JSON.stringify(s));var u=s.value,l=hc(a,i,u,r,t);if(l){var c=Au(a,u),d=c?.mode,f;return o?.type==="group"?f=_r(_r({},o||{}),{},{type:"rule_group",properties:_r(_r(_r({},l.properties),o?.properties||{}),{},{mode:d})}):o?f=_r(_r({},l||{}),{},{type:"rule_group",children1:[o],properties:_r(_r({},l.properties),{},{mode:d})}):f=_r(_r({},l||{}),{},{type:"rule_group",properties:_r(_r({},l.properties),{},{mode:d})}),f.id||(f.id=Uo()),f}},xS=function(e,r,t,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o={},s,u,l=Au(e,"!case_value");if(a?.valueType==="case_value")s="case_value";else if(s=l?.mainWidget,u=e.widgets[s],a&&a.valueSrc==="value"){var c;a.valueType=((c=u)===null||c===void 0?void 0:c.type)||l?.type||a.valueType}var d=e.widgets[s];if(s==="case_value"){var f=d?.spelImportValue;if(f){var p=f.call(e.ctx,a),g=(0,ve.A)(p,2),h=g[0],m=g[1];if(m.map(function(S){return r.errors.push(S)}),h!=null){var y;o={value:[h],valueSrc:["value"],valueType:[(y=d?.type)!==null&&y!==void 0?y:"case_value"],field:"!case_value"}}}}else a!=null&&a?.value!=null&&(o={value:[a.value],valueSrc:[a.valueSrc],valueType:[a.valueType],field:"!case_value"});return o},hc=function(e,r,t,a,i,o){var s,u;if(!i.filter(function(P){return P===void 0}).length){var l=(s=t)!==null&&s!==void 0&&s.func?"func":"field";_S(t)&&t.valueSrc&&(l=t.valueSrc,t=t.value);var c=Au(e,t);if(!c){r.errors.push("No config for field ".concat(t));return}var d=Au(e,o?._groupField),f=c.type=="!group",p=f&&c.mode=="array",g=d?.type=="!group",h=e.operators[a],m=e.operators[(u=h)===null||u===void 0?void 0:u.reversedOp],y=o?.not&&["between"].includes(a),S=!!m,C=S&&(!!e.settings.reverseOperatorsForNot||y||!f&&g),F=o?.not&&C||y;F&&(a=h.reversedOp,h=e.operators[a],o.not=!o.not);var T=!!(o!=null&&o.not),w=RS(e,t,a),_=e.widgets[w||c.mainWidget],M=i.map(function(P){return P.asyncListValues}).filter(function(P){return P!=null}),D=M.length?M[0]:void 0,j={type:"rule",id:Uo(),properties:_r({field:t,fieldSrc:l,operator:a,value:i.map(function(P){return P.value}),valueSrc:i.map(function(P){return P.valueSrc}),valueType:i.map(function(P){return P.valueSrc=="value"&&(_?.type||c?.type)||P.valueType})},D?{asyncListValues:D}:{})};return T&&(j=Bo(j,e,o.not)),j}};function Nv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Vv(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Nv(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Nv(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var IS=Ro,DS=function n(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=e.getType(),i=e.getChildren().map(function(L){return n(L,r,e)});if((a=="op-or"||a=="op-and")&&(i=i.reduce(function(L,U){var B=U.type=="op-and"&&U.children.length==2&&U.children[0].type=="op-ge"&&U.children[1].type=="op-le",G=U.type=="op-or"&&U.children.length==2&&U.children[0].type=="op-lt"&&U.children[1].type=="op-gt",W=B||G,z=U.type==a&&!U.not&&!W,H=z?U.children:[U];return[].concat((0,ue.A)(L),(0,ue.A)(H))},[])),a=="op-not")return i.length!=1&&r.errors.push("Operator NOT should have 1 child, but got ".concat(i.length,"}")),Vv(Vv({},i[0]),{},{not:!i[0].not});if(a=="compound"){i=i.filter(function(L){var U=L.type=="selection"&&L.children.length==1&&L.children[0].type=="boolean"&&L.children[0].val==!0;return!U});var o=i.find(function(L){return L.type=="selection"});o&&o.children.length!=1&&r.errors.push("Selection should have 1 child, but got ".concat(o.children.length));var s=o?o.children[0]:null,u=i[i.length-1],l=u.type=="method"&&u.val.methodName=="size"||u.type=="!func"&&u.methodName=="size",c=u.type=="property"&&u.val=="length",d=i.filter(function(L){return L!==o&&L!==u}),f={type:"compound",children:d},p=(l||c)&&Mv(d)!=null;if(p)return{type:"!aggr",filter:s,source:f};if(i=i.filter(function(L){var U=L.type=="variable"&&L.val=="this",B=L.type=="variable"&&L.val=="root";return!(U||B)}),i=i.map(function(L){return L.type=="indexer"&&L.children.length==1?{type:"indexer",val:L.children[0].val,itype:L.children[0].type}:L}),u.type=="!func"){var g={},h=g;do{var m,y;Object.assign(h,u),i=i.filter(function(L){return L!==u}),u=i[i.length-1],((y=u)===null||y===void 0?void 0:y.type)=="!func"?(h.obj={},h=h.obj):i.length>1?h.obj={type:"compound",children:i}:h.obj=u}while(((m=u)===null||m===void 0?void 0:m.type)=="!func");return g}}var S;try{e.getRaw?S=e.getRaw():e.getValue.length==0&&(S=e.getValue())}catch(L){IS.error("[spel2js] Error in getValue()",L)}if(a=="ternary"&&(S=PS(i)),(0,ft.A)(S)==="object"&&S!==null&&(S.methodName||S.functionName)&&(S.args=S.args.map(function(L){return n(L,r,e)})),a=="list"&&(S=S.map(function(L){return n(L,r,e)}),!t&&S.length==1))return S[0];if(a=="constructorref"){var C=i.find(function(L){return L.type=="qualifiedidentifier"}),F=C?.val;if(!F){r.errors.push("Can't find qualifiedidentifier in constructorref children: ".concat(JSON.stringify(i)));return}var T=i.filter(function(L){return L.type!="qualifiedidentifier"});return{type:"!new",cls:F,args:T}}if(a=="typeref"){var w=i.find(function(L){return L.type=="qualifiedidentifier"}),_=w?.val;if(!_){r.errors.push("Can't find qualifiedidentifier in typeref children: ".concat(JSON.stringify(i)));return}var M=i.filter(function(L){return L.type!="qualifiedidentifier"});return{type:"!type",cls:_}}if(a=="function"||a=="method"){var D=S,j=D.functionName,P=D.methodName,V=D.args;return{type:"!func",methodName:j||P,isVar:a=="function",args:V}}return{type:a,children:i,val:S}},PS=function(e){var r=[];function t(a){var i=(0,ve.A)(a,3),o=i[0],s=i[1],u=i[2];r.push([o,s]),u?.type=="ternary"?t(u.children):r.push([void 0,u])}return t(e),r},Mv=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=!1,i=e.map(function(o){if(o.type=="variable"||o.type=="property"||o.type=="indexer"&&o.itype=="string")return o.val;var s,u;a=!0,t&&(r==null||(s=r.errors)===null||s===void 0||(u=s.push)===null||u===void 0||u.call(s,"Unexpected item in field path compound: ".concat(JSON.stringify(o))))});return a?void 0:i};function Ni(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=NS(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function NS(n,e){if(n){if(typeof n=="string")return kv(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kv(n,e)}}function kv(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function Gv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function $v(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Gv(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Gv(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var Tu=tt,Uv=Tu.isJsonCompatible,Bv=Tu.isObject,mc=Tu.uuid,Wv=Tu.logger,Wo=ne,zv=Wo.getFieldConfig,qv=Wo.getFuncConfig,Hv=Wo.normalizeField,VS=Wo.iterateFuncs,MS=Wo.getWidgetForFieldOp,Qv={number:"number",string:"text",boolean:"boolean",null:"null"},Jv={String:"text"},kS="multiselect",_u=function n(e,r,t,a){var i,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(e){e._groupField=(i=e._groupField)!==null&&i!==void 0?i:o?._groupField;var s,u=!0;if(e.type.indexOf("op-")===0||e.type==="matches")s=GS(e,r,t,a,o);else if(e.type=="!aggr"){var l,c=n(e.source,r,t,a,e);e._groupField=c?.value;var d=n(e.filter,r,t,a,e);((l=d)===null||l===void 0?void 0:l.type)=="rule"&&(d=Bo(d,t,e.filter.not)),s={groupFilter:d,groupFieldValue:c},o||(s=void 0,a.errors.push("Unexpected !aggr in root"),u=!1)}else if(e.type=="ternary"){var f={};e.val.forEach(function(h){var m=(0,ve.A)(h,2),y=m[0],S=m[1],C=n(y,r,t,a,e),F=yc(S,r,t,a,e),T=Dv(C,F,r,t,a,e);T&&(f[T.id]=T)}),s={type:"switch_group",id:mc(),children1:f,properties:{}}}if(!s&&u&&(s=zo(e,r,t,a,o)),s&&!s.type&&!o){var p=yc(e,r,t,a),g=Pv(p,r,t,a);g?s=g:(s=void 0,a.errors.push("Can't convert rule of type ".concat(e.type,", it looks like var/literal")))}return s}},GS=function n(e,r,t,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o,s=e.type.startsWith("op-")?e.type.slice(3):e.type,u=(s=="minus"||s=="plus")&&e.children.length==1;if(u){var l=e.negative;return s=="minus"&&(l=!l),e.children[0].negative=l,_u(e.children[0],r,t,a,i)}var c=s=="and"&&e.children.length==2&&e.children[0].type=="op-ge"&&e.children[1].type=="op-le",d=s=="or"&&e.children.length==2&&e.children[0].type=="op-lt"&&e.children[1].type=="op-gt",f=c||d;if(f){var p=(0,ve.A)(e.children[0].children,2),g=p[0],h=p[1],m=(0,ve.A)(e.children[1].children,2),y=m[0],S=m[1],C=WS(g,y,e,r,t,a,i);if(C){var F=h.val,T=S.val,w={type:"op-between",children:[g,h,S],not:d};return w._groupField=i?._groupField,n(w,r,t,a,i)}}var _=r.operators[s];s=="eq"&&e.children[1].type=="null"?_=["is_null"]:s=="ne"&&e.children[1].type=="null"?_=["is_not_null"]:s=="le"&&e.children[1].type=="string"&&e.children[1].val==""?_=["is_empty"]:s=="gt"&&e.children[1].type=="string"&&e.children[1].val==""?_=["is_not_empty"]:s=="between"&&(_=["between"]);var M=function(){var Ve,Re=e.children.map(function(Ce){return _u(Ce,r,t,a,e)});return Re.length>=2&&((Ve=Re)===null||Ve===void 0||(Ve=Ve[0])===null||Ve===void 0?void 0:Ve.type)=="!compare"&&(Re=Re[0].children),Re};if(s=="and"||s=="or"){var D={},j=M();j.forEach(function(ke){if(ke){var Ve=mc();ke.id=Ve,ke.type!=null?D[Ve]=ke:a.errors.push("Bad item in AND/OR: ".concat(JSON.stringify(ke)))}}),o={type:"group",id:mc(),children1:D,properties:{conjunction:r.conjunctions[s],not:e.not}}}else if(_){var P,V,L,U=M(),B=U[0],G=U.slice(1),W=B==null||(P=B.groupFieldValue)===null||P===void 0?void 0:P.value,z=(V=G)===null||V===void 0?void 0:V[0],H=_[0];if(_.length>1){var q,J,Y=((q=U[0])===null||q===void 0?void 0:q.valueType)||((J=U[1])===null||J===void 0?void 0:J.valueType),Z=B?.value,se=_.map(function(ke){return{op:ke,widget:MS(t,Z,ke)}});if(s=="eq"||s=="ne"){var re=se.find(function(ke){var Ve=ke.op,Re=ke.widget;return Re&&Re!="field"});re&&(H=re.op)}else Wv.warn("[spel] Spel operator ".concat(s," can be mapped to ").concat(_,"."),"widgets:",se,"vals:",U,"valueType=",Y)}B!=null&&B.groupFieldValue&&(z&&z.groupFieldValue&&z.groupFieldValue.valueSrc=="field"&&z.groupFieldValue.value==W?(H="all",G=[]):H=="equal"&&z.valueSrc=="value"&&z.valueType=="number"&&z.value==0?(H="none",G=[]):H=="greater"&&z.valueSrc=="value"&&z.valueType=="number"&&z.value==0&&(H="some",G=[]));var ee=t.operators[H],Fe=t.operators[(L=ee)===null||L===void 0?void 0:L.reversedOp],pe=e.not&&["between"].includes(H),oe=!!Fe,Se=oe&&(!!t.settings.reverseOperatorsForNot||pe),he=e.not&&Se||pe;he&&(H=ee.reversedOp,ee=t.operators[H],e.not=!e.not);var be=!!e.not;if(e.not=!1,B)if(B.groupFieldValue)B.groupFieldValue.valueSrc!="field"&&a.errors.push("Expected group field ".concat(JSON.stringify(B))),o=jS(B,H,G,t,a);else{B.valueSrc!="field"&&B.valueSrc!="func"&&a.errors.push("Expected field/func at LHS, but got ".concat(JSON.stringify(B)));var Le=B.value;o=hc(t,a,Le,H,G,e)}be&&(o.type!=="group"?o=Bo(o,t,!0):o.properties.not=!o.properties.not)}else if(!i){var Ae=yc(e,r,t,a);o=Pv(Ae,r,t,a)}return o},zo=function n(e,r,t,a){var i,o,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(e!=null){var u=t.settings.fieldSeparator;if(e._groupField=(i=e._groupField)!==null&&i!==void 0?i:s?._groupField,e.type=="variable"||e.type=="property"){var l=Hv(t,e.val,e._groupField),c=zv(t,l),d=e.type=="variable";return{valueSrc:"field",valueType:c?.type,isVariable:d,value:l}}else if(e.type=="compound"){var f=Mv(e.children,a);if(f){var p,g=Hv(t,f.join(u),e._groupField),h=zv(t,g),m=((p=e.children)===null||p===void 0||(p=p[0])===null||p===void 0?void 0:p.type)=="variable";return{valueSrc:"field",valueType:h?.type,isVariable:m,value:g}}}else if(Qv[e.type]){var y=e.val,S=Qv[e.type];return e.negative&&(y=-y),{valueSrc:"value",valueType:S,value:y}}else if(e.type=="!new"&&Jv[e.cls.at(-1)]){var C=e.args.map(function(V){return n(V,r,t,a,e)}),F=C?.[0],T=Jv[e.cls.at(-1)];return $v($v({},F),{},{valueType:T})}else if(e.type=="list"){var w,_=e.val.map(function(V){return n(V,r,t,a,e)}),M=_.length?(w=_[0])===null||w===void 0?void 0:w.valueType:null,D=_.map(function(V){return V?.value}),j=kS;return{valueSrc:"value",valueType:j,value:D}}else if(e.type==="op-plus"&&s?.type==="ternary"&&((o=t.settings.caseValueField)===null||o===void 0?void 0:o.type)==="case_value")return Yv(e,r,t,a);var P=$S(e,r,t,a,s);if(P!==void 0)return P;a.errors.push("Can't convert arg of type ".concat(e.type))}},$S=function(e,r,t,a){var i,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,s=function(G){return _u(G,r,t,a,e)},u=AS(e),l=u==null||(i=u[0])===null||i===void 0?void 0:i.s;u.length&&Wv.debug("Signatures for ",e,":",l,u);var c=US(e,r,t,a,o,u,s);if(c!==void 0)return c;var d=BS(e,r,t,a,o,u,s);if(d!==void 0)return d;var f,p,g,h=Ni(u),m;try{var y=function(){var G=m.value,W=G.s,z=G.params,H=r.funcs[W];if(H){f=H[0],p=qv(t,f);var q=p,J=q.spelFunc,Y=z.map(s),Z=(0,ue.A)(J.matchAll(/\${(\w+)}/g)).map(function(se){var re=(0,ve.A)(se,2),ee=re[0],Fe=re[1];return Fe});return g=Object.fromEntries(Z.map(function(se,re){return[se,Y[re]]})),1}};for(h.s();!(m=h.n()).done&&!y(););}catch(B){h.e(B)}finally{h.f()}if(!f){var S=Ni(VS(t)),C;try{for(S.s();!(C=S.n()).done;){var F=(0,ve.A)(C.value,2),T=F[0],w=F[1];if(w.spelImport){var _=void 0;try{_=w.spelImport.call(t.ctx,e)}catch{}if(_){f=T,p=qv(t,f),g={};for(var M in _)g[M]=s(_[M])}}}}catch(B){S.e(B)}finally{S.f()}}if(f){var D={};for(var j in p.args){var P=p.args[j],V=g[j];if(V===void 0)if(V=P?.defaultValue,V===void 0){if(!(P!=null&&P.isOptional)){a.errors.push("No value for arg ".concat(j," of func ").concat(f));return}}else{var L;V={value:V,valueSrc:(L=V)!==null&&L!==void 0&&L.func?"func":"value",valueType:P.type}}V&&(D[j]=V)}return{valueSrc:"func",value:{func:f,args:D},valueType:p.returnType}}var U=e.methodName;U&&a.errors.push("Signature ".concat(l," - failed to convert"))},US=function(e,r,t,a,i,o,s){var u,l,c,d=[];for(var f in t.widgets){var p=t.widgets[f],g=p.spelImportFuncs;if(g)for(var h=0;h<g.length;h++){var m=g[h];if(Bv(m)){var y={};if(Uv(m,e,y)){for(var S in y)y[S]=s(y[S]);d.push({s:"widgets.".concat(f,".spelImportFuncs[").concat(h,"]"),w:f,argsObj:y})}}}}var C=Ni(o),F;try{for(C.s();!(F=C.n()).done;){var T=F.value,w=T.s,_=T.params,M=r.valueFuncs[w]||[],D=Ni(M),j;try{var P=function(){var ee=j.value,Fe=ee.w,pe=ee.argsOrder,oe=_.map(s),Se=Object.fromEntries(pe.map(function(he,be){return[he,oe[be]]}));d.push({s:w,w:Fe,argsObj:Se})};for(D.s();!(j=D.n()).done;)P()}catch(re){D.e(re)}finally{D.f()}}}catch(re){C.e(re)}finally{C.f()}for(var V=0,L=d;V<L.length;V++){var U=L[V],B=U.s,G=U.w,W=U.argsObj,z=t.widgets[G],H=z.spelImportValue,q=z.type;c=G,l=B,u=[];for(var J in W)["value"].includes(W[J].valueSrc)||u.push("".concat(J," has unsupported value src ").concat(W[J].valueSrc));var Y=W.v.value;if(H&&!u.length){var Z=H.call(t.ctx,W.v,z,W),se=(0,ve.A)(Z,2);Y=se[0],u=se[1],u&&!Array.isArray(u)&&(u=[u])}if(!u.length)return{valueSrc:"value",valueType:q,value:Y}}c&&u.length&&a.errors.push("Signature ".concat(l," - looks like convertable to ").concat(c,", but: ").concat(u.join("; ")))},BS=function(e,r,t,a,i,o,s){var u=[],l=Ni(o),c;try{for(l.s();!(c=l.n()).done;){var d=c.value,f=d.s,p=d.params,g=r.opFuncs[f]||[],h=Ni(g),m;try{var y=function(){var W,z=m.value,H=z.op,q=z.argsOrder,J=p.map(s),Y=[];if(H==="!compare"){if(i.type.startsWith("op-")&&i.children.length==2&&i.children[1].type=="number"&&i.children[1].val===0)return{v:{type:"!compare",children:J}};Y.push("Result of compareTo() should be compared to 0")}var Z=t.operators[H],se=Z.valueTypes,re=Object.fromEntries(q.map(function(oe,Se){return[oe,J[Se]]})),ee=re[0],Fe=Object.keys(re).filter(function(oe){return parseInt(oe)>0}).map(function(oe){return re[oe]}),pe=(W=J.filter(function(oe){return!!oe&&oe!==ee}))===null||W===void 0||(W=W[0])===null||W===void 0?void 0:W.valueType;se&&pe&&!se.includes(pe)&&Y.push("Op supports types ".concat(se,", but got ").concat(pe)),u.push({opKey:H,foundSign:f,field:ee,convertedArgs:Fe,errs:Y})},S;for(h.s();!(m=h.n()).done;)if(S=y(),S)return S.v}catch(G){h.e(G)}finally{h.f()}}}catch(G){l.e(G)}finally{l.f()}for(var C in t.operators){var F=t.operators[C],T=F.spelImportFuncs,w=F.valueTypes;if(T)for(var _=function(){var W=T[M];if(Bv(W)){var z={};if(Uv(W,e,z)){var H,q=[];for(var J in z)z[J]=s(z[J]);var Y=z[0],Z=Object.keys(z).filter(function(re){return parseInt(re)>0}).map(function(re){return z[re]}),se=(H=z[1])===null||H===void 0?void 0:H.valueType;w&&se&&!w.includes(se)&&q.push("Op supports types ".concat(w,", but got ").concat(se)),u.push({opKey:C,foundSign:"spelImportFuncs[".concat(M,"]"),field:Y,convertedArgs:Z,errs:q})}}},M=0;M<T.length;M++)_()}var D=u.find(function(G){var W=G.errs;return!W.length});if(D){var j=D.opKey,P=D.foundSign,V=D.field,L=D.convertedArgs,U=D.errs;return hc(t,a,V,j,L,e)}else if(u.length){var B=u.map(function(G){var W=G.foundSign,z=G.opKey,H=G.errs;return"Looks like convertable to ".concat(z," with signature ").concat(W,", but: ").concat(H.join("; "))}).join(".  ");a.errors.push(B)}},WS=function(e,r,t,a,i,o){if(e.type==r.type)if(e.type=="!aggr"){var s=[e.source,r.source].map(function(h){return zo(h,a,i,o,t)}),u=(0,ve.A)(s,2),l=u[0],c=u[1];return l.value==c.value}else{var d=[e,r].map(function(h){return zo(h,a,i,o,t)}),f=(0,ve.A)(d,2),p=f[0],g=f[1];return p.value==g.value}return!1},yc=function(e,r,t,a){var i,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,s;return e?.type==="op-plus"&&((i=t.settings.caseValueField)===null||i===void 0?void 0:i.type)==="case_value"?s=Yv(e,r,t,a):s=zo(e,r,t,a,o),s},Yv=function(e,r,t,a){var i=[];function o(s){s.map(function(u){if(u.type==="op-plus")o(u.children);else{var l=zo(u,r,t,a,e);l?i.push(l):a.errors.push("Can't convert ".concat(u.type," in concatenation"))}})}return o(e.children),{valueSrc:"value",valueType:"case_value",value:i}},Kv=Ro,zS=rn,qS=function(e,r){return Xv(e,r,!0)},Xv=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={errors:[]},i=zS(r,void 0,!1),o=wS(i),s,u,l=void 0;try{var c=Cb.SpelExpressionEvaluator.compile(e);s=c._compiledExpression}catch(f){a.errors.push(f)}s&&(u=DS(s,a),Kv.debug("convertedObj:",u,a),l=_u(u,o,i,a),l&&l.type!="group"&&l.type!="switch_group"&&(l=Bo(l,i,u.not)),Kv.debug("jsTree:",l));var d=l?rc(l):void 0;return t?[d,a.errors]:(a.errors.length&&console.warn("Errors while importing from SpEL:",a.errors),d)},HS=function(e,r,t,a,i,o,s,u,l,c,d,f){var p=typeof a=="string"&&!a.startsWith("$")?"$"+a:a,g=r(o,f);if(g!==void 0)return t?!s&&(!e||e=="$eq")?(0,X.A)({},a,{$ne:g}):s?{$not:(0,X.A)({},e,[p,g])}:(0,X.A)({},a,{$not:(0,X.A)({},e,g)}):!s&&(!e||e=="$eq")?(0,X.A)({},a,g):s?(0,X.A)({},e,[p,g]):(0,X.A)({},a,(0,X.A)({},e,g))},QS=function(e,r,t,a,i,o,s,u,l,c,d){var f=typeof t=="string"&&!t.startsWith("$")?"$"+t:t;return r?o?{$not:{$and:[(0,X.A)({},e[0],[f,i[0]]),(0,X.A)({},e[1],[f,i[1]])]}}:(0,X.A)({},t,{$not:(0,X.A)((0,X.A)({},e[0],i[0]),e[1],i[1])}):o?{$and:[(0,X.A)({},e[0],[f,i[0]]),(0,X.A)({},e[1],[f,i[1]])]}:(0,X.A)({},t,(0,X.A)((0,X.A)({},e[0],i[0]),e[1],i[1]))},JS={utils:{SqlString:Jn,moment:Ga(),mongoFormatOp1:HS,mongoFormatOp2:QS,mongoEmptyValue:bf,escapeRegExp:id,sqlEmptyValue:yf,stringifyForDisplay:Of,getTitleInListValues:ov,spelEscape:Li,spelFixList:Sf,wrapWithBrackets:Ff}};const YS=JS;function KS(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=XS(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function XS(n,e){if(n){if(typeof n=="string")return Zv(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zv(n,e)}}function Zv(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function eg(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function lt(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?eg(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):eg(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var ZS={AND:{label:"And",mongoConj:"$and",jsonLogicConj:"and",sqlConj:"AND",spelConj:"and",spelConjs:["and","&&"],reversedConj:"OR",formatConj:function(e,r,t,a){var i=e.size>1?e.join(" "+(a?"AND":"&&")+" "):e.first();return(e.size>1||t)&&(i=this.utils.wrapWithBrackets(i)),t&&(i="NOT "+i),i},sqlFormatConj:function(e,r,t){var a=e.size>1?e.join(" AND "):e.first();return(e.size>1||t)&&(a=this.utils.wrapWithBrackets(a)),t&&(a="NOT "+a),a},spelFormatConj:function(e,r,t,a){t&&(a=!1);var i=e.size>1?e.join(" && "):e.first();return(e.size>1||t)&&!a&&(i=this.utils.wrapWithBrackets(i)),t&&(i="!"+i),i}},OR:{label:"Or",mongoConj:"$or",jsonLogicConj:"or",sqlConj:"OR",spelConj:"or",spelConjs:["or","||"],reversedConj:"AND",formatConj:function(e,r,t,a){return e.size>1?(t?"NOT ":"")+"("+e.join(" "+(a?"OR":"||")+" ")+")":(t?"NOT (":"")+e.first()+(t?")":"")},sqlFormatConj:function(e,r,t){var a=e.size>1?e.join(" OR "):e.first();return(e.size>1||t)&&(a=this.utils.wrapWithBrackets(a)),t&&(a="NOT "+a),a},spelFormatConj:function(e,r,t,a){return t&&(a=!1),e.size>1?(t?"!":"")+(a?"":"(")+e.join(" || ")+(a?"":")"):(t?"!(":"")+e.first()+(t?")":"")}}},eO={equal:{label:"==",labelForFormat:"==",sqlOp:"=",spelOp:"==",spelOps:["==","eq"],reversedOp:"not_equal",formatOp:function(e,r,t,a,i,o,s,u,l){var c=u?"=":o.label;return i=="boolean"&&u?t=="No"?"NOT ".concat(e):"".concat(e):"".concat(e," ").concat(c," ").concat(t)},mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return i},!1].concat(t))},jsonLogic:"==",elasticSearchQueryType:"term"},not_equal:{isNotOp:!0,label:"!=",labelForFormat:"!=",sqlOp:"<>",sqlOps:["<>","!="],spelOp:"!=",spelOps:["!=","ne"],reversedOp:"equal",formatOp:function(e,r,t,a,i,o,s,u,l){return i=="boolean"&&u?t=="No"?"".concat(e):"NOT ".concat(e):"".concat(e," ").concat(o.label," ").concat(t)},mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$ne",function(i){return i},!1].concat(t))},jsonLogic:"!="},less:{label:"<",labelForFormat:"<",sqlOp:"<",spelOp:"<",spelOps:["<","lt"],reversedOp:"greater_or_equal",mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$lt",function(i){return i},!1].concat(t))},jsonLogic:"<",elasticSearchQueryType:"range"},less_or_equal:{label:"<=",labelForFormat:"<=",sqlOp:"<=",spelOp:"<=",spelOps:["<=","le"],reversedOp:"greater",mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$lte",function(i){return i},!1].concat(t))},jsonLogic:"<=",elasticSearchQueryType:"range"},greater:{label:">",labelForFormat:">",sqlOp:">",spelOp:">",spelOps:[">","gt"],reversedOp:"less_or_equal",mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$gt",function(i){return i},!1].concat(t))},jsonLogic:">",elasticSearchQueryType:"range"},greater_or_equal:{label:">=",labelForFormat:">=",sqlOp:">=",spelOp:">=",spelOps:[">=","ge"],reversedOp:"less",mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$gte",function(i){return i},!1].concat(t))},jsonLogic:">=",elasticSearchQueryType:"range"},like:{label:"Contains",labelForFormat:"Contains",reversedOp:"not_like",sqlOp:"LIKE",sqlImport:function(e,r,t){if(e?.operator=="LIKE"||e?.operator=="NOT LIKE"){var a,i=e?.operator=="NOT LIKE",o=e.children||[],s=(0,ve.A)(o,2),u=s[0],l=s[1];if(l!=null&&(a=l.valueType)!==null&&a!==void 0&&a.endsWith("_quote_string")){if(l!=null&&l.value.startsWith("%")&&l!==null&&l!==void 0&&l.value.endsWith("%"))return l.value=this.utils.SqlString.unescapeLike(l.value.substring(1,l.value.length-1),t),e.operator=i?"not_like":"like",e;if(l!=null&&l.value.startsWith("%"))return l.value=this.utils.SqlString.unescapeLike(l.value.substring(1),t),e.operator="ends_with",e;if(l!=null&&l.value.endsWith("%"))return l.value=this.utils.SqlString.unescapeLike(l.value.substring(0,l.value.length-1),t),e.operator="starts_with",e}}},spelOp:"${0}.contains(${1})",valueTypes:["text"],mongoFormatOp:function(){for(var e,r=this,t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$regex",function(o){return typeof o=="string"?r.utils.escapeRegExp(o):void 0},!1].concat(a))},jsonLogic:function(e,r,t){return{in:[t,e]}},jsonLogic2:"#in",valueSources:["value"],elasticSearchQueryType:"regexp"},not_like:{isNotOp:!0,label:"Not contains",reversedOp:"like",labelForFormat:"Not Contains",sqlOp:"NOT LIKE",mongoFormatOp:function(){for(var e,r=this,t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$regex",function(o){return typeof o=="string"?r.utils.escapeRegExp(o):void 0},!0].concat(a))},jsonLogic:function(e,r,t){return{"!":{in:[t,e]}}},jsonLogic2:"#!in",_jsonLogicIsExclamationOp:!0,valueSources:["value"]},starts_with:{label:"Starts with",labelForFormat:"Starts with",sqlOp:"LIKE",spelOp:"${0}.startsWith(${1})",mongoFormatOp:function(){for(var e,r=this,t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$regex",function(o){return typeof o=="string"?"^"+r.utils.escapeRegExp(o):void 0},!1].concat(a))},jsonLogic:void 0,valueSources:["value"]},ends_with:{label:"Ends with",labelForFormat:"Ends with",sqlOp:"LIKE",spelOp:"${0}.endsWith(${1})",mongoFormatOp:function(){for(var e,r=this,t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$regex",function(o){return typeof o=="string"?r.utils.escapeRegExp(o)+"$":void 0},!1].concat(a))},jsonLogic:void 0,valueSources:["value"]},between:{label:"Between",labelForFormat:"BETWEEN",sqlOp:"BETWEEN",cardinality:2,formatOp:function(e,r,t,a,i,o,s,u){var l=t.first(),c=t.get(1);return u?"".concat(e," BETWEEN ").concat(l," AND ").concat(c):"".concat(e," >= ").concat(l," && ").concat(e," <= ").concat(c)},spelFormatOp:function(e,r,t,a,i,o,s,u){var l=t[0],c=t[1];return"(".concat(e," >= ").concat(l," && ").concat(e," <= ").concat(c,")")},mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp2.apply(e,[["$gte","$lte"],!1].concat(t))},valueLabels:["Value from","Value to"],textSeparators:[null,"and"],reversedOp:"not_between",jsonLogic:"<=",validateValues:function(e){return e[0]!=null&&e[1]!=null?e[0]<=e[1]:null},elasticSearchQueryType:function(e){return e==="time"?"filter":"range"}},not_between:{isNotOp:!0,label:"Not between",labelForFormat:"NOT BETWEEN",sqlOp:"NOT BETWEEN",cardinality:2,formatOp:function(e,r,t,a,i,o,s,u){var l=t.first(),c=t.get(1);return u?"".concat(e," NOT BETWEEN ").concat(l," AND ").concat(c):"(".concat(e," < ").concat(l," || ").concat(e," > ").concat(c,")")},spelFormatOp:function(e,r,t,a,i,o,s,u){var l=t[0],c=t[1];return"(".concat(e," < ").concat(l," || ").concat(e," > ").concat(c,")")},mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp2.apply(e,[["$gte","$lte"],!0].concat(t))},valueLabels:["Value from","Value to"],textSeparators:[null,"and"],reversedOp:"between",jsonLogic:function(e,r,t){return{"!":{"<=":[Array.isArray(t)?t[0]:t,e,Array.isArray(t)?t[1]:t]}}},jsonLogic2:"!<=",_jsonLogicIsExclamationOp:!0,validateValues:function(e){return e[0]!=null&&e[1]!=null?e[0]<=e[1]:null}},is_empty:{label:"Is empty",labelForFormat:"IS EMPTY",cardinality:0,reversedOp:"is_not_empty",formatOp:function(e,r,t,a,i,o,s,u){return u?"".concat(e," IS EMPTY"):"!".concat(e)},sqlFormatOp:function(e,r,t,a,i,o,s,u){var l=this.utils.sqlEmptyValue(u);return"COALESCE(".concat(e,", ").concat(l,") = ").concat(l)},sqlImport:function(e,r,t){if(e?.operator==="="||e?.operator==="<>"){var a,i=e.children||[],o=(0,ve.A)(i,2),s=o[0],u=o[1];if(u?.value===""&&s?.func==="COALESCE"&&(s==null||(a=s.children)===null||a===void 0||(a=a[1])===null||a===void 0?void 0:a.value)==="")return e.operator=e?.operator==="="?"is_empty":"is_not_empty",e.children=[s.children[0]],e}},spelFormatOp:function(e,r,t,a,i,o,s,u){return"".concat(e," <= ''")},mongoFormatOp:function(){for(var e,r=this,t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$in",function(o,s){return[r.utils.mongoEmptyValue(s),null]},!1].concat(a))},jsonLogic:"!"},is_not_empty:{isNotOp:!0,label:"Is not empty",labelForFormat:"IS NOT EMPTY",cardinality:0,reversedOp:"is_empty",formatOp:function(e,r,t,a,i,o,s,u){return u?"".concat(e," IS NOT EMPTY"):"!!".concat(e)},sqlFormatOp:function(e,r,t,a,i,o,s,u){var l=this.utils.sqlEmptyValue(u);return"COALESCE(".concat(e,", ").concat(l,") <> ").concat(l)},spelFormatOp:function(e,r,t,a,i,o,s,u){return"".concat(e," > ''")},mongoFormatOp:function(){for(var e,r=this,t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return(e=this.utils).mongoFormatOp1.apply(e,["$nin",function(o,s){return[r.utils.mongoEmptyValue(s),null]},!1].concat(a))},jsonLogic:"!!",elasticSearchQueryType:"exists"},is_null:{label:"Is null",labelForFormat:"IS NULL",sqlOp:"IS NULL",sqlImport:function(e,r,t){if(e?.operator==="IS"||e?.operator==="IS NOT"){var a=e.children||[],i=(0,ve.A)(a,2),o=i[0],s=i[1];if(s?.valueType=="null")return e.operator=e?.operator==="IS"?"is_null":"is_not_null",e.value=o,e}},cardinality:0,reversedOp:"is_not_null",formatOp:function(e,r,t,a,i,o,s,u){return u?"".concat(e," IS NULL"):"!".concat(e)},spelFormatOp:function(e,r,t,a,i,o,s,u){return"".concat(e," == null")},mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return null},!1].concat(t))},jsonLogic:"=="},is_not_null:{label:"Is not null",labelForFormat:"IS NOT NULL",sqlOp:"IS NOT NULL",cardinality:0,reversedOp:"is_null",formatOp:function(e,r,t,a,i,o,s,u){return u?"".concat(e," IS NOT NULL"):"!!".concat(e)},spelFormatOp:function(e,r,t,a,i,o,s,u){return"".concat(e," != null")},mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$ne",function(i){return null},!1].concat(t))},jsonLogic:"!=",elasticSearchQueryType:"exists"},select_equals:{label:"==",labelForFormat:"==",sqlOp:"=",formatOp:function(e,r,t,a,i,o,s,u){var l=u?"=":"==";return"".concat(e," ").concat(l," ").concat(t)},spelOp:"==",spelOps:["==","eq"],mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return i},!1].concat(t))},reversedOp:"select_not_equals",jsonLogic:"==",elasticSearchQueryType:"term"},select_not_equals:{isNotOp:!0,label:"!=",labelForFormat:"!=",sqlOp:"<>",sqlOps:["<>","!="],formatOp:function(e,r,t,a,i,o,s,u){return"".concat(e," != ").concat(t)},spelOp:"!=",spelOps:["!=","ne"],mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$ne",function(i){return i},!1].concat(t))},reversedOp:"select_equals",jsonLogic:"!="},select_any_in:{label:"Any in",labelForFormat:"IN",sqlOp:"IN",formatOp:function(e,r,t,a,i,o,s,u){return a=="value"?"".concat(e," IN (").concat(t.join(", "),")"):"".concat(e," IN (").concat(t,")")},sqlFormatOp:function(e,r,t,a,i,o,s,u){if(a=="value")return"".concat(e," IN (").concat(t.join(", "),")")},valueTypes:["multiselect"],spelOp:"${1}.contains(${0})",mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$in",function(i){return i},!1].concat(t))},reversedOp:"select_not_any_in",jsonLogic:"in",elasticSearchQueryType:"term"},select_not_any_in:{isNotOp:!0,label:"Not in",labelForFormat:"NOT IN",sqlOp:"NOT IN",formatOp:function(e,r,t,a,i,o,s,u){return a=="value"?"".concat(e," NOT IN (").concat(t.join(", "),")"):"".concat(e," NOT IN (").concat(t,")")},sqlFormatOp:function(e,r,t,a,i,o,s,u){if(a=="value")return"".concat(e," NOT IN (").concat(t.join(", "),")")},mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$nin",function(i){return i},!1].concat(t))},reversedOp:"select_any_in",jsonLogic:function(e,r,t){return{"!":{in:[e,t]}}},jsonLogic2:"!in",_jsonLogicIsExclamationOp:!0},multiselect_contains:{label:"Contains",labelForFormat:"CONTAINS",valueTypes:["multiselect"],formatOp:function(e,r,t,a,i,o,s,u){return a=="value"?"".concat(e," CONTAINS [").concat(t.join(", "),"]"):"".concat(e," CONTAINS ").concat(t)},reversedOp:"multiselect_not_contains",jsonLogic2:"some-in",jsonLogic:function(e,r,t){return{some:[e,{in:[{var:""},t]}]}},spelOp:"T(CollectionUtils).containsAny(${0}, ${1})",spelImportFuncs:[{obj:{type:"property",val:"CollectionUtils"},methodName:"containsAny",args:[{var:"0"},{var:"1"}]}],elasticSearchQueryType:"term",mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$in",function(i){return i},!1].concat(t))}},multiselect_not_contains:{isNotOp:!0,label:"Not contains",labelForFormat:"NOT CONTAINS",valueTypes:["multiselect"],formatOp:function(e,r,t,a,i,o,s,u){return a=="value"?"".concat(e," NOT CONTAINS [").concat(t.join(", "),"]"):"".concat(e," NOT CONTAINS ").concat(t)},reversedOp:"multiselect_contains",jsonLogic2:"!some-in",jsonLogic:function(e,r,t){return{"!":{some:[e,{in:[{var:""},t]}]}}},_jsonLogicIsExclamationOp:!0},multiselect_equals:{label:"Equals",labelForFormat:"==",sqlOp:"=",valueTypes:["multiselect"],formatOp:function(e,r,t,a,i,o,s,u){var l=u?"=":"==";return a=="value"?"".concat(e," ").concat(l," [").concat(t.join(", "),"]"):"".concat(e," ").concat(l," ").concat(t)},sqlFormatOp:function(e,r,t,a,i,o,s,u){var l=this;if(a=="value")return"".concat(e," = '").concat(t.map(function(c){return l.utils.SqlString.trim(c)}).join(","),"'")},spelOp:"${0}.equals(${1})",mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return i},!1].concat(t))},reversedOp:"multiselect_not_equals",jsonLogic2:"all-in",jsonLogic:function(e,r,t){return{all:[e,{in:[{var:""},t]}]}},elasticSearchQueryType:"term"},multiselect_not_equals:{isNotOp:!0,label:"Not equals",labelForFormat:"!=",sqlOp:"<>",sqlOps:["<>","!="],valueTypes:["multiselect"],formatOp:function(e,r,t,a,i,o,s,u){return a=="value"?"".concat(e," != [").concat(t.join(", "),"]"):"".concat(e," != ").concat(t)},sqlFormatOp:function(e,r,t,a,i,o,s,u){var l=this;if(a=="value")return"".concat(e," != '").concat(t.map(function(c){return l.utils.SqlString.trim(c)}).join(","),"'")},mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$ne",function(i){return i},!1].concat(t))},reversedOp:"multiselect_equals",jsonLogic2:"!all-in",jsonLogic:function(e,r,t){return{"!":{all:[e,{in:[{var:""},t]}]}}},_jsonLogicIsExclamationOp:!0},proximity:{label:"Proximity search",cardinality:2,valueLabels:[{label:"Word 1",placeholder:"Enter first word"},{label:"Word 2",placeholder:"Enter second word"}],textSeparators:[],formatOp:function(e,r,t,a,i,o,s,u){var l=t.first(),c=t.get(1),d=s?.get("proximity");return"".concat(e," ").concat(l," NEAR/").concat(d," ").concat(c)},sqlFormatOp:function(e,r,t,a,i,o,s,u){var l=t.first(),c=t.get(1),d=this.utils.SqlString.trim(l),f=this.utils.SqlString.trim(c),p=s?.get("proximity");return"CONTAINS(".concat(e,", 'NEAR((").concat(d,", ").concat(f,"), ").concat(p,")')")},sqlImport:function(e,r,t){if(e?.func==="CONTAINS"){var a,i=e.children||[],o=(0,ve.A)(i,2),s=o[0],u=o[1];if(u!=null&&(a=u.value)!==null&&a!==void 0&&a.includes("NEAR(")){var l=u.value.match(/NEAR\(\((\w+), (\w+)\), (\d+)\)/);if(l)return delete e.func,e.operator="proximity",e.children=[s,{value:l[1]},{value:l[2]}],e.operatorOptions={proximity:parseInt(l[3])},e}}},mongoFormatOp:void 0,jsonLogic:void 0,options:{optionLabel:"Near",optionTextBefore:"Near",optionPlaceholder:"Select words between",minProximity:2,maxProximity:10,defaults:{proximity:2}}},some:{label:"Some",labelForFormat:"SOME",cardinality:0,jsonLogic:"some",spelFormatOp:function(e){return"".concat(e," > 0")},mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$gt",function(i){return 0},!1].concat(t))}},all:{label:"All",labelForFormat:"ALL",cardinality:0,jsonLogic:"all",spelFormatOp:function(e,r,t){return"".concat(e," == ").concat(t)},mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return i},!1].concat(t))}},none:{label:"None",labelForFormat:"NONE",cardinality:0,jsonLogic:"none",spelFormatOp:function(e){return"".concat(e," == 0")},mongoFormatOp:function(){for(var e,r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return(e=this.utils).mongoFormatOp1.apply(e,["$eq",function(i){return 0},!1].concat(t))}}},tO={text:{type:"text",jsType:"string",valueSrc:"value",valueLabel:"String",valuePlaceholder:"Enter string",formatValue:function(e,r,t,a){return a?this.utils.stringifyForDisplay(e):JSON.stringify(e)},spelFormatValue:function(e,r,t,a,i){return this.utils.spelEscape(e)},sqlFormatValue:function(e,r,t,a,i,o,s){return i.sqlOp=="LIKE"||i.sqlOp=="NOT LIKE"?this.utils.SqlString.escapeLike(e,a!="starts_with",a!="ends_with",s):this.utils.SqlString.escape(e)},toJS:function(e,r){return e},mongoFormatValue:function(e,r,t){return e}},textarea:{type:"text",jsType:"string",valueSrc:"value",valueLabel:"Text",valuePlaceholder:"Enter text",formatValue:function(e,r,t,a){return a?this.utils.stringifyForDisplay(e):JSON.stringify(e)},sqlFormatValue:function(e,r,t,a,i,o,s){return i.sqlOp=="LIKE"||i.sqlOp=="NOT LIKE"?this.utils.SqlString.escapeLike(e,a!="starts_with",a!="ends_with",s):this.utils.SqlString.escape(e)},spelFormatValue:function(e){return this.utils.spelEscape(e)},toJS:function(e,r){return e},mongoFormatValue:function(e,r,t){return e},fullWidth:!0},number:{type:"number",jsType:"number",valueSrc:"value",valueLabel:"Number",valuePlaceholder:"Enter number",valueLabels:[{label:"Number from",placeholder:"Enter number from"},{label:"Number to",placeholder:"Enter number to"}],formatValue:function(e,r,t,a){return a?this.utils.stringifyForDisplay(e):JSON.stringify(e)},sqlFormatValue:function(e,r,t,a,i,o,s){return this.utils.SqlString.escape(e)},spelFormatValue:function(e,r,t){var a=t.step&&!Number.isInteger(t.step);return this.utils.spelEscape(e,a)},toJS:function(e,r){return e},mongoFormatValue:function(e,r,t){return e}},slider:{type:"number",jsType:"number",valueSrc:"value",valueLabel:"Number",valuePlaceholder:"Enter number or move slider",formatValue:function(e,r,t,a){return a?this.utils.stringifyForDisplay(e):JSON.stringify(e)},sqlFormatValue:function(e,r,t,a,i,o,s){return this.utils.SqlString.escape(e)},spelFormatValue:function(e){return this.utils.spelEscape(e)},toJS:function(e,r){return e},mongoFormatValue:function(e,r,t){return e}},select:{type:"select",jsType:"string",valueSrc:"value",valueLabel:"Value",valuePlaceholder:"Select value",formatValue:function(e,r,t,a){var i=this.utils.getTitleInListValues(r.fieldSettings.listValues||r.asyncListValues,e);return a?this.utils.stringifyForDisplay(i):JSON.stringify(e)},sqlFormatValue:function(e,r,t,a,i,o,s){return this.utils.SqlString.escape(e)},spelFormatValue:function(e){return this.utils.spelEscape(e)},toJS:function(e,r){return e},mongoFormatValue:function(e,r,t){return e}},multiselect:{type:"multiselect",jsType:"array",valueSrc:"value",valueLabel:"Values",valuePlaceholder:"Select values",formatValue:function(e,r,t,a){var i=this,o=e.map(function(s){return i.utils.getTitleInListValues(r.fieldSettings.listValues||r.asyncListValues,s)});return a?o.map(this.utils.stringifyForDisplay):e.map(JSON.stringify)},sqlFormatValue:function(e,r,t,a,i,o,s){var u=this;return e.map(function(l){return u.utils.SqlString.escape(l)})},spelFormatValue:function(e,r,t,a,i){var o=i&&i.spelOp&&i.spelOp.startsWith("${1}"),s=this.utils.spelEscape(e);return o&&(s=this.utils.spelFixList(s)),s},toJS:function(e,r){return e},mongoFormatValue:function(e,r,t){return e}},date:{type:"date",jsType:"string",valueSrc:"value",dateFormat:"DD.MM.YYYY",valueFormat:"YYYY-MM-DD",valueLabel:"Date",valuePlaceholder:"Enter date",valueLabels:[{label:"Date from",placeholder:"Enter date from"},{label:"Date to",placeholder:"Enter date to"}],formatValue:function(e,r,t,a){var i=this.utils.moment(e,t.valueFormat);return a?i.format(t.dateFormat):JSON.stringify(e)},sqlFormatValue:function(e,r,t,a,i,o,s){var u=this.utils.moment(e,t.valueFormat);return this.utils.SqlString.escape(u.format("YYYY-MM-DD"))},spelFormatValue:function(e,r,t,a,i){var o=this.utils.moment(e,t.valueFormat),s=o.format("YYYY-MM-DD"),u="yyyy-MM-dd";return"T(java.time.LocalDate).parse('".concat(s,"', T(java.time.format.DateTimeFormatter).ofPattern('").concat(u,"'))")},spelImportFuncs:[{obj:{cls:["java","time","LocalDate"]},methodName:"parse",args:[{var:"v"},{obj:{cls:["java","time","format","DateTimeFormatter"]},methodName:"ofPattern",args:[{var:"fmt"}]}]}],spelImportValue:function(e,r,t){var a,i,o,s;if(!r)return[void 0,"No widget def to get value format"];if(t!=null&&(a=t.fmt)!==null&&a!==void 0&&(a=a.value)!==null&&a!==void 0&&(i=a.includes)!==null&&i!==void 0&&i.call(a," ")||(o=t.fmt)!==null&&o!==void 0&&(o=o.value)!==null&&o!==void 0&&(s=o.toLowerCase)!==null&&s!==void 0&&s.call(o).includes("hh:mm"))return[void 0,"Invalid date format ".concat(JSON.stringify(t.fmt))];var u=this.utils.moment(e.value,this.utils.moment.ISO_8601);return u.isValid()?[u.format(r?.valueFormat),[]]:[void 0,"Invalid date"]},jsonLogic:function(e,r,t){return this.utils.moment(e,t.valueFormat).toDate()},toJS:function(e,r){var t=this.utils.moment(e,r.valueFormat);return t.isValid()?t.toDate():void 0},mongoFormatValue:function(e,r,t){var a=this.utils.moment(e,t.valueFormat);return a.isValid()?a.toDate():void 0}},time:{type:"time",jsType:"string",valueSrc:"value",timeFormat:"HH:mm",valueFormat:"HH:mm:ss",use12Hours:!1,valueLabel:"Time",valuePlaceholder:"Enter time",valueLabels:[{label:"Time from",placeholder:"Enter time from"},{label:"Time to",placeholder:"Enter time to"}],formatValue:function(e,r,t,a){var i=this.utils.moment(e,t.valueFormat);return a?i.format(t.timeFormat):JSON.stringify(e)},sqlFormatValue:function(e,r,t,a,i,o,s){var u=this.utils.moment(e,t.valueFormat);return this.utils.SqlString.escape(u.format("HH:mm:ss"))},spelFormatValue:function(e,r,t,a,i){var o=this.utils.moment(e,t.valueFormat),s="HH:mm:ss",u=o.format("HH:mm:ss");return"T(java.time.LocalTime).parse('".concat(u,"')")},spelImportFuncs:["T(java.time.LocalTime).parse(${v})"],spelImportValue:function(e,r,t){var a,i,o;if(!r)return[void 0,"No widget def to get value format"];if(t!=null&&t.fmt&&(!((a=t.fmt)!==null&&a!==void 0&&(a=a.value)!==null&&a!==void 0&&(i=a.toLowerCase)!==null&&i!==void 0&&i.call(a).includes("hh:mm"))||(o=t.fmt)!==null&&o!==void 0&&(o=o.value)!==null&&o!==void 0&&o.includes(" ")))return[void 0,"Invalid time format ".concat(JSON.stringify(t.fmt))];var s=this.utils.moment(e.value,"HH:mm:ss");return s.isValid()?[s.format(r?.valueFormat),[]]:[void 0,"Invalid date"]},jsonLogic:function(e,r,t){var a=this.utils.moment(e,t.valueFormat);return a.get("hour")*60*60+a.get("minute")*60+a.get("second")},toJS:function(e,r){var t=this.utils.moment(e,r.valueFormat);return t.isValid()?t.get("hour")*60*60+t.get("minute")*60+t.get("second"):void 0},mongoFormatValue:function(e,r,t){var a=this.utils.moment(e,t.valueFormat);return a.get("hour")*60*60+a.get("minute")*60+a.get("second")},elasticSearchFormatValue:function(e,r,t,a){return{script:{script:{source:"doc[".concat(a,"][0].getHour() >== params.min && doc[").concat(a,"][0].getHour() <== params.max"),params:{min:r[0],max:r[1]}}}}}},datetime:{type:"datetime",jsType:"string",valueSrc:"value",timeFormat:"HH:mm",dateFormat:"DD.MM.YYYY",valueFormat:"YYYY-MM-DD HH:mm:ss",use12Hours:!1,valueLabel:"Datetime",valuePlaceholder:"Enter datetime",valueLabels:[{label:"Datetime from",placeholder:"Enter datetime from"},{label:"Datetime to",placeholder:"Enter datetime to"}],formatValue:function(e,r,t,a){var i=this.utils.moment(e,t.valueFormat);return a?i.format(t.dateFormat+" "+t.timeFormat):JSON.stringify(e)},sqlFormatValue:function(e,r,t,a,i,o,s){var u=this.utils.moment(e,t.valueFormat);return this.utils.SqlString.escape(u.toDate())},spelFormatValue:function(e,r,t,a,i){var o=this.utils.moment(e,t.valueFormat),s=o.format("YYYY-MM-DD HH:mm:ss"),u="yyyy-MM-dd HH:mm:ss";return"T(java.time.LocalDateTime).parse('".concat(s,"', T(java.time.format.DateTimeFormatter).ofPattern('").concat(u,"'))")},spelImportFuncs:[{obj:{cls:["java","time","LocalDateTime"]},methodName:"parse",args:[{var:"v"},{obj:{cls:["java","time","format","DateTimeFormatter"]},methodName:"ofPattern",args:[{var:"fmt"}]}]}],spelImportValue:function(e,r,t){var a,i;if(!r)return[void 0,"No widget def to get value format"];if(!(t!=null&&(a=t.fmt)!==null&&a!==void 0&&(a=a.value)!==null&&a!==void 0&&(i=a.includes)!==null&&i!==void 0&&i.call(a," ")))return[void 0,"Invalid datetime format ".concat(JSON.stringify(t.fmt))];var o=this.utils.moment(e.value,this.utils.moment.ISO_8601);return o.isValid()?[o.format(r?.valueFormat),[]]:[void 0,"Invalid date"]},jsonLogic:function(e,r,t){return this.utils.moment(e,t.valueFormat).toDate()},toJS:function(e,r){var t=this.utils.moment(e,r.valueFormat);return t.isValid()?t.toDate():void 0},mongoFormatValue:function(e,r,t){var a=this.utils.moment(e,t.valueFormat);return a.isValid()?a.toDate():void 0}},boolean:{type:"boolean",jsType:"boolean",valueSrc:"value",labelYes:"Yes",labelNo:"No",formatValue:function(e,r,t,a){return a?e?"Yes":"No":JSON.stringify(!!e)},sqlFormatValue:function(e,r,t,a,i,o,s){return this.utils.SqlString.escape(e)},spelFormatValue:function(e,r,t,a,i){return this.utils.spelEscape(e)},defaultValue:!1,toJS:function(e,r){return e},mongoFormatValue:function(e,r,t){return e}},field:{valueSrc:"field",formatValue:function(e,r,t,a,i,o,s){return a&&s.label||e},sqlFormatValue:function(e,r,t,a,i,o,s){return e},spelFormatValue:function(e,r,t,a,i){return e},valueLabel:"Field to compare",valuePlaceholder:"Select field to compare"},func:{valueSrc:"func",valueLabel:"Function",valuePlaceholder:"Select function"},case_value:{valueSrc:"value",type:"case_value",spelFormatValue:function(e){return this.utils.spelEscape(e===""?null:e)},spelImportValue:function(e){return[e.value,[]]},jsonLogic:function(e){return e===""?null:e}}},rO={text:{defaultOperator:"equal",mainWidget:"text",widgets:{text:{operators:["equal","not_equal","like","not_like","starts_with","ends_with","proximity","is_empty","is_not_empty","is_null","is_not_null"],widgetProps:{},opProps:{}},textarea:{operators:["equal","not_equal","like","not_like","starts_with","ends_with","is_empty","is_not_empty","is_null","is_not_null"],widgetProps:{},opProps:{}},field:{operators:["equal","not_equal","proximity"]}}},number:{defaultOperator:"equal",mainWidget:"number",widgets:{number:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"]},slider:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","is_null","is_not_null"]}}},date:{defaultOperator:"equal",widgets:{date:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"]}}},time:{defaultOperator:"equal",widgets:{time:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"]}}},datetime:{defaultOperator:"equal",widgets:{datetime:{operators:["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"]}}},select:{mainWidget:"select",defaultOperator:"select_equals",widgets:{select:{operators:["select_equals","select_not_equals","is_null","is_not_null"]},multiselect:{operators:["select_any_in","select_not_any_in","is_null","is_not_null"]}}},multiselect:{defaultOperator:"multiselect_equals",widgets:{multiselect:{operators:["multiselect_contains","multiselect_not_contains","multiselect_equals","multiselect_not_equals","is_null","is_not_null"]}}},boolean:{defaultOperator:"equal",widgets:{boolean:{operators:["equal","not_equal","is_null","is_not_null"],widgetProps:{}},field:{operators:["equal","not_equal"]}}},"!group":{defaultOperator:"some",mainWidget:"number",widgets:{number:{widgetProps:{min:0},operators:["some","all","none","equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between"],opProps:{equal:{label:"Count =="},not_equal:{label:"Count !="},less:{label:"Count <"},less_or_equal:{label:"Count <="},greater:{label:"Count >"},greater_or_equal:{label:"Count >="},between:{label:"Count between"},not_between:{label:"Count not between"}}}}},case_value:{mainWidget:"case_value",widgets:{case_value:{widgetProps:{}}}}},nO=lt(lt({},xd),{},{convertableWidgets:{number:["slider","rangeslider"],slider:["number","rangeslider"],rangeslider:["number","slider"],text:["textarea"],textarea:["text"]},formatSpelField:function(e,r,t,a,i,o){var s=this,u=a.map(function(l,c){var d=l.key,f=l.parent,p=l.fieldSeparator;return c==0?f=="[map]"?"#this[".concat(s.utils.spelEscape(d),"]"):(f=="[class]",d):f=="map"||f=="[map]"?"[".concat(s.utils.spelEscape(d),"]"):(f=="class"||f=="[class]","".concat(p).concat(d))}).join("");return i.fieldName&&(u=e),i.isSpelVariable&&(u="#"+u),u},sqlFormatReverse:function(e){if(e!=null)return"NOT"+this.utils.wrapWithBrackets(e)},spelFormatReverse:function(e){if(e!=null)return"!"+this.utils.wrapWithBrackets(e)},formatReverse:function(e,r,t,a,i,o){if(e!=null)return o?"NOT "+this.utils.wrapWithBrackets(e):"!"+this.utils.wrapWithBrackets(e)},formatAggr:function(e,r,t,a,i,o,s,u,l,c){var d=s.labelForFormat,f=s.cardinality;if(f==0){var p=e?" HAVE ".concat(e):"";return"".concat(d," OF ").concat(r).concat(p)}else if(f==null||f==1){var g=e?" WHERE ".concat(e):"";return"COUNT OF ".concat(r).concat(g," ").concat(d," ").concat(a)}else if(f==2){var h=e?" WHERE ".concat(e):"",m=a.first(),y=a.get(1);return"COUNT OF ".concat(r).concat(h," ").concat(d," ").concat(m," AND ").concat(y)}},jsonLogic:{groupVarKey:"var",altVarKey:"var",lockedOp:"locked"},canCompareFieldWithField:function(e,r,t,a){return!0},valueSourcesInfo:{value:{label:"Value"},field:{label:"Field",widget:"field"},func:{label:"Function",widget:"func"}}}),tg=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a={rangeslider:oO,treeselect:sO,treemultiselect:uO,rangeable__date:iO("date","date")},i=KS(r),o;try{for(i.s();!(o=i.n()).done;){var s=o.value,u=a[s];if(u)e=u(e,t);else throw new Error("Can't ".concat(t?"add":"remove"," mixin ").concat(s))}}catch(l){i.e(l)}finally{i.f()}return e},rg=function(e,r){return tg(e,r,!0)},aO=function(e,r){return tg(e,r,!1)},iO=function(e,r){return function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=t.types;return i=lt(lt({},i),{},(0,X.A)({},e,lt(lt({},i[e]),{},{widgets:lt({},i[e].widgets)}))),a?i[e].widgets[r]=lt({opProps:{between:{isSpecialRange:!0,textSeparators:[null,null]},not_between:{isSpecialRange:!0,textSeparators:[null,null]}}},i[e].widgets[r]):delete i[e].widgets[r],lt(lt({},t),{},{types:i})}},oO=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=e.widgets,a=e.types;return t=lt({},t),r?t.rangeslider=lt({type:"number",jsType:"number",valueSrc:"value",valueLabel:"Range",valuePlaceholder:"Select range",valueLabels:[{label:"Number from",placeholder:"Enter number from"},{label:"Number to",placeholder:"Enter number to"}],formatValue:function(o,s,u,l){return l?this.utils.stringifyForDisplay(o):JSON.stringify(o)},sqlFormatValue:function(o,s,u,l,c,d,f){return this.utils.SqlString.escape(o)},spelFormatValue:function(o){return this.utils.spelEscape(o)},singleWidget:"slider",toJS:function(o,s){return o}},t.rangeslider):delete t.rangeslider,a=lt(lt({},a),{},{number:lt(lt({},a.number),{},{widgets:lt({},a.number.widgets)})}),r?a.number.widgets.rangeslider=lt({opProps:{between:{isSpecialRange:!0},not_between:{isSpecialRange:!0}},operators:["between","not_between","is_null","is_not_null"]},a.number.widgets.rangeslider):delete a.number.widgets.rangeslider,lt(lt({},e),{},{widgets:t,types:a})},sO=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=e.widgets,a=e.types;return t=lt({},t),r?t.treeselect=lt({type:"treeselect",jsType:"string",valueSrc:"value",valueLabel:"Value",valuePlaceholder:"Select value",formatValue:function(o,s,u,l){var c=s.fieldSettings.treeValues||s.fieldSettings.listValues||s.asyncListValues,d=this.utils.getTitleInListValues(c,o);return l?this.utils.stringifyForDisplay(d):JSON.stringify(o)},sqlFormatValue:function(o,s,u,l,c,d,f){return this.utils.SqlString.escape(o)},spelFormatValue:function(o){return this.utils.spelEscape(o)},toJS:function(o,s){return o}},t.treeselect):delete t.treeselect,a=lt({},a),r?a.treeselect=lt({mainWidget:"treeselect",defaultOperator:"select_equals",widgets:{treeselect:{operators:["select_equals","select_not_equals"]},treemultiselect:{operators:["select_any_in","select_not_any_in"]}}},a.treeselect):delete a.treeselect,lt(lt({},e),{},{widgets:t,types:a})},uO=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=e.widgets,a=e.types;return t=lt({},t),r?t.treemultiselect=lt({type:"treemultiselect",jsType:"array",valueSrc:"value",valueLabel:"Values",valuePlaceholder:"Select values",formatValue:function(o,s,u,l){var c=this,d=s.fieldSettings.treeValues||s.fieldSettings.listValues||s.asyncListValues,f=o.map(function(p){return c.utils.getTitleInListValues(d,p)});return l?f.map(this.utils.stringifyForDisplay):o.map(JSON.stringify)},sqlFormatValue:function(o,s,u,l,c,d,f){var p=this;return o.map(function(g){return p.utils.SqlString.escape(g)})},spelFormatValue:function(o){return this.utils.spelEscape(o)},toJS:function(o,s){return o}},t.treemultiselect):delete t.treemultiselect,a=lt({},a),r?a.treemultiselect=lt({defaultOperator:"multiselect_equals",widgets:{treemultiselect:{operators:["multiselect_equals","multiselect_not_equals"]}}},a.treemultiselect):delete a.treemultiselect,lt(lt({},e),{},{widgets:t,types:a})},lO={addMixins:rg,removeMixins:aO},bc={conjunctions:ZS,operators:eO,widgets:tO,types:rO,settings:nO,ctx:YS};bc=rg(bc,["rangeslider","treeselect","treemultiselect"]);const Vt=bc;var ng="ADD_GROUP",Sc="ADD_CASE_GROUP",ag="REMOVE_GROUP",ig="SET_CONJUNCTION",og="SET_NOT",sg="ADD_RULE",ug="REMOVE_RULE",lg="SET_FIELD",cg="SET_FIELD_SRC",dg="SET_OPERATOR",fg="SET_VALUE",pg="SET_VALUE_SRC",vg="SET_FUNC_VALUE",gg="SET_OPERATOR_OPTION",hg="SET_LOCK",Oc="SET_TREE",mg="MOVE_ITEM",yg="after",bg="before",Fc="append",Cc="prepend",Sg="SET_DRAG_PROGRESS",Og="SET_DRAG_START",Fg="SET_DRAG_END",cO=$(73916),Lu=$.n(cO);function Cg(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function xn(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Cg(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Cg(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function Ec(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=dO(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function dO(n,e){if(n){if(typeof n=="string")return Eg(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Eg(n,e)}}function Eg(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}var wg=function(e,r,t,a,i,o){var s,u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null,l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:{},c=e.getIn(fe(r));if(!c)return e;var d=(i==null||(s=i.get)===null||s===void 0?void 0:s.call(i,"id"))||a,f=o.settings.shouldCreateEmptyGroup,p=r.push(d),g=!f,h=!!(l!=null&&l.isDefaultCase),m=e;return e=Ja(e,r,t,d,pa(o).merge(la(i)||{}),o,u),e!==m&&(!u&&!h&&(e=e.setIn(fe(p,"children1"),new Ne.OrderedMap),g&&(e=Ja(e,p,"rule",Tt(),jn(o,l?.parentRuleGroupField),o))),e=gn(e)),e},fO=function(e,r,t){var a=e.getIn(fe(r));if(!a)return e;e=wc(e,r);var i=t.settings.canLeaveEmptyGroup,o=r.slice(0,-1),s=!jl(e,o);if(s&&!i&&(e=iu(e),Rl(e)&&!i)){var u=!1,l=!1;e=Ja(e,new Ne.List,"rule",Tt(),jn(t,void 0,void 0,u,l),t)}return e=gn(e),e},pO=function(e,r,t){var a=e.getIn(fe(r));if(!a)return e;e=wc(e,r);var i=t.settings.canLeaveEmptyGroup,o=r.pop(),s=e.getIn(fe(o)),u=s.getIn(["properties","field"]),l=s.getIn(["properties","operator"]),c=u?_e(t,u):null,d=l?st(t,l,u):null,f=u&&l&&d.cardinality!=0,p=s.get("type")=="rule_group",g=!jl(e,o),h=p?f&&c.initialEmptyWhere:i;if(g&&!h&&(p&&(e=e.deleteIn(fe(o))),e=iu(e),Rl(e)&&!i)){var m=!1,y=!1;e=Ja(e,new Ne.List,"rule",Tt(),jn(t,void 0,void 0,m,y),t)}return e=gn(e),e},vO=function(e,r,t){var a=e.getIn(fe(r));return a&&(e=e.setIn(fe(r,"properties","not"),t)),e},gO=function(e,r,t){var a=e.getIn(fe(r));return a&&(e=Sd(e.setIn(fe(r,"properties","isLocked"),t))),e},hO=function(e,r,t){var a=e.getIn(fe(r));return a&&(e=e.setIn(fe(r,"properties","conjunction"),t)),e},Ja=function(e,r,t,a,i,o){var s,u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:null;if(t==="switch_group")throw new Error("Can't add switch_group programmatically");var l=e.getIn(fe(r));if(!l)return e;var c=(i==null||(s=i.get)===null||s===void 0?void 0:s.call(i,"id"))||a,d=o.settings,f=d.maxNumberOfCases,p=d.maxNumberOfRules,g=d.maxNesting,h=e.get("type"),m=h==="switch_group",y=m?e.getIn(fe(r.take(2))):null,S=fe(r,"children1"),C=e.getIn(S),F=!!C&&C.size,T=F?C.size:null,w,_;if(t==="case_group")w=T,_=f;else if(t==="group"){var M=_l(e,r);if(M.length){var D=M[0],j=D.path,P=D.field,V=_e(o,P);w=r.size-j.length,_=V?.maxNesting}else w=r.size,_=g}else{var L=_l(e,r);if(L.length){var U=L[0],B=U.path,G=U.field,W=_e(o,G),z=ca(e,B);_=W?.maxNumberOfRules,w=ou(z)}else w=ou(m?y:e),_=p}var H=_&&w?w<_:!0,q={type:t,id:c,properties:i};EO(o,q,u);var J=t==="case_group"&&F&&C.last().get("children1")==null;if(H){var Y=new Ne.OrderedMap((0,X.A)({},c,new Ne.Map(q)));if(!F)e=e.setIn(S,Y);else if(J){var Z=C.last(),se=new Ne.OrderedMap((0,X.A)((0,X.A)({},c,new Ne.Map(q)),Z.get("id"),Z));e=e.deleteIn(fe(S,"children1",Z.get("id"))),e=e.mergeIn(S,se)}else e=e.mergeIn(S,Y);e=gn(e)}return e},wc=function(e,r){return e=e.deleteIn(fe(r)),e=gn(e),e},mO=function(e,r,t,a,i){var o=ca(e,r),s=r.pop(),u=r.size>1?ca(e,s):null,l=u?u.get("children1"):null,c=ca(e,t),d=a==Fc||a==Cc?t:t.pop(),f=a==Fc||a==Cc?c:t.size>1?ca(e,d):null,p=f?f.get("children1"):null;if(!u||!f||!o)return e;var g=u.get("id")==f.get("id"),h=d.size<s.size&&Ys(d.toArray(),s.toArray().slice(0,d.size)),m=d.size>s.size&&Ys(s.toArray(),d.toArray().slice(0,s.size)),y=null,S=null;h?y=Ne.List(s.toArray().slice(d.size)):m&&(S=Ne.List(d.toArray().slice(s.size)));var C=p,F=l;return m||(F=F.delete(o.get("id"))),g?C=F:h&&(C=C.updateIn(Tl(y,"children1"),function(T){return F})),a==bg||a==yg?C=Ne.OrderedMap().withMutations(function(T){var w=Ec(C.entries()),_;try{for(w.s();!(_=w.n()).done;){var M=(0,ve.A)(_.value,2),D=M[0],j=M[1];D==c?.get("id")&&a==bg&&T.set(o.get("id"),o),T.set(D,j),D==c?.get("id")&&a==yg&&T.set(o.get("id"),o)}}catch(P){w.e(P)}finally{w.f()}}):a==Fc?C=C.merge(Ne.OrderedMap((0,X.A)({},o.get("id"),o))):a==Cc&&(C=Ne.OrderedMap((0,X.A)({},o.get("id"),o)).merge(C)),m&&(F=F.updateIn(Tl(S,"children1"),function(T){return C}),F=F.delete(o.get("id"))),!g&&!h&&(e=e.updateIn(fe(s,"children1"),function(T){return F})),m||(e=e.updateIn(fe(d,"children1"),function(T){return C})),e=gn(e),e},yO=function(e,r,t,a){var i=e.getIn(fe(r));if(!i)return e;var o=a.settings.keepInputOnChangeFieldSrc,s=i.get("properties"),u=s?.get("field"),l=s?.get("fieldType"),c=_e(a,u),d=c?.type||l;(!d||d==="!group"||d==="!struct")&&(d=null);var f=!Xs.includes(d),p=o&&!Pl(i,a)&&f;return p?(e=e.setIn(fe(r,"properties","field"),null),e=e.deleteIn(fe(r,"properties","fieldError")),e=e.setIn(fe(r,"properties","fieldType"),d)):e=e.setIn(fe(r,"properties"),jn(a,null,null,!1)),e=e.setIn(fe(r,"properties","fieldSrc"),t),e},bO=function(e,r,t,a,i,o,s,u,l){var c=arguments.length>9&&arguments[9]!==void 0?arguments[9]:{},d=r.getIn(fe(t));if(!d)return r;var f=a===-1,p=d.get("properties"),g=p.get("field"),h=p.get("value"),m=f?g:h.getIn([a]),y=[],S=m,C=Ec(i||[]),F;try{for(C.s();!(F=C.n()).done;){var T=(0,ve.A)(F.value,2),w=T[0],_=T[1];if(y.push([w,_,S]),w!==S.get("func")){var M=y.map(function(se){var re=(0,ve.A)(se,2),ee=re[0],Fe=re[1];return"".concat(ee,"(").concat(Fe,")")}).join("/")||"root";throw new Error("In ".concat(f?"LHS":"RHS"," for path ").concat(M," expected func key ").concat(w," but got ").concat(S.get("func")))}S=S.getIn(["args",_,"value"])}}catch(se){C.e(se)}finally{C.f()}if(o){var P=S.get("func"),V=nr(e,P),L=V.args,U=L[o];u==="!valueSrc"?S=yv(S,o,s,U,e):(S=cu(S,o,s,U,e),l&&(S=bv(S,o,l,U,e)))}else{var D=s,j=!0;S=mv(S,D,e,j),c.canDropArgs=!0}for(var B=S;y.length;){var G=y.pop(),W=(0,ve.A)(G,3),z=W[0],H=W[1],q=W[2],J=nr(e,z),Y=J.args,Z=Y[H];B=cu(q,H,B,Z,e)}return f?Ag(r,t,B,e,void 0,c):Tg(r,t,a,B,void 0,e,void 0,c)},Ag=function(e,r,t,a,i){var o,s,u,l,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},d=e.getIn(fe(r));if(!d)return{state:e};var f=c.isEndValue,p=c.canDropArgs;if(!t)return e=wc(e,r),{state:e};var g=a.settings,h=g.fieldSeparator,m=g.setOpOnChangeField,y=g.showErrorMessage;Array.isArray(t)&&(t=t.join(h));var S=d.get("type"),C=d.get("properties"),F=S=="rule_group",T=C?.get("fieldSrc"),w=_e(a,t);if(!w)return console.warn("No config for LHS ".concat(t)),{state:e};var _=w.type;(_==="!group"||_==="!struct")&&(_=null);var M=C?.get("operator"),D=C?.get("operatorOptions"),j=C?.get("field"),P=w.type=="!group",V=P&&w.mode=="array",L=F!=P,U=w&&((o=w.operators)===null||o===void 0?void 0:o.indexOf(M))!==-1?M:null,B=T==="func"&&(j==null||(s=j.get)===null||s===void 0?void 0:s.call(j,"func"))===((u=t)===null||u===void 0||(l=u.get)===null||l===void 0?void 0:l.call(u,"func")),G=B&&!!U,W=null,z=T==="func"?yd(a,_):au(a,t);if(z&&z.length==1)W=z[0];else if(G)W=U;else if(z&&z.length>1){var H=Ec(m),q;try{for(H.s();!(q=H.n()).done;){var J=q.value;if(J=="keep"&&!L?W=U:J=="default"?W=Dl(a,t,!1):J=="first"&&(W=Al(a,t)),W)break}}catch(Se){H.e(Se)}finally{H.f()}}if(!P&&!w.operators)return console.warn("Type ".concat(w.type," is not supported")),{state:e};F&&!P&&(e=e.setIn(fe(r,"type"),"rule"),e=e.deleteIn(fe(r,"children1")),e=e.setIn(fe(r,"properties"),new Ne.OrderedMap)),C||(e=e.setIn(fe(r,"properties"),new Ne.OrderedMap));var Y=!y;if(P){e=e.setIn(fe(r,"type"),"rule_group");var Z=Pi({validateValue:Rn,validateRange:ga},a,a,C,t,W,"field",Y,f,p),se=Z.canReuseValue,re=Z.newValue,ee=Z.newValueSrc,Fe=Z.newValueType,pe=Z.operatorCardinality,oe=pa(a,w,t).merge({field:t,fieldSrc:"field",mode:w.mode});V&&(oe=oe.merge({operator:W,value:re,valueSrc:ee,valueType:Fe})),e=e.setIn(fe(r,"children1"),new Ne.OrderedMap),e=e.setIn(fe(r,"properties"),oe),w.initialEmptyWhere&&pe==1||(e=Ja(e,r,"rule",Tt(),jn(a,t),a)),e=gn(e)}else e=e.updateIn(fe(r,"properties"),function(Se){return Se.withMutations(function(he){var be=Pi({validateValue:Rn,validateRange:ga},a,a,he,t,W,"field",Y,f,p),Le=be.canReuseValue,Ae=be.newValue,ke=be.newValueSrc,Ve=be.newValueType,Re=be.newValueError,Ce=be.newFieldError,jt=be.fixedField,ot=t,mt=jt!==t;mt&&(ot=jt),y&&(he=he.set("fieldError",Ce),he=he.set("valueError",Re));var Ue=Le?D:xo(a,W,ot);return he=he.set("field",ot).delete("fieldType").set("fieldSrc",T).set("operator",W).set("operatorOptions",Ue).set("value",Ae).set("valueSrc",ke).set("valueType",Ve),Le||(he=he.delete("asyncListValues")),he})});return{state:e}},SO=function(e,r,t,a){var i=e.getIn(fe(r));if(!i)return e;var o=a.settings.showErrorMessage,s=i.get("properties"),u=i.get("children1"),l=s.get("field"),c=s.get("fieldSrc"),d=_e(a,l),f=d?.type=="!group",p=st(a,t,l),g=p?Jt(p):null,h=!0;return e=e.updateIn(fe(r,"properties"),function(m){return m.withMutations(function(y){var S=y.get("field"),C=y.get("operatorOptions"),F=y.get("value",new Ne.List),T=y.get("valueSrc",new Ne.List),w=y.get("operator"),_=Pi({validateValue:Rn,validateRange:ga},a,a,y,S,t,"operator",h),M=_.canReuseValue,D=_.newValue,j=_.newValueSrc,P=_.newValueType,V=_.newValueError;o&&(y=y.set("valueError",V));var L=M?C:xo(a,t,S);return M||(y=y.delete("asyncListValues")),y.set("operator",t).set("operatorOptions",L).set("value",D).set("valueSrc",j).set("valueType",P)})}),f&&g==0&&u.size==0&&(e=Ja(e,r,"rule",Tt(),jn(a,l),a)),e},Tg=function(e,r,t,a,i,o,s){var u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:{},l=e.getIn(fe(r));if(!l)return{state:e};var c=u.canDropArgs,d=u.isEndValue,f=o.settings,p=f.fieldSeparator,g=f.showErrorMessage,h=e.getIn(fe(r,"properties","valueSrc",t+""))||null;h==="field"&&Array.isArray(a)&&(a=a.join(p));var m=e.getIn(fe(r,"properties","field"))||null,y=e.getIn(fe(r,"properties","operator"))||null,S=st(o,y,m),C=y?Jt(S):null,F=i||Ad(a,h,o),T=!g,w=Rn(o,m,m,y,a,F,h,s,T,d,c),_=(0,ve.A)(w,2),M=_[0],D=_[1],j=D?.find(function(q){return!q.fixed&&!q.ignore}),P=j?hn(j):null,V=M!==a;V&&(a=M),e=_g(e,r,o,C);var L=Array.from({length:C},function(q,J){return J==t?a:e.getIn(fe(r,"properties","value",J+""))||null}),U=Array.from({length:C},function(q,J){return e.getIn(fe(r,"properties","valueSrc",J+""))||null}),B=ga(o,m,y,L,U),G=B?hn(B):null,W=!P&&!G,z=g?!0:W||V;if(z&&(e=e.deleteIn(fe(r,"properties","asyncListValues")),typeof a>"u"?(e=e.setIn(fe(r,"properties","value",t),void 0),e=e.setIn(fe(r,"properties","valueType",t),null)):(s&&(e=e.setIn(fe(r,"properties","asyncListValues"),s)),e=e.setIn(fe(r,"properties","value",t),a),e=e.setIn(fe(r,"properties","valueType",t),F))),g){var H=e.getIn(fe(r,"properties","valueError"));H||(e=e.setIn(fe(r,"properties","valueError"),new Ne.List(new Array(C)))),e=e.setIn(fe(r,"properties","valueError",t),P),C>=2&&(e=e.setIn(fe(r,"properties","valueError",C),G))}return{state:e}},OO=function(e,r,t,a,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},s=e.getIn(fe(r));if(!s)return e;var u=i.settings.showErrorMessage,l=e.getIn(fe(r,"properties","field"))||null,c=e.getIn(fe(r,"properties","operator"))||null,d=st(i,c,l),f=c?Jt(d):null;if(e=_g(e,r,i,f),e=e.setIn(fe(r,"properties","value",t+""),void 0),e=e.setIn(fe(r,"properties","valueType",t+""),null),e=e.deleteIn(fe(r,"properties","asyncListValues")),u&&(e=e.setIn(fe(r,"properties","valueError",t),null),d.validateValues&&(e=e.setIn(fe(r,"properties","valueError",f),null))),typeof a>"u"?e=e.setIn(fe(r,"properties","valueSrc",t+""),null):e=e.setIn(fe(r,"properties","valueSrc",t+""),a),a){var p=e.getIn(fe(r,"properties")),g=!0,h=Pi({validateValue:Rn,validateRange:ga},i,i,p,l,c,"valueSrc",g),m=h.canReuseValue,y=h.newValue,S=h.newValueSrc,C=h.newValueType,F=h.newValueError;!m&&S.get(t)==a&&(e=e.setIn(fe(r,"properties","value",t+""),y.get(t)),e=e.setIn(fe(r,"properties","valueType",t+""),C.get(t)))}return e},FO=function(e,r,t,a){var i=e.getIn(fe(r));return i?e.setIn(fe(r,"properties","operatorOptions",t),a):e},CO=function(e,r){var t=r.settings.canLeaveEmptyGroup;return t||(e=iu(e)),e},_g=function(e,r,t,a){if(!a){var i=e.getIn(fe(r,"properties","field"))||null,o=e.getIn(fe(r,"properties","operator"))||null,s=st(t,o,i);a=o?Jt(s):null}for(var u=0,l=["value","valueType","valueError","valueSrc"];u<l.length;u++){var c=l[u];e.getIn(fe(r,"properties",c))||(e=e.setIn(fe(r,"properties",c),new Ne.List(a?Array.from({length:a}):[])))}return e},EO=function n(e,r,t){t&&Array.isArray(t)&&(r.children1=new Ne.OrderedMap(t.reduce(function(a,i){var o,s=(o=i.id)!==null&&o!==void 0?o:Tt(),u=xn(xn({},i),{},{properties:Fv(e,i).merge(la(i.properties)||{}),id:s});return n(e,u,u.children1),xn(xn({},a),{},(0,X.A)({},s,new Ne.Map(u)))},{})))},wO=function(e,r){var t=e.getIn(fe(r,"properties","field"))||null;return t},Lg={dragging:{id:null,x:null,y:null,w:null,h:null},mousePos:{},dragStart:{id:null}},AO=function(e,r){if(!e||!e.type)return null;var t=["config","asyncListValues"],a=[Oc,Og,Sg,Fg],i=Lu()(vu()(e,t),Ol),o=e.path&&wO(r.tree,e.path)||e.field;if(o){var s;(s=o)!==null&&s!==void 0&&s.toJS&&(o=o.toJS()),i.affectedField=o}return(a.includes(e.type)||e.type.indexOf("@@redux")==0)&&(i=null),i};const TO=function(n,e,r,t,a){var i=e,o=xn({tree:i},Lg);return function(){var s,u,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:o,c=arguments.length>1?arguments[1]:void 0,d=(s=(u=a?.())!==null&&u!==void 0?u:c?.config)!==null&&s!==void 0?s:n,f={__lastAction:void 0},p={},g=AO(c,l);switch(c?.type){case Oc:{var h=r(d,c.tree);p.tree=h;break}case Sc:{p.tree=wg(l.tree,c.path,"case_group",c.id,c.properties,d,c.children,c.meta);break}case ng:{p.tree=wg(l.tree,c.path,"group",c.id,c.properties,d,c.children,c.meta);break}case ag:{p.tree=fO(l.tree,c.path,d);break}case sg:{p.tree=Ja(l.tree,c.path,c.ruleType,c.id,c.properties,d,c.children);break}case ug:{p.tree=pO(l.tree,c.path,d);break}case ig:{p.tree=hO(l.tree,c.path,c.conjunction);break}case og:{p.tree=vO(l.tree,c.path,c.not);break}case lg:{var m=Ag(l.tree,c.path,c.field,d,c.asyncListValues,c._meta),y=m.state;p.tree=y;break}case cg:{p.tree=yO(l.tree,c.path,c.srcKey,d);break}case hg:{p.tree=gO(l.tree,c.path,c.lock);break}case dg:{p.tree=SO(l.tree,c.path,c.operator,d);break}case fg:{var S=Tg(l.tree,c.path,c.delta,c.value,c.valueType,d,c.asyncListValues,c._meta),C=S.state;p.tree=C;break}case vg:{var F=bO(d,l.tree,c.path,c.delta,c.parentFuncs,c.argKey,c.value,c.valueType,c.asyncListValues,c._meta),T=F.state;p.tree=T;break}case pg:{p.tree=OO(l.tree,c.path,c.delta,c.srcKey,d,c._meta);break}case gg:{p.tree=FO(l.tree,c.path,c.name,c.value);break}case mg:{p.tree=mO(l.tree,c.fromPath,c.toPath,c.placement,d);break}case Og:{p.dragStart=c.dragStart,p.dragging=c.dragging,p.mousePos=c.mousePos;break}case Sg:{p.mousePos=c.mousePos,p.dragging=c.dragging;break}case Fg:{p.tree=CO(l.tree,d),p=xn(xn({},p),Lg);break}default:break}return g&&(p.__lastAction=g),t&&p.tree&&l.tree&&t(l.tree),xn(xn(xn({},l),f),p)}};var _O=function(e,r){return{type:Oc,tree:r,config:e}},LO=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rule",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null;return{type:sg,ruleType:a,children:i,path:Yt(r),id:Tt(),properties:jn(e,o).merge(la(t)||{}),config:e,meta:{parentRuleGroupField:o}}},RO=function(e,r){return{type:ug,path:Yt(r),config:e}},jO=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return{type:Sc,path:Yt(r),children:a,id:Tt(),properties:pa(e).merge(la(t)||{}),config:e,meta:{isDefaultCase:!0}}},xO=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return{type:Sc,path:Yt(r),children:a,id:Tt(),properties:pa(e).merge(la(t)||{}),config:e}},IO=function(e,r,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;return{type:ng,path:Yt(r),children:a,id:Tt(),properties:pa(e,i).merge(la(t)||{}),config:e,meta:{parentRuleGroupField:i}}},DO=function(e,r){return{type:ag,path:Yt(r),config:e}},PO=function(e,r,t,a){return{type:mg,fromPath:Yt(r),toPath:Yt(t),placement:a,config:e}},NO=function(e,r,t){return{type:ig,path:Yt(r),conjunction:t}},VO=function(e,r,t){return{type:og,path:Yt(r),not:t}},MO=function(e,r,t){return{type:hg,path:Yt(r),lock:t}},kO=function(e,r,t,a,i){return{type:lg,path:Yt(r),field:t,config:e,asyncListValues:a,_meta:i}},GO=function(e,r,t){return{type:cg,path:Yt(r),srcKey:t,config:e}},$O=function(e,r,t){return{type:dg,path:Yt(r),operator:t,config:e}},UO=function(e,r,t,a,i,o,s){return{type:fg,path:Yt(r),delta:t,value:a,valueType:i,asyncListValues:o,config:e,_meta:s}},BO=function(e,r,t,a,i){return{type:pg,path:Yt(r),delta:t,srcKey:a,config:e,_meta:i}},WO=function(e,r,t,a,i,o,s,u,l){return{type:vg,path:Yt(r),delta:t,parentFuncs:a,argKey:i,value:o,valueType:s,asyncListValues:u,config:e,_meta:l}},zO=function(e,r,t,a){return{type:gg,path:Yt(r),name:t,value:a,config:e}};function Rg(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Ac(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Rg(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Rg(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var Be=Ac(Ac(Ac({},ye),{},{Export:te,Import:wt,ConfigMixins:lO},te),wt),qO=$(83175),R=$.n(qO);const HO=TO,qo=I.createContext();var QO=$(14644),JO=$(19888),YO=$(46861),KO=$(40961);function XO(n){n()}let jg=XO;const ZO=n=>jg=n,eF=()=>jg,xg=Symbol.for("react-redux-context"),Ig=typeof globalThis<"u"?globalThis:{};function tF(){var n;if(!I.createContext)return{};const e=(n=Ig[xg])!=null?n:Ig[xg]=new Map;let r=e.get(I.createContext);return r||(r=I.createContext(null),e.set(I.createContext,r)),r}const Dg=tF(),Yw=null;function Kw(n=ReactReduxContext){return function(){return useContext(n)}}const Xw=null;let Pg=null;const rF=n=>{Pg=n},nF=(n,e)=>n===e;function Zw(n=ReactReduxContext){const e=n===ReactReduxContext?useDefaultReduxContext:createReduxContextHook(n);return function(t,a={}){const{equalityFn:i=nF,stabilityCheck:o=void 0,noopCheck:s=void 0}=typeof a=="function"?{equalityFn:a}:a,{store:u,subscription:l,getServerState:c,stabilityCheck:d,noopCheck:f}=e(),p=useRef(!0),g=useCallback({[t.name](m){return t(m)}}[t.name],[t,d,o]),h=Pg(l.addNestedSub,u.getState,c||u.getState,g,i);return useDebugValue(h),h}}const eA=null;var nt=$(58168),Ng=$(98587),aF=$(4146),Vg=$.n(aF),iF=$(44363);const oF=["initMapStateToProps","initMapDispatchToProps","initMergeProps"];function sF(n,e,r,t,{areStatesEqual:a,areOwnPropsEqual:i,areStatePropsEqual:o}){let s=!1,u,l,c,d,f;function p(S,C){return u=S,l=C,c=n(u,l),d=e(t,l),f=r(c,d,l),s=!0,f}function g(){return c=n(u,l),e.dependsOnOwnProps&&(d=e(t,l)),f=r(c,d,l),f}function h(){return n.dependsOnOwnProps&&(c=n(u,l)),e.dependsOnOwnProps&&(d=e(t,l)),f=r(c,d,l),f}function m(){const S=n(u,l),C=!o(S,c);return c=S,C&&(f=r(c,d,l)),f}function y(S,C){const F=!i(C,l),T=!a(S,u,C,l);return u=S,l=C,F&&T?g():F?h():T?m():f}return function(C,F){return s?y(C,F):p(C,F)}}function uF(n,e){let{initMapStateToProps:r,initMapDispatchToProps:t,initMergeProps:a}=e,i=(0,Ng.A)(e,oF);const o=r(n,i),s=t(n,i),u=a(n,i);return sF(o,s,u,n,i)}function lF(n,e){const r={};for(const t in n){const a=n[t];typeof a=="function"&&(r[t]=(...i)=>e(a(...i)))}return r}function Tc(n){return function(r){const t=n(r);function a(){return t}return a.dependsOnOwnProps=!1,a}}function Mg(n){return n.dependsOnOwnProps?!!n.dependsOnOwnProps:n.length!==1}function kg(n,e){return function(t,{displayName:a}){const i=function(s,u){return i.dependsOnOwnProps?i.mapToProps(s,u):i.mapToProps(s,void 0)};return i.dependsOnOwnProps=!0,i.mapToProps=function(s,u){i.mapToProps=n,i.dependsOnOwnProps=Mg(n);let l=i(s,u);return typeof l=="function"&&(i.mapToProps=l,i.dependsOnOwnProps=Mg(l),l=i(s,u)),l},i}}function _c(n,e){return(r,t)=>{throw new Error(`Invalid value of type ${typeof n} for ${e} argument when connecting component ${t.wrappedComponentName}.`)}}function cF(n){return n&&typeof n=="object"?Tc(e=>lF(n,e)):n?typeof n=="function"?kg(n,"mapDispatchToProps"):_c(n,"mapDispatchToProps"):Tc(e=>({dispatch:e}))}function dF(n){return n?typeof n=="function"?kg(n,"mapStateToProps"):_c(n,"mapStateToProps"):Tc(()=>({}))}function fF(n,e,r){return(0,nt.A)({},r,n,e)}function pF(n){return function(r,{displayName:t,areMergedPropsEqual:a}){let i=!1,o;return function(u,l,c){const d=n(u,l,c);return i?a(d,o)||(o=d):(i=!0,o=d),o}}}function vF(n){return n?typeof n=="function"?pF(n):_c(n,"mergeProps"):()=>fF}function gF(){const n=eF();let e=null,r=null;return{clear(){e=null,r=null},notify(){n(()=>{let t=e;for(;t;)t.callback(),t=t.next})},get(){let t=[],a=e;for(;a;)t.push(a),a=a.next;return t},subscribe(t){let a=!0,i=r={callback:t,next:null,prev:r};return i.prev?i.prev.next=i:e=i,function(){!a||e===null||(a=!1,i.next?i.next.prev=i.prev:r=i.prev,i.prev?i.prev.next=i.next:e=i.next)}}}}const Gg={notify(){},get:()=>[]};function $g(n,e){let r,t=Gg,a=0,i=!1;function o(h){c();const m=t.subscribe(h);let y=!1;return()=>{y||(y=!0,m(),d())}}function s(){t.notify()}function u(){g.onStateChange&&g.onStateChange()}function l(){return i}function c(){a++,r||(r=e?e.addNestedSub(u):n.subscribe(u),t=gF())}function d(){a--,r&&a===0&&(r(),r=void 0,t.clear(),t=Gg)}function f(){i||(i=!0,c())}function p(){i&&(i=!1,d())}const g={addNestedSub:o,notifyNestedSubs:s,handleChangeWrapper:u,isSubscribed:l,trySubscribe:f,tryUnsubscribe:p,getListeners:()=>t};return g}const Ru=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?I.useLayoutEffect:I.useEffect;function Ug(n,e){return n===e?n!==0||e!==0||1/n===1/e:n!==n&&e!==e}function Lc(n,e){if(Ug(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;const r=Object.keys(n),t=Object.keys(e);if(r.length!==t.length)return!1;for(let a=0;a<r.length;a++)if(!Object.prototype.hasOwnProperty.call(e,r[a])||!Ug(n[r[a]],e[r[a]]))return!1;return!0}const hF=()=>{throw new Error("uSES not initialized!")},mF=["reactReduxForwardedRef"];let Bg=hF;const yF=n=>{Bg=n},bF=null,SF=[null,null],rA=n=>{try{return JSON.stringify(n)}catch{return String(n)}};function OF(n,e,r){Ru(()=>n(...e),r)}function FF(n,e,r,t,a,i){n.current=t,r.current=!1,a.current&&(a.current=null,i())}function CF(n,e,r,t,a,i,o,s,u,l,c){if(!n)return()=>{};let d=!1,f=null;const p=()=>{if(d||!s.current)return;const h=e.getState();let m,y;try{m=t(h,a.current)}catch(S){y=S,f=S}y||(f=null),m===i.current?o.current||l():(i.current=m,u.current=m,o.current=!0,c())};return r.onStateChange=p,r.trySubscribe(),p(),()=>{if(d=!0,r.tryUnsubscribe(),r.onStateChange=null,f)throw f}}const nA=()=>bF;function EF(n,e){return n===e}let aA=!1;function wF(n,e,r,{pure:t,areStatesEqual:a=EF,areOwnPropsEqual:i=Lc,areStatePropsEqual:o=Lc,areMergedPropsEqual:s=Lc,forwardRef:u=!1,context:l=Dg}={}){const c=l,d=dF(n),f=cF(e),p=vF(r),g=!!n;return m=>{const y=m.displayName||m.name||"Component",S=`Connect(${y})`,C={shouldHandleStateChanges:g,displayName:S,wrappedComponentName:y,WrappedComponent:m,initMapStateToProps:d,initMapDispatchToProps:f,initMergeProps:p,areStatesEqual:a,areStatePropsEqual:o,areOwnPropsEqual:i,areMergedPropsEqual:s};function F(_){const[M,D,j]=I.useMemo(()=>{const{reactReduxForwardedRef:Le}=_,Ae=(0,Ng.A)(_,mF);return[_.context,Le,Ae]},[_]),P=I.useMemo(()=>M&&M.Consumer&&(0,iF.isContextConsumer)(I.createElement(M.Consumer,null))?M:c,[M,c]),V=I.useContext(P),L=!!_.store&&!!_.store.getState&&!!_.store.dispatch,U=!!V&&!!V.store,B=L?_.store:V.store,G=U?V.getServerState:B.getState,W=I.useMemo(()=>uF(B.dispatch,C),[B]),[z,H]=I.useMemo(()=>{if(!g)return SF;const Le=$g(B,L?void 0:V.subscription),Ae=Le.notifyNestedSubs.bind(Le);return[Le,Ae]},[B,L,V]),q=I.useMemo(()=>L?V:(0,nt.A)({},V,{subscription:z}),[L,V,z]),J=I.useRef(),Y=I.useRef(j),Z=I.useRef(),se=I.useRef(!1),re=I.useRef(!1),ee=I.useRef(!1),Fe=I.useRef();Ru(()=>(ee.current=!0,()=>{ee.current=!1}),[]);const pe=I.useMemo(()=>()=>Z.current&&j===Y.current?Z.current:W(B.getState(),j),[B,j]),oe=I.useMemo(()=>Ae=>z?CF(g,B,z,W,Y,J,se,ee,Z,H,Ae):()=>{},[z]);OF(FF,[Y,J,se,j,Z,H]);let Se;try{Se=Bg(oe,pe,G?()=>W(G(),j):pe)}catch(Le){throw Fe.current&&(Le.message+=`
The error may be correlated with this previous error:
${Fe.current.stack}

`),Le}Ru(()=>{Fe.current=void 0,Z.current=void 0,J.current=Se});const he=I.useMemo(()=>I.createElement(m,(0,nt.A)({},Se,{ref:D})),[D,m,Se]);return I.useMemo(()=>g?I.createElement(P.Provider,{value:q},he):he,[P,he,q])}const w=I.memo(F);if(w.WrappedComponent=m,w.displayName=F.displayName=S,u){const M=I.forwardRef(function(j,P){return I.createElement(w,(0,nt.A)({},j,{reactReduxForwardedRef:P}))});return M.displayName=S,M.WrappedComponent=m,Vg()(M,m)}return Vg()(w,m)}}const ju=wF;function AF({store:n,context:e,children:r,serverState:t,stabilityCheck:a="once",noopCheck:i="once"}){const o=I.useMemo(()=>{const l=$g(n);return{store:n,subscription:l,getServerState:t?()=>t:void 0,stabilityCheck:a,noopCheck:i}},[n,t,a,i]),s=I.useMemo(()=>n.getState(),[n]);Ru(()=>{const{subscription:l}=o;return l.onStateChange=l.notifyNestedSubs,l.trySubscribe(),s!==n.getState()&&l.notifyNestedSubs(),()=>{l.tryUnsubscribe(),l.onStateChange=void 0}},[o,s]);const u=e||Dg;return I.createElement(u.Provider,{value:o},r)}const TF=AF;function iA(n=ReactReduxContext){const e=n===ReactReduxContext?useDefaultReduxContext:createReduxContextHook(n);return function(){const{store:t}=e();return t}}const oA=null;function sA(n=ReactReduxContext){const e=n===ReactReduxContext?useDefaultStore:createStoreHook(n);return function(){return e().dispatch}}const uA=null;rF(YO.useSyncExternalStoreWithSelector),yF(JO.useSyncExternalStore),ZO(KO.unstable_batchedUpdates);var lA="ADD_GROUP",cA="ADD_CASE_GROUP",dA="REMOVE_GROUP",fA="SET_CONJUNCTION",pA="SET_NOT",vA="ADD_RULE",gA="REMOVE_RULE",hA="SET_FIELD",mA="SET_FIELD_SRC",yA="SET_OPERATOR",bA="SET_VALUE",SA="SET_VALUE_SRC",OA="SET_OPERATOR_OPTION",FA="SET_LOCK",CA="SET_TREE",EA="MOVE_ITEM",xu="after",Iu="before",Ya="append",Vi="prepend",_F="SET_DRAG_PROGRESS",LF="SET_DRAG_START",RF="SET_DRAG_END",jF=function(e,r){return{type:_F,mousePos:e,dragging:r}},xF=function(e,r,t){return{type:LF,dragStart:e,dragging:r,mousePos:t}},IF=function(){return{type:RF}},Wg=bt,DF=xe,PF=vt;function zg(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function qg(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?zg(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):zg(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var NF=function(e){var r;return(r=e?.cardinality)!==null&&r!==void 0?r:1},Du=function(e,r,t){if(!r||!e||e.length<=r)return e;var a=e.substr(0,r-1);return(t?a.substr(0,a.lastIndexOf(" ")):a)+"..."},Ka=function(e,r){return e===r?!0:e?.equals(r)},Xa=function(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e===r?!0:Array.isArray(e)?VF(e,r,t):e&&typeof e.equals=="function"?e.equals(r):(0,ft.A)(e)==="object"?MF(e,r,t):e===r};function VF(n,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(n===e)return!0;if(!n||!e)return!1;var t=n.length;if(e.length!==t)return!1;for(var a=0;a<t;a++){var i=r?Xa(n[a],e[a],r):n[a]===e[a];if(!i)return!1}return!0}function MF(n,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(n===e)return!0;if(!n||!e)return!1;var t=Object.keys(n),a=Object.keys(e),i=t.length;if(a.length!==i)return!1;for(var o=0;o<i;o++){var s=t[o],u=r?Xa(n[s],e[s],r):n[s]===e[s];if(!u)return!1}return!0}var kF=function(){var e;return typeof process<"u"&&((e=process)===null||e===void 0||(e=e.env)===null||e===void 0?void 0:"production")=="development"},GF=function(){var e;return typeof process<"u"&&((e=process)===null||e===void 0||(e=e.env)===null||e===void 0?void 0:e.NODE_ENV_TEST)=="true"},$F=function(e){if(GF())return qg(qg({},console),{},{log:function(){},debug:function(){},info:function(){}});var r=e??kF();return r?console:{error:function(){},log:function(){},warn:function(){},debug:function(){},info:function(){}}},UF=$F(),Hg=Be.Validation.validateAndFixTree,BF=function(){var e,r,t;return function(a,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return i?(a.__configId===t&&(Ka(i,e)||Ka(i,r))||(t=a.__configId,e=i,s===!1?r=Hg(i,null,a,o||a,!1,!1,!1):r=Hg(i,null,a,o||a)),r):null}},WF=function(e){if(e._reactRootContainer)return"root";if(Object.getOwnPropertyNames(e).filter(function(r){return r.startsWith("__reactContainer")}).length>0)return"container"},zF=function n(e){if(e){var r=WF(e);return r!==void 0?r:n(e.parentNode)}},Qg=function(e){return zF(e)==="root"},Pu=function(e,r){return function(t,a){var i=e.props,o=e.state,s=t!=i||a!=o;if(s&&o==a&&i!=t){var u=[];for(var l in t){var c=t[l]!=i[l];c&&(r[l]=="ignore"?c=!1:r[l]=="shallow_deep"?c=!Xa(t[l],i[l],!0):r[l]=="shallow"?c=!Xa(t[l],i[l]):typeof r[l]=="function"&&(c=r[l](t[l],i[l],t,i))),c&&u.push(l)}u.length||(s=!1)}return s}},Mi=function(e){return function(r,t){return!Xa(e.props,r)||!Xa(e.state,t)}},qF=function(){var e=I.version.split(".").map(parseInt.bind(null,10));return e[0]==16&&e[1]<3||e[0]<16},Dr=function(e){if(e.shouldComponentUpdate||(e.shouldComponentUpdate=Mi(e)),qF())e.componentWillReceiveProps=function(a){e.onPropsChanged(a)};else{var r=e.shouldComponentUpdate,t=function(i,o){var s=!Xa(e.props,i);s&&e.onPropsChanged(i);var u=r.call(e,i,o);return u};e.shouldComponentUpdate=t.bind(e)}},Jg=function(e,r,t){return Lu()(e,function(a){return function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return t(a.apply(void 0,[r].concat(o)))}})};function Yg(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Rc(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Yg(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Yg(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function HF(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,Kg()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function Kg(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Kg=function(){return!!n})()}var Xg=function(n){function e(r){var t;(0,Ie.A)(this,e),t=HF(this,e,[r]),t.shouldComponentUpdate=Pu(t,{tree:function(o){return!(o===t.oldValidatedTree&&t.oldValidatedTree===t.validatedTree)}}),Dr(t),t._updateActions(r),t.validatedTree=r.getMemoizedTree(r.config,r.tree,void 0,r.sanitizeTree),t.oldValidatedTree=t.validatedTree;var a=r.getBasicConfig(r.config);return r.onInit&&r.onInit(t.validatedTree,a,void 0,t.actions),t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"_updateActions",value:function(t){var a=t.config,i=t.dispatch;this.actions=Jg(Rc(Rc(Rc({},Wg),DF),PF),a,i)}},{key:"onPropsChanged",value:function(t){var a=t.onChange,i=this.props.config,o=t.tree,s=this.props.tree,u=t.config;this.oldValidatedTree=this.validatedTree,this.validatedTree=o,i!==u&&(this._updateActions(t),this.validatedTree=t.getMemoizedTree(u,o,i));var l=!Ka(this.validatedTree,this.oldValidatedTree);if(l){var c=t.getBasicConfig(u);a&&a(this.validatedTree,c,t.__lastAction,this.actions)}}},{key:"render",value:function(){var t=this.props,a=t.config,i=t.renderBuilder,o=t.dispatch,s={tree:this.validatedTree,actions:this.actions,config:a,dispatch:o};return i(s)}}])}(I.Component);Xg.propTypes={config:R().object.isRequired,onChange:R().func,onInit:R().func,renderBuilder:R().func,tree:R().any};var Zg=ju(function(n){return{tree:n.tree,__lastAction:n.__lastAction}},null,null,{context:qo})(Xg);Zg.displayName="ConnectedQuery";const QF=Zg;function JF(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,eh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function eh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(eh=function(){return!!n})()}var th=Be.DefaultUtils.defaultRoot,rh=Be.ConfigUtils,YF=rh.createConfigMemo,KF=rh.extendConfig,nh=function(n){function e(r,t){var a,i,o;(0,Ie.A)(this,e),o=JF(this,e,[r,t]),o.setLastTree=function(F){o.prevTree&&(o.prevprevTree=o.prevTree),o.prevTree=F},o.getConfig=function(){return o.config},o.shouldComponentUpdate=Pu(o,{value:function(T,w){return!1}}),Dr(o);var s=YF({reactIndex:(a=(i=o._reactInternals)===null||i===void 0?void 0:i.index)!==null&&a!==void 0?a:-1,maxSize:2,canCompile:!0,extendConfig:KF}),u=s.getExtendedConfig,l=s.getBasicConfig,c=s.clearConfigMemo;o.getMemoizedConfig=u,o.getBasicConfig=l,o.clearConfigMemo=c,o.getMemoizedTree=BF();var d=o.getMemoizedConfig(r),f=d.settings.shouldCreateEmptyGroup,p=!f,g=th(d,p),h=!!r.value,m=r.value||g,y=o.getMemoizedTree(d,m,void 0,h),S=HO(d,y,o.getMemoizedTree,o.setLastTree,o.getConfig),C=(0,QO.createStore)(S);return o.config=d,o.state={store:C},o.QueryWrapper=function(F){return d.settings.renderProvider(F,d.ctx)},o}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"componentWillUnmount",value:function(){this.clearConfigMemo()}},{key:"onPropsChanged",value:function(t){var a=this.props,i=this.config,o=this.getMemoizedConfig(t),s=i!==o,u=this.state.store.getState().tree,l=!Ka(t.value,this.props.value)&&!Ka(t.value,u),c=l?t.value||th(t):u,d=l&&!Ka(t.value,this.prevTree)&&!Ka(t.value,this.prevprevTree);this.sanitizeTree=d||s;var f=s&&!l;if(s&&(a.settings.renderProvider!==t.settings.renderProvider&&(this.QueryWrapper=function(g){return o.settings.renderProvider(g,o.ctx)}),this.config=o),l||s){var p=this.getMemoizedTree(o,c,f?i:void 0,this.sanitizeTree);this.state.store.dispatch(Wg.setTree(o,p))}}},{key:"render",value:function(){var t=this.props,a=t.renderBuilder,i=t.get_children,o=t.onChange,s=t.onInit,u=this.state.store,l=this.config,c=this.QueryWrapper;return I.createElement(c,{config:l},I.createElement(TF,{store:u,context:qo},I.createElement(QF,{config:l,getMemoizedTree:this.getMemoizedTree,getBasicConfig:this.getBasicConfig,sanitizeTree:this.sanitizeTree,onChange:o,onInit:s,renderBuilder:a||i})))}}])}(I.Component);nh.propTypes={conjunctions:R().object.isRequired,fields:R().object.isRequired,types:R().object.isRequired,operators:R().object.isRequired,widgets:R().object.isRequired,settings:R().object.isRequired,ctx:R().object.isRequired,onChange:R().func,onInit:R().func,renderBuilder:R().func,value:R().any};var XF=$(46942),nn=$.n(XF);function ZF(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,ah()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function ah(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ah=function(){return!!n})()}var eC=Be.ConfigUtils.getFieldConfig,tC=function(e){var r;return r=function(t){function a(i){var o;return(0,Ie.A)(this,a),o=ZF(this,a,[i]),o.dummyFn=function(){},o.removeSelf=function(){o.props.actions.removeRule(o.props.path)},o.setLock=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;o.props.actions.setLock(o.props.path,s)},o.setField=function(s,u,l){o.props.actions.setField(o.props.path,s,u,l)},o.setFieldSrc=function(s){o.props.actions.setFieldSrc(o.props.path,s)},o.setOperator=function(s){o.props.actions.setOperator(o.props.path,s)},o.setOperatorOption=function(s,u){o.props.actions.setOperatorOption(o.props.path,s,u)},o.setValue=function(s,u,l,c,d){o.props.actions.setValue(o.props.path,s,u,l,c,d)},o.setValueSrc=function(s,u,l){o.props.actions.setValueSrc(o.props.path,s,u,l)},o.setFuncValue=function(s,u,l,c,d,f,p){o.props.actions.setFuncValue(o.props.path,s,u,l,c,d,f,p)},o.pureShouldComponentUpdate=Mi(o),o.dummyFn.isDummyFn=!0,o}return(0,it.A)(a,t),(0,Ke.A)(a,[{key:"shouldComponentUpdate",value:function(o,s){var u=this.props,l=this.state,c=this.pureShouldComponentUpdate(o,s);if(c&&l==s&&u!=o){var d=o.dragging.id||u.dragging.id,f=d==o.id,p=[];for(var g in o){var h=o[g]!=u[g];g=="dragging"&&!f&&(h=!1),h&&p.push(g)}p.length||(c=!1)}return c}},{key:"render",value:function(){var o=this.props.dragging.id==this.props.id,s=eC(this.props.config,this.props.field),u=this.props.fieldType||s?.type||null,l=this.props.config.settings.showErrorMessage,c=s&&s.type=="!struct",d=!o&&this.props.isDraggingTempo,f=this.props,p=f.valueError,g=f.fieldError,h=[g].concat((0,ue.A)(p?.toArray()||[])).filter(function(y){return!!y}).shift()||null,m=h!=null&&l;return I.createElement("div",{className:nn()("group-or-rule-container","rule-container",m?"rule-with-error":null),"data-id":this.props.id},[o?I.createElement(e,{key:"dragging",id:this.props.id,groupId:this.props.groupId,lev:this.props.path.size-1,isDraggingMe:!0,isDraggingTempo:!0,dragging:this.props.dragging,setField:this.dummyFn,setFieldSrc:this.dummyFn,setFuncValue:this.dummyFn,setOperator:this.dummyFn,setOperatorOption:this.dummyFn,setLock:this.dummyFn,removeSelf:this.dummyFn,setValue:this.dummyFn,setValueSrc:this.dummyFn,selectedField:this.props.field||null,selectedFieldSrc:this.props.fieldSrc||"field",selectedFieldType:u,parentField:this.props.parentField||null,parentFieldPathSize:this.props.parentFieldPathSize,parentFieldCanReorder:this.props.parentFieldCanReorder,selectedOperator:this.props.operator||null,value:this.props.value||null,valueSrc:this.props.valueSrc||null,valueType:this.props.valueType||null,valueError:this.props.valueError||null,fieldError:this.props.fieldError||null,operatorOptions:this.props.operatorOptions,config:this.props.config,reordableNodesCnt:this.props.reordableNodesCnt,totalRulesCnt:this.props.totalRulesCnt,asyncListValues:this.props.asyncListValues,isLocked:this.props.isLocked,isTrueLocked:this.props.isTrueLocked,parentReordableNodesCnt:this.props.parentReordableNodesCnt}):null,I.createElement(e,{key:this.props.id,id:this.props.id,groupId:this.props.groupId,lev:this.props.path.size-1,isDraggingMe:o,isDraggingTempo:d,onDragStart:this.props.onDragStart,setLock:d?this.dummyFn:this.setLock,removeSelf:d?this.dummyFn:this.removeSelf,setField:d?this.dummyFn:this.setField,setFieldSrc:d?this.dummyFn:this.setFieldSrc,setFuncValue:d?this.dummyFn:this.setFuncValue,setOperator:d?this.dummyFn:this.setOperator,setOperatorOption:d?this.dummyFn:this.setOperatorOption,setValue:d?this.dummyFn:this.setValue,setValueSrc:d?this.dummyFn:this.setValueSrc,selectedField:this.props.field||null,selectedFieldSrc:this.props.fieldSrc||"field",selectedFieldType:u,parentField:this.props.parentField||null,parentFieldPathSize:this.props.parentFieldPathSize,parentFieldCanReorder:this.props.parentFieldCanReorder,selectedOperator:this.props.operator||null,value:this.props.value||null,valueSrc:this.props.valueSrc||null,valueType:this.props.valueType||null,valueError:this.props.valueError||null,fieldError:this.props.fieldError||null,operatorOptions:this.props.operatorOptions,config:this.props.config,reordableNodesCnt:this.props.reordableNodesCnt,totalRulesCnt:this.props.totalRulesCnt,asyncListValues:this.props.asyncListValues,isLocked:this.props.isLocked,isTrueLocked:this.props.isTrueLocked,parentReordableNodesCnt:this.props.parentReordableNodesCnt})])}}])}(I.Component),r.propTypes={id:R().string.isRequired,groupId:R().string,config:R().object.isRequired,path:R().any.isRequired,operator:R().string,field:R().any,fieldSrc:R().string,fieldType:R().string,actions:R().object.isRequired,onDragStart:R().func,value:R().any,valueSrc:R().any,asyncListValues:R().array,valueError:R().any,fieldError:R().string,operatorOptions:R().object,reordableNodesCnt:R().number,parentField:R().string,isLocked:R().bool,isTrueLocked:R().bool,dragging:R().object,isDraggingTempo:R().bool},r};const rC=function(n){var e=ju(function(r){return{dragging:r.dragging}},null,null,{context:qo})(tC(n));return e.displayName="ConnectedRuleContainer",e};function nC(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,ih()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function ih(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ih=function(){return!!n})()}var oh=Be.OtherUtils.clone,aC=Be.TreeUtils.getFlatTree,jc=!1,iC=function(e){var r,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return r=function(a){function i(o){var s;return(0,Ie.A)(this,i),s=nC(this,i,[o]),s._getEventTarget=function(u,l){return u&&u.__mocked_window||document.body||window},s.onDragStart=function(u,l,c){var d=l.closest(".query-builder");if(!d){console.error("Please change renderBuilder implementation of <Query>: wrap <Builder> with div.query-builder for drag-n-drop support");return}s._isUsingLegacyReactDomRender===void 0&&(s._isUsingLegacyReactDomRender=Qg(d)),document.body.classList.add("qb-dragging"),d.classList.add("qb-dragging");var f=d.closest(".query-builder-container")||d;f=s._getScrollParent(f)||document.body;var p=f.scrollTop,g=s._getDraggableNodeEl(d),h=s._getPlaceholderNodeEl(d),m=d.querySelectorAll(".group--children"),y=m.length?m[0]:null,S;y&&(S=window.getComputedStyle(y,null).getPropertyValue("padding-left"),S=parseInt(S));var C={id:u,x:l.offsetLeft,y:l.offsetTop,w:l.offsetWidth,h:l.offsetHeight,itemInfo:s.tree.items[u],paddingLeft:S},F={id:u,x:l.offsetLeft,y:l.offsetTop,scrollTop:p,clientX:c.clientX,clientY:c.clientY,itemInfo:oh(s.tree.items[u]),treeEl:d,treeElContainer:f},T={clientX:c.clientX,clientY:c.clientY},w=s._getEventTarget(c,F);s.eventTarget=w,w.addEventListener("mousemove",s.onDrag),w.addEventListener("mouseup",s.onDragEnd),s.props.setDragStart(F,C,T)},s.onDrag=function(u){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,c=Object.assign({},s.props.dragging),d=s.props.dragStart,f=c.paddingLeft,p=d.treeElContainer,g=p.scrollTop;if(c.itemInfo=s.tree.items[c.id],!!c.itemInfo){var h={clientX:u.clientX,clientY:u.clientY},m={clientX:d.clientX,clientY:d.clientY};if(u.__mock_dom){var y=d.treeEl,S=s._getDraggableNodeEl(y),C=s._getPlaceholderNodeEl(y);u.__mock_dom({treeEl:y,dragEl:S,plhEl:C})}if(!d.plX){var F=d.treeEl,T=s._getPlaceholderNodeEl(F);T&&(d.plX=T.getBoundingClientRect().left+window.scrollX,d.plY=T.getBoundingClientRect().top+window.scrollY)}var w=d.x,_=d.y,M=d.clientX,D=d.clientY,j=d.scrollTop,P={x:w+(u.clientX-M),y:_+(u.clientY-D)+(g-j)};c.x=P.x,c.y=P.y,c.paddingLeft=f,c.mousePos=h,c.startMousePos=m,s.props.setDragProgress(h,c);var V=l?s.handleDrag(c,u,t):!1;V||u.preventDefault&&u.preventDefault()}},s.onDragEnd=function(){var u=s.props.dragStart.treeEl;s.props.setDragEnd(),u.classList.remove("qb-dragging"),document.body.classList.remove("qb-dragging"),s._cacheEls={};var l=s.eventTarget||s._getEventTarget();l.removeEventListener("mousemove",s.onDrag),l.removeEventListener("mouseup",s.onDragEnd)},s.pureShouldComponentUpdate=Mi(s),Dr(s),s.onPropsChanged(o),s}return(0,it.A)(i,a),(0,Ke.A)(i,[{key:"onPropsChanged",value:function(s){this.tree=aC(s.tree,s.config)}},{key:"shouldComponentUpdate",value:function(s,u){var l=this.props,c=this.state,d=this.pureShouldComponentUpdate(s,u);if(d&&c==u&&l!=s){var f=[];for(var p in s){var g=s[p]!=l[p];g&&p!="dragging"&&p!="mousePos"&&f.push(p)}f.length||(d=!1)}return d}},{key:"componentDidUpdate",value:function(s,u){var l=this.props.dragging,c=this.props.dragStart;if(jc=!1,c&&c.id&&(l.itemInfo=this.tree.items[l.id],l.itemInfo&&(l.itemInfo.index!=c.itemInfo.index||l.itemInfo.parent!=c.itemInfo.parent))){var d=c.treeEl,f=c.treeElContainer,p=this._getPlaceholderNodeEl(d,!0);if(p){var g=p.getBoundingClientRect().left+window.scrollX,h=p.getBoundingClientRect().top+window.scrollY,m=c.plX,y=c.plY,S=f.scrollTop;c.plX=g,c.plY=h,c.itemInfo=oh(l.itemInfo),c.y=p.offsetTop,c.x=p.offsetLeft,c.clientY+=h-y,c.clientX+=g-m,f!=document.body&&(c.scrollTop=S),this.onDrag(this.props.mousePos,!1)}}}},{key:"_getNodeElById",value:function(s,u){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(u==null)return null;this._cacheEls||(this._cacheEls={});var c=this._cacheEls[u];return c&&document.contains(c)&&!l||(c=s.querySelector('.group-or-rule-container[data-id="'+u+'"]'),this._cacheEls[u]=c),c}},{key:"_getDraggableNodeEl",value:function(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this._cacheEls||(this._cacheEls={});var l=this._cacheEls.draggable;if(l&&document.contains(l)&&!u)return l;var c=s.getElementsByClassName("qb-draggable");return l=c.length?c[0]:null,this._cacheEls.draggable=l,l}},{key:"_getPlaceholderNodeEl",value:function(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this._cacheEls||(this._cacheEls={});var l=this._cacheEls.placeholder;if(l&&document.contains(l)&&!u)return l;var c=s.getElementsByClassName("qb-placeholder");return l=c.length?c[0]:null,this._cacheEls.placeholder=l,l}},{key:"_isScrollable",value:function(s){var u=window.getComputedStyle(s)["overflow-y"];return(u==="scroll"||u==="auto")&&s.scrollHeight>s.offsetHeight}},{key:"_getScrollParent",value:function(s){return s==null?null:s===document.body||this._isScrollable(s)?s:this._getScrollParent(s.parentNode)}},{key:"handleDrag",value:function(s,u,l){var c=this,d=!0,f=s.itemInfo,p=s.paddingLeft,g=null,h=this.props.dragStart.treeEl,m=s.id,y=this._getDraggableNodeEl(h),S=this._getPlaceholderNodeEl(h),C,F,T,w;if(y&&S){if(C=y.getBoundingClientRect(),F=S.getBoundingClientRect(),!F.width)return;var _={hrz:0,vrt:0};C.top<F.top?_.vrt=-1:C.bottom>F.bottom&&(_.vrt=1),C.left>F.left?_.hrz=1:C.left<F.left&&(_.hrz=-1),w=h.getBoundingClientRect();var M={x:w.left+(w.right-w.left)/2,y:_.vrt>=0?C.bottom:C.top},D;if(u.__mocked_hov_container)D=u.__mocked_hov_container;else{var j=document.elementFromPoint(M.x,M.y-1);if(D=j?j.closest(".group-or-rule-container"):null,!D&&j&&j.classList.contains("query-builder-container")){var P,V=j==null||(P=j.firstChild)===null||P===void 0?void 0:P.firstChild;V&&V.classList.contains("group-or-rule-container")&&(D=V)}}if(!D)UF.log("out of tree bounds!");else{var L=D.classList.contains("group-container"),U=D.getAttribute("data-id"),B=D,G=!1,W=!1;if(B){T=B.getBoundingClientRect();var z=T.bottom-T.top,H=this.tree.items[U];if(!H)throw new Error("There is an issue with rendering. If you use Next.js, please check getServerSideProps() method.");var q=null,J=null,Y=null,Z=null;if(_.vrt==0)Y=f,J=S,J&&(q=J.getBoundingClientRect());else if(L){if(_.vrt>0){var se=D.getElementsByClassName("group--header"),re=se.length?se[0]:null;if(re){var ee=re.getBoundingClientRect(),Fe=ee.bottom-ee.top,pe=C.bottom-ee.top>Fe*3/4;pe&&H.top>s.itemInfo.top&&(Y=H,q=ee,J=re,W=!0)}}else if(_.vrt<0&&H.lev>=f.lev){var oe=T.bottom-C.top>=2;oe&&H.top<s.itemInfo.top&&(Y=H,q=T,J=B,G=!0)}if(!W&&!G||d){var Se=_.vrt<0?T.bottom-C.top>z-5:C.bottom-T.top>z-5;Se&&(!W&&!G&&(Y=H,q=T,J=B),d&&(Z=H))}}else{var he=_.vrt<0?T.bottom-C.top>z/2:C.bottom-T.top>z/2;he&&(Y=H,q=T,J=B)}var be=Y&&Y.id==m;if(q){var Le=C.left-w.left,Ae=q.left-w.left,ke=Ae/p,Ve=Math.max(0,Math.round(Le/p)),Re=[],Ce=[];if(!be){if(L&&(G?Re.push([Ya,Y,Y.lev+1]):W&&Re.push([Vi,Y,Y.lev+1]),d&&Z)){var jt=Z.lev==0,ot=Z.type=="case_group"&&f.type!="case_group",mt=Z.prev&&this.tree.items[Z.prev].caseId,Ue=Z.next&&this.tree.items[Z.next].caseId;f.caseId==mt&&(mt=null),f.caseId==Ue&&(Ue=null);var Mt=mt&&this.tree.items[mt],kt=Ue&&this.tree.items[Ue];_.vrt>0?jt?Ce.push([Ya,Z,Z.lev+1]):ot&&kt?Ce.push([Vi,kt,kt.lev+1]):Ce.push([xu,Z,Z.lev]):_.vrt<0&&(jt?Ce.push([Vi,Z,Z.lev+1]):ot&&Mt?Ce.push([Ya,Mt,Mt.lev+1]):Ce.push([Iu,Z,Z.lev]))}!G&&!W&&(_.vrt<0?Re.push([Iu,Y,Y.lev]):_.vrt>0&&Re.push([xu,Y,Y.lev]))}var ir=function(Qt){var Sr=Qt[1],Dn=f.caseId?c.tree.items[f.caseId]:null,Mr=Sr.caseId?c.tree.items[Sr.caseId]:null;return[].concat((0,ue.A)(Qt),[Dn,Mr])};Re=Re.map(ir),Ce=Ce.map(ir),Re=Re.filter(function(at){var Qt=at[0],Sr=at[1];if((Qt==Iu||Qt==xu)&&Sr.parent==null||Sr.collapsed&&(Qt==Ya||Qt==Vi))return!1;var Dn=Sr.id==f.id;if(!Dn){for(var Mr=Sr;Mr.parent;)if(Mr=c.tree.items[Mr.parent],Mr.id==f.id){Dn=!0;break}}return!Dn}).map(function(at){var Qt=at[0],Sr=at[1],Dn=at[2],Mr=at[3],Xn=at[4],_t=null;return Qt==Ya||Qt==Vi?_t=Sr:_t=c.tree.items[Sr.parent],_t&&_t.parent==null&&(_t=null),at[5]=_t,at});var xt=null,Xe=Re.filter(function(at){return c.canMove(f,at[1],at[0],at[3],at[4],at[5],l)});d&&Xe.length==0&&Ce.length>0&&(Xe=Ce.filter(function(at){return c.canMove(f,at[1],at[0],at[3],at[4],at[5],l)}));var Ht=Xe.map(function(at){return at[2]}),Xt=f.lev,Zt=Ht.concat(Xt),Vr=null;Zt.indexOf(Ve)!=-1?Vr=Ve:Ve>Math.max.apply(Math,(0,ue.A)(Zt))?Vr=Math.max.apply(Math,(0,ue.A)(Zt)):Ve<Math.min.apply(Math,(0,ue.A)(Zt))&&(Vr=Math.min.apply(Math,(0,ue.A)(Zt))),xt=Xe.find(function(at){return at[2]==Vr}),!be&&!xt&&Xe.length&&(xt=Xe[0]),g=xt}}}}return g?(this.move(f,g[1],g[0],g[3]),!0):!1}},{key:"canMove",value:function(s,u,l,c,d,f,p){if(!s||!u||s.id===u.id)return!1;var g=this.props.config.settings,h=g.canRegroup,m=g.canRegroupCases,y=g.maxNesting,S=g.maxNumberOfRules,C=g.canLeaveEmptyCase,F=f?f.nextAtomicLev:u.atomicLev,T=F+(s.closestRuleGroupId?0:s.depth||(s.type=="group"?1:0)),w=l==Iu||l==xu,_=l==Vi||l==Ya,M=w&&u.lev==1||_&&u.lev==0,D=s.parent!=u.parent,j=_||D,P=s.type=="rule_group"||!!s.closestRuleGroupId||u.type=="rule_group"||!!u.closestRuleGroupId,V=_&&u.type=="rule_group"?u.id:u.closestRuleGroupId,L=_&&u.type=="rule_group"?u.maxNesting:u.closestRuleGroupMaxNesting,U=(_&&u.type=="rule_group"?u.canRegroup:u.closestRuleGroupCanRegroup)!=!1,B=_&&u.type=="rule_group"?u.lev:u.closestRuleGroupLev,G=(f?f.lev+1:u.lev)+(s.depth||(s.type=="group"?1:0))-(B||0),W=P&&s.closestRuleGroupId!=V,z=s.type=="case_group"&&!M||s.type!="case_group"&&u.type=="case_group"&&w||s.type!="case_group"&&u.type=="switch_group"||!m&&s.caseId!=u.caseId,H=z||W,q=u.isLocked||s.isLocked||f&&f.isLocked;if(y&&T>y||L&&G>L||j&&(!h||H||q)||P&&j&&!U)return!1;if(s.type!="case_group"&&s.caseId!=u.caseId){var J=c?c._height==2:!1,Y=d?d.atomicRulesCountInCase+1:0;if(S&&Y>S||J&&!C)return!1}if(s.type=="case_group"&&(s.isDefaultCase||u.isDefaultCase||u.type=="switch_group"&&l==Ya))return!1;var Z=!0;return p&&(Z=p(s.node.toJS(),u.node.toJS(),l,f?f.node.toJS():null)),Z}},{key:"move",value:function(s,u,l,c){this._isUsingLegacyReactDomRender||(jc=!0),this.props.actions.moveItem(s.path,u.path,l)}},{key:"render",value:function(){return I.createElement(e,(0,nt.A)({},this.props,{onDragStart:this.onDragStart}))}}])}(I.Component),r.propTypes={tree:R().any.isRequired,actions:R().object.isRequired},r};const oC=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=ju(function(t){return{dragging:t.dragging,dragStart:t.dragStart,mousePos:t.mousePos}},{setDragStart:xF,setDragProgress:jF,setDragEnd:IF},null,{context:qo})(iC(n,e));return r.displayName="ConnectedSortableContainer",r};var sC=["isDraggingTempo","isDraggingMe","dragging"];function uC(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,sh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function sh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sh=function(){return!!n})()}const ki=function(n){return function(e){var r;return r=function(t){function a(i){var o;return(0,Ie.A)(this,a),o=uC(this,a,[i]),o.handleDraggerMouseDown=function(s){var u=o.props.id,l=o.wrapper.current;o.props.onDragStart&&o.props.onDragStart(u,l,s)},o.wrapper=I.createRef(),o}return(0,it.A)(a,t),(0,Ke.A)(a,[{key:"render",value:function(){var o=this.props,s=o.isDraggingTempo,u=o.isDraggingMe,l=o.dragging,c=(0,Qa.A)(o,sC),d=c.isTrueLocked,f={};u&&s&&(jc||(f={top:l.y,left:l.x,width:l.w}));var p=nn()(n,"group-or-rule",u&&s?"qb-draggable":null,u&&!s?"qb-placeholder":null,d?"locked":null);return I.createElement("div",{className:p,style:f,ref:this.wrapper,"data-id":this.props.id},I.createElement(e,(0,nt.A)({handleDraggerMouseDown:this.handleDraggerMouseDown,isDraggingMe:u,isDraggingTempo:s},c)))}}])}(I.PureComponent),r.propTypes={isDraggingTempo:R().bool,isDraggingMe:R().bool,onDragStart:R().func,dragging:R().object,isLocked:R().bool,isTrueLocked:R().bool},r}};var lC=$(95950),Gi=$.n(lC),cC=$(71086),dC=$.n(cC);function uh(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function fC(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?uh(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):uh(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function pC(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,lh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function lh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lh=function(){return!!n})()}var ch=Be.ConfigUtils,vC=ch.getFieldConfig,gC=ch.getOperatorConfig,dh=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=pC(this,e,[r]),t.shouldComponentUpdate=Pu(t,{selectedField:function(i,o){return!1}}),Dr(t),t.onPropsChanged(r),t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){var a=this.props,i=["config","selectedField","selectedFieldSrc","selectedFieldType","selectedOperator"],o=!this.meta||i.map(function(s){return t[s]!==a[s]}).filter(function(s){return s}).length>0;o&&(this.meta=this.getMeta(t))}},{key:"getMeta",value:function(t){var a,i=t.config,o=t.selectedField,s=t.selectedFieldType,u=t.selectedOperator,l=vC(i,o),c=(0,ue.A)(l?.operators||((a=i.types[s])===null||a===void 0?void 0:a.operators)||[]);!o&&!c.includes(u)&&c.push(u);var d=Lu()(dC()(i.operators,function(F,T){return c?.indexOf(T)!==-1}),function(F,T){return gC(i,T,o)}),f=this.buildOptions(i,d,c),p=d[u]||{},g=this.props.config.settings.operatorPlaceholder,h=u,m=h?[h]:null,y=m,S=p.label,C=p.label2||p.tooltip;return{placeholder:g,items:f,selectedKey:h,selectedKeys:m,selectedPath:y,selectedLabel:S,selectedAltLabel:C,selectedOpts:p,fieldConfig:l}}},{key:"buildOptions",value:function(t,a,i){return!a||!i?null:Gi()(a).sort(function(o,s){return i.indexOf(o)-i.indexOf(s)}).map(function(o){var s=a[o],u=s.label,l=s.label2,c=s.tooltip;return{key:o,path:o,label:u,altLabel:l,tooltip:c}})}},{key:"render",value:function(){var t=this.props,a=t.config,i=t.customProps,o=t.setOperator,s=t.readonly,u=t.id,l=t.groupId,c=a.settings.renderOperator,d=fC({id:u,groupId:l,config:a,customProps:i,readonly:s,setField:o},this.meta);return d.items?c(d,a.ctx):null}}])}(I.Component);dh.propTypes={id:R().string,groupId:R().string,config:R().object.isRequired,selectedField:R().any,selectedFieldId:R().string,selectedFieldType:R().string,selectedFieldSrc:R().string,selectedOperator:R().string,readonly:R().bool,customProps:R().object,setOperator:R().func.isRequired};var hC=["children"],Kt=function(e){var r=e.children,t=(0,Qa.A)(e,hC);return I.createElement("div",t,r)},Pr=function(){},fh=function(){return I.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"gray",width:"18px",height:"18px"},I.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),I.createElement("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"}))},$i=function(e){return function(r){var t=r.config.settings.useConfirm,a=t?t.call(r.config.ctx,r.config.ctx):null;return I.createElement(e,(0,nt.A)({},r,{confirmFn:a}))}},ph=function(e){var r=e.id,t=e.isLHS,a=e.delta,i=e.parentFuncs;return[r,t?"L":"R",t?-1:a||0,(i||[]).map(function(o){var s=(0,ve.A)(o,2),u=s[0],l=s[1];return"".concat(u,"(").concat(l,")")}).join("/")].join(":")},Nr=function(e,r){var t;return typeof r=="function"?(t=function(i){return r?.(i,e.ctx)},t.displayName=r.name):t=r,t};function mC(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,vh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function vh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vh=function(){return!!n})()}var gh=function(n){function e(){return(0,Ie.A)(this,e),mC(this,e,arguments)}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"render",value:function(){var t=this.props,a=t.config,i=t.selectedField,o=t.selectedFieldSrc,s=t.selectedFieldType,u=t.selectedOperator,l=t.setOperator,c=t.selectedFieldId,d=t.showOperator,f=t.showOperatorLabel,p=t.selectedFieldWidgetConfig,g=t.readonly,h=t.id,m=t.groupId,y=d&&I.createElement(Kt,{key:"operators-for-"+c,className:"rule--operator"},a.settings.showLabels&&I.createElement("label",{className:"rule--label"},a.settings.operatorLabel),I.createElement(dh,{key:"operator",config:a,selectedField:i,selectedFieldSrc:o,selectedFieldType:s,selectedFieldId:c,selectedOperator:u,setOperator:l,customProps:a.settings.customOperatorSelectProps,readonly:g,id:h,groupId:m})),S=f&&I.createElement(Kt,{key:"operators-for-"+c,className:"rule--operator"},I.createElement("div",{className:"rule--operator-wrapper"},a.settings.showLabels?I.createElement("label",{className:"rule--label"},"\xA0"):null,I.createElement("div",{className:"rule--operator-text-wrapper"},I.createElement("span",{className:"rule--operator-text"},p.operatorInlineLabel))));return[y,S]}}])}(I.PureComponent);function hh(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function yC(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?hh(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):hh(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function bC(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,mh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function mh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mh=function(){return!!n})()}var yh=Be.RuleUtils.getFieldPathLabels,xc=Be.ConfigUtils,bh=xc.getFieldConfig,Sh=xc.getFieldParts,Oh=xc.getFieldPathParts,Fh=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=bC(this,e,[r]),t.setField=function(a,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=t.props.id;if(!o.widgetId){var u=[s,"L",-1].join(":");o.widgetId=u}t.props.setField(a,i,o)},Dr(t),t.onPropsChanged(r),t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){var a=this.props,i=["selectedField","selectedFieldSrc","selectedFieldType","config","parentField"],o=!this.meta||i.map(function(s){return t[s]!==a[s]}).filter(function(s){return s}).length>0;o&&(this.meta=this.getMeta(t))}},{key:"getMeta",value:function(t){var a=t.selectedField,i=t.selectedFieldType,o=t.config,s=t.parentField,u=a,l=o.settings,c=l.maxLabelsLength,d=l.fieldSeparatorDisplay,f=l.fieldPlaceholder,p=l.fieldSeparator,g=!!a,h=g?null:Du(f,c),m=g?bh(o,u):null,y=m||{},S=Oh(u,o),C=Oh(u,o,!0),F=this.getFieldLabel(m,u,o),T=yh(u,o),w=T?T.join(d):null;(w==F||s)&&(w=null);var _=y.label2||y.tooltip,M=Sh(s,o),D=s?bh(o,s):null,j=s?D&&D.subfields:o.fields,P=!g&&i,V=this.buildOptions(M,o,j,P,M),L=P?"Please select field":null;return u&&(0,ft.A)(u)==="object"&&(u=void 0),{placeholder:h,items:V,parentField:s,selectedKey:u,selectedKeys:S,selectedPath:C,selectedLabel:F,selectedOpts:y,selectedAltLabel:_,selectedFullLabel:w,errorText:L}}},{key:"getFieldLabel",value:function(t,a,i){if(!a)return null;var o=i.settings.maxLabelsLength,s=Sh(a,i),u=t?.label||su()(s);return u=Du(u,o),u}},{key:"buildOptions",value:function(t,a,i){var o=this,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:void 0,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null,l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:null;if(!i)return null;var c=a.settings,d=c.fieldSeparator,f=c.fieldSeparatorDisplay,p=u!=null&&u.length?u.join(d)+d:"",g=function h(m){return Object.keys(m||{}).reduce(function(y,S){var C=m[S];return C.type==="!struct"?y+h(C.subfields):y+(C.type===s?1:0)},0)};return Gi()(i).map(function(h){var m=[].concat((0,ue.A)(u??[]),[h]),y=i[h],S=o.getFieldLabel(y,m,a),C=yh(m,a),F=C.join(f);(F==S||t!=null&&t.length)&&(F=null);var T=y.label2,w=y.tooltip,_=y.disabled;if(!y.hideForSelect)if(y.type=="!struct"){var M=o.buildOptions(t,a,y.subfields,s,m,{label:S,tooltip:w}),D=g(y.subfields)>0;return{disabled:_,key:h,path:p+h,label:S,fullLabel:F,altLabel:T,tooltip:w,items:M,matchesType:D}}else{var j=s!==void 0?y.type===s:void 0;return{disabled:_,key:h,path:p+h,label:S,fullLabel:F,altLabel:T,tooltip:w,grouplabel:l?.label,group:l,matchesType:j}}}).filter(function(h){return!!h})}},{key:"render",value:function(){var t=this.props,a=t.config,i=t.customProps,o=t.setFieldSrc,s=t.readonly,u=t.id,l=t.groupId,c=a.settings.renderField,d=yC({id:u,groupId:l,config:a,customProps:i,readonly:s,setField:this.setField,setFieldSrc:o},this.meta);return c(d,a.ctx)}}])}(I.Component);Fh.propTypes={id:R().string,groupId:R().string,config:R().object.isRequired,selectedField:R().any,selectedFieldSrc:R().string,selectedFieldType:R().string,parentField:R().string,customProps:R().object,readonly:R().bool,setField:R().func.isRequired,setFieldSrc:R().func};function Ch(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function SC(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ch(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Ch(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function OC(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,Eh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function Eh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Eh=function(){return!!n})()}var FC=Be.clone,Ho=Be.ConfigUtils,CC=Ho.getFieldConfig,wh=Ho.getFuncConfig,EC=Ho.getFieldParts,Ah=Ho.getFieldPathParts,wC=Ho.getWidgetForFieldOp,Th=Be.RuleUtils.getFuncPathLabels,AC=Be.OtherUtils.shallowEqual,_h=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=OC(this,e,[r]),Dr(t),t.onPropsChanged(r),t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){var a=this.props,i=["config","field","fieldType","fieldSrc","operator","isFuncArg","isLHS","parentFuncs"],o=["config","field","fieldType","fieldSrc","value","isLHS"],s=!this.items||i.map(function(l){return l==="parentFuncs"?!AC(t[l],a[l],!0):t[l]!==a[l]}).filter(function(l){return l}).length>0,u=!this.meta||o.map(function(l){return t[l]!==a[l]}).filter(function(l){return l}).length>0;u&&(this.meta=this.getMeta(t)),s&&(this.items=this.getItems(t,this.meta))}},{key:"getItems",value:function(t,a){var i=t.config,o=t.field,s=t.fieldType,u=t.isLHS,l=t.operator,c=t.parentFuncs,d=t.fieldDefinition,f=t.isFuncArg,p=a.lookingForFieldType,g=i.settings.canUseFuncForField,h=this.filterFuncs(i,i.funcs,o,s,u,l,g,c,f,d),m=this.buildOptions(i,h,p);return m}},{key:"getMeta",value:function(t){var a=t.config,i=t._field,o=t.fieldType,s=t.value,u=t.isLHS,l=t.isFuncArg,c=a.settings,d=c.funcPlaceholder,f=c.fieldSeparatorDisplay,p=s,g=!!s,h=g?null:d,m=g?wh(a,p):null,y=m||{},S=Ah(p,a),C=Ah(p,a,!0),F=this.getFuncLabel(m,p,a),T=Th(p,a),w=T?T.join(f):null;w==F&&(w=null);var _=u&&!l,M=_&&!g&&o,D=M?"Please select function":null;return{placeholder:h,selectedKey:p,selectedKeys:S,selectedPath:C,selectedLabel:F,selectedOpts:y,selectedFullLabel:w,errorText:D,lookingForFieldType:M}}},{key:"filterFuncs",value:function(t,a,i,o,s,u,l,c,d,f){a=FC(a);var p=t.settings.fieldSeparator,g=CC(t,i),h=!1,m,y=g,S=wC(t,i,u,"value"),C=S&&t.widgets[S];d?(y=f,m=f?.type):h&&C?m=C.type:g?m=g.type:s||(m=o);function F(T,w){for(var _ in T){var M=T[_].subfields,D=(w||[]).concat(_),j=D.join(p),P=wh(t,j);if(P.type=="!struct")F(M,D)==0&&delete T[_];else{var V,L=!m||P.returnType==m;(V=y)!==null&&V!==void 0&&V.funcs&&(L=L&&y.funcs.includes(j)),l&&(L=L&&l(i,g,j,P,u)),!P.allowSelfNesting&&c&&c.map(function(U){var B=(0,ve.A)(U,2),G=B[0],W=B[1];return G}).includes(j)&&(L=!1),L||delete T[_]}}return Gi()(T).length}return F(a,[]),a}},{key:"buildOptions",value:function(t,a){var i=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!a)return null;var l=t.settings,c=l.fieldSeparator,d=l.fieldSeparatorDisplay,f=s!=null&&s.length?s.join(c)+c:"",p=function g(h){return Object.keys(h||{}).reduce(function(m,y){var S=h[y];return S.type==="!struct"?m+g(S.subfields):m+(S.type===o?1:0)},0)};return Gi()(a).map(function(g){var h=[].concat((0,ue.A)(s??[]),[g]),m=a[g],y=i.getFuncLabel(m,h,t),S=Th(h,t),C=S.join(d);C==y&&(C=null);var F=m.tooltip;if(m.type=="!struct"){var T=i.buildOptions(t,m.subfields,o,h,{label:y,tooltip:F}),w=p(m.subfields)>0;return{key:g,path:f+g,label:y,fullLabel:C,tooltip:F,items:T,matchesType:w}}else{var _=o!==void 0?m.returnType===o:void 0;return{key:g,path:f+g,label:y,fullLabel:C,tooltip:F,grouplabel:u?.label,group:u,matchesType:_}}})}},{key:"getFuncLabel",value:function(t,a,i){if(!a)return null;var o=i.settings.maxLabelsLength,s=EC(a,i),u=t?.label||su()(s);return u=Du(u,o),u}},{key:"render",value:function(){var t=this.props,a=t.config,i=t.customProps,o=t.setValue,s=t.readonly,u=t.id,l=t.groupId,c=a.settings.renderFunc,d=SC({config:a,customProps:i,readonly:s,setField:o,items:this.items,id:u,groupId:l},this.meta);return c(d,a.ctx)}}])}(I.Component);_h.propTypes={id:R().string,groupId:R().string,config:R().object.isRequired,field:R().any,fieldType:R().string,fieldSrc:R().string,operator:R().string,customProps:R().object,value:R().string,setValue:R().func.isRequired,readonly:R().bool,parentFuncs:R().array,fieldDefinition:R().object,isFuncArg:R().bool,isLHS:R().bool};var TC=$(23181),Ic=$.n(TC),_C=["widgetFactory"],LC=["factory"];function Lh(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Dc(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Lh(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Lh(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var Rh=Be.ListUtils.getTitleInListValues,RC=Be.ConfigUtils._widgetDefKeysToOmit,jh=Be.TreeUtils,jC=jh._fixImmutableValue,xC=jh.isImmutable,xh=(0,I.memo)(function(n){var e=n.widgetFactory,r=(0,Qa.A)(n,_C),t=r.config,a=r.isFuncArg,i=r.fieldDefinition,o=i||{},s=o.fieldSettings,u=o.defaultValue,l=o.valueSources,c=a&&l?.length==1&&l?.[0]==="const",d=s?.treeValues||s?.listValues;return c&&u?typeof u=="boolean"?u?r.labelYes||"YES":r.labelNo||"NO":d?Array.isArray(u)?u.map(function(f){return Rh(d,f)||f}).join(", "):Rh(d,u)||u:""+u:e?e(r,t.ctx):"?"});xh.displayName="WidgetFactoryMemo";var Ih=function(e){var r=e.delta,t=e.parentDelta,a=e.isFuncArg,i=e.valueSrc,o=e.value,s=e.valueError,u=e.fieldError,l=e.asyncListValues,c=e.isSpecialRange,d=e.fieldDefinition,f=e.widget,p=e.widgetDefinition,g=e.widgetValueLabel,h=e.valueLabels,m=e.textSeparators,y=e.setValue,S=e.setFuncValue,C=e.config,F=e.field,T=e.fieldSrc,w=e.fieldPath,_=e.fieldType,M=e.isLHS,D=e.operator,j=e.readonly,P=e.parentField,V=e.parentFuncs,L=e.id,U=e.groupId,B=e.widgetId,G=p.factory,W=(0,Qa.A)(p,LC),z=o?o.map(function(oe){return jC(oe)}):void 0,H=(0,I.useMemo)(function(){if(c){var oe=[z?.get(0),z?.get(1)];return oe[0]===void 0&&oe[1]===void 0&&(oe=void 0),oe}return z?.get(r)},[c,o]),q=(0,I.useMemo)(function(){var oe;return s?c?[s.get(0),s.get(1),s.get(2)]:s==null||(oe=s.get)===null||oe===void 0?void 0:oe.call(s,r):null},[c,o]),J=M?u:q,Y=d||{},Z=Y.fieldSettings,se=g.label,re=g.placeholder,ee=h?h.placeholder:null,Fe=xC(F)?null:F,pe=vu()(Dc(Dc(Dc({},W),Z),{},{config:C,field:Fe,fieldPath:w,fieldSrc:T,fieldType:_,isLHS:M,parentField:P,parentFuncs:V,fieldDefinition:d,operator:D,delta:r,parentDelta:t,isSpecialRange:c,isFuncArg:a,value:H,valueSrc:i,valueError:q,fieldError:u,errorMessage:J,label:se,placeholder:re,placeholders:ee,textSeparators:m,setValue:y,setFuncValue:S,readonly:j,asyncListValues:l,id:L,groupId:U,widgetId:B,widgetFactory:G,widget:f}),[].concat((0,ue.A)(RC),["toJS"]));return I.createElement(xh,(0,nt.A)({widgetFactory:G},pe))};Ih.displayName="WidgetFactory";const IC=Ih;function DC(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,Dh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function Dh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Dh=function(){return!!n})()}var Qo=Be.ConfigUtils,PC=Qo.getFieldConfig,NC=Qo.getOperatorConfig,Ph=Qo.getFieldWidgetConfig,Nh=Qo.getWidgetForFieldOp,VC=Qo.getValueSourcesForFieldOp,Nu=Be.RuleUtils.getValueLabel,Vh=Be.DefaultUtils.createListWithOneElement,MC=Be.OtherUtils.shallowEqual,wA=Be.TreeUtils.isImmutable,kC={cardinality:1},Jo=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=DC(this,e,[r]),t._setValue=function(a,i,o,s,u,l){var c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:{};if(c.widgetId||(c.widgetId=s),a&&Array.isArray(u)){var d=[t.props.value.get(0),t.props.value.get(1)];d[0]!=u[0]&&t.props.setValue(0,u[0],o,l,c),d[1]!=u[1]&&t.props.setValue(1,u[1],o,l,c)}else t.props.setValue(i,u,o,l,c)},t._setValueSrc=function(a,i,o){var s={widgetId:i};t.props.setValueSrc(a,o,s)},t.renderWidget=function(a,i,o){var s=o.config,u=o.isFuncArg,l=o.leftField,c=o.operator,d=o.value,f=o.valueError,p=o.fieldError,g=o.readonly,h=o.parentField,m=o.parentFuncs,y=o.id,S=o.groupId,C=o.fieldSrc,F=o.fieldType,T=o.isLHS,w=o.setFuncValue,_=o.parentDelta,M=s.settings,D=i.widgets,j=i.iValues,P=i.aField,V=i.valueSources,L=u?j:d,U=u?l:P,B=D[a],G=B.valueSrc,W=B.valueLabel,z=B.widgetId,H=V.length>1&&!g,q=M.showLabels?I.createElement("label",{key:"label-"+z,className:"rule--label"},W.label):null;return I.createElement("div",{key:"wrapper-"+z,className:nn()(G==="func"?"widget--func":"widget--widget",H?"widget--has-valuesrcs":"widget--has-no-valuesrcs")},G==="func"?null:q,I.createElement(IC,(0,nt.A)({key:z,id:y,groupId:S,widgetId:z,valueSrc:G,delta:a,value:L,valueError:f,fieldError:p,isFuncArg:u,isLHS:T},wn()(i,["isSpecialRange","fieldDefinition","asyncListValues"]),wn()(D[a],["widget","widgetDefinition","widgetValueLabel","valueLabels","textSeparators","setValue"]),{setFuncValue:w,config:s,field:U,fieldSrc:C,fieldType:F,parentField:h,parentFuncs:m,parentDelta:_??a,operator:c,readonly:g})))},t.renderValueSources=function(a,i,o){var s=o.config,u=o.isFuncArg,l=o.leftField,c=o.operator,d=o.readonly,f=s.settings,p=i.valueSources,g=i.widgets,h=i.aField,m=i.valueSourcesOptions,y=u?l:h,S=g[a],C=S.valueSrc,F=S.setValueSrc,T=t.ValueSources,w=f.showLabels?I.createElement("label",{className:"rule--label"},"\xA0"):null;return p.length>1&&!d&&I.createElement("div",{key:"wrapper-valuesrc-"+a,className:"widget--valuesrc"},w,I.createElement(T,{key:"valuesrc-"+a,delta:a,valueSources:m,valueSrc:C,config:s,field:y,operator:c,setValueSrc:F,readonly:d,title:f.valueSourcesPopupTitle}))},t.renderSep=function(a,i,o){var s=o.config,u=i.widgets,l=s.settings,c=u[a].sepText,d=l.showLabels?I.createElement("label",{className:"rule--label"},"\xA0"):null;return c&&I.createElement("div",{key:"widget-separators-"+a,className:nn()("widget--sep",a==0&&"widget--sep-first")},d,I.createElement("span",null,c))},t.renderWidgetDelta=function(a){var i=t.renderSep(a,t.meta,t.props),o=t.renderValueSources(a,t.meta,t.props),s=t.renderWidget(a,t.meta,t.props);return[i,o,s]},Dr(t),t.onPropsChanged(r),t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){var a=this.props,i=!this.ValueSources||a?.config!==t?.config,o=["config","id","parentFuncs","field","fieldId","fieldSrc","fieldType","fieldFunc","fieldArg","leftField","operator","valueSrc","asyncListValues","isLHS","isFuncArg","isForRuleGroup","isCaseValue","value","parentDelta"],s=o.filter(function(d){return d==="parentFuncs"?!MC(t[d],a[d],!0):d==="field"?t.fieldId!==a.fieldId:t[d]!==a[d]}),u=!this.meta||s.length>0;if(u&&(this.meta=this.getMeta(t,s)),i){var l=t.config,c=l.settings.renderValueSources;this.ValueSources=Nr(l,c)}}},{key:"getMeta",value:function(t){var a,i,o,s,u=this,l=t.config,c=t.field,d=t.fieldSrc,f=t.fieldType,p=t.fieldFunc,g=t.fieldArg,h=t.operator,m=t.valueSrc,y=t.value,S=t.isForRuleGroup,C=t.isCaseValue,F=t.isFuncArg,T=t.leftField,w=t.asyncListValues,_=t.parentFuncs,M=t.isLHS,D=t.id,j=t.parentDelta,P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],V=l.settings.valueSourcesInfo,L=F?{func:p,arg:g}:c,U=!c&&f,B=m,G=y;(F||S||C)&&(B=Vh(m),G=Vh(y));var W=PC(l,L);!W&&U&&(W=l.types[f]);var z=Nh(l,L,h);if(!z&&U){var H;z=(H=l.types[f])===null||H===void 0?void 0:H.mainWidget}var q=F?kC:NC(l,h,L);if((W==null||q==null)&&!C)return null;var J=q?.isSpecialRange,Y=J&&(((a=B)===null||a===void 0?void 0:a.get(0))==="field"||((i=B)===null||i===void 0?void 0:i.get(1))==="field"),Z=J&&!Y,se=Z?1:NF(q);if(se===0)return null;var re=(o=this.meta)===null||o===void 0?void 0:o.valueSources,ee=(s=this.meta)===null||s===void 0?void 0:s.valueSourcesOptions,Fe={value:"Value",field:"Field",func:"Function"};(!re||["field","operator","config","fieldDefinition","isForRuleGroup"].filter(function(oe){return P.includes(oe)}).length)&&(re=VC(l,L,h,W),S&&(re=["value"]),L||(re=Object.keys(V)),ee=re.map(function(oe){var Se,he,be;return[oe,{label:(Se=(he=(be=V[oe])===null||be===void 0?void 0:be.label)!==null&&he!==void 0?he:Fe[oe])!==null&&Se!==void 0?Se:oe}]}));var pe=(F?[0]:Ic()(0,se)).map(function(oe){var Se,he,be,Le,Ae=(Se=u.meta)===null||Se===void 0||(Se=Se.widgets)===null||Se===void 0?void 0:Se[oe],ke=((he=B)===null||he===void 0?void 0:he.get(oe))||null,Ve=Nh(l,L,h,ke),Re=Ph(l,L,h,Ve,ke);Y&&(Ve=Re.singleWidget,Re=Ph(l,L,h,Ve,ke)),!Re&&U&&(Ve=["func","field"].includes(ke)?ke:z,Re=l.widgets[Ve]);var Ce=(be=Re)===null||be===void 0?void 0:be.type,jt=Nu(l,L,h,oe,ke,Z),ot=Nu(l,L,h,oe,null,Z),mt=q!=null&&q.textSeparators?q?.textSeparators[oe]:null,Ue=null,Mt=null;J&&(Ue=[Nu(l,L,h,0),Nu(l,L,h,1)],Ue={placeholder:[Ue[0].placeholder,Ue[1].placeholder],label:[Ue[0].label,Ue[1].label]},Mt=q?.textSeparators);var kt=ph({id:D,isLHS:M,delta:j??oe,parentFuncs:_}),ir=kt+":VS",xt=Ae?.setValueSrc;(!xt||Ae?.widgetId!==kt)&&(xt=u._setValueSrc.bind(u,oe,ir));var Xe=Ae?.setValue;return(!Xe||Ae?.widgetId!==kt||Ae?.widgetType!==Ce||((Le=u.meta)===null||Le===void 0?void 0:Le.isSpecialRange)!==J)&&(Xe=u._setValue.bind(u,J,oe,Ce,kt)),{valueSrc:ke,valueLabel:jt,widget:Ve,sepText:mt,widgetDefinition:Re,widgetValueLabel:ot,valueLabels:Ue,textSeparators:Mt,setValueSrc:xt,setValue:Xe,widgetId:kt,widgetType:Ce}});return{defaultWidget:z,fieldDefinition:W,operatorDefinition:q,isSpecialRange:Z,cardinality:se,valueSources:re,valueSourcesOptions:ee,widgets:pe,iValues:G,aField:L,asyncListValues:w}}},{key:"render",value:function(){if(!this.meta)return null;var t=this.meta,a=t.defaultWidget,i=t.cardinality,o=this.meta.isFuncArg;if(!a)return null;var s=a;return I.createElement(Kt,{className:"rule--widget rule--widget--".concat(s.toUpperCase()),key:"widget-col-"+s},(o?[0]:Ic()(0,i)).map(this.renderWidgetDelta))}}])}(I.Component);Jo.propTypes={config:R().object.isRequired,value:R().any,valueSrc:R().any,valueError:R().any,fieldError:R().string,field:R().any,fieldSrc:R().string,fieldType:R().string,fieldId:R().string,operator:R().string,readonly:R().bool,asyncListValues:R().array,id:R().string,groupId:R().string,setValue:R().func,setValueSrc:R().func,setFuncValue:R().func,isFuncArg:R().bool,fieldFunc:R().string,fieldArg:R().string,leftField:R().any,isForRuleGroup:R().bool,parentField:R().string,parentFuncs:R().array,isLHS:R().bool,parentDelta:R().number,isCaseValue:R().bool};function Mh(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,kh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function kh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(kh=function(){return!!n})()}var GC=Be.ConfigUtils.getFuncConfig,Gh=Be.OtherUtils.shallowEqual,Pc=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=Mh(this,e,[r]),t.setFunc=function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=t.props,s=o.isLHS,u=o.parentDelta,l=o.parentFuncs,c=o.id;if(!i.widgetId){var d=ph({id:c,isLHS:s,delta:u,parentFuncs:l});i.widgetId=d}t.props.setFuncValue(s?-1:u||0,l,null,a,"!func",void 0,i)},t.setArgValue=function(a,i,o,s,u){var l=t.props,c=l.config,d=l.parentDelta,f=l.isLHS,p=l.parentFuncs;t.props.setFuncValue(f?-1:d||0,p,a,i,o,s,u)},t.setArgValueSrc=function(a,i,o){var s=t.props,u=s.config,l=s.parentDelta,c=s.isLHS,d=s.parentFuncs;t.props.setFuncValue(c?-1:l||0,d,a,i,"!valueSrc",void 0,o)},t.renderFuncSelect=function(){var a,i,o=t.props,s=o.config,u=o.field,l=o.fieldType,c=o.fieldSrc,d=o.isLHS,f=o.operator,p=o.customProps,g=o.value,h=o.readonly,m=o.parentFuncs,y=o.id,S=o.groupId,C=o.isFuncArg,F=o.fieldDefinition,T=o.parentDelta,w=(a=g==null||(i=g.get)===null||i===void 0?void 0:i.call(g,"func"))!==null&&a!==void 0?a:null,_={value:w,setValue:t.setFunc,config:s,field:u,fieldType:l,fieldSrc:c,isLHS:d,operator:f,customProps:p,readonly:h,parentFuncs:m,isFuncArg:C,fieldDefinition:F,id:y,groupId:S},M=s.settings,D=M.showLabels,j=M.funcLabel,P=D?I.createElement("label",{className:"rule--label"},j):null;return I.createElement(Kt,{key:"func",className:"rule--func"},P,I.createElement(_h,_))},t.renderArgLabel=function(a,i){var o=i.valueSources,s=i.type,u=i.showPrefix,l=i.label,c=t.props.config,d=o&&o.length==1&&o[0]=="const",f=!c.settings.showLabels&&(s=="boolean"||d)&&u;return f?I.createElement(Kt,{className:"rule--func--arg-label"},l||a):null},t.renderArgLabelSep=function(a,i){var o=i.valueSources,s=i.type,u=i.showPrefix,l=t.props.config,c=o&&o.length==1&&o[0]=="const",d=!l.settings.showLabels&&(s=="boolean"||c)&&u;return d?I.createElement(Kt,{className:"rule--func--arg-label-sep"},":"):null},t.renderArgVal=function(a,i,o){var s=t.props,u=s.config,l=s.field,c=s.fieldType,d=s.fieldSrc,f=s.isLHS,p=s.operator,g=s.value,h=s.readonly,m=s.parentFuncs,y=s.id,S=s.groupId,C=s.fieldError,F=s.valueError,T=s.setFuncValue,w=s.parentDelta,_=g?g.getIn(["args",i]):null,M=_?_.get("value"):void 0,D=o.valueSources.length==1?o.valueSources[0]:void 0,j=_?_.get("valueSrc")||D||"value":D,P=_?.get("asyncListValues"),V={config:u,fieldFunc:a,fieldArg:i,leftField:l,fieldType:c,fieldSrc:d,fieldError:C,valueError:F,isLHS:f,operator:null,value:M,valueSrc:j,asyncListValues:P,setValue:t.setArgValue,setValueSrc:t.setArgValueSrc,setFuncValue:T,funcKey:a,argKey:i,argDefinition:o,readonly:h,parentFuncs:m,id:y,groupId:S,parentDelta:w};return I.createElement(Kt,{className:"rule--func--arg-value"},I.createElement($h,V))},t.renderArgSep=function(a,i,o,s){var u=s.renderSeps;return o?I.createElement(Kt,{className:"rule--func--arg-sep"},u?u[o-1]:", "):null},t.renderBracketBefore=function(a){var i=a.renderBrackets;return I.createElement(Kt,{key:"before_args",className:"rule--func--bracket-before"},i?i[0]:"(")},t.renderBracketAfter=function(a){var i=a.renderBrackets;return I.createElement(Kt,{key:"after_args",className:"rule--func--bracket-after"},i?i[1]:")")},t.renderFuncArgs=function(){var a=t.meta,i=a.funcDefinition,o=a.funcKey;if(!o)return null;var s=i||{},u=s.args;return u?I.createElement(I.Fragment,null,t.renderBracketBefore(i),I.createElement(Kt,{key:"args-".concat(o),className:"rule--func--args rule--func--".concat(o,"--args")},Object.keys(u).map(function(l,c){return I.createElement(Kt,{key:"arg-".concat(l,"-").concat(c),className:"rule--func--arg rule--func--".concat(o,"--arg--").concat(l)},t.renderArgSep(l,u[l],c,i),t.renderArgLabel(l,u[l]),t.renderArgLabelSep(l,u[l]),t.renderArgVal(o,l,u[l]))})),t.renderBracketAfter(i)):null},Dr(t),t.onPropsChanged(r),t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){var a=this.props,i=["config","field","operator","value","fieldSrc","fieldType","isLHS"],o=!this.meta||i.map(function(s){return s==="parentFuncs"?!Gh(t[s],a[s],!0):t[s]!==a[s]}).filter(function(s){return s}).length>0;o&&(this.meta=this.getMeta(t))}},{key:"getMeta",value:function(t){var a,i,o=t.config,s=t.field,u=t.operator,l=t.value,c=(a=l==null||(i=l.get)===null||i===void 0?void 0:i.call(l,"func"))!==null&&a!==void 0?a:null,d=c?GC(o,c):null;return{funcDefinition:d,funcKey:c}}},{key:"render",value:function(){var t=this.props.parentFuncs,a=t?t.map(function(o){var s=(0,ve.A)(o,2),u=s[0],l=s[1];return"".concat(u,"_").concat(l)}).join("-"):"root",i=t?.length||0;return I.createElement(Kt,{className:"rule--func--wrapper rule--func--wrapper--under-".concat(a," rule--func--wrapper--lev-").concat(i)},this.renderFuncSelect(),this.renderFuncArgs())}}])}(I.Component);Pc.propTypes={id:R().string,groupId:R().string,config:R().object.isRequired,field:R().any,fieldSrc:R().string,fieldType:R().string,fieldError:R().string,operator:R().string,customProps:R().object,value:R().object,setValue:R().func.isRequired,setFuncValue:R().func,readonly:R().bool,parentFuncs:R().array,parentDelta:R().number,fieldDefinition:R().object,isFuncArg:R().bool,isLHS:R().bool,valueError:R().string};var $h=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=Mh(this,e,[r]),t.setValue=function(a,i,o,s,u){var l=t.props,c=l.setValue,d=l.argKey;c(d,i,o,s,u)},t.setValueSrc=function(a,i,o){var s=t.props,u=s.setValueSrc,l=s.argKey;u(l,i,o)},Dr(t),t.onPropsChanged(r),t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){var a=this.props,i=["parentFuncs","funcKey","argKey"],o=!this.meta||i.map(function(s){return s==="parentFuncs"?!Gh(t[s],a[s],!0):t[s]!==a[s]}).filter(function(s){return s}).length>0;o&&(this.meta=this.getMeta(t))}},{key:"getMeta",value:function(t){var a=t.parentFuncs,i=t.funcKey,o=t.argKey,s=[].concat((0,ue.A)(a||[]),[[i,o]]);return{parentFuncs:s}}},{key:"render",value:function(){var t=this.meta.parentFuncs;return I.createElement(Jo,(0,nt.A)({},this.props,{parentDelta:this.props.parentDelta,setValue:this.setValue,setValueSrc:this.setValueSrc,isFuncArg:!0,parentFuncs:t}))}}])}(I.Component);$h.propTypes={funcKey:R().string.isRequired,argKey:R().string.isRequired,setValue:R().func.isRequired,setValueSrc:R().func.isRequired,readonly:R().bool,isLHS:R().bool,parentFuncs:R().array,id:R().string,groupId:R().string};function $C(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,Uh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function Uh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Uh=function(){return!!n})()}var Nc=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=$C(this,e,[r]),t.renderField=function(){var a=t.props,i=a.config,o=a.classname,s=a.selectedField,u=a.selectedFieldSrc,l=a.selectedFieldType,c=a.setField,d=a.setFuncValue,f=a.parentField,p=a.readonly,g=a.id,h=a.groupId,m=a.fieldError,y=a.valueError,S=["func","field"];if(!S.includes(u))return"?";var C=u==="func"?I.createElement(Pc,{isLHS:!0,config:i,value:s,fieldSrc:u,fieldType:l,fieldError:m,valueError:y,parentField:f,setValue:c,setFuncValue:d,readonly:p,id:g,groupId:h,key:"field-func-"+g}):I.createElement(Fh,{config:i,selectedField:s,selectedFieldSrc:u,selectedFieldType:l,parentField:f,setField:c,customProps:i.settings.customFieldSelectProps,readonly:p,id:g,groupId:h,key:"field-"+g}),F=u==="func"?i.settings.funcLabel:i.settings.fieldLabel,T=i.settings.showLabels&&u!=="func"&&I.createElement("label",{className:"rule--label"},F);return I.createElement("div",{key:u,className:o},T,C)},t.renderFieldSources=function(){if(!t.meta)return null;var a=t.props,i=a.config,o=a.readonly,s=a.selectedFieldSrc,u=a.setFieldSrc,l=a.id,c=t.meta.fieldSourcesOptions,d=i.settings,f=t.ValueSources,p=d.showLabels?I.createElement("label",{className:"rule--label"},"\xA0"):null;return c.length>1&&!o&&I.createElement("div",{key:"fieldsrc",className:"rule--fieldsrc"},p,I.createElement(f,{key:"fieldsrc-"+l,valueSources:c,valueSrc:s,config:i,setValueSrc:u,readonly:o,title:d.fieldSourcesPopupTitle}))},Dr(t),t.onPropsChanged(r),t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){var a=this.props,i=!this.ValueSources||a?.config!==t?.config,o=["config"],s=!this.meta||o.map(function(c){return t[c]!==a[c]}).filter(function(c){return c}).length>0;if(s&&(this.meta=this.getMeta(t)),i){var u=t.config,l=u.settings.renderValueSources;this.ValueSources=function(c){return l(c,u.ctx)}}}},{key:"getMeta",value:function(t){var a=t.config,i={value:"Value",field:"Field",func:"Function"},o=a.settings,s=o.valueSourcesInfo,u=o.fieldSources,l=u.map(function(c){var d,f,p;return[c,{label:(d=(f=(p=s[c])===null||p===void 0?void 0:p.label)!==null&&f!==void 0?f:i[c])!==null&&d!==void 0?d:c}]});return{fieldSourcesOptions:l}}},{key:"render",value:function(){var t=this.props,a=t.classname,i=t.canSelectFieldSource,o=i&&this.renderFieldSources(),s=this.renderField();return i?I.createElement(Kt,{className:"rule--field-wrapper"},o,s):s}}])}(I.Component),UC=["factory"];function BC(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,Bh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function Bh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Bh=function(){return!!n})()}var WC=Be.ConfigUtils.getOperatorConfig,Wh=function(n){function e(){return(0,Ie.A)(this,e),BC(this,e,arguments)}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"render",value:function(){if(!this.props.selectedOperator)return null;var t=WC(this.props.config,this.props.selectedOperator,this.props.selectedField);if(typeof t.options>"u")return null;var a=t.options,i=a.factory,o=(0,Qa.A)(a,UC),s=Object.assign({},o,{config:this.props.config,field:this.props.selectedField,fieldSrc:this.props.selectedFieldSrc,operator:this.props.selectedOperator,options:this.props.operatorOptions,setOption:this.props.setOperatorOption,readonly:this.props.readonly}),u=i(s,this.props.config.ctx),l=this.props.selectedOperator;return I.createElement("div",{className:"rule--operator rule--operator--".concat(l.toUpperCase())},u)}}])}(I.PureComponent);Wh.propTypes={config:R().object.isRequired,operatorOptions:R().any.isRequired,selectedField:R().any,selectedFieldSrc:R().string,selectedOperator:R().string.isRequired,readonly:R().bool,setOperatorOption:R().func.isRequired};function zh(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function qh(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?zh(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):zh(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function zC(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,Hh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function Hh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Hh=function(){return!!n})()}var Vu=Be.ConfigUtils,qC=Vu.getFieldConfig,HC=Vu.getOperatorConfig,QC=Vu.getFieldWidgetConfig,JC=Vu.getFieldId,YC=Be.RuleUtils.isEmptyRuleProperties,Qh=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=zC(this,e,[r]),Dr(t),t.removeSelf=t.removeSelf.bind(t),t.setLock=t.setLock.bind(t),t.onPropsChanged(r),t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){var a=this,i=this.props,o=!this.Icon||i?.config!==t?.config,s=["selectedField","selectedFieldSrc","selectedFieldType","selectedOperator","config","reordableNodesCnt","isLocked","parentField","parentFieldCanReorder"],u=!this.meta||s.map(function(S){return t[S]!==i[S]}).filter(function(S){return S}).length>0;if(u&&(this.meta=this.getMeta(t)),o){var l=t.config,c=l.settings,d=c.renderIcon,f=c.renderButton,p=c.renderButtonGroup,g=c.renderSwitch,h=c.renderBeforeWidget,m=c.renderAfterWidget,y=c.renderRuleError;this.Icon=Nr(l,d),this.Btn=Nr(l,f),this.BtnGrp=Nr(l,p),this.Switch=Nr(l,g),this.BeforeWidget=Nr(l,h),this.AfterWidget=Nr(l,m),this.RuleError=Nr(l,y)}this.doRemove=function(){a.props.removeSelf()}}},{key:"getMeta",value:function(t){var a=t.selectedField,i=t.selectedFieldType,o=t.selectedOperator,s=t.config,u=t.reordableNodesCnt,l=t.isLocked,c=t.parentField,d=t.parentFieldCanReorder,f=s.settings.keepInputOnChangeFieldSrc,p=JC(a,s),g=qC(s,a),h=g&&g.type==="!struct",m=f&&i,y=!!a||m,S=y&&o,C=HC(s,o,a),F=C&&C.options!=null,T=QC(s,a,o,null,null)||{},w=T.hideOperator,_=s.settings.canReorder&&u>1&&!l;c&&(_=_&&d);var M=y&&!w,D=y&&w&&T.operatorInlineLabel,j=S&&!h,P=S&&F;return{selectedFieldId:p,selectedFieldWidgetConfig:T,showDragIcon:_,showOperator:M,showOperatorLabel:D,showWidget:j,showOperatorOptions:P}}},{key:"setLock",value:function(t){this.props.setLock(t)}},{key:"removeSelf",value:function(){var t=this.props,a=t.confirmFn,i=t.config,o=i.settings,s=o.renderConfirm,u=o.removeRuleConfirmOptions;u&&!this.isEmptyCurrentRule()?s.call(i.ctx,qh(qh({},u),{},{onOk:this.doRemove,onCancel:null,confirmFn:a}),i.ctx):this.doRemove()}},{key:"_buildWidgetProps",value:function(t,a){var i=t.selectedField,o=t.selectedFieldSrc,s=t.selectedFieldType,u=t.selectedOperator,l=t.operatorOptions,c=t.value,d=t.valueType,f=t.valueSrc,p=t.asyncListValues,g=t.valueError,h=t.fieldError,m=t.parentField,y=a.selectedFieldId;return{field:i,fieldSrc:o,fieldType:s,fieldId:y,operator:u,operatorOptions:l,value:c,valueType:d,valueSrc:f,asyncListValues:p,valueError:g,fieldError:h,parentField:m}}},{key:"isEmptyCurrentRule",value:function(){var t=this.props.config,a=this._buildWidgetProps(this.props,this.meta);return YC(a,t)}},{key:"renderField",value:function(){var t=this.props,a=t.config,i=t.isLocked,o=t.parentField,s=t.groupId,u=t.id,l=t.selectedFieldSrc,c=t.selectedField,d=t.selectedFieldType,f=t.setField,p=t.setFuncValue,g=t.setFieldSrc,h=t.fieldError,m=a.settings.immutableFieldsMode,y=this.meta.selectedFieldId;return I.createElement(Nc,{key:"field",classname:nn()(l=="func"?"rule--field--func":"rule--field"),config:a,canSelectFieldSource:!o,selectedField:c,selectedFieldSrc:l,selectedFieldType:d,selectedFieldId:y,fieldError:h,setField:m?Pr:f,setFuncValue:m?Pr:p,setFieldSrc:m?Pr:g,parentField:o,readonly:m||i,id:u,groupId:s})}},{key:"renderOperator",value:function(){var t=this.props,a=t.config,i=t.isLocked,o=this.meta,s=o.selectedFieldId,u=o.selectedFieldWidgetConfig,l=o.showOperator,c=o.showOperatorLabel,d=a.settings.immutableOpsMode;return I.createElement(gh,{key:"operator",config:a,selectedField:this.props.selectedField,selectedFieldSrc:this.props.selectedFieldSrc,selectedFieldType:this.props.selectedFieldType,selectedFieldId:s,selectedOperator:this.props.selectedOperator,setOperator:d?Pr:this.props.setOperator,showOperator:l,showOperatorLabel:c,selectedFieldWidgetConfig:u,readonly:d||i,id:this.props.id,groupId:this.props.groupId})}},{key:"renderWidget",value:function(){var t=this.props,a=t.config,i=t.isLocked,o=this.meta.showWidget,s=a.settings.immutableValuesMode;if(!o)return null;var u=I.createElement(Jo,(0,nt.A)({key:"values"},this._buildWidgetProps(this.props,this.meta),{config:a,setValue:s?Pr:this.props.setValue,setValueSrc:s?Pr:this.props.setValueSrc,setFuncValue:s?Pr:this.props.setFuncValue,readonly:s||i,id:this.props.id,groupId:this.props.groupId}));return I.createElement(Kt,{key:"widget-for-"+this.props.selectedOperator,className:"rule--value"},u)}},{key:"renderOperatorOptions",value:function(){var t=this.props.config,a=this.meta.showOperatorOptions,i=t.settings,o=i.immutableOpsMode,s=i.immutableValuesMode;if(!a)return null;var u=I.createElement(Wh,{key:"operatorOptions",selectedField:this.props.selectedField,selectedOperator:this.props.selectedOperator,operatorOptions:this.props.operatorOptions,setOperatorOption:o?Pr:this.props.setOperatorOption,config:t,readonly:s});return I.createElement(Kt,{key:"op-options-for-"+this.props.selectedOperator,className:"rule--operator-options"},u)}},{key:"renderBeforeWidget",value:function(){var t=this.BeforeWidget;return t?I.createElement(Kt,{key:"before-widget-for-"+this.props.selectedOperator,className:"rule--before-widget"},I.createElement(t,this.props)):null}},{key:"renderAfterWidget",value:function(){var t=this.AfterWidget;return t?I.createElement(Kt,{key:"after-widget-for-"+this.props.selectedOperator,className:"rule--after-widget"},I.createElement(t,this.props)):null}},{key:"renderError",value:function(){var t=this.props,a=t.config,i=t.valueError,o=t.fieldError,s=a.settings.showErrorMessage,u=this.RuleError,l=[o].concat((0,ue.A)(i?.toArray()||[])).filter(function(c){return!!c}).shift()||null;return s&&l&&I.createElement("div",{className:"rule--error"},u?I.createElement(u,{error:l}):l)}},{key:"renderDrag",value:function(){var t=this.props.handleDraggerMouseDown,a=this.meta.showDragIcon,i=this.Icon,o=I.createElement(i,{type:"drag"});return a&&I.createElement("div",{key:"rule-drag-icon",onMouseDown:t,className:"qb-drag-handler rule--drag-handler"},o)}},{key:"renderDel",value:function(){var t=this.props,a=t.config,i=t.isLocked,o=a.settings,s=o.deleteLabel,u=o.immutableGroupsMode,l=o.canDeleteLocked,c=this.Icon,d=this.Btn;return!u&&(!i||i&&l)&&I.createElement(d,{key:"rule-del",type:"delRule",onClick:this.removeSelf,label:s,config:a,renderIcon:c})}},{key:"renderLock",value:function(){var t=this.props,a=t.config,i=t.isLocked,o=t.isTrueLocked,s=t.id,u=a.settings,l=u.lockLabel,c=u.lockedLabel,d=u.showLock,f=this.Switch;return d&&!(i&&!o)&&I.createElement(f,{key:"rule-lock",type:"lock",id:s,value:i,setValue:this.setLock,label:l,checkedLabel:c,hideLabel:!0,config:a})}},{key:"render",value:function(){var t=this.meta,a=t.showOperatorOptions,i=t.selectedFieldWidgetConfig,o=this.props,s=o.valueSrc,u=o.value,l=o.config,c=s?.first()=="value"&&!a&&u.size==1&&i.fullWidth,d=this.BtnGrp,f=[this.renderField(),this.renderOperator(),this.renderBeforeWidget(),this.renderWidget(),this.renderAfterWidget(),this.renderOperatorOptions()],p=I.createElement("div",{key:"rule-body",className:nn()("rule--body",c&&"can--shrink--value")},f),g=this.renderError(),h=this.renderDrag(),m=this.renderLock(),y=this.renderDel();return I.createElement(I.Fragment,null,h,I.createElement("div",{key:"rule-body-wrapper",className:"rule--body--wrapper"},p,g),I.createElement("div",{key:"rule-header-wrapper",className:"rule--header"},I.createElement(d,{key:"rule-header-group",config:l},m,y)))}}])}(I.Component);Qh.propTypes={id:R().string.isRequired,groupId:R().string,selectedField:R().any,selectedFieldSrc:R().string,selectedFieldType:R().string,selectedOperator:R().string,operatorOptions:R().object,config:R().object.isRequired,value:R().any,valueSrc:R().any,valueType:R().any,asyncListValues:R().array,isDraggingMe:R().bool,isDraggingTempo:R().bool,parentField:R().string,valueError:R().any,fieldError:R().string,isLocked:R().bool,isTrueLocked:R().bool,handleDraggerMouseDown:R().func,setField:R().func,setFieldSrc:R().func,setOperator:R().func,setOperatorOption:R().func,setLock:R().func,removeSelf:R().func,setValue:R().func,setValueSrc:R().func,setFuncValue:R().func,reordableNodesCnt:R().number,totalRulesCnt:R().number,parentReordableNodesCnt:R().number,parentFieldCanReorder:R().bool};const KC=rC(ki("rule")($i(Qh)));var XC=$(22331),ZC=$.n(XC);function eE(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,Jh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function Jh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Jh=function(){return!!n})()}var tE=Be.DefaultUtils.defaultGroupConjunction,Yh=Be.ConfigUtils.getFieldConfig,rE=function(e,r){var t;return t=function(a){function i(o){var s;return(0,Ie.A)(this,i),s=eE(this,i,[o]),s._selectedConjunction=function(u){return u=u||s.props,u.conjunction||tE(u.config,u.field)},s.setConjunction=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;s.props.actions.setConjunction(s.props.path,u)},s.setNot=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;s.props.actions.setNot(s.props.path,u)},s.setLock=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;s.props.actions.setLock(s.props.path,u)},s.dummyFn=function(){},s.removeSelf=function(){s.props.actions.removeGroup(s.props.path)},s.addGroup=function(){var u=r=="rule_group"?s.props.field:s.props.parentField;s.props.actions.addGroup(s.props.path,void 0,void 0,u)},s.addCaseGroup=function(){s.props.actions.addCaseGroup(s.props.path)},s.addDefaultCaseGroup=function(){s.props.actions.addDefaultCaseGroup(s.props.path)},s.addRule=function(){var u=r=="rule_group"?s.props.field:s.props.parentField;s.props.actions.addRule(s.props.path,void 0,void 0,void 0,u)},s.setField=function(u,l,c){s.props.actions.setField(s.props.path,u,l,c)},s.setOperator=function(u){s.props.actions.setOperator(s.props.path,u)},s.setValue=function(u,l,c,d,f){s.props.actions.setValue(s.props.path,u,l,c,d,f)},s.setValueSrc=function(u,l,c){s.props.actions.setValueSrc(s.props.path,u,l,c)},s.setFuncValue=function(u,l,c,d,f,p,g){s.props.actions.setFuncValue(s.props.path,u,l,c,d,f,p,g)},s.pureShouldComponentUpdate=Mi(s),Dr(s),s.selectedConjunction=s._selectedConjunction(o),s.conjunctionOptions=s._getConjunctionOptions(o),s.dummyFn.isDummyFn=!0,s}return(0,it.A)(i,a),(0,Ke.A)(i,[{key:"shouldComponentUpdate",value:function(s,u){var l=this.props,c=this.state,d=this.pureShouldComponentUpdate(s,u);if(d&&c==u&&l!=s){var f=s.dragging.id||l.dragging.id,p=f==s.id,g=[];for(var h in s){var m=s[h]!=l[h];h=="dragging"&&!p&&(m=!1),m&&g.push(h)}g.length||(d=!1)}return d}},{key:"onPropsChanged",value:function(s){var u=s.config,l=s.id,c=s.conjunction,d=this.props.config,f=this.props.conjunction;(d!=u||f!=c)&&(this.selectedConjunction=this._selectedConjunction(s),this.conjunctionOptions=this._getConjunctionOptions(s))}},{key:"_getConjunctionOptions",value:function(s){var u=this;return Lu()(s.config.conjunctions,function(l,c){return{id:"conjunction-".concat(s.id,"-").concat(c),name:"conjunction[".concat(s.id,"]"),key:c,label:l.label,checked:c===u._selectedConjunction(s)}})}},{key:"render",value:function(){var s=this.props.config.settings.showErrorMessage,u=this.props.dragging.id==this.props.id,l=this.props.path.size,c=this.props.config.settings.maxNesting,d=l==1;if(this.props.parentField&&this.props.parentFieldPathSize){var f=Yh(this.props.config,this.props.parentField);l=this.props.path.size-this.props.parentFieldPathSize+1,c=f?.maxNesting,d=!1}else if(this.props.field){var p=Yh(this.props.config,this.props.field);l=1,c=p?.maxNesting,d=!1}var g=!u&&this.props.isDraggingTempo,h=this.props.fieldType||null,m=this.props.valueError,y=(0,ue.A)(m?.toArray()||[]).filter(function(T){return!!T}).shift()||null,S=y!=null&&s,C=typeof c>"u"||l<c,F=c&&l>c;return I.createElement("div",{className:nn()("group-or-rule-container","group-container",S?"group-with-error":null),"data-id":this.props.id},[u?I.createElement(e,{key:"dragging",id:this.props.id,groupId:this.props.groupId,isDraggingMe:!0,isDraggingTempo:!0,dragging:this.props.dragging,isRoot:d,lev:this.props.path.size-1,allowFurtherNesting:C,isMaxNestingExceeded:F,conjunctionOptions:this.conjunctionOptions,not:this.props.not,selectedConjunction:this.selectedConjunction,setConjunction:this.dummyFn,setNot:this.dummyFn,setLock:this.dummyFn,removeSelf:this.dummyFn,addGroup:this.dummyFn,addCaseGroup:this.dummyFn,addDefaultCaseGroup:this.dummyFn,addRule:this.dummyFn,setField:this.dummyFn,setFuncValue:this.dummyFn,setOperator:this.dummyFn,setValue:this.dummyFn,setValueSrc:this.dummyFn,value:this.props.value||null,valueError:this.props.valueError||null,valueSrc:this.props.valueSrc||null,config:this.props.config,children1:this.props.children1,actions:this.props.actions,reordableNodesCnt:this.props.reordableNodesCnt,totalRulesCnt:this.props.totalRulesCnt,selectedField:this.props.field||null,selectedFieldSrc:this.props.fieldSrc||"field",selectedFieldType:h,parentField:this.props.parentField||null,parentFieldPathSize:this.props.parentFieldPathSize,parentFieldCanReorder:this.props.parentFieldCanReorder,selectedOperator:this.props.operator||null,isLocked:this.props.isLocked,isTrueLocked:this.props.isTrueLocked,parentReordableNodesCnt:this.props.parentReordableNodesCnt}):null,I.createElement(e,{key:this.props.id,id:this.props.id,groupId:this.props.groupId,isDraggingMe:u,isDraggingTempo:g,onDragStart:this.props.onDragStart,isRoot:d,lev:this.props.path.size-1,allowFurtherNesting:C,isMaxNestingExceeded:F,conjunctionOptions:this.conjunctionOptions,not:this.props.not,selectedConjunction:this.selectedConjunction,setConjunction:g?this.dummyFn:this.setConjunction,setNot:g?this.dummyFn:this.setNot,setLock:g?this.dummyFn:this.setLock,removeSelf:g?this.dummyFn:this.removeSelf,addGroup:g?this.dummyFn:this.addGroup,addCaseGroup:g?this.dummyFn:this.addCaseGroup,addDefaultCaseGroup:g?this.dummyFn:this.addDefaultCaseGroup,addRule:g?this.dummyFn:this.addRule,setField:g?this.dummyFn:this.setField,setFuncValue:g?this.dummyFn:this.setFuncValue,setOperator:g?this.dummyFn:this.setOperator,setValue:g?this.dummyFn:this.setValue,setValueSrc:g?this.dummyFn:this.setValueSrc,value:this.props.value||null,valueError:this.props.valueError||null,valueSrc:this.props.valueSrc||null,config:this.props.config,children1:this.props.children1,actions:this.props.actions,reordableNodesCnt:this.props.reordableNodesCnt,totalRulesCnt:this.props.totalRulesCnt,selectedField:this.props.field||null,selectedFieldSrc:this.props.fieldSrc||"field",selectedFieldType:h,parentField:this.props.parentField||null,parentFieldPathSize:this.props.parentFieldPathSize,parentFieldCanReorder:this.props.parentFieldCanReorder,selectedOperator:this.props.operator||null,isLocked:this.props.isLocked,isTrueLocked:this.props.isTrueLocked,parentReordableNodesCnt:this.props.parentReordableNodesCnt})])}}])}(I.Component),t.propTypes={config:R().object.isRequired,actions:R().object.isRequired,path:R().any.isRequired,id:R().string.isRequired,groupId:R().string,not:R().bool,conjunction:R().string,children1:R().any,onDragStart:R().func,reordableNodesCnt:R().number,field:R().any,fieldSrc:R().string,fieldType:R().string,parentField:R().string,value:R().any,valueSrc:R().any,valueError:R().any,isLocked:R().bool,isTrueLocked:R().bool,dragging:R().object,isDraggingTempo:R().bool},t};const Yo=function(n,e){var r=ju(function(t){return{dragging:t.dragging}},null,null,{context:qo})(rE(n,e));return r.displayName="ConnectedGroupContainer",r};function nE(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,Kh()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function Kh(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Kh=function(){return!!n})()}var aE={topLeft:"group--actions--tl",topCenter:"group--actions--tc",topRight:"group--actions--tr",bottomLeft:"group--actions--bl",bottomCenter:"group--actions--bc",bottomRight:"group--actions--br"},iE="topRight",Xh=function(n){function e(){return(0,Ie.A)(this,e),nE(this,e,arguments)}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"render",value:function(){var t=this.props,a=t.config,i=t.addRule,o=t.addGroup,s=t.removeSelf,u=t.setLock,l=t.isLocked,c=t.isTrueLocked,d=t.id,f=t.parentField,p=t.canAddGroup,g=t.canAddRule,h=t.canDeleteGroup,m=a.settings,y=m.immutableGroupsMode,S=m.addRuleLabel,C=m.addGroupLabel,F=m.addSubRuleLabel,T=m.addSubGroupLabel,w=m.delGroupLabel,_=m.groupActionsPosition,M=m.renderButton,D=m.renderIcon,j=m.renderSwitch,P=m.renderButtonGroup,V=m.lockLabel,L=m.lockedLabel,U=m.showLock,B=m.canDeleteLocked,G=function(ee){return D(ee,a.ctx)},W=function(ee){return M(ee,a.ctx)},z=function(ee){return j(ee,a.ctx)},H=function(ee){return P(ee,a.ctx)},q=aE[_||iE],J=U&&!(l&&!c)&&I.createElement(z,{type:"lock",id:d,value:l,setValue:u,label:V,checkedLabel:L,config:a}),Y=!y&&g&&!l&&I.createElement(W,{type:f?"addSubRule":"addRule",onClick:i,label:f?F:S,readonly:l,config:a,renderIcon:G}),Z=!y&&p&&!l&&I.createElement(W,{type:f?"addSubGroup":"addGroup",onClick:o,label:f?T:C,readonly:l,config:a,renderIcon:G}),se=!y&&h&&(!l||l&&B)&&I.createElement(W,{type:"delGroup",onClick:s,label:w,config:a,renderIcon:G});return I.createElement("div",{className:"group--actions ".concat(q)},I.createElement(H,{config:a},J,Y,Z,se))}}])}(I.PureComponent);function oE(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=sE(n))||e&&n&&typeof n.length=="number"){r&&(n=r);var t=0,a=function(){};return{s:a,n:function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,o=!1,s;return{s:function(){r=r.call(n)},n:function(){var l=r.next();return i=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function sE(n,e){if(n){if(typeof n=="string")return Zh(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);if(r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set")return Array.from(n);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zh(n,e)}}function Zh(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function em(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function tm(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?em(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):em(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function uE(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,rm()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function rm(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rm=function(){return!!n})()}var Vc=Be.ConfigUtils.getFieldConfig,lE=Be.RuleUtils.isEmptyGroupChildren,nm=Be.TreeUtils,AA=nm.getTotalReordableNodesCountInTree,cE=nm.getTotalRulesCountInTree,dE="topRight",In=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=uE(this,e,[r]),t.childrenClassName=function(){return""},t.renderBeforeActions=function(){var a=t.BeforeActions;return a==null?null:I.createElement(a,(0,nt.A)({key:"group-actions-before"},t.props))},t.renderAfterActions=function(){var a=t.AfterActions;return a==null?null:I.createElement(a,(0,nt.A)({key:"group-actions-after"},t.props))},Dr(t),t.onPropsChanged(r),t.removeSelf=t.removeSelf.bind(t),t.setLock=t.setLock.bind(t),t.renderItem=t.renderItem.bind(t),t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){var a=this,i=this.props,o=!this.Icon||i?.config!==t?.config;if(o){var s=t.config,u=s.settings,l=u.renderIcon,c=u.renderConjs,d=u.renderBeforeActions,f=u.renderAfterActions;this.Icon=Nr(s,l),this.Conjs=Nr(s,c),this.BeforeActions=Nr(s,d),this.AfterActions=Nr(s,f)}this.doRemove=function(){a.props.removeSelf()}}},{key:"isGroupTopPosition",value:function(){return ZC()(this.props.config.settings.groupActionsPosition||dE,"top")}},{key:"setLock",value:function(t){this.props.setLock(t)}},{key:"removeSelf",value:function(){var t=this.props,a=t.confirmFn,i=t.config,o=i.settings,s=o.renderConfirm,u=o.removeGroupConfirmOptions;u&&!this.isEmptyCurrentGroup()?s.call(i.ctx,tm(tm({},u),{},{onOk:this.doRemove,onCancel:null,confirmFn:a}),i.ctx):this.doRemove()}},{key:"isEmptyCurrentGroup",value:function(){var t=this.props,a=t.children1,i=t.config;return lE(a,i)}},{key:"showNot",value:function(){var t=this.props,a=t.config,i=t.parentField,o=a.settings.showNot;if(i){var s,u=Vc(a,i);o=o&&((s=u?.showNot)!==null&&s!==void 0?s:!0)}return o}},{key:"showConjs",value:function(){var t=this.props.config,a=t.settings.forceShowConj,i=this.conjunctionOptions(),o=Object.keys(i).length;return o>1&&!this.isOneChild()||this.showNot()||a}},{key:"isNoChildren",value:function(){var t=this.props.children1;return t?t.size==0:!0}},{key:"isOneChild",value:function(){var t=this.props.children1;return t?t.size<2:!0}},{key:"renderChildrenWrapper",value:function(){var t=this.props.children1;return t&&I.createElement("div",{key:"group-children",className:nn()("group--children",this.showConjs()?"":"hide--conjs",this.isOneChild()?"hide--line":"",this.isOneChild()?"one--child":"",this.childrenClassName())},this.renderChildren())}},{key:"renderHeaderWrapper",value:function(){var t=this.isGroupTopPosition();return I.createElement("div",{key:"group-header",className:nn()("group--header",this.isOneChild()?"one--child":"",this.showConjs()?"":"hide--conjs",this.isOneChild()?"hide--line":"",this.isNoChildren()?"no--children":"")},this.renderHeader(),t&&this.renderBeforeActions(),t&&this.renderActions(),t&&this.renderAfterActions())}},{key:"renderFooterWrapper",value:function(){var t=this.isGroupTopPosition();return!t&&I.createElement("div",{key:"group-footer",className:"group--footer"},this.renderBeforeActions(),this.renderActions(),this.renderAfterActions())}},{key:"renderActions",value:function(){var t=this.props,a=t.config,i=t.addRule,o=t.addGroup,s=t.isLocked,u=t.isTrueLocked,l=t.id,c=t.parentField;return I.createElement(Xh,{key:"group-actions",config:a,addRule:i,addGroup:o,canAddGroup:this.canAddGroup(),canAddRule:this.canAddRule(),canDeleteGroup:this.canDeleteGroup(),removeSelf:this.removeSelf,setLock:this.setLock,isLocked:s,isTrueLocked:u,id:l,parentField:c})}},{key:"canAddGroup",value:function(){return this.props.allowFurtherNesting}},{key:"canAddRule",value:function(){var t=this.props,a=t.totalRulesCnt,i=t.isMaxNestingExceeded,o=t.parentField,s=this.props.config.settings.maxNumberOfRules;if(o){var u=Vc(this.props.config,o);s=u.maxNumberOfRules}return i?!1:s?a<s:!0}},{key:"canDeleteGroup",value:function(){return!this.props.isRoot}},{key:"renderChildren",value:function(){var t=this.props.children1;return t?t.valueSeq().toArray().map(this.renderItem):null}},{key:"renderItem",value:function(t){if(t){var a=this.props,i=a.config,o=a.actions,s=a.onDragStart,u=a.isLocked,l=a.parentField,c=a.parentFieldPathSize,d=a.parentFieldCanReorder,f=t.get("type")=="group"&&t.getIn(["properties","field"])!=null,p=f?"rule_group":t.get("type");return I.createElement(Gc,(0,nt.A)({key:t.get("id"),id:t.get("id"),groupId:a.id,path:t.get("path"),type:p,properties:t.get("properties"),config:i,actions:o,children1:t.get("children1"),parentField:l,parentFieldPathSize:c,parentFieldCanReorder:d,reordableNodesCnt:this.reordableNodesCntForItem(t),totalRulesCnt:this.totalRulesCntForItem(t),parentReordableNodesCnt:this.reordableNodesCnt(),onDragStart:s,isDraggingTempo:this.props.isDraggingTempo,isParentLocked:u},this.extraPropsForItem(t)))}}},{key:"extraPropsForItem",value:function(t){return{}}},{key:"reordableNodesCnt",value:function(){return this.props.isLocked?0:this.props.reordableNodesCnt}},{key:"totalRulesCntForItem",value:function(t){return t.get("type")==="rule_group"?cE(t):this.props.totalRulesCnt}},{key:"reordableNodesCntForItem",value:function(t){return this.props.isLocked?0:this.reordableNodesCnt()}},{key:"showDragIcon",value:function(){var t=this.props,a=t.config,i=t.isRoot,o=t.isLocked,s=t.parentField,u=t.parentFieldCanReorder,l=this.reordableNodesCnt(),c=a.settings.canReorder&&!i&&l>1&&!o;return s&&(c=c&&u),c}},{key:"renderDrag",value:function(){var t=this.props.handleDraggerMouseDown,a=this.Icon,i=I.createElement(a,{type:"drag"});return this.showDragIcon()&&I.createElement("div",{key:"group-drag-icon",onMouseDown:t,className:"qb-drag-handler group--drag-handler"},i)}},{key:"conjunctionOptions",value:function(){var t=this.props,a=t.parentField,i=t.conjunctionOptions;return a?this.conjunctionOptionsForGroupField(a):i}},{key:"conjunctionOptionsForGroupField",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,a=this.props,i=a.config,o=a.conjunctionOptions,s=Vc(i,t);if(s!=null&&s.conjunctions){var u={},l=oE(s.conjunctions),c;try{for(l.s();!(c=l.n()).done;){var d=c.value,f=o[d];f&&(u[d]=f)}}catch(p){l.e(p)}finally{l.f()}return u}return o}},{key:"renderConjs",value:function(){var t=this.props,a=t.config,i=t.children1,o=t.id,s=t.selectedConjunction,u=t.setConjunction,l=t.not,c=t.setNot,d=t.isLocked,f=a.settings,p=f.immutableGroupsMode,g=f.notLabel,h=this.conjunctionOptions();if(!this.showConjs()||!i||!i.size)return null;var m={disabled:this.isOneChild(),readonly:p||d,selectedConjunction:s,setConjunction:p?Pr:u,conjunctionOptions:h,config:a,not:l||!1,id:o,setNot:p?Pr:c,notLabel:g,showNot:this.showNot(),isLocked:d},y=this.Conjs;return I.createElement(y,(0,nt.A)({key:"group-conjs"},m))}},{key:"renderHeader",value:function(){return I.createElement("div",{key:"group-conjunctions",className:"group--conjunctions"},this.renderConjs(),this.renderDrag())}},{key:"render",value:function(){return I.createElement(I.Fragment,null,this.renderHeaderWrapper(),this.renderChildrenWrapper(),this.renderFooterWrapper())}}])}(I.Component);In.propTypes={reordableNodesCnt:R().number,conjunctionOptions:R().object.isRequired,allowFurtherNesting:R().bool.isRequired,isMaxNestingExceeded:R().bool,isRoot:R().bool.isRequired,not:R().bool,selectedConjunction:R().string,config:R().object.isRequired,id:R().string.isRequired,groupId:R().string,path:R().any,children1:R().any,isDraggingMe:R().bool,isDraggingTempo:R().bool,isLocked:R().bool,isTrueLocked:R().bool,parentField:R().string,handleDraggerMouseDown:R().func,onDragStart:R().func,addRule:R().func.isRequired,addGroup:R().func.isRequired,removeSelf:R().func.isRequired,setConjunction:R().func.isRequired,setNot:R().func.isRequired,setLock:R().func.isRequired,actions:R().object.isRequired};const fE=Yo(ki("group")($i(In)),"group");function pE(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=(0,ge.A)(n))!==null;);return n}function an(){return an=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,r){var t=pE(n,e);if(t){var a=Object.getOwnPropertyDescriptor(t,e);return a.get?a.get.call(arguments.length<3?n:r):a.value}},an.apply(null,arguments)}function vE(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,am()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function am(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(am=function(){return!!n})()}var gE=function(n){function e(){return(0,Ie.A)(this,e),vE(this,e,arguments)}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"render",value:function(){var t=this.props,a=t.config,i=t.addRule,o=t.canAddRule,s=t.canDeleteGroup,u=t.removeSelf,l=t.setLock,c=t.isLocked,d=t.isTrueLocked,f=t.id,p=a.settings,g=p.immutableGroupsMode,h=p.addRuleLabel,m=p.delGroupLabel,y=p.renderButton,S=p.renderIcon,C=p.renderSwitch,F=p.renderButtonGroup,T=p.lockLabel,w=p.lockedLabel,_=p.showLock,M=p.canDeleteLocked,D=function(W){return S(W,a.ctx)},j=function(W){return y(W,a.ctx)},P=function(W){return C(W,a.ctx)},V=function(W){return F(W,a.ctx)},L=_&&!(c&&!d)&&I.createElement(P,{type:"lock",id:f,value:c,setValue:l,label:T,checkedLabel:w,hideLabel:!0,config:a}),U=!g&&o&&!c&&I.createElement(j,{type:"addSubRuleSimple",onClick:i,label:h,readonly:c,config:a,renderIcon:D}),B=!g&&s&&(!c||c&&M)&&I.createElement(j,{type:"delRuleGroup",onClick:u,label:m,config:a,renderIcon:D});return I.createElement("div",{className:"group--actions"},I.createElement(V,{config:a},L,U,B))}}])}(I.PureComponent);function im(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function om(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?im(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):im(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function hE(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,sm()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function sm(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sm=function(){return!!n})()}var mE=Be.ConfigUtils.getFieldConfig,um=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=hE(this,e,[r]),t.childrenClassName=function(){return"rule_group--children"},t.renderHeaderWrapper=function(){return null},t.renderFooterWrapper=function(){return null},t.renderConjs=function(){return null},t.canAddGroup=function(){return!1},t.canAddRule=function(){return!0},t.canDeleteGroup=function(){return!1},t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){an((0,ge.A)(e.prototype),"onPropsChanged",this).call(this,t)}},{key:"reordableNodesCntForItem",value:function(t){if(this.props.isLocked)return 0;var a=this.props.children1;return a?.size||0}},{key:"renderChildrenWrapper",value:function(){return I.createElement(I.Fragment,null,this.renderDrag(),this.renderField(),this.renderActions(),an((0,ge.A)(e.prototype),"renderChildrenWrapper",this).call(this))}},{key:"renderField",value:function(){var t=this.props,a=t.config,i=t.selectedField,o=t.selectedFieldSrc,s=t.selectedFieldType,u=t.setField,l=t.setFuncValue,c=t.setFieldSrc,d=t.parentField,f=t.id,p=t.groupId,g=t.isLocked,h=a.settings.immutableFieldsMode;return I.createElement(Nc,{key:"field",classname:"group--field",config:a,canSelectFieldSource:!1,selectedField:i,selectedFieldSrc:o,selectedFieldType:s,setField:u,setFuncValue:l,setFieldSrc:c,parentField:d,readonly:h||g,id:f,groupId:p})}},{key:"renderActions",value:function(){var t=this.props,a=t.config,i=t.addRule,o=t.isLocked,s=t.isTrueLocked,u=t.id;return I.createElement(gE,{config:a,addRule:i,canAddRule:this.canAddRule(),canDeleteGroup:this.canDeleteGroup(),removeSelf:this.removeSelf,setLock:this.setLock,isLocked:o,isTrueLocked:s,id:u})}},{key:"extraPropsForItem",value:function(t){var a,i=this.props,o=i.selectedField,s=i.lev,u=i.config,l=mE(u,o);return{parentField:o,parentFieldPathSize:s+1,parentFieldCanReorder:(a=l?.canReorder)!==null&&a!==void 0?a:u.settings.canReorder}}}])}(In);um.propTypes=om(om({},In.propTypes),{},{selectedField:R().any,selectedFieldSrc:R().string,parentField:R().string,setField:R().func,setFieldSrc:R().func,lev:R().number});const yE=Yo(ki("group rule_group")($i(um)),"rule_group");function bE(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,lm()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function lm(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lm=function(){return!!n})()}var SE=function(n){function e(){return(0,Ie.A)(this,e),bE(this,e,arguments)}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"render",value:function(){var t=this.props,a=t.config,i=t.addRule,o=t.addGroup,s=t.canAddRule,u=t.canAddGroup,l=t.canDeleteGroup,c=t.removeSelf,d=t.setLock,f=t.isLocked,p=t.isTrueLocked,g=t.id,h=a.settings,m=h.immutableGroupsMode,y=h.addSubRuleLabel,S=h.addSubGroupLabel,C=h.delGroupLabel,F=h.renderButton,T=h.renderIcon,w=h.renderSwitch,_=h.renderButtonGroup,M=h.lockLabel,D=h.lockedLabel,j=h.showLock,P=h.canDeleteLocked,V=function(J){return T(J,a.ctx)},L=function(J){return F(J,a.ctx)},U=function(J){return w(J,a.ctx)},B=function(J){return _(J,a.ctx)},G=j&&!(f&&!p)&&I.createElement(U,{type:"lock",id:g,value:f,setValue:d,label:M,checkedLabel:D,config:a}),W=!m&&s&&!f&&I.createElement(L,{type:"addSubRule",onClick:i,label:y,readonly:f,config:a,renderIcon:V}),z=!m&&u&&!f&&I.createElement(L,{type:"addSubGroup",onClick:o,label:S,readonly:f,config:a,renderIcon:V}),H=!m&&l&&(!f||f&&P)&&I.createElement(L,{type:"delRuleGroup",onClick:c,label:C,config:a,renderIcon:V});return I.createElement("div",{className:"group--actions group--actions--tr"},I.createElement(B,{config:a},G,W,z,H))}}])}(I.PureComponent);function cm(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function dm(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?cm(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):cm(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function OE(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,fm()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function fm(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fm=function(){return!!n})()}var pm=Be.ConfigUtils,Mc=pm.getFieldConfig,FE=pm.getFieldWidgetConfig,CE=Be.RuleUtils.isEmptyRuleGroupExtPropertiesAndChildren,EE=Be.TreeUtils.getTotalReordableNodesCountInTree,vm=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=OE(this,e,[r]),t.childrenClassName=function(){return"rule_group_ext--children"},t.renderFooterWrapper=function(){return null},t.canDeleteGroup=function(){return!0},t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){an((0,ge.A)(e.prototype),"onPropsChanged",this).call(this,t)}},{key:"canAddGroup",value:function(){return this.props.allowFurtherNesting}},{key:"canAddRule",value:function(){var t=this.props,a=t.config,i=t.selectedField,o=Mc(a,i),s=o.maxNumberOfRules,u=this.props.totalRulesCnt;return s?u<s:!0}},{key:"renderHeaderWrapper",value:function(){return I.createElement("div",{key:"group-header",className:nn()("group--header",this.isOneChild()?"one--child":"",this.isOneChild()?"hide--line":"",this.isNoChildren()?"no--children":"",this.showDragIcon()?"with--drag":"hide--drag",this.showConjs()?"with--conjs":"hide--conjs")},this.renderHeader(),this.renderGroupField(),this.renderActions())}},{key:"renderHeader",value:function(){return I.createElement("div",{className:"group--conjunctions"},this.renderConjs(),this.renderDrag())}},{key:"renderGroupField",value:function(){return I.createElement("div",{className:"group--field--count--rule"},this.renderField(),this.renderOperator(),this.renderWidget(),this.renderError())}},{key:"renderError",value:function(){var t=this.props,a=t.config,i=t.valueError,o=a.settings,s=o.renderRuleError,u=o.showErrorMessage,l=(0,ue.A)(i?.toArray()||[]).filter(function(c){return!!c}).shift()||null;return u&&l&&I.createElement("div",{className:"rule_group--error"},s?s({error:l},a.ctx):l)}},{key:"showNot",value:function(){var t,a=this.props,i=a.config,o=a.selectedField,s=Mc(i,o);return(t=s?.showNot)!==null&&t!==void 0?t:i.settings.showNot}},{key:"conjunctionOptions",value:function(){var t=this.props.selectedField;return this.conjunctionOptionsForGroupField(t)}},{key:"renderField",value:function(){var t=this.props,a=t.config,i=t.selectedField,o=t.selectedFieldSrc,s=t.selectedFieldType,u=t.setField,l=t.setFieldSrc,c=t.setFuncValue,d=t.parentField,f=t.id,p=t.groupId,g=t.isLocked,h=a.settings.immutableFieldsMode;return I.createElement(Nc,{key:"field",classname:"rule--field",config:a,canSelectFieldSource:!1,selectedField:i,selectedFieldSrc:o,selectedFieldType:s,setField:u,setFuncValue:c,setFieldSrc:l,parentField:d,readonly:h||g,id:f,groupId:p})}},{key:"renderOperator",value:function(){var t=this.props,a=t.config,i=t.selectedField,o=t.selectedFieldSrc,s=t.selectedOperator,u=t.setField,l=t.setOperator,c=t.isLocked,d=a.settings.immutableFieldsMode,f=FE(a,i,s)||{},p=f.hideOperator,g=i&&p&&f.operatorInlineLabel,h=i&&!p;return I.createElement(gh,{key:"operator",classname:"group--operator",config:a,selectedField:i,selectedFieldSrc:o,selectedOperator:s,setOperator:l,showOperator:h,showOperatorLabel:g,selectedFieldWidgetConfig:f,readonly:d||c,id:this.props.id,groupId:this.props.groupId})}},{key:"isEmptyCurrentGroup",value:function(){var t=this.props,a=t.children1,i=t.config,o=this._buildWidgetProps(this.props);return CE(o,a,i)}},{key:"_buildWidgetProps",value:function(t){var a=t.selectedField,i=t.selectedFieldSrc,o=t.selectedFieldType,s=t.selectedOperator,u=t.operatorOptions,l=t.value,c=t.valueType,d=t.valueSrc,f=t.asyncListValues,p=t.valueError,g=t.fieldError,h=t.parentField;return{field:a,fieldSrc:i,fieldType:o,operator:s,operatorOptions:u,value:l,valueType:c,valueSrc:["value"],valueError:p,fieldError:null,parentField:h}}},{key:"renderWidget",value:function(){var t=this.props,a=t.config,i=t.selectedField,o=t.selectedOperator,s=t.isLocked,u=a.settings.immutableValuesMode,l=i&&o,c=l;if(!c)return null;var d=I.createElement(Jo,(0,nt.A)({key:"values",isForRuleGroup:!0},this._buildWidgetProps(this.props),{config:a,setValue:u?Pr:this.props.setValue,setValueSrc:Pr,readonly:u||s,id:this.props.id,groupId:this.props.groupId}));return I.createElement(Kt,{key:"widget-for-"+this.props.selectedOperator,className:"rule--value"},d)}},{key:"renderActions",value:function(){var t=this.props,a=t.config,i=t.addRule,o=t.addGroup,s=t.isLocked,u=t.isTrueLocked,l=t.id;return I.createElement(SE,{config:a,addRule:i,addGroup:o,canAddRule:this.canAddRule(),canAddGroup:this.canAddGroup(),canDeleteGroup:this.canDeleteGroup(),removeSelf:this.removeSelf,setLock:this.setLock,isLocked:s,isTrueLocked:u,id:l})}},{key:"reordableNodesCntForItem",value:function(t){if(this.props.isLocked)return 0;var a=this.props,i=a.children1,o=a.id;return EE({id:o,type:"rule_group",children1:i})}},{key:"extraPropsForItem",value:function(t){var a,i=this.props,o=i.selectedField,s=i.lev,u=i.config,l=Mc(u,o);return{parentField:o,parentFieldPathSize:s+1,parentFieldCanReorder:(a=l?.canReorder)!==null&&a!==void 0?a:u.settings.canReorder}}}])}(In);vm.propTypes=dm(dm({},In.propTypes),{},{selectedField:R().any,selectedFieldSrc:R().string,selectedOperator:R().string,value:R().any,parentField:R().string,setField:R().func,setFieldSrc:R().func,setOperator:R().func,setValue:R().func,valueError:R().any,lev:R().number});const wE=Yo(ki("group rule_group_ext")($i(vm)),"rule_group");function AE(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,gm()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function gm(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gm=function(){return!!n})()}var TE={topLeft:"group--actions--tl",topCenter:"group--actions--tc",topRight:"group--actions--tr",bottomLeft:"group--actions--bl",bottomCenter:"group--actions--bc",bottomRight:"group--actions--br"},_E="topRight",LE=function(n){function e(){return(0,Ie.A)(this,e),AE(this,e,arguments)}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"render",value:function(){var t=this.props,a=t.config,i=t.addCaseGroup,o=t.addDefaultCaseGroup,s=t.setLock,u=t.isLocked,l=t.isTrueLocked,c=t.id,d=t.canAddGroup,f=t.canAddDefault,p=a.settings,g=p.immutableGroupsMode,h=p.addCaseLabel,m=p.addDefaultCaseLabel,y=p.groupActionsPosition,S=p.renderButton,C=p.renderIcon,F=p.renderSwitch,T=p.renderButtonGroup,w=p.lockLabel,_=p.lockedLabel,M=p.showLock,D=function(z){return C(z,a.ctx)},j=function(z){return S(z,a.ctx)},P=function(z){return F(z,a.ctx)},V=function(z){return T(z,a.ctx)},L=TE[y||_E],U=M&&!(u&&!l)&&I.createElement(P,{type:"lock",id:c,value:u,setValue:s,label:w,checkedLabel:_,config:a}),B=!g&&d&&!u&&I.createElement(j,{type:"addCaseGroup",onClick:i,label:h,readonly:u,config:a,renderIcon:D}),G=!g&&f&&!u&&I.createElement(j,{type:"addDefaultCaseGroup",onClick:o,label:m,readonly:u,config:a,renderIcon:D});return I.createElement("div",{className:"group--actions ".concat(L)},I.createElement(V,{config:a},U,B,G))}}])}(I.PureComponent);function hm(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function RE(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?hm(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):hm(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function jE(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,mm()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function mm(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mm=function(){return!!n})()}var ym=Be.TreeUtils,xE=ym.getTotalReordableNodesCountInTree,IE=ym.getTotalRulesCountInTree,bm=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=jE(this,e,[r]),t.childrenClassName=function(){return"switch_group--children"},t.renderFooterWrapper=function(){return null},t.hasDefaultCase=function(){var a;return((a=t.props.children1)===null||a===void 0?void 0:a.size)&&t.props.children1.filter(function(i){return i.get("children1")==null}).size>0},t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){an((0,ge.A)(e.prototype),"onPropsChanged",this).call(this,t)}},{key:"canAddGroup",value:function(){var t,a=this.props.config.settings.maxNumberOfCases,i=((t=this.props.children1)===null||t===void 0?void 0:t.size)||0;return a?i<a:!0}},{key:"canAddRule",value:function(){return!1}},{key:"reordableNodesCnt",value:function(){var t,a=((t=this.props.children1)===null||t===void 0?void 0:t.size)||0,i=a;return this.hasDefaultCase()&&i--,i}},{key:"totalRulesCntForItem",value:function(t){return IE(t)}},{key:"reordableNodesCntForItem",value:function(t){var a;if(this.props.isLocked)return 0;var i=this.props.config.settings,o=i.canLeaveEmptyCase,s=i.canRegroupCases,u=((a=this.props.children1)===null||a===void 0?void 0:a.size)||0,l=u;this.hasDefaultCase()&&l--;var c=xE(t),d=c;return d==1&&s&&o&&l>1&&(d=111),d}},{key:"showConjs",value:function(){return!0}},{key:"renderHeaderWrapper",value:function(){return I.createElement("div",{key:"group-header",className:nn()("group--header",this.isOneChild()?"one--child":"",this.isOneChild()?"hide--line":"",this.isNoChildren()?"no--children":"",this.showDragIcon()?"with--drag":"hide--drag",this.showConjs()?"with--conjs":"hide--conjs")},this.renderHeader(),this.renderActions())}},{key:"renderHeader",value:function(){return I.createElement("div",{className:"group--conjunctions"},this.renderConjs(),this.renderDrag())}},{key:"renderConjs",value:function(){var t=this.props.config,a=t.settings.renderSwitchPrefix;return a||null}},{key:"showNot",value:function(){return!1}},{key:"renderActions",value:function(){var t=this.props,a=t.config,i=t.addCaseGroup,o=t.addDefaultCaseGroup,s=t.isLocked,u=t.isTrueLocked,l=t.id;return I.createElement(LE,{config:a,addCaseGroup:i,addDefaultCaseGroup:o,canAddDefault:!this.hasDefaultCase(),canAddGroup:this.canAddGroup(),setLock:this.setLock,isLocked:s,isTrueLocked:u,id:l})}}])}(In);bm.propTypes=RE({},In.propTypes);const DE=Yo(ki("group switch_group")($i(bm)),"switch_group");function Sm(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Om(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Sm(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Sm(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function PE(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,Fm()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function Fm(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Fm=function(){return!!n})()}var Cm=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=PE(this,e,[r]),t.childrenClassName=function(){return"case_group--children"},t.renderFooterWrapper=function(){return null},t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){var a=this.props,i=!this.renderBeforeCaseValue||a?.config!==t?.config;if(an((0,ge.A)(e.prototype),"onPropsChanged",this).call(this,t),i){var o=t.config,s=o.settings,u=s.renderBeforeCaseValue,l=s.renderAfterCaseValue,c=s.renderRuleError;this.BeforeCaseValue=Nr(o,u),this.AfterCaseValue=Nr(o,l),this.RuleError=Nr(o,c)}}},{key:"isDefaultCase",value:function(){return this.props.children1==null}},{key:"reordableNodesCnt",value:function(){return this.props.parentReordableNodesCnt}},{key:"reordableNodesCntForItem",value:function(t){return this.props.isLocked?0:this.props.reordableNodesCnt}},{key:"totalRulesCntForItem",value:function(t){return this.props.totalRulesCnt}},{key:"showDragIcon",value:function(){return this.isDefaultCase()?!1:an((0,ge.A)(e.prototype),"showDragIcon",this).call(this)}},{key:"renderHeaderWrapper",value:function(){return I.createElement("div",{key:"group-header",className:nn()("group--header",this.isOneChild()?"one--child":"",this.isOneChild()?"hide--line":"",this.isNoChildren()?"no--children":"",this.showDragIcon()?"with--drag":"hide--drag",this.showConjs()&&(!this.isOneChild()||this.showNot())?"with--conjs":"hide--conjs")},this.renderHeaderLeft(),this.renderHeaderCenter(),this.renderActions())}},{key:"renderChildrenWrapper",value:function(){return this.isDefaultCase()?null:I.createElement("div",{className:"case_group--body"},this.renderCondition(),this.renderBeforeValue(),this.renderValue(),this.renderAfterValue())}},{key:"renderHeaderLeft",value:function(){if(this.isDefaultCase()){var t=this.props.config.settings.defaultCaseLabel;return t||""}return I.createElement("div",{className:"group--conjunctions"},this.renderConjs(),this.renderDrag(),this.renderError())}},{key:"renderCondition",value:function(){return this.isDefaultCase()?null:an((0,ge.A)(e.prototype),"renderChildrenWrapper",this).call(this)}},{key:"renderHeaderCenter",value:function(){return this.isDefaultCase()?I.createElement("div",null,this.renderValue(),this.renderError()):null}},{key:"canAddGroup",value:function(){return this.isDefaultCase()?!1:an((0,ge.A)(e.prototype),"canAddGroup",this).call(this)}},{key:"canAddRule",value:function(){return this.isDefaultCase()?!1:an((0,ge.A)(e.prototype),"canAddRule",this).call(this)}},{key:"renderBeforeValue",value:function(){var t=this.BeforeCaseValue;return t==null?null:I.createElement(t,(0,nt.A)({key:"values-before"},this.props))}},{key:"renderAfterValue",value:function(){var t=this.AfterCaseValue;return t==null?null:I.createElement(t,(0,nt.A)({key:"values-after"},this.props))}},{key:"renderError",value:function(){var t=this.props,a=t.config,i=t.valueError,o=a.settings.showErrorMessage,s=this.RuleError,u=(0,ue.A)(i?.toArray()||[]).filter(function(l){return!!l}).shift()||null;return o&&u&&I.createElement("div",{className:"rule--error"},s?I.createElement(s,{error:u}):u)}},{key:"renderValue",value:function(){var t=this.props,a=t.config,i=t.isLocked,o=t.value,s=t.valueSrc,u=t.valueError,l=t.setValue,c=t.setValueSrc,d=t.setFuncValue,f=t.id,p=a.settings.immutableValuesMode,g=I.createElement(Jo,{key:"values",isCaseValue:!0,field:"!case_value",operator:null,value:o,valueSrc:s??"value",valueError:u,fieldError:null,config:a,setValue:p?Pr:l,setValueSrc:p?Pr:c,setFuncValue:p?Pr:d,readonly:p||i,id:f,groupId:null});return I.createElement(Kt,{className:"case_group--value"},g)}},{key:"renderActions",value:function(){var t=this.props,a=t.config,i=t.addGroup,o=t.addRule,s=t.isLocked,u=t.isTrueLocked,l=t.id;return I.createElement(Xh,{config:a,addGroup:i,addRule:o,canAddRule:this.canAddRule(),canAddGroup:this.canAddGroup(),canDeleteGroup:this.canDeleteGroup(),removeSelf:this.removeSelf,setLock:this.setLock,isLocked:s,isTrueLocked:u,id:l})}},{key:"isEmptyCurrentGroup",value:function(){var t=this.props.value,a=t&&t.size?t.get(0):null,i=a!=null&&(Array.isArray(a)?a.length>0:!0);return an((0,ge.A)(e.prototype),"isEmptyCurrentGroup",this).call(this)&&!i}}])}(In);Cm.propTypes=Om(Om({},In.propTypes),{},{parentReordableNodesCnt:R().number,value:R().any,setValue:R().func});const NE=Yo(ki("group case_group")($i(Cm)),"case_group");var VE=["type"];function ME(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,Em()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function Em(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Em=function(){return!!n})()}function wm(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function kc(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?wm(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):wm(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var kE=["rule","group","rule_group","switch_group","case_group"],Ui=function(e){var r,t=((r=e.properties)===null||r===void 0?void 0:r.toObject())||{},a=kc({},t);return e.isParentLocked&&(a.isLocked=!0),t.isLocked&&(a.isTrueLocked=!0),a},GE={rule:function(e){return I.createElement(KC,(0,nt.A)({},Ui(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,config:e.config,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,parentField:e.parentField,parentFieldPathSize:e.parentFieldPathSize,parentReordableNodesCnt:e.parentReordableNodesCnt,parentFieldCanReorder:e.parentFieldCanReorder}))},group:function(e){return I.createElement(fE,(0,nt.A)({},Ui(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:e.parentField,parentFieldPathSize:e.parentFieldPathSize,parentReordableNodesCnt:e.parentReordableNodesCnt,parentFieldCanReorder:e.parentFieldCanReorder}))},rule_group:function(e){return I.createElement(yE,(0,nt.A)({},Ui(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:e.parentField,parentFieldPathSize:e.parentFieldPathSize,parentReordableNodesCnt:e.parentReordableNodesCnt,parentFieldCanReorder:e.parentFieldCanReorder}))},rule_group_ext:function(e){return I.createElement(wE,(0,nt.A)({},Ui(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:e.parentField,parentFieldPathSize:e.parentFieldPathSize,parentReordableNodesCnt:e.parentReordableNodesCnt,parentFieldCanReorder:e.parentFieldCanReorder}))},switch_group:function(e){return I.createElement(DE,(0,nt.A)({},Ui(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:null,parentReordableNodesCnt:e.parentReordableNodesCnt}))},case_group:function(e){return I.createElement(NE,(0,nt.A)({},Ui(e),{id:e.id,groupId:e.groupId,path:e.path,actions:e.actions,config:e.config,reordableNodesCnt:e.reordableNodesCnt,totalRulesCnt:e.totalRulesCnt,onDragStart:e.onDragStart,isDraggingTempo:e.isDraggingTempo,children1:e.children1,parentField:null,parentReordableNodesCnt:e.parentReordableNodesCnt}))}},Gc=function(n){function e(){return(0,Ie.A)(this,e),ME(this,e,arguments)}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"render",value:function(){var t,a=this.props,i=a.type,o=(0,Qa.A)(a,VE),s=(t=o.properties)===null||t===void 0?void 0:t.get("mode"),u=s=="array"?"_ext":"",l=o.config.settings.renderItem,c=GE[i+u];return l?l(kc(kc({},o),{},{type:i,itemComponent:c}),o.config.ctx):c?c(o):null}}])}(I.PureComponent);Gc.propTypes={config:R().object.isRequired,id:R().string.isRequired,groupId:R().string,type:R().oneOf(kE).isRequired,path:R().any.isRequired,properties:R().any,children1:R().any,actions:R().object.isRequired,reordableNodesCnt:R().number,onDragStart:R().func,parentField:R().string,isDraggingTempo:R().bool,isParentLocked:R().bool};function $E(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,Am()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function Am(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Am=function(){return!!n})()}var Tm=Be.TreeUtils,UE=Tm.getTotalReordableNodesCountInTree,BE=Tm.getTotalRulesCountInTree,_m=Be.DefaultUtils,WE=_m.createListWithOneElement,Lm=_m.emptyProperties,Rm=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=$E(this,e,[r]),t.pureShouldComponentUpdate=Mi(t),t._updPath(r),t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"shouldComponentUpdate",value:function(t,a){var i=this.pureShouldComponentUpdate(t,a);return i}},{key:"_updPath",value:function(t){var a=t.tree.get("id");this.path=WE(a)}},{key:"render",value:function(){var t=this.props,a=t.tree,i=t.config,o=t.actions,s=t.onDragStart,u=a.get("type"),l=u=="switch_group",c=l?null:UE(a),d=l?null:BE(a),f=a.get("id");return I.createElement(Gc,{key:f,id:f,path:this.path,type:u,properties:a.get("properties")||Lm(),config:i,actions:o,children1:a.get("children1")||Lm(),reordableNodesCnt:c,totalRulesCnt:d,parentReordableNodesCnt:0,onDragStart:s})}}])}(I.Component);Rm.propTypes={tree:R().any.isRequired,config:R().object.isRequired,actions:R().object.isRequired,onDragStart:R().func};const zE=oC(Rm);function jm(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function qE(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?jm(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):jm(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function HE(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,xm()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function xm(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xm=function(){return!!n})()}var QE=Be.OtherUtils.clone,Mu=Be.ConfigUtils,Ko=Mu.getFieldConfig,Im=Mu.getFieldParts,Dm=Mu.getFieldPathParts,JE=Mu.getWidgetForFieldOp,Pm=Be.RuleUtils.getFieldPathLabels,Nm=function(n){function e(r){var t;return(0,Ie.A)(this,e),t=HE(this,e,[r]),Dr(t),t.onPropsChanged(r),t}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"onPropsChanged",value:function(t){var a=this.props,i=["config","field","fieldSrc","fieldType","operator","isFuncArg","parentField"],o=["config","field","fieldSrc","fieldType","operator","value","placeholder","isFuncArg","parentField"],s=!this.items||i.map(function(l){return t[l]!==a[l]}).filter(function(l){return l}).length>0,u=!this.meta||o.map(function(l){return t[l]!==a[l]}).filter(function(l){return l}).length>0;s&&(this.items=this.getItems(t)),u&&(this.meta=this.getMeta(t))}},{key:"getItems",value:function(t){var a=t.config,i=t.field,o=t.fieldType,s=t.operator,u=t.parentField,l=t.isFuncArg,c=t.fieldDefinition,d=a.settings.canCompareFieldWithField,f=Im(u,a),p=u?Ko(a,u):null,g=u?p?.subfields:a.fields,h=this.filterFields(a,g,i,u,f,s,d,l,c,o),m=this.buildOptions(f,a,h,f);return m}},{key:"getMeta",value:function(t){var a,i=t.config,o=t.field,s=t.fieldType,u=t.operator,l=t.value,c=t.placeholder,d=t.isFuncArg,f=t.parentField,p=i.settings,g=p.fieldPlaceholder,h=p.fieldSeparatorDisplay,m=l,y=!!l,S=o?Ko(i,o):{},C=S==null||(a=S.widgets)===null||a===void 0?void 0:a.field,F=C?.widgetProps||{},T=y?null:d&&c||F.valuePlaceholder||g,w=y?Ko(i,m):null,_=w||{},M=Dm(m,i),D=Dm(m,i,!0),j=this.getFieldLabel(w,m,i),P=Pm(m,i),V=P?P.join(h):null;(V==j||f)&&(V=null);var L=_.label2||_.tooltip;return{placeholder:T,selectedKey:m,selectedKeys:M,selectedPath:D,selectedLabel:j,selectedOpts:_,selectedAltLabel:L,selectedFullLabel:V}}},{key:"filterFields",value:function(t,a,i,o,s,u,l,c,d,f){a=QE(a);var p=t.settings.fieldSeparator,g=Ko(t,i),h=!1,m=JE(t,i,u,"value"),y=t.widgets[m],S=t.operators[u],C;c?C=d?.type:S!=null&&S.valueTypes?C=S?.valueTypes[0]:h&&y?C=y.type:g?C=g.type:C=f;function F(T,w){for(var _ in T){var M=T[_].subfields,D=(w||[]).concat(_),j=D.join(p),P=Ko(t,j);if(!P)delete T[_];else if(P.type=="!struct"||P.type=="!group")F(M,D)==0&&delete T[_];else{var V=(!C||P.type==C)&&(c?!0:j!=i),L=l||t.settings.canCompareFieldWithField;L&&(V=V&&L(i,g,j,P,u)),V||delete T[_]}}return Gi()(T).length}return F(a,s||[]),a}},{key:"buildOptions",value:function(t,a,i){var o=this,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!i)return null;var l=a.settings,c=l.fieldSeparator,d=l.fieldSeparatorDisplay,f=s!=null&&s.length?s.join(c)+c:"";return Gi()(i).map(function(p){var g=[].concat((0,ue.A)(s??[]),[p]),h=i[p],m=o.getFieldLabel(h,g,a),y=Pm(g,a),S=y.join(d);(S==m||t)&&(S=null);var C=h.label2,F=h.tooltip;if(!h.hideForCompare)return h.type=="!struct"||h.type=="!group"?{key:p,path:f+p,label:m,fullLabel:S,altLabel:C,tooltip:F,items:o.buildOptions(t,a,h.subfields,g,{label:m,tooltip:F})}:{key:p,path:f+p,label:m,fullLabel:S,altLabel:C,tooltip:F,grouplabel:u?.label,group:u}}).filter(function(p){return!!p})}},{key:"getFieldLabel",value:function(t,a,i){if(!a)return null;var o=i.settings.maxLabelsLength,s=Im(a,i),u=t?.label||su()(s);return u=Du(u,o),u}},{key:"render",value:function(){var t=this.props,a=t.config,i=t.customProps,o=t.setValue,s=t.readonly,u=t.id,l=t.groupId,c=a.settings.renderField,d=qE({isValueField:!0,config:a,customProps:i,setField:o,readonly:s,items:this.items,id:u,groupId:l},this.meta);return c(d,a.ctx)}}])}(I.Component);Nm.propTypes={id:R().string,groupId:R().string,setValue:R().func.isRequired,config:R().object.isRequired,field:R().any,fieldSrc:R().string,fieldType:R().string,value:R().string,operator:R().string,customProps:R().object,readonly:R().bool,parentField:R().string,fieldDefinition:R().object,isFuncArg:R().bool};const YE=function(n){var e=n.value,r=n.setValue,t=n.config,a=n.labelYes,i=n.labelNo,o=n.readonly,s=n.widgetId,u=n.customProps,l=u===void 0?{}:u,c=l.radioYes||{},d=l.radioNo||{},f=function(h){return r(h.target.checked)},p=function(h){return r(h.target.value=="true")};return I.createElement(I.Fragment,null,I.createElement("input",(0,nt.A)({type:"radio",value:!0,checked:!!e,disabled:o,onChange:p},c))," ",a,I.createElement("input",(0,nt.A)({type:"radio",value:!1,checked:!e,disabled:o,onChange:p},d))," ",i)},KE=function(n){var e=n.value,r=n.setValue,t=n.config,a=n.readonly,i=n.placeholder,o=n.maxLength,s=n.customProps,u=function(d){var f=d.target.value;f===""&&(f=void 0),r(f)},l=e||"";return I.createElement("input",(0,nt.A)({type:"text",value:l,placeholder:i,disabled:a,onChange:u,maxLength:o},s))},XE=function(n){var e=n.value,r=n.setValue,t=n.config,a=n.readonly,i=n.placeholder,o=n.maxLength,s=n.maxRows,u=n.fullWidth,l=n.customProps,c=function(p){var g=p.target.value;g===""&&(g=void 0),r(g)},d=e||"";return I.createElement("textarea",(0,nt.A)({value:d,placeholder:i,disabled:a,onChange:c,maxLength:o,style:{width:u?"100%":void 0}},l))};var TA=Be.moment;const ZE=function(n){var e=n.value,r=n.setValue,t=n.config,a=n.valueFormat,i=n.readonly,o=n.customProps,s=function(l){var c=l.target.value;c==""&&(c=void 0),r(c)};return I.createElement("input",(0,nt.A)({type:"date",value:e||"",disabled:i,onChange:s},o))},ew=function(n){var e=n.value,r=n.setValue,t=n.config,a=n.valueFormat,i=n.use12Hours,o=n.readonly,s=n.customProps,u=function(c){var d=c.target.value;d==""&&(d=void 0),r(d)};return I.createElement("input",(0,nt.A)({type:"time",value:e||"",disabled:o,onChange:u},s))};var Vm=Be.moment;const tw=function(n){var e=n.value,r=n.setValue,t=n.config,a=n.valueFormat,i=n.use12Hours,o=n.readonly,s=n.customProps,u=function(d){var f=d.target.value;f==""?f=void 0:f=Vm(new Date(f)).format(a),r(f)},l=e;return e?l=Vm(e).format("YYYY-MM-DDTHH:mm"):l="",I.createElement("input",(0,nt.A)({type:"datetime-local",value:l,disabled:o,onChange:u},s))};var rw=Be.ListUtils.mapListValues;const nw=function(n){var e=n.listValues,r=n.value,t=n.setValue,a=n.allowCustomValues,i=n.readonly,o=n.customProps,s=function(){return rw(e,function(d){var f=d.title,p=d.value;return I.createElement("option",{key:p,value:p},f)})},u=function(d){for(var f=[],p=d.options,g=0;g<p.length;g++){var h=p[g];h.selected&&f.push(h.value)}return f.length||(f=void 0),f},l=function(d){return t(u(d.target))};return I.createElement("select",(0,nt.A)({multiple:!0,onChange:l,value:r,disabled:i},vu()(o,["showSearch","input","showCheckboxes"])),s())};var aw=Be.ListUtils.mapListValues;const iw=function(n){var e=n.listValues,r=n.value,t=n.setValue,a=n.allowCustomValues,i=n.readonly,o=n.customProps,s=function(){return aw(e,function(d){var f=d.title,p=d.value;return I.createElement("option",{key:p,value:p},f)})},u=function(d){return t(d.target.value)},l=r!=null;return I.createElement("select",(0,nt.A)({onChange:u,value:l?r:"",disabled:i},vu()(o,["showSearch","input"])),!l&&I.createElement("option",{disabled:!0,value:""}),s())},ow=function(n){var e=n.value,r=n.setValue,t=n.config,a=n.readonly,i=n.min,o=n.max,s=n.step,u=n.placeholder,l=n.customProps,c=function(p){var g=p.target.value;g===""||g===null?g=void 0:g=Number(g),r(g)},d=e??"";return I.createElement("input",(0,nt.A)({type:"number",value:d,placeholder:u,disabled:a,min:i,max:o,step:s,onChange:c},l))},sw=function(n){var e=n.value,r=n.setValue,t=n.config,a=n.readonly,i=n.min,o=n.max,s=n.step,u=n.placeholder,l=n.customProps,c=l===void 0?{}:l,d=c.input||{},f=c.slider||c,p=function(m){var y=m.target.value;y===""||y===null?y=void 0:y=Number(y),r(y)},g=e??"";return I.createElement("div",{style:{display:"inline-flex"}},I.createElement("input",(0,nt.A)({key:"number",type:"number",value:g,placeholder:u,disabled:a,min:i,max:o,step:s,onChange:p},d)),I.createElement("input",(0,nt.A)({key:"range",type:"range",value:g,disabled:a,min:i,max:o,step:s,onChange:p},f)))},uw=function(n){var e=n.items,r=n.setField,t=n.selectedKey,a=n.readonly,i=n.errorText,o=function l(c){return c.map(function(d){var f=d.items,p=d.path,g=d.label,h=d.disabled,m=d.matchesType;if(f)return I.createElement("optgroup",{disabled:h,key:p,label:g},l(f));var y=m?{fontWeight:"bold"}:{};return I.createElement("option",{disabled:h,key:p,value:p,style:y},g)})},s=function(c){return r(c.target.value)},u=t!=null;return I.createElement("select",{onChange:s,value:u?t:"",disabled:a,style:{color:i?"red":null}},!u&&I.createElement("option",{disabled:!0,value:""}),o(e))},lw=function(n){var e=n.id,r=n.not,t=n.setNot,a=n.conjunctionOptions,i=n.setConjunction,o=n.disabled,s=n.readonly,u=n.config,l=n.showNot,c=n.notLabel,d=Object.keys(a).length,f=o,p=u.settings.forceShowConj,g=p||d>1&&!f,h=function(){return Object.keys(a).map(function(F){var T=a[F],w=T.id,_=T.name,M=T.label,D=T.checked,j=i.isDummyFn?"__dummy":"";return(s||o)&&!D?null:[I.createElement("input",{key:w+j,type:"radio",id:w+j,name:_+j,checked:D,disabled:s||o,value:F,onChange:y}),I.createElement("label",{key:w+j+"label",htmlFor:w+j},M)]})},m=function(){var F="not";return[I.createElement("input",{key:e+F,type:"checkbox",id:e+F,checked:r,disabled:s,onChange:S}),I.createElement("label",{key:e+F+"label",htmlFor:e+F},c||"NOT")]},y=function(F){return i(F.target.value)},S=function(F){return t(F.target.checked)};return[l&&m(),g&&h()]};var cw={addSubRuleSimple:"+",addSubRule:"+",addSubGroup:"+",delGroup:"x",delRuleGroup:"x",delRule:"x"};const dw=function(n){var e=n.type,r=n.label,t=n.onClick,a=n.readonly,i=r||cw[e];return I.createElement("button",{onClick:t,type:"button",disabled:a},i)},fw=function(n){var e=n.type,r={},t=r[e]||null;return!t&&e==="drag"&&(t=I.createElement(fh,null)),t},pw=function(n){var e=n.children,r=n.config;return I.createElement(I.Fragment,null,e)},vw=function(n){var e=n.config,r=n.valueSources,t=n.valueSrc,a=n.title,i=n.setValueSrc,o=n.readonly,s=function(c){return c.map(function(d){var f=(0,ve.A)(d,2),p=f[0],g=f[1];return I.createElement("option",{key:p,value:p},g.label)})},u=function(c){return i(c.target.value)};return I.createElement("select",{onChange:u,value:t||"",disabled:o},s(r))},gw=function(n){var e=n.value,r=n.setValue,t=n.label,a=n.id,i=n.config,o=n.type,s=function(c){return r(c.target.checked)},u=o;return[I.createElement("input",{key:a+u,type:"checkbox",id:a+u,checked:!!e,onChange:s}),I.createElement("label",{key:a+u+"label",htmlFor:a+u},t)]},hw=function(n){var e=n.onOk,r=n.okText,t=n.cancelText,a=n.title;confirm(a)&&e()};var mw=function(e){var r=e.config,t=e.children;return t};function yw(n,e,r){return e=(0,ge.A)(e),(0,Ge.A)(n,Mm()?Reflect.construct(e,r||[],(0,ge.A)(n).constructor):e.apply(n,r))}function Mm(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Mm=function(){return!!n})()}var $c=function(n){function e(){var r;(0,Ie.A)(this,e);for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return r=yw(this,e,[].concat(a)),r.handleChange=function(o){r.props.setOption("proximity",parseInt(o))},r}return(0,it.A)(e,n),(0,Ke.A)(e,[{key:"render",value:function(){var t=this.props,a=t.defaults,i=t.options,o=t.config,s=t.optionLabel,u=t.optionPlaceholder,l=t.customProps,c=t.minProximity,d=t.maxProximity,f=t.optionTextBefore,p=t.readonly,g=o.settings,h=o.widgets,m=o.ctx,y=a?a.proximity:void 0,S=g.showLabels,C=i.get("proximity",y),F=Ic()(c,d+1).map(function(_){return{title:_,value:_}}),T=h.select.factory,w=function(M){return T(M,m)};return I.createElement("div",{className:"operator--PROXIMITY"},I.createElement("div",{className:"operator--options"},S&&I.createElement("label",{className:"rule--label"},s),!S&&f&&I.createElement("div",{className:"operator--options--sep"},I.createElement("span",null,f)),I.createElement(w,(0,nt.A)({config:o,value:C,listValues:F,setValue:this.handleChange,readonly:p,placeholder:u},l))),I.createElement("div",{className:"operator--widgets"},this.props.children))}}])}(I.PureComponent);$c.propTypes={config:R().object.isRequired,setOption:R().func.isRequired,options:R().any.isRequired,minProximity:R().number,maxProximity:R().number,optionPlaceholder:R().string,optionTextBefore:R().string,optionLabel:R().string,customProps:R().object,readonly:R().bool},$c.defaultProps={customProps:{},minProximity:2,maxProximity:10,optionPlaceholder:"Select words between",optionLabel:"Words between",optionTextBefore:null};function km(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function Qe(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?km(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):km(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var bw=Qe({},Vt.conjunctions),Sw=Qe(Qe({},Vt.operators),{},{proximity:Qe(Qe({},Vt.operators.proximity),{},{options:Qe(Qe({},Vt.operators.proximity.options),{},{factory:function(e,r){var t=r.RCE,a=r.O.ProximityOperator;return t(a,e)}})})}),Ow={text:Qe(Qe({},Vt.widgets.text),{},{factory:function(e,r){var t=r.RCE,a=r.W.VanillaTextWidget;return t(a,e)}}),textarea:Qe(Qe({},Vt.widgets.textarea),{},{factory:function(e,r){var t=r.RCE,a=r.W.VanillaTextAreaWidget;return t(a,e)}}),number:Qe(Qe({},Vt.widgets.number),{},{factory:function(e,r){var t=r.RCE,a=r.W.VanillaNumberWidget;return t(a,e)}}),slider:Qe(Qe({},Vt.widgets.slider),{},{factory:function(e,r){var t=r.RCE,a=r.W.VanillaSliderWidget;return t(a,e)}}),select:Qe(Qe({},Vt.widgets.select),{},{factory:function(e,r){var t=r.RCE,a=r.W.VanillaSelectWidget;return t(a,e)}}),multiselect:Qe(Qe({},Vt.widgets.multiselect),{},{factory:function(e,r){var t=r.RCE,a=r.W.VanillaMultiSelectWidget;return t(a,e)}}),date:Qe(Qe({},Vt.widgets.date),{},{factory:function(e,r){var t=r.RCE,a=r.W.VanillaDateWidget;return t(a,e)}}),time:Qe(Qe({},Vt.widgets.time),{},{factory:function(e,r){var t=r.RCE,a=r.W.VanillaTimeWidget;return t(a,e)}}),datetime:Qe(Qe({},Vt.widgets.datetime),{},{factory:function(e,r){var t=r.RCE,a=r.W.VanillaDateTimeWidget;return t(a,e)}}),boolean:Qe(Qe({},Vt.widgets.boolean),{},{factory:function(e,r){var t=r.RCE,a=r.W.VanillaBooleanWidget;return t(a,e)}}),field:Qe(Qe({},Vt.widgets.field),{},{factory:function(e,r){var t=r.RCE,a=r.W.ValueFieldWidget;return t(a,e)},customProps:{showSearch:!0}}),func:Qe(Qe({},Vt.widgets.func),{},{factory:function(e,r){var t=r.RCE,a=r.W.FuncWidget;return t(a,e)},customProps:{}}),case_value:Qe(Qe({},Vt.widgets.case_value),{},{factory:function(e,r){var t=r.RCE,a=r.W.VanillaTextWidget;return t(a,e)}})},Fw=Qe(Qe({},Vt.types),{},{select:Qe(Qe({},Vt.types.select),{},{widgets:Qe(Qe({},Vt.types.select.widgets),{},{select:Qe(Qe({},Vt.types.select.widgets.select),{},{widgetProps:{customProps:{showSearch:!0}}})})})}),Cw=Qe(Qe({},Vt.settings),{},{renderField:function(e,r){var t=r.RCE,a=r.W.VanillaFieldSelect;return t(a,e)},renderOperator:function(e,r){var t=r.RCE,a=r.W.VanillaFieldSelect;return t(a,e)},renderFunc:function(e,r){var t=r.RCE,a=r.W.VanillaFieldSelect;return t(a,e)},renderConjs:function(e,r){var t=r.RCE,a=r.W.VanillaConjs;return t(a,e)},renderSwitch:function(e,r){var t=r.RCE,a=r.W.VanillaSwitch;return t(a,e)},renderButton:function(e,r){var t=r.RCE,a=r.W.VanillaButton;return t(a,e)},renderIcon:function(e,r){var t=r.RCE,a=r.W.VanillaIcon;return t(a,e)},renderButtonGroup:function(e,r){var t=r.RCE,a=r.W.VanillaButtonGroup;return t(a,e)},renderProvider:function(e,r){var t=r.RCE,a=r.W.VanillaProvider;return t(a,e)},renderValueSources:function(e,r){var t=r.RCE,a=r.W.VanillaValueSources;return t(a,e)},renderFieldSources:function(e,r){var t=r.RCE,a=r.W.VanillaValueSources;return t(a,e)},renderConfirm:function(e,r){var t=r.W.vanillaConfirm;return t(e)},renderSwitchPrefix:"IF",renderBeforeCaseValue:function(e,r){var t=r.RCE;return t("span",{children:[" then "]})},customFieldSelectProps:{showSearch:!0},customOperatorSelectProps:{},defaultSliderWidth:"200px",defaultSelectWidth:"200px",defaultSearchWidth:"100px",defaultMaxRows:5,renderSize:"small",maxLabelsLength:100,showLock:!1,showNot:!0,forceShowConj:!1,groupActionsPosition:"topRight"}),Ew=Qe(Qe({},Vt.ctx),{},{W:Qe({},er),O:Qe({},mn),RCE:function(e,r){return I.createElement(e,r)}}),Uc={conjunctions:bw,operators:Sw,widgets:Ow,types:Fw,settings:Cw,ctx:Ew};Uc=Be.ConfigMixins.removeMixins(Uc,["rangeslider","treeselect","treemultiselect"]);const ww=Uc;var _A=$(60602);function Gm(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function ku(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Gm(Object(r),!0).forEach(function(t){_defineProperty(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Gm(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var Xo=Be.Autocomplete,Gu=Xo.mergeListValues,$m=Xo.listValueToOption,Aw=Xo.optionToListValue,Tw=Xo.optionsToListValues,_w=Xo.fixListValuesGroupOrder,Bi=Be.ListUtils,Lw=Bi.mapListValues,$u=Bi.listValuesToArray,Uu=Bi.getListValue,Um=Bi.makeCustomListValue,Rw=Bi.searchListValue,jw=Bi.getItemInListValues;function Bm(n){return new Promise(function(e){setTimeout(e,n)})}var LA=function(e,r){var t,a,i,o=e.asyncFetch,s=e.useLoadMore,u=e.useAsyncSearch,l=e.forceAsyncSearch,c=e.fetchSelectedValuesOnInit,d=e.asyncListValues,f=e.listValues,p=e.allowCustomValues,g=e.value,h=e.setValue,m=e.placeholder,y=e.config,S=e.field,C=r.debounceTimeout,F=r.multiple,T=r.uif,w=r.isFieldAutocomplete,_=["LOAD_MORE","LOADING_MORE"],M=(t=y.settings.loadMoreLabel)!==null&&t!==void 0?t:"Load more...",D=(a=y.settings.loadingMoreLabel)!==null&&a!==void 0?a:"Loading more...",j=l?(i=y.settings.typeToSearchLabel)!==null&&i!==void 0?i:"Type to search":m;o&&c&&!d&&g!=null&&(d=Array.isArray(g)?g:[g]);var P=React.useState(!1),V=_slicedToArray(P,2),L=V[0],U=V[1],B=React.useState(void 0),G=_slicedToArray(B,2),W=G[0],z=G[1],H=React.useState(0),q=_slicedToArray(H,2),J=q[0],Y=q[1],Z=React.useState(!1),se=_slicedToArray(Z,2),re=se[0],ee=se[1],Fe=React.useState(""),pe=_slicedToArray(Fe,2),oe=pe[0],Se=pe[1],he=React.useState(void 0),be=_slicedToArray(he,2),Le=be[0],Ae=be[1],ke=React.useRef(0),Ve=React.useRef(0),Re=React.useRef(!1),Ce=React.useRef();Ce.current=g;var jt=React.useRef();jt.current=oe;var ot=React.useMemo(function(){return $u(d)},[d]),mt=d&&Array.isArray(d)&&d.filter(function(ct){return ct!==null&&_typeof(ct)!=="object"}).length>0,Ue=React.useMemo(function(){return o?d?Gu(Le,ot,!0):Le:$u(f)},[o,d,Le,f]),Mt=o?Le:$u(f);p&&oe&&!Rw(oe,Le)&&(Mt=Gu(Mt,[Um(oe)],!0)),o&&!Le&&d&&!oe&&!L&&T==="antd"&&(Mt=Ue),o&&!p&&d&&T==="mui"&&(Mt=Gu(Mt,ot,!0,!0));var kt=J>0,ir=c&&!L&&o&&mt&&g!=null,xt=L&&o&&Le===void 0&&(l?oe:!0),Xe=(xt||ir)&&kt,Ht=!Xe&&Ue&&Ue.length>0&&W&&W.hasMore&&(W.filter||"")===oe,Xt=!kt&&Ht,Zt=Lw(Mt,$m),Vr=g!=null,at=!F&&Vr?Uu(g,Ue):null,Qt=function(){var ct=_asyncToGenerator(_regeneratorRuntime.mark(function Pe(){var je,$e,ze,et,Gt,Ct,or,sr,ur,Kr,ut,on,zr,Bt,dt,Wt=arguments;return _regeneratorRuntime.wrap(function(Or){for(;;)switch(Or.prev=Or.next){case 0:return je=Wt.length>0&&Wt[0]!==void 0?Wt[0]:null,$e=Wt.length>1&&Wt[1]!==void 0?Wt[1]:!1,!$e&&W&&z(void 0),ze=$e&&Le?Le.length:0,et=$e&&W||!s&&{pageSize:0},Gt=++ke.current,Or.next=8,o.call(y?.ctx,je,ze,et);case 8:if(Ct=Or.sent,or=ke.current!=Gt,!(or||!Ve.current)){Or.next=12;break}return Or.abrupt("return",null);case 12:return sr=Ct!=null&&Ct.values?Ct:{values:Ct},ur=sr.values,Kr=sr.hasMore,ut=sr.meta,on=$u(ur),$e?(Bt=Gu(Le,on,!1),zr=Bt.length>Le.length):(Bt=on,s&&(zr=Bt.length>0)),dt=Kr!=null||ut!=null||zr!=null?ku(ku(ku(ku({},zr!=null?{hasMore:zr}:{}),Kr!=null?{hasMore:Kr}:{}),ut??{}),{},{filter:je}):void 0,dt&&z(dt),Or.abrupt("return",Bt);case 18:case"end":return Or.stop()}},Pe)}));return function(){return ct.apply(this,arguments)}}(),Sr=function(){var ct=_asyncToGenerator(_regeneratorRuntime.mark(function Pe(){var je,$e,ze,et,Gt,Ct,or,sr,ur;return _regeneratorRuntime.wrap(function(ut){for(;;)switch(ut.prev=ut.next){case 0:if(je=Ce.current==null?[]:F?Ce.current:[Ce.current],je.length){ut.next=3;break}return ut.abrupt("return",null);case 3:return $e={fetchSelectedValues:!0},ze=++ke.current,ut.next=7,o.call(y?.ctx,je,-1,$e);case 7:if(et=ut.sent,Gt=ke.current!=ze,!(Gt||!Ve.current)){ut.next=11;break}return ut.abrupt("return",null);case 11:return Ct=et!=null&&et.values?et:{values:et},or=Ct.values,sr=Ce.current==null?[]:F?Ce.current:[Ce.current],ur=sr.map(function(on){var zr;return(zr=jw(or,on))!==null&&zr!==void 0?zr:Um(on)}),ut.abrupt("return",ur.length?ur:null);case 15:case"end":return ut.stop()}},Pe)}));return function(){return ct.apply(this,arguments)}}(),Dn=function(){var ct=_asyncToGenerator(_regeneratorRuntime.mark(function Pe(){var je;return _regeneratorRuntime.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:return Y(function(et){return et+1}),ze.next=3,Sr();case 3:if(je=ze.sent,Ve.current){ze.next=6;break}return ze.abrupt("return");case 6:je!=null&&h(Ce.current,je),Y(function(et){return et-1});case 8:case"end":return ze.stop()}},Pe)}));return function(){return ct.apply(this,arguments)}}(),Mr=function(){var ct=_asyncToGenerator(_regeneratorRuntime.mark(function Pe(){var je,$e,ze,et=arguments;return _regeneratorRuntime.wrap(function(Ct){for(;;)switch(Ct.prev=Ct.next){case 0:return je=et.length>0&&et[0]!==void 0?et[0]:null,$e=et.length>1&&et[1]!==void 0?et[1]:!1,Y(function(or){return or+1}),ee($e),Ct.next=6,Qt(je,$e);case 6:if(ze=Ct.sent,Ve.current){Ct.next=9;break}return Ct.abrupt("return");case 9:ze!=null&&Ae(ze),Y(function(or){return or-1}),ee(!1);case 12:case"end":return Ct.stop()}},Pe)}));return function(){return ct.apply(this,arguments)}}(),Xn=React.useCallback(debounce(Mr,C),[]);React.useEffect(function(){return Ve.current++,function(){Ve.current--}},[]),React.useEffect(function(){xt&&J==0&&_asyncToGenerator(_regeneratorRuntime.mark(function ct(){return _regeneratorRuntime.wrap(function(je){for(;;)switch(je.prev=je.next){case 0:return je.next=2,Mr();case 2:case"end":return je.stop()}},ct)}))(),ir&&J==0&&_asyncToGenerator(_regeneratorRuntime.mark(function ct(){return _regeneratorRuntime.wrap(function(je){for(;;)switch(je.prev=je.next){case 0:return je.next=2,Dn();case 2:case"end":return je.stop()}},ct)}))()},[xt,ir,J]);var _t=function(){U(!0)},Pn=function(){var ct=_asyncToGenerator(_regeneratorRuntime.mark(function Pe(je){var $e,ze;return _regeneratorRuntime.wrap(function(Gt){for(;;)switch(Gt.prev=Gt.next){case 0:if($e=Re.current,$e?(Re.current=!1,F&&U(!1)):U(!1),!(T==="mui"&&!$e)){Gt.next=6;break}return ze="",Gt.next=6,ei(null,ze,"my-reset");case 6:case"end":return Gt.stop()}},Pe)}));return function(je){return ct.apply(this,arguments)}}(),Za=function(Pe){Pe?_t():Pn()},Zn=function(Pe){var je=Pe?.specialValue||Pe?.value;return _.includes(je)},Bc=function(){var ct=_asyncToGenerator(_regeneratorRuntime.mark(function Pe(je,$e,ze){var et,Gt,Ct,or,sr,ur,Kr,ut,on,zr,Bt,dt,Wt,ti,Or,Bu,Wu,zi,rs,pr;return _regeneratorRuntime.wrap(function(zt){for(;;)switch(zt.prev=zt.next){case 0:if(Ct=F&&T==="mui"&&ze==="clear",or=!F&&T==="mui"&&ze==="clear"&&je?.type==="change",sr=!F&&T==="mui"&&ze==="clear"&&je?.type!=="change",T==="mui"&&(ze=$e,F?$e=ze.map(function(sn){var ns;return(ns=sn?.value)!==null&&ns!==void 0?ns:sn}):$e=(ur=(Kr=ze)===null||Kr===void 0?void 0:Kr.value)!==null&&ur!==void 0?ur:ze),ut=F&&Array.isArray(ze)&&ze.map(function(sn){return sn?.specialValue}).find(function(sn){return!!sn})||((et=ze)===null||et===void 0?void 0:et.specialValue),F&&$e&&!Array.isArray($e)&&($e=[].concat(_toConsumableArray(g||[]),[$e]),ze=null),on=F&&((Gt=$e)===null||Gt===void 0?void 0:Gt.length)&&new Set($e).size!==$e.length,zr=F&&T==="antd"&&je===null&&ze===null&&on,Bt=Ct&&$e.length===0&&oe&&L||or||zr,!Bt){zt.next=11;break}return zt.abrupt("return");case 11:if(dt=F&&$e.length&&$e.length>(g||[]).length&&$e[$e.length-1]==oe&&!Uu(oe,Le),ut!="LOAD_MORE"){zt.next=19;break}return Se(oe),Re.current=!0,zt.next=17,Mr(oe,!0);case 17:zt.next=39;break;case 19:if(ut!="LOADING_MORE"){zt.next=23;break}Re.current=!0,zt.next=39;break;case 23:if(!F){zt.next=33;break}if(Wt=Tw($e,Ue,p),ti=_slicedToArray(Wt,2),Or=ti[0],Bu=ti[1],h(Or,o?Bu:void 0),!dt){zt.next=31;break}return zt.next=29,Bm(0);case 29:return zt.next=31,ei(null,"","my-reset");case 31:zt.next=39;break;case 33:if(Wu=Aw($e,Ue,p),zi=_slicedToArray(Wu,2),rs=zi[0],pr=zi[1],h(rs,o?pr:void 0),!(sr&&w)){zt.next=39;break}return zt.next=38,Bm(0);case 38:U(!1);case 39:case"end":return zt.stop()}},Pe)}));return function(je,$e,ze){return ct.apply(this,arguments)}}(),ei=function(){var ct=_asyncToGenerator(_regeneratorRuntime.mark(function Pe(je,$e,ze){var et,Gt,Ct,or,sr,ur;return _regeneratorRuntime.wrap(function(ut){for(;;)switch(ut.prev=ut.next){case 0:if(et=T==="mui"&&ze==="removeOption"&&$e===""&&F,Gt=T==="mui"&&ze==="selectOption"&&$e===""&&F,Ct=T==="mui"&&!F&&ze==="blur"&&$e===at?.title,or=T==="mui"&&ze==="reset"||Gt||et||Ct,sr=$e,!(sr===M||sr===D||or)){ut.next=7;break}return ut.abrupt("return");case 7:if(!(T==="mui"&&!F&&ze==="selectOption"&&$e!=="")){ut.next=9;break}return ut.abrupt("return");case 9:if($e==oe){ut.next=18;break}if(Se(sr),ur=u&&(l?!!sr:!0),!ur){ut.next=17;break}return ut.next=15,Xn(sr);case 15:ut.next=18;break;case 17:u&&l&&Ae([]);case 18:case"end":return ut.stop()}},Pe)}));return function(je,$e,ze){return ct.apply(this,arguments)}}(),Wi=function(Pe){var je=_toConsumableArray(Pe);return s&&(Xt?je.push({specialValue:"LOAD_MORE",title:M}):re&&je.push({specialValue:"LOADING_MORE",title:D,disabled:!0})),je},Zo=function(Pe,je){if(je==null)return null;var $e=je.value!=null?je.value:je;return Pe.value===$e},es=function(Pe){return Pe&&Pe.disabled},Nn=function(Pe){var je;if(Pe!=null&&Pe.isCustom)return!0;var $e=(je=Pe?.value)!==null&&je!==void 0?je:Pe,ze=Uu($e,Ue);return ze?.isCustom||ze==null},fr=function(Pe){if(Pe==null)return null;var je=Pe.value!=null?Pe:$m(Uu(Pe,Ue));return!je&&Pe.specialValue?Pe.title:!je&&p||!je?Pe.toString():je.title||je.label||je.value.toString()},ts=T==="mui"?_w(Zt):Zt;return{options:ts,listValues:Ue,hasValue:Vr,selectedListValue:at,open:L,onOpen:_t,onClose:Pn,onDropdownVisibleChange:Za,onChange:Bc,inputValue:oe,onInputChange:ei,canShowLoadMore:Xt,isInitialLoading:Xe,isLoading:kt,isLoadingMore:re,isSpecialValue:Zn,extendOptions:Wi,getOptionSelected:Zo,getOptionDisabled:es,getOptionIsCustom:Nn,getOptionLabel:fr,aPlaceholder:j}};const RA=null;function Wm(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);e&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),r.push.apply(r,t)}return r}function zm(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Wm(Object(r),!0).forEach(function(t){(0,X.A)(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Wm(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}const xw=zm(zm({},Be),{},{ReactUtils:Xr,DragIcon:fh})},97890:(Fr,Et,$)=>{"use strict";$.d(Et,{C:()=>N});var tt=$(43173);const N=()=>!!tt.$.featureToggles.sqlDatasourceDatabaseSelection},81045:(Fr,Et,$)=>{"use strict";$.d(Et,{T:()=>ie});var tt=$(41778),N=$(11194),ce=$(25274);function ie(Je){let te=Je?.editorMode||tt.lX.Builder;return Je?.editorMode===void 0&&Je?.rawSql!==void 0&&(te=tt.lX.Code),{...Je,refId:Je?.refId||"A",format:Je?.format!==void 0?Je.format:N.gv.Table,rawSql:Je?.rawSql||"",editorMode:te,sql:Je?.sql??{columns:[(0,ce.JD)()],groupBy:[(0,ce.xG)()],limit:50}}}},36656:(Fr,Et,$)=>{"use strict";$.d(Et,{D:()=>tt,_:()=>N});var tt=(ce=>(ce.String="string",ce))(tt||{}),N=(ce=>(ce.Property="property",ce.Operator="operator",ce.Or="or",ce.And="and",ce.GroupBy="groupBy",ce.Function="function",ce.FunctionParameter="functionParameter",ce))(N||{})},11194:(Fr,Et,$)=>{"use strict";$.d(Et,{cO:()=>ce,gv:()=>N,zL:()=>Je});var tt=$(47184),N=(te=>(te.Timeseries="time_series",te.Table="table",te))(N||{});const ce=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"}],ie=te=>({label:te,value:te}),Je=tt.z??ie},25274:(Fr,Et,$)=>{"use strict";$.d(Et,{JD:()=>ne,Kj:()=>te,YW:()=>ie,oF:()=>ce,oG:()=>Oe,xG:()=>Je});var tt=$(47184),N=$(36656);function ce(le){return`SELECT ${le.map(Te=>{let Me="";return Te.name&&Te.alias?Me+=`${Te.name}(${Te.parameters?.map(ye=>`${ye.name}`)}) AS ${Te.alias}`:Te.name?Me+=`${Te.name}(${Te.parameters?.map(ye=>`${ye.name}`)})`:Te.alias?Me+=`${Te.parameters?.map(ye=>`${ye.name}`)} AS ${Te.alias}`:Me+=`${Te.parameters?.map(ye=>`${ye.name}`)}`,Me}).join(", ")} `}const ie=le=>{if(!le)return!1;const Ee=le.some(Me=>Me.parameters?.length||Me.parameters?.some(ye=>ye.name)),Te=le.some(Me=>Me.name);return Ee||Te};function Je(le){return{type:N._.GroupBy,property:{type:N.D.String,name:le}}}function te(le){return{type:N._.Property,property:{type:N.D.String,name:le}}}function ne(le){return{type:N._.Function,name:le,parameters:[]}}function Oe(le){return le?.name?(0,tt.z)(le.name):null}},94822:(Fr,Et,$)=>{"use strict";$.r(Et),$.d(Et,{plugin:()=>yi});var tt=$(94644),N=$(74848),ce=$(2543),ie=$(96540),Je=$(48480),te=$(43173),ne=$(16780),Oe=$(37386),le=$(18857),Ee=$(34999),Te=$(96004),Me=$(18027),ye=$(63527);const wt="Direct browser access in the InfluxDB datasource is no longer available. Switch to server access mode.",bt="default";var xe=(O=>(O.InfluxQL="InfluxQL",O.Flux="Flux",O.SQL="SQL",O))(xe||{}),vt=$(97095),Xr=$(48767);const er=20,mn=O=>{const{options:{jsonData:v,secureJsonData:b,secureJsonFields:E}}=O,A=(0,ce.uniqueId)("influxdb-flux-config");return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(vt.C,{children:(0,N.jsx)(Me.I,{labelWidth:er,label:"Organization",htmlFor:`${A}-org`,children:(0,N.jsx)(ye.p,{id:`${A}-org`,className:"width-20",value:v.organization||"",onChange:(0,Je.PG)(O,"organization")})})}),(0,N.jsx)(vt.C,{children:(0,N.jsx)(Me.I,{labelWidth:er,label:"Token",children:(0,N.jsx)(Xr.L4,{isConfigured:!!(E&&E.token),value:b?.token||"",label:"Token","aria-label":"Token",className:"width-20",onReset:()=>(0,Je.QP)(O,"token"),onChange:(0,Je.mn)(O,"token")})})}),(0,N.jsx)(vt.C,{children:(0,N.jsx)(Me.I,{labelWidth:er,label:"Default Bucket",children:(0,N.jsx)(ye.p,{className:"width-20",placeholder:"default bucket",value:v.defaultBucket||"",onChange:(0,Je.PG)(O,"defaultBucket")})})}),(0,N.jsx)(vt.C,{children:(0,N.jsx)(Me.I,{labelWidth:er,label:"Min time interval",tooltip:`A lower limit for the auto group by time interval. Recommended to be set to write frequency,
				for example 1m if your data is written every minute.`,children:(0,N.jsx)(ye.p,{className:"width-20",placeholder:"10s",value:v.timeInterval||"",onChange:(0,Je.PG)(O,"timeInterval")})})})]})};var Ie=$(22803),Ke=$(63142),Ge=$(79233);const ge=[{label:"GET",value:"GET"},{label:"POST",value:"POST"}],it=O=>{const{options:v,onOptionsChange:b}=O,{database:E,jsonData:A,secureJsonData:x,secureJsonFields:k}=v,Q=(0,Ke.of)(I),K=(0,ce.uniqueId)("influxdb-influxql-config");return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(Ee.F,{severity:"info",title:"Database Access",children:(0,N.jsxs)("p",{children:["Setting the database for this datasource does not deny access to other databases. The InfluxDB query syntax allows switching the database in the query. For example:",(0,N.jsx)("code",{children:"SHOW MEASUREMENTS ON _internal"})," or",(0,N.jsx)("code",{children:'SELECT * FROM "_internal".."database" LIMIT 10'}),(0,N.jsx)("br",{}),(0,N.jsx)("br",{}),"To support data isolation and security, make sure appropriate permissions are configured in InfluxDB."]})}),(0,N.jsx)(Oe.D,{horizontal:!0,label:(0,N.jsx)(Ge.c,{width:er,children:"Database"}),className:Q.horizontalField,htmlFor:`${K}-db`,children:(0,N.jsx)(ye.p,{id:`${K}-db`,className:"width-20",value:A.dbName??E,onChange:ae=>{b({...v,database:"",jsonData:{...A,dbName:ae.currentTarget.value}})}})}),(0,N.jsx)(Oe.D,{horizontal:!0,label:(0,N.jsx)(Ge.c,{width:er,children:"User"}),className:Q.horizontalField,htmlFor:`${K}-user`,children:(0,N.jsx)(ye.p,{id:`${K}-user`,className:"width-20",value:v.user||"",onChange:(0,Je.zX)(O,"user")})}),(0,N.jsx)(Oe.D,{horizontal:!0,label:(0,N.jsx)(Ge.c,{width:er,children:"Password"}),className:Q.horizontalField,children:(0,N.jsx)(Xr.L4,{isConfigured:!!(k&&k.password),value:x?.password||"",label:"Password","aria-label":"Password",className:"width-20",onReset:()=>(0,Je.QP)(O,"password"),onChange:(0,Je.mn)(O,"password")})}),(0,N.jsx)(Oe.D,{horizontal:!0,label:(0,N.jsx)(Ge.c,{width:er,tooltip:`You can use either GET or POST HTTP method to query your InfluxDB database. The POST
          method allows you to perform heavy requests (with a lots of WHERE clause) while the GET method
          will restrict you and return an error if the query is too large.`,children:"HTTP Method"}),htmlFor:`${K}-http-method`,className:Q.horizontalField,children:(0,N.jsx)(le.l6,{inputId:`${K}-http-method`,className:"width-20",value:ge.find(ae=>ae.value===v.jsonData.httpMode),options:ge,defaultValue:v.jsonData.httpMode,onChange:(0,Je.BD)(O,"httpMode")})}),(0,N.jsx)(Oe.D,{horizontal:!0,label:(0,N.jsx)(Ge.c,{width:er,tooltip:"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example 1m if your data is written every minute.",children:"Min time interval"}),className:Q.horizontalField,children:(0,N.jsx)(ye.p,{className:"width-20",placeholder:"10s",value:v.jsonData.timeInterval||"",onChange:(0,Je.PG)(O,"timeInterval")})})]})},I=O=>({horizontalField:(0,Ie.css)({justifyContent:"initial",margin:`0 ${O.spacing(.5)} ${O.spacing(.5)} 0`})});var X=$(21285);const ve=O=>{const{options:v,onOptionsChange:b}=O,{jsonData:E,secureJsonData:A,secureJsonFields:x}=v,k=(0,Ke.of)(ue),Q=(0,ce.uniqueId)("influxdb-sql-config");return(0,N.jsxs)("div",{children:[(0,N.jsx)(Oe.D,{horizontal:!0,label:(0,N.jsx)(Ge.c,{width:er,children:"Database"}),className:k.horizontalField,htmlFor:`${Q}-dbName`,children:(0,N.jsx)(ye.p,{id:`${Q}-dbName`,className:"width-20","aria-label":"Database or bucket name",value:E.dbName,onChange:K=>{b({...v,jsonData:{...E,dbName:K.currentTarget.value}})}})}),(0,N.jsx)(Oe.D,{horizontal:!0,label:(0,N.jsx)(Ge.c,{width:er,children:"Token"}),className:k.horizontalField,children:(0,N.jsx)(Xr.L4,{label:"Token","aria-label":"Token",className:"width-20",value:A?.token||"",onReset:()=>(0,Je.QP)(O,"token"),onChange:(0,Je.mn)(O,"token"),isConfigured:!!(x&&x.token)})}),(0,N.jsx)(Oe.D,{horizontal:!0,label:(0,N.jsx)(Ge.c,{width:er,children:"Insecure Connection"}),className:k.horizontalField,children:(0,N.jsx)(X.K,{id:`${Q}-insecure-grpc`,value:E.insecureGrpc??!1,onChange:K=>{b({...v,jsonData:{...E,insecureGrpc:K.currentTarget.checked}})}})})]})},ue=O=>({horizontalField:(0,Ie.css)({justifyContent:"initial",margin:`0 ${O.spacing(.5)} ${O.spacing(.5)} 0`})}),ft={[xe.InfluxQL]:{label:"InfluxQL",value:xe.InfluxQL,description:"The InfluxDB SQL-like query language."},[xe.SQL]:{label:"SQL",value:xe.SQL,description:"Native SQL language. Supported in InfluxDB 3.0"},[xe.Flux]:{label:"Flux",value:xe.Flux,description:"Supported in InfluxDB 2.x and 1.8+"}},ma=[ft[xe.InfluxQL],ft[xe.SQL],ft[xe.Flux]];class St extends ie.PureComponent{constructor(v){super(v),this.state={maxSeries:""},this.versionNotice={Flux:"Support for Flux in Grafana is currently in beta",SQL:"Support for SQL in Grafana is currently in alpha"},this.onVersionChanged=b=>{const{options:E,onOptionsChange:A}=this.props,x={...E,jsonData:{...E.jsonData,version:b.value}};if(b.value===xe.Flux){x.access="proxy",x.basicAuth=!0,x.jsonData.httpMode="POST";const{user:k,database:Q,...K}=x;A(K)}else A(x)},this.state.maxSeries=v.options.jsonData.maxSeries?.toString()||"",this.htmlPrefix=(0,ce.uniqueId)("influxdb-config")}renderJsonDataOptions(){switch(this.props.options.jsonData.version){case xe.InfluxQL:return(0,N.jsx)(it,{...this.props});case xe.Flux:return(0,N.jsx)(mn,{...this.props});case xe.SQL:return(0,N.jsx)(ve,{...this.props});default:return(0,N.jsx)(it,{...this.props})}}render(){const{options:v,onOptionsChange:b}=this.props,E=v.access==="direct";return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(ne.n,{children:[(0,N.jsx)("h3",{className:"page-heading",children:"Query language"}),(0,N.jsx)(Oe.D,{children:(0,N.jsx)(le.l6,{"aria-label":"Query language",className:"width-30",value:ft[v.jsonData.version??xe.InfluxQL],options:ma,defaultValue:ft[xe.InfluxQL],onChange:this.onVersionChanged})})]}),v.jsonData.version!==xe.InfluxQL&&(0,N.jsx)(Ee.F,{severity:"info",title:this.versionNotice[v.jsonData.version],children:(0,N.jsxs)("p",{children:["Please report any issues to: ",(0,N.jsx)("br",{}),(0,N.jsx)("a",{href:"https://github.com/grafana/grafana/issues/new/choose",children:"https://github.com/grafana/grafana/issues"})]})}),E&&(0,N.jsx)(Ee.F,{title:"Error",severity:"error",children:wt}),(0,N.jsx)(Te.t,{showAccessOptions:E,dataSourceConfig:v,defaultUrl:"http://localhost:8086",onChange:b,secureSocksDSProxyEnabled:te.$.secureSocksDSProxyEnabled}),(0,N.jsxs)(ne.n,{children:[(0,N.jsx)("h3",{className:"page-heading",children:"InfluxDB Details"}),this.renderJsonDataOptions(),(0,N.jsx)(Me.I,{labelWidth:20,label:"Max series",tooltip:"Limit the number of series/tables that Grafana will process. Lower this number to prevent abuse, and increase it if you have lots of small time series and not all are shown. Defaults to 1000.",children:(0,N.jsx)(ye.p,{placeholder:"1000",type:"number",className:"width-20",value:this.state.maxSeries,onChange:A=>{this.setState({maxSeries:A.currentTarget.value});const x=parseInt(A.currentTarget.value,10);(0,Je.lO)(this.props,"maxSeries",Number.isFinite(x)?x:void 0)}})})]})]})}}const kr=St;var It=$(8934),we=$(56355);const ya=[],qe={Aggregations:[],Selectors:[],Transformations:[],Predictors:[],Math:[],Aliasing:[],Fields:[]};function ri(O){const v=ya[O.type];if(!v)throw{message:"Could not find query part "+O.type};return new we.kW(O,v)}function Ze(O){ya[O.type]=new we.tI(O),O.category.push(ya[O.type])}const Zr=[];function as(O,v){return v+' AS "'+O.params[0]+'"'}function ea(O){const v=O.params[0];if(v==="*")return"*";let b=`"${v}"`;return v.endsWith("::tag")&&(b=`"${v.slice(0,-5)}"::tag`),v.endsWith("::field")&&(b=`"${v.slice(0,-7)}"::field`),b}function $t(O,v){for(let b=0;b<O.length;b++){const E=O[b];if(E.def.category===qe.Aggregations){if(E.def.type===v.def.type)return;if(E.def.type==="count"&&v.def.type==="distinct")break;if(E.def.type==="distinct"){const A=O.length>=b+2;if(v.def.type!=="count"&&A)O[b+1].def.category===qe.Aggregations&&O.splice(b+1,1);else if(v.def.type==="count"){(!A||O[b+1].def.type!=="count")&&O.splice(b+1,0,v);return}}O[b]=v;return}if(E.def.category===qe.Selectors){O[b]=v;return}}O.splice(1,0,v)}function vr(O,v){let b;for(b=0;b<O.length;b++){const E=O[b];if(E.def.category===qe.Math||E.def.category===qe.Aliasing)break}O.splice(b,0,v)}function is(O,v){const b=O.length;if(b>0){if(O[b-1].def.type==="math"){O[b-1]=v;return}if(b>1&&O[b-2].def.type==="math"){O[b-2]=v;return}else if(O[b-1].def.type==="alias"){O.splice(b-1,0,v);return}}O.push(v)}function os(O,v){const b=O.length;if(b>0&&O[b-1].def.type==="alias"){O[b-1]=v;return}O.push(v)}function ss(O,v,b){const E=(0,ce.map)(O,A=>ri({type:A.def.type,params:(0,ce.clone)(A.params)}));b.selectModels.push(E)}Ze({type:"field",addStrategy:ss,category:qe.Fields,params:[{type:"field",dynamicLookup:!0}],defaultParams:["value"],renderer:ea}),Ze({type:"count",addStrategy:$t,category:qe.Aggregations,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"distinct",addStrategy:$t,category:qe.Aggregations,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"integral",addStrategy:$t,category:qe.Aggregations,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"mean",addStrategy:$t,category:qe.Aggregations,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"median",addStrategy:$t,category:qe.Aggregations,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"mode",addStrategy:$t,category:qe.Aggregations,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"sum",addStrategy:$t,category:qe.Aggregations,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"derivative",addStrategy:vr,category:qe.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:we.Wn}),Ze({type:"spread",addStrategy:vr,category:qe.Transformations,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"non_negative_derivative",addStrategy:vr,category:qe.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:we.Wn}),Ze({type:"difference",addStrategy:vr,category:qe.Transformations,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"non_negative_difference",addStrategy:vr,category:qe.Transformations,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"moving_average",addStrategy:vr,category:qe.Transformations,params:[{name:"window",type:"int",options:[5,10,20,30,40]}],defaultParams:[10],renderer:we.Wn}),Ze({type:"cumulative_sum",addStrategy:vr,category:qe.Transformations,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"stddev",addStrategy:vr,category:qe.Transformations,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"time",category:Zr,params:[{name:"interval",type:"time",options:["$__interval","1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["$__interval"],renderer:we.Wn}),Ze({type:"fill",category:Zr,params:[{name:"fill",type:"string",options:["none","null","0","previous","linear"]}],defaultParams:["null"],renderer:we.Wn}),Ze({type:"elapsed",addStrategy:vr,category:qe.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:we.Wn}),Ze({type:"holt_winters",addStrategy:vr,category:qe.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:we.Wn}),Ze({type:"holt_winters_with_fit",addStrategy:vr,category:qe.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:we.Wn}),Ze({type:"bottom",addStrategy:$t,category:qe.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:we.Wn}),Ze({type:"first",addStrategy:$t,category:qe.Selectors,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"last",addStrategy:$t,category:qe.Selectors,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"max",addStrategy:$t,category:qe.Selectors,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"min",addStrategy:$t,category:qe.Selectors,params:[],defaultParams:[],renderer:we.Wn}),Ze({type:"percentile",addStrategy:$t,category:qe.Selectors,params:[{name:"nth",type:"int"}],defaultParams:[95],renderer:we.Wn}),Ze({type:"top",addStrategy:$t,category:qe.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:we.Wn}),Ze({type:"tag",category:Zr,params:[{name:"tag",type:"string",dynamicLookup:!0}],defaultParams:["tag"],renderer:ea}),Ze({type:"math",addStrategy:is,category:qe.Math,params:[{name:"expr",type:"string"}],defaultParams:[" / 100"],renderer:we.Dw}),Ze({type:"alias",addStrategy:os,category:qe.Aliasing,params:[{name:"name",type:"string",quote:"double"}],defaultParams:["alias"],renderMode:"suffix",renderer:as});const Lt={create:ri,getCategories:()=>qe,replaceAggregationAdd:$t};class qr{constructor(v,b,E){this.selectModels=[],this.groupByParts=[],this.target=v,this.templateSrv=b,this.scopedVars=E,v.policy=v.policy||bt,v.resultFormat=v.resultFormat||"time_series",v.orderByTime=v.orderByTime||"ASC",v.tags=v.tags||[],v.groupBy=v.groupBy||[{type:"time",params:["$__interval"]},{type:"fill",params:["null"]}],v.select=v.select||[[{type:"field",params:["value"]},{type:"mean",params:[]}]],this.updateProjection()}updateProjection(){this.selectModels=(0,ce.map)(this.target.select,v=>(0,ce.map)(v,Lt.create)),this.groupByParts=(0,ce.map)(this.target.groupBy,Lt.create)}updatePersistedParts(){this.target.select=(0,ce.map)(this.selectModels,v=>(0,ce.map)(v,b=>({type:b.def.type,params:b.params})))}hasGroupByTime(){return(0,ce.find)(this.target.groupBy,v=>v.type==="time")}hasFill(){return(0,ce.find)(this.target.groupBy,v=>v.type==="fill")}addGroupBy(v){let b=v.match(/^(\w+)\((.*)\)$/);if(!b||!this.target.groupBy)return;const E=b[1],A=b[2],x=Lt.create({type:E,params:[A]}),k=this.target.groupBy.length;k===0?this.target.groupBy.push(x.part):E==="time"?this.target.groupBy.splice(0,0,x.part):E==="tag"?this.target.groupBy[k-1].type==="fill"?this.target.groupBy.splice(k-1,0,x.part):this.target.groupBy.push(x.part):this.target.groupBy.push(x.part),this.updateProjection()}removeGroupByPart(v,b){const E=Lt.getCategories();v.def.type==="time"&&(this.target.groupBy=(0,ce.filter)(this.target.groupBy,A=>A.type!=="fill"),this.target.select=(0,ce.map)(this.target.select,A=>(0,ce.filter)(A,x=>{const k=Lt.create(x);return!(k.def.category===E.Aggregations||k.def.category===E.Selectors)}))),this.target.groupBy.splice(b,1),this.updateProjection()}removeSelect(v){this.target.select.splice(v,1),this.updateProjection()}removeSelectPart(v,b){if(b.def.type==="field"){if(this.selectModels.length>1){const E=(0,ce.indexOf)(this.selectModels,v);this.selectModels.splice(E,1)}}else{const E=(0,ce.indexOf)(v,b);v.splice(E,1)}this.updatePersistedParts()}addSelectPart(v,b){const E=Lt.create({type:b});E.def.addStrategy(v,E,this),this.updatePersistedParts()}isOperatorTypeHandler(v,b,E){let A;if(v==="Is Not"?v="!=":v="=",E.endsWith("::tag"))return A="'"+Sa(b.replace(/\\/g,"\\\\").replace(/\'/g,"\\'"))+"'",{operator:v,value:A};let x=b.toLowerCase();return isNaN(parseFloat(b))?["true","false"].includes(x)?A=x:A="'"+Sa(b.replace(/\\/g,"\\\\").replace(/\'/g,"\\'"))+"'":A=b,{operator:v,value:A}}renderTagCondition(v,b,E){let A="",x=v.operator,k=v.value;if(b>0&&(A=(v.condition||"AND")+" "),x||(/^\/.*\/$/.test(k)?x="=~":x="="),x!=="=~"&&x!=="!~")if(E&&(k=this.templateSrv.replace(k,this.scopedVars)),k=Sa(k),x.startsWith("Is")){let K=this.isOperatorTypeHandler(x,k,v.key);x=K.operator,k=K.value}else(!x.startsWith(">")&&!x.startsWith("<")||x==="<>")&&(k="'"+k.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")+"'");else E&&(k=this.templateSrv.replace(k,this.scopedVars,"regex"));let Q=`"${v.key}"`;return v.key.endsWith("::tag")&&(Q=`"${v.key.slice(0,-5)}"::tag`),v.key.endsWith("::field")&&(Q=`"${v.key.slice(0,-7)}"::field`),A+Q+" "+x+" "+k}getMeasurementAndPolicy(v){let b=this.target.policy,E=this.target.measurement||"measurement";return E.match("^/.*/$")?v&&(E=this.templateSrv.replace(E,this.scopedVars,"regex")):E='"'+E+'"',b!==bt?b='"'+this.target.policy+'".':b="",b+E}interpolateQueryStr(v,b){return!b.multi&&!b.includeAll?v:typeof v=="string"?(0,It.$f)(v):"("+(0,ce.map)(v,It.$f).join("|")+")"}render(v){const b=this.target;if(b.rawQuery)return v?this.templateSrv.replace(b.query,this.scopedVars,this.interpolateQueryStr):b.query;let E="SELECT ",A,x;for(A=0;A<this.selectModels.length;A++){const K=this.selectModels[A];let ae="";for(x=0;x<K.length;x++)ae=K[x].render(ae);A>0&&(E+=", "),E+=ae}E+=" FROM "+this.getMeasurementAndPolicy(v)+" WHERE ";const k=(0,ce.map)(b.tags,(K,ae)=>this.renderTagCondition(K,ae,v));k.length>0&&(E+="("+k.join(" ")+") AND "),E+="$timeFilter";let Q="";for(A=0;A<this.groupByParts.length;A++){const K=this.groupByParts[A];A>0&&(Q+=K.def.type==="fill"?" ":", "),Q+=K.render("")}return Q.length&&(E+=" GROUP BY "+Q),b.fill&&(E+=" fill("+b.fill+")"),b.orderByTime==="DESC"&&(E+=" ORDER BY time DESC"),b.limit&&(E+=" LIMIT "+b.limit),b.slimit&&(E+=" SLIMIT "+b.slimit),b.tz&&(E+=" tz('"+b.tz+"')"),E}renderAdhocFilters(v){return(0,ce.map)(v,(E,A)=>this.renderTagCondition(E,A,!0)).join(" ")}}function gt(O){const v=(0,ce.cloneDeep)(O);return new qr(v).render(!1)}function us(O){if(O.policy!==void 0&&O.resultFormat!==void 0&&O.orderByTime!==void 0&&O.tags!==void 0&&O.groupBy!==void 0&&O.select!==void 0)return O;const v=(0,ce.cloneDeep)(O);return new qr(v).target}function lr(O,v,b){const E=(0,ce.cloneDeep)(O),A=new qr(E);return A.addSelectPart(A.selectModels[b],v),A.target}function ba(O,v,b){const E=(0,ce.cloneDeep)(O),A=new qr(E),x=A.selectModels[b];return A.removeSelectPart(x,x[v]),A.target}function At(O,v,b,E){const A=[...O.select??[]];return A[v]=[...A[v]],A[v][b]={...A[v][b],params:E},{...O,select:A}}function Gr(O,v){const b=(0,ce.cloneDeep)(O),E=new qr(b);return E.addGroupBy(v),E.target}function Vn(O,v){const b=(0,ce.cloneDeep)(O),E=new qr(b);return E.removeGroupByPart(E.groupByParts[v],v),E.target}function ta(O,v,b){const E=[...O.groupBy??[]];return E[v]={...E[v],params:b},{...O,groupBy:E}}function Sa(O){const v=/\/\^(.*?)\$\//,b=O.match(v);return b&&b.length>1?b[1]:O}var ln=$(2863),Mn=$(78193),kn=$(50992),gr=$(45861),ra=$(61875),qt=$(51115);const Oa=[{label:"Show buckets",description:"List the available buckets (table)",value:"buckets()"},{label:"Simple query",description:"filter by measurement and field",value:`from(bucket: "db/rp")
  |> range(start: v.timeRangeStart, stop:v.timeRangeStop)
  |> filter(fn: (r) =>
    r._measurement == "example-measurement" and
    r._field == "example-field"
  )`},{label:"Grouped Query",description:"Group by (min/max/sum/median)",value:`// v.windowPeriod is a variable referring to the current optimized window period (currently: $interval)
from(bucket: v.bucket)
  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |> filter(fn: (r) => r["_measurement"] == "measurement1" or r["_measurement"] =~ /^.*?regex.*$/)
  |> filter(fn: (r) => r["_field"] == "field2" or r["_field"] =~ /^.*?regex.*$/)
  |> aggregateWindow(every: v.windowPeriod, fn: mean|median|max|count|derivative|sum)
  |> yield(name: "some-name")`},{label:"Filter by value",description:"Results between a min/max",value:`// v.bucket, v.timeRangeStart, and v.timeRange stop are all variables supported by the flux plugin and influxdb
from(bucket: v.bucket)
  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |> filter(fn: (r) => r["_value"] >= 10 and r["_value"] <= 20)`},{label:"Schema Exploration: (measurements)",description:"Get a list of measurement using flux",value:`import "influxdata/influxdb/v1"
v1.measurements(bucket: v.bucket)`},{label:"Schema Exploration: (fields)",description:"Return every possible key in a single table",value:`from(bucket: v.bucket)
  |> range(start: v.timeRangeStart, stop:v.timeRangeStop)
  |> keys()
  |> keep(columns: ["_value"])
  |> group()
  |> distinct()`},{label:"Schema Exploration: (tag keys)",description:"Get a list of tag keys using flux",value:`import "influxdata/influxdb/v1"
v1.tagKeys(bucket: v.bucket)`},{label:"Schema Exploration: (tag values)",description:"Get a list of tag values using flux",value:`import "influxdata/influxdb/v1"
v1.tagValues(
    bucket: v.bucket,
    tag: "host",
    predicate: (r) => true,
    start: -1d
)`}];class Hr extends ie.PureComponent{constructor(){super(...arguments),this.onFluxQueryChange=v=>{this.props.onChange({...this.props.query,query:v})},this.onSampleChange=v=>{this.props.onChange({...this.props.query,query:v.value}),this.forceUpdate()},this.getSuggestions=()=>{const v=[{label:"v.timeRangeStart",kind:Mn.q.Property,detail:"The start time"},{label:"v.timeRangeStop",kind:Mn.q.Property,detail:"The stop time"},{label:"v.windowPeriod",kind:Mn.q.Property,detail:"based on max data points"},{label:"v.defaultBucket",kind:Mn.q.Property,detail:"bucket configured in the datsource"},{label:"v.organization",kind:Mn.q.Property,detail:"org configured for the datsource"}],b=(0,ln.w)();return b.getVariables().forEach(E=>{const A="${"+E.name+"}";let x=b.replace(A);x===A&&(x=""),v.push({label:A,kind:Mn.q.Text,detail:`(Template Variable) ${x}`})}),v},this.editorDidMountCallbackHack=v=>{setTimeout(()=>v.layout(),100)}}render(){const{query:v,theme:b}=this.props,E=$r(b),A=(0,N.jsxs)("div",{children:["Type: ",(0,N.jsx)("i",{children:"ctrl+space"})," to show template variable suggestions ",(0,N.jsx)("br",{}),"Many queries can be copied from Chronograf"]});return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(kn.B,{height:"100%",containerStyles:E.editorContainerStyles,language:"sql",value:v.query||"",onBlur:this.onFluxQueryChange,onSave:this.onFluxQueryChange,showMiniMap:!1,showLineNumbers:!0,getSuggestions:this.getSuggestions,onEditorDidMount:this.editorDidMountCallbackHack}),(0,N.jsxs)("div",{className:(0,Ie.cx)("gf-form-inline",E.editorActions),children:[(0,N.jsx)(gr.z9,{icon:"external-link-alt",variant:"secondary",target:"blank",href:"https://docs.influxdata.com/influxdb/latest/query-data/get-started/",children:"Flux language syntax"}),(0,N.jsx)(ra.Y,{options:Oa,value:"Sample query",onChange:this.onSampleChange,className:(0,Ie.css)({marginTop:b.spacing(-.5),marginLeft:b.spacing(.5)})}),(0,N.jsx)("div",{className:"gf-form gf-form--grow",children:(0,N.jsx)("div",{className:"gf-form-label gf-form-label--grow"})}),(0,N.jsx)(qt.I,{width:5,tooltip:A,children:"Help"})]})]})}}const $r=O=>({editorContainerStyles:(0,Ie.css)({height:"200px",maxWidth:"100%",resize:"vertical",overflow:"auto",backgroundColor:O.isDark?O.colors.background.canvas:O.colors.background.primary,paddingBottom:O.spacing(1)}),editorActions:(0,Ie.css)({marginTop:"6px"})}),Fa=(0,Ke.cV)(Hr);var ni=$(11194);const ai=[{name:"AVG"},{name:"COUNT"},{name:"MAX"},{name:"MIN"},{name:"SUM"}],rt={name:"Interval",required:!0,options:()=>Promise.resolve([{label:"$__interval",value:"$__interval"}])},pt={name:"Fill",required:!1,options:()=>Promise.resolve([{label:"0",value:"0"},{label:"NULL",value:"NULL"},{label:"previous",value:"previous"}])},Cr=O=>[{name:"$__timeGroup",description:"Time grouping function",parameters:[O,rt,pt]},{name:"$__timeGroupAlias",description:"Time grouping function with time as alias",parameters:[O,rt,pt]},{name:"$__time",description:"An expression to rename the column to time",parameters:[O]},{name:"$__timeEpoch",parameters:[O]},{name:"$__unixEpochGroup",parameters:[O,rt,pt]},{name:"$__unixEpochGroupAlias",parameters:[O,rt,pt]}],Hi=["$__time","$__timeEpoch","$__timeFilter","$__timeFrom","$__timeTo","$__timeGroup","$__timeGroupAlias","$__unixEpochFilter","$__unixEpochNanoFilter","$__unixEpochNanoFrom","$__unixEpochNanoTo","$__unixEpochGroup","$__unixEpochGroupAlias"];var ii=$(13288),yn=$(75505),bn=$(81160),Qi=$(1906),zu=$(94452),na=$(22592),Ji=$(88673),hr=$(41778),cn=$(36580),Ur=$(27489),Sn=$(68143),On=$(38866);class Yi{transformMetricFindResponse(v){const b=[],E=v.fields.find(x=>x.name==="__text"),A=v.fields.find(x=>x.name==="__value");if(E&&A)for(let x=0;x<E.values.length;x++)b.push({text:""+E.values[x],value:""+A.values[x]});else for(const x of v.fields)for(const k of x.values)b.push({text:k});return(0,ce.uniqBy)(b,"text")}}var qu=$(6975);const ls=(0,ie.lazy)(()=>$.e(168).then($.bind($,45071)));function oi(O){const v=(0,Ke.of)(Ki);return(0,N.jsx)(ie.Suspense,{fallback:(0,N.jsx)(qu._,{text:"Loading editor",className:v.container}),children:(0,N.jsx)(ls,{...O})})}const Ki=O=>({container:(0,Ie.css)({marginBottom:"unset",marginLeft:O.spacing(1)})});var Xi=$(81045);function Hu(O){const v=typeof O.rawQuery=="string"?O.rawQuery:null;if(!v)return O;const b=(0,Xi.T)({refId:"Annotation",...O.target??{},rawSql:v});return{...O,rawQuery:void 0,workspace:void 0,subscription:void 0,queryType:void 0,target:b}}var Zi=$(97890);class cs extends cn.iy{constructor(v,b=(0,ln.w)()){super(v),this.templateSrv=b,this.interpolateVariable=(A,x)=>typeof A=="string"?x.multi||x.includeAll?this.getQueryModel().quoteLiteral(A):String(A).replace(/'/g,"''"):typeof A=="number"?A:Array.isArray(A)?A.map(Q=>this.getQueryModel().quoteLiteral(Q)).join(","):A,this.name=v.name,this.responseParser=new Yi,this.id=v.id;const E=v.jsonData||{};this.interval=E.timeInterval||"1m",this.db=this.getDB(),this.preconfiguredDatabase=E.database??"",this.annotations={prepareAnnotation:Hu,QueryEditor:oi}}getResponseParser(){return this.responseParser}interpolateVariablesInQueries(v,b){let E=v;return v&&v.length>0&&(E=v.map(A=>({...A,datasource:this.getRef(),rawSql:this.templateSrv.replace(A.rawSql,b,this.interpolateVariable),rawQuery:!0}))),E}filterQuery(v){return!v.hide}applyTemplateVariables(v,b){return{refId:v.refId,datasource:this.getRef(),rawSql:this.templateSrv.replace(v.rawSql,b,this.interpolateVariable),format:v.format}}query(v){if((0,Zi.C)()){const b=this.checkForDatabaseIssue(v);if(b){const E=new Error(b);return(0,ii.$)(()=>E)}}return v.targets.forEach(b=>{v.app===Qi.Jk.Dashboard||v.app===Qi.Jk.PanelViewer||(0,Ur.rR)("grafana_sql_query_executed",{datasource:b.datasource?.type,editorMode:b.editorMode,format:b.format,app:v.app})}),super.query(v)}checkForDatabaseIssue(v){if(this.type==="postgres"&&!this.preconfiguredDatabase)return`You do not currently have a default database configured for this data source. Postgres requires a default
             database with which to connect. Please configure one through the Data Sources Configuration page, or if you
             are using a provisioning file, update that configuration file with a default database.`;if(v.app!==Qi.Jk.Explore&&this.preconfiguredDatabase){for(const b of v.targets)if(b.editorMode===hr.lX.Builder&&b.dataset!==this.preconfiguredDatabase)return`The configuration for this panel's data source has been modified. The previous database used in this panel's
                   saved query is no longer available. Please update the query to use the new database option.
                   Previous query parameters will be preserved until the query is updated.`}}async metricFindQuery(v,b){const E=b?.range;if(E==null)return[];let A="tempvar";b&&b.variable&&b.variable.name&&(A=b.variable.name);const x={...b?.scopedVars,...(0,zu.c)({query:v,wildcardChar:"%",options:b})},k=this.templateSrv.replace(v,x,this.interpolateVariable),Q={refId:A,datasource:this.getRef(),rawSql:k,format:ni.gv.Table};let K;try{K=await this.runMetaQuery(Q,E)}catch(ae){throw console.error(ae),new Error("error when executing the sql query")}return this.getResponseParser().transformMetricFindResponse(K)}async runSql(v,b){const E=(0,na.E2)(),A=await this.runMetaQuery({rawSql:v,format:ni.gv.Table,refId:b?.refId},E);return new Ji.R(A)}runMetaQuery(v,b){const E=v.refId||"meta",A=[{...v,datasource:v.datasource||this.getRef(),refId:E}];return(0,yn.s)((0,Sn.AI)().fetch({url:"/api/ds/query",method:"POST",headers:this.getRequestHeaders(),data:{from:b.from.valueOf().toString(),to:b.to.valueOf().toString(),queries:A},requestId:E}).pipe((0,bn.T)(x=>(0,On.bE)(x,A).data[0]??{fields:[]})))}targetContainsTemplate(v){let b=v.rawSql;return Hi.forEach(E=>{b=b?.replace(E,"")||""}),this.templateSrv.containsTemplate(b)}}var si=$(52308);function ds({value:O,defaultValue:v,onChange:b,width:E}){const[A,x]=useState(!1);return jsx(Input,{type:"number",placeholder:String(v),value:A?"":O,onChange:k=>{if(k.currentTarget.value?.trim()==="")x(!0),b(v);else{x(!1);const Q=Number(k.currentTarget.value);Number.isNaN(Q)||b(Q)}},width:E})}const fs=O=>{const{onOptionsChange:v,options:b}=O,E=b.jsonData,A=E.maxIdleConnsAuto!==void 0?E.maxIdleConnsAuto:!1,x=de=>{const me={...b,jsonData:{...E,...de}};return v(me)},k=de=>me=>{x({[de]:me})},Q=de=>{x(A&&de?{maxOpenConns:de,maxIdleConns:de}:{maxOpenConns:de})},K=()=>{let de,me;A?(me=E.maxOpenConns,de=E.maxIdleConns):E.maxOpenConns!==void 0&&(me=E.maxOpenConns,de=E.maxOpenConns),x({maxIdleConnsAuto:!A,maxIdleConns:de,maxOpenConns:me})},ae=40;return jsxs(ConfigSubSection,{title:"Connection limits",children:[jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"Max open"}),jsx(Tooltip,{content:jsxs("span",{children:["The maximum number of open connections to the database. If ",jsx("i",{children:"Max idle connections"})," is greater than 0 and the ",jsx("i",{children:"Max open connections"})," is less than ",jsx("i",{children:"Max idle connections"}),", then",jsx("i",{children:"Max idle connections"})," will be reduced to match the ",jsx("i",{children:"Max open connections"})," limit. If set to 0, there is no limit on the number of open connections."]}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:jsx(NumberInput,{value:E.maxOpenConns,defaultValue:config.sqlConnectionLimits.maxOpenConns,onChange:de=>{Q(de)},width:ae})}),jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"Auto max idle"}),jsx(Tooltip,{content:jsxs("span",{children:["If enabled, automatically set the number of ",jsx("i",{children:"Maximum idle connections"})," to the same value as",jsx("i",{children:" Max open connections"}),". If the number of maximum open connections is not set it will be set to the default (",config.sqlConnectionLimits.maxIdleConns,")."]}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:jsx(Switch,{value:A,onChange:K})}),jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"Max idle"}),jsx(Tooltip,{content:jsxs("span",{children:["The maximum number of connections in the idle connection pool.If ",jsx("i",{children:"Max open connections"})," is greater than 0 but less than the ",jsx("i",{children:"Max idle connections"}),", then the ",jsx("i",{children:"Max idle connections"})," ","will be reduced to match the ",jsx("i",{children:"Max open connections"})," limit. If set to 0, no idle connections are retained."]}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:A?jsx(InlineLabel,{width:ae,children:b.jsonData.maxIdleConns}):jsx(NumberInput,{value:E.maxIdleConns,defaultValue:config.sqlConnectionLimits.maxIdleConns,onChange:de=>{k("maxIdleConns")(de)},width:ae})}),jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"Max lifetime"}),jsx(Tooltip,{content:jsx("span",{children:"The maximum amount of time in seconds a connection may be reused. If set to 0, connections are reused forever."}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:jsx(NumberInput,{value:E.connMaxLifetime,defaultValue:config.sqlConnectionLimits.connMaxLifetime,onChange:de=>{k("connMaxLifetime")(de)},width:ae})})]})},tr=()=>{const O=useStyles2(Ca);return jsx("hr",{className:O.horizontalDivider})},Ca=O=>({horizontalDivider:css({borderTop:`1px solid ${O.colors.border.weak}`,margin:O.spacing(2,0),width:"100%"})}),eo=O=>{const{editorProps:v,showCACert:b,showKeyPair:E=!0}=O,{secureJsonFields:A}=v.options;return jsxs(Fragment,{children:[E?jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"TLS/SSL Client Certificate"}),jsx(Tooltip,{content:jsx("span",{children:"To authenticate with an TLS/SSL client certificate, provide the client certificate here."}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:jsx(SecretTextArea,{placeholder:"-----BEGIN CERTIFICATE-----",cols:45,rows:7,isConfigured:A&&A.tlsClientCert,onChange:onUpdateDatasourceSecureJsonDataOption(v,"tlsClientCert"),onReset:()=>{updateDatasourcePluginResetOption(v,"tlsClientCert")}})}):null,b?jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"TLS/SSL Root Certificate"}),jsx(Tooltip,{content:jsx("span",{children:"If the selected TLS/SSL mode requires a server root certificate, provide it here."}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:jsx(SecretTextArea,{placeholder:"-----BEGIN CERTIFICATE-----",cols:45,rows:7,isConfigured:A&&A.tlsCACert,onChange:onUpdateDatasourceSecureJsonDataOption(v,"tlsCACert"),onReset:()=>{updateDatasourcePluginResetOption(v,"tlsCACert")}})}):null,E?jsx(Field,{label:jsx(Label,{children:jsxs(Stack,{gap:.5,children:[jsx("span",{children:"TLS/SSL Client Key"}),jsx(Tooltip,{content:jsx("span",{children:"To authenticate with a client TLS/SSL certificate, provide the key here."}),children:jsx(Icon,{name:"info-circle",size:"sm"})})]})}),children:jsx(SecretTextArea,{placeholder:"-----BEGIN RSA PRIVATE KEY-----",cols:45,rows:7,isConfigured:A&&A.tlsClientKey,onChange:onUpdateDatasourceSecureJsonDataOption(v,"tlsClientKey"),onReset:()=>{updateDatasourcePluginResetOption(v,"tlsClientKey")}})}):null]})};var Qu=$(25992);const Lr=(0,Qu.DW)("features.plugins.sql");function Ju({onOptionsChange:O,options:v}){useEffect(()=>{const b=v.jsonData;let E={...v},A=!1;if(v.database&&(sqlPluginLogger.logDebug(`Migrating from options.database with value ${v.database} for ${v.name}`),E.database="",E.jsonData={...b,database:v.database},A=!0),b.maxOpenConns===void 0&&b.maxIdleConns===void 0&&b.maxIdleConnsAuto===void 0){const{maxOpenConns:x,maxIdleConns:k}=config.sqlConnectionLimits;sqlPluginLogger.logDebug(`Setting default max open connections to ${x} and setting max idle connection to ${k}`),E.jsonData={...E.jsonData,maxOpenConns:x,maxIdleConns:k,maxIdleConnsAuto:!0},A=!0}if(b.connMaxLifetime===void 0){const{connMaxLifetime:x}=config.sqlConnectionLimits;E.jsonData={...E.jsonData,connMaxLifetime:x},A=!0}A&&O(E)},[O,v])}var ps=$(25274),Wc=$(36656),to=$(24726),Rt=$(1578);function Yu(O){const v=[];for(const b of O){let E="text";switch(b.type?.toUpperCase()){case"BOOLEAN":case"BOOL":{E="boolean";break}case"BYTES":case"VARCHAR":{E="text";break}case"FLOAT":case"FLOAT64":case"INT":case"INTEGER":case"INT64":case"NUMERIC":case"BIGNUMERIC":{E="number";break}case"DATE":{E="date";break}case"TIMESTAMP(NANOSECOND, NONE)":case"DATETIME":{E="datetime";break}case"TIME":{E="time";break}case"TIMESTAMP":{E="datetime";break}case"GEOGRAPHY":{E="text";break}default:break}v.push({...b,raqbFieldType:E,icon:vs(b.type.toUpperCase())})}return v}function vs(O){switch(O){case"TIME":case"DATETIME":case"TIMESTAMP":return"clock-nine";case"BOOLEAN":return"toggle-off";case"INTEGER":case"FLOAT":case"FLOAT64":case"INT":case"SMALLINT":case"BIGINT":case"TINYINT":case"BYTEINT":case"INT64":case"NUMERIC":case"DECIMAL":return"calculator-alt";case"CHAR":case"VARCHAR":case"STRING":case"BYTES":case"TEXT":case"TINYTEXT":case"MEDIUMTEXT":case"LONGTEXT":return"text";case"GEOGRAPHY":return"map";default:return}}function gs(O){return O[0]==='"'&&O[O.length-1]==='"'?O.substring(1,O.length-1).replace(/""/g,'"'):O[0]==="`"&&O[O.length-1]==="`"?O.substring(1,O.length-1):O}function hs(O){return"'"+O.replace(/'/g,"''")+"'"}function ms({sql:O,table:v}){let b="";if(!O||!(0,ps.YW)(O.columns))return b;const E=O.columns.map(A=>({...A,parameters:A.parameters?.map(x=>({...x,name:ys(x.name)}))}));if(b+=(0,ps.oF)(E),v&&(b+=`FROM "${v}" `),b+='WHERE "time" >= $__timeFrom AND "time" <= $__timeTo ',O.whereString){const A=new RegExp("(\\s?)([^\\(]\\S+)(\\s?=)","g"),k=O.whereString.replace(A,'$1"$2"$3');b+=`AND ${k} `}if(O.groupBy?.[0]?.property.name){const A=O.groupBy.map(x=>`"${x.property.name}"`).filter(x=>!(0,ce.isEmpty)(x));b+=`GROUP BY ${A.join(", ")} `}return O.orderBy?.property.name&&(b+=`ORDER BY "${O.orderBy.property.name}" `),O.orderBy?.property.name&&O.orderByDirection&&(b+=`${O.orderByDirection} `),ro(O.limit)&&(b+=`LIMIT ${O.limit}`),b}function ys(O){return O==="*"?O:`"${O}"`}const ro=O=>O!==void 0&&O>=0;function Ea(O){return bs(O)?O:`"${O}"`}function bs(O){const v=/^[a-zA-Z_][a-zA-Z0-9_$]*$/g.test(O);return!no.includes(O.toUpperCase())&&v}const no=["ACCESSIBLE","ADD","ALL","ALTER","ANALYZE","AND","AS","ASC","ASENSITIVE","BEFORE","BETWEEN","BIGINT","BINARY","BLOB","BOTH","BY","CALL","CASCADE","CASE","CHANGE","CHAR","CHARACTER","CHECK","COLLATE","COLUMN","CONDITION","CONSTRAINT","CONTINUE","CONVERT","CREATE","CROSS","CUBE","CUME_DIST","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","CURSOR","DATABASE","DATABASES","DAY_HOUR","DAY_MICROSECOND","DAY_MINUTE","DAY_SECOND","DEC","DECIMAL","DECLARE","DEFAULT","DELAYED","DELETE","DENSE_RANK","DESC","DESCRIBE","DETERMINISTIC","DISTINCT","DISTINCTROW","DIV","DOUBLE","DROP","DUAL","EACH","ELSE","ELSEIF","EMPTY","ENCLOSED","ESCAPED","EXCEPT","EXISTS","EXIT","EXPLAIN","FALSE","FETCH","FIRST_VALUE","FLOAT","FLOAT4","FLOAT8","FOR","FORCE","FOREIGN","FROM","FULLTEXT","FUNCTION","GENERATED","GET","GRANT","GROUP","GROUPING","GROUPS","HAVING","HIGH_PRIORITY","HOUR_MICROSECOND","HOUR_MINUTE","HOUR_SECOND","IF","IGNORE","IN","INDEX","INFILE","INNER","INOUT","INSENSITIVE","INSERT","INT","INT1","INT2","INT3","INT4","INT8","INTEGER","INTERSECT","INTERVAL","INTO","IO_AFTER_GTIDS","IO_BEFORE_GTIDS","IS","ITERATE","JOIN","JSON_TABLE","KEY","KEYS","KILL","LAG","LAST_VALUE","LATERAL","LEAD","LEADING","LEAVE","LEFT","LIKE","LIMIT","LINEAR","LINES","LOAD","LOCALTIME","LOCALTIMESTAMP","LOCK","LONG","LONGBLOB","LONGTEXT","LOOP","LOW_PRIORITY","MASTER_BIND","MASTER_SSL_VERIFY_SERVER_CERT","MATCH","MAXVALUE","MEDIUMBLOB","MEDIUMINT","MEDIUMTEXT","MIDDLEINT","MINUTE_MICROSECOND","MINUTE_SECOND","MOD","MODIFIES","NATURAL","NOT","NO_WRITE_TO_BINLOG","NTH_VALUE","NTILE","NULL","NUMERIC","OF","ON","OPTIMIZE","OPTIMIZER_COSTS","OPTION","OPTIONALLY","OR","ORDER","OUT","OUTER","OUTFILE","OVER","PARTITION","PERCENT_RANK","PRECISION","PRIMARY","PROCEDURE","PURGE","RANGE","RANK","READ","READS","READ_WRITE","REAL","RECURSIVE","REFERENCES","REGEXP","RELEASE","RENAME","REPEAT","REPLACE","REQUIRE","RESIGNAL","RESTRICT","RETURN","REVOKE","RIGHT","RLIKE","ROW","ROWS","ROW_NUMBER","SCHEMA","SCHEMAS","SECOND_MICROSECOND","SELECT","SENSITIVE","SEPARATOR","SET","SHOW","SIGNAL","SMALLINT","SPATIAL","SPECIFIC","SQL","SQLEXCEPTION","SQLSTATE","SQLWARNING","SQL_BIG_RESULT","SQL_CALC_FOUND_ROWS","SQL_SMALL_RESULT","SSL","STARTING","STORED","STRAIGHT_JOIN","SYSTEM","TABLE","TERMINATED","THEN","TINYBLOB","TINYINT","TINYTEXT","TO","TRAILING","TRIGGER","TRUE","UNDO","UNION","UNIQUE","UNLOCK","UNSIGNED","UPDATE","USAGE","USE","USING","UTC_DATE","UTC_TIME","UTC_TIMESTAMP","VALUES","VARBINARY","VARCHAR","VARCHARACTER","VARYING","VIRTUAL","WHEN","WHERE","WHILE","WINDOW","WITH","WRITE","XOR","YEAR_MONTH","ZEROFILL"];function Gn(O){return`SELECT table_name FROM information_schema.tables WHERE table_schema = ${O!==void 0?$n(O):"database()"} ORDER BY table_name`}function zc(){return"SELECT DISTINCT TABLE_SCHEMA from information_schema.TABLES where TABLE_TYPE != 'SYSTEM VIEW' ORDER BY TABLE_SCHEMA"}function Ku(O,v){let b="SELECT column_name, data_type FROM information_schema.columns WHERE ";return b+=ao(O,v),b+=" ORDER BY column_name",b}function ao(O,v){let b="";if(O.includes(".")){const E=O.split(".");return b="table_schema = "+$n(E[0]),b+=" AND table_name = "+$n(E[1]),b}else return b=`table_schema = ${v!==void 0?$n(v):"database()"} AND table_name = `+$n(O),b}function $n(O){return hs(gs(O))}var ui=$(64237);const Ss=({getMeta:O})=>(v,b)=>({...b&&(0,ui.N)(v,b),customStatementPlacement:Fs,customSuggestionKinds:oo(O)}),io={afterDatabase:"afterDatabase"},Os={tablesWithinDatabase:"tablesWithinDatabase"},li="FROM",Fs=()=>[{id:io.afterDatabase,resolve:(O,v,b)=>!!(O?.is(Rt.ks.Delimiter,".")&&v?.value===li&&(b?.is(Rt.ks.IdentifierQuote)||b?.isIdentifier())&&O?.getPreviousUntil(Rt.ks.Keyword,[Rt.ks.IdentifierQuote],li)?.filter(E=>E.isIdentifier()).length===1)}],oo=O=>()=>[{id:Rt.ng.Tables,overrideDefault:!0,suggestionsResolver:async v=>{const b=so(v.currentToken);return(await O({schema:b})).map(ci(v))}},{id:Rt.ng.Columns,overrideDefault:!0,suggestionsResolver:async v=>{const b=uo(v.currentToken),E=so(b),A=Xu(b);return!E||!A?[]:(await O({schema:E,table:A})).map(ci(v))}},{id:Os.tablesWithinDatabase,applyTo:[io.afterDatabase],suggestionsResolver:async v=>{const b=so(v.currentToken);return(await O({schema:b})).map(ci(v))}}];function ci(O){return function(v){return{label:v.name,insertText:v.completion??v.name,command:{id:"editor.action.triggerSuggest",title:""},kind:Rt.Io.Field,sortText:Rt.mY.High,range:{...O.range,startColumn:O.range.endColumn,endColumn:O.range.endColumn}}}}function so(O){if(O?.isIdentifier()&&O.value[O.value.length-1]!==".")return O.value;if(O?.is(Rt.ks.Delimiter,"."))return O.getPreviousOfType(Rt.ks.Identifier)?.value;if(O?.is(Rt.ks.IdentifierQuote))return O.getPreviousOfType(Rt.ks.Identifier)?.value||O.getNextOfType(Rt.ks.Identifier)?.value}function Xu(O){return O?.getNextOfType(Rt.ks.Identifier)?.value}const Zu=O=>(O?.getPreviousOfType(Rt.ks.Keyword,"SELECT")??null)?.getNextOfType(Rt.ks.Keyword,li),uo=O=>{const b=Zu(O)?.getNextOfType(Rt.ks.Identifier);return b?.isKeyword()&&b.next?.is(Rt.ks.Parenthesis,"(")?null:b};class el extends cs{constructor(v,b=(0,ln.w)()){super(v),this.instanceSettings=v,this.templateSrv=b,this.getFunctions=()=>{const E=[...ai,{name:"VARIANCE"},{name:"STDDEV"}],A={name:"Column",required:!0,options:k=>this.fetchFields(k)},x={name:"Interval",required:!0,options:()=>Promise.resolve([{label:"$__interval",value:"$__interval"}])};return[...E.map(k=>({...k,parameters:[A]})),{name:"$__timeGroup",description:"Time grouping function",parameters:[A,x]},{name:"$__timeGroupAlias",description:"Time grouping function with time as alias",parameters:[A,x]}]}}getQueryModel(){return{quoteLiteral:hs}}getSqlLanguageDefinition(){if(this.sqlLanguageDefinition!==void 0)return this.sqlLanguageDefinition;const v={getMeta:b=>this.fetchMeta(b)};return this.sqlLanguageDefinition={id:"flightsql",completionProvider:Ss(v),formatter:si.s},this.sqlLanguageDefinition}async fetchDatasets(){return Promise.resolve(["iox"])}async fetchTables(v){const b=Gn(v),A=(await this.runSql(b,{refId:"tables"})).map(x=>Ea(x[0]));return A.unshift(...this.getTemplateVariables()),A}async fetchFields(v){if(!v.dataset||!v.table)return[];const b=this.templateSrv.replace(v.table),E=Ku(b,v.dataset),x=(await this.runSql(E,{refId:`fields-${to.A}`})).map(k=>({name:k[0],text:k[0],value:Ea(k[0]),type:k[1],label:k[0]}));return x.unshift(...this.getTemplateVariables().map(k=>({name:k,text:k,value:Ea(k),type:"",label:k}))),Yu(x)}getTemplateVariables(){return this.templateSrv.getVariables().map(v=>`$${v.name}`)}async fetchMeta(v){const b=this.instanceSettings.jsonData.database;return!v?.schema&&b?(await this.fetchTables(b)).map(A=>({name:A,completion:`${b}.${A}`,kind:Rt.Io.Class})):!v?.schema&&!b?(await this.fetchDatasets()).map(A=>({name:A,completion:`${A}.`,kind:Rt.Io.Module})):!v?.table&&(!b||v?.schema)?(await this.fetchTables(v?.schema)).map(A=>({name:A,completion:A,kind:Rt.Io.Class})):v?.table&&v.schema?(await this.fetchFields({dataset:v.schema,table:v.table})).map(A=>({name:A.name,completion:A.value,kind:Rt.Io.Field})):[]}getDB(){return this.db!==void 0?this.db:{datasets:()=>this.fetchDatasets(),tables:v=>this.fetchTables(v),fields:v=>this.fetchFields(v),validateQuery:(v,b)=>Promise.resolve({query:v,error:"",isError:!1,isValid:!0}),dsID:()=>this.id,toRawSql:ms,functions:()=>this.getFunctions(),getEditorLanguageDefinition:()=>this.getSqlLanguageDefinition()}}}class Cs extends ie.PureComponent{constructor(v){super(v);const{datasource:b}=v;this.datasource=new el({url:b.urls[0],access:b.access,id:b.id,jsonData:{allowCleartextPasswords:!1,tlsAuth:!1,tlsAuthWithCACert:!1,tlsSkipVerify:!1,maxIdleConns:1,maxOpenConns:1,maxIdleConnsAuto:!0,connMaxLifetime:1,timezone:"",user:"",database:"",url:b.urls[0],timeInterval:""},meta:b.meta,name:b.name,readOnly:!1,type:b.type,uid:b.uid},b.templateSrv)}transformQuery(v){const b=(0,Xi.T)(v);return{...b,dataset:"iox",sql:{...b.sql,limit:void 0}}}render(){const{query:v,theme:b,onRunQuery:E,onChange:A}=this.props,x=tl(b),k=()=>E(),Q=ae=>{A({...ae})},K=(0,N.jsxs)("div",{children:["Type: ",(0,N.jsx)("i",{children:"ctrl+space"})," to show template variable suggestions ",(0,N.jsx)("br",{}),"Many queries can be copied from Chronograf"]});return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(oi,{datasource:this.datasource,query:this.transformQuery(v),onRunQuery:k,onChange:Q,queryHeaderProps:{dialect:"influx"}}),(0,N.jsxs)("div",{className:(0,Ie.cx)("gf-form-inline",x.editorActions),children:[(0,N.jsx)(gr.z9,{icon:"external-link-alt",variant:"secondary",target:"blank",href:"https://docs.influxdata.com/influxdb/cloud-serverless/query-data/sql/",children:"SQL language syntax"}),(0,N.jsx)("div",{className:"gf-form gf-form--grow",children:(0,N.jsx)("div",{className:"gf-form-label gf-form-label--grow"})}),(0,N.jsx)(qt.I,{width:5,tooltip:K,children:"Help"})]})]})}}const tl=O=>({editorContainerStyles:(0,Ie.css)({height:"200px",maxWidth:"100%",resize:"vertical",overflow:"auto",backgroundColor:O.isDark?O.colors.background.canvas:O.colors.background.primary,paddingBottom:O.spacing(1)}),editorActions:(0,Ie.css)({marginTop:"6px"})}),Es=(0,Ke.cV)(Cs);var rl=$(71599);const nl=({isRaw:O,onChange:v})=>{const[b,E]=(0,ie.useState)(!1);return(0,ie.useEffect)(()=>{E(!1)},[O]),O?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(gr.$n,{"aria-label":"Switch to visual editor",icon:"pen",variant:"secondary",type:"button",onClick:()=>{E(!0)}}),(0,N.jsx)(rl.u,{isOpen:b,title:"Switch to visual editor mode",body:"Are you sure to switch to visual editor mode? You will lose the changes done in raw query mode.",confirmText:"Yes, switch to editor mode",dismissText:"No, stay in raw query mode",onConfirm:()=>{v(!1)},onDismiss:()=>{E(!1)}})]}):(0,N.jsx)(gr.$n,{"aria-label":"Switch to text editor",icon:"pen",variant:"secondary",type:"button",onClick:()=>{v(!0)}})};var Er=$(41654),wa=$(87105);const lo=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"},{label:"Logs",value:"logs"}],Aa="time_series";var ht=$(84596);function Ta(O){const[v,b]=(0,ie.useState)(O),E=(0,ht.A)(O);return(0,ie.useEffect)(()=>{E!==O&&v!==O&&b(O)},[O,v,E]),[v,b]}const co=({query:O,onChange:v,onRunQuery:b})=>{const[E,A]=Ta(O.query),[x,k]=Ta(O.alias),Q=(0,ie.useId)(),K=(0,ie.useId)(),ae=O.resultFormat??Aa,de=()=>{v({...O,query:E,alias:x,resultFormat:ae}),b()};return(0,N.jsxs)(Er.B,{direction:"column",children:[(0,N.jsx)(wa.f,{"aria-label":"query",rows:3,spellCheck:!1,placeholder:"InfluxDB Query",onBlur:de,onChange:me=>{A(me.currentTarget.value)},value:E??""}),(0,N.jsxs)(Er.B,{children:[(0,N.jsx)(Me.I,{htmlFor:K,label:"Format as",children:(0,N.jsx)(le.l6,{inputId:K,onChange:me=>{v({...O,resultFormat:me.value}),b()},value:ae,options:lo})}),(0,N.jsx)(Me.I,{htmlFor:Q,label:"Alias by",children:(0,N.jsx)(ye.p,{id:Q,type:"text",spellCheck:!1,placeholder:"Naming pattern",onBlur:de,onChange:me=>{k(me.currentTarget.value)},value:x??""})})]})]})};var mr=$(52042),di=$(65642);const fi=O=>{let v="",{type:b,templateService:E,scopedVars:A,database:x,measurement:k,retentionPolicy:Q,tags:K,withKey:ae,withMeasurementFilter:de}=O;switch(b){case"RETENTION_POLICIES":return'SHOW RETENTION POLICIES on "'+x+'"';case"FIELDS":return!k||k===""?"SHOW FIELD KEYS":(k&&!k.match(/^\/.*\/|^$/)&&(k='"'+k+'"',Q&&Q!==bt&&(Q='"'+Q+'"',k=Q+"."+k)),"SHOW FIELD KEYS FROM "+k);case"TAG_KEYS":v="SHOW TAG KEYS";break;case"TAG_VALUES":v="SHOW TAG VALUES";break;case"MEASUREMENTS":v="SHOW MEASUREMENTS",de&&(v+=" WITH MEASUREMENT =~ /(?i)"+(0,It.$f)(de)+"/");break;default:return v}if(k&&(!k.match("^/.*/")&&!k.match(/^merge\(.*\)/)&&(k='"'+k+'"'),Q&&Q!==bt&&(Q='"'+Q+'"',k=Q+"."+k),k!==""&&(v+=" FROM "+k)),ae){let me=ae;me.endsWith("::tag")&&(me=me.slice(0,-5)),v+=' WITH KEY = "'+me+'"'}if(K&&K.length>0){const me=(0,ce.reduce)(K,(De,We)=>(We.key&&We.key===ae||We.operator===">"||We.operator==="<"||De.push(en(We,De.length,E,A,!0)),De),[]);me.length>0&&(v+=" WHERE "+me.join(" "))}return b==="MEASUREMENTS"&&(v+=" LIMIT 100"),v};function en(O,v,b,E,A){let x="",k=O.operator,Q=O.value;v>0&&(x=(O.condition||"AND")+" "),k||(/^\/.*\/$/.test(O.value)?k="=~":k="="),(Q===""||k!=="=~"&&k!=="!~")&&(Q="'"+Q.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")+"'"),k!=="=~"&&k!=="!~"?A?Q=b.replace(Q,E):k!==">"&&k!=="<"&&(Q="'"+Q.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")+"'"):A&&(Q=b.replace(Q,E,"regex"));let K=`"${O.key}"`;return O.key.endsWith("::tag")&&(K=`"${O.key.slice(0,-5)}"::tag`),O.key.endsWith("::field")&&(K=`"${O.key.slice(0,-7)}"::field`),x+K+" "+k+" "+Q}const Un=async O=>{const{type:v,datasource:b,scopedVars:E,measurement:A,retentionPolicy:x,tags:k,withKey:Q,withMeasurementFilter:K}=O,ae=fi({type:v,scopedVars:E,measurement:A,retentionPolicy:x,tags:k,withKey:Q,withMeasurementFilter:K,templateService:b.templateSrv,database:b.database}),de=x?b.templateSrv.replace(x,{},"regex"):"",me={query:ae,policy:de,rawQuery:!0,refId:"metadataQuery"};if(di.Ay.featureToggles.influxdbBackendMigration)return b.runMetadataQuery(me);{const De={policy:me.policy};return b.metricFindQuery({refId:"run-explore-query",query:ae},De)}};async function Rr(O){return(await Un({type:"RETENTION_POLICIES",datasource:O})).map(b=>b.text)}async function ws(O,v,b){return(await Un({type:"MEASUREMENTS",datasource:O,tags:v,withMeasurementFilter:b})).map(A=>A.text)}async function al(O,v,b){return(await Un({type:"TAG_KEYS",datasource:O,measurement:v,retentionPolicy:b})).map(A=>A.text)}async function fo(O,v,b,E,A){return b.endsWith("::field")?[]:(await Un({type:"TAG_VALUES",tags:v,withKey:b,datasource:O,measurement:E,retentionPolicy:A})).map(k=>k.text)}async function dn(O,v,b){return(await Un({type:"FIELDS",datasource:O,measurement:v,retentionPolicy:b})).map(A=>A.text)}function aa(O,v){return O.filter(b=>b.key.endsWith("::tag")||v.has(b.key+"::tag"))}function jr(O){return{label:O,value:O}}function Bn(O){if(O==null)throw new Error("value must not be nullish");return O}function pi(){const O=Lt.getCategories(),v=[];return Object.keys(O).forEach(E=>{const A=O[E].map(x=>jr(x.type));v.push({label:E,options:A})}),v}async function As(O,v){const b=await v(),E={...O},A=new qr(E),x=[];return A.hasFill()||x.push(jr("fill(null)")),A.hasGroupByTime()||x.push(jr("time($interval)")),b.forEach(k=>{x.push(jr(`tag(${k})`))}),x}function Ts(O,v){const b=Lt.create(O).def,E=(O.params??[]).map(A=>A.toString());if(E.length!==b.params.length)throw new Error("Invalid query-segment");return E.map((A,x)=>{const k=b.params[x];return k.dynamicLookup?{value:A,options:Bn(v.get(`${b.type}_${x}`))}:k.options!=null?{value:A,options:()=>Promise.resolve(k.options)}:{value:A,options:null}})}function Fn(O,v){return O.map(b=>({name:b.type,params:Ts(b,v)}))}function _s(O){return(0,ln.w)().getVariables().map(O)}function vi(O,v,b){let E=_s(v);return b&&(E=E.filter(A=>A.indexOf(b)>-1)),O.then(A=>[...E,...A])}function gi(O){return`/^$${O.name}$/`}function Ls(O){return`$${O.name}`}const _a=(0,Ie.css)({paddingRight:"4px"}),po=(0,Ie.cx)("width-8",_a),vo=({format:O,inputId:v,onChange:b})=>(0,N.jsx)(le.l6,{inputId:v,className:po,onChange:E=>{b(Bn(E.value))},value:O,options:lo});var La=$(20301),Rs=$(76459),js=$.n(Rs),xs=$(41053);const Is=(0,Ie.css)({minWidth:"160px"}),Ds=O=>O,il=({loadOptions:O,allowCustomValue:v,onChange:b,onClose:E})=>{const A=js()(O,1e3,{leading:!0});return(0,N.jsx)("div",{className:Is,children:(0,N.jsx)(le.DW,{formatCreateLabel:Ds,defaultOptions:!0,autoFocus:!0,isOpen:!0,onCloseMenu:E,allowCustomValue:v,loadOptions:A,onChange:b,createOptionPosition:"first"})})},ol=({loadOptions:O,allowCustomValue:v,onChange:b,onClose:E})=>{const[A,x]=(0,xs.A)(O,[O]);return(0,ie.useEffect)(()=>{x("")},[x,O]),(0,N.jsx)("div",{className:Is,children:(0,N.jsx)(le.l6,{isLoading:A.loading,formatCreateLabel:Ds,autoFocus:!0,isOpen:!A.loading,onCloseMenu:E,allowCustomValue:v,options:A.value??[],onChange:b,createOptionPosition:"first"})})},Ra=({loadOptions:O,filterByLoadOptions:v,allowCustomValue:b,onChange:E,onClose:A})=>v?(0,N.jsx)(il,{loadOptions:O,allowCustomValue:b,onChange:E,onClose:A}):(0,N.jsx)(ol,{loadOptions:O,allowCustomValue:b,onChange:E,onClose:A}),ja=({initialValue:O,onChange:v,onClose:b})=>{const[E,A]=Ta(O);return(0,N.jsx)(ye.p,{autoFocus:!0,type:"text",spellCheck:!1,onBlur:b,onKeyDown:x=>{x.key==="Enter"&&v(E)},onChange:x=>{A(x.currentTarget.value)},value:E})},sl=(0,Ie.css)({width:"auto",cursor:"pointer"}),Cn=({value:O,buttonClassName:v,loadOptions:b,filterByLoadOptions:E,allowCustomValue:A,onChange:x})=>{const[k,Q]=(0,ie.useState)(!1);if(k)return b!==void 0?(0,N.jsx)(Ra,{loadOptions:b,filterByLoadOptions:E??!1,allowCustomValue:A,onChange:K=>{Q(!1),x(K)},onClose:()=>{Q(!1)}}):(0,N.jsx)(ja,{initialValue:O,onClose:()=>{Q(!1)},onChange:K=>{Q(!1),x({value:K,label:K})}});{const K=(0,Ie.cx)(sl,v);return(0,N.jsx)(Ge.c,{as:"button",className:K,onClick:()=>{Q(!0)},children:O})}},Ps=({policy:O,measurement:v,onChange:b,getPolicyOptions:E,getMeasurementOptions:A})=>{const x=async()=>{const Q=await E();return(Q.some(ae=>ae===bt)?Q:[bt,...Q]).map(jr)},k=async Q=>(await A(Q)).map(jr);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(Cn,{allowCustomValue:!0,value:O??"using default policy",loadOptions:x,onChange:Q=>{b(Q.value,v)}}),(0,N.jsx)(Cn,{allowCustomValue:!0,value:v??"select measurement",loadOptions:k,filterByLoadOptions:!0,onChange:Q=>{b(O,Q.value)}}),v&&(0,N.jsx)(La.Z,{style:{marginRight:"4px"},"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>{b(O,void 0)}})]})},xa=({value:O,onChange:v,isWide:b,placeholder:E})=>{const[A,x]=Ta(O),k=()=>{v(A===""?void 0:A)};return(0,N.jsx)(N.Fragment,{children:(0,N.jsx)(ye.p,{placeholder:E,className:(0,Ie.cx)(b??!1?"width-14":"width-8",_a),type:"text",spellCheck:!1,onBlur:k,onChange:Q=>{x(Q.currentTarget.value)},value:A??""})})},go=[{label:"ascending",value:"ASC"},{label:"descending",value:"DESC"}],ho=(0,Ie.cx)("width-9",_a),Ia=({value:O,onChange:v,inputId:b})=>(0,N.jsx)(N.Fragment,{children:(0,N.jsx)(le.l6,{inputId:b,className:ho,onChange:E=>{v(Bn(E.value))},value:O,options:go})}),ia=({loadOptions:O,allowCustomValue:v,onAdd:b})=>(0,N.jsx)(Cn,{value:"+",loadOptions:O,allowCustomValue:v,onChange:E=>{b(Bn(E.value))}}),Da=(0,Ie.css)({paddingRight:"0",marginRight:"0"}),mo=(0,Ie.css)({paddingLeft:"0",paddingRight:"0",marginLeft:"0",marginRight:"0"}),yt=O=>(0,Ie.cx)("gf-form-label",(0,Ie.css)({paddingLeft:"0",lineHeight:O.typography.body.lineHeight,fontSize:O.typography.body.fontSize})),Ot=({name:O,params:v,onChange:b})=>{const E=(0,Ke.$j)(),A=(0,ie.useMemo)(()=>yt(E),[E]),x=(k,Q)=>{const K=v.map(ae=>ae.value);K[Q]=k,b(K)};return(0,N.jsxs)("div",{className:A,children:[(0,N.jsx)("button",{className:(0,Ie.cx)("gf-form-label",Da),children:O}),"(",v.map((k,Q)=>{const{value:K,options:ae}=k,de=Q===v.length-1,me=ae!==null?()=>ae().then(De=>De.map(jr)):void 0;return(0,N.jsxs)(ie.Fragment,{children:[(0,N.jsx)(Cn,{allowCustomValue:!0,value:K,buttonClassName:mo,loadOptions:me,onChange:De=>{x(Bn(De.value),Q)}}),!de&&","]},Q)}),")"]})},oa=({parts:O,getNewPartOptions:v,onAddNewPart:b,onRemovePart:E,onChange:A})=>(0,N.jsxs)(N.Fragment,{children:[O.map((x,k)=>(0,N.jsxs)(ie.Fragment,{children:[(0,N.jsx)(Ot,{name:x.name,params:x.params,onRemove:()=>{E(k)},onChange:Q=>{A(k,Q)}}),(0,N.jsx)(La.Z,{style:{marginRight:"4px"},"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>{E(k)}})]},k)),(0,N.jsx)(ia,{loadOptions:v,onAdd:b})]});function Wn(O){return/^\/.*\/$/.test(O)}function sa(O){return O.operator??(Wn(O.value)?"=~":"=")}function zn(O,v){return v?void 0:O.condition??"AND"}function fn(O,v){const b=O==="=~"||O==="!~";return Wn(v)?b?O:"=~":b?"=":O}const ul=["=","!=","<>","<",">",">=","<=","=~","!~","Is","Is Not"],yo=["AND","OR"],Ns=ul.map(jr),bo=yo.map(jr),Vs=()=>Promise.resolve(bo),Qr=()=>Promise.resolve(Ns),Ms=({tag:O,isFirst:v,onRemove:b,onChange:E,getTagKeyOptions:A,getTagValueOptions:x})=>{const k=sa(O),Q=zn(O,v),K=()=>A().catch(de=>(console.error(de),[])).then(de=>de.map(jr)),ae=()=>x(O.key).then(de=>de.map(jr));return(0,N.jsxs)("div",{className:"gf-form",children:[Q!=null&&(0,N.jsx)(Cn,{value:Q,loadOptions:Vs,onChange:de=>{E({...O,condition:de.value})}}),(0,N.jsx)(Cn,{allowCustomValue:!0,value:O.key,loadOptions:K,onChange:de=>{const{value:me}=de;me===void 0?b():E({...O,key:me??""})}}),(0,N.jsx)(Cn,{value:k,loadOptions:Qr,onChange:de=>{E({...O,operator:de.value})}}),(0,N.jsx)(Cn,{allowCustomValue:!0,value:O.value,loadOptions:ae,onChange:de=>{const me=de.value??"";E({...O,value:me,operator:fn(k,me)})}}),(0,N.jsx)(La.Z,{style:{marginRight:"4px"},"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>{b()}})]})},So=({tags:O,onChange:v,getTagKeyOptions:b,getTagValueOptions:E})=>{const A=(K,ae)=>{const de=O.map((me,De)=>ae===De?K:me);v(de)},x=K=>{const ae=O.filter((de,me)=>me!==K);v(ae)},k=()=>b().then(K=>K.map(jr)),Q=(K,ae)=>{const de={key:K,value:"select tag value"},me={key:de.key,value:de.value,operator:sa(de),condition:zn(de,ae)};v([...O,me])};return(0,N.jsxs)(N.Fragment,{children:[O.map((K,ae)=>(0,N.jsx)(Ms,{tag:K,isFirst:ae===0,onChange:de=>{A(de,ae)},onRemove:()=>{x(ae)},getTagKeyOptions:b,getTagValueOptions:E},ae)),(0,N.jsx)(ia,{allowCustomValue:!0,loadOptions:k,onAdd:K=>{Q(K,O.length===0)}})]})},ks=O=>{const v=(0,ie.useId)(),b=`influxdb-qe-format-as-${v}`,E=`influxdb-qe-order-by${v}`,A=(0,Ke.of)(Oo),x=us(O.query),{datasource:k}=O,{measurement:Q,policy:K}=x,ae=(0,ie.useMemo)(async()=>{const He=(await al(k,Q,K)).map(cr=>`${cr}::tag`),Pt=(await dn(k,Q||"",K)).map(cr=>`${cr}::field`);return new Set([...He,...Pt])},[Q,K,k]),de=(0,ie.useMemo)(()=>{const He=new Map([["field_0",()=>Q!==void 0?dn(k,Q,K):Promise.resolve([])]]);return(x.select??[]).map(Pt=>Fn(Pt,He))},[Q,K,x.select,k]),me=(0,ie.useMemo)(()=>async()=>[...await ae],[ae]),De=(0,ie.useMemo)(()=>{const He=new Map([["tag_0",me]]);return Fn(x.groupBy??[],He)},[me,x.groupBy]),We=He=>{O.onChange(He),O.onRunQuery()},xr=(He,Pt)=>{We({...x,policy:He,measurement:Pt})},ua=He=>{We({...x,tags:He.length===0?void 0:He})};return(0,N.jsxs)("div",{children:[(0,N.jsxs)(mr.L,{label:"FROM",fill:!0,children:[(0,N.jsx)(Ps,{policy:K,measurement:Q,getPolicyOptions:()=>vi(Rr(k),Ls),getMeasurementOptions:He=>vi(ae.then(Pt=>ws(k,aa(x.tags??[],Pt),He===""?void 0:He)),gi,He),onChange:xr}),(0,N.jsx)(Ge.c,{width:"auto",className:A.inlineLabel,children:"WHERE"}),(0,N.jsx)(So,{tags:x.tags??[],onChange:ua,getTagKeyOptions:me,getTagValueOptions:He=>vi(ae.then(Pt=>fo(k,aa(x.tags??[],Pt),He,Q)),gi)})]}),de.map((He,Pt)=>(0,N.jsx)(mr.L,{label:Pt===0?"SELECT":"",fill:!0,children:(0,N.jsx)(oa,{parts:He,getNewPartOptions:()=>Promise.resolve(pi()),onChange:(cr,wo)=>{const Js=At(x,Pt,cr,wo);We(Js)},onAddNewPart:cr=>{We(lr(x,cr,Pt))},onRemovePart:cr=>{We(ba(x,cr,Pt))}})},Pt)),(0,N.jsx)(mr.L,{label:"GROUP BY",fill:!0,children:(0,N.jsx)(oa,{parts:De,getNewPartOptions:()=>As(x,me),onChange:(He,Pt)=>{const cr=ta(x,He,Pt);We(cr)},onAddNewPart:He=>{We(Gr(x,He))},onRemovePart:He=>{We(Vn(x,He))}})}),(0,N.jsxs)(mr.L,{label:"TIMEZONE",fill:!0,children:[(0,N.jsx)(xa,{placeholder:"(optional)",value:x.tz,onChange:He=>{We({...x,tz:He})}}),(0,N.jsx)(Ge.c,{htmlFor:E,width:"auto",className:A.inlineLabel,children:"ORDER BY TIME"}),(0,N.jsx)(Ia,{inputId:E,value:x.orderByTime==="DESC"?"DESC":"ASC",onChange:He=>{We({...x,orderByTime:He})}})]}),(0,N.jsxs)(mr.L,{label:"LIMIT",fill:!0,children:[(0,N.jsx)(xa,{placeholder:"(optional)",value:x.limit?.toString(),onChange:He=>{We({...x,limit:He})}}),(0,N.jsx)(Ge.c,{width:"auto",className:A.inlineLabel,children:"SLIMIT"}),(0,N.jsx)(xa,{placeholder:"(optional)",value:x.slimit?.toString(),onChange:He=>{We({...x,slimit:He})}})]}),(0,N.jsxs)(mr.L,{htmlFor:b,label:"FORMAT AS",fill:!0,children:[(0,N.jsx)(vo,{inputId:b,format:x.resultFormat??Aa,onChange:He=>{We({...x,resultFormat:He})}}),x.resultFormat!=="table"&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(Ge.c,{width:"auto",className:A.inlineLabel,children:"ALIAS"}),(0,N.jsx)(xa,{isWide:!0,placeholder:"Naming pattern",value:x.alias,onChange:He=>{We({...x,alias:He})}})]})]})]})};function Oo(O){return{inlineLabel:(0,Ie.css)({color:O.colors.primary.text})}}const ll=({query:O,onChange:v,onRunQuery:b,datasource:E})=>{switch(E.version){case xe.Flux:return(0,N.jsx)("div",{className:"gf-form-query-content",children:(0,N.jsx)(Fa,{query:O,onChange:v,datasource:E})});case xe.SQL:return(0,N.jsx)(Es,{datasource:E,query:O,onChange:v,onRunQuery:b});case xe.InfluxQL:default:return(0,N.jsxs)("div",{className:(0,Ie.css)({display:"flex"}),children:[(0,N.jsx)("div",{className:(0,Ie.css)({flexGrow:1}),children:O.rawQuery?(0,N.jsx)(co,{query:O,onChange:v,onRunQuery:b}):(0,N.jsx)(ks,{query:O,onChange:v,onRunQuery:b,datasource:E})}),(0,N.jsx)(nl,{isRaw:O.rawQuery??!1,onChange:A=>{v({...O,query:gt(O),rawQuery:A}),b()}})]})}},cl=[{title:"Getting started",label:"Start by selecting a measurement and field from the dropdown above. You can then use the tag selector to further narrow your search."}],dl=()=>{const O=(0,Ke.of)(Gs);return(0,N.jsxs)("div",{children:[(0,N.jsx)("h2",{children:"InfluxDB Cheat Sheet"}),cl.map(v=>(0,N.jsxs)("div",{className:O.cheatSheetItem,children:[(0,N.jsx)("div",{className:O.cheatSheetItemTitle,children:v.title}),v.label]},v.title))]})},Gs=O=>({cheatSheetItem:(0,Ie.css)({margin:O.spacing(3,0)}),cheatSheetItemTitle:(0,Ie.css)({fontSize:O.typography.h3.fontSize})});function $s(){return(0,N.jsx)(dl,{})}var fl=$(88483),pl=$(44240),hi=$(62467),vl=$(66847),gl=$(41119),Br=$(95004),Fo=$(33239);const Jr=O=>{const{query:v,onChange:b}=O,[E,A]=(0,ie.useState)(v.query??""),[x,k]=(0,ie.useState)(v.textColumn??""),[Q,K]=(0,ie.useState)(v.tagsColumn??""),[ae,de]=(0,ie.useState)(v?.timeEndColumn??""),[me]=(0,ie.useState)(v?.titleColumn??""),De=(We,xr)=>{b({...v,[We]:xr,rawQuery:!0,fromAnnotations:!0,textEditor:!0})};return(0,N.jsxs)(Er.B,{gap:5,direction:"column",children:[(0,N.jsxs)(Er.B,{gap:.5,direction:"column",children:[(0,N.jsxs)(Er.B,{gap:0,children:[(0,N.jsx)(qt.I,{width:12,children:"InfluxQL Query"}),(0,N.jsx)(ye.p,{value:E,onChange:We=>A(We.currentTarget.value??""),onBlur:()=>De("query",E),placeholder:"select text from events where $timeFilter limit 1000"})]}),(0,N.jsx)(qt.I,{width:12,tooltip:(0,N.jsx)("div",{children:"If your influxdb query returns more than one field you need to specify the column names below. An annotation event is composed of a title, tags, and an additional text field. Optionally you can map the timeEnd column for region annotation usage."}),children:"Field mappings"}),(0,N.jsxs)(Er.B,{gap:.5,alignItems:"flex-start",wrap:"wrap",children:[(0,N.jsxs)(Er.B,{gap:0,children:[(0,N.jsx)(qt.I,{width:12,children:"Text"}),(0,N.jsx)(ye.p,{value:x,onChange:We=>k(We.currentTarget.value??""),onBlur:()=>De("textColumn",x)})]}),(0,N.jsxs)(Er.B,{gap:0,children:[(0,N.jsx)(qt.I,{width:12,children:"Tags"}),(0,N.jsx)(ye.p,{value:Q,onChange:We=>K(We.currentTarget.value??""),onBlur:()=>De("tagsColumn",Q)})]}),(0,N.jsxs)(Er.B,{gap:0,children:[(0,N.jsx)(qt.I,{width:12,children:"TimeEnd"}),(0,N.jsx)(ye.p,{value:ae,onChange:We=>de(We.currentTarget.value??""),onBlur:()=>De("timeEndColumn",ae)})]}),(0,N.jsxs)("div",{className:"gf-form ng-hide",children:[(0,N.jsx)(qt.I,{width:12,children:"Title"}),(0,N.jsx)(ye.p,{defaultValue:me})]})]})]}),(0,N.jsx)("div",{})]})};var Dt=$(873);class pn{constructor(v){this.series=v.series,this.alias=v.alias,this.annotation=v.annotation,this.meta=v.meta,this.refId=v.refId}getTimeSeries(){const v=[];let b,E;return this.series.length===0||(0,ce.each)(this.series,A=>{const x=A.columns.length,k=(0,ce.map)(A.tags,(Q,K)=>K+": "+Q);for(E=1;E<x;E++){let Q=A.name;const K=A.columns[E];K!=="value"&&(Q=Q+"."+K),this.alias?Q=this._getSeriesName(A,E):A.tags&&(Q=Q+" {"+k.join(", ")+"}");const ae=[];if(A.values)for(b=0;b<A.values.length;b++)ae[b]=[A.values[b][E],A.values[b][0]];v.push({title:Q,target:Q,datapoints:ae,tags:A.tags,meta:this.meta,refId:this.refId})}}),v}_getSeriesName(v,b){const E=/\$(\w+)|\[\[([\s\S]+?)\]\]/g,A=v.name.split(".");return this.alias?.replace(E,(x,k,Q)=>{const K=k||Q,ae=parseInt(K,10);if(K==="m"||K==="measurement")return v.name;if(K==="col")return v.columns[b];if(!isNaN(ae))return A[ae]??x;if(K.indexOf("tag_")!==0)return x;const de=K.replace("tag_","");return v.tags?v.tags[de]:x})}getAnnotations(){const v=[];return(0,ce.each)(this.series,b=>{let E=null,A=null,x=null;const k=[];let Q=null;(0,ce.each)(b.columns,(K,ae)=>{if(K==="time"){A=ae;return}if(K!=="sequence_number"){if(K===this.annotation?.titleColumn){E=ae;return}if((0,ce.includes)((this.annotation?.tagsColumn||"").replace(" ","").split(","),K)){k.push(ae);return}if(K===this.annotation?.textColumn){Q=ae;return}if(K===this.annotation?.timeEndColumn){x=ae;return}!E&&Q!==ae&&(E=ae)}}),(0,ce.each)(b.values,K=>{const ae={annotation:this.annotation,time:+new Date(K[A]),title:K[E],timeEnd:K[x],tags:(0,ce.flatten)(k.filter(de=>K[de]).map(de=>K[de].split(","))),text:K[Q]};v.push(ae)})}),v}getTable(){const v=new Dt.A;let b,E;return v.refId=this.refId,v.meta=this.meta,this.series.length===0||(0,ce.each)(this.series,(A,x)=>{if(x===0){const k=A.columns[0],Q=k==="time"?{text:"Time",type:Br.PU.time}:{text:k};for(v.columns.push(Q),(0,ce.each)((0,ce.keys)(A.tags),K=>{v.columns.push({text:K})}),E=1;E<A.columns.length;E++)v.columns.push({text:A.columns[E]})}if(A.values)for(b=0;b<A.values.length;b++){const k=A.values[b],Q=[k[0]];if(A.tags)for(const K in A.tags)A.tags.hasOwnProperty(K)&&Q.push(A.tags[K]);for(E=1;E<k.length;E++)Q.push(k[E]);v.rows.push(Q)}}),v}}const Pa=O=>{const v={refId:"",query:O.query??"",queryType:"tags",fromAnnotations:!0,tagsColumn:O.tagsColumn??"",textColumn:O.textColumn??"",timeEndColumn:O.timeEndColumn??"",titleColumn:O.titleColumn??"",name:O.name??""};return O.target&&O.target.limit&&(v.limit=O.target.limit),O.target&&O.target.matchAny&&(v.matchAny=O.target.matchAny),O.target&&O.target.tags&&(v.tags=O.target.tags),O.target&&O.target.type&&(v.type=O.target.type),v},Us=O=>(O.target=O.target&&!O.target?.query?Pa(O):O.target,O);class Na{parse(v,b){if(!b?.results||b.results.length===0)return[];const E=b.results[0];if(!E.series)return[];const A=v.toLowerCase(),x=A.indexOf("show retention policies")>=0,k=A.indexOf("show field keys")>=0||x,Q=new Set;return(0,ce.each)(E.series,K=>{(0,ce.each)(K.values,ae=>{(0,ce.isArray)(ae)?k?Q.add(ae[0].toString()):ae[1]!==void 0?Q.add(ae[1].toString()):Q.add(ae[0].toString()):Q.add(ae.toString())})}),Array.from(Q).map(K=>({text:K}))}getTable(v,b,E){let A=new Dt.A;if(v.length>0)if(A.meta={...E,executedQueryString:v[0].meta?.executedQueryString},A.refId=b.refId,A=mi(v,A,b),v[0].fields[1]&&v[0].fields[1].labels){let x=(0,ce.groupBy)(v,K=>K.fields[1].labels?Object.values(K.fields[1].labels):null);const k=Object.keys(x),Q=Object.values(x);for(let K=0;K<Q.length;K++)A=Ws(Q[K],A,[...k[K].split(",")])}else A=Ws(v,A,[]);return A}async transformAnnotationResponse(v,b,E){const A=(0,On.bE)(b,[E]);if(!A)return[];const x=this.getTable(A.data,E,{}),k=[];let Q=0,K=0,ae=0,de=0;const me=[];return(0,ce.each)(x.columns,(De,We)=>{if(De.text.toLowerCase()==="time"){K=We;return}if(De.text===v.titleColumn){Q=We;return}if(Bs(De.text,v.tagsColumn)){me.push(We);return}if(v.textColumn&&De.text.includes(v.textColumn)){de=We;return}if(De.text===v.timeEndColumn){ae=We;return}!Q&&de!==We&&(Q=We)}),(0,ce.each)(x.rows,De=>{const We={annotation:v,time:+new Date(De[K]),title:De[Q],timeEnd:De[ae],tags:(0,ce.flatten)(me.filter(xr=>De[xr]).map(xr=>De[xr].split(","))),text:De[de]};k.push(We)}),k}}function Bs(O,v){const b=(v||"").replace(" ","").split(",");for(const E of b)if(E!==""&&O.includes(E))return!0;return!1}function mi(O,v,b){const E=Co(b);O[0].fields.forEach(A=>{A.name.toLowerCase()==="time"?v.columns.push({text:"Time",type:Br.PU.time}):A.name.toLowerCase()==="value"&&A.labels&&Object.keys(A.labels).forEach(x=>{v.columns.push({text:x})})}),O[0].refId==="metricFindQuery"&&O.forEach(A=>{A.name&&v.columns.push({text:A.name})});for(let A=0;A<E.length;A++)v.columns.push({text:E[A]});return b.rawQuery&&E.length===0&&zs(b.query,O)&&O[0].refId!=="metricFindQuery"&&O.map(A=>{A.name&&v.columns.push({text:A.name})}),v}function Ws(O,v,b){const E=O[0].fields[0].values;for(let A=0;A<E.length;A++){const x=E[A],k=O.map(Q=>Q.fields[1]?Q.fields[1].values[A]:null);k.indexOf(null)<0&&v.rows.push([x,...b,...k])}return v}function Co(O){let v=[];O.select?.forEach(E=>{const A=E.filter(x=>x.type!=="field");if(A.length>0){const x=A.find(k=>k.type==="alias");x?v.push(x.params?.[0].toString()??""):v.push(A[0].type)}else E[0]&&E[0].params&&E[0].params[0]&&v.push(E[0].params[0].toString())});let b=[];return v.forEach(E=>{b.push(qn(E,E,b,0))}),b}function qn(O,v,b,E){return b.indexOf(v)>-1?(E++,qn(O,O+"_"+E,b,E)):v}function zs(O,v){const E=v.map(k=>k.name).every(k=>k&&O?k.split(".").every(K=>O.toLowerCase().includes(K.toLowerCase())):!1),x=["*","SHOW"].some(k=>O?O.toLowerCase().includes(k.toLowerCase()):!1);return E||x}var En=$(65474),Va=$(48592);const Wr="InfluxVariableQueryEditor-VariableQuery",Eo=({onChange:O,datasource:v,query:b})=>{const E=A=>typeof A!="string"?A:{refId:Wr,query:A,...v.version===xe.Flux?{maxDataPoints:1e3}:{}};switch(v.version){case xe.Flux:return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(Fa,{datasource:v,query:E(b),onChange:A=>{O({...b,query:A.query??""})}}),(0,N.jsx)(vt.C,{children:(0,N.jsx)(Me.I,{label:"Max Data Points",labelWidth:20,required:!0,grow:!0,"aria-labelledby":"flux-maxdatapoints",tooltip:(0,N.jsx)("div",{children:"Upper boundary of data points will return for the variable query."}),children:(0,N.jsx)(ye.p,{id:"influx-sql-variable-maxdatapoints","aria-label":"flux-maxdatapoints",type:"number",defaultValue:b.maxDataPoints??1e3,placeholder:"Default is 1000",onBlur:A=>{O({refId:Wr,query:b.query,maxDataPoints:Number.parseInt(A.currentTarget.value,10)})}})})})]});default:return(0,N.jsx)(vt.C,{children:(0,N.jsx)(Me.I,{label:"Query",labelWidth:20,required:!0,grow:!0,"aria-labelledby":"influx-variable-query",children:(0,N.jsx)(wa.f,{"aria-label":"influx-variable-query",defaultValue:E(b).query,placeholder:"metric name or tags query",rows:1,onBlur:A=>{O({refId:Wr,query:A.currentTarget.value??""})}})})})}};class qs extends Va.f5{constructor(v,b=(0,ln.w)()){super(),this.datasource=v,this.templateSrv=b,this.editor=Eo}query(v){let b;if(typeof v.targets[0]=="string"?b=v.targets[0]:b=v.targets[0].query,!b)return(0,hi.of)({data:[]});const E=this.templateSrv.replace(b,v.scopedVars,this.datasource.interpolateQueryExpr),A=this.datasource.getTimeFilter({rangeRaw:v.range.raw,timezone:v.timezone}),x=E.replace("$timeFilter",A);return(0,En.H)(this.datasource.metricFindQuery({refId:v.targets[0].refId,query:x,maxDataPoints:v.targets[0].maxDataPoints??1e3},{range:v.range})).pipe((0,bn.T)(Q=>({data:Q})))}}class Ma extends cn.iy{constructor(v,b=(0,ln.w)()){super(v),this.templateSrv=b,this.type="influxdb",this.urls=(v.url??"").split(",").map(A=>A.trim()),this.username=v.username??"",this.password=v.password??"",this.name=v.name,this.basicAuth=v.basicAuth,this.withCredentials=v.withCredentials,this.access=v.access;const E=v.jsonData??{};this.database=E.dbName??v.database,this.interval=E.timeInterval,this.httpMode=E.httpMode||"GET",this.responseParser=new Na,this.version=E.version??xe.InfluxQL,this.isProxyAccess=v.access==="proxy",this.variables=new qs(this,this.templateSrv),this.version===xe.Flux?this.annotations={QueryEditor:Fa}:this.annotations={QueryEditor:Jr,prepareAnnotation:Us}}query(v){if(!this.isProxyAccess){const b=new Error(wt);return(0,ii.$)(()=>b)}return this._query(v)}_query(v){const b={...v,targets:v.targets.filter(E=>E.hide!==!0)};if(b.targets.some(E=>E.fromAnnotations)){const E=[];for(const A of b.targets)A.query&&E.push(new fl.c(x=>{this.annotationEvents(b,A).then(k=>x.next({data:[(0,gl.Vc)(k)]})).catch(k=>x.error(new Error(k))).finally(()=>x.complete())}));return(0,pl.h)(...E)}return this.version===xe.InfluxQL&&!this.isMigrationToggleOnAndIsAccessProxy()?this.classicQuery(v):super.query(b)}getQueryDisplayText(v){switch(this.version){case xe.Flux:return v.query;case xe.SQL:return ms(v);case xe.InfluxQL:return new qr(v).render(!1);default:return""}}filterQuery(v){return this.version===xe.Flux?!!v.query:!0}applyTemplateVariables(v,b,E){const A=b||{};if(A.__interval={value:"$__interval"},A.__interval_ms={value:"$__interval_ms"},this.version===xe.Flux)return{...v,query:this.templateSrv.replace(v.query??"",A)};if((this.version===xe.SQL||this.isMigrationToggleOnAndIsAccessProxy())&&(v=this.applyVariables(v,A,E),v.adhocFilters?.length)){const x=(v.adhocFilters??[]).map(k=>{const{condition:Q,...K}=k;return K.value=this.templateSrv.replace(K.value??"",A),K});v.tags=[...v.tags??[],...x]}return v}targetContainsTemplate(v){const b=this.version===xe.Flux?v.query:gt(v);return this.templateSrv.containsTemplate(b)}interpolateVariablesInQueries(v,b){return!v||v.length===0?[]:v.map(E=>this.version===xe.Flux?{...E,datasource:this.getRef(),query:this.templateSrv.replace(E.query??"",b,(A=[],x)=>this.interpolateQueryExpr(A,x,E.query))}:{...E,datasource:this.getRef(),...this.applyVariables(E,b)})}applyVariables(v,b,E){const A={...v};return v.groupBy&&(A.groupBy=v.groupBy.map(x=>({...x,params:x.params?.map(k=>this.templateSrv.replace(k.toString(),void 0))}))),v.select&&(A.select=v.select.map(x=>x.map(k=>({...k,params:k.params?.map(Q=>this.templateSrv.replace(Q.toString(),b))})))),v.tags&&(A.tags=v.tags.map(x=>(x.operator!=="=~"&&x.operator!=="!~"&&(x.value=Sa(x.value)),{...x,key:this.templateSrv.replace(x.key,b),value:this.templateSrv.replace(x.value??"",b,(k=[],Q)=>this.interpolateQueryExpr(k,Q,x.value))}))),{...A,adhocFilters:E??[],query:this.templateSrv.replace(v.query??"",b,(x=[],k)=>this.interpolateQueryExpr(x,k,v.query)),rawSql:this.templateSrv.replace(v.rawSql??"",b,(x=[],k)=>this.interpolateQueryExpr(x,k,v.rawSql)),alias:this.templateSrv.replace(v.alias??"",b),limit:this.templateSrv.replace(v.limit?.toString()??"",b),measurement:this.templateSrv.replace(v.measurement??"",b,(x=[],k)=>this.interpolateQueryExpr(x,k,v.measurement)),policy:this.templateSrv.replace(v.policy??"",b),slimit:this.templateSrv.replace(v.slimit?.toString()??"",b),tz:this.templateSrv.replace(v.tz??"",b)}}interpolateQueryExpr(v=[],b,E){if(typeof v=="string"&&!isNaN(parseFloat(v)))return v;if(b.multi)return typeof v=="string"?isNaN(parseFloat(v))?(0,It.$f)(v):v:`(${v.map(Q=>(0,It.$f)(Q)).join("|")})`;const A=new RegExp(/\/((?![*+?])(?:[^\r\n\[/\\]|\\.|\[(?:[^\r\n\]\\]|\\.)*\])+)\/((?:g(?:im?|mi?)?|i(?:gm?|mg?)?|m(?:gi?|ig?)?)?)/,"gm"),x=new RegExp(`\\/(?:\\^)?(.*)(\\$${b.name})(.*)(?:\\$)?\\/`,"gm");if(!E||typeof E!="string")return v;const k=E.match(A);if(!k)return v;for(const Q of k)if(Q.match(x))return typeof v=="string"?(0,It.$f)(v):`(${v.map(K=>(0,It.$f)(K)).join("|")})`;return v}async runMetadataQuery(v){return(0,yn.s)(super.query({targets:[v]})).then(this.toMetricFindValue)}async metricFindQuery(v,b){if(this.version===xe.Flux||this.version===xe.SQL||this.isMigrationToggleOnAndIsAccessProxy()){const A={refId:"metricFindQuery",query:v.query,rawQuery:!0,...this.version===xe.SQL?{rawSql:v.query,format:ni.gv.Table}:{}};return(0,yn.s)(super.query({...b??{},maxDataPoints:v.maxDataPoints,targets:[A]})).then(this.toMetricFindValue)}const E=this.templateSrv.replace(v.query,b?.scopedVars,(A=[],x)=>this.interpolateQueryExpr(A,x,v.query));return(0,yn.s)(this._seriesQuery(E,b)).then(A=>this.responseParser.parse(v.query,A))}toMetricFindValue(v){const b=new Map;return v?.data?.forEach(E=>{if(E&&E.length>0){let A=E.fields.find(x=>x.type===Br.PU.string);A||(A=E.fields.find(x=>x.type!==Br.PU.time)),A&&A.values.forEach(x=>{b.set(x.toString(),{text:x.toString()})})}}),Array.from(b.values())}getTagKeys(v){const b=fi({type:"TAG_KEYS",templateService:this.templateSrv,database:this.database});return this.metricFindQuery({refId:"get-tag-keys",query:b})}getTagValues(v){const b=fi({type:"TAG_VALUES",templateService:this.templateSrv,database:this.database,withKey:v.key});return this.metricFindQuery({refId:"get-tag-values",query:b})}_seriesQuery(v,b){if(!v)return(0,hi.of)({results:[]});if(b&&b.range){const E=this.getTimeFilter({rangeRaw:b.range,timezone:b.timezone});v=v.replace("$timeFilter",E)}return this._influxRequest(this.httpMode,"/query",{q:v,epoch:"ms"},b)}serializeParams(v){return v?(0,ce.reduce)(v,(b,E,A)=>(E==null||b.push(encodeURIComponent(A)+"="+encodeURIComponent(E)),b),[]).join("&"):""}_influxRequest(v,b,E,A){const x=this.urls.shift();this.urls.push(x);const k={};this.username&&(k.u=this.username,k.p=this.password),A&&A.database?k.db=A.database:this.database&&(k.db=this.database),A?.policy&&A.policy!==bt&&(k.rp=A.policy);const{q:Q}=E;v==="POST"&&(0,ce.has)(E,"q")?((0,ce.extend)(k,(0,ce.omit)(E,["q"])),E=this.serializeParams((0,ce.pick)(E,["q"]))):(v==="GET"||v==="POST")&&((0,ce.extend)(k,E),E=null);const K={method:v,url:x+b,params:k,data:E,precision:"ms",inspect:{type:"influxdb"},paramSerializer:this.serializeParams};return K.headers=K.headers||{},(this.basicAuth||this.withCredentials)&&(K.withCredentials=!0),this.basicAuth&&(K.headers.Authorization=this.basicAuth),v==="POST"&&(K.headers["Content-type"]="application/x-www-form-urlencoded"),(0,Sn.AI)().fetch(K).pipe((0,bn.T)(ae=>{const{data:de}=ae;if(de&&(de.executedQueryString=Q,de.results)){const me=ae.data.results.filter(De=>De.error);if(me.length>0)throw{message:"InfluxDB Error: "+me[0].error,data:de}}return de}),(0,vl.W)(ae=>ae.cancelled?(0,hi.of)(ae):(0,ii.$)(this.handleErrors(ae))))}handleErrors(v){const b={message:v&&v.status||v&&v.message||"Unknown error during query transaction. Please check JS console logs."};return(Number.isInteger(v.status)&&v.status!==0||v.status>=300)&&(v.data&&v.data.error?(b.message="InfluxDB Error: "+v.data.error,b.data=v.data,b.config=v.config):(b.message="Network Error: "+v.statusText+"("+v.status+")",b.data=v.data,b.config=v.config)),b}getTimeFilter(v){const b=this.getInfluxTime(v.rangeRaw.from,!1,v.timezone),E=this.getInfluxTime(v.rangeRaw.to,!0,v.timezone);return"time >= "+b+" and time <= "+E}getInfluxTime(v,b,E){let A;if((0,ce.isString)(v)){if(v==="now")return"now()";const x=/^now-(\d+)([dhms])$/.exec(v);if(x){const k=parseInt(x[1],10),Q=x[2];return"now() - "+k+Q}if(A=Fo.parse(v,b,E),!A)throw new Error("unable to parse date");v=A}return v.valueOf()+"ms"}isMigrationToggleOnAndIsAccessProxy(){return di.Ay.featureToggles.influxdbBackendMigration&&this.access==="proxy"}classicQuery(v){let b=this.getTimeFilter(v);const E=v.scopedVars,A=(0,ce.cloneDeep)(v.targets),x=[];let k,Q,K=(0,ce.map)(A,me=>me.hide?"":(x.push(me),E.interval=E.__interval,new qr(me,this.templateSrv,E).render(!0))).reduce((me,De)=>(De!==""&&(me+=";"+De),me));if(K==="")return(0,hi.of)({data:[]});const ae=v.filters,de=v.targets.flatMap(me=>me.adhocFilters??[]);if(ae?.length||de?.length){const me=ae?.length?ae:de,De=new qr({refId:"A"},this.templateSrv,E);b+=" AND "+De.renderAdhocFilters(me)}return E.timeFilter={value:b},K=this.templateSrv.replace(K,E),this._seriesQuery(K,v).pipe((0,bn.T)(me=>{if(!me||!me.results)return{data:[]};const De=[];for(k=0;k<me.results.length;k++){const We=me.results[k];if(!We||!We.series)continue;const xr=x[k];let ua=xr.alias;ua&&(ua=this.templateSrv.replace(xr.alias,v.scopedVars));const He={executedQueryString:me.executedQueryString},Pt=new pn({refId:xr.refId,series:me.results[k].series,alias:ua,meta:He});switch(xr.resultFormat){case"logs":He.preferredVisualisationType="logs";case"table":{De.push(Pt.getTable());break}default:{const cr=Pt.getTimeSeries();for(Q=0;Q<cr.length;Q++)De.push(Qs(cr[Q]));break}}}return{data:De}}))}async annotationEvents(v,b){if(this.version===xe.Flux)return Promise.reject({message:"Flux requires the standard annotation query"});if(!b.query)return Promise.reject({message:"Query missing in annotation definition"});if(this.isMigrationToggleOnAndIsAccessProxy()){const x={refId:"metricFindQuery",datasource:this.getRef(),query:this.templateSrv.replace(b.query,void 0,(k=[],Q)=>this.interpolateQueryExpr(k,Q,b.query)),rawQuery:!0};return(0,yn.s)((0,Sn.AI)().fetch({url:"/api/ds/query",method:"POST",headers:this.getRequestHeaders(),data:{from:v.range.from.valueOf().toString(),to:v.range.to.valueOf().toString(),queries:[x]},requestId:b.name}).pipe((0,bn.T)(async k=>await this.responseParser.transformAnnotationResponse(b,k,x))))}const E=this.getTimeFilter({rangeRaw:v.range.raw,timezone:v.timezone});let A=b.query.replace("$timeFilter",E);return A=this.templateSrv.replace(A,void 0,(x=[],k)=>this.interpolateQueryExpr(x,k,A)),(0,yn.s)(this._seriesQuery(A,v)).then(x=>{if(!x||!x.results||!x.results[0])throw{message:"No results in response from InfluxDB"};return new pn({series:x.results[0].series,annotation:b}).getAnnotations()})}}function Hs(O){const v=O.find(E=>E!==null);if(v===void 0)return Br.PU.number;const b=typeof v;switch(b){case"string":return Br.PU.string;case"boolean":return Br.PU.boolean;case"number":return Br.PU.number;default:throw new Error(`InfluxQL: invalid value type ${b}`)}}function Qs(O){const v=[],b=[],E=O.datapoints;for(const Q of E)b.push(Q[0]),v.push(Q[1]);const A={name:Br.LE,type:Br.PU.time,config:{},values:v},x={name:Br.Bc,type:Hs(b),config:{displayNameFromDS:O.title},values:b,labels:O.tags},k=[A,x];return{name:O.target,refId:O.refId,meta:O.meta,fields:k,length:b.length}}const yi=new tt.tD(Ma).setConfigEditor(kr).setQueryEditor(ll).setQueryEditorHelp($s)},18678:function(Fr,Et,$){var tt,N;(function(ce,ie){tt=ie,N=typeof tt=="function"?tt.call(Et,$,Et,Fr):tt,N!==void 0&&(Fr.exports=N)})(this,function(){"use strict";Array.isArray||(Array.isArray=function(te){return Object.prototype.toString.call(te)==="[object Array]"});function ce(te){for(var ne=[],Oe=0,le=te.length;Oe<le;Oe++)ne.indexOf(te[Oe])===-1&&ne.push(te[Oe]);return ne}var ie={},Je={"==":function(te,ne){return te==ne},"===":function(te,ne){return te===ne},"!=":function(te,ne){return te!=ne},"!==":function(te,ne){return te!==ne},">":function(te,ne){return te>ne},">=":function(te,ne){return te>=ne},"<":function(te,ne,Oe){return Oe===void 0?te<ne:te<ne&&ne<Oe},"<=":function(te,ne,Oe){return Oe===void 0?te<=ne:te<=ne&&ne<=Oe},"!!":function(te){return ie.truthy(te)},"!":function(te){return!ie.truthy(te)},"%":function(te,ne){return te%ne},log:function(te){return console.log(te),te},in:function(te,ne){return!ne||typeof ne.indexOf>"u"?!1:ne.indexOf(te)!==-1},cat:function(){return Array.prototype.join.call(arguments,"")},substr:function(te,ne,Oe){if(Oe<0){var le=String(te).substr(ne);return le.substr(0,le.length+Oe)}return String(te).substr(ne,Oe)},"+":function(){return Array.prototype.reduce.call(arguments,function(te,ne){return parseFloat(te,10)+parseFloat(ne,10)},0)},"*":function(){return Array.prototype.reduce.call(arguments,function(te,ne){return parseFloat(te,10)*parseFloat(ne,10)})},"-":function(te,ne){return ne===void 0?-te:te-ne},"/":function(te,ne){return te/ne},min:function(){return Math.min.apply(this,arguments)},max:function(){return Math.max.apply(this,arguments)},merge:function(){return Array.prototype.reduce.call(arguments,function(te,ne){return te.concat(ne)},[])},var:function(te,ne){var Oe=ne===void 0?null:ne,le=this;if(typeof te>"u"||te===""||te===null)return le;for(var Ee=String(te).split("."),Te=0;Te<Ee.length;Te++)if(le==null||(le=le[Ee[Te]],le===void 0))return Oe;return le},missing:function(){for(var te=[],ne=Array.isArray(arguments[0])?arguments[0]:arguments,Oe=0;Oe<ne.length;Oe++){var le=ne[Oe],Ee=ie.apply({var:le},this);(Ee===null||Ee==="")&&te.push(le)}return te},missing_some:function(te,ne){var Oe=ie.apply({missing:ne},this);return ne.length-Oe.length>=te?[]:Oe}};return ie.is_logic=function(te){return typeof te=="object"&&te!==null&&!Array.isArray(te)&&Object.keys(te).length===1},ie.truthy=function(te){return Array.isArray(te)&&te.length===0?!1:!!te},ie.get_operator=function(te){return Object.keys(te)[0]},ie.get_values=function(te){return te[ie.get_operator(te)]},ie.apply=function(te,ne){if(Array.isArray(te))return te.map(function(vt){return ie.apply(vt,ne)});if(!ie.is_logic(te))return te;var Oe=ie.get_operator(te),le=te[Oe],Ee,Te,Me,ye,wt;if(Array.isArray(le)||(le=[le]),Oe==="if"||Oe=="?:"){for(Ee=0;Ee<le.length-1;Ee+=2)if(ie.truthy(ie.apply(le[Ee],ne)))return ie.apply(le[Ee+1],ne);return le.length===Ee+1?ie.apply(le[Ee],ne):null}else if(Oe==="and"){for(Ee=0;Ee<le.length;Ee+=1)if(Te=ie.apply(le[Ee],ne),!ie.truthy(Te))return Te;return Te}else if(Oe==="or"){for(Ee=0;Ee<le.length;Ee+=1)if(Te=ie.apply(le[Ee],ne),ie.truthy(Te))return Te;return Te}else{if(Oe==="filter")return ye=ie.apply(le[0],ne),Me=le[1],Array.isArray(ye)?ye.filter(function(vt){return ie.truthy(ie.apply(Me,vt))}):[];if(Oe==="map")return ye=ie.apply(le[0],ne),Me=le[1],Array.isArray(ye)?ye.map(function(vt){return ie.apply(Me,vt)}):[];if(Oe==="reduce")return ye=ie.apply(le[0],ne),Me=le[1],wt=typeof le[2]<"u"?le[2]:null,Array.isArray(ye)?ye.reduce(function(vt,Xr){return ie.apply(Me,{current:Xr,accumulator:vt})},wt):wt;if(Oe==="all"){if(ye=ie.apply(le[0],ne),Me=le[1],!Array.isArray(ye)||!ye.length)return!1;for(Ee=0;Ee<ye.length;Ee+=1)if(!ie.truthy(ie.apply(Me,ye[Ee])))return!1;return!0}else if(Oe==="none"){if(ye=ie.apply(le[0],ne),Me=le[1],!Array.isArray(ye)||!ye.length)return!0;for(Ee=0;Ee<ye.length;Ee+=1)if(ie.truthy(ie.apply(Me,ye[Ee])))return!1;return!0}else if(Oe==="some"){if(ye=ie.apply(le[0],ne),Me=le[1],!Array.isArray(ye)||!ye.length)return!1;for(Ee=0;Ee<ye.length;Ee+=1)if(ie.truthy(ie.apply(Me,ye[Ee])))return!0;return!1}}if(le=le.map(function(vt){return ie.apply(vt,ne)}),Je.hasOwnProperty(Oe)&&typeof Je[Oe]=="function")return Je[Oe].apply(ne,le);if(Oe.indexOf(".")>0){var bt=String(Oe).split("."),xe=Je;for(Ee=0;Ee<bt.length;Ee++){if(!xe.hasOwnProperty(bt[Ee]))throw new Error("Unrecognized operation "+Oe+" (failed at "+bt.slice(0,Ee+1).join(".")+")");xe=xe[bt[Ee]]}return xe.apply(ne,le)}throw new Error("Unrecognized operation "+Oe)},ie.uses_data=function(te){var ne=[];if(ie.is_logic(te)){var Oe=ie.get_operator(te),le=te[Oe];Array.isArray(le)||(le=[le]),Oe==="var"?ne.push(le[0]):le.forEach(function(Ee){ne.push.apply(ne,ie.uses_data(Ee))})}return ce(ne)},ie.add_operation=function(te,ne){Je[te]=ne},ie.rm_operation=function(te){delete Je[te]},ie.rule_like=function(te,ne){if(ne===te||ne==="@")return!0;if(ne==="number")return typeof te=="number";if(ne==="string")return typeof te=="string";if(ne==="array")return Array.isArray(te)&&!ie.is_logic(te);if(ie.is_logic(ne)){if(ie.is_logic(te)){var Oe=ie.get_operator(ne),le=ie.get_operator(te);if(Oe==="@"||Oe===le)return ie.rule_like(ie.get_values(te,!1),ie.get_values(ne,!1))}return!1}if(Array.isArray(ne))if(Array.isArray(te)){if(ne.length!==te.length)return!1;for(var Ee=0;Ee<ne.length;Ee+=1)if(!ie.rule_like(te[Ee],ne[Ee]))return!1;return!0}else return!1;return!1},ie})},58493:(Fr,Et,$)=>{"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tt=$(96540);function N(Me,ye){return Me===ye&&(Me!==0||1/Me===1/ye)||Me!==Me&&ye!==ye}var ce=typeof Object.is=="function"?Object.is:N,ie=tt.useState,Je=tt.useEffect,te=tt.useLayoutEffect,ne=tt.useDebugValue;function Oe(Me,ye){var wt=ye(),bt=ie({inst:{value:wt,getSnapshot:ye}}),xe=bt[0].inst,vt=bt[1];return te(function(){xe.value=wt,xe.getSnapshot=ye,le(xe)&&vt({inst:xe})},[Me,wt,ye]),Je(function(){return le(xe)&&vt({inst:xe}),Me(function(){le(xe)&&vt({inst:xe})})},[Me]),ne(wt),wt}function le(Me){var ye=Me.getSnapshot;Me=Me.value;try{var wt=ye();return!ce(Me,wt)}catch{return!0}}function Ee(Me,ye){return ye()}var Te=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Ee:Oe;Et.useSyncExternalStore=tt.useSyncExternalStore!==void 0?tt.useSyncExternalStore:Te},22162:(Fr,Et,$)=>{"use strict";/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tt=$(96540),N=$(19888);function ce(Ee,Te){return Ee===Te&&(Ee!==0||1/Ee===1/Te)||Ee!==Ee&&Te!==Te}var ie=typeof Object.is=="function"?Object.is:ce,Je=N.useSyncExternalStore,te=tt.useRef,ne=tt.useEffect,Oe=tt.useMemo,le=tt.useDebugValue;Et.useSyncExternalStoreWithSelector=function(Ee,Te,Me,ye,wt){var bt=te(null);if(bt.current===null){var xe={hasValue:!1,value:null};bt.current=xe}else xe=bt.current;bt=Oe(function(){function Xr(Ge){if(!er){if(er=!0,mn=Ge,Ge=ye(Ge),wt!==void 0&&xe.hasValue){var ge=xe.value;if(wt(ge,Ge))return Ie=ge}return Ie=Ge}if(ge=Ie,ie(mn,Ge))return ge;var it=ye(Ge);return wt!==void 0&&wt(ge,it)?(mn=Ge,ge):(mn=Ge,Ie=it)}var er=!1,mn,Ie,Ke=Me===void 0?null:Me;return[function(){return Xr(Te())},Ke===null?void 0:function(){return Xr(Ke())}]},[Te,Me,ye,wt]);var vt=Je(Ee,bt[0],bt[1]);return ne(function(){xe.hasValue=!0,xe.value=vt},[vt]),le(vt),vt}},19888:(Fr,Et,$)=>{"use strict";Fr.exports=$(58493)},46861:(Fr,Et,$)=>{"use strict";Fr.exports=$(22162)},41778:(Fr,Et,$)=>{"use strict";$.d(Et,{lX:()=>ne});var tt=$(63930),N=$(47184),ce=$(2543),ie=$(96540),Je,te=(Te=>(Te[Te.Timeseries=0]="Timeseries",Te[Te.Table=1]="Table",Te[Te.Logs=2]="Logs",Te[Te.Trace=3]="Trace",Te[Te.OptionMulti=4]="OptionMulti",Te))(te||{}),ne=(Te=>(Te.Builder="builder",Te.Code="code",Te))(ne||{});const Oe=[{label:"Time series",value:0},{label:"Table",value:1}],le=Te=>({label:Te,value:Te}),Ee=(Je=N.z)!=null?Je:le}}]);

//# sourceMappingURL=influxdbPlugin.1a4f6fc495e4ad7fe5b5.js.map