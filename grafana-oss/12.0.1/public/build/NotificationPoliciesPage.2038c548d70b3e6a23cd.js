"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1909],{13198:(Ne,ce,n)=>{n.r(ce),n.d(ce,{default:()=>oi});var e=n(74848),E=n(22803),d=n(96540),R=n(63142),q=n(54314),G=n(60208),Z=n(13941),de=n(70958),o=n(56840),ue=n(51686),w=n(2543),T=n(41053),C=n(34999),b=n(41654),A=n(45861),se=n(64762),te=n(97507),P=n(16692),B=n(42824),V=n(77256),je=n(48442),he=n(84266),be=n(80218),Ce=n(5358),Ke=n(33998),Ge=n(91984),Je=n(95443),Te=n(5709),xe=n(75505),Pe=n(68143),Le=n(52161);const De=t=>{const i=t.match(/^(\w+)(\[\d+\])?$/);return i?{type:i[1],index:i[2]}:{type:t,index:void 0}},S=t=>{const i={receivers:{},errorCount:0};t.forEach(s=>{i.receivers[s.name]={active:s.active,notifiers:{},errorCount:0};const l=i.receivers[s.name];s.integrations.forEach(u=>{!!u?.lastNotifyAttemptError&&(l.errorCount+=1);const m=H(u.name);m&&(l.notifiers[m]||(l.notifiers[m]=[]),l.notifiers[m].push(u))})});const r=Object.values(i.receivers).reduce((s,l)=>s+l.errorCount,0);return{...i,errorCount:r}},H=t=>De(t)?.type;async function z(t){try{const i=await(0,xe.s)((0,Pe.AI)().fetch({url:`/api/alertmanager/${(0,Le.w5)(t)}/config/api/v1/receivers`,showErrorAlert:!1,showSuccessAlert:!1}));return S(i.data)}catch{return S([])}}const K=Te.H.injectEndpoints({endpoints:t=>({contactPointsState:t.query({queryFn:async({amSourceName:i})=>{try{return{data:await z(i)}}catch(r){return{error:r}}}})})}),Q=t=>{const i={receivers:{},errorCount:0},{currentData:r}=K.useContactPointsStateQuery({amSourceName:t??""},{skip:!t,pollingInterval:Je.cB});return r??i};var N=n(59062),L=n(37386),a=n(72636),p=n(45967),h=n(30703),$=n(63527),I=n(66404),W=n(54937),ae=n(20962),F=n(86017),X=n(63895);const Y=({onChangeReceiver:t,onChangeMatchers:i,matchingCount:r})=>{const[s,l]=(0,P.L7)(P.QI.ViewContactPoint),[u,c]=(0,ae.l)(),m=(0,d.useRef)(null),{queryString:g,contactPoint:f}=Re(u),x=(0,R.of)(qt),y=(0,d.useCallback)(()=>(0,w.debounce)(i,500),[i]);(0,d.useEffect)(()=>{t(f)},[f,t]),(0,d.useEffect)(()=>{const M=(0,X.Zc)(g??"").map(F.NL);y()(M)},[y,g]);const O=(0,d.useCallback)(()=>{m.current&&(m.current.value=""),c({contactPoint:"",queryString:void 0})},[c]),v=g||f;let j=!!(g&&g.length>3);try{g?(0,X.S6)(g):j=!0}catch{j=!1}return(0,e.jsxs)(b.B,{direction:"row",alignItems:"flex-end",gap:1,children:[(0,e.jsx)(L.D,{className:x.noBottom,label:(0,e.jsx)(a.J,{children:(0,e.jsxs)(b.B,{gap:.5,children:[(0,e.jsx)(o.x6,{i18nKey:"alerting.common.search-by-matchers",children:"Search by matchers"}),(0,e.jsx)(p.m,{content:(0,e.jsxs)(o.x6,{i18nKey:"alerting.policies.filter-description",children:["Filter notification policies by using a comma separated list of matchers, e.g.:",(0,e.jsx)("pre",{children:"severity=critical, region=EMEA"})]}),children:(0,e.jsx)(h.I,{name:"info-circle",size:"sm"})})]})}),invalid:!j,error:j?null:"Query must use valid matcher syntax",children:(0,e.jsx)($.p,{ref:m,"data-testid":"search-query-input",placeholder:(0,o.t)("alerting.notification-policies-filter.search-query-input-placeholder-search","Search"),width:46,prefix:(0,e.jsx)(h.I,{name:"search"}),onChange:M=>{c({queryString:M.currentTarget.value})},defaultValue:g})}),s&&l&&(0,e.jsx)(L.D,{label:(0,o.t)("alerting.notification-policies-filter.label-search-by-contact-point","Search by contact point"),style:{marginBottom:0},children:(0,e.jsx)(W.u,{selectProps:{id:"receiver","aria-label":"Search by contact point",onChange:M=>{c({contactPoint:M?.value?.name})},width:28,isClearable:!0},selectedContactPointName:u.get("contactPoint")??void 0})}),v&&(0,e.jsxs)(b.B,{alignItems:"center",children:[(0,e.jsx)(A.$n,{variant:"secondary",icon:"times",onClick:O,children:(0,e.jsx)(o.x6,{i18nKey:"alerting.common.clear-filters",children:"Clear filters"})}),(0,e.jsxs)(I.E,{variant:"bodySmall",color:"secondary",children:[r===0&&"No policies matching filters.",r===1&&`${r} policy matches the filters.`,r>1&&`${r} policies match the filters.`]})]})]})};function k(t,i){const r=new Map;function s(l,u){const c=[...u,l];if(i(l)){const m=r.get(l)??[];r.set(l,[...m,...c])}l.routes?.forEach(m=>s(m,c))}return s(t,[]),r}function fe(t,i){const r=i.map(_),s=(0,X.J$)(t).map(_);return r.every(l=>s.some(u=>(0,w.isEqual)(l,u)))}const _=([t,i,r])=>[(0,X.yk)(t),i,(0,X.yk)(r)],Re=t=>({queryString:t.get("queryString")??void 0,contactPoint:t.get("contactPoint")??void 0}),qt=()=>({noBottom:(0,E.css)({marginBottom:0})});var Ee=n(22787),_t=n(68079),en=n(82658),tn=n(55127),st=n.n(tn),We=n(99887);const nn=({active:t=0,suppressed:i=0,unprocessed:r=0})=>{const s=[],l=t+i+r;return t&&s.push((0,e.jsx)(We.E,{color:"red",text:`${t} firing`},"firing")),i&&s.push((0,e.jsx)(We.E,{color:"blue",text:`${i} suppressed`},"suppressed")),r&&s.push((0,e.jsx)(We.E,{color:"orange",text:`${r} unprocessed`},"unprocessed")),s.length>1&&s.unshift((0,e.jsxs)(d.Fragment,{children:[l," ",st()("instance",l)]},"total")),!!s.length?(0,e.jsx)(b.B,{gap:.5,children:s}):null};var Me=n(49785),on=n(20941),at=n(18857),rn=n(89599);const wt=(t,i)=>i(t===null?null:t?t.value?.name:"");var Fe=n(21563),Dt=n(65120),Ze=n(61474);const sn=({actionButtons:t,alertManagerSourceName:i,onSubmit:r,route:s})=>{const l=(0,R.of)(Dt.t),[u,c]=(0,d.useState)(!1),[m,g]=(0,d.useState)((0,B.gY)(s.group_by)),f=(0,B.YE)(s),{handleSubmit:x,register:y,control:O,formState:{errors:v},setValue:j,getValues:M}=(0,Me.mN)({defaultValues:{...f,overrideTimings:!0,overrideGrouping:!0}});return(0,e.jsxs)("form",{onSubmit:x(r),children:[(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-root-route-form.label-default-contact-point","Default contact point"),invalid:v.receiver?!0:void 0,error:v.receiver?.message,children:(0,e.jsxs)("div",{className:l.container,"data-testid":"am-receiver-select",children:[(0,e.jsx)(Me.xI,{render:({field:{onChange:D,ref:me,value:ne,...ee}})=>(0,e.jsx)(W.u,{selectProps:{...ee,onChange:ie=>wt(ie,D)},selectedContactPointName:ne}),control:O,name:"receiver",rules:{required:{value:!0,message:"Required."}}}),(0,e.jsx)("span",{children:(0,e.jsx)(o.x6,{i18nKey:"alerting.am-root-route-form.or",children:"or"})}),(0,e.jsx)(on.N,{className:l.linkText,href:(0,V.nL)("/alerting/notifications/receivers/new",i),children:(0,e.jsx)(o.x6,{i18nKey:"alerting.am-root-route-form.create-a-contact-point",children:"Create a contact point"})})]})}),(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-root-route-form.am-group-select-label-group-by","Group by"),description:"Combine multiple alerts into a single notification by grouping them by the same label values.","data-testid":"am-group-select",children:(0,e.jsx)(Me.xI,{render:({field:{onChange:D,ref:me,...ne}})=>(0,e.jsx)(at.KF,{"aria-label":(0,o.t)("alerting.am-root-route-form.aria-label-group-by","Group by"),...ne,allowCustomValue:!0,className:l.input,onCreateOption:ee=>{g(ie=>[...ie,(0,B.Mk)(ee)]),j("groupBy",[...ne.value||[],ee])},onChange:ee=>D((0,B.ie)(ee)),options:[...B.Yl,...m]}),control:O,name:"groupBy"})}),(0,e.jsx)(rn.S,{collapsible:!0,className:l.collapse,isOpen:u,label:(0,o.t)("alerting.am-root-route-form.label-timing-options","Timing options"),onToggle:c,children:(0,e.jsxs)("div",{className:l.timingFormContainer,children:[(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-root-route-form.am-group-wait-label-group-wait","Group wait"),description:"The waiting time before sending the first notification for a new group of alerts. Default 30 seconds.",invalid:!!v.groupWaitValue,error:v.groupWaitValue?.message,"data-testid":"am-group-wait",children:(0,e.jsx)(Fe.V,{...y("groupWaitValue",{validate:B.hH}),placeholder:Ze.H.group_wait,className:l.promDurationInput,"aria-label":(0,o.t)("alerting.am-root-route-form.aria-label-group-wait","Group wait")})}),(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-root-route-form.am-group-interval-label-group-interval","Group interval"),description:"The wait time before sending a notification about changes in the alert group after the first notification has been sent. Default is 5 minutes.",invalid:!!v.groupIntervalValue,error:v.groupIntervalValue?.message,"data-testid":"am-group-interval",children:(0,e.jsx)(Fe.V,{...y("groupIntervalValue",{validate:B.hH}),placeholder:Ze.H.group_interval,className:l.promDurationInput,"aria-label":(0,o.t)("alerting.am-root-route-form.aria-label-group-interval","Group interval")})}),(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-root-route-form.am-repeat-interval-label-repeat-interval","Repeat interval"),description:"The wait time before resending a notification that has already been sent successfully. Default is 4 hours. Should be a multiple of Group interval.",invalid:!!v.repeatIntervalValue,error:v.repeatIntervalValue?.message,"data-testid":"am-repeat-interval",children:(0,e.jsx)(Fe.V,{...y("repeatIntervalValue",{validate:D=>{const me=M("groupIntervalValue");return(0,B.DY)(D,me)}}),placeholder:Ze.H.repeat_interval,className:l.promDurationInput,"aria-label":(0,o.t)("alerting.am-root-route-form.aria-label-repeat-interval","Repeat interval")})})]})}),(0,e.jsx)("div",{className:l.container,children:t})]})};var Rt=n(76319),lt=n(21285),an=n(12594),ln=n(55684),Ie=n(92649);const Ot=({actionButtons:t,route:i,onSubmit:r,defaults:s})=>{const l=(0,R.of)(cn),u=(0,R.of)(Dt.t),{selectedAlertmanager:c}=(0,Ce.VI)(),[,m]=(0,P.L7)(P.QI.ViewMuteTiming),[g,f]=(0,d.useState)((0,B.gY)(i?.group_by)),x=[{name:"",operator:he.ho.equal,value:""}],y={...(0,B.YE)(i),...s},O={...y,object_matchers:i?y.object_matchers:x},{handleSubmit:v,control:j,register:M,formState:{errors:D},setValue:me,watch:ne,getValues:ee}=(0,Me.mN)({defaultValues:O}),{fields:ie,append:ye,remove:we}=(0,Me.jz)({control:j,name:"object_matchers"});return(0,e.jsxs)("form",{onSubmit:v(r),children:[(0,e.jsx)("input",{type:"hidden",...M("id")}),(0,e.jsxs)(b.B,{direction:"column",alignItems:"flex-start",children:[(0,e.jsx)("div",{children:(0,e.jsx)(o.x6,{i18nKey:"alerting.am-routes-expanded-form.matching-labels",children:"Matching labels"})}),ie.length===0&&(0,e.jsx)(We.E,{color:"orange",className:l.noMatchersWarning,icon:"exclamation-triangle",text:"If no matchers are specified, this notification policy will handle all alert instances."}),ie.length>0&&(0,e.jsx)("div",{className:l.matchersContainer,children:ie.map((U,J)=>(0,e.jsxs)(b.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-routes-expanded-form.label-label","Label"),invalid:!!D.object_matchers?.[J]?.name,error:D.object_matchers?.[J]?.name?.message,children:(0,e.jsx)($.p,{...M(`object_matchers.${J}.name`,{required:"Field is required"}),defaultValue:U.name,placeholder:(0,o.t)("alerting.am-routes-expanded-form.placeholder-label","label"),autoFocus:!0})}),(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-routes-expanded-form.label-operator","Operator"),children:(0,e.jsx)(Me.xI,{render:({field:{onChange:le,ref:ge,...oe}})=>(0,e.jsx)(at.l6,{...oe,className:l.matchersOperator,onChange:Oe=>le(Oe?.value),options:F.xH,"aria-label":(0,o.t)("alerting.am-routes-expanded-form.aria-label-operator","Operator")}),defaultValue:U.operator,control:j,name:`object_matchers.${J}.operator`,rules:{required:{value:!0,message:"Required."}}})}),(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-routes-expanded-form.label-value","Value"),invalid:!!D.object_matchers?.[J]?.value,error:D.object_matchers?.[J]?.value?.message,children:(0,e.jsx)($.p,{...M(`object_matchers.${J}.value`),defaultValue:U.value,placeholder:(0,o.t)("alerting.am-routes-expanded-form.placeholder-value","value")})}),(0,e.jsx)(Rt.K,{tooltip:(0,o.t)("alerting.am-routes-expanded-form.tooltip-remove-matcher","Remove matcher"),name:"trash-alt",onClick:()=>we(J),children:(0,e.jsx)(o.x6,{i18nKey:"alerting.am-routes-expanded-form.remove",children:"Remove"})})]},U.id))}),(0,e.jsx)(A.$n,{className:l.addMatcherBtn,icon:"plus",onClick:()=>ye(B.Rg),variant:"secondary",type:"button",children:(0,e.jsx)(o.x6,{i18nKey:"alerting.am-routes-expanded-form.add-matcher",children:"Add matcher"})})]}),(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-routes-expanded-form.label-contact-point","Contact point"),children:(0,e.jsx)(Me.xI,{render:({field:{onChange:U,ref:J,value:le,...ge}})=>(0,e.jsx)(W.u,{selectProps:{...ge,className:u.input,onChange:oe=>wt(oe,U),isClearable:!0},selectedContactPointName:le}),control:j,name:"receiver"})}),(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-routes-expanded-form.label-continue-matching-subsequent-sibling-nodes","Continue matching subsequent sibling nodes"),children:(0,e.jsx)(lt.d,{id:"continue-toggle",...M("continue")})}),(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-routes-expanded-form.label-override-grouping","Override grouping"),children:(0,e.jsx)(lt.d,{id:"override-grouping-toggle",...M("overrideGrouping")})}),ne().overrideGrouping&&(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-routes-expanded-form.label-group-by","Group by"),description:"Combine multiple alerts into a single notification by grouping them by the same label values. If empty, it is inherited from the parent policy.",children:(0,e.jsx)(Me.xI,{rules:{validate:U=>!U||U.length===0?"At least one group by option is required.":!0},render:({field:{onChange:U,ref:J,...le},fieldState:{error:ge}})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(at.KF,{"aria-label":(0,o.t)("alerting.am-routes-expanded-form.aria-label-group-by","Group by"),...le,invalid:!!ge,allowCustomValue:!0,className:u.input,onCreateOption:oe=>{f(Oe=>[...Oe,(0,B.Mk)(oe)]),me("groupBy",[...le.value||[],oe])},onChange:oe=>U((0,B.ie)(oe)),options:[...B.Yl,...g]}),ge&&(0,e.jsx)(an.P,{children:ge.message})]}),control:j,name:"groupBy"})}),(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-routes-expanded-form.label-override-general-timings","Override general timings"),children:(0,e.jsx)(lt.d,{id:"override-timings-toggle",...M("overrideTimings")})}),ne().overrideTimings&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(L.D,{label:Ie.G.groupWait.label,description:Ie.G.groupWait.description,invalid:!!D.groupWaitValue,error:D.groupWaitValue?.message,children:(0,e.jsx)(Fe.V,{...M("groupWaitValue",{validate:B.hH}),"aria-label":Ie.G.groupWait.ariaLabel,className:u.promDurationInput})}),(0,e.jsx)(L.D,{label:Ie.G.groupInterval.label,description:Ie.G.groupInterval.description,invalid:!!D.groupIntervalValue,error:D.groupIntervalValue?.message,children:(0,e.jsx)(Fe.V,{...M("groupIntervalValue",{validate:B.hH}),"aria-label":Ie.G.groupInterval.ariaLabel,className:u.promDurationInput})}),(0,e.jsx)(L.D,{label:Ie.G.repeatInterval.label,description:Ie.G.repeatInterval.description,invalid:!!D.repeatIntervalValue,error:D.repeatIntervalValue?.message,children:(0,e.jsx)(Fe.V,{...M("repeatIntervalValue",{validate:(U="")=>{const J=ee("groupIntervalValue");return(0,B.DY)(U,J)}}),"aria-label":Ie.G.repeatInterval.ariaLabel,className:u.promDurationInput})})]}),(0,e.jsx)(L.D,{label:(0,o.t)("alerting.am-routes-expanded-form.am-mute-timing-select-label-mute-timings","Mute timings"),"data-testid":"am-mute-timing-select",description:(0,o.t)("alerting.am-routes-expanded-form.am-mute-timing-select-description-add-mute-timing-to-policy","Add mute timing to policy"),invalid:!!D.muteTimeIntervals,children:(0,e.jsx)(Me.xI,{render:({field:{onChange:U,ref:J,...le}})=>(0,e.jsx)(ln.A,{alertmanager:c,selectProps:{...le,disabled:!m,onChange:ge=>U((0,B.ie)(ge))}}),control:j,name:"muteTimeIntervals"})}),t]})},cn=t=>{const i=t.spacing(3.5);return{addMatcherBtn:(0,E.css)({marginBottom:i}),matchersContainer:(0,E.css)({backgroundColor:t.colors.background.secondary,padding:`${t.spacing(1.5)} ${t.spacing(2)}`,paddingBottom:0,width:"fit-content"}),matchersOperator:(0,E.css)({minWidth:"120px"}),noMatchersWarning:(0,E.css)({padding:`${t.spacing(1)} ${t.spacing(2)}`,marginBottom:t.spacing(1)})}};var Bt=n(92125);const ct=({error:t})=>{const i=(0,o.t)("alerting.policies.update-errors.title","Error saving notification policy"),r=(0,V.JZ)(t);return(0,e.jsxs)(C.F,{title:i,severity:"error",children:[(0,e.jsx)("div",{children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.update-errors.fallback",children:"Something went wrong when updating your notification policies."})}),(0,e.jsx)("div",{children:r||(0,e.jsxs)(o.x6,{i18nKey:"alerting.policies.update-errors.error-code",values:{error:t},children:['Error message: "',{error:t},'"']})}),(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.update-errors.suffix",children:"Please refresh the page and try again."})]})},dn=(t,i)=>{const[r,s]=(0,d.useState)(!1),[l,u]=(0,d.useState)(void 0),[c,m]=(0,d.useState)(),g=(0,d.useCallback)(()=>{m(void 0),u(void 0),y(void 0),s(!1)},[]),f=(0,d.useCallback)((v,j)=>{m(v),u(j),s(!0)},[]),[x,y]=(0,d.useState)(void 0);return[(0,d.useMemo)(()=>i?(0,e.jsx)(dt,{isOpen:r}):(0,e.jsxs)(Ee.a,{isOpen:r,onDismiss:g,closeOnBackdropClick:!0,closeOnEscape:!0,title:(0,o.t)("alerting.use-add-policy-modal.modal-element.title-add-notification-policy","Add notification policy"),children:[x&&(0,e.jsx)(ct,{error:x}),(0,e.jsx)(Ot,{defaults:{groupBy:c?.group_by},onSubmit:v=>{c&&l&&t(v,c,l).catch(y)},actionButtons:(0,e.jsxs)(Ee.a.ButtonRow,{children:[(0,e.jsx)(A.$n,{type:"button",variant:"secondary",onClick:g,fill:"outline",children:(0,e.jsx)(o.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(A.$n,{type:"submit",children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.save-policy",children:"Save policy"})})]})})]}),[x,t,g,l,i,c,r,y]),f,g]},un=(t,i,r)=>{const[s,l]=(0,d.useState)(!1),[u,c]=(0,d.useState)(!1),[m,g]=(0,d.useState)(),[f,x]=(0,d.useState)(void 0),y=(0,d.useCallback)(()=>{g(void 0),l(!1),x(void 0)},[]),O=(0,d.useCallback)((j,M)=>{c(M??!1),g(j),l(!0)},[]);return[(0,d.useMemo)(()=>r?(0,e.jsx)(dt,{isOpen:s}):(0,e.jsxs)(Ee.a,{isOpen:s,onDismiss:y,closeOnBackdropClick:!0,closeOnEscape:!0,title:(0,o.t)("alerting.use-edit-policy-modal.modal-element.title-edit-notification-policy","Edit notification policy"),children:[f&&(0,e.jsx)(ct,{error:f}),u&&m&&(0,e.jsx)(sn,{alertManagerSourceName:t,onSubmit:j=>i(j).catch(x),route:m,actionButtons:(0,e.jsxs)(Ee.a.ButtonRow,{children:[(0,e.jsx)(A.$n,{type:"button",variant:"secondary",onClick:y,fill:"outline",children:(0,e.jsx)(o.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(A.$n,{type:"submit",children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.default-policy.update",children:"Update default policy"})})]})}),!u&&(0,e.jsx)(Ot,{route:m,onSubmit:j=>i(j).catch(x),actionButtons:(0,e.jsxs)(Ee.a.ButtonRow,{children:[(0,e.jsx)(A.$n,{type:"button",variant:"secondary",onClick:y,fill:"outline",children:(0,e.jsx)(o.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(A.$n,{type:"submit",children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.update.update-policy",children:"Update policy"})})]})})]}),[r,s,y,f,u,m,t,i,x]),O,y]},mn=(t,i)=>{const[r,s]=(0,d.useState)(!1),[l,u]=(0,d.useState)(),[c,m]=(0,d.useState)(void 0),g=(0,d.useCallback)(()=>{u(void 0),s(!1),m(void 0)},[u]),f=(0,d.useCallback)(y=>{u(y),s(!0)},[]);return[(0,d.useMemo)(()=>i?(0,e.jsx)(dt,{isOpen:r}):(0,e.jsxs)(Ee.a,{isOpen:r,onDismiss:g,closeOnBackdropClick:!0,closeOnEscape:!0,title:(0,o.t)("alerting.use-delete-policy-modal.modal-element.title-delete-notification-policy","Delete notification policy"),children:[c&&(0,e.jsx)(ct,{error:c}),(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.delete.warning-1",children:"Deleting this notification policy will permanently remove it."})," ",(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.delete.warning-2",children:"Are you sure you want to delete this policy?"}),(0,e.jsxs)(Ee.a.ButtonRow,{children:[(0,e.jsx)(A.$n,{type:"button",variant:"destructive",onClick:()=>l&&t(l).catch(m),children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.delete.confirm",children:"Yes, delete policy"})}),(0,e.jsx)(A.$n,{type:"button",variant:"secondary",onClick:g,children:(0,e.jsx)(o.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})})]})]}),[g,i,r,c,l,t]),f,g]},gn=t=>{const[i,r]=(0,d.useState)(!1),[s,l]=(0,d.useState)([]),[u,c]=(0,d.useState)([]),[m,g]=(0,d.useState)("default"),f=(0,d.useCallback)(()=>{r(!1),l([]),c([])},[]),x=(0,d.useCallback)((v,j,M)=>{l(v),j&&c(j),M&&g(M),r(!0)},[]),y=(0,d.useMemo)(()=>{const v=s.flatMap(j=>j.alerts);return(0,w.groupBy)(v,j=>j.status.state)},[s]);return[(0,d.useMemo)(()=>(0,e.jsxs)(Ee.a,{isOpen:i,onDismiss:f,closeOnBackdropClick:!0,closeOnEscape:!0,title:(0,e.jsxs)(b.B,{direction:"row",alignItems:"center",gap:1,wrap:"wrap",children:[(0,e.jsxs)(b.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(h.I,{name:"x"})," ",(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.matchers",children:"Matchers"})]}),(0,e.jsx)(Bt.s,{matchers:u,formatter:m})]}),children:[(0,e.jsxs)(b.B,{direction:"column",children:[(0,e.jsx)(nn,{active:y[he.Or.Active]?.length,suppressed:y[he.Or.Suppressed]?.length,unprocessed:y[he.Or.Unprocessed]?.length}),(0,e.jsx)("div",{children:s.map((v,j)=>(0,e.jsx)(en._,{alertManagerSourceName:t,group:v},j))})]}),(0,e.jsx)(Ee.a.ButtonRow,{children:(0,e.jsx)(A.$n,{type:"button",variant:"secondary",onClick:f,children:(0,e.jsx)(o.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})})})]}),[s,f,y,u,m,i,t]),x,f]},dt=({isOpen:t})=>(0,e.jsx)(Ee.a,{isOpen:t,onDismiss:()=>{},closeOnBackdropClick:!1,closeOnEscape:!1,title:(0,e.jsxs)(b.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.update.updating",children:"Updating..."})," ",(0,e.jsx)(_t.y,{inline:!0})]}),children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.update.please-wait",children:"Please wait while we update your notification policies."})});var ut=n(42941),pn=n(43173),Nt=n(88559),Ae=n(87063),Lt=n(89640),hn=n(48542),mt=n(10427),fn=n(50072),gt=n(16194),xn=n(24961),Xe=n(24898),pt=n(38055),Wt=n(78793),Se=n(1625),Ft=n(1972),Kt=n(49779),ke=n(6975),ht=n(70327),ft=n(77880),Gt=n(25149),Vt=n(78102);const yn=({exportFormat:t,onClose:i})=>{const{currentData:r="",isFetching:s}=ht.hK.useExportPoliciesQuery({format:t}),l=`policies-${new Date().getTime()}`;return s?(0,e.jsx)(ke._,{text:(0,o.t)("alerting.grafana-policies-exporter-preview.text-loading","Loading....")}):(0,e.jsx)(ft.J,{format:t,textDefinition:r,downloadFileName:l,onClose:i})},vn=({onClose:t})=>{const[i,r]=(0,d.useState)("yaml");return(0,e.jsx)(Gt.m,{activeTab:i,onTabChange:r,onClose:t,formatProviders:Object.values(Vt.sl),children:(0,e.jsx)(yn,{exportFormat:i,onClose:t})})},zt=20,$t=t=>{const{receivers:i=[],contactPointsState:r,readOnly:s=!1,provisioned:l=!1,alertManagerSourceName:u,currentRoute:c,inheritedProperties:m,routesMatchingFilters:g={filtersApplied:!1,matchedRoutesWithPath:new Map},matchingInstancesPreview:f={enabled:!1},onEditPolicy:x,onAddPolicy:y,onDeletePolicy:O,onShowAlertInstances:v,isAutoGenerated:j=!1,isDefaultPolicy:M=!1}=t,D=(0,R.of)(Ve),me=c.receiver,ne=c.continue??!1,ee=(0,X.J$)(c),ie=!!(ee&&ee.length),{filtersApplied:ye,matchedRoutesWithPath:we}=g,U=Array.from(we.keys()),J=ye&&U.some(re=>re.id===c.id),le=Array.from(we.values()).flat(),ge=le.some(re=>re.id===c.id),oe=[],Oe=!ie&&!M&&!ne,yt=me??m?.receiver??"",ve=r?Dn(yt,r):[],_e=c.routes??[],ze=ye?_e.filter(re=>le.some(Ye=>Ye.id===re.id)):_e,et=ze.length>0,[tt,nt]=(0,ut.A)(!1),$e=f?.groupsMap?.get(c.id),vt=$e?(0,w.sumBy)($e,re=>re.alerts.length):void 0,[jt,Ue]=(0,P.L7)(P.QI.ViewAutogeneratedPolicyTree),Be=Ut(c),[He,bt]=(0,ut.A)(!Be),Pt=c.group_by,Et=c.mute_time_intervals??[],At=c.active_time_intervals??[],St={group_wait:c.group_wait,group_interval:c.group_interval,repeat_interval:c.repeat_interval};ve.forEach(re=>{oe.push(re)});const[it,Ct]=(0,d.useState)(zt),ot=bn(j,M,l,x,c,nt,O);if(j&&(!Ue||!jt)||ye&&!ge)return null;const Mt=M||Be,It=ze.filter(re=>le.some(Ye=>Ye.id===re.id)),rt=ye?It:ze,pe=rt.slice(0,it),Qe=rt.length-pe.length,Tt=Qe>0;return(0,e.jsxs)(b.B,{direction:"column",gap:1.5,children:[(0,e.jsxs)("div",{className:D.policyWrapper(J),"data-testid":M?"am-root-route-container":"am-route-container",children:[ne&&(0,e.jsx)(An,{}),Oe&&(0,e.jsx)(Sn,{}),(0,e.jsx)("div",{className:D.policyItemWrapper,children:(0,e.jsxs)(b.B,{direction:"column",gap:1,children:[(0,e.jsx)("div",{children:(0,e.jsxs)(b.B,{direction:"row",alignItems:"center",gap:1,children:[et?(0,e.jsx)(Rt.K,{name:He?"angle-down":"angle-right",onClick:bt,"aria-label":He?"Collapse":"Expand"}):null,Mt?Be?(0,e.jsx)(Mn,{}):(0,e.jsx)(Cn,{}):ie?(0,e.jsx)(Bt.s,{matchers:ee??[],formatter:(0,F.VE)(u)}):(0,e.jsx)("span",{className:D.metadata,children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.no-matchers",children:"No matchers"})}),(0,e.jsx)(Kt.h,{}),oe.length>0&&(0,e.jsx)(En,{errors:oe}),l&&(0,e.jsx)(Ft.rS,{}),(0,e.jsxs)(b.B,{direction:"row",gap:.5,children:[!j&&!s&&(0,e.jsx)(Xe._,{actions:[P.QI.CreateNotificationPolicy],children:(0,e.jsx)(mt.A,{shouldWrap:l,wrap:xt,children:M?(0,e.jsx)(A.$n,{variant:"secondary",icon:"plus",size:"sm",disabled:l,type:"button",onClick:()=>y(c,"child"),children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.new-child",children:"New child policy"})}):(0,e.jsx)(Nt.m,{overlay:(0,e.jsxs)(Ae.W,{children:[(0,e.jsx)(Ae.W.Item,{label:(0,o.t)("alerting.policy.label-new-sibling-above","New sibling above"),icon:"arrow-up",onClick:()=>y(c,"above")}),(0,e.jsx)(Ae.W.Item,{label:(0,o.t)("alerting.policy.label-new-sibling-below","New sibling below"),icon:"arrow-down",onClick:()=>y(c,"below")}),(0,e.jsx)(Ae.W.Divider,{}),(0,e.jsx)(Ae.W.Item,{label:(0,o.t)("alerting.policy.label-new-child-policy","New child policy"),icon:"plus",onClick:()=>y(c,"child")})]}),children:(0,e.jsx)(A.$n,{size:"sm",variant:"secondary",disabled:l,icon:"angle-down",type:"button",children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.new-policy",children:"Add new policy"})})})})}),ot.length>0&&(0,e.jsx)(Nt.m,{overlay:(0,e.jsx)(Ae.W,{children:ot}),children:(0,e.jsx)(fn.A,{"aria-label":M?"more actions for default policy":"more actions for policy","data-testid":"more-actions"})})]})]})}),(0,e.jsx)(jn,{matchingInstancesPreview:f,numberOfAlertInstances:vt,contactPoint:me??void 0,groupBy:Pt,muteTimings:Et,activeTimings:At,timingOptions:St,inheritedProperties:m,alertManagerSourceName:u,receivers:i,matchingAlertGroups:$e,matchers:ee,isDefaultPolicy:M,onShowAlertInstances:v})]})})]}),(0,e.jsx)("div",{className:D.childPolicies,children:He&&(0,e.jsxs)(e.Fragment,{children:[pe.map(re=>{const Ye=(0,je.W$)(c,re,m),ri=Ut(re)||j,si=s||l||j;return(0,e.jsx)($t,{currentRoute:re,receivers:i,contactPointsState:r,readOnly:si,inheritedProperties:Ye,onAddPolicy:y,onEditPolicy:x,onDeletePolicy:O,onShowAlertInstances:v,alertManagerSourceName:u,routesMatchingFilters:g,matchingInstancesPreview:f,isAutoGenerated:ri,provisioned:l},re.id)}),Tt&&(0,e.jsx)(A.$n,{size:"sm",icon:"angle-down",variant:"secondary",className:D.moreButtons,onClick:()=>Ct(it+zt),children:(0,e.jsxs)(o.x6,{i18nKey:"alerting.policies.n-more-policies",count:Qe,children:[{count:Qe}," additional policies"]})})]})}),tt&&(0,e.jsx)(vn,{onClose:nt})]})};function jn({numberOfAlertInstances:t,isDefaultPolicy:i,timingOptions:r,groupBy:s,muteTimings:l=[],activeTimings:u=[],matchingInstancesPreview:c,inheritedProperties:m,matchingAlertGroups:g,onShowAlertInstances:f,matchers:x,contactPoint:y,alertManagerSourceName:O,receivers:v}){const j=(0,R.of)(Ve),M=m&&m.group_by,D=m&&Object.keys(m).length>0,me=(0,w.isArray)(s)&&s[0]==="...",ne=!me&&(0,w.isArray)(s)&&s.length>0,ee=i&&(0,w.isArray)(s)&&s.length===0,ie=!!l.length,ye=!!u.length;return(0,e.jsx)("div",{className:j.metadataRow,children:(0,e.jsxs)(b.B,{direction:"row",alignItems:"center",gap:1,children:[c.enabled&&(0,e.jsxs)(Se.P,{icon:"layers-alt",onClick:()=>{g&&f(g,x,(0,F.VE)(O))},"data-testid":"matching-instances",children:[(0,e.jsx)(I.E,{color:"primary",children:t??"-"}),(0,e.jsx)("span",{children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.metadata.n-instances",count:t??0,children:"instance"})})]}),y&&(0,e.jsxs)(Se.P,{icon:"at","data-testid":"contact-point",children:[(0,e.jsxs)("span",{children:[(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.metadata.delivered-to",children:"Delivered to"})," "]}),(0,e.jsx)(wn,{alertManagerSourceName:O,receivers:v,contactPoint:y})]}),!M&&(0,e.jsxs)(e.Fragment,{children:[ne&&(0,e.jsxs)(Se.P,{icon:"layer-group","data-testid":"grouping",children:[(0,e.jsxs)("span",{children:[(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.metadata.grouped-by",children:"Grouped by"})," "]}),(0,e.jsx)(I.E,{color:"primary",children:s.join(", ")})]}),ee&&(0,e.jsx)(Se.P,{icon:"layer-group",children:(0,e.jsx)("span",{children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.metadata.grouping.single-group",children:"Single group"})})}),me&&(0,e.jsx)(Se.P,{icon:"layer-group",children:(0,e.jsx)("span",{children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.metadata.grouping.none",children:"Not grouping"})})})]}),ie&&(0,e.jsxs)(Se.P,{icon:"calendar-slash","data-testid":"mute-timings",children:[(0,e.jsxs)("span",{children:[(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.metadata.mute-time",children:"Muted when"})," "]}),(0,e.jsx)(Ht,{timings:l,alertManagerSourceName:O})]}),ye&&(0,e.jsxs)(Se.P,{icon:"calendar-alt","data-testid":"active-timings",children:[(0,e.jsxs)("span",{children:[(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.metadata.active-time",children:"Active when"})," "]}),(0,e.jsx)(Ht,{timings:u,alertManagerSourceName:O})]}),r&&(0,e.jsx)(Tn,{timingOptions:r}),D&&(0,e.jsxs)(Se.P,{icon:"corner-down-right-alt","data-testid":"inherited-properties",children:[(0,e.jsx)("span",{children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.metadata.inherited",children:"Inherited"})}),(0,e.jsx)(In,{properties:m})]})]})})}const bn=(t,i,r,s,l,u,c)=>{const[[m,g],[f,x],[y,O]]=(0,P.Hl)([P.QI.UpdateNotificationPolicyTree,P.QI.DeleteNotificationPolicy,P.QI.ExportNotificationPolicies]),v=[],j=O&&y&&i&&!t,M=m&&g,D=f&&x&&!i&&!t;return M&&v.push((0,e.jsx)(d.Fragment,{children:(0,e.jsx)(mt.A,{shouldWrap:r,wrap:xt,children:(0,e.jsx)(Ae.W.Item,{icon:"edit",disabled:r||t,label:(0,o.t)("alerting.use-create-dropdown-menu-actions.label-edit","Edit"),onClick:()=>s(l,i)})})},"edit-policy")),j&&v.push((0,e.jsx)(Ae.W.Item,{icon:"download-alt",label:(0,o.t)("alerting.use-create-dropdown-menu-actions.label-export","Export"),onClick:u},"export-policy")),D&&v.push((0,e.jsxs)(d.Fragment,{children:[(0,e.jsx)(Ae.W.Divider,{}),(0,e.jsx)(mt.A,{shouldWrap:r,wrap:xt,children:(0,e.jsx)(Ae.W.Item,{destructive:!0,icon:"trash-alt",disabled:r||t,label:(0,o.t)("alerting.use-create-dropdown-menu-actions.label-delete","Delete"),onClick:()=>c(l)})})]},"delete-policy")),v},Pn="__grafana_autogenerated__";function Ut(t){return!(pn.$.featureToggles.alertingSimplifiedRouting??!1)||!t.object_matchers?!1:t.object_matchers.some(r=>r[0]===Pn&&r[1]===he.ho.equal&&r[2]==="true")??!1}const xt=t=>(0,e.jsx)(p.m,{content:"Provisioned items cannot be edited in the UI",placement:"top",children:(0,e.jsx)("span",{children:t})}),En=({errors:t})=>(0,e.jsx)(pt.B,{arrow:!0,placement:"top",content:(0,e.jsx)(b.B,{direction:"column",gap:.5,children:t.map(i=>(0,e.jsx)(d.Fragment,{children:i},(0,w.uniqueId)()))}),children:(0,e.jsx)("span",{children:(0,e.jsx)(We.E,{icon:"exclamation-circle",color:"red",text:st()("error",t.length,!0)})})}),An=()=>{const t=(0,R.of)(Ve);return(0,e.jsx)(p.m,{placement:"top",content:"This route will continue matching other policies",children:(0,e.jsx)("div",{className:t.gutterIcon,"data-testid":"continue-matching",children:(0,e.jsx)(h.I,{name:"arrow-down"})})})},Sn=()=>{const t=(0,R.of)(Ve);return(0,e.jsx)(p.m,{placement:"top",content:"This policy matches all labels",children:(0,e.jsx)("div",{className:t.gutterIcon,"data-testid":"matches-all",children:(0,e.jsx)(h.I,{name:"exclamation-triangle"})})})};function Cn(){const t=(0,R.of)(Ve);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(I.E,{element:"h2",variant:"body",weight:"medium",children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.default-policy.title",children:"Default policy"})}),(0,e.jsx)("span",{className:t.metadata,children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.default-policy.description",children:"All alert instances will be handled by the default policy if no other matching policies are found."})})]})}function Mn(){return(0,e.jsx)(I.E,{element:"h3",variant:"body",weight:"medium",children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.generated-policies",children:"Auto-generated policies"})})}const In=({properties:t})=>(0,e.jsx)(pt.B,{arrow:!0,placement:"top",content:(0,e.jsx)(b.B,{direction:"row",gap:.5,children:Object.entries(t).map(([i,r])=>r?(0,e.jsx)(Wt.J,{label:Rn(i),value:On(i,r)},i):null)}),children:(0,e.jsx)("div",{children:(0,e.jsx)(I.E,{color:"primary",children:st()("property",Object.keys(t).length,!0)})})}),Ht=({timings:t,alertManagerSourceName:i})=>{const[,r]=(0,P.L7)(P.QI.ViewMuteTiming);return(0,e.jsx)("div",{children:t.map((s,l)=>{const u=r?Lt.Y:I.E;return(0,e.jsxs)(d.Fragment,{children:[(0,e.jsx)(u,{href:(0,V.i7)(s,i),color:r?"primary":"secondary",variant:"bodySmall",inline:r?!1:void 0,children:s}),l<t.length-1&&", "]},s)})})},Tn=({timingOptions:t})=>{const i=t.group_wait,r=t.group_interval,s=t.repeat_interval;if(!i&&!r&&!s)return null;const l=[];return i&&l.push((0,e.jsx)(p.m,{placement:"top",content:(0,o.t)("alerting.policies.metadata.timingOptions.groupWait.description","How long to initially wait to send a notification for a group of alert instances."),children:(0,e.jsx)("span",{children:(0,e.jsxs)(o.x6,{i18nKey:"alerting.policies.metadata.timingOptions.groupWait.label",children:["Wait ",(0,e.jsx)(gt.S,{content:i})," to group instances"]})})})),r&&l.push((0,e.jsx)(p.m,{placement:"top",content:(0,o.t)("alerting.policies.metadata.timingOptions.groupInterval.description","How long to wait before sending a notification about new alerts that are added to a group of alerts for which an initial notification has already been sent."),children:(0,e.jsx)("span",{children:(0,e.jsxs)(o.x6,{i18nKey:"alerting.policies.metadata.timingOptions.groupInterval.label",children:["Wait ",(0,e.jsx)(gt.S,{content:r})," before sending updates"]})})})),s&&l.push((0,e.jsx)(p.m,{placement:"top",content:(0,o.t)("alerting.policies.metadata.timingOptions.repeatInterval.description","How often notifications are sent if the group of alerts has not changed since the last notification."),children:(0,e.jsx)("span",{children:(0,e.jsxs)(o.x6,{i18nKey:"alerting.policies.metadata.timingOptions.repeatInterval.label",children:["Repeated every ",(0,e.jsx)(gt.S,{content:s})]})})})),(0,e.jsx)(Se.P,{icon:"hourglass","data-testid":"timing-options",children:l.map((u,c)=>(0,e.jsxs)("span",{children:[u,c<l.length-1&&" \xB7 "]},(0,w.uniqueId)()))})},wn=({alertManagerSourceName:t,contactPoint:i,receivers:r})=>{const s=r.find(c=>c.name===i);if(!s)return(0,e.jsx)(I.E,{color:"secondary",variant:"bodySmall",children:i});const l=s.grafana_managed_receiver_configs,u="id"in s&&s.id?(0,V.bg)(s.id,t):(0,V.bI)(s.name,t);return(0,e.jsx)(pt.B,{disabled:!l,arrow:!0,placement:"top",header:(0,e.jsx)(Se.P,{icon:"at",children:(0,e.jsx)(I.E,{color:"primary",children:i})}),content:(0,e.jsx)(I.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(xn.yz,{receivers:s.grafana_managed_receiver_configs||[],limit:3})}),children:(0,e.jsx)(Lt.Y,{href:u,color:"primary",variant:"bodySmall",inline:!1,children:i})},(0,w.uniqueId)())};function Dn(t,i){return Object.entries(i[t]?.notifiers??[]).reduce((l=[],[u,c])=>{const m=c.filter(g=>g.lastNotifyAttemptError).map(g=>(0,e.jsx)(Wt.J,{icon:"at",label:`Contact Point \u203A ${g.name}`,value:g.lastNotifyAttemptError},(0,w.uniqueId)()));return l.concat(m)},[])}const Rn=t=>{switch(t){case"receiver":return"Contact Point";case"group_by":return"Group by";case"group_interval":return"Group interval";case"group_wait":return"Group wait";case"repeat_interval":return"Repeat interval";default:return t}},On=(t,i)=>{const r=t==="group_by"&&Array.isArray(i)&&i[0]==="...",s=t==="group_by"&&Array.isArray(i)&&i.length===0;return r?(0,e.jsx)(I.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.metadata.grouping.none",children:"Not grouping"})}):s?(0,e.jsx)(I.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.metadata.grouping.single-group",children:"Single group"})}):Array.isArray(i)?i.join(", "):i},Ve=t=>({matcher:i=>{const{color:r,borderColor:s}=(0,hn.MC)(i);return{wrapper:(0,E.css)({color:"#fff",background:r,padding:`${t.spacing(.33)} ${t.spacing(.66)}`,fontSize:t.typography.bodySmall.fontSize,border:`solid 1px ${s}`,borderRadius:t.shape.radius.default})}},childPolicies:(0,E.css)({marginLeft:t.spacing(4),position:"relative","&:before":{content:'""',position:"absolute",height:"calc(100% - 10px)",borderLeft:`solid 1px ${t.colors.border.weak}`,marginTop:0,marginLeft:"-20px"}}),policyItemWrapper:(0,E.css)({padding:t.spacing(1.5)}),metadataRow:(0,E.css)({borderBottomLeftRadius:t.shape.borderRadius(2),borderBottomRightRadius:t.shape.borderRadius(2)}),policyWrapper:(i=!1)=>(0,E.css)({flex:1,position:"relative",background:t.colors.background.secondary,borderRadius:t.shape.radius.default,border:`solid 1px ${t.colors.border.weak}`,...i&&{borderColor:t.colors.primary.border,background:t.colors.primary.transparent}}),metadata:(0,E.css)({color:t.colors.text.secondary,fontSize:t.typography.bodySmall.fontSize,fontWeight:t.typography.bodySmall.fontWeight}),break:(0,E.css)({width:"100%",height:0,marginBottom:t.spacing(2)}),gutterIcon:(0,E.css)({position:"absolute",top:0,transform:"translateY(50%)",left:`-${t.spacing(4)}`,color:t.colors.text.secondary,background:t.colors.background.primary,width:"25px",height:"25px",textAlign:"center",border:`solid 1px ${t.colors.border.weak}`,borderRadius:t.shape.radius.default,padding:0}),moreButtons:(0,E.css)({marginTop:t.spacing(.5),marginBottom:t.spacing(1.5)})});var qe=n(46202);const Bn=()=>{const t=(0,se._2)(),[i,r]=(0,P.L7)(P.QI.ViewContactPoint),[s,l]=(0,P.L7)(P.QI.ViewAlertGroups),{useGetAlertmanagerAlertGroupsQuery:u}=Ge.m,[c,m]=(0,d.useState)(),[g,f]=(0,d.useState)([]),{selectedAlertmanager:x,hasConfigurationAPI:y,isGrafanaAlertmanager:O}=(0,Ce.VI)(),{getRouteGroupsMap:v}=(0,N.L)(),j=i&&r,M=Q(j?x??"":""),{currentData:D,isLoading:me,error:ne,refetch:ee}=(0,qe.yV)({alertmanager:x??""}),[ie]=D??[],[ye,we]=(0,qe.a1)({alertmanager:x??""}),[U,J]=(0,qe.F)({alertmanager:x??""}),[le,ge]=(0,qe.g0)({alertmanager:x??""}),{currentData:oe,refetch:Oe}=u({amSourceName:x??""},{skip:!l||!x}),{contactPoints:yt}=(0,te.dK)({alertmanager:x??"",fetchPolicies:!1,fetchStatuses:!0,skip:!j}),ve=(0,d.useMemo)(()=>{if(ie)return(0,B.QM)(ie)},[ie]),[{value:_e,error:ze},et]=(0,T.A)(v,[v]);(0,d.useEffect)(()=>{ve&&oe&&et(ve,oe,{unquoteMatchers:!O})},[ve,oe,et,O]);const tt=(0,d.useMemo)(()=>ve?Nn(ve,{contactPointFilter:c,labelMatchersFilter:g}):{filtersApplied:!1,matchedRoutesWithPath:new Map},[c,g,ve]),nt=()=>{ee(),U.reset(),ye.reset(),le.reset()};async function $e(pe){await U.execute(pe),Ue({error:J.error})}async function vt(pe){await ye.execute(pe.id),Ue({error:we.error})}async function jt(pe,Qe,Tt){await le.execute({partialRoute:pe,referenceRouteIdentifier:Qe.id,insertPosition:Tt}),Ue({error:ge.error})}function Ue({error:pe}){pe||t.success("Updated notification policies"),x&&Oe(),St(),Pt(),ot()}const Be=(0,be.Gz)(J,we,ge).loading,[He,bt,Pt]=dn(jt,Be),[Et,At,St]=un(x??"",$e,Be),[it,Ct,ot]=mn(vt,Be),[Xt,kt]=gn(x??"");if(!x)return null;const Mt=ve&&!ne&&!me,It=!!ne&&!me,rt=[ge,J,we].some(pe=>(0,be.bJ)(pe)&&(0,V.E2)(pe.error)===Ke.g2);return(0,e.jsxs)(e.Fragment,{children:[It&&(0,e.jsx)(C.F,{severity:"error",title:(0,o.t)("alerting.notification-policies-list.title-error-loading-alertmanager-config","Error loading Alertmanager config"),children:(0,V.JZ)(ne)||"Unknown error."}),rt&&(0,e.jsx)(C.F,{severity:"info",title:(0,o.t)("alerting.notification-policies-list.title-notification-policies-have-changed","Notification policies have changed"),children:(0,e.jsxs)(b.B,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.update-errors.conflict",children:"The notification policy tree has been updated by another user."}),(0,e.jsx)(A.$n,{onClick:nt,children:(0,e.jsx)(o.x6,{i18nKey:"alerting.policies.reload-policies",children:"Reload policies"})})]})}),Mt&&(0,e.jsxs)(b.B,{direction:"column",gap:1,children:[(0,e.jsx)(Y,{onChangeMatchers:f,onChangeReceiver:m,matchingCount:tt.matchedRoutesWithPath.size}),(0,e.jsx)($t,{receivers:yt,currentRoute:(0,w.defaults)(ve,Ze.H),contactPointsState:M.receivers,readOnly:!y,provisioned:ve[he.uz]?.provisioned,alertManagerSourceName:x,onAddPolicy:bt,onEditPolicy:At,onDeletePolicy:Ct,onShowAlertInstances:kt,routesMatchingFilters:tt,matchingInstancesPreview:{groupsMap:_e,enabled:!!(l&&!ze)},isAutoGenerated:!1,isDefaultPolicy:!0})]}),He,Et,it,Xt]})},Nn=(t,i)=>{const{contactPointFilter:r,labelMatchersFilter:s=[]}=i,l=r||s.length>0,u=!!r&&s.length>0;if(!l)return{filtersApplied:!1,matchedRoutesWithPath:new Map};const c=[],m=(0,je._I)(t),g=r?k(m,v=>v.receiver===r):new Map,f=Array.from(g.keys());f&&c.push(f);const x=s.length?k(m,v=>fe(v,s)):new Map,y=Array.from(x.keys());return x.size>0&&c.push(y),{filtersApplied:!0,matchedRoutesWithPath:u?Ln(x,g):new Map([...x,...g])}};function Ln(...t){const i=new Map;for(const r of t[0].keys())t.every(s=>s.has(r))&&i.set(r,t[0].get(r));return i}var Wn=n(36826),Fn=n(58750),Kn=n(71599);const Gn=({exportFormat:t,onClose:i})=>{const{currentData:r="",isFetching:s}=ht.hK.useExportMuteTimingsQuery({format:t}),l=`mute-timings-${new Date().getTime()}`;return s?(0,e.jsx)(ke._,{text:(0,o.t)("alerting.grafana-mute-timings-exporter-preview.text-loading","Loading....")}):(0,e.jsx)(ft.J,{format:t,textDefinition:r,downloadFileName:l,onClose:i})},Vn=({exportFormat:t,onClose:i,muteTimingName:r})=>{const{currentData:s="",isFetching:l}=ht.hK.useExportMuteTimingQuery({format:t,muteTiming:r}),u=`mute-timing-${r}-${new Date().getTime()}`;return l?(0,e.jsx)(ke._,{text:(0,o.t)("alerting.grafana-mute-timing-exporter-preview.text-loading","Loading....")}):(0,e.jsx)(ft.J,{format:t,textDefinition:s,downloadFileName:u,onClose:i})},Qt=({onClose:t,muteTimingName:i})=>{const[r,s]=(0,d.useState)("yaml");return(0,e.jsx)(Gt.m,{activeTab:r,onTabChange:s,onClose:t,formatProviders:Object.values(Vt.sl),children:i?(0,e.jsx)(Vn,{exportFormat:r,onClose:t,muteTimingName:i}):(0,e.jsx)(Gn,{exportFormat:r,onClose:t})})},Yt=Symbol("all mute timings"),Jt=()=>{const[t,i]=(0,d.useState)(null),[r,s]=(0,ut.A)(!1),l=(0,d.useCallback)(()=>{i(null),s(!1)},[s]),u=m=>{i(m),s(!0)};return[(0,d.useMemo)(()=>!t||!r?null:t===Yt?(0,e.jsx)(Qt,{onClose:l}):(0,e.jsx)(Qt,{muteTimingName:t,onClose:l}),[r,l,t]),u]};var zn=n(97539);const $n=({muteTiming:t,alertManagerSourceName:i})=>{const[r,s]=(0,ue.gB)({alertmanager:i}),[l,u]=(0,d.useState)(!1),[c,m]=Jt(),[g,f]=(0,P.L7)(P.QI.ExportMuteTimings),x=()=>u(!1),y=i===Le.hY,O=(0,V.nL)("/alerting/routes/mute-timing/edit",i,{muteName:t.id}),v=(0,e.jsx)(A.z9,{href:O,variant:"secondary",size:"sm",icon:t.provisioned?"eye":"pen",disabled:(0,be.VP)(s),children:t.provisioned?(0,e.jsx)(o.x6,{i18nKey:"alerting.common.view",children:"View"}):(0,e.jsx)(o.x6,{i18nKey:"alerting.common.edit",children:"Edit"})});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(b.B,{direction:"row",alignItems:"center",justifyContent:"flex-end",wrap:"wrap",children:[!y&&(0,zn.d6)(t)&&(0,e.jsx)(We.E,{text:(0,o.t)("alerting.mute-timing-actions-buttons.text-disabled","Disabled"),color:"orange"}),(0,e.jsx)(Xe._,{actions:[P.QI.UpdateMuteTiming],children:v}),g&&(0,e.jsx)(A.z9,{icon:"download-alt",variant:"secondary",size:"sm","data-testid":"export",disabled:!f||(0,be.VP)(s),onClick:()=>m(t.name),children:(0,e.jsx)(o.x6,{i18nKey:"alerting.common.export",children:"Export"})}),!t.provisioned&&(0,e.jsx)(Xe._,{actions:[P.QI.DeleteMuteTiming],children:(0,e.jsx)(A.z9,{icon:"trash-alt",variant:"secondary",size:"sm",onClick:()=>u(!0),disabled:(0,be.VP)(s),children:(0,e.jsx)(o.x6,{i18nKey:"alerting.common.delete",children:"Delete"})})})]}),(0,e.jsx)(Kn.u,{isOpen:l,title:(0,o.t)("alerting.mute-timing-actions-buttons.title-delete-mute-timing","Delete mute timing"),body:`Are you sure you would like to delete "${t.name}"?`,confirmText:(0,o.t)("alerting.common.delete","Delete"),onConfirm:async()=>{await r.execute({name:t?.metadata?.name??t.name}),x()},onDismiss:x}),c]})};var Un=n(22628),Hn=n(6106),Qn=n(58887);const Zt=({buttonIcon:t,buttonLabel:i,buttonSize:r="lg",buttonVariant:s="primary",onButtonClick:l,text:u,href:c,showButton:m=!0})=>{const g=(0,R.of)(Yn),f={className:g.button,icon:t,size:r,variant:s};return(0,e.jsx)(Qn.Z,{children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:g.text,children:u}),m&&(c?(0,e.jsx)(A.z9,{href:c,type:"button",...f,children:i}):(0,e.jsx)(A.$n,{onClick:l,type:"button",...f,children:i}))]})})},Yn=t=>({container:(0,E.css)({backgroundColor:t.colors.background.secondary,color:t.colors.text.secondary,padding:t.spacing(4),textAlign:"center"}),text:(0,E.css)({marginBottom:t.spacing(2)}),button:(0,E.css)({margin:t.spacing(2,0,1)})});var Jn=n(78747);const Zn=()=>{const{selectedAlertmanager:t="",hasConfigurationAPI:i}=(0,Ce.VI)(),r=!i,s=(0,R.of)(kn),[l,u]=Jt(),{data:c,isLoading:m,error:g}=(0,ue.Ad)({alertmanager:t??""}),f=(0,d.useMemo)(()=>(c||[]).map(D=>({id:D.id,data:D})),[c]),[x,y]=(0,P.L7)(P.QI.CreateMuteTiming),[O,v]=(0,P.L7)(P.QI.ExportMuteTimings),j=Xn(t,r);return m?(0,e.jsx)(ke._,{text:(0,o.t)("alerting.mute-timings-table.text-loading-mute-timings","Loading mute timings...")}):g?(0,e.jsx)(C.F,{severity:"error",title:(0,o.t)("alerting.mute_timings.error-loading.title","Error loading mute timings"),children:(0,e.jsx)(o.x6,{i18nKey:"alerting.mute_timings.error-loading.description",children:"Could not load mute timings. Please try again later."})}):(0,e.jsxs)("div",{className:s.container,children:[(0,e.jsxs)(b.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(o.x6,{i18nKey:"alerting.mute-timings.description",children:"Enter specific time intervals when not to send notifications or freeze notifications for recurring periods of time."}),(0,e.jsx)(Kt.h,{}),!r&&f.length>0&&(0,e.jsx)(Xe._,{actions:[P.QI.CreateMuteTiming],children:(0,e.jsx)(A.z9,{className:s.muteTimingsButtons,icon:"plus",variant:"primary",href:(0,V.nL)("alerting/routes/mute-timing/new",t),children:(0,e.jsx)(o.x6,{i18nKey:"alerting.mute-timings.add-mute-timing",children:"Add mute timing"})})}),O&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(A.$n,{icon:"download-alt",className:s.muteTimingsButtons,variant:"secondary",disabled:!v,onClick:()=>u(Yt),children:(0,e.jsx)(o.x6,{i18nKey:"alerting.common.export-all",children:"Export all"})}),l]})]}),f.length>0?(0,e.jsx)(Hn.E,{items:f,cols:j,pagination:{itemsPerPage:25}}):r?(0,e.jsx)(Zt,{text:(0,o.t)("alerting.mute-timings-table.text-no-mute-timings-configured","No mute timings configured"),buttonLabel:"",showButton:!1}):(0,e.jsx)(Zt,{text:(0,o.t)("alerting.mute-timings-table.text-havent-created-timings","You haven't created any mute timings yet"),buttonLabel:"Add mute timing",buttonIcon:"plus",buttonSize:"lg",href:(0,V.nL)("alerting/routes/mute-timing/new",t),showButton:y})]})};function Xn(t,i=!1){const[[r,s],[l,u]]=(0,P.Hl)([P.QI.UpdateMuteTiming,P.QI.DeleteMuteTiming]),c=!i&&(s||u);return(0,d.useMemo)(()=>{const m=[{id:"name",label:"Name",renderCell:function({data:f}){return(0,e.jsxs)("div",{children:[f.name," ",f.provisioned&&(0,e.jsx)(Ft.rS,{tooltip:!0,provenance:f.metadata?.annotations?.[Un.a3]})]})},size:1},{id:"timeRange",label:"Time range",renderCell:({data:g})=>(0,Jn.av)(g),size:5}];return c&&m.push({id:"actions",label:"Actions",alignColumn:"end",renderCell:({data:g})=>(0,e.jsx)($n,{muteTiming:g,alertManagerSourceName:t}),size:2}),m},[c,t])}const kn=t=>({container:(0,E.css)({display:"flex",flexFlow:"column nowrap"}),muteTimingsButtons:(0,E.css)({marginBottom:t.spacing(2)})});var qn=n(88547),_n=(t=>(t.NotificationPolicies="notification_policies",t.MuteTimings="mute_timings",t))(_n||{});const ei=()=>{const t=(0,R.of)(ti),{selectedAlertmanager:i=""}=(0,Ce.VI)(),[r,s]=(0,P.L7)(P.QI.ViewNotificationPolicyTree),[l,u]=(0,P.L7)(P.QI.ViewMuteTiming),c=[s&&"notification_policies",u&&"mute_timings"].filter(D=>!!D),{data:m=[]}=(0,ue.Ad)({alertmanager:i,skip:!u}),[g,f]=(0,de.s)(),{tab:x}=ni(g,c[0]),[y,O]=(0,d.useState)(x),v=y==="mute_timings",j=y==="notification_policies",M=m.length;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Fn.M,{currentAlertmanager:i}),(0,e.jsxs)(q.U,{children:[r&&s&&(0,e.jsx)(G.o,{label:(0,o.t)("alerting.notification-policies-tabs.label-notification-policies","Notification Policies"),active:j,onChangeTab:()=>{O("notification_policies"),f({tab:"notification_policies"})}}),l&&u&&(0,e.jsx)(G.o,{label:(0,o.t)("alerting.notification-policies-tabs.label-mute-timings","Mute Timings"),active:v,counter:M,onChangeTab:()=>{O("mute_timings"),f({tab:"mute_timings"})}})]}),(0,e.jsxs)(Z.J,{className:t.tabContent,children:[j&&(0,e.jsx)(Bn,{}),v&&(0,e.jsx)(Zn,{})]})]})},ti=t=>({tabContent:(0,E.css)({marginTop:t.spacing(2)})});function ni(t,i){let r=i;return t.tab==="notification_policies"&&(r="notification_policies"),t.tab==="mute_timings"&&(r="mute_timings"),{tab:r}}function ii(){return(0,e.jsx)(Wn.y,{navId:"am-routes",accessType:"notification",children:(0,e.jsx)(ei,{})})}const oi=(0,qn.S)(ii)},24898:(Ne,ce,n)=>{n.d(ce,{_:()=>q});var e=n(74848),E=n(2543),d=n.n(E),R=n(16692);const q=({actions:w,children:T})=>{const C=(0,E.filter)(w,o),b=(0,E.filter)(w,ue);return C.length?(0,e.jsx)(G,{actions:C,children:T}):b.length?(0,e.jsx)(Z,{actions:b,children:T}):null},G=({actions:w,children:T})=>{const C=(0,R.iI)();return de(C,w)?(0,e.jsx)(e.Fragment,{children:T}):null},Z=({actions:w,children:T})=>{const C=(0,R.e2)();return de(C,w)?(0,e.jsx)(e.Fragment,{children:T}):null};function de(w,T){return(0,E.chain)(w).pick(T).values().value().some(([C,b])=>b===!0)}function o(w){return Object.values(R.QI).includes(w)}function ue(w){return Object.values(R.RY).includes(w)}},58887:(Ne,ce,n)=>{n.d(ce,{Z:()=>R});var e=n(74848),E=n(22803),d=n(63142);const R=({children:G})=>{const Z=(0,d.of)(q);return(0,e.jsx)("div",{className:Z.container,children:G})},q=G=>({container:(0,E.css)({backgroundColor:G.colors.background.secondary,color:G.colors.text.secondary,padding:G.spacing(4),textAlign:"center"})})},82658:(Ne,ce,n)=>{n.d(ce,{_:()=>Le});var e=n(74848),E=n(22803),d=n(96540),R=n(63142),q=n(41654),G=n(89640),Z=n(56840),de=n(77256),o=n(7840),ue=n(12266),w=n(1625),T=n(74529),C=n(57487),b=n(83903),A=n(45861),se=n(15130),te=n(84266),P=n(96673),B=n(16692),V=n(52161),je=n(83750),he=n(24898);const be=({alert:S,alertManagerSourceName:H})=>{const z=(0,R.of)(Ce),K=(0,V.z2)(H),Q=K?se.TP.hasPermission(P.AccessControlAction.AlertingRuleRead):!0;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:z.actionsRow,children:[S.status.state===te.Or.Suppressed&&(0,e.jsx)(he._,{actions:[B.QI.CreateSilence,B.QI.UpdateSilence],children:(0,e.jsx)(A.z9,{href:`${(0,de.nL)("/alerting/silences",H)}&silenceIds=${S.status.silencedBy.join(",")}`,className:z.button,icon:"bell",size:"sm",children:(0,e.jsx)(Z.x6,{i18nKey:"alerting.alert-details.manage-silences",children:"Manage silences"})})}),S.status.state===te.Or.Active&&(0,e.jsx)(he._,{actions:[B.QI.CreateSilence],children:(0,e.jsx)(A.z9,{href:(0,de.BK)(H,S.labels),className:z.button,icon:"bell-slash",size:"sm",children:(0,e.jsx)(Z.x6,{i18nKey:"alerting.alert-details.silence",children:"Silence"})})}),Q&&S.generatorURL&&(0,e.jsx)(A.z9,{className:z.button,href:S.generatorURL,icon:"chart-line",size:"sm",children:K?"See alert rule":"See source"})]}),Object.entries(S.annotations).map(([N,L])=>(0,e.jsx)(je.s,{annotationKey:N,value:L},N)),(0,e.jsxs)("div",{className:z.receivers,children:["Receivers:"," ",S.receivers.map(({name:N})=>N).filter(N=>!!N).join(", ")]})]})},Ce=S=>({button:(0,E.css)({"& + &":{marginLeft:S.spacing(1)}}),actionsRow:(0,E.css)({padding:`${S.spacing(2,0)} !important`,borderBottom:`1px solid ${S.colors.border.medium}`}),receivers:(0,E.css)({padding:S.spacing(1,0)})}),Ke=({alerts:S,alertManagerSourceName:H})=>{const z=(0,R.of)(Ge),K=(0,d.useMemo)(()=>[{id:"state",label:"Notification state",renderCell:({data:N})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.y,{state:N.status.state}),(0,e.jsxs)("span",{className:z.duration,children:["for"," ",(0,T.dU)({start:new Date(N.startsAt),end:new Date(N.endsAt)})]})]}),size:"220px"},{id:"labels",label:"Instance labels",renderCell:({data:{labels:N}})=>(0,e.jsx)(o.m,{labels:N,size:"sm"}),size:1}],[z]),Q=(0,d.useMemo)(()=>S.map(N=>({id:N.fingerprint,data:N})),[S]);return(0,e.jsx)("div",{className:z.tableWrapper,"data-testid":"alert-group-table",children:(0,e.jsx)(C.B,{cols:K,items:Q,isExpandable:!0,renderExpandedContent:({data:N})=>(0,e.jsx)(be,{alert:N,alertManagerSourceName:H})})})},Ge=S=>({tableWrapper:(0,E.css)({marginTop:S.spacing(3),[S.breakpoints.up("md")]:{marginLeft:S.spacing(4.5)}}),duration:(0,E.css)({marginLeft:S.spacing(1),fontSize:S.typography.bodySmall.fontSize})});var Je=n(55127),Te=n.n(Je);const xe=S=>({[te.Or.Active]:(0,E.css)({color:S.colors.error.text}),[te.Or.Suppressed]:(0,E.css)({color:S.colors.primary.text}),[te.Or.Unprocessed]:(0,E.css)({color:S.colors.secondary.text})}),Pe=({group:S})=>{const H=(0,R.of)(xe),z=S.alerts.length,K=S.alerts.reduce((Q,N)=>(Q[N.status.state]?Q[N.status.state]+=1:Q[N.status.state]=1,Q),{});return(0,e.jsxs)("div",{children:[`${z} ${Te()("alert",z)}: `,Object.entries(K).map(([Q,N],L)=>(0,e.jsxs)("span",{className:H[Q],children:[L>0&&", ",`${N} ${Q}`]},`${JSON.stringify(S.labels)}-notifications-${L}`))]})},Le=({alertManagerSourceName:S,group:H})=>{const[z,K]=(0,d.useState)(!0),Q=(0,R.of)(De),N=H.receiver.name!=="NONE",L=H.receiver.name;return(0,e.jsxs)("div",{className:Q.wrapper,children:[(0,e.jsxs)("div",{className:Q.header,children:[(0,e.jsxs)("div",{className:Q.group,"data-testid":"alert-group",children:[(0,e.jsx)(ue.e,{size:"sm",isCollapsed:z,onToggle:()=>K(!z),"data-testid":"alert-group-collapse-toggle"}),Object.keys(H.labels).length?(0,e.jsxs)(q.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(o.m,{labels:H.labels,size:"sm"}),N&&(0,e.jsxs)(w.P,{icon:"at",children:["Delivered to"," ",(0,e.jsx)(G.Y,{href:(0,de.bI)(L,S),variant:"bodySmall",color:"primary",inline:!1,children:H.receiver.name})]})]}):(0,e.jsx)("span",{children:(0,e.jsx)(Z.x6,{i18nKey:"alerting.alert-group.no-grouping",children:"No grouping"})})]}),(0,e.jsx)(Pe,{group:H})]}),!z&&(0,e.jsx)(Ke,{alertManagerSourceName:S,alerts:H.alerts})]})},De=S=>({wrapper:(0,E.css)({"& + &":{marginTop:S.spacing(2)}}),header:(0,E.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:S.spacing(1),backgroundColor:S.colors.background.secondary,width:"100%"}),group:(0,E.css)({display:"flex",flexDirection:"row",alignItems:"center"})})},92125:(Ne,ce,n)=>{n.d(ce,{s:()=>ue});var e=n(74848),E=n(22803),d=n(2543),R=n.n(d),q=n(63142),G=n(41654),Z=n(48542),de=n(63895),o=n(38055);const ue=({matchers:C,formatter:b="default"})=>{const A=(0,q.of)(T),se=5,te=(0,d.take)(C,se),P=(0,d.takeRight)(C,C.length-se),B=P.length>0;return(0,e.jsx)("span",{"data-testid":"label-matchers",children:(0,e.jsxs)(G.B,{direction:"row",gap:1,alignItems:"center",wrap:"wrap",children:[te.map(V=>(0,e.jsx)(w,{matcher:V,formatter:b},(0,d.uniqueId)())),B&&(0,e.jsx)(o.B,{arrow:!0,placement:"top",content:(0,e.jsx)(e.Fragment,{children:P.map(V=>(0,e.jsx)(w,{matcher:V},(0,d.uniqueId)()))}),children:(0,e.jsx)("span",{children:(0,e.jsx)("div",{className:A.metadata,children:`and ${P.length} more`})})})]})})},w=({matcher:C,formatter:b="default"})=>{const A=(0,q.of)(T);return(0,e.jsx)("div",{className:A.matcher(C[0]).wrapper,children:(0,e.jsx)(G.B,{direction:"row",gap:0,alignItems:"baseline",children:de.t8[b](C)})})},T=C=>({matcher:b=>{const{color:A,borderColor:se}=(0,Z.MC)(b);return{wrapper:(0,E.css)({color:"#fff",background:A,padding:`${C.spacing(.33)} ${C.spacing(.66)}`,fontSize:C.typography.bodySmall.fontSize,border:`solid 1px ${se}`,borderRadius:C.shape.borderRadius(2),whiteSpace:"pre"})}},metadata:(0,E.css)({color:C.colors.text.secondary,fontSize:C.typography.bodySmall.fontSize,fontWeight:C.typography.bodySmall.fontWeight})})},59062:(Ne,ce,n)=>{n.d(ce,{L:()=>L});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const e=Symbol("Comlink.proxy"),E=Symbol("Comlink.endpoint"),d=Symbol("Comlink.releaseProxy"),R=Symbol("Comlink.finalizer"),q=Symbol("Comlink.thrown"),G=a=>typeof a=="object"&&a!==null||typeof a=="function",Z={canHandle:a=>G(a)&&a[e],serialize(a){const{port1:p,port2:h}=new MessageChannel;return w(a,p),[h,[h]]},deserialize(a){return a.start(),b(a)}},de={canHandle:a=>G(a)&&q in a,serialize({value:a}){let p;return a instanceof Error?p={isError:!0,value:{message:a.message,name:a.name,stack:a.stack}}:p={isError:!1,value:a},[p,[]]},deserialize(a){throw a.isError?Object.assign(new Error(a.value.message),a.value):a.value}},o=new Map([["proxy",Z],["throw",de]]);function ue(a,p){for(const h of a)if(p===h||h==="*"||h instanceof RegExp&&h.test(p))return!0;return!1}function w(a,p=globalThis,h=["*"]){p.addEventListener("message",function $(I){if(!I||!I.data)return;if(!ue(h,I.origin)){console.warn(`Invalid origin '${I.origin}' for comlink proxy`);return}const{id:W,type:ae,path:F}=Object.assign({path:[]},I.data),X=(I.data.argumentList||[]).map(xe);let Y;try{const k=F.slice(0,-1).reduce((_,Re)=>_[Re],a),fe=F.reduce((_,Re)=>_[Re],a);switch(ae){case"GET":Y=fe;break;case"SET":k[F.slice(-1)[0]]=xe(I.data.value),Y=!0;break;case"APPLY":Y=fe.apply(k,X);break;case"CONSTRUCT":{const _=new fe(...X);Y=Ge(_)}break;case"ENDPOINT":{const{port1:_,port2:Re}=new MessageChannel;w(a,Re),Y=Ke(_,[_])}break;case"RELEASE":Y=void 0;break;default:return}}catch(k){Y={value:k,[q]:0}}Promise.resolve(Y).catch(k=>({value:k,[q]:0})).then(k=>{const[fe,_]=Te(k);p.postMessage(Object.assign(Object.assign({},fe),{id:W}),_),ae==="RELEASE"&&(p.removeEventListener("message",$),C(p),R in a&&typeof a[R]=="function"&&a[R]())}).catch(k=>{const[fe,_]=Te({value:new TypeError("Unserializable return value"),[q]:0});p.postMessage(Object.assign(Object.assign({},fe),{id:W}),_)})}),p.start&&p.start()}function T(a){return a.constructor.name==="MessagePort"}function C(a){T(a)&&a.close()}function b(a,p){const h=new Map;return a.addEventListener("message",function(I){const{data:W}=I;if(!W||!W.id)return;const ae=h.get(W.id);if(ae)try{ae(W)}finally{h.delete(W.id)}}),je(a,h,[],p)}function A(a){if(a)throw new Error("Proxy has been released and is not useable")}function se(a){return Pe(a,new Map,{type:"RELEASE"}).then(()=>{C(a)})}const te=new WeakMap,P="FinalizationRegistry"in globalThis&&new FinalizationRegistry(a=>{const p=(te.get(a)||0)-1;te.set(a,p),p===0&&se(a)});function B(a,p){const h=(te.get(p)||0)+1;te.set(p,h),P&&P.register(a,p,a)}function V(a){P&&P.unregister(a)}function je(a,p,h=[],$=function(){}){let I=!1;const W=new Proxy($,{get(ae,F){if(A(I),F===d)return()=>{V(W),se(a),p.clear(),I=!0};if(F==="then"){if(h.length===0)return{then:()=>W};const X=Pe(a,p,{type:"GET",path:h.map(Y=>Y.toString())}).then(xe);return X.then.bind(X)}return je(a,p,[...h,F])},set(ae,F,X){A(I);const[Y,k]=Te(X);return Pe(a,p,{type:"SET",path:[...h,F].map(fe=>fe.toString()),value:Y},k).then(xe)},apply(ae,F,X){A(I);const Y=h[h.length-1];if(Y===E)return Pe(a,p,{type:"ENDPOINT"}).then(xe);if(Y==="bind")return je(a,p,h.slice(0,-1));const[k,fe]=be(X);return Pe(a,p,{type:"APPLY",path:h.map(_=>_.toString()),argumentList:k},fe).then(xe)},construct(ae,F){A(I);const[X,Y]=be(F);return Pe(a,p,{type:"CONSTRUCT",path:h.map(k=>k.toString()),argumentList:X},Y).then(xe)}});return B(W,a),W}function he(a){return Array.prototype.concat.apply([],a)}function be(a){const p=a.map(Te);return[p.map(h=>h[0]),he(p.map(h=>h[1]))]}const Ce=new WeakMap;function Ke(a,p){return Ce.set(a,p),a}function Ge(a){return Object.assign(a,{[e]:!0})}function Je(a,p=globalThis,h="*"){return{postMessage:($,I)=>a.postMessage($,h,I),addEventListener:p.addEventListener.bind(p),removeEventListener:p.removeEventListener.bind(p)}}function Te(a){for(const[p,h]of o)if(h.canHandle(a)){const[$,I]=h.serialize(a);return[{type:"HANDLER",name:p,value:$},I]}return[{type:"RAW",value:a},Ce.get(a)||[]]}function xe(a){switch(a.type){case"HANDLER":return o.get(a.name).deserialize(a.value);case"RAW":return a.value}}function Pe(a,p,h,$){return new Promise(I=>{const W=Le();p.set(W,I),a.start&&a.start(),a.postMessage(Object.assign({id:W},h),$)})}function Le(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var De=n(96540),S=n(74268),H=n(81041);const z=()=>new H.c(new URL(n.p+n.u(4254),n.b));let K;function Q(){let a;if(K===void 0)try{a=z(),K=b(a)}catch(h){h instanceof Error&&(0,S.vV)(h)}return{disposeWorker:()=>{a&&K&&(K[d](),a.terminate(),K=void 0,a=void 0)}}}function N(a){if(!K)throw new Error("Route Matcher has not been initialized")}function L(){(0,De.useEffect)(()=>{const{disposeWorker:h}=Q();return h},[]);const a=(0,De.useCallback)(async(h,$,I)=>{N(K);const W=performance.now(),ae=await K.getRouteGroupsMap(h,$,I),F=performance.now()-W;return(0,S.fH)(`Route Groups Matched in  ${F} ms`,{matchingTime:F.toString(),alertGroupsCount:$.length.toString(),topLevelRoutesCount:h.routes?.length.toString()??"0"}),ae},[]),p=(0,De.useCallback)(async(h,$,I)=>{N(K);const W=performance.now(),ae=await K.matchInstancesToRoute(h,$,I),F=performance.now()-W;return(0,S.fH)(`Instances Matched in  ${F} ms`,{matchingTime:F.toString(),instancesToMatchCount:$.length.toString(),topLevelRoutesCount:h.routes?.length.toString()??"0"}),ae},[]);return{getRouteGroupsMap:a,matchInstancesToRoute:p}}},97539:(Ne,ce,n)=>{n.d(ce,{KR:()=>R,Ww:()=>G,d6:()=>w,iF:()=>de,jU:()=>d,jb:()=>ue,oU:()=>q});var e=n(2543),E=n.n(e);const d=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],R=["january","february","march","april","may","june","july","august","september","october","november","december"],q={times:[{start_time:"",end_time:""}],weekdays:"",days_of_month:"",months:"",years:"",location:"",disable:!1},G=(T,C,b)=>T?T.split(",").map(A=>A.trim()).every(A=>A.split(":").every(C))||b:!0,Z=T=>T?T.split(",").map(C=>C.trim()):void 0,de=T=>{const C=T.time_intervals.map(({times:b,weekdays:A,days_of_month:se,months:te,years:P,location:B,disable:V})=>{const je={times:o(b,V),weekdays:Z(A)?.map(he=>he.toLowerCase()),days_of_month:Z(se),months:Z(te),years:Z(P),location:B||void 0};return(0,e.omitBy)(je,e.isUndefined)});return{name:T.name,time_intervals:C}};function o(T,C){if(C)return[];const b=T?.filter(({start_time:A,end_time:se})=>!!A&&!!se);return b?.length?b:void 0}function ue(T){return T.times?.length===0||T.weekdays?.length===0||T.days_of_month?.length===0||T.months?.length===0||T.years?.length===0}function w(T){return T.time_intervals.every(C=>ue(C))}}}]);

//# sourceMappingURL=NotificationPoliciesPage.2038c548d70b3e6a23cd.js.map