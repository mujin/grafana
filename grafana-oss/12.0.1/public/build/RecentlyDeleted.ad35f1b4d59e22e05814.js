"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3734],{75174:(ie,S,e)=>{e.r(S),e.d(S,{default:()=>se});var t=e(74848),E=e(34999),l=e(56840),P=e(70327),I=e(55143),G=e(77256),K=e(88547),L=e(36826),y=e(96540),F=e(80011),O=e(50201),v=e(41654),N=e(45861),U=e(27594),A=e(74268),z=e(74869),Y=e(49914),x=e(22803),j=e(63142),T=e(71599),J=e(64762);const V=({isOpen:n,onDismiss:r,guid:o})=>{const[u]=P.hK.endpoints.permanentlyDeleteRule.useMutation(),c=(0,l.t)("alerting.deleted-rules.delete-modal.title","Permanently delete alert rule"),d=(0,l.t)("alerting.deleted-rules.delete-modal.confirm","Yes, permanently delete"),s=(0,J._2)(),g=(0,j.of)(Z);async function f(){if(o)return u({guid:o}).then(()=>{r(),s.success((0,l.t)("alerting.deleted-rules.delete-modal.success","Alert rule permanently deleted"))}).catch(h=>{s.error((0,l.t)("alerting.deleted-rules.delete-modal.error","Could not permanently delete alert rule"))})}return(0,t.jsx)(T.u,{isOpen:n,title:c,confirmText:d,modalClass:g.modal,confirmButtonVariant:"destructive",body:(0,t.jsx)(v.B,{direction:"column",gap:2,children:(0,t.jsx)(l.x6,{i18nKey:"alerting.deleted-rules.delete-modal.body",children:"Are you sure you want to permanently delete this alert rule? This action cannot be undone."})}),onConfirm:f,onDismiss:r})},Z=()=>({modal:(0,x.css)({width:"700px"})});var $=e(36490),Q=e(50992),W=e(83873),H=e(47797),X=e(80218),w=e(23390),b=e(52161),k=e(20437),q=e(29609),_=e(92367);const ee=({isOpen:n,ruleToRestore:r,onDismiss:o,onRestoreSucess:u,onRestoreError:c})=>{const[d,{error:s}]=re(),g=(0,l.t)("alerting.deleted-rules.restore-modal.title","Restore deleted alert rule"),f=(0,l.t)("alerting.deleted-rules.restore-modal.error","Could not restore deleted alert rule"),h=s?"Manually restore the rule":(0,l.t)("alerting.deleted-rules.restore-modal.confirm","Yes, restore deleted rule"),p=(0,j.of)(M);async function C(){if(r)return d.execute(r).then(()=>{o(),u()}).catch(D=>{c(D)})}async function R(){r&&await ne(r)}return(0,t.jsx)(T.u,{isOpen:n,title:g,confirmText:h,modalClass:p.modal,confirmButtonVariant:s?"primary":"destructive",body:(0,t.jsxs)(v.B,{direction:"column",gap:2,children:[(0,t.jsx)(l.x6,{i18nKey:"alerting.deleted-rules.restore-modal.body",children:"Are you sure you want to restore this deleted alert rule definition?"}),(0,t.jsx)("div",{children:r&&(0,t.jsx)(te,{rule:r})}),s&&(0,t.jsxs)(E.F,{severity:"warning",title:f,children:[(0,t.jsx)(l.x6,{i18nKey:"alerting.deleted-rules.restore-deleted-manually",children:"Your alert rule could not be restored. This may be due to changes to other entities such as contact points, data sources etc. Please manually restore the deleted rule by editing the rule and saving it."}),(0,t.jsx)("pre",{style:{marginBottom:0},children:(0,t.jsx)("code",{children:(0,G.JZ)(s)})})]})]}),onConfirm:s?R:C,onDismiss:o})};function te({rule:n}){const r=(0,j.of)(M);return(0,t.jsx)("div",{className:r.content,children:(0,t.jsx)(Q.B,{width:"100%",height:600,language:"json",value:JSON.stringify(n,null,4),monacoOptions:{minimap:{enabled:!1},scrollBeyondLastLine:!1,lineNumbers:"on",readOnly:!0}})})}const M=()=>({content:(0,x.css)({flex:"1 1 100%"}),modal:(0,x.css)({width:"700px"})});function re(){const[n]=(0,w.d)();return(0,X.Yb)(async r=>{const o={dataSourceName:b.hY,namespaceName:r.grafana_alert.namespace_uid,groupName:r.grafana_alert.rule_group};return n.execute(o,r)})}const ne=async n=>{let r;const o=await W.IB.getFolderByUid(n.grafana_alert.namespace_uid).then(d=>d.title);try{r=(0,k.zQ)(n,o)}catch(d){const s=`Error getting rule values from the deleted rule: ${(0,H.q6)(d)}`;throw new Error(s)}const u=q.p.grafana.recordingRule(n)?"/alerting/new/grafana-recording":"/alerting/new",c=(0,_.G)(u,{isManualRestore:"true",defaults:JSON.stringify(r),returnTo:location.pathname+location.search});$.Ny.push(c)},le=30;function ae({deletedRules:n}){const[r,o]=(0,y.useState)(!1),[u,c]=(0,y.useState)(),[d,s]=(0,y.useState)(),g=d!==void 0,f=(0,l.t)("alerting.deleted-rules.unknown","Unknown");if(n.length===0)return(0,t.jsx)(O.p,{message:(0,l.t)("alerting.deleted-rules.empty-state-title","No recently deleted rules found"),variant:"not-found"});const h=a=>{const i=n.find(B=>m(B.grafana_alert)===a);i&&(o(!0),c(i))},p=()=>{o(!1)},C=()=>{s(void 0)},R=a=>{const i=n.find(B=>m(B.grafana_alert)===a);i&&s(i.grafana_alert.guid)},D=(0,z.VB)(),de=[{id:"createdBy",header:(0,l.t)("alerting.deleted-rules.table.updatedBy","Deleted By"),disableGrow:!0,cell:({row:a})=>(0,t.jsx)(Y.m,{user:a.original.grafana_alert.updated_by})},{id:"title",header:(0,l.t)("alerting.deleted-rules.table.title","Title"),disableGrow:!0,cell:({row:a})=>a.original.grafana_alert.title},{id:"folder",header:(0,l.t)("alerting.deleted-rules.table.folder","Folder"),disableGrow:!0,cell:({row:a})=>a.original.grafana_alert.namespace_uid},{id:"group",header:(0,l.t)("alerting.deleted-rules.table.group","Group"),disableGrow:!0,cell:({row:a})=>a.original.grafana_alert.rule_group},{id:"created",header:(0,l.t)("alerting.deleted-rules.table.updated","Deletion Date"),disableGrow:!0,cell:({row:a})=>{const i=a.original.grafana_alert.updated;return i?(0,F.LE)(i)+" ("+(0,F.fq)(i)+")":f}},{id:"actions",disableGrow:!0,cell:({row:a})=>(0,t.jsxs)(v.B,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:[(0,t.jsx)(N.$n,{variant:"secondary",size:"sm",icon:"history",onClick:()=>{h(m(a.original.grafana_alert))},children:(0,t.jsx)(l.x6,{i18nKey:"alerting.deleted-rules.restore",children:"Restore"})}),D&&(0,t.jsx)(N.$n,{variant:"destructive",size:"sm",icon:"trash-alt",onClick:()=>{R(m(a.original.grafana_alert))},children:(0,t.jsx)(l.x6,{i18nKey:"alerting.deleted-rules.permanently-delete",children:"Permanently delete"})})]})}];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.j,{pageSize:le,columns:de,data:n,getRowId:a=>m(a.grafana_alert)}),(0,t.jsx)(ee,{ruleToRestore:u,isOpen:r,onDismiss:p,onRestoreSucess:A.Ey,onRestoreError:A.Pq}),(0,t.jsx)(V,{guid:d,isOpen:g,onDismiss:C})]})}function m(n){return n.guid||n.uid}function oe(){const{currentData:n=[],isLoading:r,error:o}=P.hK.endpoints.getDeletedRules.useQuery({rulerConfig:I.b,filter:{}});return(0,t.jsx)(L.d,{navId:"alerts/recently-deleted",isLoading:r,children:(0,t.jsxs)(t.Fragment,{children:[o&&(0,t.jsx)(E.F,{title:(0,l.t)("alerting.deleted-rules.errorloading","Failed to load alert deleted rules"),children:(0,G.JZ)(o)}),(0,t.jsx)(ae,{deletedRules:n})]})})}const se=(0,K.S)(oe)}}]);

//# sourceMappingURL=RecentlyDeleted.ad35f1b4d59e22e05814.js.map