{"version":3,"file":"ApiKeysPage.9c0cf6f568670261e536.js","mappings":"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","sources":["webpack://grafana/./public/app/features/api-keys/ApiKeysActionBar.tsx","webpack://grafana/./public/app/features/api-keys/ApiKeysTable.tsx","webpack://grafana/./public/app/features/api-keys/MigrateToServiceAccountsCard.tsx","webpack://grafana/./public/app/features/api-keys/state/actions.ts","webpack://grafana/./public/app/features/api-keys/state/selectors.ts","webpack://grafana/./public/app/features/api-keys/ApiKeysPage.tsx"],"sourcesContent":["import { FilterInput, InlineField } from '@grafana/ui';\nimport { t } from 'app/core/internationalization';\n\ninterface Props {\n  searchQuery: string;\n  disabled: boolean;\n  onSearchChange: (value: string) => void;\n}\n\nexport const ApiKeysActionBar = ({ searchQuery, disabled, onSearchChange }: Props) => {\n  return (\n    <div className=\"page-action-bar\">\n      <InlineField grow>\n        <FilterInput\n          placeholder={t('api-keys.api-keys-action-bar.placeholder-search-keys', 'Search keys')}\n          value={searchQuery}\n          onChange={onSearchChange}\n        />\n      </InlineField>\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\n\nimport { dateTimeFormat, GrafanaTheme2, TimeZone } from '@grafana/data';\nimport { Button, DeleteButton, Icon, Stack, Tooltip, useTheme2 } from '@grafana/ui';\nimport { contextSrv } from 'app/core/core';\nimport { Trans, t } from 'app/core/internationalization';\nimport { AccessControlAction } from 'app/types';\n\nimport { ApiKey } from '../../types';\n\ninterface Props {\n  apiKeys: ApiKey[];\n  timeZone: TimeZone;\n  onDelete: (apiKey: ApiKey) => void;\n  onMigrate: (apiKey: ApiKey) => void;\n}\n\nexport const ApiKeysTable = ({ apiKeys, timeZone, onDelete, onMigrate }: Props) => {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  return (\n    <table className=\"filter-table\">\n      <thead>\n        <tr>\n          <th>\n            <Trans i18nKey=\"api-keys.api-keys-table.name\">Name</Trans>\n          </th>\n          <th>\n            <Trans i18nKey=\"api-keys.api-keys-table.role\">Role</Trans>\n          </th>\n          <th>\n            <Trans i18nKey=\"api-keys.api-keys-table.expires\">Expires</Trans>\n          </th>\n          <th>\n            <Trans i18nKey=\"api-keys.api-keys-table.last-used-at\">Last used at</Trans>\n          </th>\n          <th style={{ width: '34px' }} />\n        </tr>\n      </thead>\n      {apiKeys.length > 0 ? (\n        <tbody>\n          {apiKeys.map((key) => {\n            const isExpired = Boolean(key.expiration && Date.now() > new Date(key.expiration).getTime());\n            return (\n              <tr key={key.id} className={styles.tableRow(isExpired)}>\n                <td>{key.name}</td>\n                <td>{key.role}</td>\n                <td>\n                  {formatDate(key.expiration, timeZone)}\n                  {isExpired && (\n                    <span className={styles.tooltipContainer}>\n                      <Tooltip content=\"This API key has expired.\">\n                        <Icon name=\"exclamation-triangle\" />\n                      </Tooltip>\n                    </span>\n                  )}\n                </td>\n                <td>{formatLastUsedAtDate(timeZone, key.lastUsedAt)}</td>\n                <td>\n                  <Stack justifyContent=\"flex-end\">\n                    <Button size=\"sm\" onClick={() => onMigrate(key)}>\n                      <Trans i18nKey=\"api-keys.api-keys-table.migrate-to-service-account\">\n                        Migrate to service account\n                      </Trans>\n                    </Button>\n                    <DeleteButton\n                      aria-label={t('api-keys.api-keys-table.aria-label-delete-api-key', 'Delete API key')}\n                      size=\"sm\"\n                      onConfirm={() => onDelete(key)}\n                      disabled={!contextSrv.hasPermissionInMetadata(AccessControlAction.ActionAPIKeysDelete, key)}\n                    />\n                  </Stack>\n                </td>\n              </tr>\n            );\n          })}\n        </tbody>\n      ) : null}\n    </table>\n  );\n};\n\nfunction formatLastUsedAtDate(timeZone: TimeZone, lastUsedAt?: string): string {\n  if (!lastUsedAt) {\n    return 'Never';\n  }\n  return dateTimeFormat(lastUsedAt, { timeZone });\n}\n\nfunction formatDate(expiration: string | undefined, timeZone: TimeZone): string {\n  if (!expiration) {\n    return 'No expiration date';\n  }\n  return dateTimeFormat(expiration, { timeZone });\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  tableRow: (isExpired: boolean) =>\n    css({\n      color: isExpired ? theme.colors.text.secondary : theme.colors.text.primary,\n    }),\n  tooltipContainer: css({\n    marginLeft: theme.spacing(1),\n  }),\n});\n","import { css } from '@emotion/css';\nimport { useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Alert, Button, ConfirmModal, useStyles2 } from '@grafana/ui';\nimport { Trans, t } from 'app/core/internationalization';\n\ninterface Props {\n  onMigrate: () => void;\n  apikeysCount: number;\n  disabled?: boolean;\n}\n\nexport const MigrateToServiceAccountsCard = ({ onMigrate, apikeysCount, disabled }: Props): JSX.Element => {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const styles = useStyles2(getStyles);\n\n  const docsLink = (\n    <a\n      className=\"external-link\"\n      href=\"https://grafana.com/docs/grafana/latest/administration/service-accounts/migrate-api-keys/\"\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n    >\n      <Trans i18nKey=\"api-keys.migrate-to-service-accounts-card.docs-link.about-migration\">\n        Find out more about the migration here.\n      </Trans>\n    </a>\n  );\n  const migrationBoxDesc = (\n    <span>\n      <Trans i18nKey=\"api-keys.migrate-to-service-accounts-card.migration-box-desc.migrating\">\n        Migrating all API keys will hide the API keys tab.\n      </Trans>\n    </span>\n  );\n\n  return (\n    <>\n      {apikeysCount > 0 && (\n        <Alert\n          title={t(\n            'api-keys.migrate-to-service-accounts-card.title-switch-service-accounts',\n            'Switch from API keys to service accounts'\n          )}\n          severity=\"warning\"\n        >\n          <div className={styles.text}>\n            <Trans\n              i18nKey=\"api-keys.migrate-to-service-accounts-card.body-switch-service-accounts\"\n              components={{ docsLink }}\n            >\n              API keys are deprecated and will be removed from Grafana on Jan 31, 2025. Each API key will be migrated\n              into a service account with a token and will continue to work as they were. We encourage you to migrate\n              your API keys to service accounts now. {'<docsLink />'}\n            </Trans>\n          </div>\n          <div className={styles.actionRow}>\n            <Button className={styles.actionButton} onClick={() => setIsModalOpen(true)}>\n              <Trans i18nKey=\"api-keys.migrate-to-service-accounts-card.migrate-all-service-accounts\">\n                Migrate all service accounts\n              </Trans>\n            </Button>\n            <ConfirmModal\n              title={t('api-keys.migrate-to-service-accounts-card.modal-title', 'Migrate API keys to service accounts')}\n              isOpen={isModalOpen}\n              body={migrationBoxDesc}\n              confirmText={'Yes, migrate now'}\n              onConfirm={onMigrate}\n              onDismiss={() => setIsModalOpen(false)}\n              confirmVariant=\"primary\"\n              confirmButtonVariant=\"primary\"\n            />\n          </div>\n        </Alert>\n      )}\n      {apikeysCount === 0 && (\n        <>\n          <Alert\n            title={t('api-keys.migrate-to-service-accounts-card.title-no-api-keys-found', 'No API keys found')}\n            severity=\"warning\"\n          >\n            <div className={styles.text}>\n              <Trans i18nKey=\"api-keys.migrate-to-service-accounts-card.body-no-api-keys-found\">\n                No API keys were found. If you reload the browser, this page will not be available anymore.\n              </Trans>\n            </div>\n          </Alert>\n        </>\n      )}\n    </>\n  );\n};\n\nexport const getStyles = (theme: GrafanaTheme2) => ({\n  text: css({\n    marginBottom: theme.spacing(2),\n  }),\n  actionRow: css({\n    display: 'flex',\n    alignItems: 'center',\n  }),\n  actionButton: css({\n    marginRight: theme.spacing(2),\n  }),\n});\n","import { getBackendSrv } from 'app/core/services/backend_srv';\nimport { ThunkResult } from 'app/types';\n\nimport { apiKeysLoaded, includeExpiredToggled, isFetching, setMigrationResult } from './reducers';\n\nexport function loadApiKeys(): ThunkResult<void> {\n  return async (dispatch) => {\n    dispatch(isFetching());\n    const [keys, keysIncludingExpired] = await Promise.all([\n      getBackendSrv().get('/api/auth/keys?includeExpired=false&accesscontrol=true'),\n      getBackendSrv().get('/api/auth/keys?includeExpired=true&accesscontrol=true'),\n    ]);\n    dispatch(apiKeysLoaded({ keys, keysIncludingExpired }));\n  };\n}\n\nexport function deleteApiKey(id: number): ThunkResult<void> {\n  return async (dispatch) => {\n    getBackendSrv()\n      .delete(`/api/auth/keys/${id}`)\n      .then(() => dispatch(loadApiKeys()));\n  };\n}\n\nexport function migrateApiKey(id: number): ThunkResult<void> {\n  return async (dispatch) => {\n    try {\n      await getBackendSrv().post(`/api/serviceaccounts/migrate/${id}`);\n    } finally {\n      dispatch(loadApiKeys());\n    }\n  };\n}\n\nexport function migrateAll(): ThunkResult<void> {\n  return async (dispatch) => {\n    try {\n      const payload = await getBackendSrv().post('/api/serviceaccounts/migrate');\n      dispatch(setMigrationResult(payload));\n    } finally {\n      dispatch(loadApiKeys());\n    }\n  };\n}\n\nexport function toggleIncludeExpired(): ThunkResult<void> {\n  return (dispatch) => {\n    dispatch(includeExpiredToggled());\n  };\n}\n","import { ApiKeysState } from 'app/types';\n\nexport const getApiKeysCount = (state: ApiKeysState) =>\n  state.includeExpired ? state.keysIncludingExpired.length : state.keys.length;\n\nexport const getApiKeys = (state: ApiKeysState) => {\n  const regex = RegExp(state.searchQuery, 'i');\n  const keysToFilter = state.includeExpired ? state.keysIncludingExpired : state.keys;\n\n  return keysToFilter.filter((key) => {\n    return regex.test(key.name) || regex.test(key.role);\n  });\n};\n\nexport const getIncludeExpired = (state: ApiKeysState) => state.includeExpired;\n\nexport const getIncludeExpiredDisabled = (state: ApiKeysState) =>\n  state.keys.length === 0 && state.keysIncludingExpired.length > 0;\n","import { PureComponent } from 'react';\nimport * as React from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\n\n// Utils\nimport { InlineField, InlineSwitch, Modal, Button, EmptyState } from '@grafana/ui';\nimport { Page } from 'app/core/components/Page/Page';\nimport { contextSrv } from 'app/core/core';\nimport { t, Trans } from 'app/core/internationalization';\nimport { getTimeZone } from 'app/features/profile/state/selectors';\nimport { AccessControlAction, ApiKey, ApikeyMigrationResult, StoreState } from 'app/types';\n\nimport { ApiKeysActionBar } from './ApiKeysActionBar';\nimport { ApiKeysTable } from './ApiKeysTable';\nimport { MigrateToServiceAccountsCard } from './MigrateToServiceAccountsCard';\nimport { deleteApiKey, migrateApiKey, migrateAll, loadApiKeys, toggleIncludeExpired } from './state/actions';\nimport { setSearchQuery } from './state/reducers';\nimport { getApiKeys, getApiKeysCount, getIncludeExpired, getIncludeExpiredDisabled } from './state/selectors';\n\nfunction mapStateToProps(state: StoreState) {\n  const canCreate = contextSrv.hasPermission(AccessControlAction.ActionAPIKeysCreate);\n  return {\n    apiKeys: getApiKeys(state.apiKeys),\n    searchQuery: state.apiKeys.searchQuery,\n    apiKeysCount: getApiKeysCount(state.apiKeys),\n    hasFetched: state.apiKeys.hasFetched,\n    timeZone: getTimeZone(state.user),\n    includeExpired: getIncludeExpired(state.apiKeys),\n    includeExpiredDisabled: getIncludeExpiredDisabled(state.apiKeys),\n    canCreate: canCreate,\n    migrationResult: state.apiKeys.migrationResult,\n  };\n}\n\nconst defaultPageProps = {\n  navId: 'apikeys',\n};\n\nconst mapDispatchToProps = {\n  loadApiKeys,\n  deleteApiKey,\n  migrateApiKey,\n  migrateAll,\n  setSearchQuery,\n  toggleIncludeExpired,\n};\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ninterface OwnProps {}\n\nexport type Props = OwnProps & ConnectedProps<typeof connector>;\n\ninterface State {\n  showMigrationResult: boolean;\n}\n\nexport class ApiKeysPageUnconnected extends PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      showMigrationResult: false,\n    };\n  }\n\n  componentDidMount() {\n    this.fetchApiKeys();\n  }\n\n  async fetchApiKeys() {\n    await this.props.loadApiKeys();\n  }\n\n  onDeleteApiKey = (key: ApiKey) => {\n    this.props.deleteApiKey(key.id!);\n  };\n\n  onMigrateApiKey = (key: ApiKey) => {\n    this.props.migrateApiKey(key.id!);\n  };\n\n  onSearchQueryChange = (value: string) => {\n    this.props.setSearchQuery(value);\n  };\n\n  onIncludeExpiredChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n    this.props.toggleIncludeExpired();\n  };\n\n  onMigrateApiKeys = async () => {\n    try {\n      await this.props.migrateAll();\n      this.setState({\n        showMigrationResult: true,\n      });\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  dismissModal = async () => {\n    this.setState({ showMigrationResult: false });\n  };\n\n  render() {\n    const {\n      hasFetched,\n      apiKeysCount,\n      apiKeys,\n      searchQuery,\n      timeZone,\n      includeExpired,\n      includeExpiredDisabled,\n      canCreate,\n      migrationResult,\n    } = this.props;\n\n    const showTable = apiKeysCount > 0;\n    return (\n      <Page {...defaultPageProps}>\n        <Page.Contents isLoading={!hasFetched}>\n          <MigrateToServiceAccountsCard onMigrate={this.onMigrateApiKeys} apikeysCount={apiKeysCount} />\n          {showTable ? (\n            <ApiKeysActionBar\n              searchQuery={searchQuery}\n              disabled={!canCreate}\n              onSearchChange={this.onSearchQueryChange}\n            />\n          ) : null}\n          <InlineField\n            disabled={includeExpiredDisabled}\n            label={t('api-keys.api-keys-page-unconnected.label-include-expired-keys', 'Include expired keys')}\n          >\n            <InlineSwitch id=\"showExpired\" value={includeExpired} onChange={this.onIncludeExpiredChange} />\n          </InlineField>\n          {apiKeys.length > 0 ? (\n            <ApiKeysTable\n              apiKeys={apiKeys}\n              timeZone={timeZone}\n              onMigrate={this.onMigrateApiKey}\n              onDelete={this.onDeleteApiKey}\n            />\n          ) : (\n            <EmptyState variant=\"not-found\" message={t('api-keys.empty-state.message', 'No API keys found')} />\n          )}\n        </Page.Contents>\n        {migrationResult && (\n          <MigrationSummary\n            visible={this.state.showMigrationResult}\n            data={migrationResult}\n            onDismiss={this.dismissModal}\n          />\n        )}\n      </Page>\n    );\n  }\n}\nexport type MigrationSummaryProps = {\n  visible: boolean;\n  data: ApikeyMigrationResult;\n  onDismiss: () => void;\n};\n\nconst styles: { [key: string]: React.CSSProperties } = {\n  migrationSummary: {\n    padding: '20px',\n  },\n  infoText: {\n    color: '#007bff',\n  },\n  summaryDetails: {\n    marginTop: '20px',\n  },\n  summaryParagraph: {\n    margin: '10px 0',\n  },\n};\n\nexport const MigrationSummary: React.FC<MigrationSummaryProps> = ({ visible, data, onDismiss }) => {\n  return (\n    <Modal\n      title={t('api-keys.migration-summary.title-migration-summary', 'Migration summary')}\n      isOpen={visible}\n      closeOnBackdropClick={true}\n      onDismiss={onDismiss}\n    >\n      {data.failedApikeyIDs.length === 0 && (\n        <div style={styles.migrationSummary}>\n          <p>\n            <Trans i18nKey=\"api-keys.migration-summary.migration-successful\">Migration Successful!</Trans>\n          </p>\n          <p>\n            <Trans i18nKey=\"api-keys.migration-summary.total\" values={{ total: data.total }}>\n              <strong>Total: </strong>\n              {'{{total}}'}\n            </Trans>\n          </p>\n          <p>\n            <Trans i18nKey=\"api-keys.migration-summary.migrated\" values={{ migrated: data.migrated }}>\n              <strong>Migrated: </strong>\n              {'{{migrated}}'}\n            </Trans>\n          </p>\n        </div>\n      )}\n      {data.failedApikeyIDs.length !== 0 && (\n        <div style={styles.migrationSummary}>\n          <p>\n            <Trans i18nKey=\"api-keys.migration-summary.migration-complete\">\n              Migration complete! Please note, while there might be a few API keys flagged as `failed migrations`, rest\n              assured, all of your API keys are fully functional and operational. Please try again or contact support.\n            </Trans>\n          </p>\n          <hr />\n          <p>\n            <Trans i18nKey=\"api-keys.migration-summary.total\" values={{ total: data.total }}>\n              <strong>Total: </strong>\n              {'{{total}}'}\n            </Trans>\n          </p>\n          <p>\n            <Trans i18nKey=\"api-keys.migration-summary.migrated\" values={{ migrated: data.migrated }}>\n              <strong>Migrated: </strong>\n              {'{{migrated}}'}\n            </Trans>\n          </p>\n          <p>\n            <Trans i18nKey=\"api-keys.migration-summary.failed\" values={{ failed: data.failed }}>\n              <strong>Failed: </strong>\n              {'{{failed}}'}\n            </Trans>\n          </p>\n          <p>\n            <Trans i18nKey=\"api-keys.migration-summary.failed-ids\" values={{ ids: data.failedApikeyIDs.join(', ') }}>\n              <strong>Failed api key IDs: </strong>\n              {'{{ids}}'}\n            </Trans>\n          </p>\n          <p>\n            <Trans\n              i18nKey=\"api-keys.migration-summary.failed-details\"\n              values={{ details: data.failedDetails.join(', ') }}\n            >\n              <strong>Failed details: </strong>\n              {'{{details}}'}\n            </Trans>\n          </p>\n        </div>\n      )}\n      <Modal.ButtonRow>\n        <Button variant=\"secondary\" onClick={onDismiss}>\n          <Trans i18nKey=\"api-keys.migration-summary.close\">Close</Trans>\n        </Button>\n      </Modal.ButtonRow>\n    </Modal>\n  );\n};\n\nconst ApiKeysPage = connector(ApiKeysPageUnconnected);\nexport default ApiKeysPage;\n"],"names":["ApiKeysActionBar","searchQuery","disabled","onSearchChange","InlineField","FilterInput","ApiKeysTable","apiKeys","timeZone","onDelete","onMigrate","theme","styles","getStyles","key","isExpired","formatDate","Tooltip","Icon","formatLastUsedAtDate","Stack","Button","DeleteButton","lastUsedAt","expiration","MigrateToServiceAccountsCard","apikeysCount","isModalOpen","setIsModalOpen","docsLink","migrationBoxDesc","Alert","ConfirmModal","loadApiKeys","dispatch","keys","keysIncludingExpired","deleteApiKey","id","migrateApiKey","migrateAll","payload","toggleIncludeExpired","getApiKeysCount","state","getApiKeys","regex","getIncludeExpired","getIncludeExpiredDisabled","mapStateToProps","canCreate","defaultPageProps","mapDispatchToProps","connector","ApiKeysPageUnconnected","props","value","event","err","hasFetched","apiKeysCount","includeExpired","includeExpiredDisabled","migrationResult","showTable","Page","EmptyState","MigrationSummary","visible","data","onDismiss","Modal"],"sourceRoot":""}