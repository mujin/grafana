"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5804],{95576:(B,u,a)=>{a.r(u),a.d(u,{BrowseFolderLibraryPanelsPage:()=>s,default:()=>C});var n=a(74848),P=a(96540),i=a(54148),t=a(13791),f=a(97175),m=a(66198),e=a(24438),r=a(72327),h=a(15203);function s(){const{uid:v=""}=(0,i.g)(),{data:l}=(0,h.kH)(v),[o,c]=(0,P.useState)(void 0),[E]=(0,h.iB)(),D=(0,P.useMemo)(()=>{if(!l)return;const d=(0,m.R4)(l),_=(0,m.pq)(l.uid),g=d.children?.find(A=>A.id===_);return g&&(g.active=!0),d},[l]),M=v?async d=>{if(l){const _=await E({...l,title:d});if("error"in _)throw _.error}}:void 0;return(0,n.jsx)(t.Y,{navId:"dashboards/browse",pageNav:D,onEditTitle:M,actions:(0,n.jsx)(n.Fragment,{children:l&&(0,n.jsx)(f.m,{folder:l})}),children:(0,n.jsxs)(t.Y.Contents,{children:[(0,n.jsx)(e.j,{onClick:c,currentFolderUID:v,showSecondaryActions:!0,showSort:!0,showPanelFilter:!0}),o?(0,n.jsx)(r.F,{onDismiss:()=>c(void 0),libraryPanel:o}):null]})})}const C=s},72472:(B,u,a)=>{a.d(u,{T:()=>C});var n=a(74848),P=a(96540),i=a(27489),t=a(71599),f=a(66404),m=a(35137),e=a(34999),r=a(56840),h=a(15203),s=a(78059);const C=({onConfirm:v,onDismiss:l,selectedItems:o,...c})=>{const{data:E}=(0,h.G2)(o),D=!!(E&&(E.alertRule||E.libraryPanel)),[M,d]=(0,P.useState)(!1),_=async()=>{(0,i.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:Object.keys(o.dashboard).length,folder:Object.keys(o.folder).length},source:"browse_dashboards",restore_enabled:!1}),d(!0);try{await v(),d(!1),l()}catch{d(!1)}};return(0,n.jsx)(t.u,{body:(0,n.jsxs)(n.Fragment,{children:[!1,(0,n.jsx)(f.E,{element:"p",children:(0,n.jsx)(r.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,n.jsx)(s.x,{selectedItems:o}),(0,n.jsx)(m.$,{v:2})]}),description:(0,n.jsx)(n.Fragment,{children:D?(0,n.jsx)(e.F,{severity:"warning",title:(0,r.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,n.jsx)(r.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,r.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:M?(0,r.t)("browse-dashboards.action.deleting","Deleting..."):(0,r.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:l,onConfirm:_,title:(0,r.t)("browse-dashboards.action.delete-modal-title","Delete"),...c,disabled:D})}},65542:(B,u,a)=>{a.d(u,{J:()=>v});var n=a(74848),P=a(96540),i=a(22787),t=a(34999),f=a(66404),m=a(35137),e=a(37386),r=a(45861),h=a(67804),s=a(56840),C=a(78059);const v=({onConfirm:l,onDismiss:o,selectedItems:c,...E})=>{const[D,M]=(0,P.useState)(),[d,_]=(0,P.useState)(!1),g=Object.keys(c.folder).filter(O=>c.folder[O]),A=async()=>{if(D!==void 0){_(!0);try{await l(D),_(!1),o()}catch{_(!1)}}};return(0,n.jsxs)(i.a,{title:(0,s.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:o,...E,children:[g.length>0&&(0,n.jsx)(t.F,{severity:"info",title:(0,s.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,n.jsx)(f.E,{element:"p",children:(0,n.jsx)(s.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,n.jsx)(C.x,{selectedItems:c}),(0,n.jsx)(m.$,{v:3}),(0,n.jsx)(e.D,{label:(0,s.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,n.jsx)(h.d,{value:D,excludeUIDs:g,onChange:M})}),(0,n.jsxs)(i.a.ButtonRow,{children:[(0,n.jsx)(r.$n,{onClick:o,variant:"secondary",fill:"outline",children:(0,n.jsx)(s.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,n.jsx)(r.$n,{disabled:D===void 0||d,onClick:A,variant:"primary",children:d?(0,s.t)("browse-dashboards.action.moving","Moving..."):(0,s.t)("browse-dashboards.action.move-button","Move")})]})]})}},97175:(B,u,a)=>{a.d(u,{m:()=>A});var n=a(74848),P=a(96540),i=a(43173),t=a(27489),f=a(36490),m=a(87063),e=a(94535),r=a(88559),h=a(45861),s=a(30703),C=a(8207),v=a(54384),l=a(73427),o=a(56840),c=a(27154),E=a(87745),D=a(75735),M=a(15203),d=a(83485),_=a(72472),g=a(65542);function A({folder:O}){const[I,L]=(0,P.useState)(!1),[R,K]=(0,P.useState)(!1),[p]=(0,M.aF)(),[j]=(0,M.Ko)(),{canEditFolders:y,canDeleteFolders:T,canViewPermissions:x,canSetPermissions:F}=(0,d.N)(O),U=O.managedBy===D.Sf.Repo,W=i.$.featureToggles.nestedFolders&&y&&!U,S=async b=>{await p({folder:O,destinationUID:b}),(0,t.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},$=async()=>{await j(O),(0,t.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:b}=O,Y=b&&b.length?b[b.length-1].url:"/dashboards";f.Ny.push(Y)},w=()=>{l.lE.publish(new E.S8({component:g.J,props:{selectedItems:{folder:{[O.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:S}}))},V=()=>{l.lE.publish(new E.S8({component:_.T,props:{selectedItems:{folder:{[O.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:$}}))},N=()=>{l.lE.publish(new E.S8({component:c.f,props:{resource:O}}))},z=(0,o.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),H=(0,o.t)("browse-dashboards.folder-actions-button.move","Move"),G=(0,o.t)("browse-dashboards.folder-actions-button.delete","Delete"),J=(0,n.jsxs)(m.W,{children:[x&&(0,n.jsx)(e.D,{onClick:()=>K(!0),label:z}),W&&(0,n.jsx)(e.D,{onClick:w,label:H}),T&&(0,n.jsx)(e.D,{destructive:!0,onClick:U?N:V,label:G})]});return!x&&!W&&!T?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.m,{overlay:J,onVisibleChange:L,children:(0,n.jsxs)(h.$n,{variant:"secondary",children:[(0,n.jsx)(o.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,n.jsx)(s.I,{name:I?"angle-up":"angle-down"})]})}),R&&(0,n.jsx)(C._,{title:(0,o.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:O.title,onClose:()=>K(!1),size:"md",children:(0,n.jsx)(v.x,{resource:"folders",resourceId:O.uid,canSetPermissions:F})})]})}},83485:(B,u,a)=>{a.d(u,{N:()=>m});var n=a(43173),P=a(73427),i=a(96673);function t(e,r){return r?P.TP.hasPermissionInMetadata(e,r):P.TP.hasPermission(e)}function f(e){return e&&e.uid!=="general"&&!n.$.featureToggles.nestedFolders?!1:t(i.AccessControlAction.FoldersCreate,e)}function m(e){const r=t(i.AccessControlAction.DashboardsCreate,e),h=f(e),s=t(i.AccessControlAction.FoldersDelete,e),C=t(i.AccessControlAction.DashboardsWrite,e),v=t(i.AccessControlAction.FoldersWrite,e),l=t(i.AccessControlAction.FoldersPermissionsWrite,e),o=t(i.AccessControlAction.FoldersPermissionsRead,e);return{canCreateDashboards:r,canCreateFolders:h,canDeleteFolders:s,canEditDashboards:C,canEditFolders:v,canSetPermissions:l,canViewPermissions:o}}},72327:(B,u,a)=>{a.d(u,{F:()=>v});var n=a(74848),P=a(76459),i=a.n(P),t=a(96540),f=a(5556),m=a(36490),e=a(22787),r=a(18857),h=a(45861),s=a(56840),C=a(30124);function v({libraryPanel:o,onDismiss:c}){const[E,D]=(0,t.useState)(!1),[M,d]=(0,t.useState)(0),[_,g]=(0,t.useState)(void 0);(0,t.useEffect)(()=>{(async()=>{const R=await(0,C.GN)(o.uid);d(R.length)})()},[o.uid]);const A=(0,t.useCallback)(L=>l(o.uid,L,D),[o.uid]),O=(0,t.useMemo)(()=>i()(A,300,{leading:!0}),[A]),I=L=>{L.preventDefault(),m.Ny.push(f.kM.renderUrl(`/d/${_?.value?.uid}`,{}))};return(0,n.jsxs)(e.a,{title:(0,s.t)("library-panels.modal.title","View panel in dashboard"),onDismiss:c,onClickBackdrop:c,isOpen:!0,children:[(0,n.jsxs)("div",{children:[M===0?(0,n.jsx)("span",{children:(0,n.jsx)(s.x6,{i18nKey:"library-panels.modal.panel-not-linked",children:"Panel is not linked to a dashboard. Add the panel to a dashboard and retry."})}):null,M>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:(0,n.jsxs)(s.x6,{i18nKey:"library-panels.modal.body",count:M,children:["This panel is being used in ",{count:M}," dashboard. Please choose which dashboard to view the panel in:"]})}),(0,n.jsx)(r.DW,{isClearable:!0,isLoading:E,defaultOptions:!0,loadOptions:O,onChange:g,placeholder:(0,s.t)("library-panels.modal.select-placeholder","Start typing to search for dashboard"),noOptionsMessage:(0,s.t)("library-panels.modal.select-no-options-message","No dashboards found")})]}):null]}),(0,n.jsxs)(e.a.ButtonRow,{children:[(0,n.jsx)(h.$n,{variant:"secondary",onClick:c,fill:"outline",children:(0,n.jsx)(s.x6,{i18nKey:"library-panels.modal.button-cancel",children:"Cancel"})}),(0,n.jsx)(h.$n,{onClick:I,disabled:!_,children:_?(0,s.t)("library-panels.modal.button-view-panel1","View panel in {{label}}...",{label:_?.label}):(0,s.t)("library-panels.modal.button-view-panel2","View panel in dashboard...")})]})]})}async function l(o,c,E){E(!0);const M=(await(0,C.xV)(o)).filter(d=>d.title.toLowerCase().includes(c.toLowerCase())).map(d=>({label:d.title,value:d}));return E(!1),M}}}]);

//# sourceMappingURL=FolderLibraryPanelsPage.6239b91fdf970eb4d14d.js.map