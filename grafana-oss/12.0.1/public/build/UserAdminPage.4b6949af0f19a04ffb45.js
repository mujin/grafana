"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8054],{91087:(he,L,o)=>{o.d(L,{y:()=>r});var e=o(74848),h=o(96540),K=o(41053),M=o(73427),E=o(96673),O=o(59812),D=o(12037);const r=({basicRole:g,roles:b,userId:x,orgId:t,onBasicRoleChange:I,roleOptions:$,disabled:J,basicRoleDisabled:Q,basicRoleDisabledMessage:d,apply:N=!1,onApplyRoles:S,pendingRoles:U,maxWidth:V,width:Y,isLoading:Z})=>{const[{loading:w,value:X=b||[]},T]=(0,K.A)(async()=>{try{if(b)return b;if(N&&U?.length)return U;if(M.TP.hasPermission(E.AccessControlAction.ActionUserRolesList)&&x>0)return await(0,D.Xh)(x,t)}catch{console.error("Error loading options")}return[]},[t,x,U,b]);(0,h.useEffect)(()=>{t&&T()},[T,t]);const q=async z=>{N?S&&S(z,x,t):(await(0,D.eA)(z,x,t),await T())},_=M.TP.hasPermission(E.AccessControlAction.ActionUserRolesAdd)&&M.TP.hasPermission(E.AccessControlAction.ActionUserRolesRemove);return(0,e.jsx)(O.n,{appliedRoles:X,basicRole:g,onRolesChange:q,onBasicRoleChange:I,roleOptions:$,isLoading:w||Z,disabled:J,basicRoleDisabled:Q,basicRoleDisabledMessage:d,showBasicRole:!0,apply:N,canUpdateRoles:_,maxWidth:V,width:Y})}},9390:(he,L,o)=>{o.d(L,{r:()=>D});var e=o(74848),h=o(90382),K=o(18857),M=o(56840);const O=Object.values(h.X).filter(r=>r!==h.X.None).map(r=>({label:r,value:r}));function D({value:r,onChange:g,"aria-label":b,inputId:x,autoFocus:t,...I}){return(0,e.jsx)(K.l6,{inputId:x,value:r,options:O,onChange:$=>g($.value??h.X.None),placeholder:(0,M.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":b,autoFocus:t,...I})}},698:(he,L,o)=>{o.r(L),o.d(L,{UserAdminPage:()=>xe,default:()=>$e});var e=o(74848),h=o(96540),K=o(71468),M=o(54148),E=o(62061),O=o(41654),D=o(13791),r=o(73427),g=o(96673),b=o(80011),x=o(45861),t=o(56840),I=o(11297);const $="dddd YYYY-MM-DD HH:mm zz",J="/admin/authentication/ldap";class Q extends h.PureComponent{constructor(){super(...arguments),this.onUserSync=()=>{this.props.onUserSync()}}render(){const{ldapSyncInfo:s,user:i}=this.props,l=s&&s.nextSync?(0,b.LE)(s.nextSync,{format:$}):"",c=`${J}?user=${i&&i.login}`,u=r.TP.hasPermission(g.AccessControlAction.LDAPUsersRead),m=r.TP.hasPermission(g.AccessControlAction.LDAPUsersSync);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(t.x6,{i18nKey:"admin.ldap-sync.title",children:"LDAP Synchronisation"})}),(0,e.jsxs)("div",{className:"gf-form-group",children:[(0,e.jsx)("div",{className:"gf-form",children:(0,e.jsx)("table",{className:"filter-table form-inline",children:(0,e.jsxs)("tbody",{children:[(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(t.x6,{i18nKey:"admin.ldap-sync.external-sync-label",children:"External sync"})}),(0,e.jsx)("td",{children:(0,e.jsx)(t.x6,{i18nKey:"admin.ldap-sync.external-sync-description",children:"User synced via LDAP. Some changes must be done in LDAP or mappings."})}),(0,e.jsx)("td",{children:(0,e.jsx)(I.E,{label:(0,t.t)("admin.user-ldap-sync-info.label-ldap","LDAP"),removeIcon:!1,count:0,onClick:void 0})})]}),(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(t.x6,{i18nKey:"admin.ldap-sync.next-sync-label",children:"Next scheduled synchronization"})}),(0,e.jsx)("td",{colSpan:2,children:s.enabled?l:(0,e.jsx)(t.x6,{i18nKey:"admin.ldap-sync.not-enabled",children:"Not enabled"})})]})]})})}),(0,e.jsxs)("div",{className:"gf-form-button-row",children:[m&&(0,e.jsx)(x.$n,{variant:"secondary",onClick:this.onUserSync,children:(0,e.jsx)(t.x6,{i18nKey:"admin.ldap-sync.sync-button",children:"Sync user"})}),u&&(0,e.jsx)(x.z9,{variant:"secondary",href:c,children:(0,e.jsx)(t.x6,{i18nKey:"admin.ldap-sync.debug-button",children:"Debug LDAP Mapping"})})]})]})]})}}var d=o(22803),N=o(65240),S=o(7075),U=o(63142),V=o(22787),Y=o(37386),Z=o(45967),w=o(30703),X=o(91087),T=o(12037),q=o(41053),_=o(68143),z=o(18857);function ge(n){return{value:n,label:n.name}}function pe({onSelected:n,className:s,inputId:i,autoFocus:a,excludeOrgs:l,defaultOrganization:c}){const[u,m]=(0,h.useState)(c?ge(c):void 0);(0,h.useEffect)(()=>{a&&i&&document.getElementById(i)?.focus()},[a,i]);const[A,f]=(0,q.A)(async()=>{const j=(await(0,_.AI)().get("/api/orgs")).map(ge);if(l){let C=l.map(P=>P.orgId);return j.filter(P=>P.value!==void 0&&!C.includes(P.value.id))}else return j});return(0,e.jsx)(z.DW,{inputId:i,className:s,isLoading:A.loading,defaultOptions:!0,loadOptions:f,filterOption:(p,j)=>{const C=j.toLowerCase();return!!p.value?.name.toLowerCase().includes(C)},onChange:p=>{n(p),m(p)},value:u,placeholder:(0,t.t)("org-picker.select-placeholder","Select organization"),noOptionsMessage:"No organizations found"})}var fe=o(9390);class je extends h.PureComponent{constructor(){super(...arguments),this.addToOrgButtonRef=(0,h.createRef)(),this.state={showAddOrgModal:!1},this.showOrgAddModal=()=>{this.setState({showAddOrgModal:!0})},this.dismissOrgAddModal=()=>{this.setState({showAddOrgModal:!1},()=>{this.addToOrgButtonRef.current?.focus()})}}render(){const{user:s,orgs:i,isExternalUser:a,onOrgRoleChange:l,onOrgRemove:c,onOrgAdd:u}=this.props,{showAddOrgModal:m}=this.state,A=r.TP.hasPermission(g.AccessControlAction.OrgUsersAdd)&&!a;return(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-orgs.title",children:"Organizations"})}),(0,e.jsxs)(O.B,{gap:1.5,direction:"column",children:[(0,e.jsx)("table",{className:"filter-table form-inline",children:(0,e.jsx)("tbody",{children:i.map((f,p)=>(0,e.jsx)(ye,{isExternalUser:a,user:s,org:f,onOrgRoleChange:l,onOrgRemove:c},`${f.orgId}-${p}`))})}),(0,e.jsx)("div",{children:A&&(0,e.jsx)(x.$n,{variant:"secondary",onClick:this.showOrgAddModal,ref:this.addToOrgButtonRef,children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-orgs.add-button",children:"Add user to organization"})})}),(0,e.jsx)(Pe,{user:s,userOrgs:i,isOpen:m,onOrgAdd:u,onDismiss:this.dismissOrgAddModal})]})]})}}const ve=(0,N.N)(n=>({removeButton:(0,d.css)({marginRight:"0.6rem",textDecoration:"underline",color:n.v1.palette.blue95}),label:(0,d.css)({fontWeight:500}),disabledTooltip:(0,d.css)({display:"flex"}),tooltipItem:(0,d.css)({marginLeft:"5px"}),tooltipItemLink:(0,d.css)({color:n.v1.palette.blue95}),rolePickerWrapper:(0,d.css)({display:"flex"}),rolePicker:(0,d.css)({flex:"auto",marginRight:n.spacing(1)})}));class Ce extends h.PureComponent{constructor(){super(...arguments),this.state={currentRole:this.props.org.role,isChangingRole:!1,roleOptions:[]},this.onOrgRemove=async()=>{const{org:s}=this.props;this.props.onOrgRemove(s.orgId)},this.onChangeRoleClick=()=>{const{org:s}=this.props;this.setState({isChangingRole:!0,currentRole:s.role})},this.onOrgRoleChange=s=>{this.setState({currentRole:s})},this.onOrgRoleSave=()=>{this.props.onOrgRoleChange(this.props.org.orgId,this.state.currentRole)},this.onCancelClick=()=>{this.setState({isChangingRole:!1})},this.onBasicRoleChange=s=>{this.props.onOrgRoleChange(this.props.org.orgId,s)}}componentDidMount(){r.TP.licensedAccessControlEnabled()&&r.TP.hasPermission(g.AccessControlAction.ActionRolesList)&&(0,T.RL)(this.props.org.orgId).then(s=>this.setState({roleOptions:s})).catch(s=>console.error(s))}render(){const{user:s,org:i,isExternalUser:a,theme:l}=this.props,c=s?.authLabels?.length&&s?.authLabels[0],u=c?`Synced via ${c}`:"",{currentRole:m,isChangingRole:A}=this.state,f=ve(l),p=(0,d.cx)("width-16",f.label),j=r.TP.hasPermission(g.AccessControlAction.OrgUsersWrite),C=r.TP.hasPermission(g.AccessControlAction.OrgUsersRemove)&&!a,P=a||!j,k=`${i.name}-input`;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:p,children:(0,e.jsx)("label",{htmlFor:k,children:i.name})}),r.TP.licensedAccessControlEnabled()?(0,e.jsx)("td",{children:(0,e.jsxs)("div",{className:f.rolePickerWrapper,children:[(0,e.jsx)("div",{className:f.rolePicker,children:(0,e.jsx)(X.y,{userId:s?.id||0,orgId:i.orgId,basicRole:i.role,roleOptions:this.state.roleOptions,onBasicRoleChange:this.onBasicRoleChange,basicRoleDisabled:P,basicRoleDisabledMessage:`This user's role is not editable because it is synchronized from your auth provider.
                    Refer to the Grafana authentication docs for details.`})}),a&&(0,e.jsx)(ue,{lockMessage:u})]})}):(0,e.jsxs)(e.Fragment,{children:[A?(0,e.jsx)("td",{children:(0,e.jsx)(fe.r,{inputId:k,value:m,onChange:this.onOrgRoleChange,autoFocus:!0})}):(0,e.jsx)("td",{className:"width-25",children:i.role}),(0,e.jsx)("td",{colSpan:1,children:j&&(0,e.jsx)(Oe,{lockMessage:u,isExternalUser:a,onChangeRoleClick:this.onChangeRoleClick,onCancelClick:this.onCancelClick,onOrgRoleSave:this.onOrgRoleSave})})]}),(0,e.jsx)("td",{colSpan:1,children:C&&(0,e.jsx)(S.Z,{confirmText:"Confirm removal",confirmVariant:"destructive",onCancel:this.onCancelClick,onConfirm:this.onOrgRemove,children:(0,t.t)("admin.user-orgs.remove-button","Remove from organization")})})]})}}const ye=(0,U.cV)(Ce),Ae=(0,N.N)(()=>({modal:(0,d.css)({width:"500px"}),buttonRow:(0,d.css)({textAlign:"center"}),modalContent:(0,d.css)({overflow:"visible"})}));class Pe extends h.PureComponent{constructor(){super(...arguments),this.state={selectedOrg:null,role:g.OrgRole.Viewer,roleOptions:[],pendingOrgId:null,pendingUserId:null,pendingRoles:[]},this.onOrgSelect=s=>{const i=this.props.userOrgs.find(a=>a.orgId===s.value?.id);this.setState({selectedOrg:s.value,role:i?.role||g.OrgRole.Viewer}),r.TP.licensedAccessControlEnabled()&&r.TP.hasPermission(g.AccessControlAction.ActionRolesList)&&(0,T.RL)(s.value?.id).then(a=>this.setState({roleOptions:a})).catch(a=>console.error(a))},this.onOrgRoleChange=s=>{this.setState({role:s})},this.onAddUserToOrg=async()=>{const{selectedOrg:s,role:i}=this.state;this.props.onOrgAdd(s.id,i),r.TP.licensedAccessControlEnabled()&&r.TP.hasPermission(g.AccessControlAction.ActionUserRolesAdd)&&this.state.pendingUserId&&(await(0,T.eA)(this.state.pendingRoles,this.state.pendingUserId,this.state.pendingOrgId),this.setState({pendingOrgId:null,pendingRoles:[],pendingUserId:null}))},this.onCancel=()=>{this.setState({selectedOrg:null,pendingRoles:[],pendingOrgId:null,pendingUserId:null}),this.props.onDismiss&&this.props.onDismiss()},this.onRoleUpdate=async(s,i,a)=>{this.setState({pendingRoles:s,pendingOrgId:a,pendingUserId:i})}}render(){const{isOpen:s,user:i,userOrgs:a}=this.props,{role:l,roleOptions:c,selectedOrg:u}=this.state,m=Ae();return(0,e.jsxs)(V.a,{className:m.modal,contentClassName:m.modalContent,title:(0,t.t)("admin.add-to-org-modal.title-add-to-an-organization","Add to an organization"),isOpen:s,onDismiss:this.onCancel,children:[(0,e.jsx)(Y.D,{label:(0,t.t)("admin.add-to-org-modal.label-organization","Organization"),children:(0,e.jsx)(pe,{inputId:"new-org-input",onSelected:this.onOrgSelect,excludeOrgs:a,autoFocus:!0})}),(0,e.jsx)(Y.D,{label:(0,t.t)("admin.add-to-org-modal.label-role","Role"),disabled:u===null,children:(0,e.jsx)(X.y,{userId:i?.id||0,orgId:u?.id,basicRole:l,onBasicRoleChange:this.onOrgRoleChange,basicRoleDisabled:!1,roleOptions:c,apply:!0,onApplyRoles:this.onRoleUpdate,pendingRoles:this.state.pendingRoles})}),(0,e.jsx)(V.a.ButtonRow,{children:(0,e.jsxs)(O.B,{gap:2,justifyContent:"center",children:[(0,e.jsx)(x.$n,{variant:"secondary",fill:"outline",onClick:this.onCancel,children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-orgs-modal.cancel-button",children:"Cancel"})}),(0,e.jsx)(x.$n,{variant:"primary",disabled:u===null,onClick:this.onAddUserToOrg,children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-orgs-modal.add-button",children:"Add to organization"})})]})})]})}}const Re=n=>({disabledTooltip:(0,d.css)({display:"flex"}),tooltipItemLink:(0,d.css)({color:n.v1.palette.blue95}),lockMessageClass:(0,d.css)({fontStyle:"italic",marginLeft:"1.8rem",marginRight:"0.6rem"}),icon:(0,d.css)({lineHeight:2})});function Oe({lockMessage:n,onChangeRoleClick:s,isExternalUser:i,onOrgRoleSave:a,onCancelClick:l}){const c=(0,U.of)(Re);return(0,e.jsx)("div",{className:c.disabledTooltip,children:i?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{className:c.lockMessageClass,children:n}),(0,e.jsx)(Z.m,{placement:"right-end",interactive:!0,content:(0,e.jsx)("div",{children:(0,e.jsxs)(t.x6,{i18nKey:"admin.user-orgs.role-not-editable",children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)("a",{className:c.tooltipItemLink,href:"https://grafana.com/docs/grafana/latest/auth",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,e.jsx)("div",{className:c.icon,children:(0,e.jsx)(w.I,{name:"question-circle"})})})]}):(0,e.jsx)(S.Z,{confirmText:"Save",onClick:s,onCancel:l,onConfirm:a,disabled:i,children:(0,t.t)("admin.user-orgs.change-role-button","Change role")})})}const ue=({lockMessage:n})=>{const s=(0,U.of)(be);return(0,e.jsxs)("div",{className:s.disabledTooltip,children:[(0,e.jsx)("span",{className:s.lockMessageClass,children:n}),(0,e.jsx)(Z.m,{placement:"right-end",interactive:!0,content:(0,e.jsx)("div",{children:(0,e.jsxs)(t.x6,{i18nKey:"admin.user-orgs.external-user-tooltip",children:["This user's built-in role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)("a",{className:s.tooltipItemLink,href:"https://grafana.com/docs/grafana/latest/auth",rel:"noreferrer noopener",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,e.jsx)(w.I,{name:"question-circle"})})]})},be=n=>({disabledTooltip:(0,d.css)({display:"flex"}),tooltipItemLink:(0,d.css)({color:n.v1.palette.blue95}),lockMessageClass:(0,d.css)({fontStyle:"italic",marginLeft:"1.8rem",marginRight:"0.6rem"})});var Se=o(77824);const Ue=[{label:"Yes",value:!0},{label:"No",value:!1}];function Me({isGrafanaAdmin:n,isExternalUser:s,lockMessage:i,onGrafanaAdminChange:a}){const[l,c]=(0,h.useState)(!1),[u,m]=(0,h.useState)(n),A=()=>c(!0),f=()=>{c(!1),m(n)},p=()=>a(u),j=r.TP.hasPermission(g.AccessControlAction.UsersPermissionsUpdate)&&!s,C=(0,U.of)(De);return(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-permissions.title",children:"Permissions"})}),(0,e.jsx)("table",{className:"filter-table form-inline",children:(0,e.jsx)("tbody",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"width-16",children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-permissions.grafana-admin-key",children:"Grafana Admin"})}),l?(0,e.jsx)("td",{colSpan:2,children:(0,e.jsx)(Se.z,{options:Ue,value:u,onChange:m,autoFocus:!0})}):(0,e.jsx)("td",{colSpan:2,children:n?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(w.I,{name:"shield"})," ",(0,e.jsx)(t.x6,{i18nKey:"admin.user-permissions.grafana-admin-yes",children:"Yes"})]}):(0,e.jsx)(t.x6,{i18nKey:"admin.user-permissions.grafana-admin-no",children:"No"})}),(0,e.jsxs)("td",{children:[j&&(0,e.jsx)(S.Z,{onClick:A,onConfirm:p,onCancel:f,confirmText:"Change",children:(0,t.t)("admin.user-permissions.change-button","Change")}),s&&(0,e.jsx)("div",{className:C.lockMessageClass,children:(0,e.jsx)(ue,{lockMessage:i})})]})]})})})]})}const De=n=>({lockMessageClass:(0,d.css)({display:"flex",justifyContent:"flex-end",fontStyle:"italic",marginRight:n.spacing(.6)})});var ee=o(71599),me=o(32581),Te=o(63527);function Le({user:n,onUserUpdate:s,onUserDelete:i,onUserDisable:a,onUserEnable:l,onPasswordChange:c}){const[u,m]=(0,h.useState)(!1),[A,f]=(0,h.useState)(!1),p=(0,h.useRef)(null),j=y=>()=>{m(y),!y&&p.current&&p.current.focus()},C=(0,h.useRef)(null),P=y=>()=>{f(y),!y&&C.current&&C.current.focus()},k=()=>i(n.uid),se=()=>a(n.uid),ne=()=>l(n.uid),te=y=>{s({...n,name:y})},H=y=>{s({...n,email:y})},oe=y=>{s({...n,login:y})};let W=n.authLabels?.length&&n.authLabels[0];n.isProvisioned&&(W="SCIM");const B=W?`Synced via ${W}`:"",G=n.isExternal||n.isProvisioned||!r.TP.hasPermissionInMetadata(g.AccessControlAction.UsersWrite,n),ie=n.isExternal||n.isProvisioned||!r.TP.hasPermissionInMetadata(g.AccessControlAction.UsersPasswordUpdate,n),ae=r.TP.hasPermissionInMetadata(g.AccessControlAction.UsersDelete,n),le=r.TP.hasPermissionInMetadata(g.AccessControlAction.UsersDisable,n),re=r.TP.hasPermissionInMetadata(g.AccessControlAction.UsersEnable,n);return(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-profile.title",children:"User information"})}),(0,e.jsxs)(O.B,{direction:"column",gap:1.5,children:[(0,e.jsx)("div",{children:(0,e.jsx)("table",{className:"filter-table form-inline",children:(0,e.jsxs)("tbody",{children:[(0,e.jsx)(F,{label:(0,t.t)("admin.user-profile.label-numerical-identifier","Numerical identifier"),value:n.id.toString(),locked:!0}),(0,e.jsx)(F,{label:(0,t.t)("admin.user-profile.label-name","Name"),value:n.name,locked:G,lockMessage:B,onChange:te}),(0,e.jsx)(F,{label:(0,t.t)("admin.user-profile.label-email","Email"),value:n.email,locked:G,lockMessage:B,onChange:H}),(0,e.jsx)(F,{label:(0,t.t)("admin.user-profile.label-username","Username"),value:n.login,locked:G,lockMessage:B,onChange:oe}),(0,e.jsx)(F,{label:(0,t.t)("admin.user-profile.label-password","Password"),value:"********",inputType:"password",locked:ie,lockMessage:B,onChange:c})]})})}),(0,e.jsxs)(O.B,{gap:2,children:[ae&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(x.$n,{variant:"destructive",onClick:j(!0),ref:p,children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-profile.delete-button",children:"Delete user"})}),(0,e.jsx)(ee.u,{isOpen:u,title:(0,t.t)("admin.user-profile.title-delete-user","Delete user"),body:"Are you sure you want to delete this user?",confirmText:"Delete user",onConfirm:k,onDismiss:j(!1)})]}),n.isDisabled&&re&&(0,e.jsx)(x.$n,{variant:"secondary",onClick:ne,children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-profile.enable-button",children:"Enable user"})}),!n.isDisabled&&le&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(x.$n,{variant:"secondary",onClick:P(!0),ref:C,children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-profile.disable-button",children:"Disable user"})}),(0,e.jsx)(ee.u,{isOpen:A,title:(0,t.t)("admin.user-profile.title-disable-user","Disable user"),body:"Are you sure you want to disable this user?",confirmText:"Disable user",onConfirm:se,onDismiss:P(!1)})]})]})]})]})}class F extends h.PureComponent{constructor(){super(...arguments),this.state={editing:!1,value:this.props.value||""},this.setInputElem=s=>{this.inputElem=s},this.onEditClick=()=>{this.props.inputType==="password"?this.setState({editing:!0,value:""},this.focusInput):this.setState({editing:!0},this.focusInput)},this.onCancelClick=()=>{this.setState({editing:!1,value:this.props.value||""})},this.onInputChange=(s,i)=>{i!==me.O.Invalid&&this.setState({value:s.target.value})},this.onInputBlur=(s,i)=>{i!==me.O.Invalid&&this.setState({value:s.target.value})},this.focusInput=()=>{this.inputElem&&this.inputElem.focus&&this.inputElem.focus()},this.onSave=()=>{this.props.onChange&&this.props.onChange(this.state.value)}}static{this.defaultProps={value:"",locked:!1,lockMessage:"",inputType:"text"}}render(){const{label:s,locked:i,lockMessage:a,inputType:l}=this.props,{value:c}=this.state,u=(0,d.cx)("width-16",(0,d.css)({fontWeight:500}));if(i)return(0,e.jsx)(Ee,{label:s,value:c,lockMessage:a});const m=`${s}-input`;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:u,children:(0,e.jsx)("label",{htmlFor:m,children:s})}),(0,e.jsx)("td",{className:"width-25",colSpan:2,children:this.state.editing?(0,e.jsx)(Te.p,{id:m,type:l,defaultValue:c,onBlur:this.onInputBlur,onChange:this.onInputChange,ref:this.setInputElem,width:30}):(0,e.jsx)("span",{children:this.props.value})}),(0,e.jsx)("td",{children:(0,e.jsx)(S.Z,{confirmText:"Save",onClick:this.onEditClick,onConfirm:this.onSave,onCancel:this.onCancelClick,children:(0,t.t)("admin.user-profile.edit-button","Edit")})})]})}}const Ee=({label:n,value:s,lockMessage:i})=>{const a=(0,d.css)({fontStyle:"italic",marginRight:"0.6rem"}),l=(0,d.cx)("width-16",(0,d.css)({fontWeight:500}));return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:l,children:n}),(0,e.jsx)("td",{className:"width-25",colSpan:2,children:s}),(0,e.jsx)("td",{children:(0,e.jsx)("span",{className:a,children:i})})]})};var Ie=o(12810);class Ne extends h.PureComponent{constructor(){super(...arguments),this.forceAllLogoutButton=(0,h.createRef)(),this.state={showLogoutModal:!1},this.showLogoutConfirmationModal=()=>{this.setState({showLogoutModal:!0})},this.dismissLogoutConfirmationModal=()=>{this.setState({showLogoutModal:!1},()=>{this.forceAllLogoutButton.current?.focus()})},this.onSessionRevoke=s=>()=>{this.props.onSessionRevoke(s)},this.onAllSessionsRevoke=()=>{this.setState({showLogoutModal:!1}),this.props.onAllSessionsRevoke()}}render(){const{sessions:s}=this.props,{showLogoutModal:i}=this.state,a=r.TP.hasPermission(g.AccessControlAction.UsersLogout);return(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-sessions.title",children:"Sessions"})}),(0,e.jsxs)(O.B,{direction:"column",gap:1.5,children:[(0,e.jsx)("div",{children:(0,e.jsxs)("table",{className:"filter-table form-inline",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-sessions.last-seen-column",children:"Last seen"})}),(0,e.jsx)("th",{children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-sessions.logged-on-column",children:"Logged on"})}),(0,e.jsx)("th",{children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-sessions.ip-column",children:"IP address"})}),(0,e.jsx)("th",{children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-sessions.browser-column",children:"Browser and OS"})}),(0,e.jsx)("th",{colSpan:2,children:(0,e.jsx)(t.x6,{i18nKey:"user-session.auth-module-column",children:"Identity Provider"})})]})}),(0,e.jsx)("tbody",{children:s&&s.map((l,c)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:l.isActive?"Now":l.seenAt}),(0,e.jsx)("td",{children:(0,Ie.Y)(l.createdAt,{dateStyle:"long"})}),(0,e.jsx)("td",{children:l.clientIp}),(0,e.jsx)("td",{children:`${l.browser} on ${l.os} ${l.osVersion}`}),(0,e.jsx)("td",{children:l.authModule&&(0,e.jsx)(I.E,{label:l.authModule,removeIcon:!1,count:0})}),(0,e.jsx)("td",{children:a&&(0,e.jsx)(S.Z,{confirmText:"Confirm logout",confirmVariant:"destructive",onConfirm:this.onSessionRevoke(l.id),children:(0,t.t)("admin.user-sessions.force-logout-button","Force logout")})})]},`${l.id}-${c}`))})]})}),(0,e.jsxs)("div",{children:[a&&s.length>0&&(0,e.jsx)(x.$n,{variant:"secondary",onClick:this.showLogoutConfirmationModal,ref:this.forceAllLogoutButton,children:(0,e.jsx)(t.x6,{i18nKey:"admin.user-sessions.force-logout-all-button",children:"Force logout from all devices"})}),(0,e.jsx)(ee.u,{isOpen:i,title:(0,t.t)("admin.base-user-sessions.title-force-logout-from-all-devices","Force logout from all devices"),body:"Are you sure you want to force logout from all devices?",confirmText:"Force logout",onConfirm:this.onAllSessionsRevoke,onDismiss:this.dismissLogoutConfirmationModal})]})]})]})}}const ke=Ne;var v=o(74267);const xe=({loadAdminUserPage:n,user:s,orgs:i,sessions:a,ldapSyncInfo:l,isLoading:c,updateUser:u,setUserPassword:m,deleteUser:A,disableUser:f,enableUser:p,updateUserPermissions:j,deleteOrgUser:C,updateOrgUserRole:P,addOrgUser:k,revokeSession:se,revokeAllSessions:ne,syncLdapUser:te})=>{const{id:H=""}=(0,M.g)();(0,h.useEffect)(()=>{n(H)},[H,n]);const oe=R=>{s&&m(s.uid,R)},W=R=>{s&&j(s.uid,R)},B=R=>{s&&C(s.uid,R)},G=(R,de)=>{s&&P(s.uid,R,de)},ie=(R,de)=>{s&&k(s,R,de)},ae=R=>{s&&se(R,s.uid)},le=()=>{s&&ne(s.uid)},re=()=>{s&&te(s.id,s.uid)},y=s?.isExternal&&s?.authLabels?.includes("LDAP"),we=r.TP.hasPermission(g.AccessControlAction.UsersAuthTokenList),ze=r.TP.hasPermission(g.AccessControlAction.LDAPStatusRead);let ce=s?.authLabels?.[0];s?.isProvisioned&&(ce="SCIM");const Fe=ce?`Synced via ${ce}`:"",We={text:s?.login??"",icon:"shield",subTitle:"Manage settings for an individual user."};return(0,e.jsx)(D.Y,{navId:"global-users",pageNav:We,children:(0,e.jsx)(D.Y.Contents,{isLoading:c,children:(0,e.jsxs)(O.B,{gap:5,direction:"column",children:[s&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Le,{user:s,onUserUpdate:u,onUserDelete:A,onUserDisable:f,onUserEnable:p,onPasswordChange:oe}),y&&s?.isExternallySynced&&(0,E.a)("ldapsync")&&l&&ze&&(0,e.jsx)(Q,{ldapSyncInfo:l,user:s,onUserSync:re}),(0,e.jsx)(Me,{isGrafanaAdmin:s.isGrafanaAdmin,isExternalUser:s?.isGrafanaAdminExternallySynced,lockMessage:Fe,onGrafanaAdminChange:W})]}),i&&(0,e.jsx)(je,{user:s,orgs:i,isExternalUser:s?.isExternallySynced,onOrgRemove:B,onOrgRoleChange:G,onOrgAdd:ie}),a&&we&&(0,e.jsx)(ke,{sessions:a,onSessionRevoke:ae,onAllSessionsRevoke:le})]})})})},Be=n=>({user:n.userAdmin.user,sessions:n.userAdmin.sessions,orgs:n.userAdmin.orgs,ldapSyncInfo:n.ldap.syncInfo,isLoading:n.userAdmin.isLoading,error:n.userAdmin.error}),Ke={loadAdminUserPage:v.kz,updateUser:v.TK,setUserPassword:v.ly,disableUser:v.MV,enableUser:v.nr,deleteUser:v.hG,updateUserPermissions:v.N6,addOrgUser:v.nh,updateOrgUserRole:v.P3,deleteOrgUser:v.Pi,revokeSession:v.T$,revokeAllSessions:v.VR,syncLdapUser:v.mI},$e=(0,K.connect)(Be,Ke)(xe)}}]);

//# sourceMappingURL=UserAdminPage.4b6949af0f19a04ffb45.js.map