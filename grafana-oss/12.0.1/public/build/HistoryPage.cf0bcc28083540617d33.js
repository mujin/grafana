"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[44],{12266:(ee,P,a)=>{a.d(P,{e:()=>$});var t=a(74848),L=a(45861);const $=({isCollapsed:m,onToggle:j,idControlled:A,className:o,text:T,size:R="xl",...w})=>(0,t.jsx)(L.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!m,"aria-controls":A,className:o,icon:m?"angle-right":"angle-down",onClick:()=>j(!m),...w,children:T})},1625:(ee,P,a)=>{a.d(P,{P:()=>o});var t=a(74848),L=a(22803),$=a(63142),m=a(66404),j=a(41654),A=a(30703);const o=({children:R,icon:w,color:F="secondary",direction:v="row",...I})=>{const g=(0,$.of)(T),N=typeof I.onClick=="function",U=v==="row",Q=U?"center":"flex-start",Z=U?.5:0;return(0,t.jsx)("div",{className:(0,L.cx)({[g.interactive]:N}),...I,children:(0,t.jsx)(m.E,{variant:"bodySmall",color:F,children:(0,t.jsxs)(j.B,{direction:v,alignItems:Q,gap:Z,wrap:"wrap",children:[w&&(0,t.jsx)(A.I,{size:"xs",name:w}),R]})})})},T=()=>({interactive:(0,L.css)({cursor:"pointer"})})},56102:(ee,P,a)=>{a.r(P),a.d(P,{default:()=>ft});var t=a(74848),L=a(88547),$=a(36826),m=a(22803),j=a(96540),A=a(7389),o=a(56838),T=a(739),R=a(45967),w=a(45861),F=a(63142),v=a(66404),I=a(30703),g=a(56840),N=a(74268),U=a(2863),Q=a(75421),Z=a(8535),Y=a(59614),ge=a(54148),me=a(49185),te=a(34999),he=a(47327),S=a(41654),ye=a(34213),fe=a(36303),E=a(24619),xe=a(74048),K=a(86017),ve=a(52161),pe=a(92367),je=a(7840),Te=a(12266),z=a(2543),Fe=a(44109),X=a(63895),Se=a(94646),Ce=a(1625),Ee=a(45746),be=a(88215),Re=a(54302),O=a(93571),Ie=a(68143),Ne=a(1506),Pe=a(77256);function ne({error:e}){if((0,Ie.NF)(e)&&e.status===404)return(0,t.jsx)(Ne.L,{entity:"History"});const n=(0,g.t)("alerting.central-alert-history.error","Something went wrong loading the alert state history"),s=(0,Pe.JZ)(e);return(0,t.jsx)(te.F,{title:n,children:s})}var B=a(95004),Le=a(18600),Ae=a(33553),we=a(11576),se=a(92446);const ae=10*1e3,k="var-",Oe={stateTo:"all",stateFrom:"all",labels:""};function Be({data:e},n=Oe){const{stateTo:s,stateFrom:r}=n,[i=[],d=[]]=e?.values??[],c=((0,O.bF)(i)?i:[]).reduce((h,f,C)=>{const p=d[C];if(!(0,O.PA)(p))return h;const b=(0,E.lh)(p.current),V=(0,E.lh)(p.previous),q=s!==x.all?s===b:!0,_=r!==x.all?r===V:!0;return q&&_&&h.push({timestamp:f,line:p}),h},[]),u=(0,z.groupBy)(c,h=>JSON.stringify(h.line.labels)),y=Object.entries(u).map(([h,f])=>De(h,f));return $e(y,n)}function vt(){return new URLSearchParams(window.location.search).get(`${k}${LABELS_FILTER}`)??""}function pt(){return new URLSearchParams(window.location.search).get(`${k}${STATE_FILTER_TO}`)??StateFilterValues.all}function jt(){return new URLSearchParams(window.location.search).get(`${k}${STATE_FILTER_FROM}`)??StateFilterValues.all}function $e(e,n){const s=n.labels,i=e.filter(u=>{const y=JSON.parse(u.name??""),h=s?(0,X.Zc)(s):[];return(0,K.Av)(y,h)}).flatMap(u=>u.fields.find(y=>y.name==="time")),d=(0,z.groupBy)(i?.flatMap(u=>u?.values),u=>Math.floor(u/ae)*ae),l={name:"time",type:B.PU.time,values:Object.keys(d).map(Number),config:{displayName:"Time",custom:{fillOpacity:100}}},c={name:"value",type:B.PU.number,values:Object.values(d).map(u=>u.length),config:{}};return[{fields:[l,c],length:l.values.length}]}function De(e,n){const s={name:"time",type:B.PU.time,values:[...n.map(d=>d.timestamp)],config:{displayName:"Time",custom:{fillOpacity:100}}},r=s.values.map((d,l)=>l);return r.sort((0,se.i)(s)),{fields:[{...s,values:s.values.map((d,l)=>s.values[r[l]])},{name:e,type:B.PU.number,values:s.values.map(d=>1),config:{}}],length:s.values.length,name:e}}function Me(e,n){const s={name:"time",type:B.PU.time,values:[...e.map(l=>l.timestamp),Date.now()],config:{displayName:"Time",custom:{fillOpacity:100}}},r=s.values.map((l,c)=>c);r.sort((0,se.i)(s));const i=[...e.map(l=>l.line.current),e.at(-1)?.line.current],d={fields:[{...s,values:s.values.map((l,c)=>s.values[r[c]])},{name:"State",type:B.PU.string,values:i.map((l,c)=>i[r[c]]),config:{displayName:"State",color:{mode:"thresholds"},custom:{fillOpacity:100},mappings:[{type:Le.d.ValueToText,options:{Alerting:{color:n.colors.error.main},Pending:{color:n.colors.warning.main},Recovering:{color:n.colors.warning.main},Normal:{color:n.colors.success.main},NoData:{color:n.colors.info.main}}}],thresholds:{mode:Ae.O.Absolute,steps:[]}}}],length:s.values.length,name:""};return d.fields.forEach(l=>{l.display=(0,we.J)({field:l,theme:n})}),d}function He({record:e,addFilter:n,timeRange:s}){(0,j.useEffect)(()=>{(0,N.iW)()},[]);const r=e.line?.ruleUID??"",i=e.line?.labels,d=(0,j.useMemo)(()=>(0,Se.qg)(r,!0),[r]),{error:l,loading:c,result:u}=(0,Fe.ZU)({ruleIdentifier:d,limitAlerts:0});return l?(0,t.jsx)(v.E,{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.error",children:"Error loading rule for this event."})}):c?(0,t.jsx)(v.E,{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.loading",children:"Loading..."})}):u?(0,t.jsxs)(S.B,{direction:"column",gap:.5,children:[(0,t.jsxs)(S.B,{direction:"row",gap:6,children:[(0,t.jsx)(Ke,{record:e,addFilter:n}),(0,t.jsx)(We,{record:e})]}),(0,t.jsx)(ze,{rule:u}),(0,t.jsx)(Ue,{ruleUID:r,timeRange:s,labels:i??{}})]}):(0,t.jsx)(v.E,{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.not-found",children:"Rule not found for this event."})})}function Ve(e,n){const s=(0,F.$j)();return(0,j.useMemo)(()=>{const r=n?.data?.values[0]??[],i=(0,O.bF)(r)?r:[],d=n?.data?.values[1]??[],l=i.reduce((f,C,p)=>{const b=d[p];return(0,O.PA)(b)&&f.push({timestamp:C,line:b}),f},[]),c=(0,z.groupBy)(l,f=>JSON.stringify(f.line.labels)),u=(0,X.Zc)(e),y=Object.entries(c).filter(([f])=>{const C=JSON.parse(f);return(0,K.Av)(C,u)});return{dataFrames:Object.values(y).map(f=>Me(f[1],s))}},[n,e,s])}function Ue({ruleUID:e,timeRange:n,labels:s}){const{useGetRuleHistoryQuery:r}=Y.U,{currentData:i,isLoading:d,isError:l,error:c}=r({ruleUid:e,from:n.from.unix(),to:n.to.unix(),limit:W},{refetchOnFocus:!0,refetchOnReconnect:!0}),{dataFrames:u}=Ve(s?Object.entries(s).map(([C,p])=>`${C}=${p}`).join(","):"",i),{frameSubset:y,frameTimeRange:h}=(0,Re.useFrameSubset)(u);if(d)return(0,t.jsx)("div",{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.loading",children:"Loading..."})});if(l)return(0,t.jsx)(ne,{error:c});if(!y||y.length===0)return null;const f=u[0]?.fields[0]?.values?.length-1||0;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ge,{transitions:e?f:0}),(0,t.jsx)(be.A,{frames:y,timeRange:h})]})}function Ke({record:e,addFilter:n}){return(0,t.jsxs)(S.B,{gap:.5,direction:"column",children:[(0,t.jsx)(v.E,{variant:"body",weight:"light",color:"secondary",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state-transitions",children:"State transition"})}),(0,t.jsxs)(S.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,t.jsx)(G,{state:e.line.previous,showLabel:!0,addFilter:n,type:"from"}),(0,t.jsx)(I.I,{name:"arrow-right",size:"lg"}),(0,t.jsx)(G,{state:e.line.current,showLabel:!0,addFilter:n,type:"to"})]})]})}const ze=({rule:e})=>{const n=(0,F.of)(re),s=e.annotations;return!s||Object.keys(s).length===0?null:(0,t.jsx)("div",{className:n.metadataWrapper,children:Object.entries(s).map(([r,i])=>{const d=(0,z.capitalize)(r);return(0,t.jsxs)(Ce.P,{direction:"column",children:[d,(0,t.jsx)(Ee.$,{value:i})]},d)})})};function We({record:e}){const n=e?.line?.values?JSON.stringify(e.line.values):(0,g.t)("alerting.central-alert-history.details.no-values","No values");return(0,t.jsxs)(S.B,{gap:.5,direction:"column",children:[(0,t.jsx)(v.E,{variant:"body",weight:"light",color:"secondary",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.value-in-transition",children:"Value in transition"})}),(0,t.jsx)(S.B,{gap:.5,direction:"row",alignItems:"center",children:(0,t.jsx)(v.E,{variant:"body",weight:"light",children:n})})]})}function Ge({transitions:e}){const n=(0,F.of)(re);return(0,t.jsxs)("div",{className:n.transitionsNumber,children:[(0,t.jsx)(v.E,{variant:"body",weight:"bold",color:"secondary",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.number-transitions",children:"State transitions for selected period:"})}),(0,t.jsx)(v.E,{variant:"body",weight:"light",children:e})]})}const re=e=>({metadataWrapper:(0,m.css)({display:"grid",gridTemplateColumns:"auto auto",rowGap:e.spacing(3),columnGap:e.spacing(12)}),transitionsNumber:(0,m.css)({display:"flex",flexDirection:"row",gap:e.spacing(.5),alignItems:"center",marginTop:e.spacing(1.5)})}),ie={labels:"",stateFrom:"all",stateTo:"all"};function Je(e,n=ie){return(0,j.useMemo)(()=>Qe(e,n),[n,e])}function Qe(e,n=ie){const{labels:s,stateFrom:r,stateTo:i}=n;if(!e?.data)return{historyRecords:[]};const d=s?(0,X.Zc)(s):[],[l,c]=e.data.values;return{historyRecords:((0,O.bF)(l)?l:[]).reduce((h,f,C)=>{const p=c[C];if(!(0,O.PA)(p))return h;const b=p.labels&&(0,K.Av)(p.labels,d),V=(0,E.lh)(p.current),q=(0,E.lh)(p.previous),_=i!==x.all?i===V:!0,xt=r!==x.all?r===q:!0;return b&&_&&xt&&h.push({timestamp:f,line:p}),h},[])}}const W=5e3,Ze=100,oe=({timeRange:e,valueInLabelFilter:n,valueInStateToFilter:s,valueInStateFromFilter:r,addFilter:i})=>{const d=e?.from.unix(),l=e?.to.unix(),{data:c,isLoading:u,isError:y,error:h}=Y.U.endpoints.getRuleHistory.useQuery({from:d,to:l,limit:W}),{historyRecords:f}=Je(c,{labels:n.toString(),stateFrom:r.toString(),stateTo:s.toString()}),C=f.sort((b,V)=>V.timestamp-b.timestamp);if(y)return(0,t.jsx)(ne,{error:h});const p=!u&&c?.data?.values?.[0]?.length===W;return p&&(0,N.Hs)({from:d,to:l}),(0,t.jsxs)(t.Fragment,{children:[p&&(0,t.jsx)(te.F,{severity:"warning",title:(0,g.t)("alerting.central-alert-history.too-many-events.title","Unable to display all events"),children:(0,g.t)("alerting.central-alert-history.too-many-events.text","The selected time period has too many events to display. Diplaying the latest 5000 events. Try using a shorter time period.")}),(0,t.jsx)(Ye,{visible:u}),(0,t.jsx)(Xe,{logRecords:C,addFilter:i,timeRange:e})]})},Ye=({visible:e=!1})=>{const[n,{width:s}]=(0,me.A)();return(0,t.jsx)("div",{ref:n,children:e&&(0,t.jsx)(he.G,{width:s,"data-testid":"loading-bar"})})};function Xe({logRecords:e,addFilter:n,timeRange:s}){const{page:r,pageItems:i,numberOfPages:d,onPageChange:l}=(0,xe.W)(e,1,Ze);return(0,t.jsxs)(S.B,{direction:"column",gap:0,children:[(0,t.jsx)(ke,{}),(0,t.jsx)("ul",{children:i.map(c=>(0,t.jsx)(qe,{record:c,addFilter:n,timeRange:s},c.timestamp+(c.line.fingerprint??"")))}),(0,t.jsx)(ye.d,{currentPage:r,numberOfPages:d,onNavigate:l,hideWhenSinglePage:!0})]})}function ke(){const e=(0,F.of)(J);return(0,t.jsx)("div",{className:e.headerWrapper,children:(0,t.jsxs)("div",{className:e.mainHeader,children:[(0,t.jsx)("div",{className:e.timeCol,children:(0,t.jsx)(v.E,{variant:"body",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.header.timestamp",children:"Timestamp"})})}),(0,t.jsx)("div",{className:e.transitionCol,children:(0,t.jsx)(v.E,{variant:"body",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.header.state",children:"State"})})}),(0,t.jsx)("div",{className:e.alertNameCol,children:(0,t.jsx)(v.E,{variant:"body",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.header.alert-rule",children:"Alert rule"})})}),(0,t.jsx)("div",{className:e.labelsCol,children:(0,t.jsx)(v.E,{variant:"body",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.header.instance",children:"Instance"})})})]})})}function qe({record:e,addFilter:n,timeRange:s}){const r=(0,F.of)(J),[i,d]=(0,j.useState)(!0);function l(c,u){n(c,u,"label")}return(0,t.jsxs)(S.B,{direction:"column",gap:0,children:[(0,t.jsxs)("div",{className:(0,m.cx)(r.header,i?r.collapsedHeader:r.notCollapsedHeader),"data-testid":"event-row-header",children:[(0,t.jsx)(Te.e,{size:"sm",className:r.collapseToggle,isCollapsed:i,onToggle:d}),(0,t.jsxs)(S.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,t.jsx)("div",{className:r.timeCol,children:(0,t.jsx)(tt,{time:e.timestamp})}),(0,t.jsx)("div",{className:r.transitionCol,children:(0,t.jsx)(et,{previous:e.line.previous,current:e.line.current,addFilter:n})}),(0,t.jsx)("div",{className:r.alertNameCol,children:e.line.labels?(0,t.jsx)(_e,{labels:e.line.labels,ruleUID:e.line.ruleUID}):null}),(0,t.jsx)("div",{className:r.labelsCol,children:(0,t.jsx)(je.m,{labels:e.line.labels??{},size:"xs",onClick:l})})]})]}),!i&&(0,t.jsx)("div",{className:r.expandedRow,children:(0,t.jsx)(He,{record:e,addFilter:n,timeRange:s})})]})}function _e({labels:e,ruleUID:n}){const s=(0,F.of)(J),{pathname:r,search:i}=(0,ge.zy)(),d=`${r}${i}`,l=e.alertname;if(!n)return(0,t.jsx)(v.E,{children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.unknown-rule",children:"Unknown"})});const c=(0,pe.G)(`/alerting/${ve.hY}/${n}/view`,{tab:"history",returnTo:d});return(0,t.jsx)(R.m,{content:l??"",children:(0,t.jsx)("a",{href:c,className:s.alertName,children:l})})}function et({previous:e,current:n,addFilter:s}){return(0,t.jsxs)(S.B,{gap:.5,direction:"row",children:[(0,t.jsx)(G,{state:e,addFilter:s,type:"from"}),(0,t.jsx)(I.I,{name:"arrow-right",size:"lg"}),(0,t.jsx)(G,{state:n,addFilter:s,type:"to"})]})}const le=({iconName:e,iconColor:n,tooltipContent:s,labelText:r,showLabel:i})=>(0,t.jsx)(R.m,{content:s,placement:"top",children:(0,t.jsxs)(S.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,t.jsx)(I.I,{name:e,size:"md",className:n}),i&&(0,t.jsx)(v.E,{variant:"body",weight:"light",children:r})]})});function G({state:e,showLabel:n=!1,addFilter:s,type:r}){const i=(0,F.of)(J),d=(0,g.t)("alerting.central-alert-history.details.no-recognized-state","No recognized state");if(!(0,E.s1)(e)&&!(0,E.qr)(e))return(0,t.jsx)(le,{iconName:"exclamation-triangle",tooltipContent:d,labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.unknown-event-state",children:"Unknown"}),showLabel:n,iconColor:i.warningColor});const l=(0,E.lh)(e),c=(0,E.$k)(e),u={Normal:{iconName:"check-circle",iconColor:c?i.warningColor:i.normalColor,tooltipContent:c?`Normal (${c})`:"Normal",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.normal",children:"Normal"})},Alerting:{iconName:"exclamation-circle",iconColor:i.alertingColor,tooltipContent:"Alerting",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.alerting",children:"Alerting"})},NoData:{iconName:"exclamation-triangle",iconColor:i.warningColor,tooltipContent:"Insufficient data",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.no-data",children:"No data"})},Error:{iconName:"exclamation-circle",tooltipContent:"Error",iconColor:i.warningColor,labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.error",children:"Error"})},Pending:{iconName:"circle",iconColor:i.warningColor,tooltipContent:c?`Pending (${c})`:"Pending",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.pending",children:"Pending"})},Recovering:{iconName:"circle",iconColor:i.warningColor,tooltipContent:c?`Recovering (${c})`:"Recovering",labelText:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.details.state.recovering",children:"Recovering"})}};function y(){s("state",l,r==="from"?"stateFrom":"stateTo")}const h=u[l]||{iconName:"exclamation-triangle",tooltipContent:"Unknown State"};return(0,t.jsx)("div",{onClick:y,onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&y()},className:i.state,role:"button",tabIndex:0,children:(0,t.jsx)(le,{...h,showLabel:n})})}const tt=({time:e})=>{const s=new Date(e).toLocaleString("en-US",{month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return(0,t.jsx)(v.E,{variant:"body",weight:"light",children:s})},Tt=(0,fe.Xc)(oe,{style:"page"}),J=e=>({header:(0,m.css)({display:"flex",flexDirection:"row",alignItems:"center",padding:`${e.spacing(1)} ${e.spacing(1)} ${e.spacing(1)} 0`,flexWrap:"nowrap","&:hover":{backgroundColor:e.components.table.rowHoverBackground}}),collapsedHeader:(0,m.css)({borderBottom:`1px solid ${e.colors.border.weak}`}),notCollapsedHeader:(0,m.css)({borderBottom:"none"}),collapseToggle:(0,m.css)({background:"none",border:"none",marginTop:`-${e.spacing(1)}`,marginBottom:`-${e.spacing(1)}`,svg:{marginBottom:0}}),normalColor:(0,m.css)({fill:e.colors.success.text}),warningColor:(0,m.css)({fill:e.colors.warning.text}),alertingColor:(0,m.css)({fill:e.colors.error.text}),timeCol:(0,m.css)({width:"150px"}),transitionCol:(0,m.css)({width:"80px"}),alertNameCol:(0,m.css)({width:"300px"}),labelsCol:(0,m.css)({display:"flex",overflow:"hidden",alignItems:"center",paddingRight:e.spacing(2),flex:1}),alertName:(0,m.css)({whiteSpace:"nowrap",cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",display:"block",color:e.colors.text.link}),expandedRow:(0,m.css)({padding:e.spacing(2),marginLeft:e.spacing(2),borderLeft:`1px solid ${e.colors.border.weak}`}),colorIcon:(0,m.css)({color:e.colors.primary.text,"&:hover":{opacity:.8}}),state:(0,m.css)({"&:hover":{opacity:.8,cursor:"pointer"}}),headerWrapper:(0,m.css)({borderBottom:`1px solid ${e.colors.border.weak}`}),mainHeader:(0,m.css)({display:"flex",flexDirection:"row",alignItems:"center",flexWrap:"nowrap",marginLeft:"30px",padding:`${e.spacing(1)} ${e.spacing(1)} ${e.spacing(1)} 0`,gap:e.spacing(.5)})});class nt extends o.Bs{constructor(){super(...arguments),this._variableDependency=new o.Sh(this,{variableNames:[D,H,M]})}static{this.Component=st}}function st({model:e}){e.useState();const{value:n}=o.jh.getTimeRange(e).useState(),s=o.jh.lookupVariable(D,e),r=o.jh.lookupVariable(M,e),i=o.jh.lookupVariable(H,e),d=(l,c,u)=>{const y=`${l}=${c}`;if((0,N.P6)({type:u,key:l,value:c}),u==="stateTo"&&r instanceof o.yP&&r.changeValueTo(c),u==="stateFrom"&&i instanceof o.yP&&i.changeValueTo(c),u==="label"&&s instanceof o.TS){const h=(0,K.EU)(s.state.value.toString(),y);s.setValue(h)}};return r instanceof o.yP&&i instanceof o.yP&&s instanceof o.TS?(0,t.jsx)(oe,{timeRange:n,valueInLabelFilter:s.state.value,addFilter:d,valueInStateToFilter:r.state.value,valueInStateFromFilter:i.state.value}):null}const ce="__history_api_ds_uid__",de="__history_api_ds_pluginId__",at={type:de,uid:ce,settings:void 0};function rt(){const e=(0,j.useMemo)(()=>new it(ce,de),[]);(0,j.useEffect)(()=>{try{o.Go.registerRuntimeDataSource({dataSource:e})}catch{}},[e])}class it extends o.UU{constructor(n,s){super(s,n)}async query(n){const s=n.range.from.unix(),r=n.range.to.unix(),i=n.targets[0],d=(0,U.w)(),l=d.replace(i.labels??"",n.scopedVars),c=d.replace(i.stateTo??"",n.scopedVars),u=d.replace(i.stateFrom??"",n.scopedVars),y=await ot(s,r);return{data:Be(y,{stateTo:c,stateFrom:u,labels:l})}}testDatasource(){return Promise.resolve({status:"success",message:"Data source is working",title:"Success"})}}const ot=(e,n)=>(0,Z.JD)(Y.U.endpoints.getRuleHistory.initiate({from:e,to:n,limit:W},{forceRefetch:!!(0,Q.jG)().getAutoRefreshInteval().interval})).unwrap(),D="LABELS_FILTER",M="STATE_FILTER_TO",H="STATE_FILTER_FROM",x={all:"all",firing:"Alerting",normal:"Normal",pending:"Pending",recovering:"Recovering"},lt=()=>{(0,j.useEffect)(()=>{(0,N.fH)(N.le.loadedCentralAlertStateHistory)},[]),rt();const e=(0,j.useMemo)(()=>{const s=new o.TS({name:D,label:"Labels: "}),r=new o.yP({name:M,value:x.all,label:"End state:",hide:A.zL.dontHide,query:`All : ${x.all}, To Firing : ${x.firing},To Normal : ${x.normal},To Pending : ${x.pending},To Recovering : ${x.recovering}`}),i=new o.yP({name:H,value:x.all,label:"Start state:",hide:A.zL.dontHide,query:`All : ${x.all}, From Firing : ${x.firing},From Normal : ${x.normal},From Pending : ${x.pending},From Recovering : ${x.recovering}`});return new o.P1({controls:[new o.dM({component:mt}),new o.dM({component:ht}),new o.K8({}),new ut({}),new o.N0,new o.KE({}),new o.WM({})],$timeRange:new o.JZ({from:"now-1h",to:"now"}),$variables:new o.Pj({variables:[s,i,r]}),body:new o.G1({direction:"column",children:[dt(),new o.vA({body:new nt({})})]})})},[]);return(0,o.Yg)(e)?(0,t.jsx)(e.Component,{model:e}):null};function ct(){return new o.dt({datasource:at,queries:[{refId:"A",labels:"${LABELS_FILTER}",stateFrom:"${STATE_FILTER_FROM}",stateTo:"${STATE_FILTER_TO}"}]})}function dt(){return new o.vA({minHeight:300,ySizing:"content",body:o.d0.timeseries().setTitle("Alert Events").setDescription("Each alert event represents an alert instance that changed its state at a particular point in time. The history of the data is displayed over a period of time.").setData(ct()).setColor({mode:"continuous-BlPu"}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("drawStyle",T.GR.Bars).setCustomFieldConfig("lineInterpolation",T.dx.Linear).setCustomFieldConfig("lineWidth",1).setCustomFieldConfig("barAlignment",0).setCustomFieldConfig("spanNulls",!1).setCustomFieldConfig("insertNulls",!1).setCustomFieldConfig("showPoints",T.yL.Auto).setCustomFieldConfig("pointSize",5).setCustomFieldConfig("stacking",{mode:T.gs.None,group:"A"}).setCustomFieldConfig("gradientMode",T.on.Hue).setCustomFieldConfig("scaleDistribution",{type:T.L4.Linear}).setOption("legend",{showLegend:!1,displayMode:T.lm.Hidden}).setOption("tooltip",{mode:T.$N.Single}).setNoValue("No events found").build()})}class ut extends o.Bs{constructor(){super(...arguments),this._variableDependency=new o.Sh(this,{variableNames:[D,H,M]})}static{this.Component=gt}}function gt({model:e}){e.useState();const n=o.jh.interpolate(e,"${LABELS_FILTER}"),s=o.jh.interpolate(e,"${STATE_FILTER_TO}"),r=o.jh.interpolate(e,"${STATE_FILTER_FROM}");if(!n&&s===x.all&&r===x.all)return null;const i=()=>{const d=o.jh.lookupVariable(D,e);d instanceof o.TS&&d.setValue("");const l=o.jh.lookupVariable(M,e);l instanceof o.yP&&l.changeValueTo(x.all);const c=o.jh.lookupVariable(H,e);c instanceof o.yP&&c.changeValueTo(x.all)};return(0,t.jsx)(R.m,{content:"Clear filter",children:(0,t.jsx)(w.$n,{variant:"secondary",icon:"times",onClick:i,children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.clear",children:"Clear filters"})})})}const mt=()=>{const e=(0,F.of)(ue);return(0,t.jsx)("div",{className:e.filterLabelContainer,children:(0,t.jsx)(v.E,{variant:"body",weight:"light",color:"secondary",children:(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filterBy",children:"Filter by:"})})})},ht=()=>{const e=(0,F.of)(ue);return(0,t.jsx)("div",{className:e.filterInfoContainer,children:(0,t.jsx)(R.m,{content:(0,t.jsxs)("div",{children:[(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.info.label1",children:"Filter events using label querying without spaces, ex:"}),(0,t.jsx)("pre",{children:'{severity="critical", instance=~"cluster-us-.+"}'}),(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.info.label2",children:"Invalid use of spaces:"}),(0,t.jsx)("pre",{children:'{severity= "critical"}'}),(0,t.jsx)("pre",{children:'{severity ="critical"}'}),(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.info.label3",children:"Valid use of spaces:"}),(0,t.jsx)("pre",{children:'{severity=" critical"}'}),(0,t.jsx)(g.x6,{i18nKey:"alerting.central-alert-history.filter.info.label4",children:"Filter alerts using label querying without braces, ex:"}),(0,t.jsx)("pre",{children:'severity="critical", instance=~"cluster-us-.+"'})]}),children:(0,t.jsx)(I.I,{name:"info-circle",size:"sm"})})})},ue=e=>({filterInfoContainer:(0,m.css)({padding:"0",alignSelf:"center",marginRight:e.spacing(-1)}),filterLabelContainer:(0,m.css)({padding:"0",alignSelf:"center"})});function yt(){return(0,t.jsx)($.d,{navId:"alerts-history",isLoading:!1,children:(0,t.jsx)(lt,{})})}const ft=(0,L.S)(yt)}}]);

//# sourceMappingURL=HistoryPage.cf0bcc28083540617d33.js.map