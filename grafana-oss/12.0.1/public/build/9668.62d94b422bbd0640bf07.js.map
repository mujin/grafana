{"version":3,"file":"9668.62d94b422bbd0640bf07.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/CustomAnnotationHeaderField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/AnnotationHeaderField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/DashboardAnnotationField.tsx","webpack://grafana/./public/app/features/alerting/unified/api/dashboardApi.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/useDashboardQuery.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/DashboardPicker.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/AnnotationsStep.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/NeedHelpInfo.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/RuleEditorSection.tsx","webpack://grafana/./public/app/features/alerting/unified/api/labelsApi.ts","webpack://grafana/./public/app/features/alerting/unified/components/AlertLabelDropdown.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/labels/LabelsButtons.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/labels/LabelsField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/useAlertRuleSuggestions.tsx"],"sourcesContent":["import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Input, useStyles2 } from '@grafana/ui';\nimport { Trans, t } from 'app/core/internationalization';\n\ninterface CustomAnnotationHeaderFieldProps {\n  field: { onChange: () => void; onBlur: () => void; value: string; name: string };\n}\n\nconst CustomAnnotationHeaderField = ({ field }: CustomAnnotationHeaderFieldProps) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div>\n      <span className={styles.annotationTitle}>\n        <Trans i18nKey=\"alerting.custom-annotation-header-field.custom-annotation-name-and-content\">\n          Custom annotation name and content\n        </Trans>\n      </span>\n      <Input\n        placeholder={t(\n          'alerting.custom-annotation-header-field.placeholder-enter-custom-annotation-name',\n          'Enter custom annotation name...'\n        )}\n        width={18}\n        {...field}\n        className={styles.customAnnotationInput}\n      />\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  annotationTitle: css({\n    color: theme.colors.text.primary,\n    marginBottom: '3px',\n  }),\n\n  customAnnotationInput: css({\n    marginTop: '5px',\n    width: '100%',\n  }),\n});\n\nexport default CustomAnnotationHeaderField;\n","import { Controller, FieldArrayWithId, useFormContext } from 'react-hook-form';\n\nimport { Stack, Text } from '@grafana/ui';\n\nimport { RuleFormValues } from '../../types/rule-form';\nimport { Annotation, annotationDescriptions, annotationLabels } from '../../utils/constants';\n\nimport CustomAnnotationHeaderField from './CustomAnnotationHeaderField';\n\nconst AnnotationHeaderField = ({\n  annotationField,\n  annotations,\n  annotation,\n  index,\n  labelId,\n}: {\n  annotationField: FieldArrayWithId<RuleFormValues, 'annotations', 'id'>;\n  annotations: Array<{ key: string; value: string }>;\n  annotation: Annotation;\n  index: number;\n  labelId: string;\n}) => {\n  const { control } = useFormContext<RuleFormValues>();\n\n  return (\n    <Stack direction=\"column\" gap={0}>\n      <label htmlFor={labelId}>\n        {\n          <Controller\n            name={`annotations.${index}.key`}\n            defaultValue={annotationField.key}\n            render={({ field: { ref, ...field } }) => {\n              if (!annotationLabels[annotation]) {\n                return <CustomAnnotationHeaderField field={field} />;\n              }\n\n              let label;\n\n              switch (annotationField.key) {\n                case Annotation.dashboardUID:\n                  label = 'Dashboard and panel';\n                  break;\n                case Annotation.panelID:\n                  label = '';\n                  break;\n                default:\n                  label = annotationLabels[annotation] && annotationLabels[annotation] + ' (optional)';\n              }\n\n              return (\n                <span data-testid={`annotation-key-${index}`}>\n                  <Text color=\"primary\" variant=\"bodySmall\">\n                    {label}\n                  </Text>\n                </span>\n              );\n            }}\n            control={control}\n            rules={{ required: { value: !!annotations[index]?.value, message: 'Required.' } }}\n          />\n        }\n      </label>\n      <Text variant=\"bodySmall\" color=\"secondary\">\n        {annotationDescriptions[annotation]}\n      </Text>\n    </Stack>\n  );\n};\n\nexport default AnnotationHeaderField;\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Icon, useStyles2 } from '@grafana/ui';\nimport { DashboardDataDTO } from 'app/types';\n\nimport { makeDashboardLink, makePanelLink } from '../../utils/misc';\n\nimport { PanelDTO } from './DashboardPicker';\n\nconst DashboardAnnotationField = ({\n  dashboard,\n  panel,\n  dashboardUid,\n  panelId,\n  onEditClick,\n  onDeleteClick,\n}: {\n  dashboard?: DashboardDataDTO;\n  panel?: PanelDTO;\n  dashboardUid: string; //fallback\n  panelId: string; //fallback\n  onEditClick: () => void;\n  onDeleteClick: () => void;\n}) => {\n  const styles = useStyles2(getStyles);\n\n  const dashboardLink = makeDashboardLink(dashboard?.uid || dashboardUid);\n  const panelLink = makePanelLink(dashboard?.uid || dashboardUid, panel?.id?.toString() || panelId);\n  return (\n    <div className={styles.container}>\n      {dashboard && (\n        <a\n          href={dashboardLink}\n          className={styles.link}\n          target=\"_blank\"\n          rel=\"noreferrer\"\n          data-testid=\"dashboard-annotation\"\n        >\n          {dashboard.title} <Icon name={'external-link-alt'} />\n        </a>\n      )}\n\n      {!dashboard && <span className={styles.noLink}>Dashboard {dashboardUid} </span>}\n\n      {panel && (\n        <a href={panelLink} className={styles.link} target=\"_blank\" rel=\"noreferrer\" data-testid=\"panel-annotation\">\n          {panel.title || '<No title>'} <Icon name={'external-link-alt'} />\n        </a>\n      )}\n\n      {!panel && <span className={styles.noLink}> - Panel {panelId}</span>}\n\n      {(dashboard || panel) && (\n        <>\n          <Icon name={'pen'} onClick={onEditClick} className={styles.icon} />\n          <Icon name={'trash-alt'} onClick={onDeleteClick} className={styles.icon} />\n        </>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css({\n    marginTop: '5px',\n  }),\n\n  noLink: css({\n    color: theme.colors.text.secondary,\n  }),\n  link: css({\n    color: theme.colors.text.link,\n    marginRight: theme.spacing(1.5),\n  }),\n\n  icon: css({\n    marginRight: theme.spacing(1),\n    cursor: 'pointer',\n  }),\n});\n\nexport default DashboardAnnotationField;\n","import { DashboardDTO } from '../../../../types';\nimport { DashboardSearchItem } from '../../../search/types';\n\nimport { alertingApi } from './alertingApi';\n\nexport const dashboardApi = alertingApi.injectEndpoints({\n  endpoints: (build) => ({\n    search: build.query<DashboardSearchItem[], { query?: string }>({\n      query: ({ query }) => {\n        const params = new URLSearchParams({ type: 'dash-db', limit: '1000', page: '1', sort: 'name_sort' });\n        if (query) {\n          params.set('query', query);\n        }\n\n        return { url: `/api/search?${params.toString()}` };\n      },\n    }),\n    dashboard: build.query<DashboardDTO, { uid: string }>({\n      query: ({ uid }) => ({ url: `/api/dashboards/uid/${uid}` }),\n    }),\n  }),\n});\n","import memoizeOne from 'memoize-one';\n\nimport { DashboardDTO } from '../../../../../types';\nimport { DashboardModel } from '../../../../dashboard/state/DashboardModel';\nimport { dashboardApi } from '../../api/dashboardApi';\n\nconst convertToDashboardModel = memoizeOne((dashboardDTO: DashboardDTO) => {\n  // RTKQuery freezes all returned objects. DashboardModel constructor runs migrations which might change the internal object\n  // Hence we need to add structuredClone to make a deep copy of the API response object\n  const { dashboard, meta } = structuredClone(dashboardDTO);\n  return new DashboardModel(dashboard, meta);\n});\n\nexport function useDashboardQuery(dashboardUid?: string) {\n  const queryData = dashboardApi.endpoints.dashboard.useQuery(\n    { uid: dashboardUid ?? '' },\n    {\n      skip: !dashboardUid,\n      selectFromResult: ({ currentData, data, ...rest }) => ({\n        dashboardModel: currentData ? convertToDashboardModel(currentData) : undefined,\n        ...rest,\n      }),\n    }\n  );\n\n  return queryData;\n}\n","import { css, cx } from '@emotion/css';\nimport { noop } from 'lodash';\nimport { CSSProperties, useCallback, useMemo, useState } from 'react';\nimport { useDebounce } from 'react-use';\nimport AutoSizer from 'react-virtualized-auto-sizer';\nimport { FixedSizeList } from 'react-window';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport {\n  Alert,\n  Button,\n  FilterInput,\n  Icon,\n  LoadingPlaceholder,\n  Modal,\n  Tooltip,\n  clearButtonStyles,\n  useStyles2,\n} from '@grafana/ui';\nimport { Trans, t } from 'app/core/internationalization';\n\nimport { DashboardModel } from '../../../../dashboard/state/DashboardModel';\nimport { dashboardApi } from '../../api/dashboardApi';\n\nimport { useDashboardQuery } from './useDashboardQuery';\n\nexport interface PanelDTO {\n  id?: number;\n  title?: string;\n  type: string;\n  collapsed?: boolean;\n}\n\nfunction panelSort(a: PanelDTO, b: PanelDTO) {\n  if (a.title && b.title) {\n    return a.title.localeCompare(b.title);\n  }\n  if (a.title && !b.title) {\n    return 1;\n  } else if (!a.title && b.title) {\n    return -1;\n  }\n\n  return 0;\n}\n\ninterface DashboardPickerProps {\n  isOpen: boolean;\n  dashboardUid?: string;\n  panelId?: number;\n  onChange: (dashboardUid: string, panelId: number) => void;\n  onDismiss: () => void;\n}\n\nexport const DashboardPicker = ({ dashboardUid, panelId, isOpen, onChange, onDismiss }: DashboardPickerProps) => {\n  const styles = useStyles2(getPickerStyles);\n\n  const [selectedDashboardUid, setSelectedDashboardUid] = useState(dashboardUid);\n  const [selectedPanelId, setSelectedPanelId] = useState(panelId);\n\n  const [dashboardFilter, setDashboardFilter] = useState('');\n  const [debouncedDashboardFilter, setDebouncedDashboardFilter] = useState('');\n\n  const [panelFilter, setPanelFilter] = useState('');\n  const { useSearchQuery } = dashboardApi;\n\n  const { currentData: filteredDashboards = [], isFetching: isDashSearchFetching } = useSearchQuery({\n    query: debouncedDashboardFilter,\n  });\n  const { dashboardModel, isFetching: isDashboardFetching } = useDashboardQuery(selectedDashboardUid);\n\n  const handleDashboardChange = useCallback((dashboardUid: string) => {\n    setSelectedDashboardUid(dashboardUid);\n    setSelectedPanelId(undefined);\n  }, []);\n\n  const allDashboardPanels = getVisualPanels(dashboardModel);\n\n  const filteredPanels =\n    allDashboardPanels\n      .filter((panel) => panel.title?.toLowerCase().includes(panelFilter.toLowerCase()))\n      .sort(panelSort) ?? [];\n\n  const currentPanel: PanelDTO | undefined = allDashboardPanels.find(\n    (panel: PanelDTO) => isValidPanel(panel) && panel.id?.toString() === selectedPanelId\n  );\n\n  const selectedDashboardIndex = useMemo(() => {\n    return filteredDashboards.map((dashboard) => dashboard.uid).indexOf(selectedDashboardUid ?? '');\n  }, [filteredDashboards, selectedDashboardUid]);\n\n  const isDefaultSelection = dashboardUid && dashboardUid === selectedDashboardUid;\n  const selectedDashboardIsInPageResult = selectedDashboardIndex >= 0;\n\n  const scrollToItem = useCallback(\n    (node: FixedSizeList) => {\n      const canScroll = selectedDashboardIndex >= 0;\n\n      if (isDefaultSelection && canScroll) {\n        node?.scrollToItem(selectedDashboardIndex, 'smart');\n      }\n    },\n    [isDefaultSelection, selectedDashboardIndex]\n  );\n\n  useDebounce(\n    () => {\n      setDebouncedDashboardFilter(dashboardFilter);\n    },\n    500,\n    [dashboardFilter]\n  );\n\n  const DashboardRow = ({ index, style }: { index: number; style?: CSSProperties }) => {\n    const dashboard = filteredDashboards[index];\n    const isSelected = selectedDashboardUid === dashboard.uid;\n\n    return (\n      <button\n        type=\"button\"\n        title={dashboard.title}\n        style={style}\n        className={cx(styles.rowButton, { [styles.rowOdd]: index % 2 === 1, [styles.rowSelected]: isSelected })}\n        onClick={() => handleDashboardChange(dashboard.uid)}\n      >\n        <div className={cx(styles.dashboardTitle, styles.rowButtonTitle)}>{dashboard.title}</div>\n        <div className={styles.dashboardFolder}>\n          <Icon name=\"folder\" /> {dashboard.folderTitle ?? 'Dashboards'}\n        </div>\n      </button>\n    );\n  };\n\n  const PanelRow = ({ index, style }: { index: number; style: CSSProperties }) => {\n    const panel = filteredPanels[index];\n    const panelTitle = panel.title || '<No title>';\n    const isSelected = Boolean(panel.id) && selectedPanelId === panel.id;\n    const isAlertingCompatible = panel.type === 'graph' || panel.type === 'timeseries';\n    const disabled = !isValidPanel(panel);\n\n    return (\n      <button\n        type=\"button\"\n        style={style}\n        disabled={disabled}\n        className={cx(styles.rowButton, styles.panelButton, {\n          [styles.rowOdd]: index % 2 === 1,\n          [styles.rowSelected]: isSelected,\n        })}\n        onClick={() => (disabled ? noop : setSelectedPanelId(panel.id))}\n      >\n        <div className={styles.rowButtonTitle} title={panelTitle}>\n          {panelTitle}\n        </div>\n        {!isAlertingCompatible && !disabled && (\n          <Tooltip content=\"The alert tab and alert annotations are only supported on graph and timeseries panels.\">\n            <Icon name=\"exclamation-triangle\" className={styles.warnIcon} data-testid=\"warning-icon\" />\n          </Tooltip>\n        )}\n        {disabled && (\n          <Tooltip content=\"This panel does not have a valid identifier.\">\n            <Icon name=\"info-circle\" data-testid=\"info-icon\" />\n          </Tooltip>\n        )}\n      </button>\n    );\n  };\n\n  return (\n    <Modal\n      title={t('alerting.dashboard-picker.title-select-dashboard-and-panel', 'Select dashboard and panel')}\n      closeOnEscape\n      isOpen={isOpen}\n      onDismiss={onDismiss}\n      className={styles.modal}\n      contentClassName={styles.modalContent}\n    >\n      {/* This alert shows if the selected dashboard is not found in the first page of dashboards */}\n      {!selectedDashboardIsInPageResult && dashboardUid && dashboardModel && (\n        <Alert\n          title={t('alerting.dashboard-picker.title-current-selection', 'Current selection')}\n          severity=\"info\"\n          topSpacing={0}\n          bottomSpacing={1}\n          className={styles.modalAlert}\n        >\n          <div>\n            Dashboard: {dashboardModel.title} ({dashboardModel.uid}) in folder{' '}\n            {dashboardModel.meta?.folderTitle ?? 'Dashboards'}\n          </div>\n          {currentPanel && (\n            <div>\n              Panel: {currentPanel.title} ({currentPanel.id})\n            </div>\n          )}\n        </Alert>\n      )}\n      <div className={styles.container}>\n        <FilterInput\n          value={dashboardFilter}\n          onChange={setDashboardFilter}\n          title={t('alerting.dashboard-picker.title-search-dashboard', 'Search dashboard')}\n          placeholder={t('alerting.dashboard-picker.placeholder-search-dashboard', 'Search dashboard')}\n          autoFocus\n        />\n        <FilterInput\n          value={panelFilter}\n          onChange={setPanelFilter}\n          title={t('alerting.dashboard-picker.title-search-panel', 'Search panel')}\n          placeholder={t('alerting.dashboard-picker.placeholder-search-panel', 'Search panel')}\n        />\n\n        <div className={styles.column}>\n          {isDashSearchFetching && (\n            <LoadingPlaceholder\n              text={t('alerting.dashboard-picker.text-loading-dashboards', 'Loading dashboards...')}\n              className={styles.loadingPlaceholder}\n            />\n          )}\n\n          {!isDashSearchFetching && (\n            <AutoSizer>\n              {({ height, width }) => (\n                <FixedSizeList\n                  ref={scrollToItem}\n                  itemSize={50}\n                  height={height}\n                  width={width}\n                  itemCount={filteredDashboards.length}\n                >\n                  {DashboardRow}\n                </FixedSizeList>\n              )}\n            </AutoSizer>\n          )}\n        </div>\n\n        <div className={styles.column}>\n          {!selectedDashboardUid && !isDashboardFetching && (\n            <div className={styles.selectDashboardPlaceholder}>\n              <div>\n                <Trans i18nKey=\"alerting.dashboard-picker.select-dashboard-available-panels\">\n                  Select a dashboard to get a list of available panels\n                </Trans>\n              </div>\n            </div>\n          )}\n          {isDashboardFetching && (\n            <LoadingPlaceholder\n              text={t('alerting.dashboard-picker.text-loading-dashboard', 'Loading dashboard...')}\n              className={styles.loadingPlaceholder}\n            />\n          )}\n\n          {selectedDashboardUid && !isDashboardFetching && (\n            <AutoSizer>\n              {({ width, height }) => (\n                <FixedSizeList itemSize={32} height={height} width={width} itemCount={filteredPanels.length}>\n                  {PanelRow}\n                </FixedSizeList>\n              )}\n            </AutoSizer>\n          )}\n        </div>\n      </div>\n      <Modal.ButtonRow>\n        <Button type=\"button\" variant=\"secondary\" onClick={onDismiss} fill=\"text\">\n          <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"primary\"\n          disabled={!(selectedDashboardUid && selectedPanelId)}\n          onClick={() => {\n            if (selectedDashboardUid && selectedPanelId) {\n              onChange(selectedDashboardUid, selectedPanelId);\n            }\n          }}\n        >\n          <Trans i18nKey=\"alerting.dashboard-picker.confirm\">Confirm</Trans>\n        </Button>\n      </Modal.ButtonRow>\n    </Modal>\n  );\n};\n\nexport function getVisualPanels(dashboardModel: DashboardModel | undefined) {\n  if (!dashboardModel) {\n    return [];\n  }\n\n  const panelsWithoutRows = dashboardModel.panels.filter((panel) => panel.type !== 'row');\n  const panelsNestedInRows = dashboardModel.panels\n    .filter((rowPanel) => rowPanel.collapsed)\n    .flatMap((collapsedRow) => collapsedRow.panels ?? []);\n\n  const allDashboardPanels = [...panelsWithoutRows, ...panelsNestedInRows];\n  return allDashboardPanels;\n}\n\nconst isValidPanel = (panel: PanelDTO): boolean => {\n  const hasValidID = typeof panel.id === 'number';\n  const isValidPanelType = typeof panel.type === 'string';\n  const isLibraryPanel = 'libraryPanel' in panel;\n\n  return hasValidID && (isValidPanelType || isLibraryPanel);\n};\n\nconst getPickerStyles = (theme: GrafanaTheme2) => {\n  const clearButton = clearButtonStyles(theme);\n\n  return {\n    container: css({\n      display: 'grid',\n      gridTemplateColumns: '1fr 1fr',\n      gridTemplateRows: 'min-content auto',\n      gap: theme.spacing(2),\n      flex: 1,\n    }),\n    column: css({\n      flex: '1 1 auto',\n    }),\n    dashboardTitle: css({\n      height: '22px',\n      fontWeight: theme.typography.fontWeightBold,\n    }),\n    dashboardFolder: css({\n      height: '20px',\n      fontSize: theme.typography.bodySmall.fontSize,\n      color: theme.colors.text.secondary,\n      display: 'flex',\n      flexDirection: 'row',\n      justifyContent: 'flex-start',\n      columnGap: theme.spacing(1),\n      alignItems: 'center',\n    }),\n    rowButton: css(clearButton, {\n      padding: theme.spacing(0.5),\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      textAlign: 'left',\n      whiteSpace: 'nowrap',\n      cursor: 'pointer',\n      border: '2px solid transparent',\n\n      '&:disabled': {\n        cursor: 'not-allowed',\n        color: theme.colors.text.disabled,\n      },\n    }),\n    rowButtonTitle: css({\n      textOverflow: 'ellipsis',\n      overflow: 'hidden',\n    }),\n    rowSelected: css({\n      borderColor: theme.colors.primary.border,\n    }),\n    rowOdd: css({\n      backgroundColor: theme.colors.background.secondary,\n    }),\n    panelButton: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n      justifyContent: 'space-between',\n      alignItems: 'center',\n    }),\n    loadingPlaceholder: css({\n      height: '100%',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n    }),\n    selectDashboardPlaceholder: css({\n      width: '100%',\n      height: '100%',\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'center',\n      textAlign: 'center',\n      fontWeight: theme.typography.fontWeightBold,\n    }),\n    modal: css({\n      height: '100%',\n    }),\n    modalContent: css({\n      flex: 1,\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    modalAlert: css({\n      flexGrow: 0,\n    }),\n    warnIcon: css({\n      fill: theme.colors.warning.main,\n    }),\n  };\n};\n","import { css, cx } from '@emotion/css';\nimport { produce } from 'immer';\nimport { useEffect, useState } from 'react';\nimport { useFieldArray, useFormContext } from 'react-hook-form';\nimport { useToggle } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, Field, Input, Stack, Text, TextArea, useStyles2 } from '@grafana/ui';\nimport { Trans, t } from 'app/core/internationalization';\n\nimport { DashboardModel } from '../../../../dashboard/state/DashboardModel';\nimport { RuleFormValues } from '../../types/rule-form';\nimport { Annotation, annotationLabels } from '../../utils/constants';\nimport { isGrafanaManagedRuleByType } from '../../utils/rules';\n\nimport AnnotationHeaderField from './AnnotationHeaderField';\nimport DashboardAnnotationField from './DashboardAnnotationField';\nimport { DashboardPicker, PanelDTO, getVisualPanels } from './DashboardPicker';\nimport { NeedHelpInfo } from './NeedHelpInfo';\nimport { RuleEditorSection } from './RuleEditorSection';\nimport { useDashboardQuery } from './useDashboardQuery';\n\nconst AnnotationsStep = () => {\n  const styles = useStyles2(getStyles);\n  const [showPanelSelector, setShowPanelSelector] = useToggle(false);\n\n  const {\n    control,\n    register,\n    watch,\n    formState: { errors },\n    setValue,\n  } = useFormContext<RuleFormValues>();\n  const annotations = watch('annotations');\n  const type = watch('type');\n\n  const { fields, append, remove } = useFieldArray({ control, name: 'annotations' });\n\n  const selectedDashboardUid = annotations.find((annotation) => annotation.key === Annotation.dashboardUID)?.value;\n  const selectedPanelId = Number(annotations.find((annotation) => annotation.key === Annotation.panelID)?.value);\n\n  const [selectedDashboard, setSelectedDashboard] = useState<DashboardModel | undefined>(undefined);\n  const [selectedPanel, setSelectedPanel] = useState<PanelDTO | undefined>(undefined);\n\n  const { dashboardModel, isFetching: isDashboardFetching } = useDashboardQuery(selectedDashboardUid);\n\n  useEffect(() => {\n    if (isDashboardFetching || !dashboardModel) {\n      return;\n    }\n\n    setSelectedDashboard(dashboardModel);\n\n    const allPanels = getVisualPanels(dashboardModel);\n    const currentPanel = allPanels.find((panel) => panel.id === selectedPanelId);\n    setSelectedPanel(currentPanel);\n  }, [selectedPanelId, dashboardModel, isDashboardFetching]);\n\n  const setSelectedDashboardAndPanelId = (dashboardUid: string, panelId: number) => {\n    const updatedAnnotations = produce(annotations, (draft) => {\n      const dashboardAnnotation = draft.find((a) => a.key === Annotation.dashboardUID);\n      const panelAnnotation = draft.find((a) => a.key === Annotation.panelID);\n\n      if (dashboardAnnotation) {\n        dashboardAnnotation.value = dashboardUid;\n      } else {\n        draft.push({ key: Annotation.dashboardUID, value: dashboardUid });\n      }\n\n      if (panelAnnotation) {\n        panelAnnotation.value = panelId.toString();\n      } else {\n        draft.push({ key: Annotation.panelID, value: panelId.toString() });\n      }\n    });\n\n    setValue('annotations', updatedAnnotations);\n    setShowPanelSelector(false);\n  };\n\n  const handleDeleteDashboardAnnotation = () => {\n    const updatedAnnotations = annotations.filter(\n      (a) => a.key !== Annotation.dashboardUID && a.key !== Annotation.panelID\n    );\n    setValue('annotations', updatedAnnotations);\n    setSelectedDashboard(undefined);\n    setSelectedPanel(undefined);\n  };\n\n  const handleEditDashboardAnnotation = () => {\n    setShowPanelSelector(true);\n  };\n\n  function getAnnotationsSectionDescription() {\n    return (\n      <Stack direction=\"row\" gap={0.5} alignItems=\"center\">\n        <Text variant=\"bodySmall\" color=\"secondary\">\n          <Trans i18nKey=\"alerting.annotations.description\">Add more context to your alert notifications.</Trans>\n        </Text>\n        <NeedHelpInfo\n          externalLink={\n            'https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/annotation-label/#annotations'\n          }\n          linkText={`Read about annotations`}\n          contentText={\n            <>\n              <p>\n                {t(\n                  'alerting.rule-form.annotations.description1',\n                  'Annotations add additional information to alerts, helping alert responders identify and address potential issues.'\n                )}\n              </p>\n              <p>\n                {t(\n                  'alerting.rule-form.annotations.description2',\n                  'For example, add a Summary annotation to tell you which value caused the alert to fire or which server it happened on.'\n                )}\n              </p>\n              {t(\n                'alerting.rule-form.annotations.description3',\n                'Annotations can contain a combination of text and template code, which is used to include data from queries.'\n              )}\n            </>\n          }\n          title={t('alerting.annotations-step.get-annotations-section-description.title-annotations', 'Annotations')}\n        />\n      </Stack>\n    );\n  }\n  // when using Grafana managed rules, the annotations step is the 6th step, as we have an additional step for the configure labels and notifications\n  const step = isGrafanaManagedRuleByType(type) ? 6 : 5;\n\n  return (\n    <RuleEditorSection\n      stepNo={step}\n      title={t('alerting.annotations.title', 'Configure notification message')}\n      description={getAnnotationsSectionDescription()}\n      fullWidth\n    >\n      <Stack direction=\"column\" gap={1}>\n        {fields.map((annotationField, index: number) => {\n          const isUrl = annotations[index]?.key?.toLocaleLowerCase().endsWith('url');\n          const ValueInputComponent = isUrl ? Input : TextArea;\n          // eslint-disable-next-line\n          const annotation = annotationField.key as Annotation;\n          return (\n            <div key={annotationField.id} className={styles.flexRow}>\n              <div>\n                <AnnotationHeaderField\n                  annotationField={annotationField}\n                  annotations={annotations}\n                  annotation={annotation}\n                  index={index}\n                  labelId={`annotation-${index}`}\n                />\n                {selectedDashboardUid && selectedPanelId && annotationField.key === Annotation.dashboardUID && (\n                  <DashboardAnnotationField\n                    dashboard={selectedDashboard}\n                    panel={selectedPanel}\n                    dashboardUid={selectedDashboardUid.toString()}\n                    panelId={selectedPanelId.toString()}\n                    onEditClick={handleEditDashboardAnnotation}\n                    onDeleteClick={handleDeleteDashboardAnnotation}\n                  />\n                )}\n\n                {\n                  <div className={styles.annotationValueContainer}>\n                    <Field\n                      hidden={\n                        annotationField.key === Annotation.dashboardUID || annotationField.key === Annotation.panelID\n                      }\n                      className={cx(styles.flexRowItemMargin, styles.field)}\n                      invalid={!!errors.annotations?.[index]?.value?.message}\n                      error={errors.annotations?.[index]?.value?.message}\n                    >\n                      <ValueInputComponent\n                        data-testid={`annotation-value-${index}`}\n                        id={`annotation-${index}`}\n                        className={cx(styles.annotationValueInput, { [styles.textarea]: !isUrl })}\n                        {...register(`annotations.${index}.value`)}\n                        placeholder={\n                          isUrl\n                            ? 'https://'\n                            : (annotationField.key && `Enter a ${annotationField.key}...`) ||\n                              'Enter custom annotation content...'\n                        }\n                        defaultValue={annotationField.value}\n                      />\n                    </Field>\n                    {!annotationLabels[annotation] && (\n                      <Button\n                        type=\"button\"\n                        className={styles.deleteAnnotationButton}\n                        aria-label={t('alerting.annotations-step.aria-label-delete-annotation', 'delete annotation')}\n                        icon=\"trash-alt\"\n                        variant=\"secondary\"\n                        onClick={() => remove(index)}\n                      />\n                    )}\n                  </div>\n                }\n              </div>\n            </div>\n          );\n        })}\n        <Stack direction=\"row\" gap={1}>\n          <div className={styles.addAnnotationsButtonContainer}>\n            <Button\n              icon=\"plus\"\n              type=\"button\"\n              variant=\"secondary\"\n              onClick={() => {\n                append({ key: '', value: '' });\n              }}\n            >\n              <Trans i18nKey=\"alerting.annotations-step.add-custom-annotation\">Add custom annotation</Trans>\n            </Button>\n            {!selectedDashboard && (\n              <Button type=\"button\" variant=\"secondary\" icon=\"dashboard\" onClick={() => setShowPanelSelector(true)}>\n                <Trans i18nKey=\"alerting.annotations-step.link-dashboard-and-panel\">Link dashboard and panel</Trans>\n              </Button>\n            )}\n          </div>\n        </Stack>\n        {showPanelSelector && (\n          <DashboardPicker\n            isOpen={true}\n            dashboardUid={selectedDashboardUid}\n            panelId={selectedPanelId}\n            onChange={setSelectedDashboardAndPanelId}\n            onDismiss={() => setShowPanelSelector(false)}\n          />\n        )}\n      </Stack>\n    </RuleEditorSection>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  annotationValueInput: css({\n    width: '394px',\n  }),\n  textarea: css({\n    height: '76px',\n  }),\n  addAnnotationsButtonContainer: css({\n    marginTop: theme.spacing(1),\n    gap: theme.spacing(1),\n    display: 'flex',\n  }),\n  field: css({\n    marginBottom: theme.spacing(0.5),\n  }),\n  flexRow: css({\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-start',\n  }),\n  flexRowItemMargin: css({\n    marginTop: theme.spacing(1),\n  }),\n  deleteAnnotationButton: css({\n    display: 'inline-block',\n    marginTop: '10px',\n    marginLeft: '10px',\n  }),\n\n  annotationTitle: css({\n    color: theme.colors.text.primary,\n    marginBottom: '3px',\n  }),\n\n  annotationContainer: css({\n    marginTop: '5px',\n  }),\n\n  annotationDescription: css({\n    color: theme.colors.text.secondary,\n  }),\n\n  annotationValueContainer: css({\n    display: 'flex',\n  }),\n});\n\nexport default AnnotationsStep;\n","import { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Icon, Stack, Text, Toggletip, useStyles2 } from '@grafana/ui';\nimport { Trans } from 'app/core/internationalization';\n\ninterface NeedHelpInfoProps {\n  contentText: string | JSX.Element;\n  externalLink?: string;\n  linkText?: string;\n  title?: string;\n}\nexport function NeedHelpInfo({ contentText, externalLink, linkText, title = 'Need help?' }: NeedHelpInfoProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <Toggletip\n      content={<div className={styles.mutedText}>{contentText}</div>}\n      title={\n        <Stack gap={0.5} direction=\"row\" alignItems=\"center\">\n          <Icon name=\"question-circle\" />\n          {title}\n        </Stack>\n      }\n      footer={\n        externalLink ? (\n          <a href={externalLink} target=\"_blank\" rel=\"noreferrer\">\n            <Stack direction=\"row\" gap={0.5} alignItems=\"center\">\n              <Text color=\"link\">\n                {linkText} <Icon size=\"sm\" name=\"external-link-alt\" />\n              </Text>\n            </Stack>\n          </a>\n        ) : undefined\n      }\n      closeButton={true}\n      placement=\"bottom-start\"\n    >\n      <div className={styles.helpInfo}>\n        <Stack direction=\"row\" alignItems=\"center\" gap={0.5}>\n          <Icon name=\"question-circle\" size=\"sm\" />\n          <Text variant=\"bodySmall\" color=\"primary\">\n            <Trans i18nKey=\"alerting.need-help-info.need-help\">Need help?</Trans>\n          </Text>\n        </Stack>\n      </div>\n    </Toggletip>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  mutedText: css({\n    color: theme.colors.text.secondary,\n    fontSize: theme.typography.size.sm,\n  }),\n  helpInfo: css({\n    cursor: 'pointer',\n    textDecoration: 'underline',\n  }),\n});\n","import { css, cx } from '@emotion/css';\nimport * as React from 'react';\nimport { ReactElement } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { FieldSet, InlineSwitch, Stack, Text, useStyles2 } from '@grafana/ui';\nimport { t } from 'app/core/internationalization';\n\nexport interface RuleEditorSectionProps {\n  title: string;\n  stepNo: number;\n  description?: string | ReactElement;\n  fullWidth?: boolean;\n  switchMode?: {\n    isAdvancedMode: boolean;\n    setAdvancedMode: (isAdvanced: boolean) => void;\n  };\n}\n\nexport const RuleEditorSection = ({\n  title,\n  stepNo,\n  children,\n  fullWidth = false,\n  description,\n  switchMode,\n}: React.PropsWithChildren<RuleEditorSectionProps>) => {\n  const styles = useStyles2(getStyles);\n  const AlertRuleSelectors = selectors.components.AlertRules;\n  return (\n    <div className={styles.parent} data-testid={AlertRuleSelectors.step(stepNo.toString())}>\n      <FieldSet\n        className={cx(fullWidth && styles.fullWidth)}\n        label={\n          <Stack direction=\"row\" alignItems=\"center\" justifyContent=\"space-between\">\n            <Text variant=\"h3\">\n              {stepNo}. {title}\n            </Text>\n            {switchMode && (\n              <Text variant=\"bodySmall\">\n                <InlineSwitch\n                  data-testid={AlertRuleSelectors.stepAdvancedModeSwitch(stepNo.toString())}\n                  value={switchMode.isAdvancedMode}\n                  onChange={(event) => {\n                    switchMode.setAdvancedMode(event.currentTarget.checked);\n                  }}\n                  label={t('alerting.rule-editor-section.label-advanced-options', 'Advanced options')}\n                  showLabel\n                  transparent\n                  className={styles.reverse}\n                />\n              </Text>\n            )}\n          </Stack>\n        }\n      >\n        <Stack direction=\"column\">\n          {description && <div className={styles.description}>{description}</div>}\n          {children}\n        </Stack>\n      </FieldSet>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  parent: css({\n    display: 'flex',\n    flexDirection: 'row',\n    border: `solid 1px ${theme.colors.border.weak}`,\n    borderRadius: theme.shape.radius.default,\n    padding: `${theme.spacing(2)} ${theme.spacing(3)}`,\n  }),\n  description: css({\n    marginTop: `-${theme.spacing(2)}`,\n  }),\n  fullWidth: css({\n    width: '100%',\n  }),\n  reverse: css({\n    flexDirection: 'row-reverse',\n    gap: theme.spacing(1),\n  }),\n});\n","import { SupportedPlugin } from '../types/pluginBridges';\n\nimport { alertingApi } from './alertingApi';\n\nexport interface LabelItem {\n  id: string;\n  name: string;\n  prescribed: boolean;\n}\n\nexport interface LabelKeyAndValues {\n  labelKey: LabelItem;\n  values: LabelItem[];\n}\n\nexport const labelsApi = alertingApi.injectEndpoints({\n  endpoints: (build) => ({\n    getLabels: build.query<LabelItem[], void>({\n      query: () => ({\n        url: `/api/plugins/${SupportedPlugin.Labels}/resources/v1/labels/keys`,\n      }),\n      providesTags: ['GrafanaLabels'],\n    }),\n    getLabelValues: build.query<LabelKeyAndValues, { key: string }>({\n      query: ({ key }) => ({\n        url: `/api/plugins/${SupportedPlugin.Labels}/resources/v1/labels/name/${key}`,\n      }),\n      providesTags: ['GrafanaLabels'],\n    }),\n  }),\n});\n","import { css } from '@emotion/css';\nimport { FC, forwardRef } from 'react';\nimport { GroupBase, OptionsOrGroups, createFilter } from 'react-select';\n\nimport { SelectableValue } from '@grafana/data';\nimport { Field, Select, useStyles2 } from '@grafana/ui';\n\nexport interface AlertLabelDropdownProps {\n  onChange: (newValue: SelectableValue<string>) => void;\n  onOpenMenu?: () => void;\n  options: SelectableValue[];\n  defaultValue?: SelectableValue;\n  type: 'key' | 'value';\n}\nconst _customFilter = createFilter({ ignoreCase: false });\nfunction customFilter(opt: SelectableValue, searchQuery: string) {\n  return _customFilter(\n    {\n      label: opt.label ?? '',\n      value: opt.value ?? '',\n      data: {},\n    },\n    searchQuery\n  );\n}\n\nconst handleIsValidNewOption = (\n  inputValue: string,\n  _: SelectableValue<string> | null,\n  options: OptionsOrGroups<SelectableValue<string>, GroupBase<SelectableValue<string>>>\n) => {\n  const exactValueExists = options.some((el) => el.label === inputValue);\n  const valueIsNotEmpty = inputValue.trim().length;\n  return !Boolean(exactValueExists) && Boolean(valueIsNotEmpty);\n};\n\nconst AlertLabelDropdown: FC<AlertLabelDropdownProps> = forwardRef<HTMLDivElement, AlertLabelDropdownProps>(\n  function LabelPicker({ onChange, options, defaultValue, type, onOpenMenu = () => {} }, ref) {\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div ref={ref}>\n        <Field disabled={false} data-testid={`alertlabel-${type}-picker`} className={styles.resetMargin}>\n          <Select<string>\n            placeholder={`Choose ${type}`}\n            width={29}\n            className=\"ds-picker select-container\"\n            backspaceRemovesValue={false}\n            onChange={onChange}\n            onOpenMenu={onOpenMenu}\n            filterOption={customFilter}\n            isValidNewOption={handleIsValidNewOption}\n            options={options}\n            maxMenuHeight={500}\n            noOptionsMessage=\"No labels found\"\n            defaultValue={defaultValue}\n            allowCustomValue\n          />\n        </Field>\n      </div>\n    );\n  }\n);\n\nconst getStyles = () => ({\n  resetMargin: css({ marginBottom: 0 }),\n});\n\nexport default AlertLabelDropdown;\n","import { UseFieldArrayRemove } from 'react-hook-form';\n\nimport { Button } from '@grafana/ui';\nimport { Trans, t } from 'app/core/internationalization';\n\ninterface RemoveButtonProps {\n  remove: UseFieldArrayRemove;\n  index: number;\n}\nexport function RemoveButton({ remove, index }: RemoveButtonProps) {\n  return (\n    <Button\n      aria-label={t('alerting.remove-button.aria-label-delete-label', 'delete label')}\n      icon=\"trash-alt\"\n      data-testid={`delete-label-${index}`}\n      variant=\"secondary\"\n      onClick={() => {\n        remove(index);\n      }}\n    />\n  );\n}\n\ninterface AddButtonProps {\n  append: () => void;\n}\nexport function AddButton({ append }: AddButtonProps) {\n  return (\n    <Button icon=\"plus\" type=\"button\" variant=\"secondary\" onClick={append}>\n      <Trans i18nKey=\"alerting.add-button.add-more\">Add more</Trans>\n    </Button>\n  );\n}\n","import { css, cx } from '@emotion/css';\nimport { FC, useCallback, useMemo, useState } from 'react';\nimport { Controller, FormProvider, useFieldArray, useForm, useFormContext } from 'react-hook-form';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Button, Field, InlineLabel, Input, LoadingPlaceholder, Space, Stack, Text, useStyles2 } from '@grafana/ui';\nimport { Trans, t } from 'app/core/internationalization';\n\nimport { labelsApi } from '../../../api/labelsApi';\nimport { usePluginBridge } from '../../../hooks/usePluginBridge';\nimport { SupportedPlugin } from '../../../types/pluginBridges';\nimport { KBObjectArray, RuleFormType, RuleFormValues } from '../../../types/rule-form';\nimport { isPrivateLabelKey } from '../../../utils/labels';\nimport { isRecordingRuleByType } from '../../../utils/rules';\nimport AlertLabelDropdown from '../../AlertLabelDropdown';\nimport { AlertLabels } from '../../AlertLabels';\nimport { NeedHelpInfo } from '../NeedHelpInfo';\nimport { useGetLabelsFromDataSourceName } from '../useAlertRuleSuggestions';\n\nimport { AddButton, RemoveButton } from './LabelsButtons';\n\nconst useGetOpsLabelsKeys = (skip: boolean) => {\n  const { currentData, isLoading: isloadingLabels } = labelsApi.endpoints.getLabels.useQuery(undefined, {\n    skip,\n  });\n  return { loading: isloadingLabels, labelsOpsKeys: currentData };\n};\n\nfunction mapLabelsToOptions(\n  items: Iterable<string> = [],\n  labelsInSubForm?: Array<{ key: string; value: string }>\n): Array<SelectableValue<string>> {\n  const existingKeys = new Set(labelsInSubForm ? labelsInSubForm.map((label) => label.key) : []);\n  return Array.from(items, (item) => ({ label: item, value: item, isDisabled: existingKeys.has(item) }));\n}\n\nexport interface LabelsInRuleProps {\n  labels: Array<{ key: string; value: string }>;\n}\n\nexport const LabelsInRule = ({ labels }: LabelsInRuleProps) => {\n  const labelsObj: Record<string, string> = labels.reduce((acc: Record<string, string>, label) => {\n    if (label.key) {\n      acc[label.key] = label.value;\n    }\n    return acc;\n  }, {});\n\n  return <AlertLabels labels={labelsObj} />;\n};\n\nexport type LabelsSubformValues = {\n  labelsInSubform: Array<{ key: string; value: string }>;\n};\n\nexport interface LabelsSubFormProps {\n  dataSourceName: string;\n  initialLabels: Array<{ key: string; value: string }>;\n  onClose: (labelsToUodate?: KBObjectArray) => void;\n}\n\nexport function LabelsSubForm({ dataSourceName, onClose, initialLabels }: LabelsSubFormProps) {\n  const styles = useStyles2(getStyles);\n  const { watch } = useFormContext<RuleFormValues>();\n  const type = watch('type') ?? RuleFormType.grafana;\n\n  const onSave = (labels: LabelsSubformValues) => {\n    onClose(labels.labelsInSubform);\n  };\n  const onCancel = () => {\n    onClose();\n  };\n  // default values for the subform are the initial labels\n  const defaultValues: LabelsSubformValues = useMemo(() => {\n    return { labelsInSubform: initialLabels };\n  }, [initialLabels]);\n\n  const formAPI = useForm<LabelsSubformValues>({ defaultValues });\n  return (\n    <FormProvider {...formAPI}>\n      <form onSubmit={formAPI.handleSubmit(onSave)}>\n        <Stack direction=\"column\" gap={4}>\n          <Text>{getLabelText(type)}</Text>\n          <Stack direction=\"column\" gap={1}>\n            <LabelsWithSuggestions dataSourceName={dataSourceName} />\n            <Space v={2} />\n            <LabelsInRule labels={formAPI.watch('labelsInSubform')} />\n            <Space v={1} />\n            <div className={styles.confirmButton}>\n              <Button type=\"button\" variant=\"secondary\" onClick={onCancel}>\n                <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n              </Button>\n              <Button type=\"submit\">\n                <Trans i18nKey=\"alerting.labels-sub-form.save\">Save</Trans>\n              </Button>\n            </div>\n          </Stack>\n        </Stack>\n      </form>\n    </FormProvider>\n  );\n}\n\nconst isKeyAllowed = (labelKey: string) => !isPrivateLabelKey(labelKey);\n\nexport function useCombinedLabels(\n  dataSourceName: string,\n  labelsPluginInstalled: boolean,\n  loadingLabelsPlugin: boolean,\n  labelsInSubform: Array<{ key: string; value: string }>,\n  selectedKey: string\n) {\n  // ------- Get labels keys and their values from existing alerts\n  const { labels: labelsByKeyFromExisingAlerts, isLoading } = useGetLabelsFromDataSourceName(dataSourceName);\n  // ------- Get only the keys from the ops labels, as we will fetch the values for the keys once the key is selected.\n  const { loading: isLoadingLabels, labelsOpsKeys = [] } = useGetOpsLabelsKeys(\n    !labelsPluginInstalled || loadingLabelsPlugin\n  );\n  //------ Convert the labelsOpsKeys to the same format as the labelsByKeyFromExisingAlerts\n  const labelsByKeyOps = useMemo(() => {\n    return labelsOpsKeys.reduce((acc: Record<string, Set<string>>, label) => {\n      acc[label.name] = new Set();\n      return acc;\n    }, {});\n  }, [labelsOpsKeys]);\n\n  //------- Convert the keys from the ops labels to options for the dropdown\n  const keysFromGopsLabels = useMemo(() => {\n    return mapLabelsToOptions(Object.keys(labelsByKeyOps).filter(isKeyAllowed), labelsInSubform);\n  }, [labelsByKeyOps, labelsInSubform]);\n\n  //------- Convert the keys from the existing alerts to options for the dropdown\n  const keysFromExistingAlerts = useMemo(() => {\n    return mapLabelsToOptions(Array.from(labelsByKeyFromExisingAlerts.keys()).filter(isKeyAllowed), labelsInSubform);\n  }, [labelsByKeyFromExisingAlerts, labelsInSubform]);\n\n  // create two groups of labels, one for ops and one for custom\n  const groupedOptions = [\n    {\n      label: 'From alerts',\n      options: keysFromExistingAlerts,\n      expanded: true,\n    },\n    {\n      label: 'From system',\n      options: keysFromGopsLabels,\n      expanded: true,\n    },\n  ];\n\n  const selectedKeyIsFromAlerts = labelsByKeyFromExisingAlerts.has(selectedKey);\n  const selectedKeyIsFromOps = labelsByKeyOps[selectedKey] !== undefined && labelsByKeyOps[selectedKey]?.size > 0;\n  const selectedKeyDoesNotExist = !selectedKeyIsFromAlerts && !selectedKeyIsFromOps;\n\n  const valuesAlreadyFetched = !selectedKeyIsFromAlerts && labelsByKeyOps[selectedKey]?.size > 0;\n\n  // Only fetch the values for the selected key if it is from ops and the values are not already fetched (the selected key is not in the labelsByKeyOps object)\n  const {\n    currentData: valuesData,\n    isLoading: isLoadingValues = false,\n    error,\n  } = labelsApi.endpoints.getLabelValues.useQuery(\n    { key: selectedKey },\n    {\n      skip:\n        !labelsPluginInstalled ||\n        !selectedKey ||\n        selectedKeyIsFromAlerts ||\n        valuesAlreadyFetched ||\n        selectedKeyDoesNotExist,\n    }\n  );\n\n  // these are the values for the selected key in case it is from ops\n  const valuesFromSelectedGopsKey = useMemo(() => {\n    // if it is from alerts, we need to fetch the values from the existing alerts\n    if (selectedKeyIsFromAlerts) {\n      return [];\n    }\n    // in case of a label from ops, we need to fetch the values from the plugin\n    // fetch values from ops only if there is no value for the key\n    const valuesForSelectedKey = labelsByKeyOps[selectedKey];\n    const valuesAlreadyFetched = valuesForSelectedKey?.size > 0;\n    if (valuesAlreadyFetched) {\n      return mapLabelsToOptions(valuesForSelectedKey);\n    }\n    if (!isLoadingValues && valuesData?.values?.length && !error) {\n      const values = valuesData?.values.map((value) => value.name);\n      labelsByKeyOps[selectedKey] = new Set(values);\n      return mapLabelsToOptions(values);\n    }\n    return [];\n  }, [selectedKeyIsFromAlerts, labelsByKeyOps, selectedKey, isLoadingValues, valuesData, error]);\n\n  const getValuesForLabel = useCallback(\n    (key: string) => {\n      if (!isKeyAllowed(key)) {\n        return [];\n      }\n\n      // values from existing alerts will take precedence over values from ops\n      if (selectedKeyIsFromAlerts || !labelsPluginInstalled) {\n        return mapLabelsToOptions(labelsByKeyFromExisingAlerts.get(key));\n      }\n      return valuesFromSelectedGopsKey;\n    },\n    [labelsByKeyFromExisingAlerts, labelsPluginInstalled, valuesFromSelectedGopsKey, selectedKeyIsFromAlerts]\n  );\n\n  return {\n    loading: isLoading || isLoadingLabels,\n    keysFromExistingAlerts,\n    groupedOptions,\n    getValuesForLabel,\n  };\n}\n\n/*\n  We will suggest labels from two sources: existing alerts and ops labels.\n  We only will suggest labels from ops if the grafana-labels-app plugin is installed\n  This component is only used by the alert rule form.\n  */\nexport interface LabelsWithSuggestionsProps {\n  dataSourceName: string;\n}\n\nexport function LabelsWithSuggestions({ dataSourceName }: LabelsWithSuggestionsProps) {\n  const styles = useStyles2(getStyles);\n  const {\n    control,\n    watch,\n    formState: { errors },\n  } = useFormContext<LabelsSubformValues>();\n\n  const labelsInSubform = watch('labelsInSubform');\n  const { fields, remove, append } = useFieldArray({ control, name: 'labelsInSubform' });\n  const appendLabel = useCallback(() => {\n    append({ key: '', value: '' });\n  }, [append]);\n\n  // check if the labels plugin is installed\n  const { installed: labelsPluginInstalled = false, loading: loadingLabelsPlugin } = usePluginBridge(\n    SupportedPlugin.Labels\n  );\n  const [selectedKey, setSelectedKey] = useState('');\n\n  const { loading, keysFromExistingAlerts, groupedOptions, getValuesForLabel } = useCombinedLabels(\n    dataSourceName,\n    labelsPluginInstalled,\n    loadingLabelsPlugin,\n    labelsInSubform,\n    selectedKey\n  );\n\n  const values = useMemo(() => {\n    return getValuesForLabel(selectedKey);\n  }, [selectedKey, getValuesForLabel]);\n\n  const isLoading = loading || loadingLabelsPlugin;\n\n  return (\n    <>\n      {isLoading && (\n        <LoadingPlaceholder\n          text={t('alerting.labels-with-suggestions.text-loading-existing-labels', 'Loading existing labels')}\n        />\n      )}\n      {!isLoading && (\n        <Stack direction=\"column\" gap={1} alignItems=\"flex-start\">\n          {fields.map((field, index) => {\n            return (\n              <div key={field.id} className={cx(styles.flexRow, styles.centerAlignRow)}>\n                <Field\n                  className={styles.labelInput}\n                  invalid={Boolean(errors.labelsInSubform?.[index]?.key?.message)}\n                  error={errors.labelsInSubform?.[index]?.key?.message}\n                  data-testid={`labelsInSubform-key-${index}`}\n                >\n                  <Controller\n                    name={`labelsInSubform.${index}.key`}\n                    control={control}\n                    rules={{ required: Boolean(labelsInSubform[index]?.value) ? 'Required.' : false }}\n                    render={({ field: { onChange, ref, ...rest } }) => {\n                      return (\n                        <AlertLabelDropdown\n                          {...rest}\n                          defaultValue={field.key ? { label: field.key, value: field.key } : undefined}\n                          options={labelsPluginInstalled ? groupedOptions : keysFromExistingAlerts}\n                          onChange={(newValue: SelectableValue) => {\n                            onChange(newValue.value);\n                            setSelectedKey(newValue.value);\n                          }}\n                          type=\"key\"\n                        />\n                      );\n                    }}\n                  />\n                </Field>\n                <InlineLabel className={styles.equalSign}>=</InlineLabel>\n                <Field\n                  className={styles.labelInput}\n                  invalid={Boolean(errors.labelsInSubform?.[index]?.value?.message)}\n                  error={errors.labelsInSubform?.[index]?.value?.message}\n                  data-testid={`labelsInSubform-value-${index}`}\n                >\n                  <Controller\n                    control={control}\n                    name={`labelsInSubform.${index}.value`}\n                    rules={{ required: Boolean(labelsInSubform[index]?.value) ? 'Required.' : false }}\n                    render={({ field: { onChange, ref, ...rest } }) => {\n                      return (\n                        <AlertLabelDropdown\n                          {...rest}\n                          defaultValue={field.value ? { label: field.value, value: field.value } : undefined}\n                          options={values}\n                          onChange={(newValue: SelectableValue) => {\n                            onChange(newValue.value);\n                          }}\n                          onOpenMenu={() => {\n                            setSelectedKey(labelsInSubform[index].key);\n                          }}\n                          type=\"value\"\n                        />\n                      );\n                    }}\n                  />\n                </Field>\n\n                <RemoveButton index={index} remove={remove} />\n              </div>\n            );\n          })}\n          <AddButton append={appendLabel} />\n        </Stack>\n      )}\n    </>\n  );\n}\n\nexport const LabelsWithoutSuggestions: FC = () => {\n  const styles = useStyles2(getStyles);\n  const {\n    register,\n    control,\n    watch,\n    formState: { errors },\n  } = useFormContext<RuleFormValues>();\n\n  const labels = watch('labels');\n  const { fields, remove, append } = useFieldArray({ control, name: 'labels' });\n  const appendLabel = useCallback(() => {\n    append({ key: '', value: '' });\n  }, [append]);\n\n  return (\n    <>\n      {fields.map((field, index) => {\n        return (\n          <div key={field.id}>\n            <div className={cx(styles.flexRow, styles.centerAlignRow)} data-testid=\"alertlabel-input-wrapper\">\n              <Field\n                className={styles.labelInput}\n                invalid={!!errors.labels?.[index]?.key?.message}\n                error={errors.labels?.[index]?.key?.message}\n              >\n                <Input\n                  {...register(`labels.${index}.key`, {\n                    required: { value: !!labels[index]?.value, message: 'Required.' },\n                  })}\n                  placeholder={t('alerting.labels-without-suggestions.placeholder-key', 'key')}\n                  data-testid={`label-key-${index}`}\n                  defaultValue={field.key}\n                />\n              </Field>\n              <InlineLabel className={styles.equalSign}>=</InlineLabel>\n              <Field\n                className={styles.labelInput}\n                invalid={!!errors.labels?.[index]?.value?.message}\n                error={errors.labels?.[index]?.value?.message}\n              >\n                <Input\n                  {...register(`labels.${index}.value`, {\n                    required: { value: !!labels[index]?.key, message: 'Required.' },\n                  })}\n                  placeholder={t('alerting.labels-without-suggestions.placeholder-value', 'value')}\n                  data-testid={`label-value-${index}`}\n                  defaultValue={field.value}\n                />\n              </Field>\n              <RemoveButton index={index} remove={remove} />\n            </div>\n          </div>\n        );\n      })}\n      <AddButton append={appendLabel} />\n    </>\n  );\n};\n\nfunction LabelsField() {\n  const { watch } = useFormContext<RuleFormValues>();\n  const type = watch('type') ?? RuleFormType.grafana;\n\n  return (\n    <div>\n      <Stack direction=\"column\" gap={1}>\n        <Text element=\"h5\">\n          <Trans i18nKey=\"alerting.labels-field.labels\">Labels</Trans>\n        </Text>\n        <Stack direction={'row'} gap={1}>\n          <Text variant=\"bodySmall\" color=\"secondary\">\n            {getLabelText(type)}\n          </Text>\n          <NeedHelpInfo\n            externalLink={'https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/annotation-label/'}\n            linkText={`Read about labels`}\n            contentText=\"The dropdown only displays labels that you have previously used for alerts.\n            Select a label from the options below or type in a new one.\"\n            title={t('alerting.labels-field.title-labels', 'Labels')}\n          />\n        </Stack>\n      </Stack>\n      <LabelsWithoutSuggestions />\n    </div>\n  );\n}\n\nfunction getLabelText(type: RuleFormType) {\n  const isRecordingRule = type ? isRecordingRuleByType(type) : false;\n  const text = isRecordingRule\n    ? t('alerting.alertform.labels.recording', 'Add labels to your rule.')\n    : t(\n        'alerting.alertform.labels.alerting',\n        'Add labels to your rule for searching, silencing, or routing to a notification policy.'\n      );\n  return text;\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    flexColumn: css({\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    flexRow: css({\n      display: 'flex',\n      flexDirection: 'row',\n      justifyContent: 'flex-start',\n    }),\n    centerAlignRow: css({\n      alignItems: 'center',\n      gap: theme.spacing(0.5),\n    }),\n    equalSign: css({\n      alignSelf: 'flex-start',\n      width: '28px',\n      justifyContent: 'center',\n      margin: 0,\n    }),\n    labelInput: css({\n      width: '175px',\n      margin: 0,\n    }),\n    confirmButton: css({\n      display: 'flex',\n      flexDirection: 'row',\n      gap: theme.spacing(1),\n      marginLeft: 'auto',\n    }),\n  };\n};\n\nexport default LabelsField;\n","import { skipToken } from '@reduxjs/toolkit/query';\nimport { useEffect, useMemo } from 'react';\n\nimport { RuleNamespace } from 'app/types/unified-alerting';\nimport { RulerRulesConfigDTO } from 'app/types/unified-alerting-dto';\n\nimport { alertRuleApi } from '../../api/alertRuleApi';\nimport { featureDiscoveryApi } from '../../api/featureDiscoveryApi';\nimport { shouldUsePrometheusRulesPrimary } from '../../featureToggles';\n\nconst { usePrometheusRuleNamespacesQuery, useLazyRulerRulesQuery, useRulerRulesQuery } = alertRuleApi;\nconst { useDiscoverDsFeaturesQuery } = featureDiscoveryApi;\n\nconst prometheusRulesPrimary = shouldUsePrometheusRulesPrimary();\nconst emptyRulerConfig: RulerRulesConfigDTO = {};\n\nexport function useGetLabelsFromDataSourceName(rulesSourceName: string) {\n  const { data: features, isLoading: isFeaturesLoading } = useDiscoverDsFeaturesQuery({ rulesSourceName });\n\n  // emptyRulerConfig is used to prevent from triggering  labels' useMemo all the time\n  // rulerRules = {} creates a new object and triggers useMemo to recalculate labels\n  const [fetchRulerRules, { data: rulerRules = emptyRulerConfig, isLoading: isRulerRulesLoading }] =\n    useLazyRulerRulesQuery();\n\n  const { data: promNamespaces = [], isLoading: isPrometheusRulesLoading } = usePrometheusRuleNamespacesQuery(\n    { ruleSourceName: rulesSourceName },\n    { skip: !prometheusRulesPrimary }\n  );\n\n  useEffect(() => {\n    if (features?.rulerConfig && !prometheusRulesPrimary) {\n      fetchRulerRules({ rulerConfig: features.rulerConfig });\n    }\n  }, [features?.rulerConfig, fetchRulerRules]);\n\n  const labels = useMemo(() => {\n    if (isPrometheusRulesLoading || isRulerRulesLoading) {\n      return new Map<string, Set<string>>();\n    }\n\n    if (prometheusRulesPrimary) {\n      return promNamespacesToLabels(promNamespaces);\n    }\n\n    return rulerRulesToLabels(rulerRules);\n  }, [promNamespaces, rulerRules, isPrometheusRulesLoading, isRulerRulesLoading]);\n\n  return { labels, isLoading: isPrometheusRulesLoading || isRulerRulesLoading || isFeaturesLoading };\n}\n\nexport function useGetNameSpacesByDatasourceName(rulesSourceName?: string) {\n  const { data: features, isLoading: isFeaturesLoading } = useDiscoverDsFeaturesQuery(\n    rulesSourceName ? { rulesSourceName } : skipToken,\n    { skip: !rulesSourceName }\n  );\n\n  // emptyRulerConfig is used to prevent from triggering  labels' useMemo all the time\n  // rulerRules = {} creates a new object and triggers useMemo to recalculate labels\n  const [fetchRulerRules, { data: rulerRules = emptyRulerConfig, isLoading: isRulerRulesLoading }] =\n    useLazyRulerRulesQuery();\n\n  const { data: promNamespaces = [], isLoading: isPrometheusRulesLoading } = usePrometheusRuleNamespacesQuery(\n    rulesSourceName && prometheusRulesPrimary ? { ruleSourceName: rulesSourceName } : skipToken\n  );\n\n  useEffect(() => {\n    if (features?.rulerConfig && !prometheusRulesPrimary) {\n      fetchRulerRules({ rulerConfig: features.rulerConfig });\n    }\n  }, [features?.rulerConfig, fetchRulerRules]);\n\n  const namespaceGroups = useMemo(() => {\n    if (isPrometheusRulesLoading || isRulerRulesLoading) {\n      return new Map<string, string[]>();\n    }\n\n    if (prometheusRulesPrimary) {\n      return promNamespacesToNamespaceGroups(promNamespaces);\n    }\n\n    return rulerRulesToNamespaceGroups(rulerRules);\n  }, [promNamespaces, rulerRules, isPrometheusRulesLoading, isRulerRulesLoading]);\n\n  return {\n    namespaceGroups,\n    isLoading: isPrometheusRulesLoading || isRulerRulesLoading || isFeaturesLoading,\n    promNamespaces,\n  };\n}\n\nexport function useGetRulerRules(\n  /** Rules source name to fetch namespaces from */\n  rulesSourceName?: string\n) {\n  const { data: features, isLoading: isFeaturesLoading } = useDiscoverDsFeaturesQuery(\n    rulesSourceName ? { rulesSourceName } : skipToken\n  );\n\n  const { data: rulerRules = emptyRulerConfig, isLoading: isRulerRulesLoading } = useRulerRulesQuery(\n    features?.rulerConfig ? { rulerConfig: features.rulerConfig } : skipToken\n  );\n\n  return {\n    isLoading: isRulerRulesLoading || isFeaturesLoading,\n    rulerRules,\n  };\n}\n\nfunction promNamespacesToNamespaceGroups(promNamespaces: RuleNamespace[]) {\n  const groups = new Map<string, string[]>();\n  promNamespaces.forEach((namespace) => {\n    groups.set(\n      namespace.name,\n      namespace.groups.map((group) => group.name)\n    );\n  });\n  return groups;\n}\n\nexport function rulerRulesToNamespaceGroups(rulerConfig: RulerRulesConfigDTO) {\n  const result = new Map<string, string[]>();\n  Object.entries(rulerConfig).forEach(([namespace, groups]) => {\n    result.set(\n      namespace,\n      groups.map((group) => group.name)\n    );\n  });\n  return result;\n}\n\nfunction promNamespacesToLabels(promNamespace: RuleNamespace[]) {\n  const rules = promNamespace.flatMap((namespace) => namespace.groups).flatMap((group) => group.rules);\n\n  return rules.reduce((result, rule) => {\n    if (!rule.labels) {\n      return result;\n    }\n\n    Object.entries(rule.labels).forEach(([labelKey, labelValue]) => {\n      if (!labelKey || !labelValue) {\n        return;\n      }\n\n      const labelEntry = result.get(labelKey);\n      if (labelEntry) {\n        labelEntry.add(labelValue);\n      } else {\n        result.set(labelKey, new Set([labelValue]));\n      }\n    });\n    return result;\n  }, new Map<string, Set<string>>());\n}\n\nfunction rulerRulesToLabels(rulerConfig: RulerRulesConfigDTO) {\n  const result = new Map<string, Set<string>>();\n\n  const rules = Object.entries(rulerConfig)\n    .flatMap(([_, groups]) => groups)\n    .flatMap((group) => group.rules);\n\n  return rules.reduce((result, rule) => {\n    if (!rule.labels) {\n      return result;\n    }\n\n    Object.entries(rule.labels).forEach(([labelKey, labelValue]) => {\n      if (!labelKey || !labelValue) {\n        return;\n      }\n\n      const labelEntry = result.get(labelKey);\n      if (labelEntry) {\n        labelEntry.add(labelValue);\n      } else {\n        result.set(labelKey, new Set([labelValue]));\n      }\n    });\n    return result;\n  }, result);\n}\n"],"names":["CustomAnnotationHeaderField","field","styles","getStyles","Input","theme","annotationField","annotations","annotation","index","labelId","control","Stack","ref","label","Text","DashboardAnnotationField","dashboard","panel","dashboardUid","panelId","onEditClick","onDeleteClick","dashboardLink","panelLink","Icon","dashboardApi","alertingApi","build","query","params","uid","convertToDashboardModel","dashboardDTO","meta","DashboardModel","useDashboardQuery","currentData","data","rest","panelSort","a","b","DashboardPicker","isOpen","onChange","onDismiss","getPickerStyles","selectedDashboardUid","setSelectedDashboardUid","selectedPanelId","setSelectedPanelId","dashboardFilter","setDashboardFilter","debouncedDashboardFilter","setDebouncedDashboardFilter","panelFilter","setPanelFilter","useSearchQuery","filteredDashboards","isDashSearchFetching","dashboardModel","isDashboardFetching","handleDashboardChange","allDashboardPanels","getVisualPanels","filteredPanels","currentPanel","isValidPanel","selectedDashboardIndex","isDefaultSelection","selectedDashboardIsInPageResult","scrollToItem","node","canScroll","useDebounce","DashboardRow","style","isSelected","PanelRow","panelTitle","isAlertingCompatible","disabled","Tooltip","Modal","Alert","FilterInput","LoadingPlaceholder","height","width","Button","panelsWithoutRows","panelsNestedInRows","rowPanel","collapsedRow","hasValidID","isValidPanelType","isLibraryPanel","clearButton","AnnotationsStep","showPanelSelector","setShowPanelSelector","useToggle","register","watch","errors","setValue","type","fields","append","remove","selectedDashboard","setSelectedDashboard","selectedPanel","setSelectedPanel","setSelectedDashboardAndPanelId","updatedAnnotations","draft","dashboardAnnotation","panelAnnotation","handleDeleteDashboardAnnotation","handleEditDashboardAnnotation","getAnnotationsSectionDescription","NeedHelpInfo","step","RuleEditorSection","isUrl","ValueInputComponent","TextArea","Field","contentText","externalLink","linkText","title","stepNo","children","fullWidth","description","switchMode","AlertRuleSelectors","event","labelsApi","key","_customFilter","customFilter","opt","searchQuery","handleIsValidNewOption","inputValue","_","options","exactValueExists","el","valueIsNotEmpty","AlertLabelDropdown","defaultValue","onOpenMenu","Select","RemoveButton","AddButton","useGetOpsLabelsKeys","skip","isloadingLabels","mapLabelsToOptions","items","labelsInSubForm","existingKeys","item","LabelsInRule","labels","labelsObj","acc","AlertLabels","LabelsSubForm","dataSourceName","onClose","initialLabels","onSave","onCancel","defaultValues","formAPI","getLabelText","LabelsWithSuggestions","Space","isKeyAllowed","labelKey","useCombinedLabels","labelsPluginInstalled","loadingLabelsPlugin","labelsInSubform","selectedKey","labelsByKeyFromExisingAlerts","isLoading","isLoadingLabels","labelsOpsKeys","labelsByKeyOps","keysFromGopsLabels","keysFromExistingAlerts","groupedOptions","selectedKeyIsFromAlerts","selectedKeyIsFromOps","selectedKeyDoesNotExist","valuesAlreadyFetched","valuesData","isLoadingValues","error","valuesFromSelectedGopsKey","valuesForSelectedKey","values","value","getValuesForLabel","appendLabel","usePluginBridge","setSelectedKey","loading","newValue","InlineLabel","LabelsWithoutSuggestions","LabelsField","usePrometheusRuleNamespacesQuery","useLazyRulerRulesQuery","useRulerRulesQuery","useDiscoverDsFeaturesQuery","prometheusRulesPrimary","emptyRulerConfig","useGetLabelsFromDataSourceName","rulesSourceName","features","isFeaturesLoading","fetchRulerRules","rulerRules","isRulerRulesLoading","promNamespaces","isPrometheusRulesLoading","promNamespacesToLabels","rulerRulesToLabels","useGetNameSpacesByDatasourceName","promNamespacesToNamespaceGroups","rulerRulesToNamespaceGroups","useGetRulerRules","groups","namespace","group","rulerConfig","result","promNamespace","rule","labelValue","labelEntry"],"sourceRoot":""}