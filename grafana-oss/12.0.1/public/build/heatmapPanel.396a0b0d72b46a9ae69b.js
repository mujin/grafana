"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5857],{20276:(Re,pe,l)=>{l.d(pe,{w:()=>_});var m=l(74848),I=l(22803),J=l(96540),le=l(63142);const ve=10,_=({colorPalette:S,min:H,max:L,display:R,hoverValue:B,useStopsPercentage:M})=>{const[w,V]=(0,J.useState)([]),[O,b]=(0,J.useState)({isShown:!1,value:0}),[E,ne]=(0,J.useState)(null),X=(0,le.$j)(),D=xe(X,w);(0,J.useEffect)(()=>{V(s({colorArray:S,stops:ve,useStopsPercentage:M}))},[S,M]);const Z=K=>{const A=K.nativeEvent.offsetX,y=K.currentTarget.offsetWidth,T=Math.floor(A*100/y+1),he=Math.floor((L-H)*T/100+H);b({isShown:!0,value:he}),ne(T)},q=()=>{b({isShown:!1,value:0})};return(0,J.useEffect)(()=>{ne(B==null?null:fe((B-H)/(L-H)))},[B,H,L]),(0,m.jsxs)("div",{className:D.scaleWrapper,onMouseMove:Z,onMouseLeave:q,children:[(0,m.jsx)("div",{className:D.scaleGradient,children:R&&(O.isShown||B!==void 0)&&(0,m.jsx)("div",{className:D.followerContainer,children:(0,m.jsx)("div",{className:D.follower,style:{left:`${E}%`}})})}),R&&(0,m.jsxs)("div",{className:D.followerContainer,children:[(0,m.jsxs)("div",{className:D.legendValues,children:[(0,m.jsx)("span",{className:D.disabled,children:R(H)}),(0,m.jsx)("span",{className:D.disabled,children:R(L)})]}),E!=null&&(O.isShown||B!==void 0)&&(0,m.jsx)("span",{className:D.hoverValue,style:{left:`${E}%`},children:R(B??O.value)})]})]})},s=({colorArray:S,stops:H,useStopsPercentage:L=!0})=>{const R=S.length;if(L&&R<=20){const V=1/R*100;let O=0;const b=[];for(const E of S)O>0?b.push(`${E} ${O}%`):b.push(E),O+=V,b.push(`${E} ${O}%`);return b}const B=S[R-1],M=Math.ceil(R/H),w=new Set;for(let V=0;V<R;V+=M)w.add(S[V]);return w.add(B),[...w]};function fe(S){return S>1?100:S<0?0:S*100}const xe=(S,H)=>({scaleWrapper:(0,I.css)({width:"100%",fontSize:"11px",opacity:1}),scaleGradient:(0,I.css)({background:`linear-gradient(90deg, ${H.join()})`,height:"9px",pointerEvents:"none",borderRadius:S.shape.radius.default}),legendValues:(0,I.css)({display:"flex",justifyContent:"space-between",pointerEvents:"none"}),hoverValue:(0,I.css)({position:"absolute",marginTop:"-14px",padding:"3px 15px",transform:"translateX(-50%)"}),followerContainer:(0,I.css)({position:"relative",pointerEvents:"none",whiteSpace:"nowrap"}),follower:(0,I.css)({position:"absolute",height:"13px",width:"13px",borderRadius:S.shape.radius.default,transform:"translateX(-50%) translateY(-50%)",border:`2px solid ${S.colors.text.primary}`,top:"5px"}),disabled:(0,I.css)({color:S.colors.text.disabled})})},13326:(Re,pe,l)=>{l.d(pe,{e:()=>R});var m=l(74848),I=l(22803),J=l(16515),le=l(55386),ve=l(46635),_=l(739),s=l(63142),fe=l(89640),xe=l(56840),S=l(53049),H=l(70362);function L(M,w,V,O,b){const E=M.fields,ne=V!=null?E[V]:null,X=E.filter(y=>!y.config.custom?.hideFrom?.tooltip),D=X.find(y=>y.name==="traceID")||E[0],Z=[];if(X.filter(y=>D===y).length>0&&Z.push(D),Z.push(...X.filter(y=>D!==y)),Z.length===0)return null;const q=[],K=[],A=new Set;for(const y of Z){if(b===_.$N.Single&&y!==ne)continue;const T=y.values[w],he=y.display?y.display(T):{text:`${T}`,numeric:+T};y.getLinks&&y.getLinks({calculatedValue:he,valueRowIndex:w}).forEach(ye=>{const De=`${ye.title}/${ye.href}`;A.has(De)||(K.push(ye),A.add(De))}),q.push({name:(0,J.Ct)(y,M),value:T,valueString:(0,le.cN)(he),highlight:y===ne})}return O&&O!==_.xB.None&&q.sort((y,T)=>ve.sortValues(O)(y.value,T.value)),{displayValues:q,links:K}}const R=({data:M,rowIndex:w,columnIndex:V,sortOrder:O,mode:b,header:E,padding:ne=0,maxHeight:X})=>{const D=(0,s.of)(B,ne);if(!M||w==null)return null;const Z=L(M,w,V,O,b);if(Z==null)return null;const{displayValues:q,links:K}=Z;return E==="Exemplar"?(0,m.jsx)(H.i,{displayValues:q,links:K,header:E,maxHeight:X}):(0,m.jsxs)("div",{className:D.wrapper,children:[E&&(0,m.jsx)("div",{className:D.header,children:(0,m.jsx)("span",{className:D.title,children:E})}),(0,m.jsx)("table",{className:D.infoWrap,children:(0,m.jsxs)("tbody",{children:[q.map((A,y)=>(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{children:A.name}),(0,m.jsx)("td",{children:(0,S.A)(A.valueString)})]},`${y}/${w}`)),K.map((A,y)=>(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{children:(0,m.jsx)(xe.x6,{i18nKey:"visualization.data-hover-view.link",children:"Link"})}),(0,m.jsx)("td",{colSpan:2,children:(0,m.jsx)(fe.Y,{href:A.href,external:A.target==="_blank",weight:"medium",inline:!1,children:A.title})})]},y))]})})]})},B=(M,w=0)=>({wrapper:(0,I.css)({padding:`${w}px`,background:M.components.tooltip.background,borderRadius:M.shape.borderRadius(2)}),header:(0,I.css)({background:M.colors.background.secondary,alignItems:"center",alignContent:"center",display:"flex",paddingBottom:M.spacing(1)}),title:(0,I.css)({fontWeight:M.typography.fontWeightMedium,overflow:"hidden",display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis",flexGrow:1}),infoWrap:(0,I.css)({padding:M.spacing(1),background:"transparent",border:"none",th:{fontWeight:M.typography.fontWeightMedium,padding:M.spacing(.25,2,.25,0)},tr:{borderBottom:`1px solid ${M.colors.border.weak}`,"&:last-child":{borderBottom:"none"}}}),link:(0,I.css)({color:M.colors.text.link})})},17933:(Re,pe,l)=>{l.r(pe),l.d(pe,{plugin:()=>Mt});var m=l(74848),I=l(16207),J=l(83340),le=l(95004),ve=l(38809),_=l(43173),s=l(739),fe=l(44017),xe=l(45013),S=l(20276),H=l(13572),L=l(48264),R=l(22803),B=l(96540),M=l(84229),w=l(14477),V=l(63142),O=l(64400),b=l(54735),E=l(92790),ne=l(18667),X=l(69234),D=l(36327),Z=l(13507),q=l(36613),K=l(39443),A=l(55386),y=l(16515),T=l(55978),he=l(39064),ye=l(61048),De=l(41530),qe=l(47466),_e=l(22429),et=l(13326),Fe=l(16913),tt=l(76234);function at(e,c,a,o,t,n,u){let i=e.current?.getContext("2d");if(i!=null){let d=n;for(;o[d-1]===o[n];)d--;let h=d+u,r=0,x=d;for(;x<h;){let ae=t[x];r=Math.max(r,ae),x++}let N=new Path2D,ee=new Path2D;x=d;let te=0;for(;x<h;){let ae=t[x];if(ae>0){let W=ae/r,ie=te/u,Q=x===n?N:ee;const F=c*ie+1,U=c/u-1;Q.rect(F,Math.round(a*(1-W)),U,Math.round(a*W))}x++,te++}i.clearRect(0,0,c,a),i.fillStyle="#2E3036",i.fill(ee),i.fillStyle="#5794F2",i.fill(N)}}const je=(e,c)=>{const a=e.heatmapColors?.palette,o=e.heatmapColors?.values[c];let t;return o!=null&&(t=a[o]),{cellColor:t,colorPalette:a}},Oe={year:1e3*60*60*24*365,month:1e3*60*60*24*30,week:1e3*60*60*24*7,day:1e3*60*60*24,h:1e3*60*60,m:1e3*60,s:1e3,ms:1},lt=new Set(["ms","s","m","h"]),nt=e=>{let c=1,a="ms";for(a in Oe)if(e>=Oe[a]){c=Math.floor(e/Oe[a]);break}const t=c!==1&&!lt.has(a)?a+"s":a;return`${c} ${t}`},Ae=(e,c,a)=>{let o;switch(c){case"x":o=a?e?.fields.find(({name:t})=>t==="x"||t==="xMin"||t==="xMax"):e?.fields[0];break;case"y":o=a?e?.fields.find(({name:t})=>t==="y"||t==="yMin"||t==="yMax"):e?.fields[1];break;case"count":o=a?e?.fields.find(({name:t})=>t==="count"):e?.fields[2];break}return o},He=(e,c)=>{let a=e.heatmap.fields,o=a.find(i=>i.name==="xMax"),t=a.find(i=>i.name==="yMin"),n=a.find(i=>i.name==="yMax"),u=o.config.interval;return{xBucketMin:o.values[c]-u,xBucketMax:o.values[c],yBucketMin:t.values[c],yBucketMax:n.values[c]}},st=e=>e.seriesIdx===2?(0,m.jsx)(et.e,{data:e.dataRef.current.exemplars,rowIndex:e.dataIdxs[2],header:"Exemplar",padding:8,maxHeight:e.maxHeight}):(0,m.jsx)(it,{...e}),be=264,ot=64,it=({dataIdxs:e,dataRef:c,showHistogram:a,isPinned:o,showColorScale:t=!1,mode:n,annotate:u,maxHeight:i,maxWidth:f,replaceVariables:d})=>{const h=e[1],r=c.current,[x]=(0,B.useState)(()=>r.heatmap?.meta?.type===K.m.HeatmapCells&&!(0,L.Nb)(r.heatmap)),N=Ae(r.heatmap,"x",x),ee=Ae(r.heatmap,"y",x),te=Ae(r.heatmap,"count",x),ae=v=>N?.display?(0,A.cN)(N.display(v)):N?.type===le.PU.time?(0,_e.UA)().getCurrent()?.formatDate(v,"YYYY-MM-DD HH:mm:ss"):`${v}`,W=N.values,ie=ee.values,Q=te.values,F=(0,L.eE)(r.heatmap),U=ee?.display?v=>(0,A.cN)(ee.display(v)):v=>`${v}`;let g=N?.config.interval,G,$,z,re,ue,Y=[];const se=v=>v%(r.yBucketCount??1);let j=se(h);const de=Math.floor(h/(r.yBucketCount??1)),Ce=(v=h)=>{if(F.yOrdinalDisplay){const C=r.yLayout===s.D7.le?j-1:j,P=r.yLayout===s.D7.le?j:j+1;G=C<0?F.yMinDisplay:`${F.yOrdinalDisplay[C]}`,$=`${F.yOrdinalDisplay[P]}`,(!F.yOrdinalLabel||Number.isNaN(+F.yOrdinalLabel[0]))&&(ue=r.yLayout===s.D7.le?$:G)}else{const C=ie?.[j];if(r.yLayout===s.D7.le)if($=`${C}`,r.yLog){let k=(r.yLog===2?Math.log2:Math.log10)(C)-1/r.yLogSplit;G=`${r.yLog**k}`}else G=`${C-r.yBucketSize}`;else if(G=`${C}`,r.yLog){let k=(r.yLog===2?Math.log2:Math.log10)(C)+1/r.yLogSplit;$=`${r.yLog**k}`}else $=`${C+r.yBucketSize}`}r.xLayout===s.D7.le?(re=W[v],z=re-r.xBucketSize):(z=W[v],re=z+r.xBucketSize)};x?{xBucketMin:z,xBucketMax:re,yBucketMin:G,yBucketMax:$}=He(r,h):Ce();const{cellColor:me,colorPalette:ge}=je(r,h),Pe=(v,C)=>{let P=[];for(let k=v;k<=C;k++){if(!Q?.[k])continue;const ce=je(r,k).cellColor;oe=Ve(k),x?{xBucketMin:z,xBucketMax:re,yBucketMin:G,yBucketMax:$}=He(r,k):(j=se(k),Ce(k));const{label:Ct,value:Dt}=we()[0];P.push({label:Ct,value:Dt,color:ce??"#FFF",isActive:h===k})}return P},we=()=>{const v=n===s.$N.Multi&&!o;if(ue)return v?[{label:`Name ${ue}`,value:r.display(oe)}]:[{label:"Name",value:ue}];switch(r.yLayout){case s.D7.unknown:return v?[{label:U(G),value:r.display(oe)}]:[{label:"",value:U(G)}]}return v?[{label:`Bucket ${U(G)}-${U($)}`,value:r.display(oe)}]:[{label:"Bucket",value:`${U(G)}-${U($)}`}]},Ve=v=>Q?.[v];let oe=Ve(h);if(n===s.$N.Single||o){const v=g?[{label:"Duration",value:nt(g)}]:[];Y=[{label:(0,y.Ct)(te,r.heatmap),value:r.display(oe),color:me??"#FFF",colorPlacement:T.lJ.trailing,colorIndicator:T.fX.value},...we(),...v]}if(n===s.$N.Multi&&!o){let v=N.values[h],C=h,P=h;for(;N.values[C-1]===v;)C--;for(;N.values[P+1]===v;)P++;Pe(C,P).forEach(ce=>{Y.push({label:ce.label,value:ce.value,color:ce.color??"#FFF",colorIndicator:T.fX.value,colorPlacement:T.lJ.trailing,isActive:ce.isActive})})}let Ue;if(o){let v=[],C=[];const P=r.series?.fields[j+1];if(P!=null){const k=!P.config.custom?.hideFrom?.tooltip,ce=(P.config.links?.length??0)>0;k&&ce&&(v=(0,Fe.u6)(P,de)),C=(0,Fe.OG)(r.series,P,d,de)}Ue=(0,m.jsx)(he.S,{dataLinks:v,annotate:u,actions:C})}let Ge=(0,B.useRef)(null);const Ye=(0,V.$j)(),St=parseInt(Ye.spacing(1),10);let ze=Math.min(be,f?f-St*2:be),Je=ot,Xe=Math.round(ze*q.A.pxRatio),Ze=Math.round(Je*q.A.pxRatio);(0,B.useEffect)(()=>{a&&W!=null&&Q!=null&&n===s.$N.Single&&at(Ge,Xe,Ze,W,Q,h,r.yBucketCount)},[h]);const Bt={label:"",value:ae(re)};let Ie=[];return n===s.$N.Single&&(a&&!x&&Ie.push((0,m.jsx)("canvas",{width:Xe,height:Ze,ref:Ge,style:{width:ze+"px",height:Je+"px"}})),ge&&t&&Ie.push((0,m.jsx)(S.w,{colorPalette:ge,min:r.heatmapColors?.minValue,max:r.heatmapColors?.maxValue,display:r.display,hoverValue:oe}))),(0,m.jsxs)(ye.i,{children:[(0,m.jsx)(De.A,{item:Bt,isPinned:o}),(0,m.jsx)(qe.o,{items:Y,isPinned:o,scrollable:(0,tt.T5)({mode:n,maxHeight:i}),maxHeight:i,children:Ie?.map((v,C)=>(0,m.jsx)("div",{style:{padding:`${Ye.spacing(1)} 0`},children:v},C))}),Ue]})};var Ke=l(60519),rt=l(8721),ct=l(11576),Me=l(70210),Se=l(50348);function $e({frames:e,annotations:c,options:a,palette:o,theme:t,replaceVariables:n=i=>i,timeRange:u}){if(!e?.length)return{};(0,y.Fm)(e);const i=c?.find(d=>d.name==="exemplar");if(i?.fields.forEach(d=>{d.getLinks=(0,Ke._M)(i,d,d.state?.scopedVars??{},n)}),a.calculate){let d=ut(a.calculation);return d.xBuckets.value=n(d.xBuckets.value??""),d.yBuckets.value=n(d.yBuckets.value??""),ke((0,L.VQ)(e,{...d,timeRange:u}),i,{...a,calculation:d},o,t)}let f;for(const d of e)switch(d.meta?.type){case K.m.HeatmapCells:return(0,L.Nb)(d)?ke(d,i,a,o,t):dt(d,i,a,o,t);case K.m.HeatmapRows:f=d}if(f==null)if(e.length>1)e.every(h=>!Number.isNaN((0,Me.L)(h.fields[1].state?.displayName)))&&e.sort(Me.Bm),f=(0,rt.Fd)({frames:e,keepDisplayNames:!0});else{let d=e[0],h=d.fields.filter(x=>x.type===le.PU.number);h.every(x=>!Number.isNaN((0,Me.L)(x.state?.displayName)))?(h.sort((x,N)=>(0,Me.L)(x.state?.displayName)-(0,Me.L)(N.state?.displayName)),f={...d,fields:[d.fields.find(x=>x.type===le.PU.time),...h]}):f=d}return f.fields.forEach(d=>{(d.config.links?.length??0)!==0&&(d.getLinks=(0,Ke._M)(f,d,d.state?.scopedVars??{},n))}),{...ke((0,L.yJ)({unit:a.yAxis?.unit,decimals:a.yAxis?.decimals,...a.rowsFrame,frame:f}),i,a,o,t),series:f}}const ut=e=>({xBuckets:{...e?.xBuckets,mode:e?.xBuckets?.mode??s.J1.Size},yBuckets:{...e?.yBuckets,mode:e?.yBuckets?.mode??s.J1.Size,scale:{...e?.yBuckets?.scale,type:e?.yBuckets?.scale?.type??s.L4.Linear}}}),dt=(e,c,a,o,t)=>{if(e.meta?.type!==K.m.HeatmapCells||(0,L.Nb)(e))return{warning:"Expected sparse heatmap format",heatmap:e};Ne(e.fields[1],a.yAxis,t);const n=e.fields[3],u=Ne(n,a.cellValues,t);let[i,f]=(0,Se.g$)(n.values,a.color.min,a.color.max,a.filterValues?.le,a.filterValues?.ge);return{heatmap:e,heatmapColors:{palette:o,values:(0,Se.O4)(n.values,o,i,f),minValue:i,maxValue:f},exemplars:c,display:d=>(0,A.cN)(u(d))}},ke=(e,c,a,o,t)=>{if(e.meta?.type!==K.m.HeatmapCells)return{warning:"Expected heatmap scanlines format",heatmap:e};if(e.fields.length<2||e.length<2)return{heatmap:e};const n=(0,L.eE)(e);let u,i,f;for(const g of e.fields)switch(g.name){case"y":i=g.name;case"yMin":case"yMax":{i||(i=g.name),n.yOrdinalDisplay==null&&Ne(g,a.yAxis,t);break}case"x":case"xMin":case"xMax":u=g.name;break;default:g.type===le.PU.number&&!f&&(f=g)}if(!i)return{warning:"Missing Y field",heatmap:e};if(!i)return{warning:"Missing X field",heatmap:e};if(!f)return{warning:"Missing value field",heatmap:e};const d=Ne(f,a.cellValues,t),h=e.fields[0].values,r=e.fields[1].values,x=h.length;let N=x-r.lastIndexOf(r[0]),ee=x/N,te=r[1]-r[0],ae=h[N]-h[0],[W,ie]=(0,Se.g$)(f.values,a.color.min,a.color.max,a.filterValues?.le,a.filterValues?.ge),Q=a.calculation?.xBuckets,F=a.calculation?.yBuckets;return{heatmap:e,heatmapColors:{palette:o,values:(0,Se.O4)(f.values,o,W,ie),minValue:W,maxValue:ie},exemplars:c?.length?c:void 0,xBucketSize:ae,yBucketSize:te,xBucketCount:ee,yBucketCount:N,yLog:F?.scale?.log??0,xLog:Q?.scale?.log??0,xLogSplit:Q?.scale?.log?+(Q?.value??"1"):1,yLogSplit:F?.scale?.log?+(F?.value??"1"):1,xLayout:u==="xMax"?s.D7.le:u==="xMin"?s.D7.ge:s.D7.unknown,yLayout:i==="yMax"?s.D7.le:i==="yMin"?s.D7.ge:s.D7.unknown,display:g=>(0,A.cN)(d(g))}};function Ne(e,c,a){if(c?.unit?.length||c?.decimals!=null){const{unit:o,decimals:t}=c;e.display=void 0,e.config={...e.config},o?.length&&(e.config.unit=o),t!=null&&(e.config.decimals=t)}return e.display||(e.display=(0,ct.J)({field:e,theme:a})),e.display}var Te=l(55995),mt=l(37634),We=l(84140),p=l(4833);const Be=[{name:"BrBG",invert:"always"},{name:"PiYG",invert:"always"},{name:"PRGn",invert:"always"},{name:"PuOr",invert:"always"},{name:"RdBu",invert:"always"},{name:"RdGy",invert:"always"},{name:"RdYlBu",invert:"always"},{name:"RdYlGn",invert:"always"},{name:"Spectral",invert:"always"},{name:"Blues",invert:"dark"},{name:"Greens",invert:"dark"},{name:"Greys",invert:"dark"},{name:"Oranges",invert:"dark"},{name:"Purples",invert:"dark"},{name:"Reds",invert:"dark"},{name:"Turbo",invert:"light"},{name:"Cividis",invert:"light"},{name:"Viridis",invert:"light"},{name:"Magma",invert:"light"},{name:"Inferno",invert:"light"},{name:"Plasma",invert:"light"},{name:"Warm",invert:"light"},{name:"Cool",invert:"light"},{name:"Cubehelix",invert:"light",name2:"CubehelixDefault"},{name:"BuGn",invert:"dark"},{name:"BuPu",invert:"dark"},{name:"GnBu",invert:"dark"},{name:"OrRd",invert:"dark"},{name:"PuBuGn",invert:"dark"},{name:"PuBu",invert:"dark"},{name:"PuRd",invert:"dark"},{name:"RdPu",invert:"dark"},{name:"YlGnBu",invert:"dark"},{name:"YlGn",invert:"dark"},{name:"YlOrBr",invert:"dark"},{name:"YlOrRd",invert:"dark"},{name:"Rainbow",invert:"always"},{name:"Sinebow",invert:"always"}],pt=Be.find(e=>e.name==="Spectral");function Le(e,c){const a={...p.KQ.color,...e},o=[],t=(a.steps??128)-1;if(e.mode===p.P7.Opacity){const n=(0,We.A)(c.visualization.getColorByName(e.fill)).toPercentageRgb(),u=a.scale===p.uM.Exponential?Te.scalePow().exponent(a.exponent).domain([0,1]).range([0,1]):Te.scaleLinear().domain([0,1]).range([0,1]);for(let i=0;i<=t;i++)n.a=u(i/t),o.push((0,We.A)(n).toString("hex8"))}else{const n=Be.find(f=>f.name===a.scheme)??pt;let u="interpolate"+(n.name2??n.name);const i=mt[u];for(let f=0;f<=t;f++){let d=i(f/t),h=d.indexOf("rgb")===0?"#"+[...d.matchAll(/\d+/g)].map(r=>(+r[0]).toString(16).padStart(2,"0")).join(""):d;o.push(h)}(n.invert==="always"||n.invert==="dark"&&c.isDark||n.invert==="light"&&c.isLight)&&o.reverse(),e.reverse&&o.reverse()}return o}const ft=({data:e,id:c,timeRange:a,timeZone:o,width:t,height:n,options:u,fieldConfig:i,eventBus:f,onChangeTimeRange:d,replaceVariables:h})=>{const r=(0,V.$j)(),x=(0,V.of)(ht),{sync:N,eventsScope:ee,canAddAnnotations:te,onSelectRange:ae}=(0,O.d2)(),W=N?.()??M.y.Off,[ie,Q]=(0,B.useState)(null);let F=(0,B.useRef)(a);F.current=a;const U=(0,B.useMemo)(()=>Le(u.color,r),[u.color,r]),g=(0,B.useMemo)(()=>{try{return $e({frames:e.series,annotations:e.annotations,options:u,palette:U,theme:r,replaceVariables:h,timeRange:a})}catch(Y){return{warning:`${Y}`}}},[e.series,e.annotations,u,U,r,h,a]),G=(0,B.useMemo)(()=>{let Y=[],se=[];const j=(0,L.eE)(g.heatmap);return g.exemplars?.length&&(Y=g.exemplars?.fields[0].values,j.yMatchWithLabel&&j.yOrdinalDisplay!=null?se=(g.exemplars?.fields.find(me=>me.name===j.yMatchWithLabel).values).map(me=>j.yOrdinalLabel?.indexOf(me)):se=g.exemplars?.fields[1].values),[null,g.heatmap?.fields.map(de=>de.values),[Y,se]]},[g.heatmap,g.exemplars]),$=(0,B.useRef)(g);$.current=g;const z=(0,B.useMemo)(()=>{const Y=$.current?.heatmap?.fields[1].config?.custom?.scaleDistribution;return(0,Se.Mv)({dataRef:$,theme:r,timeZone:o,getTimeRange:()=>F.current,cellGap:u.cellGap,hideLE:u.filterValues?.le,hideGE:u.filterValues?.ge,exemplarColor:u.exemplars?.color??"rgba(255,0,255,0.7)",yAxisConfig:u.yAxis,ySizeDivisor:Y?.type===s.L4.Log?+(u.calculation?.yBuckets?.value||1):1,selectionMode:u.selectionMode})},[u,o,e.structureRev,W]),re=()=>!g.heatmap||!u.legend.show?null:(0,m.jsx)(b.KU.Legend,{placement:"bottom",maxHeight:"20%",children:(0,m.jsx)("div",{className:x.colorScaleWrapper,children:(0,m.jsx)(S.w,{hoverValue:void 0,colorPalette:U,min:$.current.heatmapColors?.minValue,max:$.current.heatmapColors?.maxValue,display:g.display})})});if(g.warning||!g.heatmap)return(0,m.jsx)(w.a,{panelId:c,fieldConfig:i,data:e,needsNumberField:!0,message:g.warning});const ue=!!(te&&te());return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(b.KU,{width:t,height:n,legend:re(),children:(Y,se)=>(0,m.jsxs)(E.Z,{config:z,data:G,width:Y,height:se,children:[W!==M.y.Off&&(0,m.jsx)(ne.K,{config:z,eventBus:f,frame:g.series??g.heatmap}),u.tooltip.mode!==s.$N.None&&(0,m.jsx)(X.xl,{config:z,hoverMode:u.tooltip.mode===s.$N.Single?X.b3.xOne:X.b3.xAll,queryZoom:d,onSelectRange:ae,syncMode:W,syncScope:ee,render:(j,de,Ce,me,ge,Pe,we)=>{if(ue&&Pe!=null){Q(Pe),ge();return}const Ve=()=>{let oe=j.posToVal(j.cursor.left,"x");Q({from:oe,to:oe}),ge()};return(0,m.jsx)(st,{mode:we?s.$N.Multi:u.tooltip.mode,dataIdxs:de,seriesIdx:Ce,dataRef:$,isPinned:me,dismiss:ge,showHistogram:u.tooltip.yHistogram,showColorScale:u.tooltip.showColorScale,panelData:e,annotate:ue?Ve:void 0,maxHeight:u.tooltip.maxHeight,maxWidth:u.tooltip.maxWidth,replaceVariables:h})},maxWidth:u.tooltip.maxWidth}),(0,m.jsx)(D.W,{annotations:e.annotations??[],config:z,timeZone:o,newRange:ie,setNewRange:Q,canvasRegionRendering:!1}),(0,m.jsx)(Z.U,{config:z,onChangeTimeRange:d})]},z.uid)})})},ht=()=>({colorScaleWrapper:(0,R.css)({marginLeft:"25px",padding:"10px 0",maxWidth:"300px"})}),gt=e=>{if(Object.keys(e.options??{}).length===0)return Qe(e,"heatmap",{angular:e},e.fieldConfig);let c=e.options?.tooltip?.show;return c!==void 0&&(c===!0?e.options.tooltip.mode=s.$N.Single:c===!1&&(e.options.tooltip.mode=s.$N.None),delete e.options.tooltip?.show),e.options},Qe=(e,c,a,o)=>{if(c==="heatmap"&&a.angular){const{fieldConfig:t,options:n}=vt({...a.angular,fieldConfig:o});return e.fieldConfig=t,n}if(c==="heatmap-new"){const{bucketFrame:t,...n}=e.options;return t?{...n,rowsFrame:t}:e.options}return{}};function vt(e){const c={defaults:{},overrides:[]},a=e.dataFormat!=="tsbuckets",o={...p.KQ.calculation},t={logBase:1,...e.yAxis};a&&(e.xBucketSize?o.xBuckets={mode:s.J1.Size,value:`${e.xBucketSize}`}:e.xBucketNumber&&(o.xBuckets={mode:s.J1.Count,value:`${e.xBucketNumber}`}),e.yBucketSize?o.yBuckets={mode:s.J1.Size,value:`${e.yBucketSize}`}:e.xBucketNumber&&(o.yBuckets={mode:s.J1.Count,value:`${e.yBucketNumber}`}),t.logBase>1&&(o.yBuckets={mode:s.J1.Count,value:+t.splitFactor>0?`${t.splitFactor}`:void 0,scale:{type:s.L4.Log,log:t.logBase}}));const n=Ee(e.cards?.cardPadding,2),u={calculate:a,calculation:o,color:{...p.KQ.color,steps:128},cellGap:n||1,cellRadius:Ee(e.cards?.cardRound),yAxis:{axisPlacement:t.show===!1?s.vM.Hidden:s.vM.Left,reverse:!!e.reverseYBuckets,axisWidth:Ee(t.width),min:t.min,max:t.max,unit:t.format,decimals:t.decimals},cellValues:{decimals:Ee(e.tooltipDecimals)},rowsFrame:{layout:xt(e.yBucketBound)},legend:{show:!!e.legend?.show},showValue:s.yL.Never,tooltip:{mode:e.tooltip?.show?s.$N.Single:s.$N.None,yHistogram:!!e.tooltip?.showHistogram},exemplars:{...p.KQ.exemplars}};e.hideZeroBuckets&&(u.filterValues={...p.KQ.filterValues});const i=e.color??{};switch(i?.mode){case"spectrum":{u.color.mode=p.P7.Scheme;const f=i.colorScheme;let d=Be.find(h=>h.name===f);d||(d=Be.find(h=>f.indexOf(h.name)>=0)),u.color.scheme=d?d.name:p.KQ.color.scheme;break}case"opacity":{u.color.mode=p.P7.Opacity,u.color.scale=i.scale;break}}return u.color.fill=i.cardColor,u.color.min=i.min,u.color.max=i.max,typeof i.min=="number"&&typeof i.max=="number"&&i.min>i.max&&(u.color.min=i.max,u.color.max=i.min,u.color.reverse=!0),{fieldConfig:c,options:u}}function xt(e){switch(e){case"upper":return s.D7.ge;case"lower":return s.D7.le;case"middle":return s.D7.unknown}return s.D7.auto}function Ee(e,c){if(e==null||e==="")return c;const a=+e;return isNaN(a)?c:a}class yt{getSuggestionsForData(c){const{dataSummary:a}=c;if(!c.data?.series||!a.hasData||a.timeFieldCount<1||a.numberFieldCount<2||a.numberFieldCount>10)return;const o=Le(p.KQ.color,_.$.theme2),t=$e({frames:c.data.series,options:p.KQ,palette:o,theme:_.$.theme2});!t||t.warning||c.getListAppender({name:"",pluginId:"heatmap",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}})}}const Mt=new I.m(ft).useFieldConfig({disableStandardOptions:Object.values(J.uo).filter(e=>e!==J.uo.Links),standardOptions:{[J.uo.Links]:{settings:{showOneClick:!0}}},useCustomConfig:e=>{e.addCustomEditor({id:"scaleDistribution",path:"scaleDistribution",name:"Y axis scale",category:["Heatmap"],editor:fe.W1,override:fe.W1,defaultValue:{type:s.L4.Linear},shouldApply:c=>c.type===le.PU.number,process:ve.hS,hideFromDefaults:!0}),(0,xe.e)(e)}}).setPanelChangeHandler(Qe).setMigrationHandler(gt).setPanelOptions((e,c)=>{const a=c.options??p.KQ;let o=!1;if(c.data.length>0)try{const n=Le(a.color,_.$.theme2),u=$e({frames:c.data,options:a,palette:n,theme:_.$.theme2});o=(0,L.eE)(u.heatmap).yOrdinalDisplay!=null}catch{}let t=["Heatmap"];e.addRadio({path:"calculate",name:"Calculate from data",defaultValue:p.KQ.calculate,category:t,settings:{options:[{label:"Yes",value:!0},{label:"No",value:!1}]}}),a.calculate&&(0,H.J)("calculation.",e,a.calculation,t),t=["Y Axis"],e.addRadio({path:"yAxis.axisPlacement",name:"Placement",defaultValue:p.KQ.yAxis.axisPlacement??s.vM.Left,category:t,settings:{options:[{label:"Left",value:s.vM.Left},{label:"Right",value:s.vM.Right},{label:"Hidden",value:s.vM.Hidden}]}}).addUnitPicker({category:t,path:"yAxis.unit",name:"Unit",defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:t,path:"yAxis.decimals",name:"Decimals",settings:{placeholder:"Auto"}}),o||e.addNumberInput({path:"yAxis.min",name:"Min value",settings:{placeholder:"Auto"},category:t}).addTextInput({path:"yAxis.max",name:"Max value",settings:{placeholder:"Auto"},category:t}),e.addNumberInput({path:"yAxis.axisWidth",name:"Axis width",defaultValue:p.KQ.yAxis.axisWidth,settings:{placeholder:"Auto",min:5},category:t}).addTextInput({path:"yAxis.axisLabel",name:"Axis label",defaultValue:p.KQ.yAxis.axisLabel,settings:{placeholder:"Auto"},category:t}),a.calculate||e.addRadio({path:"rowsFrame.layout",name:"Tick alignment",defaultValue:p.KQ.rowsFrame?.layout??s.D7.auto,category:t,settings:{options:[{label:"Auto",value:s.D7.auto},{label:"Top (LE)",value:s.D7.le},{label:"Middle",value:s.D7.unknown},{label:"Bottom (GE)",value:s.D7.ge}]}}),e.addBooleanSwitch({path:"yAxis.reverse",name:"Reverse",defaultValue:p.KQ.yAxis.reverse===!0,category:t}),t=["Colors"],e.addRadio({path:"color.mode",name:"Mode",defaultValue:p.KQ.color.mode,category:t,settings:{options:[{label:"Scheme",value:p.P7.Scheme},{label:"Opacity",value:p.P7.Opacity}]}}),e.addColorPicker({path:"color.fill",name:"Color",defaultValue:p.KQ.color.fill,category:t,showIf:n=>n.color.mode===p.P7.Opacity}),e.addRadio({path:"color.scale",name:"Scale",defaultValue:p.KQ.color.scale,category:t,settings:{options:[{label:"Exponential",value:p.uM.Exponential},{label:"Linear",value:p.uM.Linear}]},showIf:n=>n.color.mode===p.P7.Opacity}),e.addSliderInput({path:"color.exponent",name:"Exponent",defaultValue:p.KQ.color.exponent,category:t,settings:{min:.1,max:2,step:.1},showIf:n=>n.color.mode===p.P7.Opacity&&n.color.scale===p.uM.Exponential}),e.addSelect({path:"color.scheme",name:"Scheme",description:"",defaultValue:p.KQ.color.scheme,category:t,settings:{options:Be.map(n=>({value:n.name,label:n.name}))},showIf:n=>n.color.mode!==p.P7.Opacity}),e.addSliderInput({path:"color.steps",name:"Steps",defaultValue:p.KQ.color.steps,category:t,settings:{min:2,max:128,step:1}}).addBooleanSwitch({path:"color.reverse",name:"Reverse",defaultValue:p.KQ.color.reverse,category:t}).addCustomEditor({id:"__scale__",path:"__scale__",name:"",category:t,editor:()=>{const n=Le(a.color,_.$.theme2);return(0,m.jsx)("div",{children:(0,m.jsx)(S.w,{colorPalette:n,min:1,max:100})})}}),e.addNumberInput({path:"color.min",name:"Start color scale from value",defaultValue:p.KQ.color.min,settings:{placeholder:"Auto (min)"},category:t}).addNumberInput({path:"color.max",name:"End color scale at value",defaultValue:p.KQ.color.max,settings:{placeholder:"Auto (max)"},category:t}),t=["Cell display"],a.calculate||e.addTextInput({path:"rowsFrame.value",name:"Value name",defaultValue:p.KQ.rowsFrame?.value,settings:{placeholder:"Value"},category:t}),e.addUnitPicker({category:t,path:"cellValues.unit",name:"Unit",defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:t,path:"cellValues.decimals",name:"Decimals",settings:{placeholder:"Auto"}}),e.addSliderInput({name:"Cell gap",path:"cellGap",defaultValue:p.KQ.cellGap,category:t,settings:{min:0,max:25}}).addNumberInput({path:"filterValues.le",name:"Hide cells with values <=",defaultValue:p.KQ.filterValues?.le,settings:{placeholder:"None"},category:t}).addNumberInput({path:"filterValues.ge",name:"Hide cells with values >=",defaultValue:p.KQ.filterValues?.ge,settings:{placeholder:"None"},category:t}),t=["Tooltip"],e.addRadio({path:"tooltip.mode",name:"Tooltip mode",category:t,defaultValue:s.$N.Single,settings:{options:[{value:s.$N.Single,label:"Single"},{value:s.$N.Multi,label:"All"},{value:s.$N.None,label:"Hidden"}]}}),e.addBooleanSwitch({path:"tooltip.yHistogram",name:"Show histogram (Y axis)",defaultValue:p.KQ.tooltip.yHistogram,category:t,showIf:n=>n.tooltip.mode===s.$N.Single}),e.addBooleanSwitch({path:"tooltip.showColorScale",name:"Show color scale",defaultValue:p.KQ.tooltip.showColorScale,category:t,showIf:n=>n.tooltip.mode===s.$N.Single}),e.addNumberInput({path:"tooltip.maxWidth",name:"Max width",category:t,settings:{integer:!0},showIf:n=>n.tooltip.mode!==s.$N.None}),e.addNumberInput({path:"tooltip.maxHeight",name:"Max height",category:t,defaultValue:void 0,settings:{integer:!0},showIf:(n,u,i)=>n.tooltip?.mode===s.$N.Multi||i?.some(f=>f.meta?.custom?.resultType==="exemplar")}),t=["Legend"],e.addBooleanSwitch({path:"legend.show",name:"Show legend",defaultValue:p.KQ.legend.show,category:t}),t=["Exemplars"],e.addColorPicker({path:"exemplars.color",name:"Color",defaultValue:p.KQ.exemplars.color,category:t,showIf:(n,u,i)=>i?.some(f=>f.meta?.custom?.resultType==="exemplar")})}).setSuggestionsSupplier(new yt).setDataSupport({annotations:!0})}}]);

//# sourceMappingURL=heatmapPanel.396a0b0d72b46a9ae69b.js.map