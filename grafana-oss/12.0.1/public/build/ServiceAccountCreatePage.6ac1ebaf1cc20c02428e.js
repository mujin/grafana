"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4176],{74410:(W,g,e)=>{e.d(g,{l:()=>D});var o=e(74848),s=e(22803),d=e(96540),u=e(49785);function D({defaultValues:A,onSubmit:v,validateOnMount:n=!1,validateFieldsOnMount:P,children:l,validateOn:i="onSubmit",maxWidth:r=600,...R}){const{handleSubmit:O,trigger:f,formState:C,...M}=(0,u.mN)({mode:i,defaultValues:A});return(0,d.useEffect)(()=>{n&&f(P)},[f,P,n]),(0,o.jsx)("form",{className:(0,s.css)({maxWidth:r!=="none"?r+"px":r,width:"100%"}),onSubmit:O(v),...R,children:l({errors:C.errors,formState:C,trigger:f,...M})})}},91087:(W,g,e)=>{e.d(g,{y:()=>n});var o=e(74848),s=e(96540),d=e(41053),u=e(73427),D=e(96673),A=e(59812),v=e(12037);const n=({basicRole:P,roles:l,userId:i,orgId:r,onBasicRoleChange:R,roleOptions:O,disabled:f,basicRoleDisabled:C,basicRoleDisabledMessage:M,apply:j=!1,onApplyRoles:c,pendingRoles:t,maxWidth:x,width:B,isLoading:U})=>{const[{loading:F,value:L=l||[]},I]=(0,d.A)(async()=>{try{if(l)return l;if(j&&t?.length)return t;if(u.TP.hasPermission(D.AccessControlAction.ActionUserRolesList)&&i>0)return await(0,v.Xh)(i,r)}catch{console.error("Error loading options")}return[]},[r,i,t,l]);(0,s.useEffect)(()=>{r&&I()},[I,r]);const N=async E=>{j?c&&c(E,i,r):(await(0,v.eA)(E,i,r),await I())},h=u.TP.hasPermission(D.AccessControlAction.ActionUserRolesAdd)&&u.TP.hasPermission(D.AccessControlAction.ActionUserRolesRemove);return(0,o.jsx)(A.n,{appliedRoles:L,basicRole:P,onRolesChange:N,onBasicRoleChange:R,roleOptions:O,isLoading:F||U,disabled:f,basicRoleDisabled:C,basicRoleDisabledMessage:M,showBasicRole:!0,apply:j,canUpdateRoles:h,maxWidth:x,width:B})}},31908:(W,g,e)=>{e.d(g,{I:()=>r});var o=e(74848),s=e(49785),d=e(47184),u=e(89640),D=e(8207),A=e(37386),v=e(77824),n=e(56840),P=e(96673);const l=Object.keys(P.OrgRole).map(d.z),i=(0,o.jsxs)(n.x6,{i18nKey:"role-picker.title.description",children:["Assign roles to users to ensure granular control over access to Grafana\u2018s features and resources. Find out more in our"," ",(0,o.jsx)(u.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/roles-and-permissions/#organization-roles",children:"documentation"}),"."]}),r=({onClose:R})=>{const O=(0,s.xW)(),{control:f,getValues:C,setValue:M}=O,[j,c]=C(["name","roles"]);return(0,o.jsx)(D._,{title:j,subtitle:i,onClose:R,children:(0,o.jsx)(A.D,{label:(0,n.t)("role-picker-drawer.basic-roles.label","Basic Roles"),children:(0,o.jsx)(s.xI,{name:"role",control:f,render:({field:{onChange:t,ref:x,...B}})=>(0,o.jsx)(v.z,{...B,options:l,onChange:U=>{M("roleCollection",[U,...c]),t(U)}})})})})}},9390:(W,g,e)=>{e.d(g,{r:()=>v});var o=e(74848),s=e(90382),d=e(18857),u=e(56840);const A=Object.values(s.X).filter(n=>n!==s.X.None).map(n=>({label:n,value:n}));function v({value:n,onChange:P,"aria-label":l,inputId:i,autoFocus:r,...R}){return(0,o.jsx)(d.l6,{inputId:i,value:n,options:A,onChange:O=>P(O.value??s.X.None),placeholder:(0,u.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":l,autoFocus:r,...R})}},41150:(W,g,e)=>{e.r(g),e.d(g,{ServiceAccountCreatePage:()=>I,default:()=>N});var o=e(74848),s=e(96540),d=e(49785),u=e(68143),D=e(36490),A=e(43173),v=e(16780),n=e(37386),P=e(63527),l=e(45861),i=e(74410),r=e(13791),R=e(91087),O=e(12037),f=e(47184),C=e(18857),M=e(31908);const j=({})=>{const[h,E]=(0,s.useState)(!1),{control:K}=(0,d.xW)(),y=()=>E(!h);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(d.xI,{name:"role-collection",control:K,render:({field:{ref:z,value:S,...$}})=>(0,o.jsx)(C.KF,{...$,onOpenMenu:y,onChange:()=>{},value:S?.map(f.z)})}),h&&(0,o.jsx)(M.I,{onClose:y})]})};var c=e(73427),t=e(56840),x=e(96673),B=e(9390);const U=async h=>{const E=await(0,u.AI)().post("/api/serviceaccounts/",h);return await c.TP.fetchUserPermissions(),E},F=async(h,E)=>(0,u.AI)().patch(`/api/serviceaccounts/${h}`,E),L={id:0,uid:"",orgId:c.TP.user.orgId,role:c.TP.licensedAccessControlEnabled()?x.OrgRole.None:x.OrgRole.Viewer,tokens:0,name:"",login:"",isDisabled:!1,createdAt:"",teams:[]},I=({})=>{const[h,E]=(0,s.useState)([]),[K,y]=(0,s.useState)([]),z=(0,d.mN)({defaultValues:{name:"",role:L.role,roleCollection:[L.role],roles:[]}}),{formState:{errors:S},register:$}=z,V=c.TP.user.orgId,[T,Y]=(0,s.useState)(L);(0,s.useEffect)(()=>{async function m(){try{if(c.TP.hasPermission(x.AccessControlAction.ActionRolesList)){let a=await(0,O.RL)(V);E(a)}}catch(a){console.error("Error loading options",a)}}c.TP.licensedAccessControlEnabled()&&m()},[V]);const b=(0,s.useCallback)(async m=>{m.role=T.role;const a=await U(m);try{const p={avatarUrl:a.avatarUrl,id:a.id,uid:a.uid,isDisabled:a.isDisabled,login:a.login,name:a.name,orgId:a.orgId,role:a.role,tokens:a.tokens};await F(p.uid,m),c.TP.licensedAccessControlEnabled()&&c.TP.hasPermission(x.AccessControlAction.ActionUserRolesAdd)&&c.TP.hasPermission(x.AccessControlAction.ActionUserRolesRemove)&&await(0,O.eA)(K,p.id,p.orgId)}catch(p){console.error(p)}D.Ny.push(`/org/serviceaccounts/${a.uid}`)},[T.role,K]),X=m=>{Y({...T,role:m})},G=(m,a,p)=>{y(m)};return(0,o.jsx)(r.Y,{navId:"serviceaccounts",pageNav:{text:(0,t.t)("service-account-create-page.page-nav.label","Create service account")},children:(0,o.jsxs)(r.Y.Contents,{children:[A.$.featureToggles.rolePickerDrawer&&(0,o.jsx)(d.Op,{...z,children:(0,o.jsxs)("form",{children:[(0,o.jsxs)(v.n,{children:[(0,o.jsx)(n.D,{label:(0,t.t)("service-account-create-page.name.label","Display name"),required:!0,invalid:!!S.name,error:S.name?(0,t.t)("service-account-create-page.name.required-error","Display name is required"):void 0,children:(0,o.jsx)(P.p,{id:"name",...$("name",{required:!0}),autoFocus:!0})}),(0,o.jsx)(n.D,{label:(0,t.t)("service-account-create-page.role.label","Role"),children:(0,o.jsx)(j,{})})]}),(0,o.jsx)(l.$n,{type:"submit",children:(0,o.jsx)(t.x6,{i18nKey:"service-account-create-page.create.button",children:"Create"})})]})}),!A.$.featureToggles.rolePickerDrawer&&(0,o.jsx)(i.l,{onSubmit:b,validateOn:"onSubmit",children:({register:m,errors:a})=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(v.n,{children:[(0,o.jsx)(n.D,{label:(0,t.t)("service-account-create-page.name.label","Display name"),required:!0,invalid:!!a.name,error:a.name?(0,t.t)("service-account-create-page.name.required-error","Display name is required"):void 0,children:(0,o.jsx)(P.p,{id:"display-name-input",...m("name",{required:!0}),autoFocus:!0})}),(0,o.jsx)(n.D,{label:(0,t.t)("service-account-create-page.role.label","Role"),children:c.TP.licensedAccessControlEnabled()?(0,o.jsx)(R.y,{apply:!0,userId:T.id||0,orgId:T.orgId,basicRole:T.role,onBasicRoleChange:X,roleOptions:h,onApplyRoles:G,pendingRoles:K,maxWidth:"100%"}):(0,o.jsx)(B.r,{"aria-label":(0,t.t)("service-account-create-page.role.label","Role"),value:T.role,onChange:X})})]}),(0,o.jsx)(l.$n,{type:"submit",children:(0,o.jsx)(t.x6,{i18nKey:"service-account-create-page.create.button",children:"Create"})})]})})]})})},N=I}}]);

//# sourceMappingURL=ServiceAccountCreatePage.6ac1ebaf1cc20c02428e.js.map