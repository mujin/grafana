"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5902],{79682:(qe,te,S)=>{S.r(te),S.d(te,{default:()=>Ye});var I=S(74848),pe=S(43561),y=S(96540),ve=S(70713),b=S(56838),w=S(2543);function O(s,e,...t){let i=!1;typeof window<"u"&&(i=localStorage.getItem("grafana.debug.scenes")==="true"),i&&console.log(`${s}: `,e,...t)}class ie extends b.Bs{constructor(e){var t,i;super({...e,children:(t=e?.children)!=null?t:[],childContexts:(i=e?.childContexts)!=null?i:[]})}addToScene(e){this.publishEvent(new b.sU(e),!0),this.setState({children:[...this.state.children,e]}),O("SceneContext",`Adding to scene: ${e.constructor.name} key: ${e.state.key}`);const t=e.activate();return()=>{O("SceneContext",`Removing from scene: ${e.constructor.name} key: ${e.state.key}`),this.setState({children:this.state.children.filter(i=>i!==e)}),t()}}findByKey(e){return this.state.children.find(t=>t.state.key===e)}findVariable(e){const t=this.state.$variables;if(t)return t.getByName(e)}addVariable(e){let t=this.state.$variables;return this.publishEvent(new b.sU(e),!0),t?t.setState({variables:[...t.state.variables,e]}):(t=new b.Pj({variables:[e]}),this.setState({$variables:t})),O("SceneContext",`Adding variable: ${e.constructor.name} key: ${e.state.key}`),()=>{t.setState({variables:t.state.variables.filter(i=>i!==e)}),O("SceneContext",`Removing variable: ${e.constructor.name} key: ${e.state.key}`)}}addChildContext(e){var t;this.publishEvent(new b.sU(e),!0),this.setState({childContexts:[...(t=this.state.childContexts)!=null?t:[],e]}),O("SceneContext",`Adding child context: ${e.constructor.name} key: ${e.state.key}`)}removeChildContext(e){var t;this.setState({childContexts:(t=this.state.childContexts)==null?void 0:t.filter(i=>e!==i)}),O("SceneContext",`Remvoing child context: ${e.constructor.name} key: ${e.state.key}`)}}const $=(0,y.createContext)(null);function ye({children:s,timeRange:e,withQueryController:t}){const i=(0,y.useContext)($),[n,r]=(0,y.useState)(),a=e;if((0,y.useEffect)(()=>{const l={children:[]};t&&(l.$behaviors=[new b.Gg.Hf]),a&&(l.$timeRange=new b.JZ(a));const u=new ie(l);i&&i.addChildContext(u);const h=u.activate();return r(u),()=>{h(),i&&i.removeChildContext(u)}},[i,t]),!n)return null;const o=y.createElement($.Provider,{value:n},s);return i?o:y.createElement(b.$L,{scene:n,updateUrlOnInit:!0,createBrowserHistorySteps:!0},o)}function R(){const s=(0,y.useContext)($);if(!s)throw new Error("Cannot find a SceneContext");return s}function Xe(){const s=R(),e=sceneGraph.getTimeRange(s),{value:t}=e.useState();return[t,e]}function et(){const s=R();return sceneGraph.getVariables(s).useState().variables}function Se({timeRange:s,variables:e=[]}){const t=R(),[i,n]=useState();return useEffect(()=>{const r=new Subscription;if(e&&e.length>0)for(const a of e){const o=sceneGraph.lookupVariable(a,t);o&&r.add(o.subscribeToEvent(SceneVariableValueChangedEvent,()=>{n({variableName:o.state.name,variableValue:o.getValue()})}))}return s&&sceneGraph.getTimeRange(t).subscribeToState((o,l)=>{o.value!==l.value&&n({timeRange:o.value})}),()=>r.unsubscribe()},[t,s,...e]),i}function tt(s){const e=R();return Se(s),useCallback(t=>sceneGraph.interpolate(e,t),[e])}const V=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,se=new Set,H=typeof process=="object"&&process?process:{},ne=(s,e,t,i)=>{typeof H.emitWarning=="function"?H.emitWarning(s,e,t,i):console.error(`[${t}] ${e}: ${s}`)};let j=globalThis.AbortController,re=globalThis.AbortSignal;if(typeof j>"u"){re=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(i,n){this._onabort.push(n)}},j=class{constructor(){e()}signal=new re;abort(i){if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(const n of this.signal._onabort)n(i);this.signal.onabort?.(i)}}};let s=H.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const e=()=>{s&&(s=!1,ne("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const be=s=>!se.has(s),it=Symbol("type"),T=s=>s&&s===Math.floor(s)&&s>0&&isFinite(s),ae=s=>T(s)?s<=Math.pow(2,8)?Uint8Array:s<=Math.pow(2,16)?Uint16Array:s<=Math.pow(2,32)?Uint32Array:s<=Number.MAX_SAFE_INTEGER?k:null:null;class k extends Array{constructor(e){super(e),this.fill(0)}}class L{heap;length;static#l=!1;static create(e){const t=ae(e);if(!t)return[];L.#l=!0;const i=new L(e,t);return L.#l=!1,i}constructor(e,t){if(!L.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class B{#l;#u;#m;#p;#O;#R;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#v;#s;#i;#e;#h;#f;#o;#r;#y;#a;#S;#b;#d;#w;#A;#c;static unsafeExposeInternals(e){return{starts:e.#b,ttls:e.#d,sizes:e.#S,keyMap:e.#s,keyList:e.#i,valList:e.#e,next:e.#h,prev:e.#f,get head(){return e.#o},get tail(){return e.#r},free:e.#y,isBackgroundFetch:t=>e.#t(t),backgroundFetch:(t,i,n,r)=>e.#L(t,i,n,r),moveToTail:t=>e.#P(t),indexes:t=>e.#x(t),rindexes:t=>e.#C(t),isStale:t=>e.#g(t)}}get max(){return this.#l}get maxSize(){return this.#u}get calculatedSize(){return this.#v}get size(){return this.#n}get fetchMethod(){return this.#O}get memoMethod(){return this.#R}get dispose(){return this.#m}get disposeAfter(){return this.#p}constructor(e){const{max:t=0,ttl:i,ttlResolution:n=1,ttlAutopurge:r,updateAgeOnGet:a,updateAgeOnHas:o,allowStale:l,dispose:u,disposeAfter:h,noDisposeOnSet:c,noUpdateTTL:f,maxSize:p=0,maxEntrySize:A=0,sizeCalculation:d,fetchMethod:C,memoMethod:m,noDeleteOnFetchRejection:v,noDeleteOnStaleGet:x,allowStaleOnFetchRejection:g,allowStaleOnFetchAbort:E,ignoreFetchAbort:F}=e;if(t!==0&&!T(t))throw new TypeError("max option must be a nonnegative integer");const P=t?ae(t):Array;if(!P)throw new Error("invalid max value: "+t);if(this.#l=t,this.#u=p,this.maxEntrySize=A||this.#u,this.sizeCalculation=d,this.sizeCalculation){if(!this.#u&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(m!==void 0&&typeof m!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#R=m,C!==void 0&&typeof C!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#O=C,this.#A=!!C,this.#s=new Map,this.#i=new Array(t).fill(void 0),this.#e=new Array(t).fill(void 0),this.#h=new P(t),this.#f=new P(t),this.#o=0,this.#r=0,this.#y=L.create(t),this.#n=0,this.#v=0,typeof u=="function"&&(this.#m=u),typeof h=="function"?(this.#p=h,this.#a=[]):(this.#p=void 0,this.#a=void 0),this.#w=!!this.#m,this.#c=!!this.#p,this.noDisposeOnSet=!!c,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!v,this.allowStaleOnFetchRejection=!!g,this.allowStaleOnFetchAbort=!!E,this.ignoreFetchAbort=!!F,this.maxEntrySize!==0){if(this.#u!==0&&!T(this.#u))throw new TypeError("maxSize must be a positive integer if specified");if(!T(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#G()}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!x,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!o,this.ttlResolution=T(n)||n===0?n:1,this.ttlAutopurge=!!r,this.ttl=i||0,this.ttl){if(!T(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#D()}if(this.#l===0&&this.ttl===0&&this.#u===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#u){const M="LRU_CACHE_UNBOUNDED";be(M)&&(se.add(M),ne("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",M,B))}}getRemainingTTL(e){return this.#s.has(e)?1/0:0}#D(){const e=new k(this.#l),t=new k(this.#l);this.#d=e,this.#b=t,this.#U=(r,a,o=V.now())=>{if(t[r]=a!==0?o:0,e[r]=a,a!==0&&this.ttlAutopurge){const l=setTimeout(()=>{this.#g(r)&&this.#E(this.#i[r],"expire")},a+1);l.unref&&l.unref()}},this.#T=r=>{t[r]=e[r]!==0?V.now():0},this.#I=(r,a)=>{if(e[a]){const o=e[a],l=t[a];if(!o||!l)return;r.ttl=o,r.start=l,r.now=i||n();const u=r.now-l;r.remainingTTL=o-u}};let i=0;const n=()=>{const r=V.now();if(this.ttlResolution>0){i=r;const a=setTimeout(()=>i=0,this.ttlResolution);a.unref&&a.unref()}return r};this.getRemainingTTL=r=>{const a=this.#s.get(r);if(a===void 0)return 0;const o=e[a],l=t[a];if(!o||!l)return 1/0;const u=(i||n())-l;return o-u},this.#g=r=>{const a=t[r],o=e[r];return!!o&&!!a&&(i||n())-a>o}}#T=()=>{};#I=()=>{};#U=()=>{};#g=()=>!1;#G(){const e=new k(this.#l);this.#v=0,this.#S=e,this.#F=t=>{this.#v-=e[t],e[t]=0},this.#W=(t,i,n,r)=>{if(this.#t(i))return 0;if(!T(n))if(r){if(typeof r!="function")throw new TypeError("sizeCalculation must be a function");if(n=r(i,t),!T(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return n},this.#z=(t,i,n)=>{if(e[t]=i,this.#u){const r=this.#u-e[t];for(;this.#v>r;)this.#V(!0)}this.#v+=e[t],n&&(n.entrySize=i,n.totalCalculatedSize=this.#v)}}#F=e=>{};#z=(e,t,i)=>{};#W=(e,t,i,n)=>{if(i||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#x({allowStale:e=this.allowStale}={}){if(this.#n)for(let t=this.#r;!(!this.#$(t)||((e||!this.#g(t))&&(yield t),t===this.#o));)t=this.#f[t]}*#C({allowStale:e=this.allowStale}={}){if(this.#n)for(let t=this.#o;!(!this.#$(t)||((e||!this.#g(t))&&(yield t),t===this.#r));)t=this.#h[t]}#$(e){return e!==void 0&&this.#s.get(this.#i[e])===e}*entries(){for(const e of this.#x())this.#e[e]!==void 0&&this.#i[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#i[e],this.#e[e]])}*rentries(){for(const e of this.#C())this.#e[e]!==void 0&&this.#i[e]!==void 0&&!this.#t(this.#e[e])&&(yield[this.#i[e],this.#e[e]])}*keys(){for(const e of this.#x()){const t=this.#i[e];t!==void 0&&!this.#t(this.#e[e])&&(yield t)}}*rkeys(){for(const e of this.#C()){const t=this.#i[e];t!==void 0&&!this.#t(this.#e[e])&&(yield t)}}*values(){for(const e of this.#x())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}*rvalues(){for(const e of this.#C())this.#e[e]!==void 0&&!this.#t(this.#e[e])&&(yield this.#e[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(const i of this.#x()){const n=this.#e[i],r=this.#t(n)?n.__staleWhileFetching:n;if(r!==void 0&&e(r,this.#i[i],this))return this.get(this.#i[i],t)}}forEach(e,t=this){for(const i of this.#x()){const n=this.#e[i],r=this.#t(n)?n.__staleWhileFetching:n;r!==void 0&&e.call(t,r,this.#i[i],this)}}rforEach(e,t=this){for(const i of this.#C()){const n=this.#e[i],r=this.#t(n)?n.__staleWhileFetching:n;r!==void 0&&e.call(t,r,this.#i[i],this)}}purgeStale(){let e=!1;for(const t of this.#C({allowStale:!0}))this.#g(t)&&(this.#E(this.#i[t],"expire"),e=!0);return e}info(e){const t=this.#s.get(e);if(t===void 0)return;const i=this.#e[t],n=this.#t(i)?i.__staleWhileFetching:i;if(n===void 0)return;const r={value:n};if(this.#d&&this.#b){const a=this.#d[t],o=this.#b[t];if(a&&o){const l=a-(V.now()-o);r.ttl=l,r.start=Date.now()}}return this.#S&&(r.size=this.#S[t]),r}dump(){const e=[];for(const t of this.#x({allowStale:!0})){const i=this.#i[t],n=this.#e[t],r=this.#t(n)?n.__staleWhileFetching:n;if(r===void 0||i===void 0)continue;const a={value:r};if(this.#d&&this.#b){a.ttl=this.#d[t];const o=V.now()-this.#b[t];a.start=Math.floor(Date.now()-o)}this.#S&&(a.size=this.#S[t]),e.unshift([i,a])}return e}load(e){this.clear();for(const[t,i]of e){if(i.start){const n=Date.now()-i.start;i.start=V.now()-n}this.set(t,i.value,i)}}set(e,t,i={}){if(t===void 0)return this.delete(e),this;const{ttl:n=this.ttl,start:r,noDisposeOnSet:a=this.noDisposeOnSet,sizeCalculation:o=this.sizeCalculation,status:l}=i;let{noUpdateTTL:u=this.noUpdateTTL}=i;const h=this.#W(e,t,i.size||0,o);if(this.maxEntrySize&&h>this.maxEntrySize)return l&&(l.set="miss",l.maxEntrySizeExceeded=!0),this.#E(e,"set"),this;let c=this.#n===0?void 0:this.#s.get(e);if(c===void 0)c=this.#n===0?this.#r:this.#y.length!==0?this.#y.pop():this.#n===this.#l?this.#V(!1):this.#n,this.#i[c]=e,this.#e[c]=t,this.#s.set(e,c),this.#h[this.#r]=c,this.#f[c]=this.#r,this.#r=c,this.#n++,this.#z(c,h,l),l&&(l.set="add"),u=!1;else{this.#P(c);const f=this.#e[c];if(t!==f){if(this.#A&&this.#t(f)){f.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:p}=f;p!==void 0&&!a&&(this.#w&&this.#m?.(p,e,"set"),this.#c&&this.#a?.push([p,e,"set"]))}else a||(this.#w&&this.#m?.(f,e,"set"),this.#c&&this.#a?.push([f,e,"set"]));if(this.#F(c),this.#z(c,h,l),this.#e[c]=t,l){l.set="replace";const p=f&&this.#t(f)?f.__staleWhileFetching:f;p!==void 0&&(l.oldValue=p)}}else l&&(l.set="update")}if(n!==0&&!this.#d&&this.#D(),this.#d&&(u||this.#U(c,n,r),l&&this.#I(l,c)),!a&&this.#c&&this.#a){const f=this.#a;let p;for(;p=f?.shift();)this.#p?.(...p)}return this}pop(){try{for(;this.#n;){const e=this.#e[this.#o];if(this.#V(!0),this.#t(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#c&&this.#a){const e=this.#a;let t;for(;t=e?.shift();)this.#p?.(...t)}}}#V(e){const t=this.#o,i=this.#i[t],n=this.#e[t];return this.#A&&this.#t(n)?n.__abortController.abort(new Error("evicted")):(this.#w||this.#c)&&(this.#w&&this.#m?.(n,i,"evict"),this.#c&&this.#a?.push([n,i,"evict"])),this.#F(t),e&&(this.#i[t]=void 0,this.#e[t]=void 0,this.#y.push(t)),this.#n===1?(this.#o=this.#r=0,this.#y.length=0):this.#o=this.#h[t],this.#s.delete(i),this.#n--,t}has(e,t={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:n}=t,r=this.#s.get(e);if(r!==void 0){const a=this.#e[r];if(this.#t(a)&&a.__staleWhileFetching===void 0)return!1;if(this.#g(r))n&&(n.has="stale",this.#I(n,r));else return i&&this.#T(r),n&&(n.has="hit",this.#I(n,r)),!0}else n&&(n.has="miss");return!1}peek(e,t={}){const{allowStale:i=this.allowStale}=t,n=this.#s.get(e);if(n===void 0||!i&&this.#g(n))return;const r=this.#e[n];return this.#t(r)?r.__staleWhileFetching:r}#L(e,t,i,n){const r=t===void 0?void 0:this.#e[t];if(this.#t(r))return r;const a=new j,{signal:o}=i;o?.addEventListener("abort",()=>a.abort(o.reason),{signal:a.signal});const l={signal:a.signal,options:i,context:n},u=(d,C=!1)=>{const{aborted:m}=a.signal,v=i.ignoreFetchAbort&&d!==void 0;if(i.status&&(m&&!C?(i.status.fetchAborted=!0,i.status.fetchError=a.signal.reason,v&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),m&&!v&&!C)return c(a.signal.reason);const x=p;return this.#e[t]===p&&(d===void 0?x.__staleWhileFetching?this.#e[t]=x.__staleWhileFetching:this.#E(e,"fetch"):(i.status&&(i.status.fetchUpdated=!0),this.set(e,d,l.options))),d},h=d=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=d),c(d)),c=d=>{const{aborted:C}=a.signal,m=C&&i.allowStaleOnFetchAbort,v=m||i.allowStaleOnFetchRejection,x=v||i.noDeleteOnFetchRejection,g=p;if(this.#e[t]===p&&(!x||g.__staleWhileFetching===void 0?this.#E(e,"fetch"):m||(this.#e[t]=g.__staleWhileFetching)),v)return i.status&&g.__staleWhileFetching!==void 0&&(i.status.returnedStale=!0),g.__staleWhileFetching;if(g.__returned===g)throw d},f=(d,C)=>{const m=this.#O?.(e,r,l);m&&m instanceof Promise&&m.then(v=>d(v===void 0?void 0:v),C),a.signal.addEventListener("abort",()=>{(!i.ignoreFetchAbort||i.allowStaleOnFetchAbort)&&(d(void 0),i.allowStaleOnFetchAbort&&(d=v=>u(v,!0)))})};i.status&&(i.status.fetchDispatched=!0);const p=new Promise(f).then(u,h),A=Object.assign(p,{__abortController:a,__staleWhileFetching:r,__returned:void 0});return t===void 0?(this.set(e,A,{...l.options,status:void 0}),t=this.#s.get(e)):this.#e[t]=A,A}#t(e){if(!this.#A)return!1;const t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof j}async fetch(e,t={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:a=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:l=0,sizeCalculation:u=this.sizeCalculation,noUpdateTTL:h=this.noUpdateTTL,noDeleteOnFetchRejection:c=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:f=this.allowStaleOnFetchRejection,ignoreFetchAbort:p=this.ignoreFetchAbort,allowStaleOnFetchAbort:A=this.allowStaleOnFetchAbort,context:d,forceRefresh:C=!1,status:m,signal:v}=t;if(!this.#A)return m&&(m.fetch="get"),this.get(e,{allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:r,status:m});const x={allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:r,ttl:a,noDisposeOnSet:o,size:l,sizeCalculation:u,noUpdateTTL:h,noDeleteOnFetchRejection:c,allowStaleOnFetchRejection:f,allowStaleOnFetchAbort:A,ignoreFetchAbort:p,status:m,signal:v};let g=this.#s.get(e);if(g===void 0){m&&(m.fetch="miss");const E=this.#L(e,g,x,d);return E.__returned=E}else{const E=this.#e[g];if(this.#t(E)){const me=i&&E.__staleWhileFetching!==void 0;return m&&(m.fetch="inflight",me&&(m.returnedStale=!0)),me?E.__staleWhileFetching:E.__returned=E}const F=this.#g(g);if(!C&&!F)return m&&(m.fetch="hit"),this.#P(g),n&&this.#T(g),m&&this.#I(m,g),E;const P=this.#L(e,g,x,d),ee=P.__staleWhileFetching!==void 0&&i;return m&&(m.fetch=F?"stale":"refresh",ee&&F&&(m.returnedStale=!0)),ee?P.__staleWhileFetching:P.__returned=P}}async forceFetch(e,t={}){const i=await this.fetch(e,t);if(i===void 0)throw new Error("fetch() returned undefined");return i}memo(e,t={}){const i=this.#R;if(!i)throw new Error("no memoMethod provided to constructor");const{context:n,forceRefresh:r,...a}=t,o=this.get(e,a);if(!r&&o!==void 0)return o;const l=i(e,o,{options:a,context:n});return this.set(e,l,a),l}get(e,t={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:a}=t,o=this.#s.get(e);if(o!==void 0){const l=this.#e[o],u=this.#t(l);return a&&this.#I(a,o),this.#g(o)?(a&&(a.get="stale"),u?(a&&i&&l.__staleWhileFetching!==void 0&&(a.returnedStale=!0),i?l.__staleWhileFetching:void 0):(r||this.#E(e,"expire"),a&&i&&(a.returnedStale=!0),i?l:void 0)):(a&&(a.get="hit"),u?l.__staleWhileFetching:(this.#P(o),n&&this.#T(o),l))}else a&&(a.get="miss")}#j(e,t){this.#f[t]=e,this.#h[e]=t}#P(e){e!==this.#r&&(e===this.#o?this.#o=this.#h[e]:this.#j(this.#f[e],this.#h[e]),this.#j(this.#r,e),this.#r=e)}delete(e){return this.#E(e,"delete")}#E(e,t){let i=!1;if(this.#n!==0){const n=this.#s.get(e);if(n!==void 0)if(i=!0,this.#n===1)this.#k(t);else{this.#F(n);const r=this.#e[n];if(this.#t(r)?r.__abortController.abort(new Error("deleted")):(this.#w||this.#c)&&(this.#w&&this.#m?.(r,e,t),this.#c&&this.#a?.push([r,e,t])),this.#s.delete(e),this.#i[n]=void 0,this.#e[n]=void 0,n===this.#r)this.#r=this.#f[n];else if(n===this.#o)this.#o=this.#h[n];else{const a=this.#f[n];this.#h[a]=this.#h[n];const o=this.#h[n];this.#f[o]=this.#f[n]}this.#n--,this.#y.push(n)}}if(this.#c&&this.#a?.length){const n=this.#a;let r;for(;r=n?.shift();)this.#p?.(...r)}return i}clear(){return this.#k("delete")}#k(e){for(const t of this.#C({allowStale:!0})){const i=this.#e[t];if(this.#t(i))i.__abortController.abort(new Error("deleted"));else{const n=this.#i[t];this.#w&&this.#m?.(i,n,e),this.#c&&this.#a?.push([i,n,e])}}if(this.#s.clear(),this.#e.fill(void 0),this.#i.fill(void 0),this.#d&&this.#b&&(this.#d.fill(0),this.#b.fill(0)),this.#S&&this.#S.fill(0),this.#o=0,this.#r=0,this.#y.length=0,this.#v=0,this.#n=0,this.#c&&this.#a){const t=this.#a;let i;for(;i=t?.shift();)this.#p?.(...i)}}}var oe=s=>{throw TypeError(s)},le=(s,e,t)=>e.has(s)||oe("Cannot "+t),D=(s,e,t)=>(le(s,e,"read from private field"),t?t.call(s):e.get(s)),_=(s,e,t)=>e.has(s)?oe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),he=(s,e,t,i)=>(le(s,e,"write to private field"),e.set(s,t),t),we=(s,e,t,i)=>({set _(n){he(s,e,n)},get _(){return D(s,e,i)}}),U,G,K;class xe{constructor(){_(this,U),_(this,G,new WeakMap),_(this,K,0),he(this,U,new B({max:500,ttl:1e3*60*5}))}add(e,t){D(this,U).set(e,t)}get(e){return D(this,U).get(e)}getHashKey(e,t){return Array.isArray(e)?`${t.name}-${e.map(i=>this.getHashKeyElement(i)).join()}`:`${t.name}-${this.getHashKeyElement(e)}`}getByRefHashKey(e){let t=D(this,G).get(e);return t==null&&(t=we(this,K)._++,D(this,G).set(e,t)),t}getHashKeyElement(e){return typeof e=="string"||typeof e=="boolean"||typeof e=="number"?e:Ee(e)}}U=new WeakMap,G=new WeakMap,K=new WeakMap;let N;function Ce(){return N||(N=new xe)}function Ee(s){return JSON.stringify(s,(e,t)=>(0,w.isPlainObject)(t)?Object.keys(t).sort().reduce((i,n)=>(i[n]=t[n],i),{}):t)}function Ie(s){const e=R(),t=(0,y.useId)(),i=Ce();let n=s.cacheKey?i.getHashKey(s.cacheKey,s.objectConstructor):void 0,r=e.findByKey(t);return!r&&n&&(r=i.get(n),r&&r.parent!==e&&(b.jh.findObject(e,a=>a===r)?(console.error("A scene object cache key matched an object that is already in the scene"),r=void 0,n=void 0):r.clearParent())),r||(r=s.factory(t),n&&i.add(n,r)),(0,y.useEffect)(()=>e.addToScene(r),[r,e]),r}function Ae(s){const e=Ie({factory:t=>new b.dt({key:t,queries:s.queries,maxDataPoints:s.maxDataPoints,datasource:s.datasource,liveStreaming:s.liveStreaming,maxDataPointsFromWidth:s.maxDataPointsFromWidth}),objectConstructor:b.dt,cacheKey:s.cacheKey});return(0,y.useEffect)(()=>{(0,w.isEqual)(e.state.queries,s.queries)||(e.setState({queries:s.queries}),e.runQueries())},[e,s]),e}function Te(s){const e=R(),t=(0,y.useId)();let i=e.findByKey(t);return i||(i=new b.Es({key:t,$data:new b.wT({source:s.data.getRef()}),transformations:s.transformations})),(0,y.useEffect)(()=>e.addToScene(i),[i,e]),(0,y.useEffect)(()=>{(0,w.isEqual)(i.state.transformations,s.transformations)||(i.setState({transformations:s.transformations}),i.reprocessTransformations())},[i,s.transformations]),i}function st(s){const[e,t]=useTimeRange();return React.createElement(TimeRangePicker$1,{isOnCanvas:!0,value:e,onChange:t.onTimeRangeChange,timeZone:t.getTimeZone(),onMoveBackward:()=>{},onMoveForward:()=>{},onZoom:()=>{},onChangeTimeZone:()=>{},onChangeFiscalYearStartMonth:()=>{}})}function nt({name:s,hideLabel:e,layout:t}){const i=useSceneContext(),n=sceneGraph.lookupVariable(s,i);return n?React.createElement(VariableValueSelectWrapper,{key:n.state.key,variable:n,hideLabel:e,layout:t}):React.createElement("div",null,"Variable ",s," not found")}var Fe=S(84596),Pe=S(69168);function Oe(s){const{title:e,description:t,viz:i,dataProvider:n,displayMode:r,hoverHeader:a,hoverHeaderOffset:o,headerActions:l,menu:u,titleItems:h,extendPanelContext:c,seriesLimit:f,seriesLimitShowAll:p,collapsible:A,collapsed:d}=s,C=R(),m=(0,y.useId)(),v=(0,Fe.A)(s);let x=C.findByKey(m);return x||(x=new b.Eb({key:m,pluginId:i.pluginId,title:e,titleItems:h,description:t,options:i.options,fieldConfig:i.fieldConfig,pluginVersion:i.pluginVersion,$data:ce(n),displayMode:r,hoverHeader:a,hoverHeaderOffset:o,headerActions:l,menu:u,extendPanelContext:c,collapsible:A,collapsed:d,seriesLimit:f,seriesLimitShowAll:p})),(0,y.useEffect)(()=>C.addToScene(x),[x,C]),(0,y.useEffect)(()=>{const g={};if(v){if(e!==v.title&&(g.title=e),t!==v.description&&(g.description=t),r!==v.displayMode&&(g.displayMode=r),a!==v.hoverHeader&&(g.hoverHeader=a),o!==v.hoverHeaderOffset&&(g.hoverHeaderOffset=o),u!==v.menu&&(g.menu=u),h!==v.titleItems&&(g.titleItems=h),l!==v.headerActions&&(g.headerActions=l),n!==v.dataProvider&&(g.$data=ce(n)),f!==v.seriesLimit&&(g.seriesLimit=f),p!==v.seriesLimitShowAll&&(g.seriesLimitShowAll=p),A!==v.collapsible&&(g.collapsible=A),d!==v.collapsed&&(g.collapsed=d),i!==v.viz&&i.pluginId===v.viz.pluginId){const E=x.getPlugin();if(E){const F=(0,Pe.F)({plugin:E,currentOptions:i.options,currentFieldConfig:i.fieldConfig,isAfterPluginChange:!1});g.options=F.options,g.fieldConfig=F.fieldConfig,x.clearFieldConfigCache()}}Object.keys(g).length>0&&(x.setState(g),O("VizPanel","Updating VizPanel state",g))}},[x,e,t,r,a,o,l,u,h,i,n,f,p,A,d,v]),y.createElement(x.Component,{model:x})}function ce(s){return s&&!(s instanceof b.Zv)?new b.wT({source:s.getRef()}):s}function rt(s){const e=useSceneContext(),t=useId(),i=usePrevious(s);let n=e.findByKey(t);return n||(n=new SceneRefreshPicker({key:t,...s})),useEffect(()=>e.addToScene(n),[n,e]),useEffect(()=>{const r={};i&&(s.refresh!==i.refresh&&(r.refresh=s.refresh),s.withText!==i.withText&&(r.withText=s.withText),n.setState(r))},[n,s,i]),React.createElement(n.Component,{model:n})}function at({name:s}){const e=useSceneContext(),t=sceneGraph.getDataLayers(e),i=Re(t,s);return i?React.createElement(i.Component,{model:i}):React.createElement("div",null,"Annotation ",s," not found")}function Re(s,e){for(let t=0;t<s.length;t++){const i=s[t].state.layers.find(n=>n.state.name===e);if(i)return i}}function ot({query:s,name:e,label:t,hide:i,initialValue:n,isMulti:r,includeAll:a,children:o}){const l=useSceneContext(),[u,h]=useState();let c=l.findVariable(e);return c||(c=new CustomVariable$1({name:e,label:t,query:s,value:n,isMulti:r,includeAll:a,hide:i})),useEffect(()=>{const f=l.addVariable(c);return h(!0),f},[c,l,e]),useEffect(()=>{c?.setState({label:t,query:s,hide:i,isMulti:r,includeAll:a})},[i,a,r,t,s,c]),u?o:null}function lt({pluginId:s,regex:e,name:t,label:i,hide:n,initialValue:r,isMulti:a,includeAll:o,children:l}){const u=useSceneContext(),[h,c]=useState();let f=u.findVariable(t);return f||(f=new DataSourceVariable$1({pluginId:s,regex:e,name:t,label:i,value:r,isMulti:a,hide:n,includeAll:o})),useEffect(()=>{const p=u.addVariable(f);return c(!0),p},[f,u,t]),useEffect(()=>{h&&(f.state.pluginId===s&&f.state.regex===e&&f.state.label===i&&f.state.hide===n&&f.state.includeAll===o||(f.setState({pluginId:s,regex:e,label:i,hide:n,includeAll:o}),f.refreshOptions()))},[n,o,i,s,e,f,h]),h?l:null}function ht({query:s,name:e,datasource:t,label:i,hide:n,regex:r,refresh:a,sort:o,initialValue:l,isMulti:u,includeAll:h,children:c}){const f=useSceneContext(),[p,A]=useState();let d=f.findVariable(e);return d||(d=new QueryVariable$1({name:e,label:i,query:s,datasource:t,refresh:a,sort:o,regex:r,value:l,isMulti:u,hide:n,includeAll:h})),useEffect(()=>{const C=f.addVariable(d);return A(!0),C},[d,f,e]),useEffect(()=>{p&&(isEqual(d.state.query,s)&&isEqual(d.state.datasource,t)&&d.state.regex===r&&d.state.label===i&&d.state.hide===n&&d.state.includeAll===h&&d.state.refresh===a&&d.state.sort===o||(d.setState({label:i,query:s,datasource:t,refresh:a,sort:o,regex:r,hide:n,includeAll:h}),d.refreshOptions()))},[t,n,h,i,s,a,r,o,d,p]),p?c:null}const ue=(0,y.createContext)({breadcrumbs:[],addBreadcrumb:()=>{},removeBreadcrumb:()=>{}});function ct({children:s}){const[e,t]=useState([]);return React.createElement(ue.Provider,{value:{breadcrumbs:e,addBreadcrumb:useCallback(i=>t(n=>[...n,i]),[]),removeBreadcrumb:useCallback(i=>t(n=>n.filter(r=>r.url!==i.url)),[])}},s)}function ut({text:s,path:e,extraKeys:t}){const{addBreadcrumb:i,removeBreadcrumb:n}=useContext(ue),r=ze();return useEffect(()=>{const a={text:s,url:r(e,t)};return i(a),()=>{n(a)}},[s,e,t,i,r,n]),null}function ze(){const s=Ve()[0],e=useVariables(),[t,i]=useTimeRange();return useCallback((n,r)=>{const a={};for(const o of e)if(o.urlSync&&!o.state.skipUrlSync){const l=o.urlSync.getUrlState();Object.assign(a,l)}if(i.urlSync){const o=i.urlSync.getUrlState();Object.assign(a,o)}if(r)for(const o of r)s[o]&&(a[o]=s[o]);return urlUtil.renderUrl(n,a)},[e,s,i])}function Ve(){const{search:s}=useLocation(),e=useMemo(()=>locationSearchToObject(s||""),[s]),t=useCallback((i,n)=>locationService.partial(i,n),[]);return[e,t]}function ft(s){const e=useSceneContext(),t=sceneGraph.lookupVariable(s,e);if(!t)return[void 0,!1];t.useState();const n=t.parent.isVariableLoadingOrWaitingToUpdate(t);let r=t.getValue();return r==null?[void 0,n]:(Array.isArray(r)||(r=[r]),[r,n])}function dt(s){const e=useSceneContext();let t=sceneGraph.lookupVariable(s.name,e);return t||(t=new QueryVariable({name:s.name,datasource:{uid:s.datasource},query:s.query,regex:s.regex})),t instanceof QueryVariable||(t=null),useEffect(()=>{t&&e.addVariable(t)},[t,e]),useEffect(()=>{var i;(((i=t?.state.datasource)==null?void 0:i.uid)!==s.datasource||!isEqual(t?.state.query,s.query)||t?.state.regex!==s.regex)&&(t?.setState({datasource:{uid:s.datasource},query:s.query,regex:s.regex}),t?.refreshOptions())},[s,t]),t}function gt(s){const e=useSceneContext(),t=sceneGraph.lookupVariable(s,e);if(!t||t instanceof MultiValueVariable&&t.state.isMulti===!0)return[void 0,!1];t.useState();const n=t.parent.isVariableLoadingOrWaitingToUpdate(t);let r=t.getValue();return r==null?[void 0,n]:[r,n]}function mt({name:s,query:e,children:t}){const i=useSceneContext(),[n,r]=useState();let a=Le(i,s);return a||(a=new dataLayers.AnnotationsDataLayer({name:s,query:e})),useEffect(()=>{const o=De(i,a);return r(!0),o},[i,s,a]),useEffect(()=>{},[n]),n?t:null}function Le(s,e){const t=s.state.$data;if(t)return t.state.layers.find(i=>i.state.name===e)}function De(s,e){let t=s.state.$data;return t?t.setState({layers:[...t.state.layers,e]}):(t=new SceneDataLayerSet({layers:[e]}),s.setState({$data:t})),writeSceneLog("SceneContext",`Adding annotation data layer: ${e.state.name} key: ${e.state.key}`),()=>{t.setState({layers:t.state.layers.filter(i=>i!==e)}),writeSceneLog("SceneContext",`Removing annotation data layer: ${e.state.name} key: ${e.state.key}`)}}class Ue extends b.P1{constructor(e){super({...e,context:new ie})}}Ue.Component=({model:s})=>y.createElement($.Provider,{value:s.state.context},y.createElement(b.P1.Component,{model:s}));var We=S(63142);function $e({children:s,minWidth:e=400,minHeight:t=320}){const i=(0,We.$j)(),n={display:"grid",flexGrow:1,gridTemplateColumns:`repeat(auto-fit, minmax(${e}px, 1fr))`,gridAutoRows:`minmax(${t}px, auto)`,columnGap:i.spacing(1),rowGap:i.spacing(1)};return y.createElement("div",{style:n},s)}var je=S(13791),ke=S(97095),Q=S(18027),Z=S(18857),Y=S(56840);function Ge({provider:s,filteredProvider:e,filter:t,onChange:i}){const{pluginIds:n,extensionPointIds:r,severity:a}=Me(s,e,t),o=h=>{const c={...t,pluginIds:J(h)};(0,w.isEmpty)(t.extensionPointIds)&&(0,w.isEmpty)(t.severity)&&(c.initial=(0,w.isEmpty)(h)?void 0:"pluginId"),i(c)},l=h=>{const c={...t,extensionPointIds:J(h)};(0,w.isEmpty)(t.pluginIds)&&(0,w.isEmpty)(t.severity)&&(c.initial=(0,w.isEmpty)(h)?void 0:"extensionPointId"),i(c)},u=h=>{const c={...t,severity:J(h)};(0,w.isEmpty)(t.pluginIds)&&(0,w.isEmpty)(t.extensionPointIds)&&(c.initial=(0,w.isEmpty)(h)?void 0:"severity"),i(c)};return(0,I.jsxs)(ke.C,{children:[(0,I.jsx)(Q.I,{label:(0,Y.t)("plugins.log-view-filters.label-plugin-id","Plugin Id"),children:(0,I.jsx)(Z.KF,{options:n,onChange:o})}),(0,I.jsx)(Q.I,{label:(0,Y.t)("plugins.log-view-filters.label-extension","Extension"),children:(0,I.jsx)(Z.KF,{options:r,onChange:l})}),(0,I.jsx)(Q.I,{label:(0,Y.t)("plugins.log-view-filters.label-severity","Severity"),children:(0,I.jsx)(Z.KF,{options:a,onChange:u})})]})}function Me(s,e,t){const{data:i}=s.useState(),{data:n}=e.useState();return(0,y.useMemo)(()=>{i&&i?.series.length>1&&console.warn("LogViewFilter does not support multiple series in query result.");const r=i?.series[0],a=n?.series[0];if(!r)return{pluginIds:[],extensionPointIds:[],severity:[]};if(!a)return W({severity:r,pluginId:r,extensionPointId:r});switch(t.initial){case"extensionPointId":return W({severity:a,pluginId:a,extensionPointId:r});case"severity":return W({severity:r,pluginId:a,extensionPointId:a});case"pluginId":return W({severity:a,pluginId:r,extensionPointId:a});default:return W({severity:r,pluginId:r,extensionPointId:r})}},[i,n,t])}function J(s){if(!(s.length<=0))return s.reduce((e,t)=>(t.value&&e.add(t.value),e),new Set)}function q(s){return Array.from(s).reduce((e,t)=>(t&&e.push({value:t,label:t}),e),[])}function W(s){const{severity:e,pluginId:t,extensionPointId:i}=s,n=e.fields.findIndex(h=>h.name==="severity"),r=t.fields.findIndex(h=>h.name==="pluginId"),a=i.fields.findIndex(h=>h.name==="extensionPointId"),o=new Set(e.fields[n].values),l=new Set(t.fields[r].values),u=new Set(i.fields[a].values);return{severity:q(o),pluginIds:q(l),extensionPointIds:q(u)}}var fe=S(29405),de=S(28105),ge=S(41119),He=S(39443),z=S(95004);class Be extends b.UU{constructor(e,t,i){super(e,t),this.pluginId=e,this.uid=t,this.extensionsLog=i}query(e){const[t]=e.targets;return this.extensionsLog.asObservable().pipe((0,fe.S)((i,n)=>{const[r]=i.data;return{data:[_e(t,n,r)],key:t.key??t.refId,state:de.Gu.Streaming}},{data:[],key:t.key??t.refId,state:de.Gu.Streaming}))}testDatasource(){return Promise.resolve({status:"success",message:"OK"})}}function _e(s,e,t){const i=t?.fields?.[0]?.values??[],n=t?.fields?.[1]?.values??[],r=t?.fields?.[2]?.values??[],a=t?.fields?.[3]?.values??[],o=t?.fields?.[4]?.values??[],l=t?.fields?.[5]?.values??[],u=t?.fields?.[6]?.values??[];return(0,ge.EI)({refId:s.refId,meta:{type:He.m.LogLines},fields:[{name:"timestamp",type:z.PU.time,values:[e.timestamp,...i]},{name:"body",type:z.PU.string,values:[e.message,...n]},{name:"severity",type:z.PU.string,values:[e.level,...r]},{name:"id",type:z.PU.string,values:[e.id,...a]},{name:"labels",type:z.PU.other,values:[e.labels,...o]},{name:"pluginId",type:z.PU.string,values:[e.pluginId??null,...l]},{name:"extensionPointId",type:z.PU.string,values:[e.extensionPointId??null,...u]}]})}function Ke(s){return function(){return function(t){return t.pipe((0,fe.S)((i,n)=>{if((0,w.isEmpty)(s.extensionPointIds)&&(0,w.isEmpty)(s.pluginIds)&&(0,w.isEmpty)(s.severity))return n;for(const r of n){const a=r.fields.findIndex(h=>h.name==="pluginId"),o=r.fields.findIndex(h=>h.name==="extensionPointId"),l=r.fields.findIndex(h=>h.name==="severity");if(a===-1&&!(0,w.isEmpty)(s.pluginIds)||o===-1&&!(0,w.isEmpty)(s.extensionPointIds)||l===-1&&!(0,w.isEmpty)(s.severity))continue;const u={...r,fields:r.fields.map(h=>({...h,values:[]}))};for(let h=0;h<r.length;h++){const c=r.fields[a].values[h],f=r.fields[o].values[h],p=r.fields[l].values[h];!(0,w.isEmpty)(s.pluginIds)&&!s.pluginIds?.has(c)||!(0,w.isEmpty)(s.extensionPointIds)&&!s.extensionPointIds?.has(f)||!(0,w.isEmpty)(s.severity)&&!s.severity?.has(p)||Ne(r,u,h)}i.push((0,ge.EI)(u))}return i},[]))}}}function Ne(s,e,t){for(let i=0;i<s.fields.length;i++){const n=s.fields[i];e.fields[i]||(e.fields[i]={...n,values:[]});const r=s.fields[i].values[t];e.fields[i].values?.push(r)}}var Qe=S(96016);const X={uid:(0,pe.Ak)(),type:"grafana-extensionslog-datasource"},Ze=b.Uf.logs().setOption("wrapLogMessage",!0).build();b.Go.registerRuntimeDataSource({dataSource:new Be(X.type,X.uid,Qe.R)});function Ye(){return(0,I.jsx)(ye,{children:(0,I.jsx)(Je,{})})}function Je(){const[s,e]=(0,y.useState)({}),t=Ae({datasource:X,queries:[{refId:"A"}],liveStreaming:!0}),i=Te({transformations:[Ke(s)],data:t});return(0,I.jsx)(je.Y,{navId:"extensions",actions:(0,I.jsx)(Ge,{provider:t,filteredProvider:i,filter:s,onChange:e}),children:(0,I.jsx)(ve.default,{children:({height:n,width:r})=>(0,I.jsx)($e,{minHeight:n,minWidth:r,children:(0,I.jsx)(Oe,{title:"",viz:Ze,dataProvider:i})})})})}}}]);

//# sourceMappingURL=PluginExtensionsLog.2eb11ad3226bc7dd71ba.js.map