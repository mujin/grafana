"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4333],{85185:(U,j,a)=>{a.r(j),a.d(j,{BrowseFolderAlertingPage:()=>V,default:()=>k});var s=a(74848),d=a(96540),c=a(54148),i=a(13791),I=a(66198),_=a(96673),e=a(22803),r=a(2543),b=a(40996),h=a(63142),u=a(41654),B=a(12737),M=a(18857),l=a(30703),D=a(8073),O=a(37658),C=a(34213),R=a(95943),g=a(56840),x=a(1404),T=a(23265),K=a(74048),m=a(20962),y=a(11018),p=a(86017),W=a(52161),S=a(63895),H=a(77256),J=(t=>(t.Ascending="alpha-asc",t.Descending="alpha-desc",t))(J||{});const Q=[{label:"Alphabetically [A-Z]",value:"alpha-asc"},{label:"Alphabetically [Z-A]",value:"alpha-desc"}],N=({folder:t})=>{const n=(0,h.of)(z),P=(0,_.useDispatch)(),L=v=>{const q=(0,p.EU)(o,v);G(q)};(0,d.useEffect)(()=>{P((0,y.mB)({rulesSourceName:W.hY})),P((0,y.eB)({rulesSourceName:W.hY}))},[P]);const A=(0,T.dy)(W.hY),{nameFilter:E,labelFilter:o,sortOrder:f,setNameFilter:F,setLabelFilter:G,setSortOrder:ea}=X(),aa=A.find(v=>v.uid===t.uid)?.groups.flatMap(v=>v.rules)??[],sa=Z(aa,E,o,f??"alpha-asc"),ta=aa.length===0||sa.length===0,{page:na,numberOfPages:oa,onPageChange:ra,pageItems:la}=(0,K.W)(sa,1,R.FG);return(0,s.jsx)("div",{className:n.container,children:(0,s.jsxs)(u.B,{direction:"column",gap:3,children:[(0,s.jsx)(B.Z,{value:E,onChange:F,placeholder:(0,g.t)("alerting.alerts-folder-view.name-filter-placeholder-search-alert-rules-by-name","Search alert rules by name"),"data-testid":"name-filter"}),(0,s.jsxs)(u.B,{direction:"row",children:[(0,s.jsx)(M.l6,{value:f,onChange:({value:v})=>v&&ea(v),options:Q,width:25,"aria-label":(0,g.t)("alerting.alerts-folder-view.aria-label-sort","Sort"),placeholder:"Sort (Default A-Z)",prefix:(0,s.jsx)(l.I,{name:f==="alpha-asc"?"sort-amount-up":"sort-amount-down"})}),(0,s.jsx)(B.Z,{value:o,onChange:G,placeholder:(0,g.t)("alerting.alerts-folder-view.label-filter-placeholder-search-alerts-by-labels","Search alerts by labels"),className:n.filterLabelsInput,"data-testid":"label-filter"})]}),(0,s.jsx)(u.B,{direction:"column",gap:1,children:la.map(v=>(0,s.jsxs)(D.Z,{href:(0,H.w$)("grafana",v,""),className:n.card,"data-testid":"alert-card-row",children:[(0,s.jsx)(D.Z.Heading,{children:v.name}),(0,s.jsx)(D.Z.Tags,{children:(0,s.jsx)(O.L,{onClick:L,tags:Object.entries(v.labels).map(([q,ia])=>`${q}=${ia}`)})}),(0,s.jsx)(D.Z.Meta,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)(l.I,{name:"folder"})," ",t.title]})})]},v.uid?v.uid:v.name))}),ta&&(0,s.jsx)("div",{className:n.noResults,children:(0,s.jsx)(g.x6,{i18nKey:"alerting.alerts-folder-view.no-alert-rules-found",children:"No alert rules found"})}),(0,s.jsx)("div",{className:n.pagination,children:(0,s.jsx)(C.d,{currentPage:na,numberOfPages:oa,onNavigate:ra,hideWhenSinglePage:!0})})]})})};var $=(t=>(t.nameFilter="nameFilter",t.labelFilter="labelFilter",t.sortOrder="sort",t))($||{});function X(){const[t,n]=(0,m.l)(),[P,L]=(0,d.useState)(t.get("nameFilter")??""),[A,E]=(0,d.useState)(t.get("labelFilter")??""),o=t.get("sort"),[f,F]=(0,d.useState)(o==="alpha-asc"?"alpha-asc":o==="alpha-desc"?"alpha-desc":void 0);return(0,b.A)(()=>n({nameFilter:(0,x.fE)(P),labelFilter:(0,x.fE)(A),sort:(0,x.fE)(f)},!0),400,[P,A,f]),{nameFilter:P,labelFilter:A,sortOrder:f,setNameFilter:L,setLabelFilter:E,setSortOrder:F}}function Z(t,n,P,L){const A=(0,S.Zc)(P),E=t.filter(o=>o.name.toLowerCase().includes(n.toLowerCase())&&(0,p.Av)(o.labels,A));return(0,r.orderBy)(E,o=>o.name.toLowerCase(),[L==="alpha-asc"?"asc":"desc"])}const z=t=>({container:(0,e.css)({padding:t.spacing(1)}),card:(0,e.css)({gridTemplateColumns:"auto 1fr 2fr",margin:0}),pagination:(0,e.css)({alignSelf:"center"}),filterLabelsInput:(0,e.css)({flex:1,width:"auto",minWidth:"240px"}),noResults:(0,e.css)({padding:t.spacing(2),backgroundColor:t.colors.background.secondary,fontStyle:"italic"})});var Y=a(15203),w=a(97175);function V(){const{uid:t=""}=(0,c.g)(),{data:n}=(0,Y.kH)(t),P=(0,_.useSelector)(o=>o.folder),[L]=(0,Y.iB)(),A=(0,d.useMemo)(()=>{if(!n)return;const o=(0,I.R4)(n),f=(0,I.Fk)(n.uid),F=o.children?.find(G=>G.id===f);return F&&(F.active=!0),o},[n]),E=t?async o=>{if(n){const f=await L({...n,title:o});if("error"in f)throw f.error}}:void 0;return(0,s.jsx)(i.Y,{navId:"dashboards/browse",pageNav:A,onEditTitle:E,actions:(0,s.jsx)(s.Fragment,{children:n&&(0,s.jsx)(w.m,{folder:n})}),children:(0,s.jsx)(i.Y.Contents,{children:(0,s.jsx)(N,{folder:P})})})}const k=V},72472:(U,j,a)=>{a.d(j,{T:()=>u});var s=a(74848),d=a(96540),c=a(27489),i=a(71599),I=a(66404),_=a(35137),e=a(34999),r=a(56840),b=a(15203),h=a(78059);const u=({onConfirm:B,onDismiss:M,selectedItems:l,...D})=>{const{data:O}=(0,b.G2)(l),C=!!(O&&(O.alertRule||O.libraryPanel)),[R,g]=(0,d.useState)(!1),x=async()=>{(0,c.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:Object.keys(l.dashboard).length,folder:Object.keys(l.folder).length},source:"browse_dashboards",restore_enabled:!1}),g(!0);try{await B(),g(!1),M()}catch{g(!1)}};return(0,s.jsx)(i.u,{body:(0,s.jsxs)(s.Fragment,{children:[!1,(0,s.jsx)(I.E,{element:"p",children:(0,s.jsx)(r.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,s.jsx)(h.x,{selectedItems:l}),(0,s.jsx)(_.$,{v:2})]}),description:(0,s.jsx)(s.Fragment,{children:C?(0,s.jsx)(e.F,{severity:"warning",title:(0,r.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,s.jsx)(r.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,r.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:R?(0,r.t)("browse-dashboards.action.deleting","Deleting..."):(0,r.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:M,onConfirm:x,title:(0,r.t)("browse-dashboards.action.delete-modal-title","Delete"),...D,disabled:C})}},65542:(U,j,a)=>{a.d(j,{J:()=>B});var s=a(74848),d=a(96540),c=a(22787),i=a(34999),I=a(66404),_=a(35137),e=a(37386),r=a(45861),b=a(67804),h=a(56840),u=a(78059);const B=({onConfirm:M,onDismiss:l,selectedItems:D,...O})=>{const[C,R]=(0,d.useState)(),[g,x]=(0,d.useState)(!1),T=Object.keys(D.folder).filter(m=>D.folder[m]),K=async()=>{if(C!==void 0){x(!0);try{await M(C),x(!1),l()}catch{x(!1)}}};return(0,s.jsxs)(c.a,{title:(0,h.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:l,...O,children:[T.length>0&&(0,s.jsx)(i.F,{severity:"info",title:(0,h.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,s.jsx)(I.E,{element:"p",children:(0,s.jsx)(h.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,s.jsx)(u.x,{selectedItems:D}),(0,s.jsx)(_.$,{v:3}),(0,s.jsx)(e.D,{label:(0,h.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,s.jsx)(b.d,{value:C,excludeUIDs:T,onChange:R})}),(0,s.jsxs)(c.a.ButtonRow,{children:[(0,s.jsx)(r.$n,{onClick:l,variant:"secondary",fill:"outline",children:(0,s.jsx)(h.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,s.jsx)(r.$n,{disabled:C===void 0||g,onClick:K,variant:"primary",children:g?(0,h.t)("browse-dashboards.action.moving","Moving..."):(0,h.t)("browse-dashboards.action.move-button","Move")})]})]})}},97175:(U,j,a)=>{a.d(j,{m:()=>K});var s=a(74848),d=a(96540),c=a(43173),i=a(27489),I=a(36490),_=a(87063),e=a(94535),r=a(88559),b=a(45861),h=a(30703),u=a(8207),B=a(54384),M=a(73427),l=a(56840),D=a(27154),O=a(87745),C=a(75735),R=a(15203),g=a(83485),x=a(72472),T=a(65542);function K({folder:m}){const[y,p]=(0,d.useState)(!1),[W,S]=(0,d.useState)(!1),[H]=(0,R.aF)(),[J]=(0,R.Ko)(),{canEditFolders:Q,canDeleteFolders:N,canViewPermissions:$,canSetPermissions:X}=(0,g.N)(m),Z=m.managedBy===C.Sf.Repo,z=c.$.featureToggles.nestedFolders&&Q&&!Z,Y=async E=>{await H({folder:m,destinationUID:E}),(0,i.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},w=async()=>{await J(m),(0,i.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:E}=m,o=E&&E.length?E[E.length-1].url:"/dashboards";I.Ny.push(o)},V=()=>{M.lE.publish(new O.S8({component:T.J,props:{selectedItems:{folder:{[m.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:Y}}))},k=()=>{M.lE.publish(new O.S8({component:x.T,props:{selectedItems:{folder:{[m.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:w}}))},t=()=>{M.lE.publish(new O.S8({component:D.f,props:{resource:m}}))},n=(0,l.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),P=(0,l.t)("browse-dashboards.folder-actions-button.move","Move"),L=(0,l.t)("browse-dashboards.folder-actions-button.delete","Delete"),A=(0,s.jsxs)(_.W,{children:[$&&(0,s.jsx)(e.D,{onClick:()=>S(!0),label:n}),z&&(0,s.jsx)(e.D,{onClick:V,label:P}),N&&(0,s.jsx)(e.D,{destructive:!0,onClick:Z?t:k,label:L})]});return!$&&!z&&!N?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.m,{overlay:A,onVisibleChange:p,children:(0,s.jsxs)(b.$n,{variant:"secondary",children:[(0,s.jsx)(l.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,s.jsx)(h.I,{name:y?"angle-up":"angle-down"})]})}),W&&(0,s.jsx)(u._,{title:(0,l.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:m.title,onClose:()=>S(!1),size:"md",children:(0,s.jsx)(B.x,{resource:"folders",resourceId:m.uid,canSetPermissions:X})})]})}},83485:(U,j,a)=>{a.d(j,{N:()=>_});var s=a(43173),d=a(73427),c=a(96673);function i(e,r){return r?d.TP.hasPermissionInMetadata(e,r):d.TP.hasPermission(e)}function I(e){return e&&e.uid!=="general"&&!s.$.featureToggles.nestedFolders?!1:i(c.AccessControlAction.FoldersCreate,e)}function _(e){const r=i(c.AccessControlAction.DashboardsCreate,e),b=I(e),h=i(c.AccessControlAction.FoldersDelete,e),u=i(c.AccessControlAction.DashboardsWrite,e),B=i(c.AccessControlAction.FoldersWrite,e),M=i(c.AccessControlAction.FoldersPermissionsWrite,e),l=i(c.AccessControlAction.FoldersPermissionsRead,e);return{canCreateDashboards:r,canCreateFolders:b,canDeleteFolders:h,canEditDashboards:u,canEditFolders:B,canSetPermissions:M,canViewPermissions:l}}}}]);

//# sourceMappingURL=FolderAlerting.3153dd7e3bd7ea8e6b6c.js.map