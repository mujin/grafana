{"version":3,"file":"xychart.9b3f9c72bb0976b60723.js","mappings":"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","sources":["webpack://grafana/./packages/grafana-ui/src/components/VizTooltip/VizTooltipWrapper.tsx","webpack://grafana/./public/app/core/components/Layers/LayerName.tsx","webpack://grafana/./public/app/plugins/panel/xychart/SeriesEditor.tsx","webpack://grafana/./public/app/plugins/panel/xychart/XYChartTooltip.tsx","webpack://grafana/./public/app/plugins/panel/xychart/scatter.ts","webpack://grafana/./public/app/plugins/panel/xychart/XYChartPanel.tsx","webpack://grafana/./public/app/plugins/panel/xychart/config.ts","webpack://grafana/./public/app/plugins/panel/xychart/panelcfgold.gen.ts","webpack://grafana/./public/app/plugins/panel/xychart/migrations.ts","webpack://grafana/./public/app/plugins/panel/xychart/module.tsx","webpack://grafana/./public/app/plugins/panel/xychart/panelcfg.gen.ts","webpack://grafana/./public/app/plugins/panel/xychart/utils.ts"],"sourcesContent":["import { css, cx } from '@emotion/css';\nimport React, { HTMLAttributes } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\n\nimport { useStyles2 } from '../../themes';\n\nexport interface Props extends HTMLAttributes<HTMLDivElement> {\n  children?: React.ReactNode;\n}\n\nexport const VizTooltipWrapper = ({ children, className }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  return <div className={cx(styles.wrapper, className)}>{children}</div>;\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css({\n    display: 'flex',\n    flexDirection: 'column',\n    fontSize: theme.typography.bodySmall.fontSize,\n  }),\n});\n","import { css, cx } from '@emotion/css';\nimport { useState } from 'react';\nimport * as React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Icon, Input, FieldValidationMessage, useStyles2 } from '@grafana/ui';\n\nimport { t } from '../../internationalization';\n\nexport interface LayerNameProps {\n  name: string;\n  onChange: (v: string) => void;\n  verifyLayerNameUniqueness?: (nameToCheck: string) => boolean;\n  overrideStyles?: boolean;\n}\n\nexport const LayerName = ({ name, onChange, verifyLayerNameUniqueness, overrideStyles }: LayerNameProps) => {\n  const styles = useStyles2(getStyles);\n\n  const [isEditing, setIsEditing] = useState<boolean>(false);\n  const [validationError, setValidationError] = useState<string | null>(null);\n\n  const onEditLayer = (event: React.SyntheticEvent) => {\n    setIsEditing(true);\n  };\n\n  const onEndEditName = (newName: string) => {\n    setIsEditing(false);\n\n    if (validationError) {\n      setValidationError(null);\n      return;\n    }\n\n    if (name !== newName) {\n      onChange(newName);\n    }\n  };\n\n  const onInputChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n    const newName = event.currentTarget.value.trim();\n\n    if (newName.length === 0) {\n      setValidationError('An empty layer name is not allowed');\n      return;\n    }\n\n    if (verifyLayerNameUniqueness && !verifyLayerNameUniqueness(newName) && newName !== name) {\n      setValidationError('Layer name already exists');\n      return;\n    }\n\n    if (validationError) {\n      setValidationError(null);\n    }\n  };\n\n  const onEditLayerBlur = (event: React.SyntheticEvent<HTMLInputElement>) => {\n    onEndEditName(event.currentTarget.value.trim());\n  };\n\n  const onKeyDown = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    if (event.key === 'Enter') {\n      onEndEditName(event.currentTarget.value);\n    }\n  };\n\n  const onFocus = (event: React.FocusEvent<HTMLInputElement>) => {\n    event.target.select();\n  };\n\n  return (\n    <>\n      <div className={styles.wrapper}>\n        {!isEditing && (\n          <button\n            className={styles.layerNameWrapper}\n            title={t('layers.layer-name.edit-layer-title', 'Edit layer name')}\n            onClick={onEditLayer}\n            data-testid=\"layer-name-div\"\n          >\n            <span className={overrideStyles ? '' : styles.layerName}>{name}</span>\n            <Icon name=\"pen\" className={styles.layerEditIcon} size=\"sm\" />\n          </button>\n        )}\n\n        {isEditing && (\n          <>\n            <Input\n              type=\"text\"\n              defaultValue={name}\n              onBlur={onEditLayerBlur}\n              autoFocus\n              onKeyDown={onKeyDown}\n              onFocus={onFocus}\n              invalid={validationError !== null}\n              onChange={onInputChange}\n              className={styles.layerNameInput}\n              data-testid=\"layer-name-input\"\n            />\n            {validationError && <FieldValidationMessage horizontal>{validationError}</FieldValidationMessage>}\n          </>\n        )}\n      </div>\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css({\n      label: 'Wrapper',\n      display: 'flex',\n      alignItems: 'center',\n      marginLeft: theme.spacing(0.5),\n    }),\n    layerNameWrapper: css({\n      display: 'flex',\n      cursor: 'pointer',\n      border: '1px solid transparent',\n      borderRadius: theme.shape.radius.default,\n      alignItems: 'center',\n      padding: `0 0 0 ${theme.spacing(0.5)}`,\n      margin: 0,\n      background: 'transparent',\n\n      '&:hover': {\n        background: theme.colors.action.hover,\n        border: `1px dashed ${theme.colors.border.strong}`,\n      },\n\n      '&:focus': {\n        border: `2px solid ${theme.colors.primary.border}`,\n      },\n\n      '&:hover, &:focus': {\n        '.query-name-edit-icon': {\n          visibility: 'visible',\n        },\n      },\n    }),\n    layerName: css({\n      fontWeight: theme.typography.fontWeightMedium,\n      color: theme.colors.primary.text,\n      cursor: 'pointer',\n      overflow: 'hidden',\n      marginLeft: theme.spacing(0.5),\n    }),\n    layerEditIcon: cx(\n      css({\n        marginLeft: theme.spacing(2),\n        visibility: 'hidden',\n      }),\n      'query-name-edit-icon'\n    ),\n    layerNameInput: css({\n      maxWidth: '300px',\n      margin: '-4px 0',\n    }),\n  };\n};\n","import { css, cx } from '@emotion/css';\nimport { Fragment, useState } from 'react';\nimport { usePrevious } from 'react-use';\n\nimport {\n  getFrameDisplayName,\n  StandardEditorProps,\n  // getFieldDisplayName,\n  FrameMatcherID,\n  FieldMatcherID,\n  FieldNamePickerBaseNameMode,\n  FieldType,\n  GrafanaTheme2,\n} from '@grafana/data';\nimport { Button, Field, IconButton, Select, useStyles2 } from '@grafana/ui';\nimport { FieldNamePicker } from '@grafana/ui/internal';\nimport { LayerName } from 'app/core/components/Layers/LayerName';\n\nimport { Options, SeriesMapping, XYSeriesConfig } from './panelcfg.gen';\n\nexport const SeriesEditor = ({\n  value: seriesCfg,\n  onChange,\n  context,\n}: StandardEditorProps<XYSeriesConfig[], unknown, Options>) => {\n  const style = useStyles2(getStyles);\n\n  // reset opts when mapping changes (no way to do this in panel opts builder?)\n  const mapping = context.options?.mapping;\n  const prevMapping = usePrevious(mapping);\n  const mappingChanged = prevMapping != null && mapping !== prevMapping;\n\n  const defaultFrame = { frame: { matcher: { id: FrameMatcherID.byIndex, options: 0 } } };\n  const [selectedIdx, setSelectedIdx] = useState(0);\n\n  if (mappingChanged || seriesCfg == null) {\n    seriesCfg = [{ ...defaultFrame }];\n    onChange([...seriesCfg]);\n\n    if (selectedIdx > 0) {\n      setSelectedIdx(0);\n    }\n  }\n\n  const addSeries = () => {\n    seriesCfg = seriesCfg.concat({ ...defaultFrame });\n    setSelectedIdx(seriesCfg.length - 1);\n    onChange([...seriesCfg]);\n  };\n\n  const deleteSeries = (index: number) => {\n    seriesCfg = seriesCfg.filter((s, i) => i !== index);\n    setSelectedIdx(0);\n    onChange([...seriesCfg]);\n  };\n\n  const series = seriesCfg[selectedIdx];\n  const formKey = `${mapping}${selectedIdx}`;\n\n  const baseNameMode =\n    mapping === SeriesMapping.Manual\n      ? FieldNamePickerBaseNameMode.ExcludeBaseNames\n      : context.data.length === 1\n        ? FieldNamePickerBaseNameMode.IncludeAll\n        : FieldNamePickerBaseNameMode.OnlyBaseNames;\n\n  context.data.forEach((frame, frameIndex) => {\n    frame.fields.forEach((field, fieldIndex) => {\n      field.state = {\n        ...field.state,\n        origin: {\n          frameIndex,\n          fieldIndex,\n        },\n      };\n    });\n  });\n\n  return (\n    <>\n      {mapping === SeriesMapping.Manual && (\n        <>\n          <Button icon=\"plus\" size=\"sm\" variant=\"secondary\" onClick={addSeries} className={style.marginBot}>\n            Add series\n          </Button>\n\n          <div className={style.marginBot}>\n            {seriesCfg.map((series, index) => {\n              return (\n                <div\n                  key={`series/${index}`}\n                  className={index === selectedIdx ? `${style.row} ${style.sel}` : style.row}\n                  onClick={() => setSelectedIdx(index)}\n                  role=\"button\"\n                  aria-label={`Select series ${index + 1}`}\n                  tabIndex={0}\n                  onKeyPress={(e) => {\n                    if (e.key === 'Enter') {\n                      setSelectedIdx(index);\n                    }\n                  }}\n                >\n                  <LayerName\n                    name={series.name?.fixed ?? `Series ${index + 1}`}\n                    onChange={(v) => {\n                      series.name = {\n                        fixed: v === '' || v === `Series ${index + 1}` ? undefined : v,\n                      };\n                      onChange([...seriesCfg]);\n                    }}\n                  />\n                  <IconButton\n                    name=\"trash-alt\"\n                    title={'remove'}\n                    className={cx(style.actionIcon)}\n                    onClick={() => deleteSeries(index)}\n                    tooltip=\"Delete series\"\n                  />\n                </div>\n              );\n            })}\n          </div>\n        </>\n      )}\n\n      {selectedIdx >= 0 && series != null && (\n        <Fragment key={formKey}>\n          <Field label=\"Frame\">\n            <Select\n              placeholder={mapping === SeriesMapping.Auto ? 'All frames' : 'Select frame'}\n              isClearable={true}\n              options={context.data.map((frame, index) => ({\n                value: index,\n                label: `${getFrameDisplayName(frame, index)} (index: ${index}, rows: ${frame.length})`,\n              }))}\n              value={series.frame?.matcher.options}\n              onChange={(opt) => {\n                if (opt == null) {\n                  delete series.frame;\n                } else {\n                  series.frame = {\n                    matcher: {\n                      id: FrameMatcherID.byIndex,\n                      options: Number(opt.value),\n                    },\n                  };\n                }\n\n                onChange([...seriesCfg]);\n              }}\n            />\n          </Field>\n          <Field label=\"X field\">\n            <FieldNamePicker\n              value={series.x?.matcher.options as string}\n              context={context}\n              onChange={(fieldName) => {\n                if (fieldName == null) {\n                  delete series.x;\n                } else {\n                  // TODO: reset any other dim that was set to fieldName\n                  series.x = {\n                    matcher: {\n                      id: FieldMatcherID.byName,\n                      options: fieldName,\n                    },\n                  };\n                }\n\n                onChange([...seriesCfg]);\n              }}\n              item={{\n                id: 'x',\n                name: 'x',\n                settings: {\n                  filter: (field) =>\n                    (mapping === SeriesMapping.Auto ||\n                      field.state?.origin?.frameIndex === series.frame?.matcher.options) &&\n                    field.type === FieldType.number &&\n                    !field.config.custom?.hideFrom?.viz,\n                  baseNameMode,\n                  placeholderText: mapping === SeriesMapping.Auto ? 'First number field in each frame' : undefined,\n                },\n              }}\n            />\n          </Field>\n          <Field label=\"Y field\">\n            <FieldNamePicker\n              value={series.y?.matcher?.options as string}\n              context={context}\n              onChange={(fieldName) => {\n                if (fieldName == null) {\n                  delete series.y;\n                } else {\n                  // TODO: reset any other dim that was set to fieldName\n                  series.y = {\n                    matcher: {\n                      id: FieldMatcherID.byName,\n                      options: fieldName,\n                    },\n                  };\n                }\n\n                onChange([...seriesCfg]);\n              }}\n              item={{\n                id: 'y',\n                name: 'y',\n                settings: {\n                  // TODO: filter out series.y?.exclude.options, series.size.matcher.options, series.color.matcher.options\n                  filter: (field) =>\n                    (mapping === SeriesMapping.Auto ||\n                      field.state?.origin?.frameIndex === series.frame?.matcher.options) &&\n                    field.type === FieldType.number &&\n                    !field.config.custom?.hideFrom?.viz,\n                  baseNameMode,\n                  placeholderText: mapping === SeriesMapping.Auto ? 'Remaining number fields in each frame' : undefined,\n                },\n              }}\n            />\n          </Field>\n          <Field label=\"Size field\">\n            <FieldNamePicker\n              value={series.size?.matcher?.options as string}\n              context={context}\n              onChange={(fieldName) => {\n                if (fieldName == null) {\n                  delete series.size;\n                } else {\n                  // TODO: reset any other dim that was set to fieldName\n                  series.size = {\n                    matcher: {\n                      id: FieldMatcherID.byName,\n                      options: fieldName,\n                    },\n                  };\n                }\n\n                onChange([...seriesCfg]);\n              }}\n              item={{\n                id: 'size',\n                name: 'size',\n                settings: {\n                  // TODO: filter out series.y?.exclude.options, series.size.matcher.options, series.color.matcher.options\n                  filter: (field) =>\n                    field.name !== series.x?.matcher.options &&\n                    (mapping === SeriesMapping.Auto ||\n                      field.state?.origin?.frameIndex === series.frame?.matcher.options) &&\n                    field.type === FieldType.number &&\n                    !field.config.custom?.hideFrom?.viz,\n                  baseNameMode,\n                  placeholderText: '',\n                },\n              }}\n            />\n          </Field>\n          <Field label=\"Color field\">\n            <FieldNamePicker\n              value={series.color?.matcher?.options as string}\n              context={context}\n              onChange={(fieldName) => {\n                if (fieldName == null) {\n                  delete series.color;\n                } else {\n                  // TODO: reset any other dim that was set to fieldName\n                  series.color = {\n                    matcher: {\n                      id: FieldMatcherID.byName,\n                      options: fieldName,\n                    },\n                  };\n                }\n\n                onChange([...seriesCfg]);\n              }}\n              item={{\n                id: 'color',\n                name: 'color',\n                settings: {\n                  // TODO: filter out series.y?.exclude.options, series.size.matcher.options, series.color.matcher.options\n                  filter: (field) =>\n                    field.name !== series.x?.matcher.options &&\n                    (mapping === SeriesMapping.Auto ||\n                      field.state?.origin?.frameIndex === series.frame?.matcher.options) &&\n                    field.type === FieldType.number &&\n                    !field.config.custom?.hideFrom?.viz,\n                  baseNameMode,\n                  placeholderText: '',\n                },\n              }}\n            />\n          </Field>\n        </Fragment>\n      )}\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  marginBot: css({\n    marginBottom: '20px',\n  }),\n  row: css({\n    padding: `${theme.spacing(0.5, 1)}`,\n    borderRadius: `${theme.shape.radius.default}`,\n    background: `${theme.colors.background.secondary}`,\n    minHeight: `${theme.spacing(4)}`,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    marginBottom: '3px',\n    cursor: 'pointer',\n\n    border: `1px solid ${theme.components.input.borderColor}`,\n    '&:hover': {\n      border: `1px solid ${theme.components.input.borderHover}`,\n    },\n  }),\n  sel: css({\n    border: `1px solid ${theme.colors.primary.border}`,\n    '&:hover': {\n      border: `1px solid ${theme.colors.primary.border}`,\n    },\n  }),\n  actionIcon: css({\n    color: `${theme.colors.text.secondary}`,\n    '&:hover': {\n      color: `${theme.colors.text}`,\n    },\n  }),\n});\n","import { ReactNode } from 'react';\n\nimport { colorManipulator, DataFrame, InterpolateFunction, LinkModel } from '@grafana/data';\nimport {\n  VizTooltipContent,\n  VizTooltipFooter,\n  VizTooltipHeader,\n  VizTooltipWrapper,\n  ColorIndicator,\n  VizTooltipItem,\n} from '@grafana/ui/internal';\n\nimport { getFieldActions } from '../status-history/utils';\n\nimport { XYSeries } from './types2';\nimport { fmt } from './utils';\n\nexport interface Props {\n  dataIdxs: Array<number | null>;\n  seriesIdx: number | null | undefined;\n  isPinned: boolean;\n  dismiss: () => void;\n  data: DataFrame[];\n  xySeries: XYSeries[];\n  replaceVariables: InterpolateFunction;\n  dataLinks: LinkModel[];\n}\n\nfunction stripSeriesName(fieldName: string, seriesName: string) {\n  if (fieldName !== seriesName && fieldName.includes(' ')) {\n    fieldName = fieldName.replace(seriesName, '').trim();\n  }\n\n  return fieldName;\n}\n\nexport const XYChartTooltip = ({\n  dataIdxs,\n  seriesIdx,\n  data,\n  xySeries,\n  dismiss,\n  isPinned,\n  replaceVariables,\n  dataLinks,\n}: Props) => {\n  const rowIndex = dataIdxs.find((idx) => idx !== null)!;\n\n  const series = xySeries[seriesIdx! - 1];\n  const xField = series.x.field;\n  const yField = series.y.field;\n\n  const sizeField = series.size.field;\n  const colorField = series.color.field;\n\n  let label = series.name.value;\n\n  let seriesColor = series.color.fixed;\n  // let colorField = series.color.field;\n  // let pointColor: string;\n\n  // if (colorField != null) {\n  //   pointColor = colorField.display?.(colorField.values[rowIndex]).color!;\n  // }\n\n  const headerItem: VizTooltipItem = {\n    label,\n    value: '',\n    color: colorManipulator.alpha(seriesColor ?? '#fff', 0.5),\n    colorIndicator: ColorIndicator.marker_md,\n  };\n\n  const contentItems: VizTooltipItem[] = [\n    {\n      label: stripSeriesName(xField.state?.displayName ?? xField.name, label),\n      value: fmt(xField, xField.values[rowIndex]),\n    },\n    {\n      label: stripSeriesName(yField.state?.displayName ?? yField.name, label),\n      value: fmt(yField, yField.values[rowIndex]),\n    },\n  ];\n\n  // mapped fields for size/color\n  if (sizeField != null && sizeField !== yField) {\n    contentItems.push({\n      label: stripSeriesName(sizeField.state?.displayName ?? sizeField.name, label),\n      value: fmt(sizeField, sizeField.values[rowIndex]),\n    });\n  }\n\n  if (colorField != null && colorField !== yField) {\n    contentItems.push({\n      label: stripSeriesName(colorField.state?.displayName ?? colorField.name, label),\n      value: fmt(colorField, colorField.values[rowIndex]),\n    });\n  }\n\n  series._rest.forEach((field) => {\n    contentItems.push({\n      label: stripSeriesName(field.state?.displayName ?? field.name, label),\n      value: fmt(field, field.values[rowIndex]),\n    });\n  });\n\n  let footer: ReactNode;\n\n  if (seriesIdx != null) {\n    const hasOneClickLink = dataLinks?.some((dataLink) => dataLink.oneClick === true);\n\n    if (isPinned || hasOneClickLink) {\n      const yFieldFrame = data.find((frame) => frame.fields.includes(yField))!;\n      const actions = getFieldActions(yFieldFrame, yField, replaceVariables, rowIndex);\n\n      footer = <VizTooltipFooter dataLinks={dataLinks} actions={actions} />;\n    }\n  }\n\n  return (\n    <VizTooltipWrapper>\n      <VizTooltipHeader item={headerItem} isPinned={isPinned} />\n      <VizTooltipContent items={contentItems} isPinned={isPinned} />\n      {footer}\n    </VizTooltipWrapper>\n  );\n};\n","import tinycolor from 'tinycolor2';\nimport uPlot from 'uplot';\n\nimport {\n  FALLBACK_COLOR,\n  Field,\n  FieldType,\n  formattedValueToString,\n  getFieldColorModeForField,\n  GrafanaTheme2,\n  MappingType,\n  SpecialValueMatch,\n  ThresholdsMode,\n  colorManipulator,\n} from '@grafana/data';\nimport { AxisPlacement, FieldColorModeId, ScaleDirection, ScaleOrientation, VisibilityMode } from '@grafana/schema';\nimport { UPlotConfigBuilder } from '@grafana/ui';\nimport { FacetedData, FacetSeries } from '@grafana/ui/internal';\n\nimport { pointWithin, Quadtree, Rect } from '../barchart/quadtree';\nimport { valuesToFills } from '../heatmap/utils';\n\nimport { PointShape } from './panelcfg.gen';\nimport { XYSeries } from './types2';\nimport { getCommonPrefixSuffix } from './utils';\n\ninterface DrawBubblesOpts {\n  each: (u: uPlot, seriesIdx: number, dataIdx: number, lft: number, top: number, wid: number, hgt: number) => void;\n  disp: {\n    //unit: 3,\n    size: {\n      values: (u: uPlot, seriesIdx: number) => number[];\n    };\n    color: {\n      values: (u: uPlot, seriesIdx: number) => string[];\n    };\n  };\n}\n\nexport const prepConfig = (xySeries: XYSeries[], theme: GrafanaTheme2) => {\n  if (xySeries.length === 0) {\n    return { builder: null, prepData: () => [] };\n  }\n\n  let qt: Quadtree;\n  let hRect: Rect | null;\n\n  function drawBubblesFactory(opts: DrawBubblesOpts) {\n    const drawBubbles: uPlot.Series.PathBuilder = (u, seriesIdx, idx0, idx1) => {\n      uPlot.orient(\n        u,\n        seriesIdx,\n        (\n          series,\n          dataX,\n          dataY,\n          scaleX,\n          scaleY,\n          valToPosX,\n          valToPosY,\n          xOff,\n          yOff,\n          xDim,\n          yDim,\n          moveTo,\n          lineTo,\n          rect,\n          arc\n        ) => {\n          const pxRatio = uPlot.pxRatio;\n          const scatterInfo = xySeries[seriesIdx - 1];\n          let d = u.data[seriesIdx] as unknown as FacetSeries;\n\n          // showLine: boolean;\n          // lineStyle: common.LineStyle;\n          // showPoints: common.VisibilityMode;\n\n          let showLine = scatterInfo.showLine;\n          let showPoints = scatterInfo.showPoints === VisibilityMode.Always;\n          let strokeWidth = scatterInfo.pointStrokeWidth ?? 0;\n\n          u.ctx.save();\n\n          u.ctx.rect(u.bbox.left, u.bbox.top, u.bbox.width, u.bbox.height);\n          u.ctx.clip();\n\n          let pointAlpha = scatterInfo.fillOpacity / 100;\n\n          u.ctx.fillStyle = colorManipulator.alpha((series.fill as any)(), pointAlpha);\n          u.ctx.strokeStyle = colorManipulator.alpha((series.stroke as any)(), 1);\n          u.ctx.lineWidth = strokeWidth;\n\n          let deg360 = 2 * Math.PI;\n\n          let xKey = scaleX.key!;\n          let yKey = scaleY.key!;\n\n          //const colorMode = getFieldColorModeForField(field); // isByValue\n          const pointSize = scatterInfo.y.field.config.custom.pointSize;\n          const colorByValue = scatterInfo.color.field != null; // && colorMode.isByValue;\n\n          let maxSize = (pointSize.max ?? pointSize.fixed) * pxRatio;\n\n          // todo: this depends on direction & orientation\n          // todo: calc once per redraw, not per path\n          let filtLft = u.posToVal(-maxSize / 2, xKey);\n          let filtRgt = u.posToVal(u.bbox.width / pxRatio + maxSize / 2, xKey);\n          let filtBtm = u.posToVal(u.bbox.height / pxRatio + maxSize / 2, yKey);\n          let filtTop = u.posToVal(-maxSize / 2, yKey);\n\n          let sizes = opts.disp.size.values(u, seriesIdx);\n          // let pointColors = opts.disp.color.values(u, seriesIdx);\n          let pointColors = dispColors[seriesIdx - 1].values; // idxs\n          let pointPalette = dispColors[seriesIdx - 1].index as Array<CanvasRenderingContext2D['fillStyle']>;\n          let paletteHasAlpha = dispColors[seriesIdx - 1].hasAlpha;\n\n          let isSquare = scatterInfo.pointShape === PointShape.Square;\n\n          let linePath: Path2D | null = showLine ? new Path2D() : null;\n\n          let curColorIdx = -1;\n\n          for (let i = 0; i < d[0].length; i++) {\n            let xVal = d[0][i];\n            let yVal = d[1][i];\n\n            if (xVal >= filtLft && xVal <= filtRgt && yVal >= filtBtm && yVal <= filtTop) {\n              let size = Math.round(sizes[i] * pxRatio);\n              let cx = valToPosX(xVal, scaleX, xDim, xOff);\n              let cy = valToPosY(yVal, scaleY, yDim, yOff);\n\n              if (showLine) {\n                linePath!.lineTo(cx, cy);\n              }\n\n              if (showPoints) {\n                if (colorByValue) {\n                  if (pointColors[i] !== curColorIdx) {\n                    curColorIdx = pointColors[i];\n                    let c = curColorIdx === -1 ? FALLBACK_COLOR : pointPalette[curColorIdx];\n                    u.ctx.fillStyle = paletteHasAlpha ? c : colorManipulator.alpha(c as string, pointAlpha);\n                    u.ctx.strokeStyle = colorManipulator.alpha(c as string, 1);\n                  }\n                }\n\n                if (isSquare) {\n                  let x = Math.round(cx - size / 2);\n                  let y = Math.round(cy - size / 2);\n\n                  if (colorByValue || pointAlpha > 0) {\n                    u.ctx.fillRect(x, y, size, size);\n                  }\n\n                  if (strokeWidth > 0) {\n                    u.ctx.strokeRect(x, y, size, size);\n                  }\n                } else {\n                  u.ctx.beginPath();\n                  u.ctx.arc(cx, cy, size / 2, 0, deg360);\n\n                  if (colorByValue || pointAlpha > 0) {\n                    u.ctx.fill();\n                  }\n\n                  if (strokeWidth > 0) {\n                    u.ctx.stroke();\n                  }\n                }\n\n                opts.each(\n                  u,\n                  seriesIdx,\n                  i,\n                  cx - size / 2 - strokeWidth / 2,\n                  cy - size / 2 - strokeWidth / 2,\n                  size + strokeWidth,\n                  size + strokeWidth\n                );\n              }\n            }\n          }\n\n          if (showLine) {\n            u.ctx.strokeStyle = scatterInfo.color.fixed!;\n            u.ctx.lineWidth = scatterInfo.lineWidth * pxRatio;\n\n            const { lineStyle } = scatterInfo;\n            if (lineStyle && lineStyle.fill !== 'solid') {\n              if (lineStyle.fill === 'dot') {\n                u.ctx.lineCap = 'round';\n              }\n              u.ctx.setLineDash(lineStyle.dash ?? [10, 10]);\n            }\n\n            u.ctx.stroke(linePath!);\n          }\n\n          u.ctx.restore();\n        }\n      );\n\n      return null;\n    };\n\n    return drawBubbles;\n  }\n\n  let drawBubbles = drawBubblesFactory({\n    disp: {\n      size: {\n        //unit: 3, // raw CSS pixels\n        values: (u, seriesIdx) => {\n          return u.data[seriesIdx][2] as any; // already contains final pixel geometry\n          //let [minValue, maxValue] = getSizeMinMax(u);\n          //return u.data[seriesIdx][2].map(v => getSize(v, minValue, maxValue));\n        },\n      },\n      color: {\n        // string values\n        values: (u, seriesIdx) => {\n          return u.data[seriesIdx][3] as any;\n        },\n      },\n    },\n    each: (u, seriesIdx, dataIdx, lft, top, wid, hgt) => {\n      // we get back raw canvas coords (included axes & padding). translate to the plotting area origin\n      lft -= u.bbox.left;\n      top -= u.bbox.top;\n      qt.add({ x: lft, y: top, w: wid, h: hgt, sidx: seriesIdx, didx: dataIdx });\n    },\n  });\n\n  const builder = new UPlotConfigBuilder();\n\n  builder.setCursor({\n    drag: { setScale: true },\n    dataIdx: (u, seriesIdx) => {\n      if (seriesIdx === 1) {\n        const pxRatio = uPlot.pxRatio;\n\n        hRect = null;\n\n        let dist = Infinity;\n        let cx = u.cursor.left! * pxRatio;\n        let cy = u.cursor.top! * pxRatio;\n\n        qt.get(cx, cy, 1, 1, (o) => {\n          if (pointWithin(cx, cy, o.x, o.y, o.x + o.w, o.y + o.h)) {\n            let ocx = o.x + o.w / 2;\n            let ocy = o.y + o.h / 2;\n\n            let dx = ocx - cx;\n            let dy = ocy - cy;\n\n            let d = Math.sqrt(dx ** 2 + dy ** 2);\n\n            // test against radius for actual hover\n            if (d <= o.w / 2) {\n              // only hover bbox with closest distance\n              if (d <= dist) {\n                dist = d;\n                hRect = o;\n              }\n            }\n          }\n        });\n      }\n\n      return hRect && seriesIdx === hRect.sidx ? hRect.didx : null;\n    },\n    points: {\n      size: (u, seriesIdx) => {\n        return hRect && seriesIdx === hRect.sidx ? hRect.w / uPlot.pxRatio : 0;\n      },\n      fill: (u, seriesIdx) => 'rgba(255,255,255,0.4)',\n    },\n  });\n\n  // clip hover points/bubbles to plotting area\n  builder.addHook('init', (u, r) => {\n    u.over.style.overflow = 'hidden';\n  });\n\n  builder.addHook('drawClear', (u) => {\n    qt = qt || new Quadtree(0, 0, u.bbox.width, u.bbox.height);\n\n    qt.clear();\n\n    // force-clear the path cache to cause drawBars() to rebuild new quadtree\n    u.series.forEach((s, i) => {\n      if (i > 0) {\n        // @ts-ignore\n        s._paths = null;\n      }\n    });\n  });\n\n  builder.setMode(2);\n\n  let xField = xySeries[0].x.field;\n\n  let fieldConfig = xField.config;\n  let customConfig = fieldConfig.custom;\n  let scaleDistr = customConfig?.scaleDistribution;\n\n  builder.addScale({\n    scaleKey: 'x',\n    isTime: false,\n    orientation: ScaleOrientation.Horizontal,\n    direction: ScaleDirection.Right,\n    distribution: scaleDistr?.type,\n    log: scaleDistr?.log,\n    linearThreshold: scaleDistr?.linearThreshold,\n    min: fieldConfig.min,\n    max: fieldConfig.max,\n    softMin: customConfig?.axisSoftMin,\n    softMax: customConfig?.axisSoftMax,\n    centeredZero: customConfig?.axisCenteredZero,\n    decimals: fieldConfig.decimals,\n  });\n\n  // why does this fall back to '' instead of null or undef?\n  let xAxisLabel = customConfig.axisLabel;\n\n  if (xAxisLabel == null || xAxisLabel === '') {\n    let dispNames = xySeries.map((s) => s.x.field.state?.displayName ?? '');\n\n    let xAxisAutoLabel =\n      xySeries.length === 1\n        ? (xField.state?.displayName ?? xField.name)\n        : new Set(dispNames).size === 1\n          ? dispNames[0]\n          : getCommonPrefixSuffix(dispNames);\n\n    if (xAxisAutoLabel !== '') {\n      xAxisLabel = xAxisAutoLabel;\n    }\n  }\n\n  builder.addAxis({\n    scaleKey: 'x',\n    placement: customConfig?.axisPlacement !== AxisPlacement.Hidden ? AxisPlacement.Bottom : AxisPlacement.Hidden,\n    show: customConfig?.axisPlacement !== AxisPlacement.Hidden,\n    grid: { show: customConfig?.axisGridShow },\n    border: { show: customConfig?.axisBorderShow },\n    theme,\n    label: xAxisLabel,\n    formatValue: (v, decimals) => formattedValueToString(xField.display!(v, decimals)),\n  });\n\n  xySeries.forEach((s, si) => {\n    let field = s.y.field;\n\n    const lineColor = s.color.fixed;\n    const pointColor = s.color.fixed;\n    //const lineColor = s.lineColor(frame);\n    //const lineWidth = s.lineWidth;\n\n    let scaleKey = field.config.unit ?? 'y';\n    let config = field.config;\n    let customConfig = config.custom;\n    let scaleDistr = customConfig?.scaleDistribution;\n\n    builder.addScale({\n      scaleKey,\n      orientation: ScaleOrientation.Vertical,\n      direction: ScaleDirection.Up,\n      distribution: scaleDistr?.type,\n      log: scaleDistr?.log,\n      linearThreshold: scaleDistr?.linearThreshold,\n      min: config.min,\n      max: config.max,\n      softMin: customConfig?.axisSoftMin,\n      softMax: customConfig?.axisSoftMax,\n      centeredZero: customConfig?.axisCenteredZero,\n      decimals: config.decimals,\n    });\n\n    // why does this fall back to '' instead of null or undef?\n    let yAxisLabel = customConfig.axisLabel;\n\n    if (yAxisLabel == null || yAxisLabel === '') {\n      let dispNames = xySeries.map((s) => s.y.field.state?.displayName ?? '');\n\n      let yAxisAutoLabel =\n        xySeries.length === 1\n          ? (field.state?.displayName ?? field.name)\n          : new Set(dispNames).size === 1\n            ? dispNames[0]\n            : getCommonPrefixSuffix(dispNames);\n\n      if (yAxisAutoLabel !== '') {\n        yAxisLabel = yAxisAutoLabel;\n      }\n    }\n\n    builder.addAxis({\n      scaleKey,\n      theme,\n      placement: customConfig?.axisPlacement === AxisPlacement.Auto ? AxisPlacement.Left : customConfig?.axisPlacement,\n      show: customConfig?.axisPlacement !== AxisPlacement.Hidden,\n      grid: { show: customConfig?.axisGridShow },\n      border: { show: customConfig?.axisBorderShow },\n      size: customConfig?.axisWidth,\n      // label: yAxisLabel == null || yAxisLabel === '' ? fieldDisplayName : yAxisLabel,\n      label: yAxisLabel,\n      formatValue: (v, decimals) => formattedValueToString(field.display!(v, decimals)),\n    });\n\n    builder.addSeries({\n      facets: [\n        {\n          scale: 'x',\n          auto: true,\n        },\n        {\n          scale: scaleKey,\n          auto: true,\n        },\n      ],\n      pathBuilder: drawBubbles, // drawBubbles({disp: {size: {values: () => }}})\n      theme,\n      scaleKey: '', // facets' scales used (above)\n      lineColor: colorManipulator.alpha(lineColor ?? '#ffff', 1),\n      fillColor: colorManipulator.alpha(pointColor ?? '#ffff', 0.5),\n      show: !field.state?.hideFrom?.viz,\n    });\n  });\n\n  const dispColors = xySeries.map((s): FieldColorValuesWithCache => {\n    const cfg: FieldColorValuesWithCache = {\n      index: [],\n      getAll: () => [],\n      getOne: () => -1,\n      // cache for renderer, refreshed in prepData()\n      values: [],\n      hasAlpha: false,\n    };\n\n    const f = s.color.field;\n\n    if (f != null) {\n      Object.assign(cfg, fieldValueColors(f, theme));\n      cfg.hasAlpha = cfg.index.some((v) => !(v as string).endsWith('ff'));\n    }\n\n    return cfg;\n  });\n\n  function prepData(xySeries: XYSeries[]): FacetedData {\n    // if (info.error || !data.length) {\n    //   return [null];\n    // }\n\n    const { size: sizeRange, color: colorRange } = getGlobalRanges(xySeries);\n\n    xySeries.forEach((s, i) => {\n      dispColors[i].values = dispColors[i].getAll(s.color.field?.values ?? [], colorRange.min, colorRange.max);\n    });\n\n    return [\n      null,\n      ...xySeries.map((s, idx) => {\n        let len = s.x.field.values.length;\n\n        let diams: number[];\n\n        if (s.size.field != null) {\n          let { min, max } = s.size;\n\n          // todo: this scaling should be in renderer from raw values (not by passing css pixel diams via data)\n          let minPx = min! ** 2;\n          let maxPx = max! ** 2;\n          // use quadratic size scaling in byValue modes\n          let pxRange = maxPx - minPx;\n\n          let vals = s.size.field.values;\n          let minVal = sizeRange.min;\n          let maxVal = sizeRange.max;\n          let valRange = maxVal - minVal;\n\n          diams = Array(len);\n\n          for (let i = 0; i < vals.length; i++) {\n            let val = vals[i];\n\n            let valPct = (val - minVal) / valRange;\n            let pxArea = minPx + valPct * pxRange;\n            diams[i] = pxArea ** 0.5;\n          }\n        } else {\n          diams = Array(len).fill(s.size.fixed!);\n        }\n\n        return [\n          s.x.field.values, // X\n          s.y.field.values, // Y\n          diams,\n          Array(len).fill(s.color.fixed!), // TODO: fails for by value\n        ];\n      }),\n    ];\n  }\n\n  return { builder, prepData };\n};\n\nexport type PrepData = (xySeries: XYSeries[]) => FacetedData;\n\nconst getGlobalRanges = (xySeries: XYSeries[]) => {\n  const ranges = {\n    size: {\n      min: Infinity,\n      max: -Infinity,\n    },\n    color: {\n      min: Infinity,\n      max: -Infinity,\n    },\n  };\n\n  xySeries.forEach((series) => {\n    [series.size, series.color].forEach((facet, fi) => {\n      if (facet.field != null) {\n        let range = fi === 0 ? ranges.size : ranges.color;\n\n        const vals = facet.field.values;\n\n        for (let i = 0; i < vals.length; i++) {\n          const v = vals[i];\n\n          if (v != null) {\n            if (v < range.min) {\n              range.min = v;\n            }\n\n            if (v > range.max) {\n              range.max = v;\n            }\n          }\n        }\n      }\n    });\n  });\n\n  return ranges;\n};\n\nfunction getHex8Color(color: string, theme: GrafanaTheme2) {\n  return tinycolor(theme.visualization.getColorByName(color)).toHex8String();\n}\n\ninterface FieldColorValues {\n  index: unknown[];\n  getOne: GetOneValue;\n  getAll: GetAllValues;\n}\ninterface FieldColorValuesWithCache extends FieldColorValues {\n  values: number[];\n  hasAlpha: boolean;\n}\ntype GetAllValues = (values: unknown[], min?: number, max?: number) => number[];\ntype GetOneValue = (value: unknown, min?: number, max?: number) => number;\n\n/** compiler for values to palette color idxs (from thresholds, mappings, by-value gradients) */\nfunction fieldValueColors(f: Field, theme: GrafanaTheme2): FieldColorValues {\n  let index: unknown[] = [];\n  let getAll: GetAllValues = () => [];\n  let getOne: GetOneValue = () => -1;\n\n  let conds = '';\n\n  // if any mappings exist, use them regardless of other settings\n  if (f.config.mappings?.length ?? 0 > 0) {\n    let mappings = f.config.mappings!;\n\n    for (let i = 0; i < mappings.length; i++) {\n      let m = mappings[i];\n\n      if (m.type === MappingType.ValueToText) {\n        for (let k in m.options) {\n          let { color } = m.options[k];\n\n          if (color != null) {\n            let rhs = f.type === FieldType.string ? JSON.stringify(k) : Number(k);\n            conds += `v === ${rhs} ? ${index.length} : `;\n            index.push(getHex8Color(color, theme));\n          }\n        }\n      } else if (m.options.result.color != null) {\n        let { color } = m.options.result;\n\n        if (m.type === MappingType.RangeToText) {\n          let range = [];\n\n          if (m.options.from != null) {\n            range.push(`v >= ${Number(m.options.from)}`);\n          }\n\n          if (m.options.to != null) {\n            range.push(`v <= ${Number(m.options.to)}`);\n          }\n\n          if (range.length > 0) {\n            conds += `${range.join(' && ')} ? ${index.length} : `;\n            index.push(getHex8Color(color, theme));\n          }\n        } else if (m.type === MappingType.SpecialValue) {\n          let spl = m.options.match;\n\n          if (spl === SpecialValueMatch.NaN) {\n            conds += `isNaN(v)`;\n          } else if (spl === SpecialValueMatch.NullAndNaN) {\n            conds += `v == null || isNaN(v)`;\n          } else {\n            conds += `v ${\n              spl === SpecialValueMatch.True\n                ? '=== true'\n                : spl === SpecialValueMatch.False\n                  ? '=== false'\n                  : spl === SpecialValueMatch.Null\n                    ? '== null'\n                    : spl === SpecialValueMatch.Empty\n                      ? '=== \"\"'\n                      : '== null'\n            }`;\n          }\n\n          conds += ` ? ${index.length} : `;\n          index.push(getHex8Color(color, theme));\n        } else if (m.type === MappingType.RegexToText) {\n          // TODO\n        }\n      }\n    }\n\n    conds += '-1'; // ?? what default here? null? FALLBACK_COLOR?\n  } else if (f.config.color?.mode === FieldColorModeId.Thresholds) {\n    if (f.config.thresholds?.mode === ThresholdsMode.Absolute) {\n      let steps = f.config.thresholds.steps;\n      let lasti = steps.length - 1;\n\n      for (let i = lasti; i > 0; i--) {\n        let rhs = Number(steps[i].value);\n        conds += `v >= ${rhs} ? ${i} : `;\n      }\n\n      conds += '0';\n\n      index = steps.map((s) => getHex8Color(s.color, theme));\n    } else {\n      // TODO: percent thresholds?\n    }\n  } else if (f.config.color?.mode?.startsWith('continuous')) {\n    let calc = getFieldColorModeForField(f).getCalculator(f, theme);\n\n    index = Array(32);\n\n    for (let i = 0; i < index.length; i++) {\n      let pct = i / (index.length - 1);\n      index[i] = getHex8Color(calc(pct, pct), theme);\n    }\n\n    getAll = (vals, min, max) => valuesToFills(vals as number[], index as string[], min!, max!);\n  }\n\n  if (conds !== '') {\n    getOne = new Function('v', `return ${conds};`) as GetOneValue;\n\n    getAll = new Function(\n      'vals',\n      `\n      let idxs = Array(vals.length);\n\n      for (let i = 0; i < vals.length; i++) {\n        let v = vals[i];\n        idxs[i] = ${conds};\n      }\n\n      return idxs;\n    `\n    ) as GetAllValues;\n  }\n\n  return {\n    index,\n    getOne,\n    getAll,\n  };\n}\n","import { css } from '@emotion/css';\nimport { useMemo } from 'react';\n\nimport { colorManipulator, FALLBACK_COLOR, PanelProps } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport {\n  TooltipDisplayMode,\n  TooltipPlugin2,\n  UPlotChart,\n  VizLayout,\n  VizLegend,\n  VizLegendItem,\n  useStyles2,\n  useTheme2,\n} from '@grafana/ui';\nimport { getDisplayValuesForCalcs, TooltipHoverMode } from '@grafana/ui/internal';\n\nimport { getDataLinks } from '../status-history/utils';\n\nimport { XYChartTooltip } from './XYChartTooltip';\nimport { Options } from './panelcfg.gen';\nimport { prepConfig } from './scatter';\nimport { prepSeries } from './utils';\n\ntype Props2 = PanelProps<Options>;\n\nexport const XYChartPanel2 = (props: Props2) => {\n  const styles = useStyles2(getStyles);\n  const theme = useTheme2();\n\n  let { mapping, series: mappedSeries } = props.options;\n\n  // regenerate series schema when mappings or data changes\n  let series = useMemo(\n    () => prepSeries(mapping, mappedSeries, props.data.series, props.fieldConfig),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [mapping, mappedSeries, props.data.series, props.fieldConfig]\n  );\n\n  // if series changed due to mappings or data structure, re-init config & renderers\n  let { builder, prepData } = useMemo(\n    () => prepConfig(series, config.theme2),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [mapping, mappedSeries, props.data.structureRev, props.fieldConfig, props.options.tooltip]\n  );\n\n  // generate data struct for uPlot mode: 2\n  let data = useMemo(\n    () => prepData(series),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [series]\n  );\n\n  // todo: handle errors\n  let error = builder == null || data.length === 0 ? 'Err' : '';\n\n  // TODO: React.memo()\n  const renderLegend = () => {\n    if (!props.options.legend.showLegend) {\n      return null;\n    }\n\n    const items: VizLegendItem[] = [];\n\n    series.forEach((s, idx) => {\n      let yField = s.y.field;\n      let config = yField.config;\n      let custom = config.custom;\n\n      if (!custom.hideFrom?.legend) {\n        items.push({\n          yAxis: 1, // TODO: pull from y field\n          label: s.name.value,\n          color: colorManipulator.alpha(s.color.fixed ?? FALLBACK_COLOR, 1),\n          getItemKey: () => `${idx}-${s.name.value}`,\n          fieldName: yField.state?.displayName ?? yField.name,\n          disabled: yField.state?.hideFrom?.viz ?? false,\n          getDisplayValues: () => getDisplayValuesForCalcs(props.options.legend.calcs, yField, theme),\n        });\n      }\n    });\n\n    const { placement, displayMode, width, sortBy, sortDesc } = props.options.legend;\n\n    return (\n      <VizLayout.Legend placement={placement} width={width}>\n        <VizLegend\n          className={styles.legend}\n          placement={placement}\n          items={items}\n          displayMode={displayMode}\n          sortBy={sortBy}\n          sortDesc={sortDesc}\n          isSortable={true}\n        />\n      </VizLayout.Legend>\n    );\n  };\n\n  if (error) {\n    return (\n      <div className=\"panel-empty\">\n        <p>{error}</p>\n      </div>\n    );\n  }\n\n  return (\n    <VizLayout width={props.width} height={props.height} legend={renderLegend()}>\n      {(vizWidth: number, vizHeight: number) => (\n        <UPlotChart config={builder!} data={data} width={vizWidth} height={vizHeight}>\n          {props.options.tooltip.mode !== TooltipDisplayMode.None && (\n            <TooltipPlugin2\n              config={builder!}\n              hoverMode={TooltipHoverMode.xyOne}\n              getDataLinks={(seriesIdx, dataIdx) => {\n                const xySeries = series[seriesIdx - 1];\n                return getDataLinks(xySeries.y.field, dataIdx);\n              }}\n              render={(u, dataIdxs, seriesIdx, isPinned, dismiss, timeRange2, viaSync, dataLinks) => {\n                return (\n                  <XYChartTooltip\n                    data={props.data.series}\n                    dataIdxs={dataIdxs}\n                    xySeries={series}\n                    dismiss={dismiss}\n                    isPinned={isPinned}\n                    seriesIdx={seriesIdx!}\n                    replaceVariables={props.replaceVariables}\n                    dataLinks={dataLinks}\n                  />\n                );\n              }}\n              maxWidth={props.options.tooltip.maxWidth}\n            />\n          )}\n        </UPlotChart>\n      )}\n    </VizLayout>\n  );\n};\n\nconst getStyles = () => ({\n  legend: css({\n    div: {\n      justifyContent: 'flex-start',\n    },\n  }),\n});\n","import {\n  FieldColorModeId,\n  FieldConfigProperty,\n  FieldType,\n  identityOverrideProcessor,\n  SetFieldConfigOptionsArgs,\n} from '@grafana/data';\nimport { LineStyle } from '@grafana/schema';\nimport { commonOptionsBuilder } from '@grafana/ui';\n\nimport { LineStyleEditor } from '../timeseries/LineStyleEditor';\n\nimport { FieldConfig, XYShowMode, PointShape } from './panelcfg.gen';\n\nexport const DEFAULT_POINT_SIZE = 5;\n\nexport function getScatterFieldConfig(cfg: FieldConfig): SetFieldConfigOptionsArgs<FieldConfig> {\n  return {\n    standardOptions: {\n      [FieldConfigProperty.Min]: {\n        hideFromDefaults: true,\n      },\n      [FieldConfigProperty.Max]: {\n        hideFromDefaults: true,\n      },\n      [FieldConfigProperty.Unit]: {\n        hideFromDefaults: true,\n      },\n      [FieldConfigProperty.Decimals]: {\n        hideFromDefaults: true,\n      },\n      [FieldConfigProperty.NoValue]: {\n        hideFromDefaults: true,\n      },\n      [FieldConfigProperty.DisplayName]: {\n        hideFromDefaults: true,\n      },\n      // TODO: this still leaves Color series by: [ Last | Min | Max ]\n      // because item.settings?.bySeriesSupport && colorMode.isByValue\n      [FieldConfigProperty.Color]: {\n        settings: {\n          byValueSupport: true,\n          bySeriesSupport: true,\n          preferThresholdsMode: false,\n        },\n        defaultValue: {\n          mode: FieldColorModeId.PaletteClassic,\n        },\n      },\n      [FieldConfigProperty.Links]: {\n        settings: {\n          showOneClick: true,\n        },\n      },\n      [FieldConfigProperty.Actions]: {\n        hideFromDefaults: false,\n      },\n    },\n\n    useCustomConfig: (builder) => {\n      builder\n        .addRadio({\n          path: 'show',\n          name: 'Show',\n          defaultValue: cfg.show,\n          settings: {\n            options: [\n              { label: 'Points', value: XYShowMode.Points },\n              { label: 'Lines', value: XYShowMode.Lines },\n              { label: 'Both', value: XYShowMode.PointsAndLines },\n            ],\n          },\n        })\n        // .addGenericEditor(\n        //   {\n        //     path: 'pointSymbol',\n        //     name: 'Point symbol',\n        //     defaultValue: defaultFieldConfig.pointSymbol ?? {\n        //       mode: 'fixed',\n        //       fixed: 'img/icons/marker/circle.svg',\n        //     },\n        //     settings: {\n        //       resourceType: MediaType.Icon,\n        //       folderName: ResourceFolderName.Marker,\n        //       placeholderText: 'Select a symbol',\n        //       placeholderValue: 'img/icons/marker/circle.svg',\n        //       showSourceRadio: false,\n        //     },\n        //     showIf: (c) => c.show !== ScatterShow.Lines,\n        //   },\n        //   SymbolEditor // ResourceDimensionEditor\n        // )\n        .addSliderInput({\n          path: 'pointSize.fixed',\n          name: 'Point size',\n          defaultValue: cfg.pointSize?.fixed ?? DEFAULT_POINT_SIZE,\n          settings: {\n            min: 1,\n            max: 100,\n            step: 1,\n          },\n          showIf: (c) => c.show !== XYShowMode.Lines,\n        })\n        .addNumberInput({\n          path: 'pointSize.min',\n          name: 'Min point size',\n          showIf: (c) => c.show !== XYShowMode.Lines,\n        })\n        .addNumberInput({\n          path: 'pointSize.max',\n          name: 'Max point size',\n          showIf: (c) => c.show !== XYShowMode.Lines,\n        })\n        .addRadio({\n          path: 'pointShape',\n          name: 'Point shape',\n          defaultValue: PointShape.Circle,\n          settings: {\n            options: [\n              { value: PointShape.Circle, label: 'Circle' },\n              { value: PointShape.Square, label: 'Square' },\n            ],\n          },\n          showIf: (c) => c.show !== XYShowMode.Lines,\n        })\n        .addSliderInput({\n          path: 'pointStrokeWidth',\n          name: 'Point stroke width',\n          defaultValue: 1,\n          settings: {\n            min: 0,\n            max: 10,\n          },\n          showIf: (c) => c.show !== XYShowMode.Lines,\n        })\n        .addSliderInput({\n          path: 'fillOpacity',\n          name: 'Fill opacity',\n          defaultValue: 50,\n          settings: {\n            min: 0,\n            max: 100,\n            step: 1,\n          },\n          showIf: (c) => c.show !== XYShowMode.Lines,\n        })\n        .addCustomEditor<void, LineStyle>({\n          id: 'lineStyle',\n          path: 'lineStyle',\n          name: 'Line style',\n          showIf: (c) => c.show !== XYShowMode.Points,\n          editor: LineStyleEditor,\n          override: LineStyleEditor,\n          process: identityOverrideProcessor,\n          shouldApply: (f) => f.type === FieldType.number,\n        })\n        .addSliderInput({\n          path: 'lineWidth',\n          name: 'Line width',\n          defaultValue: cfg.lineWidth,\n          settings: {\n            min: 0,\n            max: 10,\n            step: 1,\n          },\n          showIf: (c) => c.show !== XYShowMode.Points,\n        });\n\n      commonOptionsBuilder.addAxisConfig(builder, cfg);\n      commonOptionsBuilder.addHideFrom(builder);\n    },\n  };\n}\n","// Code generated - EDITING IS FUTILE. DO NOT EDIT.\n//\n// Generated by:\n//     public/app/plugins/gen.go\n// Using jennies:\n//     TSTypesJenny\n//     PluginTsTypesJenny\n//\n// Run 'make gen-cue' from repository root to regenerate.\n\nimport * as common from '@grafana/schema';\n\n/**\n * Auto is \"table\" in the UI\n */\nexport enum SeriesMapping {\n  Auto = 'auto',\n  Manual = 'manual',\n}\n\nexport enum ScatterShow {\n  Lines = 'lines',\n  Points = 'points',\n  PointsAndLines = 'points+lines',\n}\n\n/**\n * Configuration for the Table/Auto mode\n */\nexport interface XYDimensionConfig {\n  exclude?: Array<string>;\n  frame: number;\n  x?: string;\n}\n\nexport const defaultXYDimensionConfig: Partial<XYDimensionConfig> = {\n  exclude: [],\n};\n\nexport interface FieldConfig extends common.HideableFieldConfig, common.AxisConfig {\n  label?: common.VisibilityMode;\n  labelValue?: common.TextDimensionConfig;\n  lineColor?: common.ColorDimensionConfig;\n  lineStyle?: common.LineStyle;\n  lineWidth?: number;\n  pointColor?: common.ColorDimensionConfig;\n  pointSize?: common.ScaleDimensionConfig;\n  show?: ScatterShow;\n}\n\nexport const defaultFieldConfig: Partial<FieldConfig> = {\n  label: common.VisibilityMode.Auto,\n  show: ScatterShow.Points,\n};\n\nexport interface ScatterSeriesConfig extends FieldConfig {\n  frame?: number;\n  name?: string;\n  x?: string;\n  y?: string;\n}\n\nexport interface Options extends common.OptionsWithLegend, common.OptionsWithTooltip {\n  /**\n   * Table Mode (auto)\n   */\n  dims: XYDimensionConfig;\n  /**\n   * Manual Mode\n   */\n  series: Array<ScatterSeriesConfig>;\n  seriesMapping?: SeriesMapping;\n}\n\nexport const defaultOptions: Partial<Options> = {\n  series: [],\n};\n","import { FieldMatcherID, FrameMatcherID, MatcherConfig, PanelModel } from '@grafana/data';\n\nimport { XYSeriesConfig, Options } from './panelcfg.gen';\nimport { ScatterSeriesConfig, SeriesMapping, XYDimensionConfig, Options as PrevOptions } from './panelcfgold.gen';\n\nexport const xyChartMigrationHandler = (panel: PanelModel): Options => {\n  const pluginVersion = panel?.pluginVersion ?? '';\n\n  if (pluginVersion === '' || parseFloat(pluginVersion) < 11.1) {\n    return migrateOptions(panel);\n  }\n\n  return panel.options;\n};\n\nfunction migrateOptions(panel: PanelModel): Options {\n  const { dims, seriesMapping, series: oldSeries, ...cleanedOpts } = panel.options as PrevOptions;\n  const { exclude = [], frame: frameShared, x: xShared }: XYDimensionConfig = dims ?? {};\n\n  const custDefaults = panel.fieldConfig.defaults.custom;\n\n  let oldSeries2 = oldSeries;\n\n  if (seriesMapping === SeriesMapping.Auto) {\n    oldSeries2 = [\n      {\n        x: undefined,\n        y: undefined,\n      },\n    ];\n  }\n\n  /*\n  // old manual mode example\n  \"series\": [\n    {\n      \"pointColor\": {\n        \"fixed\": \"purple\"       // this becomes override for y field.config.custom.pointColor.fixed, (or config.color?)\n        \"field\": \"BMI Male\",    // ...unless another field is mapped, then ignore\n      },\n      \"pointSize\": {\n        \"field\": \"Weight Male\",\n        \"max\": 40,              // this becomes override for y field.config.custom.pointSize.max\n        \"min\": 1,               // ...and .min\n        \"fixed\": 50.5\n      },\n      \"frame\": 0,               // byIndex frame matcher\n      \"x\": \"Height Male\",       // byName field matcher, falls back to byType/number field matcher\n      \"y\": \"Weight Male\"        // byName field matcher, falls back to byType/number field matcher\n    }\n  ],\n*/\n  let i = 0;\n\n  const newSeries: XYSeriesConfig[] = oldSeries2.map(({ x, y, pointColor, pointSize, frame }: ScatterSeriesConfig) => {\n    const { fixed: colorFixed, field: colorField } = pointColor ?? {};\n    const { fixed: sizeFixed, field: sizeField, min: sizeMin, max: sizeMax } = pointSize ?? {};\n\n    let xMatcherConfig: MatcherConfig;\n    let yMatcherConfig: MatcherConfig;\n\n    // old auto mode did not require x field defined\n    if (x == null && xShared == null) {\n      // TODO: this should just be the internal default. no need to store on save model\n      xMatcherConfig = {\n        id: FieldMatcherID.byType,\n        options: 'number',\n      };\n    } else {\n      xMatcherConfig = {\n        id: FieldMatcherID.byName,\n        options: x ?? xShared,\n      };\n    }\n\n    if (y == null) {\n      // TODO: this should just be the internal default. no need to store on save model\n      yMatcherConfig = {\n        id: FieldMatcherID.byType,\n        options: 'number',\n      };\n    } else {\n      yMatcherConfig = {\n        id: FieldMatcherID.byName,\n        options: y,\n      };\n    }\n\n    if (colorField == null && colorFixed && custDefaults.pointColor?.fixed !== colorFixed) {\n      // NOTE: intentionally not using custom.pointColor.fixed\n      let hasOverride = panel.fieldConfig.overrides.some(\n        (o) =>\n          o.matcher.id === yMatcherConfig.id &&\n          o.matcher.options === yMatcherConfig.options &&\n          o.properties.some((p) => p.id === 'color')\n      );\n\n      if (!hasOverride) {\n        panel.fieldConfig.overrides.push({\n          matcher: yMatcherConfig,\n          properties: [\n            {\n              id: 'color',\n              value: {\n                mode: 'fixed',\n                fixedColor: colorFixed,\n              },\n            },\n          ],\n        });\n      }\n    }\n\n    // add field overrides for custom pointSize.fixed\n    if (sizeField == null && sizeFixed && custDefaults.pointSize?.fixed !== sizeFixed) {\n      let hasOverride = panel.fieldConfig.overrides.some(\n        (o) =>\n          o.matcher.id === yMatcherConfig.id &&\n          o.matcher.options === yMatcherConfig.options &&\n          o.properties.some((p) => p.id === 'custom.pointSize.fixed')\n      );\n\n      if (!hasOverride) {\n        panel.fieldConfig.overrides.push({\n          matcher: yMatcherConfig,\n          properties: [\n            {\n              id: 'custom.pointSize.fixed',\n              value: sizeFixed,\n            },\n          ],\n        });\n      }\n    }\n\n    if (sizeField != null) {\n      // add field overrides for custom pointSize.min\n      if (sizeMin && custDefaults.pointSize?.min !== sizeMin) {\n        let hasOverride = panel.fieldConfig.overrides.some(\n          (o) =>\n            o.matcher.id === yMatcherConfig.id &&\n            o.matcher.options === yMatcherConfig.options &&\n            o.properties.some((p) => p.id === 'custom.pointSize.min')\n        );\n\n        if (!hasOverride) {\n          panel.fieldConfig.overrides.push({\n            matcher: {\n              id: FieldMatcherID.byName,\n              options: sizeField,\n            },\n            properties: [\n              {\n                id: 'custom.pointSize.min',\n                value: sizeMin,\n              },\n            ],\n          });\n        }\n      }\n      // add field overrides for custom pointSize.min\n      if (sizeMax && custDefaults.pointSize?.max !== sizeMax) {\n        let hasOverride = panel.fieldConfig.overrides.some(\n          (o) =>\n            o.matcher.id === yMatcherConfig.id &&\n            o.matcher.options === yMatcherConfig.options &&\n            o.properties.some((p) => p.id === 'custom.pointSize.max')\n        );\n\n        if (!hasOverride) {\n          panel.fieldConfig.overrides.push({\n            matcher: {\n              id: FieldMatcherID.byName,\n              options: sizeField,\n            },\n            properties: [\n              {\n                id: 'custom.pointSize.max',\n                value: sizeMax,\n              },\n            ],\n          });\n        }\n      }\n    }\n\n    return {\n      frame: {\n        matcher: {\n          id: FrameMatcherID.byIndex,\n          options: frame ?? (seriesMapping === SeriesMapping.Manual ? i++ : (frameShared ?? 0)),\n        },\n      },\n      x: {\n        matcher: xMatcherConfig,\n      },\n      y: {\n        matcher: yMatcherConfig,\n        ...(exclude.length && {\n          exclude: {\n            id: FieldMatcherID.byNames,\n            options: exclude,\n          },\n        }),\n      },\n      ...(colorField && {\n        color: {\n          matcher: {\n            id: FieldMatcherID.byName,\n            options: colorField,\n          },\n        },\n      }),\n      ...(sizeField && {\n        size: {\n          matcher: {\n            id: FieldMatcherID.byName,\n            options: sizeField,\n          },\n        },\n      }),\n    };\n  });\n\n  const newOptions: Options = {\n    ...cleanedOpts,\n    mapping: seriesMapping === SeriesMapping.Auto ? SeriesMapping.Auto : SeriesMapping.Manual,\n    series: newSeries,\n  };\n\n  return newOptions;\n}\n","import { PanelPlugin } from '@grafana/data';\nimport { commonOptionsBuilder } from '@grafana/ui';\n\nimport { SeriesEditor } from './SeriesEditor';\nimport { XYChartPanel2 } from './XYChartPanel';\nimport { getScatterFieldConfig } from './config';\nimport { xyChartMigrationHandler } from './migrations';\nimport { FieldConfig, defaultFieldConfig, Options } from './panelcfg.gen';\n\nexport const plugin = new PanelPlugin<Options, FieldConfig>(XYChartPanel2)\n  // .setPanelChangeHandler(xyChartChangeHandler)\n  .setMigrationHandler(xyChartMigrationHandler)\n  .useFieldConfig(getScatterFieldConfig(defaultFieldConfig))\n  .setPanelOptions((builder) => {\n    builder\n      .addRadio({\n        path: 'mapping',\n        name: 'Series mapping',\n        defaultValue: 'auto',\n        settings: {\n          options: [\n            { value: 'auto', label: 'Auto' },\n            { value: 'manual', label: 'Manual' },\n          ],\n        },\n      })\n      .addCustomEditor({\n        id: 'series',\n        path: 'series',\n        name: '',\n        editor: SeriesEditor,\n        defaultValue: [{}],\n      });\n\n    commonOptionsBuilder.addTooltipOptions(builder, true);\n    commonOptionsBuilder.addLegendOptions(builder);\n  });\n","// Code generated - EDITING IS FUTILE. DO NOT EDIT.\n//\n// Generated by:\n//     public/app/plugins/gen.go\n// Using jennies:\n//     TSTypesJenny\n//     PluginTsTypesJenny\n//\n// Run 'make gen-cue' from repository root to regenerate.\n\nimport * as common from '@grafana/schema';\n\nexport enum PointShape {\n  Circle = 'circle',\n  Square = 'square',\n}\n\nexport enum SeriesMapping {\n  Auto = 'auto',\n  Manual = 'manual',\n}\n\nexport enum XYShowMode {\n  Lines = 'lines',\n  Points = 'points',\n  PointsAndLines = 'points+lines',\n}\n\n/**\n * NOTE: (copied from dashboard_kind.cue, since not exported)\n * Matcher is a predicate configuration. Based on the config a set of field(s) or values is filtered in order to apply override / transformation.\n * It comes with in id ( to resolve implementation from registry) and a configuration that’s specific to a particular matcher type.\n */\nexport interface MatcherConfig {\n  /**\n   * The matcher id. This is used to find the matcher implementation from registry.\n   */\n  id: string;\n  /**\n   * The matcher options. This is specific to the matcher implementation.\n   */\n  options?: unknown;\n}\n\nexport const defaultMatcherConfig: Partial<MatcherConfig> = {\n  id: '',\n};\n\nexport interface FieldConfig extends common.HideableFieldConfig, common.AxisConfig {\n  fillOpacity?: number;\n  lineStyle?: common.LineStyle;\n  lineWidth?: number;\n  pointShape?: PointShape;\n  pointSize?: {\n    fixed?: number;\n    min?: number;\n    max?: number;\n  };\n  pointStrokeWidth?: number;\n  show?: XYShowMode;\n}\n\nexport const defaultFieldConfig: Partial<FieldConfig> = {\n  fillOpacity: 50,\n  show: XYShowMode.Points,\n};\n\nexport interface XYSeriesConfig {\n  color?: {\n    matcher: MatcherConfig;\n  };\n  frame?: {\n    matcher: MatcherConfig;\n  };\n  name?: {\n    fixed?: string;\n  };\n  size?: {\n    matcher: MatcherConfig;\n  };\n  x?: {\n    matcher: MatcherConfig;\n  };\n  y?: {\n    matcher: MatcherConfig;\n  };\n}\n\nexport interface Options extends common.OptionsWithLegend, common.OptionsWithTooltip {\n  mapping: SeriesMapping;\n  series: Array<XYSeriesConfig>;\n}\n\nexport const defaultOptions: Partial<Options> = {\n  series: [],\n};\n","import {\n  Field,\n  formattedValueToString,\n  getFieldMatcher,\n  FieldType,\n  getFieldDisplayName,\n  DataFrame,\n  FrameMatcherID,\n  MatcherConfig,\n  FieldColorModeId,\n  cacheFieldDisplayNames,\n  FieldMatcherID,\n  FieldConfigSource,\n} from '@grafana/data';\nimport { decoupleHideFromState } from '@grafana/data/internal';\nimport { config } from '@grafana/runtime';\nimport { VisibilityMode } from '@grafana/schema';\n\nimport { XYShowMode, SeriesMapping, XYSeriesConfig } from './panelcfg.gen';\nimport { XYSeries } from './types2';\n\nexport function fmt(field: Field, val: number): string {\n  if (field.display) {\n    return formattedValueToString(field.display(val));\n  }\n\n  return `${val}`;\n}\n\n// cause we dont have a proper matcher for this currently\nfunction getFrameMatcher2(config: MatcherConfig) {\n  if (config.id === FrameMatcherID.byIndex) {\n    return (frame: DataFrame, index: number) => index === config.options;\n  }\n\n  return () => false;\n}\n\nexport function prepSeries(\n  mapping: SeriesMapping,\n  mappedSeries: XYSeriesConfig[],\n  frames: DataFrame[],\n  fieldConfig: FieldConfigSource\n) {\n  cacheFieldDisplayNames(frames);\n  decoupleHideFromState(frames, fieldConfig);\n\n  let series: XYSeries[] = [];\n\n  if (mappedSeries.length === 0) {\n    mappedSeries = [{}];\n  }\n\n  const { palette, getColorByName } = config.theme2.visualization;\n\n  mappedSeries.forEach((seriesCfg, seriesIdx) => {\n    if (mapping === SeriesMapping.Manual) {\n      if (seriesCfg.frame?.matcher == null || seriesCfg.x?.matcher == null || seriesCfg.y?.matcher == null) {\n        return;\n      }\n    }\n\n    let xMatcher = getFieldMatcher(\n      seriesCfg.x?.matcher ?? {\n        id: FieldMatcherID.byType,\n        options: 'number',\n      }\n    );\n    let yMatcher = getFieldMatcher(\n      seriesCfg.y?.matcher ?? {\n        id: FieldMatcherID.byType,\n        options: 'number',\n      }\n    );\n    let colorMatcher = seriesCfg.color ? getFieldMatcher(seriesCfg.color.matcher) : null;\n    let sizeMatcher = seriesCfg.size ? getFieldMatcher(seriesCfg.size.matcher) : null;\n    // let frameMatcher = seriesCfg.frame ? getFrameMatchers(seriesCfg.frame) : null;\n    let frameMatcher = seriesCfg.frame ? getFrameMatcher2(seriesCfg.frame.matcher) : null;\n\n    // loop over all frames and fields, adding a new series for each y dim\n    frames.forEach((frame, frameIdx) => {\n      // must match frame in manual mode\n      if (frameMatcher != null && !frameMatcher(frame, frameIdx)) {\n        return;\n      }\n\n      // shared across each series in this frame\n      let restFields: Field[] = [];\n\n      let frameSeries: XYSeries[] = [];\n\n      // only grabbing number fields (exclude time, string, enum, other)\n      let onlyNumFields = frame.fields.filter((field) => field.type === FieldType.number);\n\n      // only one of these per frame\n      let x = onlyNumFields.find((field) => xMatcher(field, frame, frames));\n      let color =\n        colorMatcher != null\n          ? onlyNumFields.find((field) => field !== x && colorMatcher!(field, frame, frames))\n          : undefined;\n      let size =\n        sizeMatcher != null\n          ? onlyNumFields.find((field) => field !== x && field !== color && sizeMatcher!(field, frame, frames))\n          : undefined;\n\n      // x field is required\n      if (x != null) {\n        // match y fields and create series\n        onlyNumFields.forEach((field) => {\n          if (field === x) {\n            return;\n          }\n\n          // in auto mode don't reuse already-mapped fields\n          if (mapping === SeriesMapping.Auto && (field === color || field === size)) {\n            return;\n          }\n\n          // in manual mode only add single series for this config\n          if (mapping === SeriesMapping.Manual && frameSeries.length > 0) {\n            return;\n          }\n\n          // if we match non-excluded y, create series\n          if (yMatcher(field, frame, frames) && !field.config.custom?.hideFrom?.viz) {\n            let y = field;\n\n            let name = seriesCfg.name?.fixed;\n\n            if (name == null) {\n              // if the displayed field name is likely to have a common prefix or suffix\n              // (such as those from Partition by values transformation)\n              const likelyHasCommonParts =\n                frames.length > 1 && (frame.name != null || Object.keys(y.labels ?? {}).length > 0);\n\n              // if the field was explictly (re)named using config.displayName or config.displayNameFromDS\n              // we still want to retain any frame name prefix or suffix so that autoNameSeries() can\n              // properly detect + strip common parts across all series...\n              const { displayName, displayNameFromDS } = y.config;\n              const hasExplicitName = displayName != null || displayNameFromDS != null;\n\n              if (likelyHasCommonParts && hasExplicitName) {\n                // ...and a hacky way to do this is to temp remove the explicit name, get the auto name, then revert\n                const stateDisplayName = y.state!.displayName;\n\n                // clear config and cache\n                y.config.displayName = y.config.displayNameFromDS = y.state!.displayName = undefined;\n                // get default/calculated display name (maybe use calculateFieldDisplayName() here instead?)\n                name = getFieldDisplayName(y, frame, frames);\n                // replace original field name with explicit one\n                name = name.replace(y.name, (displayNameFromDS ?? displayName)!);\n\n                // revert\n                y.config.displayName = displayName;\n                y.config.displayNameFromDS = displayNameFromDS;\n                y.state!.displayName = stateDisplayName;\n              } else {\n                name = getFieldDisplayName(y, frame, frames);\n              }\n            }\n\n            let ser: XYSeries = {\n              // these typically come from y field\n              name: {\n                value: name,\n              },\n\n              showPoints: y.config.custom.show === XYShowMode.Lines ? VisibilityMode.Never : VisibilityMode.Always,\n              pointShape: y.config.custom.pointShape,\n              pointStrokeWidth: y.config.custom.pointStrokeWidth,\n              fillOpacity: y.config.custom.fillOpacity,\n\n              showLine: y.config.custom.show !== XYShowMode.Points,\n              lineWidth: y.config.custom.lineWidth ?? 2,\n              lineStyle: y.config.custom.lineStyle,\n\n              x: {\n                field: x!,\n              },\n              y: {\n                field: y,\n              },\n              color: {},\n              size: {},\n              _rest: restFields,\n            };\n\n            if (color != null) {\n              ser.color.field = color;\n            }\n\n            if (size != null) {\n              ser.size.field = size;\n              ser.size.min = size.config.custom.pointSize?.min ?? 5;\n              ser.size.max = size.config.custom.pointSize?.max ?? 100;\n              // ser.size.mode =\n            }\n\n            frameSeries.push(ser);\n          }\n        });\n\n        if (frameSeries.length === 0) {\n          // TODO: could not create series, skip & show error?\n        }\n\n        // populate rest fields\n        frame.fields.forEach((field) => {\n          let isUsedField = frameSeries.some(\n            ({ x, y, color, size }) =>\n              x.field === field || y.field === field || color.field === field || size.field === field\n          );\n\n          if (!isUsedField) {\n            restFields.push(field);\n          }\n        });\n\n        series.push(...frameSeries);\n      } else {\n        // x is missing in this frame!\n      }\n    });\n  });\n\n  if (series.length === 0) {\n    // TODO: could not create series, skip & show error?\n  } else {\n    // assign classic palette colors by index, as fallbacks for all series\n\n    let paletteIdx = 0;\n\n    // todo: populate min, max, mode from field + hints\n    series.forEach((s, i) => {\n      if (s.color.field == null) {\n        // derive fixed color from y field config\n        let colorCfg = s.y.field.config.color ?? { mode: FieldColorModeId.PaletteClassic };\n\n        let value = '';\n\n        if (colorCfg.mode === FieldColorModeId.PaletteClassic) {\n          value = getColorByName(palette[paletteIdx++ % palette.length]); // todo: do this via state.seriesIdx and re-init displayProcessor\n        } else if (colorCfg.mode === FieldColorModeId.Fixed) {\n          value = getColorByName(colorCfg.fixedColor!);\n        }\n\n        s.color.fixed = value;\n      }\n\n      if (s.size.field == null) {\n        // derive fixed size from y field config\n        s.size.fixed = s.y.field.config.custom.pointSize?.fixed ?? 5;\n        // ser.size.mode =\n      }\n    });\n\n    autoNameSeries(series);\n\n    // TODO: re-assign y display names?\n    // y.state = {\n    //   ...y.state,\n    //   seriesIndex: series.length + ,\n    // };\n    // y.display = getDisplayProcessor({ field, theme });\n  }\n\n  return series;\n}\n\n// strip common prefixes and suffixes from y field names\nfunction autoNameSeries(series: XYSeries[]) {\n  let names = series.map((s) => s.name.value.split(/\\s+/g));\n\n  const { prefix, suffix } = findCommonPrefixSuffixLengths(names);\n\n  if (prefix < Infinity || suffix < Infinity) {\n    series.forEach((s, i) => {\n      s.name.value = names[i].slice(prefix, names[i].length - suffix).join(' ');\n    });\n  }\n}\n\nexport function getCommonPrefixSuffix(strs: string[]) {\n  let names = strs.map((s) => s.split(/\\s+/g));\n\n  let { prefix, suffix } = findCommonPrefixSuffixLengths(names);\n\n  let n = names[0];\n\n  if (n.length === 1 && prefix === 1 && suffix === 1) {\n    return '';\n  }\n\n  let parts = [];\n\n  if (prefix > 0) {\n    parts.push(...n.slice(0, prefix));\n  }\n\n  if (suffix > 0) {\n    parts.push(...n.slice(-suffix));\n  }\n\n  return parts.join(' ');\n}\n\n// lengths are in number of tokens (segments) in a phrase\nfunction findCommonPrefixSuffixLengths(names: string[][]) {\n  let commonPrefixLen = Infinity;\n  let commonSuffixLen = Infinity;\n\n  // if auto naming strategy, rename fields by stripping common prefixes and suffixes\n  let segs0: string[] = names[0];\n\n  for (let i = 1; i < names.length; i++) {\n    if (names[i].length < segs0.length) {\n      segs0 = names[i];\n    }\n  }\n\n  for (let i = 1; i < names.length; i++) {\n    let segs = names[i];\n\n    if (segs !== segs0) {\n      // prefixes\n      let preLen = 0;\n      for (let j = 0; j < segs0.length; j++) {\n        if (segs[j] === segs0[j]) {\n          preLen++;\n        } else {\n          break;\n        }\n      }\n\n      if (preLen < commonPrefixLen) {\n        commonPrefixLen = preLen;\n      }\n\n      // suffixes\n      let sufLen = 0;\n      for (let j = segs0.length - 1; j >= 0; j--) {\n        if (segs[j] === segs0[j]) {\n          sufLen++;\n        } else {\n          break;\n        }\n      }\n\n      if (sufLen < commonSuffixLen) {\n        commonSuffixLen = sufLen;\n      }\n    }\n  }\n\n  return {\n    prefix: commonPrefixLen,\n    suffix: commonSuffixLen,\n  };\n}\n"],"names":["VizTooltipWrapper","children","className","styles","getStyles","theme","LayerName","name","onChange","verifyLayerNameUniqueness","overrideStyles","isEditing","setIsEditing","validationError","setValidationError","onEditLayer","event","onEndEditName","newName","onInputChange","onEditLayerBlur","onKeyDown","onFocus","SeriesEditor","seriesCfg","context","style","mapping","prevMapping","usePrevious","mappingChanged","defaultFrame","selectedIdx","setSelectedIdx","addSeries","deleteSeries","index","s","i","series","formKey","baseNameMode","frame","frameIndex","field","fieldIndex","Button","e","v","IconButton","Fragment","Field","Select","opt","FieldNamePicker","fieldName","stripSeriesName","seriesName","XYChartTooltip","dataIdxs","seriesIdx","data","xySeries","dismiss","isPinned","replaceVariables","dataLinks","rowIndex","idx","xField","yField","sizeField","colorField","label","seriesColor","headerItem","colorManipulator","contentItems","footer","hasOneClickLink","dataLink","yFieldFrame","actions","VizTooltipFooter","VizTooltipHeader","VizTooltipContent","prepConfig","qt","hRect","drawBubblesFactory","opts","u","idx0","idx1","dataX","dataY","scaleX","scaleY","valToPosX","valToPosY","xOff","yOff","xDim","yDim","moveTo","lineTo","rect","arc","pxRatio","scatterInfo","d","showLine","showPoints","strokeWidth","pointAlpha","deg360","xKey","yKey","pointSize","colorByValue","maxSize","filtLft","filtRgt","filtBtm","filtTop","sizes","pointColors","dispColors","pointPalette","paletteHasAlpha","isSquare","linePath","curColorIdx","xVal","yVal","size","cx","cy","c","x","y","lineStyle","drawBubbles","dataIdx","lft","top","wid","hgt","builder","UPlotConfigBuilder","dist","o","ocx","ocy","dx","dy","r","fieldConfig","customConfig","scaleDistr","xAxisLabel","dispNames","xAxisAutoLabel","decimals","si","lineColor","pointColor","scaleKey","config","yAxisLabel","yAxisAutoLabel","cfg","f","fieldValueColors","prepData","sizeRange","colorRange","getGlobalRanges","len","diams","min","max","minPx","pxRange","vals","minVal","valRange","valPct","pxArea","ranges","facet","fi","range","getHex8Color","color","tinycolor","getAll","getOne","conds","mappings","m","k","rhs","spl","steps","lasti","calc","pct","XYChartPanel2","props","mappedSeries","error","renderLegend","items","placement","displayMode","width","sortBy","sortDesc","VizLayout","VizLegend","vizWidth","vizHeight","TooltipPlugin2","timeRange2","viaSync","DEFAULT_POINT_SIZE","getScatterFieldConfig","LineStyleEditor","SeriesMapping","ScatterShow","defaultXYDimensionConfig","defaultFieldConfig","defaultOptions","xyChartMigrationHandler","panel","pluginVersion","migrateOptions","dims","seriesMapping","oldSeries","cleanedOpts","exclude","frameShared","xShared","custDefaults","oldSeries2","newSeries","colorFixed","sizeFixed","sizeMin","sizeMax","xMatcherConfig","yMatcherConfig","p","PanelPlugin","PointShape","XYShowMode","defaultMatcherConfig","fmt","val","getFrameMatcher2","prepSeries","frames","palette","getColorByName","xMatcher","yMatcher","colorMatcher","sizeMatcher","frameMatcher","frameIdx","restFields","frameSeries","onlyNumFields","likelyHasCommonParts","displayName","displayNameFromDS","hasExplicitName","stateDisplayName","ser","paletteIdx","colorCfg","value","autoNameSeries","names","prefix","suffix","findCommonPrefixSuffixLengths","getCommonPrefixSuffix","strs","n","parts","commonPrefixLen","commonSuffixLen","segs0","segs","preLen","j","sufLen"],"sourceRoot":""}