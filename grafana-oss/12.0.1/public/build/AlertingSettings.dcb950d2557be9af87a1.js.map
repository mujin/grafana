{"version":3,"file":"AlertingSettings.dcb950d2557be9af87a1.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/components/settings/AlertmanagerConfig.tsx","webpack://grafana/./public/app/features/alerting/unified/api/dataSourcesApi.ts","webpack://grafana/./public/app/features/alerting/unified/hooks/useExternalAmSelector.ts","webpack://grafana/./public/app/features/alerting/unified/utils/settings.ts","webpack://grafana/./public/app/features/alerting/unified/components/settings/hooks.tsx","webpack://grafana/./public/app/features/alerting/unified/components/settings/SettingsContext.tsx","webpack://grafana/./public/app/features/alerting/unified/components/settings/VersionManager.tsx","webpack://grafana/./public/app/features/alerting/unified/components/settings/ConfigurationDrawer.tsx","webpack://grafana/./public/app/features/alerting/unified/components/settings/AlertmanagerCard.tsx","webpack://grafana/./public/app/features/alerting/unified/components/settings/ExternalAlertmanagers.tsx","webpack://grafana/./public/app/features/alerting/unified/components/settings/InternalAlertmanager.tsx","webpack://grafana/./public/app/features/alerting/unified/Settings.tsx","webpack://grafana/./public/app/features/alerting/unified/hooks/useAlertmanagerConfig.ts"],"sourcesContent":["import { css } from '@emotion/css';\nimport { useEffect, useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport AutoSizer from 'react-virtualized-auto-sizer';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Alert, Button, CodeEditor, ConfirmModal, Stack, useStyles2 } from '@grafana/ui';\nimport { Trans, t } from 'app/core/internationalization';\n\nimport { reportFormErrors } from '../../Analytics';\nimport { useAlertmanagerConfig } from '../../hooks/useAlertmanagerConfig';\nimport { useUnifiedAlertingSelector } from '../../hooks/useUnifiedAlertingSelector';\nimport { GRAFANA_RULES_SOURCE_NAME, isVanillaPrometheusAlertManagerDataSource } from '../../utils/datasource';\nimport { Spacer } from '../Spacer';\n\nexport interface FormValues {\n  configJSON: string;\n}\n\ninterface Props {\n  alertmanagerName: string;\n  onDismiss: () => void;\n  onSave: (dataSourceName: string, oldConfig: string, newConfig: string) => void;\n  onReset: (dataSourceName: string) => void;\n}\n\nexport default function AlertmanagerConfig({ alertmanagerName, onDismiss, onSave, onReset }: Props): JSX.Element {\n  const { loading: isDeleting, error: deletingError } = useUnifiedAlertingSelector((state) => state.deleteAMConfig);\n  const { loading: isSaving, error: savingError } = useUnifiedAlertingSelector((state) => state.saveAMConfig);\n  const [showResetConfirmation, setShowResetConfirmation] = useState(false);\n  const isGrafanaManagedAlertmanager = alertmanagerName === GRAFANA_RULES_SOURCE_NAME;\n\n  // ⚠️ provisioned data sources should not prevent the configuration from being edited\n  const immutableDataSource = alertmanagerName ? isVanillaPrometheusAlertManagerDataSource(alertmanagerName) : false;\n  const readOnly = immutableDataSource || isGrafanaManagedAlertmanager;\n\n  const styles = useStyles2(getStyles);\n\n  const {\n    currentData: config,\n    error: loadingError,\n    isSuccess: isLoadingSuccessful,\n    isLoading: isLoadingConfig,\n  } = useAlertmanagerConfig(alertmanagerName);\n\n  const defaultValues = {\n    configJSON: config ? JSON.stringify(config, null, 2) : '',\n  };\n\n  const {\n    register,\n    setValue,\n    setError,\n    handleSubmit,\n    formState: { errors },\n  } = useForm<FormValues>({\n    defaultValues,\n  });\n\n  // make sure we update the configJSON field when we receive a response from the `useAlertmanagerConfig` hook\n  useEffect(() => {\n    if (config) {\n      setValue('configJSON', JSON.stringify(config, null, 2));\n    }\n  }, [config, setValue]);\n\n  useEffect(() => {\n    if (savingError) {\n      setError('configJSON', { type: 'deps', message: savingError.message });\n    }\n  }, [savingError, setError]);\n\n  useEffect(() => {\n    if (deletingError) {\n      setError('configJSON', { type: 'deps', message: deletingError.message });\n    }\n  }, [deletingError, setError]);\n\n  // manually register the config field with validation\n  // @TODO sometimes the value doesn't get registered – find out why\n  register('configJSON', {\n    required: { value: true, message: 'Configuration cannot be empty' },\n    validate: (value: string) => {\n      try {\n        JSON.parse(value);\n        return true;\n      } catch (e) {\n        return e instanceof Error ? e.message : 'JSON is invalid';\n      }\n    },\n  });\n\n  const handleSave = handleSubmit((values: FormValues) => {\n    onSave(alertmanagerName, defaultValues.configJSON, values.configJSON);\n  }, reportFormErrors);\n\n  const isOperating = isLoadingConfig || isDeleting || isSaving;\n\n  /* loading error, if this fails don't bother rendering the form */\n  if (loadingError) {\n    return (\n      <Alert\n        severity=\"error\"\n        title={t(\n          'alerting.alertmanager-config.title-failed-to-load-alertmanager-configuration',\n          'Failed to load Alertmanager configuration'\n        )}\n      >\n        {loadingError.message ?? 'An unknown error occurred.'}\n      </Alert>\n    );\n  }\n\n  /* resetting configuration state */\n  if (isDeleting) {\n    return (\n      <Alert\n        severity=\"info\"\n        title={t(\n          'alerting.alertmanager-config.title-resetting-alertmanager-configuration',\n          'Resetting Alertmanager configuration'\n        )}\n      >\n        <Trans i18nKey=\"alerting.alertmanager-config.resetting-configuration-might-while\">\n          Resetting configuration, this might take a while.\n        </Trans>\n      </Alert>\n    );\n  }\n\n  const confirmationText = t(\n    'alerting.alertmanager-config.reset-confirmation',\n    'Are you sure you want to reset configuration for \"{{alertmanagerName}}\"? Contact points and notification policies will be reset to their defaults.',\n    { alertmanagerName }\n  );\n\n  return (\n    <div className={styles.container}>\n      {isGrafanaManagedAlertmanager && (\n        <Alert\n          severity=\"info\"\n          title={t(\n            'alerting.alertmanager-config.gma-manual-configuration-is-not-supported',\n            'Manual configuration changes not supported'\n          )}\n        >\n          <Trans i18nKey=\"alerting.alertmanager-config.gma-manual-configuration-description\">\n            The internal Grafana Alertmanager configuration cannot be manually changed. To change this configuration,\n            edit the individual resources through the UI.\n          </Trans>\n        </Alert>\n      )}\n      {/* form error state */}\n      {errors.configJSON && (\n        <Alert\n          severity=\"error\"\n          title={t('alerting.alertmanager-config.title-oops-something-went-wrong', 'Oops, something went wrong')}\n        >\n          {errors.configJSON.message || 'An unknown error occurred.'}\n        </Alert>\n      )}\n\n      {isLoadingSuccessful && (\n        <div className={styles.content}>\n          <AutoSizer>\n            {({ height, width }) => (\n              <CodeEditor\n                language=\"json\"\n                width={width}\n                height={height}\n                showLineNumbers={true}\n                monacoOptions={{\n                  scrollBeyondLastLine: false,\n                }}\n                value={defaultValues.configJSON}\n                showMiniMap={false}\n                onSave={(value) => setValue('configJSON', value)}\n                onBlur={(value) => setValue('configJSON', value)}\n                readOnly={isOperating}\n              />\n            )}\n          </AutoSizer>\n        </div>\n      )}\n\n      <Stack justifyContent=\"flex-end\">\n        {!readOnly && (\n          <Button variant=\"destructive\" onClick={() => setShowResetConfirmation(true)} disabled={isOperating}>\n            <Trans i18nKey=\"alerting.alertmanager-config.reset\">Reset</Trans>\n          </Button>\n        )}\n        <Spacer />\n        <Button variant=\"secondary\" onClick={() => onDismiss()} disabled={isOperating}>\n          <Trans i18nKey=\"alerting.common.cancel\">Cancel</Trans>\n        </Button>\n        {!readOnly && (\n          <Button variant=\"primary\" onClick={handleSave} disabled={isOperating}>\n            <Trans i18nKey=\"common.save\">Save</Trans>\n          </Button>\n        )}\n      </Stack>\n      <ConfirmModal\n        isOpen={showResetConfirmation}\n        title={t(\n          'alerting.alertmanager-config.title-reset-alertmanager-configuration',\n          'Reset Alertmanager configuration'\n        )}\n        body={confirmationText}\n        confirmText=\"Yes, reset configuration\"\n        onConfirm={() => {\n          onReset(alertmanagerName);\n          setShowResetConfirmation(false);\n        }}\n        onDismiss={() => {\n          setShowResetConfirmation(false);\n        }}\n      />\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css({\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n    gap: theme.spacing(2),\n  }),\n  content: css({\n    flex: '1 1 100%',\n  }),\n});\n","import { DataSourceSettings } from '@grafana/data';\n\nimport { alertingApi } from './alertingApi';\n\nexport const dataSourcesApi = alertingApi.injectEndpoints({\n  endpoints: (build) => ({\n    getAllDataSourceSettings: build.query<DataSourceSettings[], void>({\n      query: () => ({ url: 'api/datasources' }),\n      // we'll create individual cache entries for each datasource UID\n      providesTags: (result) => {\n        return result ? result.map(({ uid }) => ({ type: 'DataSourceSettings', id: uid })) : ['DataSourceSettings'];\n      },\n    }),\n    getDataSourceSettingsForUID: build.query<DataSourceSettings, string>({\n      query: (uid) => ({ url: `api/datasources/uid/${uid}` }),\n      providesTags: (_result, _error, uid) => [{ type: 'DataSourceSettings', id: uid }],\n    }),\n    updateDataSourceSettingsForUID: build.mutation<unknown, { uid: string; settings: DataSourceSettings }>({\n      query: ({ uid, settings }) => ({\n        url: `api/datasources/uid/${uid}`,\n        method: 'PUT',\n        data: settings,\n        showSuccessAlert: false,\n      }),\n      // we need to invalidate the settings for a single Datasource because otherwise the backend will complain\n      // about it already having been edited by another user – edits are tracked with a version number\n      invalidatesTags: (_result, _error, args) => [{ type: 'DataSourceSettings', id: args.uid }],\n    }),\n  }),\n});\n","import { DataSourceSettings } from '@grafana/data';\nimport {\n  AlertManagerDataSourceJsonData,\n  ExternalAlertmanagersConnectionStatus,\n} from 'app/plugins/datasource/alertmanager/types';\n\nimport { alertmanagerApi } from '../api/alertmanagerApi';\nimport { dataSourcesApi } from '../api/dataSourcesApi';\nimport { isAlertmanagerDataSource } from '../utils/datasource';\n\nexport type ConnectionStatus = 'active' | 'pending' | 'dropped' | 'inconclusive' | 'uninterested' | 'unknown';\n\nexport interface ExternalAlertmanagerDataSourceWithStatus {\n  dataSourceSettings: DataSourceSettings<AlertManagerDataSourceJsonData>;\n  status: ConnectionStatus;\n}\n\ninterface UseExternalDataSourceAlertmanagersProps {\n  refetchOnMountOrArgChange?: boolean;\n}\n\n/**\n * Returns all configured Alertmanager data sources and their connection status with the internal ruler\n */\nexport function useExternalDataSourceAlertmanagers({\n  refetchOnMountOrArgChange = false,\n}: UseExternalDataSourceAlertmanagersProps = {}): ExternalAlertmanagerDataSourceWithStatus[] {\n  // firstly we'll fetch the settings for all datasources and filter for \"alertmanager\" type\n  const { alertmanagerDataSources } = dataSourcesApi.endpoints.getAllDataSourceSettings.useQuery(undefined, {\n    refetchOnReconnect: true,\n    // we will refetch the list of data sources every time the component is rendered so we always show fresh data after a user\n    // may have made changes to a data source and came back to the list\n    refetchOnMountOrArgChange,\n    selectFromResult: (result) => {\n      const alertmanagerDataSources = result.currentData?.filter(isAlertmanagerDataSource) ?? [];\n      return { ...result, alertmanagerDataSources };\n    },\n  });\n\n  // we'll also fetch the configuration for which Alertmanagers we are forwarding Grafana-managed alerts too\n  const { currentData: externalAlertmanagers } = alertmanagerApi.endpoints.getExternalAlertmanagers.useQuery(\n    undefined,\n    { refetchOnReconnect: true, refetchOnMountOrArgChange }\n  );\n\n  if (!alertmanagerDataSources) {\n    return [];\n  }\n\n  return alertmanagerDataSources.map<ExternalAlertmanagerDataSourceWithStatus>((dataSourceSettings) => {\n    const status = externalAlertmanagers\n      ? determineAlertmanagerConnectionStatus(externalAlertmanagers, dataSourceSettings)\n      : 'unknown';\n\n    return {\n      dataSourceSettings,\n      status,\n    };\n  });\n}\n\n// using the information from /api/v1/ngalert/alertmanagers we should derive the connection status of a single data source\nfunction determineAlertmanagerConnectionStatus(\n  externalAlertmanagers: ExternalAlertmanagersConnectionStatus,\n  dataSourceSettings: DataSourceSettings<AlertManagerDataSourceJsonData>\n): ConnectionStatus {\n  const isInterestedInAlerts = dataSourceSettings.jsonData.handleGrafanaManagedAlerts;\n  if (!isInterestedInAlerts) {\n    return 'uninterested';\n  }\n\n  const isActive =\n    externalAlertmanagers?.activeAlertManagers.some((am) => {\n      return isAlertmanagerMatchByURL(dataSourceSettings.url, am.url);\n    }) ?? [];\n\n  const isDropped =\n    externalAlertmanagers?.droppedAlertManagers.some((am) => {\n      return isAlertmanagerMatchByURL(dataSourceSettings.url, am.url);\n    }) ?? [];\n\n  // the Alertmanager is being adopted (pending) if it is interested in handling alerts but not in either \"active\" or \"dropped\"\n  const isPending = !isActive && !isDropped;\n  if (isPending) {\n    return 'pending';\n  }\n\n  // Multiple Alertmanagers of the same URL may exist (e.g. with different credentials)\n  // Alertmanager response only contains URLs, so when the URL exists in both active and dropped, we are not able\n  // to distinguish which is which, resulting in an inconclusive status.\n  const isInconclusive = isActive && isDropped;\n  if (isInconclusive) {\n    return 'inconclusive';\n  }\n\n  // if we get here, it's neither \"uninterested\", nor \"inconclusive\" nor \"pending\"\n  if (isActive) {\n    return 'active';\n  } else if (isDropped) {\n    return 'dropped';\n  }\n\n  return 'unknown';\n}\n\n// the vanilla Alertmanager and Mimir Alertmanager mount their API endpoints on different sub-paths\n// Cortex also uses the same paths as Mimir\nconst MIMIR_ALERTMANAGER_PATH = '/alertmanager/api/v2/alerts';\nconst VANILLA_ALERTMANAGER_PATH = '/api/v2/alerts';\n\n// when using the Mimir Alertmanager, those paths are mounted under \"/alertmanager\"\nfunction isAlertmanagerMatchByURL(dataSourceUrl: string, alertmanagerUrl: string) {\n  const normalizedUrl = normalizeDataSourceURL(dataSourceUrl);\n\n  const prometheusAlertmanagerMatch = alertmanagerUrl === `${normalizedUrl}${VANILLA_ALERTMANAGER_PATH}`;\n  const mimirAlertmanagerMatch = alertmanagerUrl === `${normalizedUrl}${MIMIR_ALERTMANAGER_PATH}`;\n\n  return prometheusAlertmanagerMatch || mimirAlertmanagerMatch;\n}\n\n// Grafana prepends the http protocol if there isn't one, but it doesn't store that in the datasource settings\nexport function normalizeDataSourceURL(url: string) {\n  const hasProtocol = new RegExp('^[^:]*://').test(url);\n  const urlWithProtocol = hasProtocol ? url : `http://${url}`;\n\n  // replace trailing slashes\n  return urlWithProtocol.replace(/\\/+$/, '');\n}\n","import { AlertmanagerChoice, GrafanaAlertingConfiguration } from 'app/plugins/datasource/alertmanager/types';\n\n// if we have either \"internal\" or \"both\" configured this means the internal Alertmanager is receiving Grafana-managed alerts\nexport const isInternalAlertmanagerInterestedInAlerts = (config?: GrafanaAlertingConfiguration): boolean => {\n  if (!config) {\n    // The backend doesn't have a configuration record in a new Grafana instance until the user has interacted with the configuration page.\n    // For that reason, in case of no configuration, we assume that the internal Alertmanager is interested in alerts.\n    return true;\n  }\n  switch (config.alertmanagersChoice) {\n    case AlertmanagerChoice.Internal:\n    case AlertmanagerChoice.All:\n      return true;\n    case AlertmanagerChoice.External:\n    default:\n      return false;\n  }\n};\n","import { produce } from 'immer';\n\nimport { dataSourcesApi } from '../../api/dataSourcesApi';\nimport { isAlertmanagerDataSource } from '../../utils/datasource';\n\nexport const useEnableOrDisableHandlingGrafanaManagedAlerts = () => {\n  const [getSettings, getSettingsState] = dataSourcesApi.endpoints.getDataSourceSettingsForUID.useLazyQuery();\n  const [updateSettings, updateSettingsState] = dataSourcesApi.endpoints.updateDataSourceSettingsForUID.useMutation();\n\n  const enableOrDisable = async (uid: string, handleGrafanaManagedAlerts: boolean) => {\n    const existingSettings = await getSettings(uid).unwrap();\n    if (!isAlertmanagerDataSource(existingSettings)) {\n      throw new Error(`Data source with UID ${uid} is not an Alertmanager data source`);\n    }\n\n    const newSettings = produce(existingSettings, (draft) => {\n      draft.jsonData.handleGrafanaManagedAlerts = handleGrafanaManagedAlerts;\n    });\n\n    updateSettings({ uid, settings: newSettings });\n  };\n\n  const enable = (uid: string) => enableOrDisable(uid, true);\n  const disable = (uid: string) => enableOrDisable(uid, false);\n\n  const loadingState = {\n    isLoading: getSettingsState.isLoading || updateSettingsState.isLoading,\n    isError: getSettingsState.isError || updateSettingsState.isError,\n    error: getSettingsState.error || updateSettingsState.error,\n    data: updateSettingsState.data,\n  };\n\n  return [enable, disable, loadingState] as const;\n};\n","import { debounce, union, without } from 'lodash';\nimport { PropsWithChildren, createContext, useContext, useEffect, useRef } from 'react';\n\nimport { AppEvents } from '@grafana/data';\nimport { config, getAppEvents } from '@grafana/runtime';\nimport { AlertmanagerChoice, GrafanaAlertingConfiguration } from 'app/plugins/datasource/alertmanager/types';\nimport { dispatch } from 'app/store/store';\n\nimport { alertmanagerApi } from '../../api/alertmanagerApi';\nimport { dataSourcesApi } from '../../api/dataSourcesApi';\nimport {\n  ExternalAlertmanagerDataSourceWithStatus,\n  useExternalDataSourceAlertmanagers,\n} from '../../hooks/useExternalAmSelector';\nimport { deleteAlertManagerConfigAction, updateAlertManagerConfigAction } from '../../state/actions';\nimport { GRAFANA_RULES_SOURCE_NAME, isAlertmanagerDataSourceInterestedInAlerts } from '../../utils/datasource';\nimport { isInternalAlertmanagerInterestedInAlerts } from '../../utils/settings';\n\nimport { useEnableOrDisableHandlingGrafanaManagedAlerts } from './hooks';\n\nconst appEvents = getAppEvents();\n\ninterface Context {\n  configuration?: GrafanaAlertingConfiguration;\n  externalAlertmanagerDataSourcesWithStatus: ExternalAlertmanagerDataSourceWithStatus[];\n\n  isLoading: boolean;\n  isUpdating: boolean;\n\n  // for enabling / disabling Alertmanager datasources as additional receivers\n  enableAlertmanager: (uid: string) => void;\n  disableAlertmanager: (uid: string) => void;\n\n  // for updating or resetting the configuration for an Alertmanager\n  updateAlertmanagerSettings: (name: string, oldConfig: string, newConfig: string) => void;\n  resetAlertmanagerSettings: (name: string) => void;\n\n  // this feature toggle is for disabling the \"send to external Alertmanagers\" feature\n  forwardingDisabled: boolean;\n}\n\nconst SettingsContext = createContext<Context | undefined>(undefined);\nconst isInternalAlertmanager = (uid: string) => uid === GRAFANA_RULES_SOURCE_NAME;\n\nexport const SettingsProvider = (props: PropsWithChildren) => {\n  // this list will keep track of Alertmanager UIDs (including internal) that are interested in receiving alert instances\n  // this will be used to infer the correct \"delivery mode\" and update the correct list of datasources with \"wantsAlertsReceived\"\n  const interestedAlertmanagers: string[] = [];\n\n  const forwardingDisabled = config.featureToggles.alertingDisableSendAlertsExternal === true;\n\n  const { currentData: configuration, isLoading: isLoadingConfiguration } =\n    alertmanagerApi.endpoints.getGrafanaAlertingConfiguration.useQuery();\n\n  const [updateConfiguration, updateConfigurationState] =\n    alertmanagerApi.endpoints.updateGrafanaAlertingConfiguration.useMutation();\n  const [enableGrafanaManagedAlerts, disableGrafanaManagedAlerts, enableOrDisableHandlingGrafanaManagedAlertsState] =\n    useEnableOrDisableHandlingGrafanaManagedAlerts();\n\n  // we will alwayw refetch because a user could edit a data source and come back to this page\n  const externalAlertmanagersWithStatus = useExternalDataSourceAlertmanagers({ refetchOnMountOrArgChange: true });\n\n  const interestedInternal = isInternalAlertmanagerInterestedInAlerts(configuration);\n  if (interestedInternal) {\n    interestedAlertmanagers.push(GRAFANA_RULES_SOURCE_NAME);\n  }\n\n  externalAlertmanagersWithStatus\n    .filter((dataSource) => isAlertmanagerDataSourceInterestedInAlerts(dataSource.dataSourceSettings))\n    .forEach((alertmanager) => {\n      interestedAlertmanagers.push(alertmanager.dataSourceSettings.uid);\n    });\n\n  const enableAlertmanager = (uid: string) => {\n    const updatedInterestedAlertmanagers = union([uid], interestedAlertmanagers); // union will give us a unique array of uids\n    const newDeliveryMode = determineDeliveryMode(updatedInterestedAlertmanagers);\n    if (newDeliveryMode === null) {\n      return;\n    }\n\n    if (newDeliveryMode !== configuration?.alertmanagersChoice) {\n      updateConfiguration({ alertmanagersChoice: newDeliveryMode });\n    }\n\n    if (!isInternalAlertmanager(uid)) {\n      enableGrafanaManagedAlerts(uid);\n    }\n  };\n\n  const disableAlertmanager = (uid: string) => {\n    const updatedInterestedAlertmanagers = without(interestedAlertmanagers, uid);\n    const newDeliveryMode = determineDeliveryMode(updatedInterestedAlertmanagers);\n    if (newDeliveryMode === null) {\n      return;\n    }\n\n    if (newDeliveryMode !== configuration?.alertmanagersChoice) {\n      updateConfiguration({ alertmanagersChoice: newDeliveryMode });\n    }\n\n    if (!isInternalAlertmanager(uid)) {\n      disableGrafanaManagedAlerts(uid);\n    }\n  };\n\n  const updateAlertmanagerSettings = (alertManagerName: string, oldConfig: string, newConfig: string): void => {\n    dispatch(\n      updateAlertManagerConfigAction({\n        newConfig: JSON.parse(newConfig),\n        oldConfig: JSON.parse(oldConfig),\n        alertManagerSourceName: alertManagerName,\n        successMessage: 'Alertmanager configuration updated.',\n      })\n    );\n  };\n\n  const resetAlertmanagerSettings = (alertmanagerName: string) => {\n    dispatch(deleteAlertManagerConfigAction(alertmanagerName));\n  };\n\n  const value: Context = {\n    configuration,\n    forwardingDisabled,\n    externalAlertmanagerDataSourcesWithStatus: externalAlertmanagersWithStatus,\n\n    enableAlertmanager,\n    disableAlertmanager,\n\n    isLoading: isLoadingConfiguration,\n    isUpdating: updateConfigurationState.isLoading || enableOrDisableHandlingGrafanaManagedAlertsState.isLoading,\n\n    // CRUD for Alertmanager settings\n    updateAlertmanagerSettings,\n    resetAlertmanagerSettings,\n  };\n\n  return <SettingsContext.Provider value={value}>{props.children}</SettingsContext.Provider>;\n};\n\nfunction determineDeliveryMode(interestedAlertmanagers: string[]): AlertmanagerChoice | null {\n  const containsInternalAlertmanager = interestedAlertmanagers.some((uid) => uid === GRAFANA_RULES_SOURCE_NAME);\n  const containsExternalAlertmanager = interestedAlertmanagers.some((uid) => uid !== GRAFANA_RULES_SOURCE_NAME);\n\n  if (containsInternalAlertmanager && containsExternalAlertmanager) {\n    return AlertmanagerChoice.All;\n  }\n\n  if (!containsInternalAlertmanager && containsExternalAlertmanager) {\n    return AlertmanagerChoice.External;\n  }\n\n  if (containsInternalAlertmanager && !containsExternalAlertmanager) {\n    return AlertmanagerChoice.Internal;\n  }\n\n  // if we get here we probably have no targets at all and that's not supposed to be possible.\n  appEvents.publish({\n    type: AppEvents.alertError.name,\n    payload: ['You need to have at least one Alertmanager to receive alerts.'],\n  });\n\n  return null;\n}\n\nexport function useSettings() {\n  const context = useContext(SettingsContext);\n\n  if (context === undefined) {\n    throw new Error('useSettings must be used within a SettingsContext');\n  }\n\n  // we'll automatically re-fetch the Alertmanager connection status while any Alertmanagers are pending by invalidating the cache entry\n  const debouncedUpdateStatus = debounce(() => {\n    dispatch(dataSourcesApi.util.invalidateTags(['AlertmanagerConnectionStatus']));\n  }, 3000);\n  const refetchAlertmanagerConnectionStatus = useRef(debouncedUpdateStatus);\n\n  const hasPendingAlertmanagers = context.externalAlertmanagerDataSourcesWithStatus.some(\n    ({ status }) => status === 'pending'\n  );\n  if (hasPendingAlertmanagers) {\n    refetchAlertmanagerConnectionStatus.current();\n  }\n\n  useEffect(() => {\n    debouncedUpdateStatus.cancel();\n  }, [debouncedUpdateStatus]);\n\n  return context;\n}\n","import { css } from '@emotion/css';\nimport { omit } from 'lodash';\nimport moment from 'moment';\nimport { useState } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport {\n  Alert,\n  Badge,\n  Button,\n  CellProps,\n  Column,\n  ConfirmModal,\n  InteractiveTable,\n  Stack,\n  Text,\n  useStyles2,\n} from '@grafana/ui';\nimport { Trans, t } from 'app/core/internationalization';\nimport { DiffViewer } from 'app/features/dashboard-scene/settings/version-history/DiffViewer';\nimport { AlertManagerCortexConfig } from 'app/plugins/datasource/alertmanager/types';\n\nimport { alertmanagerApi } from '../../api/alertmanagerApi';\nimport { computeVersionDiff } from '../../utils/diff';\nimport { stringifyErrorLike } from '../../utils/misc';\nimport { Spacer } from '../Spacer';\n\nconst VERSIONS_PAGE_SIZE = 30;\n\ninterface AlertmanagerConfigurationVersionManagerProps {\n  alertmanagerName: string;\n}\n\ntype Diff = {\n  added: number;\n  removed: number;\n};\n\ntype VersionData = {\n  id: string;\n  lastAppliedAt: string;\n  diff: Diff;\n};\n\ninterface ConfigWithDiff extends AlertManagerCortexConfig {\n  diff: Diff;\n}\n\nconst AlertmanagerConfigurationVersionManager = ({\n  alertmanagerName,\n}: AlertmanagerConfigurationVersionManagerProps) => {\n  // we'll track the ID of the version we want to restore\n  const [activeRestoreVersion, setActiveRestoreVersion] = useState<number | undefined>(undefined);\n  const [confirmRestore, setConfirmRestore] = useState(false);\n\n  // in here we'll track the configs we are comparing\n  const [activeComparison, setActiveComparison] = useState<[left: string, right: string] | undefined>(undefined);\n\n  const {\n    currentData: historicalConfigs = [],\n    isLoading,\n    error,\n  } = alertmanagerApi.endpoints.getAlertmanagerConfigurationHistory.useQuery(undefined);\n\n  const [resetAlertManagerConfigToOldVersion, restoreVersionState] =\n    alertmanagerApi.endpoints.resetAlertmanagerConfigurationToOldVersion.useMutation();\n\n  const showConfirmation = () => {\n    setConfirmRestore(true);\n  };\n\n  const hideConfirmation = () => {\n    setConfirmRestore(false);\n  };\n\n  const restoreVersion = (id: number) => {\n    setActiveComparison(undefined);\n    setActiveRestoreVersion(undefined);\n\n    resetAlertManagerConfigToOldVersion({ id });\n  };\n\n  if (error) {\n    return (\n      <Alert\n        title={t(\n          'alerting.alertmanager-configuration-version-manager.title-failed-to-load-configuration-history',\n          'Failed to load configuration history'\n        )}\n      >\n        {stringifyErrorLike(error)}\n      </Alert>\n    );\n  }\n\n  if (isLoading) {\n    return <Trans i18nKey=\"alerting.alertmanager-configuration-version-manager.loading\">Loading...</Trans>;\n  }\n\n  if (!historicalConfigs.length) {\n    return (\n      <Trans i18nKey=\"alerting.alertmanager-configuration-version-manager.no-previous-configurations\">\n        No previous configurations\n      </Trans>\n    );\n  }\n\n  // with this function we'll compute the diff with the previous version; that way the user can get some idea of how many lines where changed in each update that was applied\n  const previousVersions: ConfigWithDiff[] = historicalConfigs.map((config, index) => {\n    const latestConfig = historicalConfigs[0];\n    const priorConfig = historicalConfigs[index];\n\n    return {\n      ...config,\n      diff: priorConfig ? computeVersionDiff(config, latestConfig, normalizeConfig) : { added: 0, removed: 0 },\n    };\n  });\n\n  const rows: VersionData[] = previousVersions.map((version) => ({\n    id: String(version.id ?? 0),\n    lastAppliedAt: version.last_applied ?? 'unknown',\n    diff: version.diff,\n  }));\n\n  const columns: Array<Column<VersionData>> = [\n    {\n      id: 'lastAppliedAt',\n      header: 'Last applied',\n      cell: LastAppliedCell,\n    },\n    {\n      id: 'diff',\n      disableGrow: true,\n      cell: ({ row, value }) => {\n        const isLatestConfiguration = row.index === 0;\n        if (isLatestConfiguration) {\n          return null;\n        }\n\n        return (\n          <Stack alignItems=\"baseline\" gap={0.5}>\n            <Text color=\"success\" variant=\"bodySmall\">\n              +{value.added}\n            </Text>\n            <Text color=\"error\" variant=\"bodySmall\">\n              -{value.removed}\n            </Text>\n          </Stack>\n        );\n      },\n    },\n    {\n      id: 'actions',\n      disableGrow: true,\n      cell: ({ row }) => {\n        const isFirstItem = row.index === 0;\n        const versionID = Number(row.id);\n\n        return (\n          <Stack direction=\"row\" alignItems=\"center\" justifyContent=\"flex-end\">\n            {isFirstItem ? (\n              <Badge\n                text={t('alerting.alertmanager-configuration-version-manager.columns.text-latest', 'Latest')}\n                color=\"blue\"\n              />\n            ) : (\n              <>\n                <Button\n                  variant=\"secondary\"\n                  size=\"sm\"\n                  icon=\"code-branch\"\n                  fill=\"outline\"\n                  onClick={() => {\n                    const latestConfiguration = historicalConfigs[0];\n                    const historicalConfiguration = historicalConfigs[row.index];\n\n                    const left = normalizeConfig(latestConfiguration);\n                    const right = normalizeConfig(historicalConfiguration);\n\n                    setActiveRestoreVersion(versionID);\n                    setActiveComparison([JSON.stringify(left, null, 2), JSON.stringify(right, null, 2)]);\n                  }}\n                >\n                  <Trans i18nKey=\"alerting.alertmanager-configuration-version-manager.columns.compare\">Compare</Trans>\n                </Button>\n                <Button\n                  variant=\"secondary\"\n                  size=\"sm\"\n                  icon=\"history\"\n                  onClick={() => {\n                    setActiveRestoreVersion(versionID);\n                    showConfirmation();\n                  }}\n                  disabled={restoreVersionState.isLoading}\n                >\n                  <Trans i18nKey=\"alerting.alertmanager-configuration-version-manager.columns.restore\">Restore</Trans>\n                </Button>\n              </>\n            )}\n          </Stack>\n        );\n      },\n    },\n  ];\n\n  if (restoreVersionState.isLoading) {\n    return (\n      <Alert\n        severity=\"info\"\n        title={t(\n          'alerting.alertmanager-configuration-version-manager.title-restoring-alertmanager-configuration',\n          'Restoring Alertmanager configuration'\n        )}\n      >\n        <Trans i18nKey=\"alerting.alertmanager-configuration-version-manager.this-might-take-a-while\">\n          This might take a while...\n        </Trans>\n      </Alert>\n    );\n  }\n\n  return (\n    <>\n      {activeComparison ? (\n        <CompareVersions\n          left={activeComparison[0]}\n          right={activeComparison[1]}\n          disabled={restoreVersionState.isLoading}\n          onCancel={() => {\n            setActiveRestoreVersion(undefined);\n            setActiveComparison(undefined);\n            hideConfirmation();\n          }}\n          onConfirm={() => {\n            showConfirmation();\n          }}\n        />\n      ) : (\n        <InteractiveTable pageSize={VERSIONS_PAGE_SIZE} columns={columns} data={rows} getRowId={(row) => row.id} />\n      )}\n      {/* TODO make this modal persist while restore is in progress */}\n      <ConfirmModal\n        isOpen={confirmRestore}\n        title={t('alerting.alertmanager-configuration-version-manager.title-restore-version', 'Restore version')}\n        body={'Are you sure you want to restore the configuration to this version? All unsaved changes will be lost.'}\n        confirmText={'Yes, restore configuration'}\n        onConfirm={() => {\n          if (activeRestoreVersion) {\n            restoreVersion(activeRestoreVersion);\n          }\n\n          hideConfirmation();\n        }}\n        onDismiss={() => hideConfirmation()}\n      />\n    </>\n  );\n};\n\ninterface CompareVersionsProps {\n  left: string;\n  right: string;\n\n  disabled?: boolean;\n  onCancel: () => void;\n  onConfirm: () => void;\n}\n\nfunction CompareVersions({ left, right, disabled = false, onCancel, onConfirm }: CompareVersionsProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.drawerWrapper}>\n      <div className={styles.diffWrapper}>\n        {/*\n          we're hiding the line numbers because the historical snapshots will have certain parts of the config hidden (ex. auto-generated policies)\n          so the line numbers will not match up with what you can see in the JSON modal tab\n        */}\n        <DiffViewer newValue={left} oldValue={right} hideLineNumbers={true} />\n      </div>\n      <Stack direction=\"row\" alignItems=\"center\">\n        <Spacer />\n        <Button variant=\"secondary\" onClick={onCancel} disabled={disabled}>\n          <Trans i18nKey=\"alerting.compare-versions.return\">Return</Trans>\n        </Button>\n        <Button icon=\"history\" variant=\"primary\" onClick={onConfirm} disabled={disabled}>\n          <Trans i18nKey=\"alerting.compare-versions.restore\">Restore</Trans>\n        </Button>\n      </Stack>\n    </div>\n  );\n}\n\nconst LastAppliedCell = ({ value }: CellProps<VersionData>) => {\n  const date = moment(value);\n\n  return (\n    <Stack direction=\"row\" alignItems=\"center\">\n      {date.toLocaleString()}\n      <Text variant=\"bodySmall\" color=\"secondary\">\n        {date.fromNow()}\n      </Text>\n    </Stack>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  drawerWrapper: css({\n    maxHeight: '100%',\n    display: 'flex',\n    flexDirection: 'column',\n    gap: theme.spacing(1),\n  }),\n  diffWrapper: css({\n    overflowY: 'auto',\n  }),\n});\n\n// these props are part of the historical config response but not the current config, so we remove them for fair comparison\nfunction normalizeConfig(config: AlertManagerCortexConfig) {\n  return omit(config, ['id', 'last_applied']);\n}\n\nexport { AlertmanagerConfigurationVersionManager };\n","import { useCallback, useMemo, useState } from 'react';\n\nimport { Drawer, Tab, TabsBar } from '@grafana/ui';\nimport { t } from 'app/core/internationalization';\n\nimport { GRAFANA_RULES_SOURCE_NAME, isVanillaPrometheusAlertManagerDataSource } from '../../utils/datasource';\n\nimport AlertmanagerConfig from './AlertmanagerConfig';\nimport { useSettings } from './SettingsContext';\nimport { AlertmanagerConfigurationVersionManager } from './VersionManager';\n\ntype ActiveTab = 'configuration' | 'versions';\n\nexport function useEditConfigurationDrawer() {\n  const [activeTab, setActiveTab] = useState<ActiveTab>('configuration');\n  const [dataSourceName, setDataSourceName] = useState<string | undefined>();\n  const [open, setOpen] = useState(false);\n  const { updateAlertmanagerSettings, resetAlertmanagerSettings } = useSettings();\n\n  const isGrafanaManagedAlertmanager = dataSourceName === GRAFANA_RULES_SOURCE_NAME;\n  const immutableDataSource = dataSourceName ? isVanillaPrometheusAlertManagerDataSource(dataSourceName) : false;\n  const readOnly = immutableDataSource || isGrafanaManagedAlertmanager;\n\n  const showConfiguration = (dataSourceName: string) => {\n    setDataSourceName(dataSourceName);\n    setOpen(true);\n  };\n\n  const handleDismiss = useCallback(() => {\n    setActiveTab('configuration');\n    setOpen(false);\n  }, []);\n\n  const drawer = useMemo(() => {\n    if (!open) {\n      return null;\n    }\n\n    const isGrafanaAlertmanager = dataSourceName === GRAFANA_RULES_SOURCE_NAME;\n    const title = isGrafanaAlertmanager\n      ? t(\n          'alerting.use-edit-configuration-drawer.drawer.internal-grafana-alertmanager-title',\n          'Grafana built-in Alertmanager'\n        )\n      : dataSourceName;\n\n    const subtitle = readOnly\n      ? t(\n          'alerting.use-edit-configuration-drawer.drawer.title-view-the-alertmanager-configuration',\n          'View Alertmanager configuration'\n        )\n      : t(\n          'alerting.use-edit-configuration-drawer.drawer.title-edit-the-alertmanager-configuration',\n          'Edit Alertmanager configuration'\n        );\n\n    // @todo check copy\n    return (\n      <Drawer\n        onClose={handleDismiss}\n        title={title}\n        subtitle={subtitle}\n        tabs={\n          <TabsBar>\n            <Tab\n              label={t('alerting.use-edit-configuration-drawer.drawer.label-json-model', 'JSON Model')}\n              key=\"configuration\"\n              icon=\"arrow\"\n              active={activeTab === 'configuration'}\n              onChangeTab={() => setActiveTab('configuration')}\n            />\n            <Tab\n              label={t('alerting.use-edit-configuration-drawer.drawer.label-versions', 'Versions')}\n              key=\"versions\"\n              icon=\"history\"\n              active={activeTab === 'versions'}\n              onChangeTab={() => setActiveTab('versions')}\n              hidden={!isGrafanaAlertmanager}\n            />\n          </TabsBar>\n        }\n      >\n        {activeTab === 'configuration' && dataSourceName && (\n          <AlertmanagerConfig\n            alertmanagerName={dataSourceName}\n            onDismiss={handleDismiss}\n            onSave={updateAlertmanagerSettings}\n            onReset={resetAlertmanagerSettings}\n          />\n        )}\n        {activeTab === 'versions' && dataSourceName && (\n          <AlertmanagerConfigurationVersionManager alertmanagerName={dataSourceName} />\n        )}\n      </Drawer>\n    );\n  }, [open, dataSourceName, readOnly, handleDismiss, activeTab, updateAlertmanagerSettings, resetAlertmanagerSettings]);\n\n  return [drawer, showConfiguration, handleDismiss] as const;\n}\n","import { capitalize } from 'lodash';\n\nimport { Badge, Button, Card, Stack, Text, TextLink } from '@grafana/ui';\nimport { Trans, t } from 'app/core/internationalization';\n\nimport { ConnectionStatus } from '../../hooks/useExternalAmSelector';\nimport { ProvisioningBadge } from '../Provisioning';\nimport { WithReturnButton } from '../WithReturnButton';\n\ninterface Props {\n  name: string;\n  href?: string;\n  url?: string;\n  logo?: string;\n  provisioned?: boolean;\n  readOnly?: boolean;\n  showStatus?: boolean;\n  implementation?: string;\n  receiving?: boolean;\n  status?: ConnectionStatus;\n  // functions\n  onEditConfiguration: () => void;\n  onDisable?: () => void;\n  onEnable?: () => void;\n}\n\nexport function AlertmanagerCard({\n  name,\n  href,\n  url,\n  logo = 'public/app/plugins/datasource/alertmanager/img/logo.svg',\n  provisioned = false,\n  readOnly = provisioned,\n  showStatus = true,\n  implementation,\n  receiving = false,\n  status = 'unknown',\n  onEditConfiguration,\n  onEnable,\n  onDisable,\n}: Props) {\n  const showActions = !provisioned && Boolean(onEnable) && Boolean(onDisable);\n\n  return (\n    <Card data-testid={`alertmanager-card-${name}`}>\n      <Card.Heading>\n        <Stack alignItems=\"center\" gap={1}>\n          {href ? (\n            <WithReturnButton\n              title={t('alerting.alertmanager-card.title-alerting-settings', 'Alerting settings')}\n              component={\n                <TextLink href={href} inline={false}>\n                  {name}\n                </TextLink>\n              }\n            />\n          ) : (\n            name\n          )}\n          {provisioned && <ProvisioningBadge />}\n        </Stack>\n      </Card.Heading>\n      <Card.Figure>\n        <img alt={`logo for ${name}`} src={logo} />\n      </Card.Figure>\n\n      {/* sadly we have to resort to \"mimicking\" the Card.Description in here because \"<div>\"s can not be child elements of \"<p>\" – which is what the description element wrapper is */}\n      <Card.Meta>\n        <Stack direction=\"column\" gap={1} alignItems=\"flex-start\">\n          <Card.Meta>\n            {implementation && capitalize(implementation)}\n            {url && url}\n          </Card.Meta>\n          {/* if forwarding is diabled, still show status for the \"canonical\" Alertmanager */}\n          {showStatus ? (\n            <>\n              {!receiving ? (\n                <Text variant=\"bodySmall\">\n                  <Trans i18nKey=\"alerting.alertmanager-card.not-receiving-grafana-managed-alerts\">\n                    Not receiving Grafana managed alerts\n                  </Trans>\n                </Text>\n              ) : (\n                <>\n                  {status === 'pending' && (\n                    <Badge\n                      text={t('alerting.alertmanager-card.text-activation-in-progress', 'Activation in progress')}\n                      color=\"orange\"\n                    />\n                  )}\n                  {status === 'active' && (\n                    <Badge\n                      text={t(\n                        'alerting.alertmanager-card.text-receiving-grafanamanaged-alerts',\n                        'Receiving Grafana-managed alerts'\n                      )}\n                      color=\"green\"\n                    />\n                  )}\n                  {status === 'dropped' && (\n                    <Badge\n                      text={t(\n                        'alerting.alertmanager-card.text-failed-to-adopt-alertmanager',\n                        'Failed to adopt Alertmanager'\n                      )}\n                      color=\"red\"\n                    />\n                  )}\n                  {status === 'inconclusive' && (\n                    <Badge text={t('alerting.alertmanager-card.text-inconclusive', 'Inconclusive')} color=\"orange\" />\n                  )}\n                </>\n              )}\n            </>\n          ) : null}\n        </Stack>\n      </Card.Meta>\n\n      {/* we'll use the \"tags\" area to append buttons and actions */}\n      <Card.Tags>\n        <Stack direction=\"row\" gap={1}>\n          {/* ⚠️ provisioned Data sources cannot have their \"enable\" / \"disable\" actions but we should still allow editing of the configuration */}\n          <Button onClick={onEditConfiguration} icon={readOnly ? 'eye' : 'edit'} variant=\"secondary\" fill=\"outline\">\n            {readOnly ? (\n              <Trans i18nKey=\"alerting.alertmanager-card.view-configuration\">View configuration</Trans>\n            ) : (\n              <Trans i18nKey=\"alerting.alertmanager-card.edit-configuration\">Edit configuration</Trans>\n            )}\n          </Button>\n          {showActions ? (\n            <>\n              {receiving ? (\n                <Button icon=\"times\" variant=\"destructive\" fill=\"outline\" onClick={onDisable}>\n                  <Trans i18nKey=\"alerting.alertmanager-card.disable\">Disable</Trans>\n                </Button>\n              ) : (\n                <Button icon=\"check\" variant=\"secondary\" fill=\"outline\" onClick={onEnable}>\n                  <Trans i18nKey=\"alerting.alertmanager-card.enable\">Enable</Trans>\n                </Button>\n              )}\n            </>\n          ) : null}\n        </Stack>\n      </Card.Tags>\n    </Card>\n  );\n}\n","import { Stack } from '@grafana/ui';\nimport { DATASOURCES_ROUTES } from 'app/features/datasources/constants';\nimport { AlertmanagerChoice } from 'app/plugins/datasource/alertmanager/types';\n\nimport { ExternalAlertmanagerDataSourceWithStatus } from '../../hooks/useExternalAmSelector';\nimport {\n  isAlertmanagerDataSourceInterestedInAlerts,\n  isProvisionedDataSource,\n  isVanillaPrometheusAlertManagerDataSource,\n} from '../../utils/datasource';\nimport { createRelativeUrl } from '../../utils/url';\n\nimport { AlertmanagerCard } from './AlertmanagerCard';\nimport { useSettings } from './SettingsContext';\n\ninterface Props {\n  onEditConfiguration: (dataSourceName: string) => void;\n}\n\nexport const ExternalAlertmanagers = ({ onEditConfiguration }: Props) => {\n  const {\n    externalAlertmanagerDataSourcesWithStatus,\n    configuration,\n    enableAlertmanager,\n    disableAlertmanager,\n    forwardingDisabled,\n  } = useSettings();\n\n  // determine if the alertmanger is receiving alerts\n  // this is true if Grafana is configured to send to either \"both\" or \"external\" and the Alertmanager datasource _wants_ to receive alerts.\n  const isReceivingGrafanaAlerts = (\n    externalDataSourceAlertmanager: ExternalAlertmanagerDataSourceWithStatus\n  ): boolean => {\n    const sendingToExternal = [AlertmanagerChoice.All, AlertmanagerChoice.External].some(\n      (choice) => configuration?.alertmanagersChoice === choice\n    );\n    const wantsAlertsReceived = isAlertmanagerDataSourceInterestedInAlerts(\n      externalDataSourceAlertmanager.dataSourceSettings\n    );\n\n    return sendingToExternal && wantsAlertsReceived;\n  };\n\n  return (\n    <Stack direction=\"column\" gap={0}>\n      {externalAlertmanagerDataSourcesWithStatus.map((alertmanager) => {\n        const { uid, name, jsonData, url } = alertmanager.dataSourceSettings;\n        const { status } = alertmanager;\n\n        const isReceiving = isReceivingGrafanaAlerts(alertmanager);\n        const isProvisioned = isProvisionedDataSource(alertmanager.dataSourceSettings);\n        const isReadOnly = isVanillaPrometheusAlertManagerDataSource(alertmanager.dataSourceSettings.name);\n        // typescript on next line is wrong, as DATASOURCES_ROUTES.Edit is a RelativeUrl type, and replacing :uid with uid makes still a RelativeUrl\n        // @ts-ignore\n        const detailHref = createRelativeUrl(DATASOURCES_ROUTES.Edit.replace(/:uid/gi, uid));\n\n        const handleEditConfiguration = () => onEditConfiguration(name);\n        const handleEnable = forwardingDisabled ? undefined : () => enableAlertmanager(uid);\n        const handleDisable = forwardingDisabled ? undefined : () => disableAlertmanager(uid);\n\n        return (\n          <AlertmanagerCard\n            key={uid}\n            name={name}\n            href={detailHref}\n            url={url}\n            provisioned={isProvisioned}\n            readOnly={isReadOnly}\n            showStatus={!forwardingDisabled}\n            implementation={jsonData.implementation ?? 'Prometheus'}\n            receiving={isReceiving}\n            status={status}\n            onEditConfiguration={handleEditConfiguration}\n            onDisable={handleDisable}\n            onEnable={handleEnable}\n          />\n        );\n      })}\n    </Stack>\n  );\n};\n","import { ConnectionStatus } from '../../hooks/useExternalAmSelector';\nimport { GRAFANA_RULES_SOURCE_NAME } from '../../utils/datasource';\nimport { isInternalAlertmanagerInterestedInAlerts } from '../../utils/settings';\n\nimport { AlertmanagerCard } from './AlertmanagerCard';\nimport { useSettings } from './SettingsContext';\n\ninterface Props {\n  onEditConfiguration: (dataSourceName: string) => void;\n}\n\nconst BUILTIN_ALERTMANAGER_NAME = 'Grafana built-in';\n\nexport default function InternalAlertmanager({ onEditConfiguration }: Props) {\n  const { configuration, enableAlertmanager, disableAlertmanager, forwardingDisabled } = useSettings();\n\n  const isReceiving = isInternalAlertmanagerInterestedInAlerts(configuration);\n  const status: ConnectionStatus = isReceiving ? 'active' : 'uninterested';\n\n  const handleEditConfiguration = () => onEditConfiguration(GRAFANA_RULES_SOURCE_NAME);\n  const handleEnable = forwardingDisabled ? undefined : () => enableAlertmanager(GRAFANA_RULES_SOURCE_NAME);\n  const handleDisable = forwardingDisabled ? undefined : () => disableAlertmanager(GRAFANA_RULES_SOURCE_NAME);\n\n  return (\n    <AlertmanagerCard\n      name={BUILTIN_ALERTMANAGER_NAME}\n      logo=\"public/img/grafana_icon.svg\"\n      status={status}\n      receiving={isReceiving}\n      onEditConfiguration={handleEditConfiguration}\n      onEnable={handleEnable}\n      onDisable={handleDisable}\n      readOnly\n    />\n  );\n}\n","import { LinkButton, Stack, Text } from '@grafana/ui';\nimport { Trans, t } from 'app/core/internationalization';\n\nimport { AlertingPageWrapper } from './components/AlertingPageWrapper';\nimport { WithReturnButton } from './components/WithReturnButton';\nimport { useEditConfigurationDrawer } from './components/settings/ConfigurationDrawer';\nimport { ExternalAlertmanagers } from './components/settings/ExternalAlertmanagers';\nimport InternalAlertmanager from './components/settings/InternalAlertmanager';\nimport { SettingsProvider, useSettings } from './components/settings/SettingsContext';\nimport { withPageErrorBoundary } from './withPageErrorBoundary';\n\nfunction SettingsPage() {\n  return (\n    <SettingsProvider>\n      <SettingsContent />\n    </SettingsProvider>\n  );\n}\n\nfunction SettingsContent() {\n  const [configurationDrawer, showConfiguration] = useEditConfigurationDrawer();\n  const { isLoading } = useSettings();\n\n  return (\n    <AlertingPageWrapper\n      navId=\"alerting-admin\"\n      isLoading={isLoading}\n      actions={[\n        <WithReturnButton\n          key=\"add-alertmanager\"\n          title={t('alerting.settings-content.title-alerting-settings', 'Alerting settings')}\n          component={\n            <LinkButton href=\"/connections/datasources/alertmanager\" icon=\"plus\" variant=\"primary\">\n              <Trans i18nKey=\"alerting.settings-content.add-new-alertmanager\">Add new Alertmanager</Trans>\n            </LinkButton>\n          }\n        />,\n      ]}\n    >\n      <Stack direction=\"column\" gap={2}>\n        {/* Grafana built-in Alertmanager */}\n        <Text variant=\"h5\">\n          <Trans i18nKey=\"alerting.settings-content.builtin-alertmanager\">Built-in Alertmanager</Trans>\n        </Text>\n        <InternalAlertmanager onEditConfiguration={showConfiguration} />\n        {/* other (external Alertmanager data sources we have added to Grafana such as vanilla, Mimir, Cortex) */}\n        <Text variant=\"h5\">\n          <Trans i18nKey=\"alerting.settings-content.other-alertmanagers\">Other Alertmanagers</Trans>\n        </Text>\n        <ExternalAlertmanagers onEditConfiguration={showConfiguration} />\n      </Stack>\n      {configurationDrawer}\n    </AlertingPageWrapper>\n  );\n}\n\nexport default withPageErrorBoundary(SettingsPage);\n","import { SerializedError } from '@reduxjs/toolkit';\n\nimport { alertmanagerApi } from '../api/alertmanagerApi';\n\ntype Options = {\n  refetchOnFocus: boolean;\n  refetchOnReconnect: boolean;\n};\n\n// TODO refactor this so we can just call \"alertmanagerApi.endpoints.getAlertmanagerConfiguration\" everywhere\n// and remove this hook since it adds little value\nexport function useAlertmanagerConfig(amSourceName?: string, options?: Options) {\n  const fetchConfig = alertmanagerApi.endpoints.getAlertmanagerConfiguration.useQuery(amSourceName ?? '', {\n    // we'll disable cache by default to prevent overwriting other changes made since last fetch\n    refetchOnMountOrArgChange: true,\n    ...options,\n    skip: !amSourceName,\n  });\n\n  return {\n    ...fetchConfig,\n    // TODO refactor to get rid of this type assertion\n    error: fetchConfig.error as SerializedError,\n  };\n}\n"],"names":["AlertmanagerConfig","alertmanagerName","onDismiss","onSave","onReset","isDeleting","deletingError","useUnifiedAlertingSelector","state","isSaving","savingError","showResetConfirmation","setShowResetConfirmation","isGrafanaManagedAlertmanager","readOnly","styles","getStyles","config","loadingError","isLoadingSuccessful","isLoadingConfig","useAlertmanagerConfig","defaultValues","register","setValue","setError","handleSubmit","errors","value","e","handleSave","values","isOperating","Alert","confirmationText","height","width","CodeEditor","Stack","Button","Spacer","ConfirmModal","theme","dataSourcesApi","alertingApi","build","result","uid","_result","_error","settings","args","useExternalDataSourceAlertmanagers","refetchOnMountOrArgChange","alertmanagerDataSources","externalAlertmanagers","alertmanagerApi","dataSourceSettings","status","determineAlertmanagerConnectionStatus","isActive","am","isAlertmanagerMatchByURL","isDropped","MIMIR_ALERTMANAGER_PATH","VANILLA_ALERTMANAGER_PATH","dataSourceUrl","alertmanagerUrl","normalizedUrl","normalizeDataSourceURL","prometheusAlertmanagerMatch","mimirAlertmanagerMatch","url","isInternalAlertmanagerInterestedInAlerts","useEnableOrDisableHandlingGrafanaManagedAlerts","getSettings","getSettingsState","updateSettings","updateSettingsState","enableOrDisable","handleGrafanaManagedAlerts","existingSettings","newSettings","draft","enable","disable","loadingState","SettingsContext","isInternalAlertmanager","SettingsProvider","props","interestedAlertmanagers","forwardingDisabled","configuration","isLoadingConfiguration","updateConfiguration","updateConfigurationState","enableGrafanaManagedAlerts","disableGrafanaManagedAlerts","enableOrDisableHandlingGrafanaManagedAlertsState","externalAlertmanagersWithStatus","dataSource","alertmanager","enableAlertmanager","updatedInterestedAlertmanagers","newDeliveryMode","determineDeliveryMode","disableAlertmanager","updateAlertmanagerSettings","alertManagerName","oldConfig","newConfig","resetAlertmanagerSettings","containsInternalAlertmanager","containsExternalAlertmanager","useSettings","context","debouncedUpdateStatus","refetchAlertmanagerConnectionStatus","VERSIONS_PAGE_SIZE","AlertmanagerConfigurationVersionManager","activeRestoreVersion","setActiveRestoreVersion","confirmRestore","setConfirmRestore","activeComparison","setActiveComparison","historicalConfigs","isLoading","error","resetAlertManagerConfigToOldVersion","restoreVersionState","showConfirmation","hideConfirmation","restoreVersion","id","rows","index","latestConfig","priorConfig","normalizeConfig","version","columns","LastAppliedCell","row","Text","isFirstItem","versionID","Badge","latestConfiguration","historicalConfiguration","left","right","CompareVersions","InteractiveTable","disabled","onCancel","onConfirm","DiffViewer","date","useEditConfigurationDrawer","activeTab","setActiveTab","dataSourceName","setDataSourceName","open","setOpen","showConfiguration","handleDismiss","isGrafanaAlertmanager","title","subtitle","Drawer","TabsBar","Tab","AlertmanagerCard","name","href","logo","provisioned","showStatus","implementation","receiving","onEditConfiguration","onEnable","onDisable","showActions","Card","WithReturnButton","TextLink","Provisioning","ExternalAlertmanagers","externalAlertmanagerDataSourcesWithStatus","isReceivingGrafanaAlerts","externalDataSourceAlertmanager","sendingToExternal","choice","wantsAlertsReceived","jsonData","isReceiving","isProvisioned","isReadOnly","detailHref","handleEditConfiguration","handleEnable","handleDisable","BUILTIN_ALERTMANAGER_NAME","InternalAlertmanager","SettingsPage","SettingsContent","configurationDrawer","AlertingPageWrapper","withPageErrorBoundary","amSourceName","options","fetchConfig"],"sourceRoot":""}