"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6088],{97976:(Ot,ot,s)=>{s.d(ot,{L:()=>Ee});var d=s(74848),P=s(96540),it=s(71468),U=s(87390),rt=s(89224),k=s(94701);function I({children:e,width:t,height:i,onLoad:n,onChange:a}){const o=(0,P.useId)(),[r,l]=(0,P.useState)(!1),[c,u]=(0,P.useState)(!1),f=(0,P.useRef)(null);return(0,k.A)(()=>{I.addCallback(o,D=>{!r&&D.isIntersecting&&(l(!0),n?.()),u(D.isIntersecting),a?.(D.isIntersecting)});const C=f.current;return C&&I.observer.observe(C),()=>{delete I.callbacks[o],C&&I.observer.unobserve(C),Object.keys(I.callbacks).length===0&&I.observer.disconnect()}}),(0,d.jsx)("div",{id:o,ref:f,style:{width:t,height:i},children:r&&(typeof e=="function"?e({isInView:c}):e)})}const lt={};I.callbacks=lt,I.addCallback=(e,t)=>I.callbacks[e]=t,I.observer=new IntersectionObserver(e=>{for(const t of e)I.callbacks[t.target.id]&&I.callbacks[t.target.id](t)},{rootMargin:"100px"});var dt=s(2543),$=s(64423),X=s(84229),j=s(1906),H=s(57852),Z=s(25229),ct=s(48480),N=s(28105),Y=s(22592),q=s(41119),ht=s(75234),_=s(64400),W=s(67522),ut=s(36303),gt=s(45229),x=s(65642),pt=s(1505),A=s(17097),ft=s(28998),mt=s(48421),vt=s(22747),tt=s(57866),z=s(64394);const et=(e,t,i)=>{const{overrides:n}=i,a=i.overrides.findIndex(u=>u.matcher.id===tt.Ct.byName&&u.matcher.options===e);if(a<0)return{...i,overrides:[...i.overrides,Ct(e,t)]};const o=Array.from(n),r=o[a],l=r.properties.findIndex(u=>u.id==="color");if(l<0)return o[a]={...r,properties:[...r.properties,Q(t)]},{...i,overrides:o};const c=Array.from(r.properties);return c[l]=Q(t),o[a]={...r,properties:c},{...i,overrides:o}},Ct=(e,t)=>({matcher:{id:tt.Ct.byName,options:e},properties:[Q(t)]}),Q=e=>({id:"color",value:{mode:z.Y.Fixed,fixedColor:e}});var w=s(8535),Et=s(87745),m=s(78767),p=s(32380),S=s(75421),v=s(67458),T=s(2863),h=s(36490),L=s(23289),M=s(26689),K=s(302),G=s(22803),B=s(76190),yt=s(63142),nt=s(45967),F=s(30703),At=s(91867),J=s(87063),Rt=s(88559),Ft=s(7895),y=s(56840);function bt({panelLinks:e,onShowPanelLinks:t}){const i=(0,yt.of)(Lt),n=()=>{const a=t();return(0,d.jsx)(J.W,{children:a?.map((o,r)=>(0,d.jsx)(J.W.Item,{label:o.title,url:o.href,target:o.target,onClick:o.onClick},r))})};if(e.length===1){const a=t()[0];return(0,d.jsx)(W.NR.TitleItem,{href:a.href,onClick:a.onClick,target:a.target,title:a.title,children:(0,d.jsx)(F.I,{name:"external-link-alt",size:"md"})})}else return(0,d.jsx)(Rt.m,{overlay:n,children:(0,d.jsx)(Ft.I,{icon:"external-link-alt",iconSize:"md","aria-label":(0,y.t)("dashboard.panel-links.aria-label-panel-links","Panel links"),className:i.menuTrigger})})}const Lt=e=>({menuTrigger:(0,G.css)({height:"100%",background:"inherit",border:"none",borderRadius:`${e.shape.radius.default}`,cursor:"context-menu"})});var Mt=s(46429);function Vt(e){const{alertState:t,data:i,panelId:n,onShowPanelLinks:a,panelLinks:o}=e,r=(0,yt.of)(Ut),l=(0,d.jsx)(nt.m,{content:t??"unknown",children:(0,d.jsx)(W.NR.TitleItem,{className:(0,G.cx)({[r.ok]:t===B.O.OK,[r.pending]:t===B.O.Pending||t===B.O.Recovering,[r.alerting]:t===B.O.Alerting}),children:(0,d.jsx)(F.I,{name:t==="alerting"?"heart-break":"heart",size:"md"})})}),c=(0,d.jsx)(d.Fragment,{children:i.request&&i.request.timeInfo&&(0,d.jsx)(nt.m,{content:(0,d.jsx)(At.xS,{timeRange:i.request?.range,timeZone:i.request?.timezone}),children:(0,d.jsxs)(W.NR.TitleItem,{className:r.timeshift,children:[(0,d.jsx)(F.I,{name:"clock-nine",size:"md"})," ",i.request?.timeInfo]})})});return(0,d.jsxs)(d.Fragment,{children:[o&&o.length>0&&a&&(0,d.jsx)(bt,{onShowPanelLinks:a,panelLinks:o}),(0,d.jsx)(Mt.Z,{panelId:n,frames:i.series}),c,t&&l]})}const Ut=e=>({ok:(0,G.css)({color:e.colors.success.text,"&:hover":{color:e.colors.emphasize(e.colors.success.text,.03)}}),pending:(0,G.css)({color:e.colors.warning.text,"&:hover":{color:e.colors.emphasize(e.colors.warning.text,.03)}}),alerting:(0,G.css)({color:e.colors.error.text,"&:hover":{color:e.colors.emphasize(e.colors.error.text,.03)}}),timeshift:(0,G.css)({color:e.colors.text.link,gap:e.spacing(.5),whiteSpace:"nowrap","&:hover":{color:e.colors.emphasize(e.colors.text.link,.03)}}),angularNotice:(0,G.css)({color:e.colors.warning.text})});function jt(e){function t(){return e.data.request&&e.data.request.timeInfo?!1:!e.panel.hasTitle()}const i=()=>{const E=(0,T.w)().replace(e.panel.description,e.panel.scopedVars);return(0,v.G)(E)},n=()=>{const E=(0,K.E7)(e.panel);if(!E)return[];const b=E&&E.getLinks(e.panel.replaceVariables);return b.map(st=>({...st,onClick:(...at)=>{L.c.panelLinkClicked({has_multiple_links:b.length>1}),st.onClick?.(...at)}}))},a=(E,b)=>{E.stopPropagation(),h.Ny.partial({inspect:e.panel.id,inspectTab:b})},o=E=>{E.stopPropagation(),h.Ny.partial({inspect:e.panel.id,inspectTab:M.q.Error}),L.c.panelStatusMessageClicked()},r=()=>{e.panel.getQueryRunner().cancelQuery(),L.c.panelCancelQueryClicked({data_state:e.data.state})},l=e.plugin.noPadding?"none":"md",c=e.data.alertState?.state,f=(e.panel.links&&e.panel.links.length>0&&n||e.data.series.length>0&&e.data.series.some(E=>(E.meta?.notices?.length??0)>0)||e.data.request&&e.data.request.timeInfo||c)&&(0,d.jsx)(Vt,{alertState:c,data:e.data,panelId:e.panel.id,panelLinks:e.panel.links,onShowPanelLinks:n}),C=e.panel.description?i:void 0,D=!(e.isViewing||e.isEditing)&&(e.isDraggable??!0)?"grid-drag-handle":"",R=e.panel.getDisplayTitle();return{hasOverlayHeader:t,onShowPanelDescription:i,onShowPanelLinks:n,onOpenInspector:a,onOpenErrorInspect:o,onCancelQuery:r,padding:l,description:C,dragClass:D,title:R,titleItems:f}}var Gt=s(27359),Ht=s(60519),Wt=s(18030);function zt(e,t){const i=(0,q.Bt)(e.snapshotData),n=new Wt.F,a={dashboard:t,range:(0,Y.E2)()},o=n.canWork(a)?n.getAnnotationsInSnapshot(t,e.id):[],r=[(0,Gt.I)(o)];return{timeRange:(0,A.nk)(e,(0,S.jG)().timeRange()).timeRange,state:N.Gu.Done,series:(0,Ht.we)({data:i,fieldConfig:{defaults:{},overrides:[]},replaceVariables:e.replaceVariables,fieldConfigRegistry:e.plugin.fieldConfigRegistry,theme:x.$W.theme2,timeZone:t.getTimezone()}),structureRev:1,annotations:r}}var Bt=s(85629);function Qt({items:e}){const t=i=>i.map(n=>{switch(n.type){case"divider":return(0,d.jsx)(J.W.Divider,{},n.text);case"group":return(0,d.jsx)(J.W.Group,{label:n.text,children:n.subMenu?t(n.subMenu):void 0},n.text);default:return(0,d.jsx)(J.W.Item,{label:n.text,icon:n.iconClassName,childItems:n.subMenu?t(n.subMenu):void 0,url:n.href,onClick:n.onClick,shortcut:n.shortcut,testId:Bt.Tp.components.Panels.Panel.menuItems(n.text)},n.text)}});return(0,d.jsx)(J.W,{children:t(e)})}var Jt=s(54092),kt=s(60188),wt=s(46907),Kt=s(5556),$t=s(64762),Xt=s(12066),xt=s(15130),Zt=s(47797),Yt=s(62635),qt=s(20437),_t=s(75515),te=s(31439),ee=s(9931),ne=s(54),se=s(35231);function ae(e,t,i){const n=g=>{g.preventDefault(),h.Ny.partial({viewPanel:t.id})},a=g=>{g.preventDefault(),h.Ny.partial({editPanel:t.id})},o=g=>{g.preventDefault(),(0,A.Mc)(e,t)},r=g=>{g.preventDefault(),(0,A.d7)(e,t)},l=g=>{g.preventDefault(),(0,A.ZY)(t)},c=g=>{h.Ny.partial({inspect:t.id,inspectTab:g})},u=g=>{g.preventDefault(),(0,A.iU)(e,t)},f=g=>{g.preventDefault(),(0,A.KJ)(t)},C=g=>{g.preventDefault(),(0,A.FC)(e,t,!0)},D=g=>{g.preventDefault();const Dt=g.ctrlKey||g.metaKey?It=>window.open(It):void 0;w.M_.dispatch((0,se.ow)(t,{timeRange:(0,S.jG)().timeRange(),getExploreUrl:Yt.Xe,openInNewWindow:Dt}))},R=g=>{g.preventDefault(),(0,A.ET)(t)},E=[];t.isEditing||E.push({text:(0,y.t)("panel.header-menu.view","View"),iconClassName:"eye",onClick:n,shortcut:"v"}),e.canEditPanel(t)&&!t.isEditing&&E.push({text:(0,y.t)("panel.header-menu.edit","Edit"),iconClassName:"edit",onClick:a,shortcut:"e"}),E.push({text:(0,y.t)("panel.header-menu.share","Share"),iconClassName:"share-alt",onClick:o,shortcut:"p s"}),xt.TP.hasAccessToExplore()&&!(t.plugin&&t.plugin.meta.skipDataQuery)&&t.datasource?.uid!==ee.K&&E.push({text:(0,y.t)("panel.header-menu.explore","Explore"),iconClassName:"compass",onClick:D,shortcut:"p x"});const b=[];t.plugin&&!t.plugin.meta.skipDataQuery&&(b.push({text:(0,y.t)("panel.header-menu.inspect-data","Data"),onClick:g=>c(M.q.Data)}),e.meta.canEdit&&b.push({text:(0,y.t)("panel.header-menu.query","Query"),onClick:g=>c(M.q.Query)})),b.push({text:(0,y.t)("panel.header-menu.inspect-json","Panel JSON"),onClick:g=>c(M.q.JSON)}),E.push({type:"submenu",text:(0,y.t)("panel.header-menu.inspect","Inspect"),iconClassName:"info-circle",shortcut:"i",subMenu:b});const st=async()=>{let g;try{g=await(0,qt.mp)(t,e)}catch(It){const ye=`Error getting rule values from the panel: ${(0,Zt.q6)(It)}`;(0,w.JD)((0,Xt.dx)((0,$t.gi)(ye)));return}const Dt=Kt.kM.renderUrl("/alerting/new",{defaults:JSON.stringify(g),returnTo:location.pathname+location.search});h.Ny.push(Dt)},at=g=>{g.preventDefault(),st()},O=[],Pt=e.canEditPanel(t),Tt=(0,ne.q0)();return t.isViewing||t.isEditing||(Pt?(O.push({text:(0,y.t)("panel.header-menu.duplicate","Duplicate"),onClick:u,shortcut:"p d"}),O.push({text:(0,y.t)("panel.header-menu.copy","Copy"),onClick:f}),(0,_t.X)(t)?O.push({text:(0,y.t)("panel.header-menu.unlink-library-panel","Unlink library panel"),onClick:l}):O.push({text:(0,y.t)("panel.header-menu.create-library-panel","Create library panel"),onClick:r})):xt.TP.isEditor&&O.push({text:(0,y.t)("panel.header-menu.copy","Copy"),onClick:f})),Tt&&O.push({text:(0,y.t)("panel.header-menu.new-alert-rule","New alert rule"),onClick:at}),t.options.legend&&O.push({text:t.options.legend.showLegend?(0,y.t)("panel.header-menu.hide-legend","Hide legend"):(0,y.t)("panel.header-menu.show-legend","Show legend"),onClick:R,shortcut:"p l"}),t.isEditing&&(O.length=0,Tt&&O.push({text:(0,y.t)("panel.header-menu.new-alert-rule","New alert rule"),onClick:at})),Pt&&t.plugin&&!t.plugin.meta.skipDataQuery&&O.push({text:(0,y.t)("panel.header-menu.get-help","Get help"),onClick:g=>c(M.q.Help)}),i.length>0&&!t.isEditing&&E.push({text:"Extensions",iconClassName:"plug",type:"submenu",subMenu:(0,te.N9)(i)}),O.length&&E.push({type:"submenu",text:(0,y.t)("panel.header-menu.more","More..."),iconClassName:"cube",subMenu:O}),e.canEditPanel(t)&&!t.isEditing&&!t.isViewing&&(E.push({type:"divider",text:""}),E.push({text:(0,y.t)("panel.header-menu.remove","Remove"),iconClassName:"trash-alt",onClick:C,shortcut:"p r"})),E}function oe({panel:e,dashboard:t,loadingState:i,children:n}){const[a,o]=(0,P.useState)([]),r=(0,P.useMemo)(()=>ie(e,t),[e,t]),{links:l}=(0,wt.U)({extensionPointId:Jt.S.DashboardPanelMenu,context:r,limitPerPlugin:3});return(0,P.useEffect)(()=>{o(ae(t,e,l))},[t,e,i,o,l]),n({items:a})}function ie(e,t){return{id:e.id,pluginId:e.type,title:e.title,timeRange:t.time,timeZone:(0,kt.O)({timeZone:t.timezone}),dashboard:{uid:t.uid,title:t.title,tags:Array.from(t.tags)},targets:e.targets,scopedVars:e.scopedVars,data:e.getQueryRunner().getLastResult()}}function re({style:e,panel:t,dashboard:i,loadingState:n}){return(0,d.jsx)(oe,{panel:t,dashboard:i,loadingState:n,children:({items:a})=>(0,d.jsx)(Qt,{style:e,items:a})})}var Nt=s(32631),V=(e=>(e.FIELD_CONFIG_OVERRIDES_CHANGED_EVENT="field config overrides changed",e.NEW_PANEL_OPTION_EVENT="new panel option",e.PANEL_OPTION_CHANGED_EVENT="panel option changed",e.NEW_DEFAULT_FIELD_CONFIG_EVENT="new default field config",e.DEFAULT_FIELD_CONFIG_CHANGED_EVENT="default field config changed",e.NEW_CUSTOM_FIELD_CONFIG_EVENT="new custom field config",e.CUSTOM_FIELD_CONFIG_CHANGED_EVENT="custom field config changed",e.MEASURE_PANEL_LOAD_TIME_EVENT="measure panel load time",e.THRESHOLDS_COUNT_CHANGED_EVENT="thresholds count changed",e.THRESHOLDS_MODE_CHANGED_EVENT="thresholds mode changed",e.MAPPINGS_COUNT_CHANGED_EVENT="mappings count changed",e.LINKS_COUNT_CHANGED_EVENT="links count changed",e.PANEL_ERROR="panel error",e))(V||{});const le="overrides",de="custom",ce=e=>{const t=performance.now();return(0,P.useEffect)(()=>{x.$W.grafanaJavascriptAgent.enabled&&requestAnimationFrame(()=>{setTimeout(()=>{Nt.P.api.pushMeasurement({type:V.MEASURE_PANEL_LOAD_TIME_EVENT,values:{start_loading_time_ms:t,load_time_ms:performance.now()-t}},{context:{panel_type:e.panelType,panel_id:String(e.panelId),panel_title:e.panelTitle}})},0)})},[]),null};var he=s(78013),St=s(4405);class ue{constructor(t,i,n){this.logChanges=(a,o)=>{this.logPanelOptionChanges(a,this.initialPanelOptions),this.logFieldConfigChanges(o,this.initialFieldConfig),this.initialPanelOptions=a,this.initialFieldConfig=o},this.logPanelEvent=(a,o,r,l)=>{if(!x.$W.grafanaJavascriptAgent.enabled)return;const c={key:o,newValue:r,oldValue:l??"",panelTitle:this.panelLogInfo.panelTitle,panelId:this.panelLogInfo.panelId,panelType:this.panelLogInfo.panelType};Nt.P.api.pushEvent(a,c)},this.logPanelOptionChanges=(a,o)=>{if(typeof a!="object"||a===null||typeof o!="object"||o===null)return;const r={...o};for(const[l,c]of Object.entries(a)){const u=typeof c!="string"?JSON.stringify(c):c,f=typeof c!="string"?JSON.stringify(r[l]):String(r[l]);r[l]===void 0?this.logPanelEvent(V.NEW_PANEL_OPTION_EVENT,l,u):f!==u&&this.logPanelEvent(V.PANEL_OPTION_CHANGED_EVENT,l,u,f)}},this.logFieldConfigChanges=(a,o)=>{const r=JSON.stringify(o.overrides),l=JSON.stringify(a.overrides);r!==l&&this.logPanelEvent(V.FIELD_CONFIG_OVERRIDES_CHANGED_EVENT,le,l,r);const c={...o.defaults};for(const[f,C]of Object.entries(a.defaults)){if(f===de)continue;const D=typeof C!="string"?JSON.stringify(C):C,R=typeof C!="string"?JSON.stringify(c[f]):String(c[f]);c[f]===void 0?this.logPanelEvent(V.NEW_DEFAULT_FIELD_CONFIG_EVENT,f,D):R!==D&&this.logPanelEvent(V.DEFAULT_FIELD_CONFIG_CHANGED_EVENT,f,D,R)}if(!a.defaults.custom||c.custom===void 0)return;const u={...c.custom};for(const[f,C]of Object.entries(a.defaults.custom)){if(c.custom===null||u[f]===null)continue;const D=typeof C!="string"?JSON.stringify(C):C,R=typeof C!="string"?JSON.stringify(u[f]):String(u[f]);u[f]===void 0?this.logPanelEvent(V.NEW_CUSTOM_FIELD_CONFIG_EVENT,f,D):R!==D&&this.logPanelEvent(V.CUSTOM_FIELD_CONFIG_CHANGED_EVENT,f,D,R)}},this.initialPanelOptions=t,this.initialFieldConfig=i,this.panelLogInfo=n}}const ge="Error in plugin";class pe extends P.PureComponent{constructor(t){super(t),this.timeSrv=(0,S.jG)(),this.subs=new $.yU,this.eventFilter={onlyLocal:!0},this.panelOptionsLogger=void 0,this.getSync=()=>this.props.isEditing?X.y.Off:this.props.dashboard.graphTooltip,this.onInstanceStateChange=n=>{this.props.onInstanceStateChange(n),this.setState({context:{...this.state.context,instanceState:n}})},this.onUpdateData=n=>(0,vt.H)(this.props.panel,n),this.onSeriesColorChange=(n,a)=>{this.onFieldConfigChange(et(n,a,this.props.panel.fieldConfig))},this.onSeriesVisibilityChange=(n,a)=>{this.onFieldConfigChange((0,he.M)(n,a,this.props.panel.fieldConfig,this.state.data.series))},this.onToggleLegendSort=n=>{const a=this.props.panel.options.legend;if(!a)return;let o=a.sortDesc,r=a.sortBy;n!==r&&(o=void 0),o===!1?(r=void 0,o=void 0):(o=!o,r=n),this.onOptionsChange({...this.props.panel.options,legend:{...a,sortBy:r,sortDesc:o}})},this.onRefresh=()=>{const{dashboard:n,panel:a,isInView:o,width:r}=this.props;if(!n.snapshot&&!o){a.refreshWhenInView=!0;return}const l=(0,A.nk)(a,this.timeSrv.timeRange());if(this.wantsQueryExecution){if(r<0)return;a.refreshWhenInView=!1,a.runAllPanelQueries({dashboardUID:n.uid,dashboardTimezone:n.getTimezone(),timeData:l,width:r})}else this.setState({data:{...this.state.data,timeRange:this.timeSrv.timeRange()},renderCounter:this.state.renderCounter+1,liveTime:void 0})},this.onRender=()=>{const n={renderCounter:this.state.renderCounter+1};this.setState(n)},this.onOptionsChange=n=>{this.props.panel.updateOptions(n)},this.onFieldConfigChange=n=>{this.props.panel.updateFieldConfig(n)},this.onPanelError=n=>{x.Ay.featureToggles.panelMonitoring&&this.getPanelContextApp()===j.Jk.PanelEditor&&this.logPanelChangesOnError();const a=n.message||ge;this.state.errorMessage!==a&&this.setState({errorMessage:a})},this.onPanelErrorRecover=()=>{this.setState({errorMessage:void 0})},this.onAnnotationCreate=async n=>{const a=n.from!==n.to,o={dashboardUID:this.props.dashboard.uid,panelId:this.props.panel.id,isRegion:a,time:n.from,timeEnd:a?n.to:0,tags:n.tags,text:n.description};await(0,m.vJ)(o),(0,p.Dh)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new H.We(o))},this.onAnnotationDelete=async n=>{await(0,m.Xm)({id:n}),(0,p.Dh)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new H.We({id:n}))},this.onAnnotationUpdate=async n=>{const a=n.from!==n.to,o={id:n.id,dashboardUID:this.props.dashboard.uid,panelId:this.props.panel.id,isRegion:a,time:n.from,timeEnd:a?n.to:0,tags:n.tags,text:n.description};await(0,m.rJ)(o),(0,p.Dh)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new H.We(o))},this.onChangeTimeRange=n=>{this.timeSrv.setTime({from:(0,Z.yT)(n.from),to:(0,Z.yT)(n.to)})},this.onAddAdHocFilter=n=>{const{key:a,value:o,operator:r}=n,l=(0,ft.tR)().getInstanceSettings(this.props.panel.datasource),c=l&&(0,ct.p$)(l);c&&(0,w.JD)((0,mt.z_)({datasource:c,key:a,operator:r,value:o}))};const i=t.dashboard.events.newScopedBus(`panel:${t.panel.id}`,this.eventFilter);if(this.debouncedSetPanelAttention=(0,dt.debounce)(this.setPanelAttention.bind(this),100),this.state={isFirstLoad:!0,renderCounter:0,context:{eventsScope:"__global_",eventBus:i,app:this.getPanelContextApp(),sync:this.getSync,onSeriesColorChange:this.onSeriesColorChange,onToggleSeriesVisibility:this.onSeriesVisibilityChange,onAnnotationCreate:this.onAnnotationCreate,onAnnotationUpdate:this.onAnnotationUpdate,onAnnotationDelete:this.onAnnotationDelete,onInstanceStateChange:this.onInstanceStateChange,onToggleLegendSort:this.onToggleLegendSort,canAddAnnotations:t.dashboard.canAddAnnotations.bind(t.dashboard),canEditAnnotations:t.dashboard.canEditAnnotations.bind(t.dashboard),canDeleteAnnotations:t.dashboard.canDeleteAnnotations.bind(t.dashboard),onAddAdHocFilter:this.onAddAdHocFilter,onUpdateData:this.onUpdateData},data:this.getInitialPanelDataState()},x.Ay.featureToggles.panelMonitoring&&this.getPanelContextApp()===j.Jk.PanelEditor){const n={panelId:String(t.panel.id),panelType:t.panel.type,panelTitle:t.panel.title};this.panelOptionsLogger=new ue(t.panel.getOptions(),t.panel.fieldConfig,n)}}getPanelContextApp(){return this.props.isEditing?j.Jk.PanelEditor:this.props.isViewing?j.Jk.PanelViewer:j.Jk.Dashboard}getInitialPanelDataState(){return{state:N.Gu.NotStarted,series:[],timeRange:(0,Y.E2)()}}componentDidMount(){const{panel:t,dashboard:i}=this.props;if(this.subs.add(t.events.subscribe(ht._,this.onRefresh)),this.subs.add(t.events.subscribe(Et.XM,this.onRender)),i.panelInitialized(this.props.panel),this.hasPanelSnapshot){this.setState({data:zt(t,i),isFirstLoad:!1});return}this.wantsQueryExecution||this.setState({isFirstLoad:!1}),this.subs.add(t.getQueryRunner().getData({withTransforms:!0,withFieldConfig:!0}).subscribe({next:n=>this.onDataUpdate(n)})),St.a.listen(this)}componentWillUnmount(){this.subs.unsubscribe(),St.a.remove(this)}liveTimeChanged(t){const{data:i}=this.state;if(i.timeRange){const n=t.to.valueOf()-i.timeRange.to.valueOf();if(n<100){console.log("Skip tick render",this.props.panel.title,n);return}}this.setState({liveTime:t})}componentDidUpdate(t){const{isInView:i,width:n,panel:a}=this.props,{context:o}=this.state,r=this.getPanelContextApp();o.app!==r&&this.setState({context:{...o,app:r}}),i!==t.isInView&&i&&a.refreshWhenInView&&this.onRefresh(),n!==t.width&&St.a.updateInterval(this)}onDataUpdate(t){const{dashboard:i,panel:n,plugin:a}=this.props;if(a.meta.skipDataQuery){this.setState({data:this.getInitialPanelDataState()});return}let{isFirstLoad:o}=this.state,r;switch(t.state){case N.Gu.Loading:if(this.state.data.state===N.Gu.Loading)return;break;case N.Gu.Error:const{error:l,errors:c}=t;c?.length?c.length===1?r=c[0].message:r="Multiple errors found. Click for more details":l&&r!==l.message&&(r=l.message);break;case N.Gu.Done:i.snapshot&&(n.snapshotData=t.series.map(u=>(0,q.Kl)(u))),o&&(o=!1);break}this.setState({isFirstLoad:o,errorMessage:r,data:t,liveTime:void 0})}logPanelChangesOnError(){this.panelOptionsLogger.logChanges(this.props.panel.getOptions(),this.props.panel.fieldConfig)}get hasPanelSnapshot(){const{panel:t}=this.props;return t.snapshotData&&t.snapshotData.length}get wantsQueryExecution(){return!(this.props.plugin.meta.skipDataQuery||this.hasPanelSnapshot)}shouldSignalRenderingCompleted(t,i){return t===N.Gu.Done||t===N.Gu.Streaming||t===N.Gu.Error||i.skipDataQuery}skipFirstRender(t){const{isFirstLoad:i}=this.state;return this.wantsQueryExecution&&i&&(t===N.Gu.Loading||t===N.Gu.NotStarted)}renderPanelContent(t,i){const{panel:n,plugin:a,dashboard:o}=this.props,{renderCounter:r,data:l}=this.state,{state:c}=l;if(this.skipFirstRender(c))return null;this.shouldSignalRenderingCompleted(c,a.meta)&&pt.E.renderingCompleted();const u=a.panel,f=this.state.liveTime??l.timeRange??this.timeSrv.timeRange(),C=n.getOptions();return this.eventFilter.onlyLocal=o.graphTooltip===0,(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(_.XF,{value:this.state.context,children:[(0,d.jsx)(u,{id:n.id,data:l,title:n.title,timeRange:f,timeZone:this.props.dashboard.getTimezone(),options:C,fieldConfig:n.fieldConfig,transparent:n.transparent,width:t,height:i,renderCounter:r,replaceVariables:n.replaceVariables,onOptionsChange:this.onOptionsChange,onFieldConfigChange:this.onFieldConfigChange,onChangeTimeRange:this.onChangeTimeRange,eventBus:o.events}),x.Ay.featureToggles.panelMonitoring&&this.state.errorMessage===void 0&&(0,d.jsx)(ce,{panelType:a.meta.id,panelId:n.id,panelTitle:n.title})]})})}setPanelAttention(){gt.A.publish(new H.Tp({panelId:this.props.panel.id}))}debouncedSetPanelAttention(){}render(){const{dashboard:t,panel:i,width:n,height:a,plugin:o}=this.props,{errorMessage:r,data:l}=this.state,{transparent:c}=i,u=jt({...this.props,data:l}),f=(i.gridPos?.y??0)===0?-16:void 0,C=(0,d.jsx)("div",{"data-testid":"panel-dropdown",children:(0,d.jsx)(re,{panel:i,dashboard:t,loadingState:l.state})});return(0,d.jsx)(W.NR,{width:n,height:a,title:u.title,loadingState:l.state,statusMessage:r,statusMessageOnClick:u.onOpenErrorInspect,description:u.description,titleItems:u.titleItems,menu:this.props.hideMenu?void 0:C,dragClass:u.dragClass,dragClassCancel:"grid-drag-cancel",padding:u.padding,hoverHeaderOffset:f,hoverHeader:u.hasOverlayHeader(),displayMode:c?"transparent":"default",onCancelQuery:u.onCancelQuery,onFocus:()=>this.setPanelAttention(),onMouseEnter:()=>this.setPanelAttention(),onMouseMove:()=>this.debouncedSetPanelAttention(),children:(D,R)=>(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(ut.tH,{dependencies:[l,o,i.getOptions()],onError:this.onPanelError,onRecover:this.onPanelErrorRecover,children:({error:E})=>E?null:this.renderPanelContent(D,R)})})})}}const fe=(e,t)=>{const i=e.panels[t.stateKey];return i?{plugin:i.plugin,instanceState:i.instanceState}:{plugin:void 0}},me={initPanelState:U.Ap,setPanelInstanceState:rt.nF},ve=(0,it.connect)(fe,me);class Ce extends P.PureComponent{constructor(){super(...arguments),this.onInstanceStateChange=t=>{this.props.setPanelInstanceState({key:this.props.stateKey,value:t})},this.onVisibilityChange=t=>{this.props.panel.isInView=t},this.onPanelLoad=()=>{this.props.plugin||this.props.initPanelState(this.props.panel)},this.renderPanel=({isInView:t})=>{const{dashboard:i,panel:n,isViewing:a,isEditing:o,width:r,height:l,plugin:c,timezone:u,hideMenu:f,isDraggable:C=!0}=this.props;return c?(0,d.jsx)(pe,{plugin:c,panel:n,dashboard:i,isViewing:a,isEditing:o,isInView:t,isDraggable:C,width:r,height:l,onInstanceStateChange:this.onInstanceStateChange,timezone:u,hideMenu:f}):null}}static{this.defaultProps={lazy:!0}}componentDidMount(){this.props.panel.isInView=!this.props.lazy,this.props.lazy||this.onPanelLoad()}render(){const{width:t,height:i,lazy:n}=this.props;return n?(0,d.jsx)(I,{width:t,height:i,onChange:this.onVisibilityChange,onLoad:this.onPanelLoad,children:this.renderPanel}):this.renderPanel({isInView:!0})}}const Ee=ve(Ce)},27081:(Ot,ot,s)=>{s.d(ot,{v:()=>w});var d=s(92138),P=s(25229),it=s(57852),U=s(36490),rt=s(68143),k=s(43173),I=s(6890),lt=s(45229),dt=s(64762),$=s(83873),X=s(29043),j=s(60017),H=s(48600),Z=s(22429),ct=s(75421),N=s(41644),Y=s(84019),q=s(66198),ht=s(17621);function _(m){return async p=>{const S=await $.IB.getFolderByUid(m);return p((0,ht.jl)(S)),p((0,I.Vz)((0,q.R4)(S))),S}}var W=s(79718),ut=s(4590),gt=s(99305),x=s(96673),pt=s(32380),A=s(39167),ft=s(93612),mt=s(95710),vt=s(7817),tt=s(83127),z=s(37918);const et="initDashboard";async function Ct(m,p,S){try{switch(m.routeName){case x.DashboardRoutes.Home:{const T=(0,N.sP)("v1").getDashboardFromCache(N.m6);if(T)return T;const h=await $.IB.get("/api/dashboards/home");if((0,x.isRedirectResponse)(h)){const L=d.I.stripBaseFromUrl(h.redirectUri);return U.Ny.replace(L),null}return h.meta.canSave=!1,h.meta.canShare=!1,h.meta.canStar=!1,h}case x.DashboardRoutes.Public:return await H.np.loadDashboard("public",m.urlSlug,m.accessToken);case x.DashboardRoutes.Normal:{const v=await H.np.loadDashboard(m.urlType,m.urlSlug,m.urlUid);if(v.meta.folderUid)try{await p(_(v.meta.folderUid))}catch(T){console.warn("Error fetching parent folder",v.meta.folderUid,"for dashboard",T)}if(m.fixUrl&&v.meta.url&&!ut._o.state.isPlaying){const T=d.I.stripBaseFromUrl(v.meta.url),h=U.Ny.getLocation().pathname;T!==h&&(U.Ny.replace({...U.Ny.getLocation(),pathname:T}),console.log("not correct url correcting",T,h))}return v}case x.DashboardRoutes.New:return m.urlFolderUid&&await p(_(m.urlFolderUid)),await(0,Y.X)(m.urlFolderUid);default:throw{message:"Unknown route "+m.routeName}}}catch(v){return(0,rt.NF)(v)&&v.cancelled||(p((0,z.ig)({message:"Failed to fetch dashboard",error:v})),console.error(v)),null}}const Q=(m,p={})=>(m.forEach(S=>{S.panels?Q(S.panels,p):S.targets&&S.targets.forEach(v=>{v.datasource?.type&&(p[v.datasource.type]?p[v.datasource.type].push(v):p[v.datasource.type]=[v])})}),p);function w(m){return async(p,S)=>{(0,j.j)(et),p((0,z.xS)());const v=await Ct(m,p,S),T=v?.dashboard?.version;if(!v)return;Et(v),p((0,z.X1)());let h;try{h=new vt.G(v.dashboard,v.meta)}catch(F){p((0,z.ig)({message:"Failed create dashboard model",error:F})),console.error(F);return}const L=S(),M=U.Ny.getSearchObject();M.orgId||U.Ny.partial({orgId:L.user.orgId},!0);const K=(0,ct.jG)();(0,Z.UA)().setCurrent(h),K.init(h);const B=(0,gt.q4)(m.urlUid??h.uid);if(await p((0,A._q)(B,h)),(0,pt.nm)({dashboard:h,timeSrv:K}).run({dashboard:h,range:K.timeRange()}),(0,ft.Tk)(S())!==B||S().dashboard.initPhase!==x.DashboardInitPhase.Services)return;try{h.processRepeats(),M.autofitpanels&&h.autoFitPanels(window.innerHeight,M.kiosk),k.$.publicDashboardAccessToken||m.keybindingSrv.setupDashboardBindings(h)}catch(F){F instanceof Error&&p((0,I.dx)((0,dt.gi)("Dashboard init failed",F))),console.error(F)}m.routeName!==x.DashboardRoutes.New?((0,tt.B)(h),W.t.watch(h.uid)):W.t.leave(),h.weekStart!==""&&h.weekStart!==void 0?(0,P.$D)(h.weekStart):(0,P.$D)(k.$.bootData.user.weekStart),lt.A.publish(new it.gc({dashboardId:h.uid,orgId:L.user.orgId,userId:L.user.user?.id,grafanaVersion:k.$.buildInfo.version,queries:Q(h.panels)}));const nt=(0,j.z)(et);(0,mt.dM)(h,nt?.duration,T),p((0,z.O9)(h))}}function Et(m){const p=X.A.getObject(x.DASHBOARD_FROM_LS_KEY);p&&(p.dashboard.panels&&(m.dashboard.panels=p.dashboard.panels.concat(m.dashboard.panels)),p.dashboard.time&&(m.dashboard.time=p.dashboard.time),X.A.delete(x.DASHBOARD_FROM_LS_KEY))}}}]);

//# sourceMappingURL=6088.e65c1bd3ff230d2b250b.js.map