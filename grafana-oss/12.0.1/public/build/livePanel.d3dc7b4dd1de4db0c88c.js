"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5413],{73163:(w,B,t)=>{t.d(B,{X:()=>N,k:()=>i});var v=t(60519),s=t(32899),g=t(95004),P=t(63704),f=t(68143),b=t(73427),A=t(86967),D=t(92367);const i=(m,E,x,T,e,l)=>!e||e.length===0?[]:e.map(p=>{const u=(0,v.vd)(m,E,x),c={...x,__dataContext:u},S=(U,j,y)=>T(U,{...c,...j},y);l.valueRowIndex!==void 0&&!isNaN(l.valueRowIndex)?u.value.rowIndex=l.valueRowIndex:u.value.calculatedValue=l.calculatedValue;const R=T(p.title,c),h=T(p.confirmation||`Are you sure you want to ${p.title}?`,c);return{title:R,confirmation:h,onClick:(U,j)=>{F(p,S)},oneClick:p.oneClick??!1}}).filter(p=>!!p),F=(m,E)=>{try{const x=new URL(_(E(m.fetch.url))),T={};let e={url:x.toString(),method:m.fetch.method,data:J(m,E),headers:T};m.fetch.headers&&m.fetch.headers.forEach(([l,d])=>{T[E(l)]=E(d)}),m.fetch.queryParams&&(m.fetch.queryParams?.forEach(([l,d])=>{x.searchParams.append(E(l),E(d))}),e.url=x.toString()),T["X-Grafana-Action"]="1",e.headers=T,(0,f.AI)().fetch(e).subscribe({error:l=>{b.lE.emit(s.r1.alertError,["An error has occurred. Check console output for more details."]),console.error(l)},complete:()=>{b.lE.emit(s.r1.alertSuccess,["API call was successful"])}})}catch(x){b.lE.emit(s.r1.alertError,["An error has occurred. Check console output for more details."]),console.error(x);return}},N=(m=[],E=[])=>({name:"Default field",type:g.PU.string,config:{links:m,actions:E},values:[]}),_=m=>{if(m.startsWith("/")){const x=P.sQ.sanitizeUrl(m);m=(0,D.z)(x,[])}return m},J=(m,E)=>{let x=m.fetch.body?E(m.fetch.body):"{}";return m.fetch.method===A.DO.GET&&(x=void 0),x}},11205:(w,B,t)=>{t.d(B,{l:()=>g});var v=t(77154),s=t(68143);async function g(){return(0,s.AI)().get("api/live/list").then(P=>{const f=P.channels??[],b={},A=f.map(D=>{if(D.data){const i=new Set,F=(0,v.or)(D.data);for(const N of F.fields)i.add(N.name);b[D.channel]=Array.from(i).map(N=>({value:N,label:N}))}return{value:D.channel,label:D.channel+" ["+D.minute_rate+" msg/min]"}});return{channelFields:b,channels:A}})}},86967:(w,B,t)=>{t.d(B,{DO:()=>P,en:()=>v,gR:()=>s,xp:()=>g});var v=(i=>(i.Center="center",i.Left="left",i.LeftRight="leftright",i.Right="right",i.Scale="scale",i))(v||{}),s=(i=>(i.Bottom="bottom",i.Center="center",i.Scale="scale",i.Top="top",i.TopBottom="topbottom",i))(s||{}),g=(i=>(i.Contain="contain",i.Cover="cover",i.Fill="fill",i.Original="original",i.Tile="tile",i))(g||{}),P=(i=>(i.GET="GET",i.POST="POST",i.PUT="PUT",i))(P||{}),f=(i=>(i.Straight="straight",i))(f||{});const b={vertices:[]},A={connections:[]},D={infinitePan:!0,inlineEditing:!0,panZoom:!0,showAdvancedTypes:!0}},8149:(w,B,t)=>{t.r(B),t.d(B,{plugin:()=>Y});var v=t(16207),s=t(74848),g=t(22803),P=t(96540),f=t(38619),b=t(34999),A=t(72636),D=t(18857),i=t(43243),F=t(65240),N=t(65642),_=t(75505),J=t(81160),m=t(68143);async function E(){return await(0,_.s)((0,m.AI)().fetch({method:"GET",url:"/apis",headers:{Accept:"application/json;g=apidiscovery.k8s.io;v=v2;as=APIGroupDiscoveryList,application/json;g=apidiscovery.k8s.io;v=v2beta1;as=APIGroupDiscoveryList,application/json"}}).pipe((0,J.T)(o=>{for(let a of o.data.items)for(let n of a.versions)for(let r of n.resources)if(r.responseKind.group=a.metadata.name,r.responseKind.version=n.version,r.subresources)for(let C of r.subresources)C.responseKind.group=a.metadata.name,C.responseKind.version=n.version;return o.data})))}function x(o){const a=[];for(let n of o.items)for(let r of n.versions)for(let C of r.resources)a.push(C);return a}var T=t(11205);const e=[{label:"Grafana",value:f.qD.Grafana,description:"Core grafana live features"},{label:"Data Sources",value:f.qD.DataSource,description:"Data sources with live support"},{label:"Plugins",value:f.qD.Plugin,description:"Plugins with live support"},{label:"Stream",value:f.qD.Stream,description:"data streams (eg, influx style)"},{label:"Watch",value:f.qD.Watch,description:"Watch k8s style resources"}];function l(o){const[a,n]=(0,P.useState)([]),[r,C]=(0,P.useMemo)(()=>{const O=[],W=[],K=o.value.scope,ne=o.value.namespace;if(!K?.length)return[O,W];const ae={};for(let oe of a){const G=(0,f.DG)(oe.value);!G||G.scope!==K||(ae[G.namespace]||(O.push({value:G.namespace,label:G.namespace}),ae[G.namespace]=!0),ne?.length&&ne===G.namespace&&W.push({...oe,value:G.path}))}return[O,W]},[a,o.value.scope,o.value.namespace]);(0,P.useEffect)(()=>{(0,T.l)().then(O=>{n(O.channels)})},[o.value.scope]);const $=O=>{O.value&&o.onChange({scope:O.value,namespace:void 0,path:void 0})},V=O=>{o.onChange({scope:o.value?.scope,namespace:O?.value,path:void 0})},se=O=>{const{value:W,onChange:K}=o;K({scope:W.scope,namespace:W.namespace,path:O?.value})},Z=async O=>{const W=await E();return x(W).filter(K=>K.verbs.includes("watch")).map(K=>({value:`${K.responseKind.group}/${K.responseKind.version}/${K.resource}`,resource:K}))},{scope:k,namespace:z,path:re}=o.value,q=p(N.$W.theme2);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.F,{title:"Grafana Live",severity:"info",children:"This supports real-time event streams in grafana core. This feature is under heavy development. Expect the intefaces and structures to change as this becomes more production ready."}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:q.dropWrap,children:[(0,s.jsx)(A.J,{children:"Scope"}),(0,s.jsx)(D.l6,{options:e,value:e.find(O=>O.value===k),onChange:$})]}),k===f.qD.Watch&&(0,s.jsx)("div",{className:q.dropWrap,children:(0,s.jsx)(i.G,{options:Z,placeholder:"Select watchable resource",onChange:O=>{const W=O.resource;W&&o.onChange({scope:f.qD.Watch,namespace:W.responseKind.group,path:`${W.responseKind.version}/${W.resource}/${N.$W.bootData.user.uid}`})}})}),k&&(0,s.jsxs)("div",{className:q.dropWrap,children:[(0,s.jsx)(A.J,{children:"Namespace"}),(0,s.jsx)(D.l6,{options:r,value:r.find(O=>O.value===z)??(z?{label:z,value:z}:void 0),onChange:V,allowCustomValue:!0,backspaceRemovesValue:!0,isClearable:!0})]}),k&&z&&(0,s.jsxs)("div",{className:q.dropWrap,children:[(0,s.jsx)(A.J,{children:"Path"}),(0,s.jsx)(D.l6,{options:C,value:d(C,re),onChange:se,allowCustomValue:!0,backspaceRemovesValue:!0,isClearable:!0})]})]})]})}function d(o,a){const n=o.find(r=>r.value===a);if(n)return n;if(a)return{label:a,value:a}}const p=(0,F.N)(o=>({dropWrap:(0,g.css)({marginBottom:o.spacing(1)})}));var u=t(2543),c=t(51388),S=t(60519),R=t(28105),h=t(43173),L=t(33184),U=t(50275),j=t(52718),y=t(25205),H=t(50992),X=t(45861),I=(o=>(o.Raw="raw",o.JSON="json",o.Auto="auto",o.None="none",o))(I||{}),M=(o=>(o.None="none",o.JSON="json",o.Influx="influx",o))(M||{});function ee({height:o,mode:a,body:n,addr:r,onSave:C}){const $=(0,P.useMemo)(()=>a===M.JSON?n?JSON.stringify(n,null,2):"{ }":n==null?"":`${n}`,[a,n]),V=Z=>{a===M.JSON?C(JSON.parse(Z)):C(Z)},se=async()=>{if(a===M.Influx){if(r?.scope!=="stream"){alert("expected stream scope!");return}return(0,m.AI)().post(`api/live/push/${r.namespace}`,n)}if(!(0,f.aj)(r)){alert("invalid address");return}const Z=await(0,L.oF)().publish(r,n);console.log("onPublishClicked (response from publish)",Z)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(H.B,{height:o-32,language:a===M.JSON?"json":"text",value:$,onBlur:V,onSave:V,showMiniMap:!1,showLineNumbers:!0}),(0,s.jsx)("div",{style:{height:32},children:(0,s.jsx)(X.$n,{onClick:se,children:"Publish"})})]})}class Q extends P.PureComponent{constructor(a){super(a),this.styles=te(h.$.theme2),this.streamObserver={next:n=>{(0,f.ew)(n)?this.setState({status:n,changed:Date.now()}):(0,f.Z7)(n)?this.setState({message:n.message,changed:Date.now()}):console.log("ignore",n)}},this.unsubscribe=()=>{this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0)},this.isValid=!!(0,L.oF)(),this.state={changed:0}}async componentDidMount(){this.loadChannel()}componentWillUnmount(){this.subscription&&this.subscription.unsubscribe()}componentDidUpdate(a){this.props.options?.channel!==a.options?.channel&&this.loadChannel()}async loadChannel(){const a=this.props.options?.channel;if(!(0,f.aj)(a)){console.log("INVALID",a),this.unsubscribe(),this.setState({addr:void 0});return}if((0,u.isEqual)(a,this.state.addr)){console.log("Same channel",this.state.addr);return}const n=(0,L.oF)();if(!n){console.log("INVALID",a),this.unsubscribe(),this.setState({addr:void 0});return}this.unsubscribe(),console.log("LOAD",a);try{this.subscription=n.getStream(a).subscribe(this.streamObserver),this.setState({addr:a,error:void 0})}catch(r){this.setState({addr:void 0,error:r})}}renderNotEnabled(){return(0,s.jsxs)(b.F,{title:"Grafana Live",severity:"info",children:[(0,s.jsx)("p",{children:"Grafana live requires a feature flag to run"}),(0,s.jsx)("b",{children:"custom.ini:"}),(0,s.jsx)("pre",{children:`[feature_toggles]
    enable = live`})]})}renderMessage(a){const{options:n}=this.props,{message:r}=this.state;if(!r)return(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{children:"Waiting for data:"}),n.channel?.scope,"/",n.channel?.namespace,"/",n.channel?.path]});if(n.display===I.JSON)return(0,s.jsx)(U.B,{json:r,open:5});if(n.display===I.Auto&&r instanceof c.k9){const C={series:(0,S.we)({data:[r],theme:h.$.theme2,replaceVariables:V=>V,fieldConfig:{defaults:{},overrides:[]}}),state:R.Gu.Streaming},$={...this.props,options:{frameIndex:0,showHeader:!0}};return(0,s.jsx)(y.L,{...$,data:C,height:a})}return(0,s.jsx)("pre",{children:JSON.stringify(r)})}renderPublish(a){const{options:n}=this.props;return(0,s.jsx)(ee,{height:a,body:n.message,mode:n.publish??M.JSON,onSave:r=>this.props.onOptionsChange({...n,message:r}),addr:this.state.addr})}renderStatus(){const{status:a}=this.state;if(a?.state===f.ZF.Connected)return;let n="";return a&&(n=this.styles.status[a.state]),(0,s.jsx)("div",{className:(0,g.cx)(n,this.styles.statusWrap),children:a?.state})}renderBody(){const{status:a}=this.state,{options:n,height:r}=this.props;if(n.publish===M.JSON||n.publish===M.Influx){if(n.display===I.None)return this.renderPublish(r);const $=r/2;return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{height:$,overflow:"hidden"},children:(0,s.jsx)(j.E,{autoHeightMin:"100%",autoHeightMax:"100%",children:this.renderMessage($)})}),(0,s.jsx)("div",{children:this.renderPublish($)})]})}return n.display===I.None?(0,s.jsx)("pre",{children:JSON.stringify(a)}):(0,s.jsx)("div",{style:{overflow:"hidden",height:r},children:(0,s.jsx)(j.E,{autoHeightMin:"100%",autoHeightMax:"100%",children:this.renderMessage(r)})})}render(){if(!this.isValid)return this.renderNotEnabled();const{addr:a,error:n}=this.state;return a?n?(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{children:"ERROR"}),(0,s.jsx)("div",{children:JSON.stringify(n)})]}):(0,s.jsxs)(s.Fragment,{children:[this.renderStatus(),this.renderBody()]}):(0,s.jsx)(b.F,{title:"Grafana Live",severity:"info",children:"Use the panel editor to pick a channel"})}}const te=(0,F.N)(o=>({statusWrap:(0,g.css)({margin:"auto",position:"absolute",top:0,right:0,background:o.components.panel.background,padding:"10px",zIndex:o.zIndex.modal}),status:{[f.ZF.Pending]:(0,g.css)({border:`1px solid ${o.v1.palette.orange}`}),[f.ZF.Connected]:(0,g.css)({border:`1px solid ${o.colors.success.main}`}),[f.ZF.Connecting]:(0,g.css)({border:`1px solid ${o.v1.palette.brandWarning}`}),[f.ZF.Disconnected]:(0,g.css)({border:`1px solid ${o.colors.warning.main}`}),[f.ZF.Shutdown]:(0,g.css)({border:`1px solid ${o.colors.error.main}`}),[f.ZF.Invalid]:(0,g.css)({border:"1px solid red"})}})),Y=new v.m(Q).setPanelOptions(o=>{o.addCustomEditor({category:["Channel"],id:"channel",path:"channel",name:"Channel",editor:l,defaultValue:{}}),o.addRadio({path:"display",name:"Show message",description:"Display the last message received on this channel",settings:{options:[{value:I.Raw,label:"Raw Text"},{value:I.JSON,label:"JSON"},{value:I.Auto,label:"Auto"},{value:I.None,label:"None"}]},defaultValue:I.JSON}).addRadio({path:"publish",name:"Publish",description:"Display a form to publish values",settings:{options:[{value:M.None,label:"None"},{value:M.JSON,label:"JSON"},{value:M.Influx,label:"Influx"}]},defaultValue:M.None})})},25205:(w,B,t)=>{t.d(B,{L:()=>m});var v=t(74848),s=t(22803),g=t(84229),P=t(16515),f=t(57866),b=t(14477),A=t(43173),D=t(63142),i=t(64400),F=t(24343),N=t(18857),_=t(73163),J=t(32776);function m(u){const{data:c,height:S,width:R,options:h,fieldConfig:L,id:U,timeRange:j,replaceVariables:y}=u,H=(0,D.$j)(),X=(0,i.d2)(),I=(0,J.gy)(c.series)?(0,J.S5)(c.series):c.series,M=I?.length,ee=I.some(r=>r.fields.length>0),Q=E(I,h),te=I[Q];let Y=S;if(!M||!ee)return(0,v.jsx)(b.a,{panelId:U,fieldConfig:L,data:c});if(M>1){const r=H.spacing.gridSize*H.components.height.md,C=H.spacing.gridSize;Y=S-r-C}const o=X.sync&&X.sync()!==g.y.Off,a=(0,v.jsx)(F.X,{height:Y,width:R,data:te,noHeader:!h.showHeader,showTypeIcons:h.showTypeIcons,resizable:!0,initialSortBy:h.sortBy,onSortByChange:r=>T(r,u),onColumnResize:(r,C)=>x(r,C,u),onCellFilterAdded:X.onAddAdHocFilter,footerOptions:h.footer,enablePagination:h.footer?.enablePagination,cellHeight:h.cellHeight,timeRange:j,enableSharedCrosshair:A.$.featureToggles.tableSharedCrosshair&&o,fieldConfig:L,getActions:d,replaceVariables:y});if(M===1)return a;const n=I.map((r,C)=>({label:(0,P.Ri)(r),value:C}));return(0,v.jsxs)("div",{className:p.wrapper,children:[a,(0,v.jsx)("div",{className:p.selectWrapper,children:(0,v.jsx)(N.l6,{options:n,value:n[Q],onChange:r=>e(r,u)})})]})}function E(u,c){return c.frameIndex>0&&c.frameIndex<u.length?c.frameIndex:0}function x(u,c,S){const{fieldConfig:R}=S,{overrides:h}=R,L=f.Ct.byName,U="custom.width",j=h.find(y=>y.matcher.id===L&&y.matcher.options===u);if(j){const y=j.properties.find(H=>H.id===U);y?y.value=c:j.properties.push({id:U,value:c})}else h.push({matcher:{id:L,options:u},properties:[{id:U,value:c}]});S.onFieldConfigChange({...R,overrides:h})}function T(u,c){c.onOptionsChange({...c.options,sortBy:u})}function e(u,c){c.onOptionsChange({...c.options,frameIndex:u.value||0})}const l=u=>u,d=(u,c,S,R)=>{const h=[],L=new Set;return(0,_.k)(u,c,c.state.scopedVars,R??l,c.config.actions??[],{valueRowIndex:S}).forEach(j=>{const y=`${j.title}`;L.has(y)||(h.push(j),L.add(y))}),h},p={wrapper:(0,s.css)({display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"}),selectWrapper:(0,s.css)({padding:"8px 8px 0px 8px"})}},32776:(w,B,t)=>{t.d(B,{S5:()=>x,fq:()=>b,gy:()=>T,l1:()=>m});var v=t(2543),s=t.n(v),g=t(57866),P=t(33553),f=t(95004);const b=e=>(!e.pluginVersion&&"columns"in e&&console.log("Was angular table",e),e.options),A={timeseries_to_rows:"seriesToRows",timeseries_to_columns:"seriesToColumns",timeseries_aggregations:"reduce",table:"merge"},D={avg:"mean",min:"min",max:"max",total:"sum",current:"lastNotNull",count:"count"},i={cell:"color-background",row:"color-background",value:"color-text"},F=(e,l)=>[-1/0,...e].map((d,p)=>({color:l[p],value:(0,v.isNumber)(d)?d:parseInt(d,10)})),N=(e,l)=>{const d=e.transformations??[];if(Object.keys(A).includes(l.transform)){const p={reducers:[]};l.transform==="timeseries_aggregations"&&(p.includeTimeField=!1,p.reducers=l.columns.map(u=>D[u.value])),d.push({id:A[l.transform],options:p})}return d},_=e=>{const d={matcher:{id:/^\/.*\/$/.test(e.pattern)?g.Ct.byRegexp:g.Ct.byName,options:e.pattern},properties:[]};return e.alias&&d.properties.push({id:"displayName",value:e.alias}),e.unit&&d.properties.push({id:"unit",value:e.unit}),e.decimals&&d.properties.push({id:"decimals",value:e.decimals}),e.type==="date"&&d.properties.push({id:"unit",value:`time: ${e.dateFormat}`}),e.type==="hidden"&&d.properties.push({id:"custom.hidden",value:!0}),e.link&&d.properties.push({id:"links",value:[{title:(0,v.defaultTo)(e.linkTooltip,""),url:(0,v.defaultTo)(e.linkUrl,""),targetBlank:(0,v.defaultTo)(e.linkTargetBlank,!1)}]}),e.colorMode&&d.properties.push({id:"custom.cellOptions",value:{type:i[e.colorMode]}}),e.align&&d.properties.push({id:"custom.align",value:e.align==="auto"?null:e.align}),e.thresholds?.length&&d.properties.push({id:"thresholds",value:{mode:P.O.Absolute,steps:F(e.thresholds,e.colors)}}),d},J=e=>{let l={custom:{}};if(e){if(l=(0,v.omitBy)({unit:e.unit,decimals:e.decimals,displayName:e.alias,custom:{align:e.align==="auto"?null:e.align}},v.isNil),e.thresholds.length){const d={mode:P.O.Absolute,steps:F(e.thresholds,e.colors)};l.thresholds=d}e.colorMode&&(l.custom.cellOptions={type:i[e.colorMode]})}return l},m=(e,l,d)=>{if(l==="table-old"&&d.angular){const p=d.angular,u=N(e,p),c=p.styles.find(h=>h.pattern==="/.*/"),S=J(c),R=p.styles.filter(h=>h.pattern!=="/.*/").map(_);e.transformations=u,e.fieldConfig={defaults:S,overrides:R}}return{}},E=e=>e?.filter(l=>l.meta?.custom?.parentRowIndex===void 0)||[e?.[0]],x=e=>{const l=[];return E(e).filter(p=>!!p&&p.length!==0)?.forEach(p=>{const u=e?.filter(h=>p.refId===h.refId&&h.meta?.custom?.parentRowIndex!==void 0),c=(0,v.groupBy)(u,h=>h.meta?.custom?.parentRowIndex),S=Object.keys(c).map(h=>c[h]),R={...p};u&&u.length>0&&R.fields.push({name:"nested",type:f.PU.nestedFrames,config:{},values:S}),l.push(R)}),l},T=e=>e?.some(l=>l.meta?.custom?.parentRowIndex!==void 0)}}]);

//# sourceMappingURL=livePanel.d3dc7b4dd1de4db0c88c.js.map