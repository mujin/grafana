"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1668],{24898:(O,D,t)=>{t.d(D,{_:()=>y});var e=t(74848),c=t(2543),u=t.n(c),f=t(16692);const y=({actions:h,children:p})=>{const E=(0,c.filter)(h,C),A=(0,c.filter)(h,N);return E.length?(0,e.jsx)(R,{actions:E,children:p}):A.length?(0,e.jsx)(L,{actions:A,children:p}):null},R=({actions:h,children:p})=>{const E=(0,f.iI)();return S(E,h)?(0,e.jsx)(e.Fragment,{children:p}):null},L=({actions:h,children:p})=>{const E=(0,f.e2)();return S(E,h)?(0,e.jsx)(e.Fragment,{children:p}):null};function S(h,p){return(0,c.chain)(h).pick(p).values().value().some(([E,A])=>A===!0)}function C(h){return Object.values(f.QI).includes(h)}function N(h){return Object.values(f.RY).includes(h)}},12266:(O,D,t)=>{t.d(D,{e:()=>u});var e=t(74848),c=t(45861);const u=({isCollapsed:f,onToggle:y,idControlled:R,className:L,text:S,size:C="xl",...N})=>(0,e.jsx)(c.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!f,"aria-controls":R,className:L,icon:f?"angle-right":"angle-down",onClick:()=>y(!f),...N,children:S})},46627:(O,D,t)=>{t.r(D),t.d(D,{default:()=>Fe});var e=t(74848),c=t(22803),u=t(96540),f=t(33239),y=t(63142),R=t(6975),L=t(34999),S=t(41654),C=t(45861),N=t(74475),h=t(30703),p=t(3271),E=t(20941),A=t(70958),a=t(56840),$=t(62421),X=t(55143),Q=t(95443),B=t(52161),M=t(84266),k=t(91984),z=t(16692),q=t(5358),W=t(63895),I=t(77256),_=t(88547),ee=t(36826),te=t(24898),se=t(6106),ne=t(58750),le=t(37658),re=t(86017);const ae=({matchers:s})=>{const i=(0,y.of)(ie);return(0,e.jsx)("div",{children:(0,e.jsx)(le.L,{className:i.tags,tags:s.map(l=>`${l.name}${(0,re.MN)(l)}${l.value}`)})})},ie=()=>({tags:(0,c.css)({justifyContent:"flex-start"})});var ce=t(50201),oe=t(43951),de=t(15130),ue=t(54);const xe=({alertManagerSourceName:s})=>{const i=(0,ue.jy)(s);return de.TP.hasPermission(i.create)?(0,e.jsx)(ce.p,{variant:"call-to-action",button:(0,e.jsx)(C.z9,{href:(0,I.nL)("alerting/silence/new",s),icon:"bell-slash",size:"lg",children:(0,e.jsx)(a.x6,{i18nKey:"silences.empty-state.button-title",children:"Create silence"})}),message:(0,a.t)("silences.empty-state.title","You haven't created any silences yet")}):(0,e.jsx)(oe.c,{callToActionElement:(0,e.jsx)("div",{}),message:"No silences found."})};var Y=t(74529),ge=t(27911),he=t(7840),me=t(12266),fe=t(83903);const je=({alert:s,className:i})=>{const[l,o]=(0,u.useState)(!0),r=(0,Y.dU)({start:new Date(s.startsAt),end:new Date(s.endsAt)}),x=Object.entries(s.labels).reduce((d,[g,n])=>((g==="alertname"||g==="__alert_rule_title__")&&(d=n),d),"");return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("tr",{className:i,children:[(0,e.jsx)("td",{children:(0,e.jsx)(me.e,{isCollapsed:l,onToggle:d=>o(d)})}),(0,e.jsx)("td",{children:(0,e.jsx)(fe.y,{state:s.status.state})}),(0,e.jsxs)("td",{children:["for ",r]}),(0,e.jsx)("td",{children:x})]}),!l&&(0,e.jsxs)("tr",{className:i,children:[(0,e.jsx)("td",{}),(0,e.jsx)("td",{colSpan:5,children:(0,e.jsx)(he.m,{labels:s.labels,size:"sm"})})]})]})},ve=({silencedAlerts:s})=>{const i=(0,y.of)(ge.L),l=(0,y.of)(ye);return s.length?(0,e.jsxs)("table",{className:(0,c.cx)(i.table,l.tableMargin),children:[(0,e.jsxs)("colgroup",{children:[(0,e.jsx)("col",{className:i.colExpand}),(0,e.jsx)("col",{className:l.colState}),(0,e.jsx)("col",{}),(0,e.jsx)("col",{className:l.colName})]}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"silences-table.header.state",children:"State"})}),(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:(0,e.jsx)(a.x6,{i18nKey:"silences-table.header.alert-name",children:"Alert name"})})]})}),(0,e.jsx)("tbody",{children:s.map((o,r)=>(0,e.jsx)(je,{alert:o,className:r%2===0?i.evenRow:""},o.fingerprint))})]}):null},ye=s=>({tableMargin:(0,c.css)({marginBottom:s.spacing(1)}),colState:(0,c.css)({width:"110px"}),colName:(0,c.css)({width:"65%"})}),pe=ve,Ae=({silence:s})=>{const{startsAt:i,endsAt:l,comment:o,createdBy:r,silencedAlerts:x}=s,d=(0,y.of)(Se),g="YYYY-MM-DD HH:mm",n=f.parse(i),m=f.parse(l),j=(0,Y.dU)({start:new Date(i),end:new Date(l)});return(0,e.jsxs)("div",{className:d.container,children:[(0,e.jsx)("div",{className:d.title,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.silence-details.comment",children:"Comment"})}),(0,e.jsx)("div",{children:o}),(0,e.jsx)("div",{className:d.title,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.silence-details.schedule",children:"Schedule"})}),(0,e.jsx)("div",{children:`${n?.format(g)} - ${m?.format(g)}`}),(0,e.jsx)("div",{className:d.title,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.silence-details.duration",children:"Duration"})}),(0,e.jsx)("div",{children:j}),(0,e.jsx)("div",{className:d.title,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.silence-details.created-by",children:"Created by"})}),(0,e.jsx)("div",{children:r}),Array.isArray(x)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:d.title,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.silence-details.affected-alerts",children:"Affected alerts"})}),(0,e.jsx)(pe,{silencedAlerts:x})]})]})},Se=s=>({container:(0,c.css)({display:"grid",gridTemplateColumns:"1fr 9fr",gridRowGap:"1rem",paddingBottom:s.spacing(2)}),title:(0,c.css)({color:s.colors.text.primary}),row:(0,c.css)({margin:s.spacing(1,0)})});var Ce=t(67834);const Ee={[M.RC.Active]:"good",[M.RC.Expired]:"neutral",[M.RC.Pending]:"neutral"},Ie=({state:s})=>(0,e.jsx)(Ce.O,{state:Ee[s],children:s});var H=t(2543),De=t(37386),Te=t(72636),be=t(45967),Me=t(63527);const G=()=>(0,H.uniqueId)("query-string-"),Pe=()=>{const[s,i]=(0,u.useState)(G()),[l,o]=(0,A.s)(),{queryString:r}=(0,I.qy)(l),x=(0,y.of)(Le),d=(0,H.debounce)(m=>{const j=m.target;o({queryString:j.value||null})},400),g=()=>{o({queryString:null,silenceState:null}),setTimeout(()=>i(G()))};let n=r&&r.length>3;try{r?(0,W.S6)(r):n=!0}catch{n=!1}return(0,e.jsxs)("div",{className:x.flexRow,children:[(0,e.jsx)(De.D,{className:x.rowChild,label:(0,e.jsx)(Te.J,{children:(0,e.jsxs)(S.B,{gap:.5,children:[(0,e.jsx)(a.x6,{i18nKey:"alerting.common.search-by-matchers",children:"Search by matchers"}),(0,e.jsx)(be.m,{content:(0,e.jsxs)("div",{children:["Filter silences by using a comma separated list of matchers, e.g.:",(0,e.jsx)("pre",{children:"severity=critical, env=production"})]}),children:(0,e.jsx)(h.I,{name:"info-circle",size:"sm"})})]})}),invalid:!n,error:n?null:"Query must use valid matcher syntax",children:(0,e.jsx)(Me.p,{className:x.searchInput,prefix:(0,e.jsx)(h.I,{name:"search"}),onChange:d,defaultValue:r??"",placeholder:(0,a.t)("alerting.silences-filter.search-query-input-placeholder-search","Search"),"data-testid":"search-query-input"},s)}),r&&(0,e.jsx)("div",{className:x.rowChild,children:(0,e.jsx)(C.$n,{variant:"secondary",icon:"times",onClick:g,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.clear-filters",children:"Clear filters"})})})]})},Le=s=>({searchInput:(0,c.css)({width:"360px"}),flexRow:(0,c.css)({display:"flex",flexDirection:"row",alignItems:"flex-end",paddingBottom:s.spacing(3),borderBottom:`1px solid ${s.colors.border.medium}`}),rowChild:(0,c.css)({marginRight:s.spacing(1),marginBottom:0,maxHeight:"52px"}),fieldLabel:(0,c.css)({fontSize:"12px",fontWeight:500})}),J={pollingInterval:Q.wG,refetchOnFocus:!0},Re=()=>{const{selectedAlertmanager:s=""}=(0,q.VI)(),[i,l]=(0,z.L7)(z.QI.PreviewSilencedInstances),o=i&&l,{data:r=[],isLoading:x}=k.m.endpoints.getAlertmanagerAlerts.useQuery({amSourceName:s,filter:{silenced:!0,active:!0,inhibited:!0}},{...J,skip:!o}),{data:d=[],isLoading:g,error:n}=$.F.endpoints.getSilences.useQuery({datasourceUid:(0,B.w5)(s),ruleMetadata:!0,accessControl:!0},J),{currentData:m}=X.L.useDiscoverAmFeaturesQuery({amSourceName:s??""},{skip:!s}),j=(0,I.JZ)(n).includes("the Alertmanager is not configured")&&m?.lazyConfigInit,T=(0,y.of)(Ne),[b]=(0,A.s)(),F=Z(d,!1),w=Z(d,!0),{silenceState:Oe}=(0,I.qy)(b),Be=Oe===M.RC.Expired,Ue=(0,u.useMemo)(()=>{const K=v=>r.filter(P=>P.status.silencedBy.includes(v));return F.map(v=>{const P=o?K(v.id):void 0;return{id:v.id,data:{...v,silencedAlerts:P}}})},[F,r,o]),U=(0,u.useMemo)(()=>{const K=v=>r.filter(P=>P.status.silencedBy.includes(v));return w.map(v=>{const P=o?K(v.id):void 0;return{id:v.id,data:{...v,silencedAlerts:P}}})},[w,r,o]);if(g||x)return(0,e.jsx)(R._,{text:(0,a.t)("alerting.silences-table.text-loading-silences","Loading silences...")});if(j)return(0,e.jsx)(L.F,{title:(0,a.t)("alerting.silences-table.title-the-selected-alertmanager-has-no-configuration","The selected Alertmanager has no configuration"),severity:"warning",children:(0,e.jsx)(a.x6,{i18nKey:"silences.table.noConfig",children:"Create a new contact point to create a configuration using the default values or contact your administrator to set up the Alertmanager."})});if(n){const K=(0,I.JZ)(n)||"Unknown error.";return(0,e.jsx)(L.F,{severity:"error",title:(0,a.t)("alerting.silences-table.title-error-loading-silences","Error loading silences"),children:K})}return(0,e.jsxs)("div",{"data-testid":"silences-table",children:[(0,e.jsx)(ne.M,{currentAlertmanager:s}),!!d.length&&(0,e.jsxs)(S.B,{direction:"column",children:[(0,e.jsx)(Pe,{}),(0,e.jsx)(te._,{actions:[z.QI.CreateSilence],children:(0,e.jsx)(S.B,{justifyContent:"end",children:(0,e.jsx)(C.z9,{href:(0,I.nL)("/alerting/silence/new",s),icon:"plus",children:(0,e.jsx)(a.x6,{i18nKey:"silences.table.add-silence-button",children:"Add Silence"})})})}),(0,e.jsx)(V,{items:Ue,alertManagerSourceName:s,dataTestId:"not-expired-table"}),U.length>0&&(0,e.jsxs)(N.M,{label:`Expired silences (${U.length})`,isOpen:Be,children:[(0,e.jsxs)("div",{className:T.callout,children:[(0,e.jsx)(h.I,{className:T.calloutIcon,name:"info-circle"}),(0,e.jsx)("span",{children:(0,e.jsx)(a.x6,{i18nKey:"silences.table.expired-silences",children:"Expired silences are automatically deleted after 5 days."})})]}),(0,e.jsx)(V,{items:U,alertManagerSourceName:s,dataTestId:"expired-table"})]})]}),!d.length&&(0,e.jsx)(xe,{alertManagerSourceName:s})]})};function V({items:s,alertManagerSourceName:i,dataTestId:l}){const o=ze(i);return s.length?(0,e.jsx)(se.E,{pagination:{itemsPerPage:25},items:s,cols:o,isExpandable:!0,dataTestId:l,renderExpandedContent:({data:r})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p.c,{}),(0,e.jsx)(Ae,{silence:r})]})}):(0,e.jsx)(a.x6,{i18nKey:"silences.table.no-matching-silences",children:"No matching silences found;"})}const Z=(s,i=!1)=>{const[l]=(0,A.s)();return(0,u.useMemo)(()=>{const{queryString:o}=(0,I.qy)(l),r=l?.silenceIds;return s.filter(x=>typeof r=="string"&&!r.split(",").includes(x.id)||o&&!(0,W.Zc)(o).every(n=>x.matchers?.some(({name:m,value:j,isEqual:T,isRegex:b})=>n.name===m&&n.value===j&&n.isEqual===T&&n.isRegex===b))?!1:i?x.status.state===M.RC.Expired:x.status.state!==M.RC.Expired)},[l,s,i])},Ne=s=>({callout:(0,c.css)({backgroundColor:s.colors.background.secondary,borderTop:`3px solid ${s.colors.info.border}`,borderRadius:s.shape.radius.default,height:"62px",display:"flex",flexDirection:"row",alignItems:"center","& > *":{marginLeft:s.spacing(1)}}),calloutIcon:(0,c.css)({color:s.colors.info.text})});function ze(s){const[i,l]=(0,z.L7)(z.QI.UpdateSilence),[o]=$.F.endpoints.expireSilence.useMutation(),r=s===B.hY;return(0,u.useMemo)(()=>{const x=g=>{o({datasourceUid:(0,B.w5)(s),silenceId:g})},d=[{id:"state",label:"State",renderCell:function({data:{status:n}}){return(0,e.jsx)(Ie,{state:n.state})},size:3},{id:"alert-rule",label:"Alert rule targeted",renderCell:function({data:{metadata:n}}){return n?.rule_title?(0,e.jsx)(E.N,{href:`/alerting/grafana/${n?.rule_uid}/view?returnTo=${encodeURIComponent("/alerting/silences")}`,children:n.rule_title}):"None"},size:8},{id:"matchers",label:"Matching labels",renderCell:function({data:{matchers:n}}){const m=n?.filter(j=>j.name!==Q.kW)||[];return(0,e.jsx)(ae,{matchers:m})},size:7},{id:"alerts",label:"Alerts silenced",renderCell:function({data:{silencedAlerts:n}}){return(0,e.jsx)("span",{"data-testid":"alerts",children:Array.isArray(n)?n.length:"-"})},size:2},{id:"schedule",label:"Schedule",renderCell:function({data:{startsAt:n,endsAt:m}}){const j=f.parse(n),T=f.parse(m),b="YYYY-MM-DD HH:mm";return`${j?.format(b)} - ${T?.format(b)}`},size:7}];return i&&d.push({id:"actions",label:"Actions",renderCell:function({data:n}){const m=n.status.state===M.RC.Expired,j=n?.accessControl?.create,T=n?.accessControl?.write,b=m&&(r?j:l),F=!m&&(r?T:l);return(0,e.jsxs)(S.B,{gap:.5,wrap:"wrap",children:[b&&(0,e.jsx)(C.z9,{title:(0,a.t)("alerting.use-columns.title-recreate","Recreate"),size:"sm",variant:"secondary",icon:"sync",href:(0,I.nL)(`/alerting/silence/${n.id}/edit`,s),children:(0,e.jsx)(a.x6,{i18nKey:"silences.table.recreate-button",children:"Recreate"})}),F&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(C.z9,{title:(0,a.t)("alerting.use-columns.title-unsilence","Unsilence"),size:"sm",variant:"secondary",icon:"bell",onClick:()=>x(n.id),children:(0,e.jsx)(a.x6,{i18nKey:"silences.table.unsilence-button",children:"Unsilence"})}),(0,e.jsx)(C.z9,{title:(0,a.t)("alerting.use-columns.title-edit","Edit"),size:"sm",variant:"secondary",icon:"pen",href:(0,I.nL)(`/alerting/silence/${n.id}/edit`,s),children:(0,e.jsx)(a.x6,{i18nKey:"silences.table.edit-button",children:"Edit"})})]})]})},size:5}),d},[s,o,r,l,i])}function Ke(){return(0,e.jsx)(ee.y,{navId:"silences",accessType:"instance",children:(0,e.jsx)(Re,{})})}const Fe=(0,_.S)(Ke)},27911:(O,D,t)=>{t.d(D,{L:()=>c});var e=t(22803);const c=u=>({table:(0,e.css)({width:"100%",borderRadius:u.shape.radius.default,border:`solid 1px ${u.colors.border.weak}`,backgroundColor:u.colors.background.secondary,th:{padding:u.spacing(1)},td:{padding:`0 ${u.spacing(1)}`},tr:{height:"38px"}}),evenRow:(0,e.css)({backgroundColor:u.colors.background.primary}),colExpand:(0,e.css)({width:"36px"}),nameCell:(0,e.css)({gap:u.spacing(1)}),actionsCell:(0,e.css)({textAlign:"right",width:"1%",whiteSpace:"nowrap","& > * + *":{marginLeft:u.spacing(.5)}})})}}]);

//# sourceMappingURL=SilencesTablePage.66933b97be3349da3770.js.map