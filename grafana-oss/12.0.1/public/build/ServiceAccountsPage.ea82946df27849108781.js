"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6777],{91087:(ee,R,t)=>{t.d(R,{y:()=>r});var e=t(74848),T=t(96540),u=t(41053),p=t(73427),c=t(96673),E=t(59812),l=t(12037);const r=({basicRole:P,roles:i,userId:C,orgId:m,onBasicRoleChange:I,roleOptions:v,disabled:F,basicRoleDisabled:z,basicRoleDisabledMessage:Y,apply:W=!1,onApplyRoles:a,pendingRoles:n,maxWidth:o,width:D,isLoading:b})=>{const[{loading:M,value:B=i||[]},j]=(0,u.A)(async()=>{try{if(i)return i;if(W&&n?.length)return n;if(p.TP.hasPermission(c.AccessControlAction.ActionUserRolesList)&&C>0)return await(0,l.Xh)(C,m)}catch{console.error("Error loading options")}return[]},[m,C,n,i]);(0,T.useEffect)(()=>{m&&j()},[j,m]);const k=async O=>{W?a&&a(O,C,m):(await(0,l.eA)(O,C,m),await j())},V=p.TP.hasPermission(c.AccessControlAction.ActionUserRolesAdd)&&p.TP.hasPermission(c.AccessControlAction.ActionUserRolesRemove);return(0,e.jsx)(E.n,{appliedRoles:B,basicRole:P,onRolesChange:k,onBasicRoleChange:I,roleOptions:v,isLoading:M||b,disabled:F,basicRoleDisabled:z,basicRoleDisabledMessage:Y,showBasicRole:!0,apply:W,canUpdateRoles:V,maxWidth:o,width:D})}},9390:(ee,R,t)=>{t.d(R,{r:()=>l});var e=t(74848),T=t(90382),u=t(18857),p=t(56840);const E=Object.values(T.X).filter(r=>r!==T.X.None).map(r=>({label:r,value:r}));function l({value:r,onChange:P,"aria-label":i,inputId:C,autoFocus:m,...I}){return(0,e.jsx)(u.l6,{inputId:C,value:r,options:E,onChange:v=>P(v.value??T.X.None),placeholder:(0,p.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":i,autoFocus:m,...I})}},75955:(ee,R,t)=>{t.r(R),t.d(R,{ServiceAccountsListPageUnconnected:()=>Q,default:()=>de});var e=t(74848),T=t(22803),u=t(55127),p=t.n(u),c=t(96540),E=t(71468),l=t(63142),r=t(89640),P=t(45861),i=t(41654),C=t(18027),m=t(12737),I=t(31286),v=t(77824),F=t(50201),z=t(71599),Y=t(13791),W=t(65642),a=t(73427),n=t(56840),o=t(96673),D=t(70255),b=t(27594),M=t(34213),B=t(71555),j=t(30703),k=t(76319),V=t(91087),O=t(9390);const L=({services:s,onRoleChange:d,roleOptions:K,onRemoveButtonClick:f,onDisable:h,onEnable:y,onAddTokenClick:J,showPaging:X,totalPages:ce,onChangePage:_,currentPage:oe,isLoading:N})=>{const q=(0,c.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:A},row:{original:S}})=>$(A,S,N,"avatarUrl")},{id:"name",header:"Account",cell:({cell:{value:A},row:{original:S}})=>$(A,S,N),sortType:"string"},{id:"id",header:"ID",cell:({cell:{value:A},row:{original:S}})=>$(A,S,N,"id")},{id:"role",header:"Roles",cell:({cell:{value:A},row:{original:S}})=>te(A,S,N,K,d)},{id:"tokens",header:"Tokens",cell:({cell:{value:A},row:{original:S}})=>$(A,S,N,"tokens")},{id:"actions",header:"",cell:({row:{original:A}})=>G(A,N,J,y,h,f)}],[N,J,h,y,f,d,K]);return(0,e.jsxs)(i.B,{direction:"column",gap:2,children:[(0,e.jsx)(b.j,{columns:q,data:s,getRowId:A=>String(A.id)}),X&&ce>1&&(0,e.jsx)(i.B,{justifyContent:"flex-end",children:(0,e.jsx)(M.d,{numberOfPages:ce,currentPage:oe,onNavigate:_})})]})},$=(s,d,K,f)=>{if(K)return f==="avatarUrl"?(0,e.jsx)(D.A,{circle:!0,width:24,height:24}):(0,e.jsx)(D.A,{width:100});const h=`/org/serviceaccounts/${d.uid}`,y=`Edit service account's ${name} details`;switch(f){case"avatarUrl":return(0,e.jsx)("a",{"aria-label":y,href:h,children:(0,e.jsx)(B.e,{src:s,alt:"User avatar"})});case"id":return(0,e.jsx)(r.Y,{href:h,"aria-label":y,color:"secondary",inline:!1,children:d.login});case"tokens":return(0,e.jsxs)(i.B,{alignItems:"center",children:[(0,e.jsx)(j.I,{name:"key-skeleton-alt"}),(0,e.jsx)(r.Y,{href:h,"aria-label":y,color:"primary",inline:!1,children:s||"No tokens"})]});default:return(0,e.jsx)(r.Y,{href:h,"aria-label":y,color:"primary",inline:!1,children:s})}},te=(s,d,K,f,h)=>{const y=a.TP.hasPermission(o.AccessControlAction.ActionRolesList)&&a.TP.hasPermission(o.AccessControlAction.ActionUserRolesList),J=a.TP.hasPermissionInMetadata(o.AccessControlAction.ServiceAccountsWrite,d);return K?(0,e.jsx)(D.A,{width:100}):a.TP.licensedAccessControlEnabled()?y&&(0,e.jsx)(V.y,{userId:d.id,orgId:d.orgId,basicRole:s,roles:d.roles||[],onBasicRoleChange:X=>h(X,d),roleOptions:f,basicRoleDisabled:!J,disabled:d.isExternal||d.isDisabled,width:40}):(0,e.jsx)(O.r,{"aria-label":(0,n.t)("serviceaccounts.get-role-cell.aria-label-role","Role"),value:s,disabled:d.isExternal||!J||d.isDisabled,onChange:X=>h(X,d)})},G=(s,d,K,f,h,y)=>d?(0,e.jsx)(D.A,{width:100}):s.isExternal?(0,e.jsx)(i.B,{alignItems:"center",justifyContent:"flex-end",children:(0,e.jsx)(k.K,{disabled:!0,name:"lock",size:"md",tooltip:(0,n.t)("serviceaccounts.get-actions-cell.tooltip-managed-service-account-cannot-modified","This is a managed service account and cannot be modified")})}):(0,e.jsxs)(i.B,{alignItems:"center",justifyContent:"flex-end",children:[a.TP.hasPermission(o.AccessControlAction.ServiceAccountsWrite)&&!s.tokens&&(0,e.jsx)(P.$n,{onClick:()=>K(s),disabled:s.isDisabled,children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.get-actions-cell.add-token",children:"Add token"})}),a.TP.hasPermissionInMetadata(o.AccessControlAction.ServiceAccountsWrite,s)&&(s.isDisabled?(0,e.jsx)(P.$n,{variant:"secondary",size:"md",onClick:()=>f(s),children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.get-actions-cell.enable",children:"Enable"})}):(0,e.jsx)(P.$n,{variant:"secondary",size:"md",onClick:()=>h(s),children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.get-actions-cell.disable",children:"Disable"})})),a.TP.hasPermissionInMetadata(o.AccessControlAction.ServiceAccountsDelete,s)&&(0,e.jsx)(k.K,{name:"trash-alt","aria-label":(0,n.t)("serviceaccounts.get-actions-cell.aria-label-delete-button","Delete service account {{serviceAccountName}}",{serviceAccountName:s.name}),variant:"secondary",onClick:()=>y(s)})]});L.displayName="ServiceAccountTable";var ne=t(18079),U=t(76031);function ae(s){return{...s.serviceAccounts}}const H={changePage:U.yd,changeQuery:U.nM,fetchACOptions:U.pJ,fetchServiceAccounts:U.iJ,deleteServiceAccount:U.W4,updateServiceAccount:U.mV,changeStateFilter:U.qS,createServiceAccountToken:U.yC},ie=(0,E.connect)(ae,H),se=[{label:"All",value:o.ServiceAccountStateFilter.All},{label:"With expired tokens",value:o.ServiceAccountStateFilter.WithExpiredTokens},{label:"Disabled",value:o.ServiceAccountStateFilter.Disabled}];W.Ay.featureToggles.externalServiceAccounts&&se.push({label:"Managed",value:o.ServiceAccountStateFilter.External});const Q=({page:s,changePage:d,totalPages:K,serviceAccounts:f,isLoading:h,roleOptions:y,query:J,serviceAccountStateFilter:X,changeQuery:ce,fetchACOptions:_,fetchServiceAccounts:oe,deleteServiceAccount:N,updateServiceAccount:q,changeStateFilter:A,createServiceAccountToken:S})=>{const[Ee,ue]=(0,c.useState)(!1),[Pe,ve]=(0,c.useState)(!1),[De,he]=(0,c.useState)(!1),[fe,me]=(0,c.useState)(""),[g,Z]=(0,c.useState)(null),Ce=(0,l.of)(re);(0,c.useEffect)(()=>{oe({withLoadingIndicator:!0}),a.TP.licensedAccessControlEnabled()&&_()},[_,oe]);const le=f.length===0&&X===o.ServiceAccountStateFilter.All&&!J,ye=async(x,Ue)=>{const Ke={...Ue,role:x};q(Ke),a.TP.licensedAccessControlEnabled()&&_()},ge=x=>{ce(x)},Te=x=>{A(x)},je=x=>{Z(x),ve(!0)},pe=async()=>{g&&N(g.uid),Ae()},Me=x=>{Z(x),he(!0)},Oe=()=>{g&&q({...g,isDisabled:!0}),xe()},Se=x=>{q({...x,isDisabled:!1})},Re=x=>{Z(x),ue(!0)},Ie=async x=>{g&&S(g.uid,x,me)},Be=()=>{ue(!1),Z(null),me("")},Ae=()=>{ve(!1),Z(null)},xe=()=>{he(!1),Z(null)},Le=(0,e.jsx)("span",{children:(0,e.jsxs)(n.x6,{i18nKey:"serviceaccounts.service-accounts-list-page-unconnected.sub-title",children:["Service accounts and their tokens can be used to authenticate against the Grafana API. Find out more in our"," ",(0,e.jsx)(r.Y,{href:"https://grafana.com/docs/grafana/latest/administration/service-accounts/",external:!0,children:"documentation."})]})});return(0,e.jsx)(Y.Y,{navId:"serviceaccounts",subTitle:Le,actions:(0,e.jsx)(e.Fragment,{children:!le&&a.TP.hasPermission(o.AccessControlAction.ServiceAccountsCreate)&&(0,e.jsx)(P.z9,{href:"org/serviceaccounts/create",variant:"primary",children:(0,e.jsx)(n.x6,{i18nKey:"serviceaccounts.service-accounts-list-page-unconnected.add-service-account",children:"Add service account"})})}),children:(0,e.jsxs)(Y.Y.Contents,{children:[(0,e.jsxs)(i.B,{justifyContent:"space-between",wrap:"wrap",children:[(0,e.jsx)(C.I,{grow:!0,children:(0,e.jsx)(m.Z,{className:Ce.filterInput,placeholder:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.placeholder-search-service-account-by-name","Search service account by name"),value:J,onChange:ge})}),(0,e.jsx)(I.a,{marginBottom:1,children:(0,e.jsx)(v.z,{options:se,onChange:Te,value:X})})]}),!h&&!le&&f.length===0&&(0,e.jsx)(F.p,{variant:"not-found",message:(0,n.t)("service-accounts.empty-state.message","No services accounts found")}),!h&&le&&(0,e.jsx)(F.p,{variant:"call-to-action",button:(0,e.jsx)(P.z9,{disabled:!a.TP.hasPermission(o.AccessControlAction.ServiceAccountsCreate),href:"org/serviceaccounts/create",icon:"key-skeleton-alt",size:"lg",children:(0,e.jsx)(n.x6,{i18nKey:"service-accounts.empty-state.button-title",children:"Add service account"})}),message:(0,n.t)("service-accounts.empty-state.title","You haven't created any service accounts yet"),children:(0,e.jsx)(n.x6,{i18nKey:"service-accounts.empty-state.more-info",children:"Remember, you can provide specific permissions for API access to other applications"})}),(h||f.length!==0)&&(0,e.jsx)(L,{services:f,showPaging:!0,totalPages:K,onChangePage:d,currentPage:s,onRoleChange:ye,roleOptions:y,onRemoveButtonClick:je,onDisable:Me,onEnable:Se,onAddTokenClick:Re,isLoading:h}),g&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(z.u,{isOpen:Pe,body:`Are you sure you want to delete '${g.name}'${g.tokens?` and ${g.tokens} accompanying ${p()("token",g.tokens)}`:""}?`,confirmText:"Delete",title:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.title-delete-service-account","Delete service account"),onConfirm:pe,onDismiss:Ae}),(0,e.jsx)(z.u,{isOpen:De,title:(0,n.t)("serviceaccounts.service-accounts-list-page-unconnected.title-disable-service-account","Disable service account"),body:`Are you sure you want to disable '${g.name}'?`,confirmText:"Disable service account",onConfirm:Oe,onDismiss:xe}),(0,e.jsx)(ne.z,{isOpen:Ee,token:fe,serviceAccountLogin:g.login,onCreateToken:Ie,onClose:Be})]})]})})},re=s=>({filterInput:(0,T.css)({maxWidth:s.spacing(50)})}),de=ie(Q)},18079:(ee,R,t)=>{t.d(R,{z:()=>z});var e=t(74848),T=t(22803),u=t(96540),p=t(24726),c=t(43173),E=t(63142),l=t(22787),r=t(37386),P=t(63527),i=t(77824),C=t(43482),m=t(45861),I=t(47931),v=t(56840);const F=[{label:"No expiration",value:!1},{label:"Set expiration date",value:!0}],z=({isOpen:a,token:n,serviceAccountLogin:o,onCreateToken:D,onClose:b})=>{const M=new Date;M.setDate(M.getDate()+1);const B=new Date;c.$.tokenExpirationDayLimit!==void 0&&c.$.tokenExpirationDayLimit>-1?B.setDate(B.getDate()+c.$.tokenExpirationDayLimit+1):B.setDate(864e13);const j=c.$.tokenExpirationDayLimit!==void 0&&c.$.tokenExpirationDayLimit>0,[k,V]=(0,u.useState)(""),[O,L]=(0,u.useState)(""),[$,te]=(0,u.useState)(j),[G,ne]=(0,u.useState)(M),[U,ae]=(0,u.useState)(G!==""),H=(0,E.of)(W);(0,u.useEffect)(()=>{a&&V(`${o}-${(0,p.A)()}`)},[o,a]);const ie=w=>{ae(w!==""),ne(w)},se=()=>{D({name:O||k,secondsToLive:$?Y(G):void 0})},Q=()=>{L(""),V(""),te(j),ne(M),ae(G!==""),b()},re=n?"Service account token created":"Add service account token";return(0,e.jsx)(l.a,{isOpen:a,title:re,onDismiss:Q,className:H.modal,children:n?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(r.D,{label:(0,v.t)("serviceaccounts.create-token-modal.label-token","Token"),description:(0,v.t)("serviceaccounts.create-token-modal.description-token","Copy the token now as you will not be able to see it again. Losing a token requires creating a new one."),children:(0,e.jsxs)("div",{className:H.modalTokenRow,children:[(0,e.jsx)(P.p,{name:"tokenValue",value:n,readOnly:!0}),(0,e.jsx)(I.b,{className:H.modalCopyToClipboardButton,variant:"primary",size:"md",icon:"copy",getText:()=>n,children:(0,e.jsx)(v.x6,{i18nKey:"serviceaccounts.create-token-modal.copy-clipboard",children:"Copy to clipboard"})})]})}),(0,e.jsxs)(l.a.ButtonRow,{children:[(0,e.jsx)(I.b,{variant:"primary",getText:()=>n,onClipboardCopy:Q,children:(0,e.jsx)(v.x6,{i18nKey:"serviceaccounts.create-token-modal.copy-to-clipboard-and-close",children:"Copy to clipboard and close"})}),(0,e.jsx)(m.$n,{variant:"secondary",onClick:Q,children:(0,e.jsx)(v.x6,{i18nKey:"serviceaccounts.create-token-modal.close",children:"Close"})})]})]}):(0,e.jsxs)("div",{children:[(0,e.jsx)(r.D,{label:(0,v.t)("serviceaccounts.create-token-modal.label-display-name","Display name"),description:(0,v.t)("serviceaccounts.create-token-modal.description-name-to-easily-identify-the-token","Name to easily identify the token"),required:!0,children:(0,e.jsx)(P.p,{name:"tokenName",value:O,placeholder:k,onChange:w=>{L(w.currentTarget.value)}})}),(0,e.jsx)(r.D,{label:(0,v.t)("serviceaccounts.create-token-modal.label-expiration","Expiration"),children:(0,e.jsx)(i.z,{options:F,value:$,onChange:te,size:"md"})}),$&&(0,e.jsx)(r.D,{label:(0,v.t)("serviceaccounts.create-token-modal.label-expiration-date","Expiration date"),children:(0,e.jsx)(C.l,{onChange:ie,value:G,placeholder:"",minDate:M,maxDate:B})}),(0,e.jsx)(l.a.ButtonRow,{children:(0,e.jsx)(m.$n,{onClick:se,disabled:$&&!U,children:(0,e.jsx)(v.x6,{i18nKey:"serviceaccounts.create-token-modal.generate-token",children:"Generate token"})})})]})})},Y=a=>{const n=new Date(a),o=new Date;return Math.ceil((n.getTime()-o.getTime())/1e3)},W=a=>({modal:(0,T.css)({width:"550px"}),modalTokenRow:(0,T.css)({display:"flex"}),modalCopyToClipboardButton:(0,T.css)({marginLeft:a.spacing(.5)})})},76031:(ee,R,t)=>{t.d(R,{W4:()=>I,iJ:()=>i,mV:()=>m,nM:()=>z,pJ:()=>P,qS:()=>Y,yC:()=>v,yd:()=>W});var e=t(2543),T=t.n(e),u=t(68143),p=t(12037),c=t(15130),E=t(96673),l=t(91259);const r="/api/serviceaccounts";function P(){return async a=>{try{if(c.TP.licensedAccessControlEnabled()&&c.TP.hasPermission(E.AccessControlAction.ActionRolesList)){const n=await(0,p.RL)();a((0,l.ew)(n))}}catch(n){console.error(n)}}}function i({withLoadingIndicator:a}={withLoadingIndicator:!1}){return async(n,o)=>{try{if(c.TP.hasPermission(E.AccessControlAction.ServiceAccountsRead)){a&&n((0,l.FW)());const{perPage:D,page:b,query:M,serviceAccountStateFilter:B}=o().serviceAccounts,j=await(0,u.AI)().get(`/api/serviceaccounts/search?perpage=${D}&page=${b}&query=${M}${F(B)}&accesscontrol=true`);if(c.TP.licensedAccessControlEnabled()&&c.TP.hasPermission(E.AccessControlAction.ActionUserRolesList)){n((0,l.dJ)());const k=c.TP.user.orgId,V=j?.serviceAccounts.map(L=>L.id),O=await(0,u.AI)().post("/api/access-control/users/roles/search",{userIds:V,orgId:k});j.serviceAccounts.forEach(L=>{L.roles=O?O[L.id]||[]:[]}),n((0,l.jE)())}n((0,l.zh)(j))}}catch(D){console.error(D)}finally{n((0,l.Yh)())}}}const C=(0,e.debounce)(a=>a(i()),500,{leading:!0});function m(a){return async n=>{await(0,u.AI)().patch(`${r}/${a.uid}?accesscontrol=true`,{...a}),n(i())}}function I(a){return async n=>{await(0,u.AI)().delete(`${r}/${a}`),n(i())}}function v(a,n,o){return async D=>{const b=await(0,u.AI)().post(`${r}/${a}/tokens`,n);o(b.key),D(i())}}const F=a=>{switch(a){case E.ServiceAccountStateFilter.WithExpiredTokens:return"&expiredTokens=true";case E.ServiceAccountStateFilter.Disabled:return"&disabled=true";case E.ServiceAccountStateFilter.External:return"&external=true";default:return""}};function z(a){return async n=>{n((0,l.L5)(a)),C(n)}}function Y(a){return async n=>{n((0,l.c3)(a)),n(i())}}function W(a){return async n=>{n((0,l.EC)(a)),n(i())}}}}]);

//# sourceMappingURL=ServiceAccountsPage.ea82946df27849108781.js.map