"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7011],{61048:(ft,J,o)=>{o.d(J,{i:()=>N});var e=o(74848),r=o(22803),m=o(63142);const N=({children:C,className:Q})=>{const v=(0,m.of)(F);return(0,e.jsx)("div",{className:(0,r.cx)(v.wrapper,Q),children:C})},F=C=>({wrapper:(0,r.css)({display:"flex",flexDirection:"column",fontSize:C.typography.bodySmall.fontSize})})},74410:(ft,J,o)=>{o.d(J,{l:()=>F});var e=o(74848),r=o(22803),m=o(96540),N=o(49785);function F({defaultValues:C,onSubmit:Q,validateOnMount:v=!1,validateFieldsOnMount:Y,children:O,validateOn:tt="onSubmit",maxWidth:S=600,...b}){const{handleSubmit:Z,trigger:$,formState:n,...f}=(0,N.mN)({mode:tt,defaultValues:C});return(0,m.useEffect)(()=>{v&&$(Y)},[$,Y,v]),(0,e.jsx)("form",{className:(0,r.css)({maxWidth:S!=="none"?S+"px":S,width:"100%"}),onSubmit:Z(Q),...b,children:O({errors:n.errors,formState:n,trigger:$,...f})})}},36327:(ft,J,o)=>{o.d(J,{W:()=>Tt});var e=o(74848),r=o(22803),m=o(96540),N=o(40961),F=o(84140),C=o(36613),Q=o(27359),v=o(739),Y=o(6773),O=o(8255),tt=o(15245),S=o(63142),b=o(46885),Z=o(83505),$=o(85629),n=o(49785),f=o(29647),g=o(41053),D=o(80011),d=o(5421),E=o(64400),c=o(41654),T=o(37386),U=o(87105),u=o(45861),ut=o(74410),at=o(93732),mt=o(78767);const gt=({annoVals:t,annoIdx:s,dismiss:h,timeZone:P,...R})=>{const p=(0,S.of)(lt),{onAnnotationCreate:j,onAnnotationUpdate:et}=(0,E.d2)(),W=(0,m.useRef)(null);(0,f.A)(W,h);const[L,z]=(0,g.A)(async a=>{const x=await j(a);return h(),x}),[ot,V]=(0,g.A)(async a=>{const x=await et(a);return h(),x}),I=a=>(0,D.LE)(a,{format:d.WC.fullDate,timeZone:P}),H=t.id?.[s]!=null,st=t.isRegion?.[s],it=H?V:z,q=H?ot:L,l=st?`${I(t.time[s])} - ${I(t.timeEnd[s])}`:I(t.time[s]),A=({tags:a,description:x})=>{it({id:t.id?.[s]??void 0,tags:a,description:x,from:Math.round(t.time[s]),to:Math.round(t.timeEnd?.[s]??t.time[s])})};return(0,e.jsxs)("div",{ref:W,className:p.editor,...R,children:[(0,e.jsx)("div",{className:p.header,children:(0,e.jsxs)(c.B,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)("div",{children:H?"Edit annotation":"Add annotation"}),(0,e.jsx)("div",{children:l})]})}),(0,e.jsx)(ut.l,{onSubmit:A,defaultValues:{description:t.text?.[s],tags:t.tags?.[s]||[]},children:({register:a,errors:x,control:y})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:p.content,children:[(0,e.jsx)(T.D,{label:"Description",invalid:!!x.description,error:x?.description?.message,children:(0,e.jsx)(U.f,{className:p.textarea,...a("description",{required:"Annotation description is required"})})}),(0,e.jsx)(T.D,{label:"Tags",children:(0,e.jsx)(n.xI,{control:y,name:"tags",render:({field:{ref:M,onChange:X,...i}})=>(0,e.jsx)(at.$,{allowCustomValue:!0,placeholder:"Add tags",onChange:X,tagOptions:mt.vy,tags:i.value})})})]}),(0,e.jsx)("div",{className:p.footer,children:(0,e.jsxs)(c.B,{justifyContent:"flex-end",children:[(0,e.jsx)(u.$n,{size:"sm",variant:"secondary",onClick:h,fill:"outline",children:"Cancel"}),(0,e.jsx)(u.$n,{size:"sm",type:"submit",disabled:q?.loading,children:q?.loading?"Saving":"Save"})]})})]})})]})},lt=t=>({editor:(0,r.css)({background:t.colors.background.elevated,border:`1px solid ${t.colors.border.weak}`,borderRadius:t.shape.radius.default,boxShadow:t.shadows.z3,userSelect:"text",width:"460px"}),content:(0,r.css)({padding:t.spacing(1)}),header:(0,r.css)({borderBottom:`1px solid ${t.colors.border.weak}`,padding:t.spacing(.5,1),fontWeight:t.typography.fontWeightBold,fontSize:t.typography.fontSize,color:t.colors.text.primary}),footer:(0,r.css)({borderTop:`1px solid ${t.colors.border.weak}`,padding:t.spacing(1,1)}),textarea:(0,r.css)({color:t.colors.text.secondary,fontSize:t.typography.bodySmall.fontSize})});var B=o(63704),nt=o(32881),rt=o(76319),w=o(94018),xt=o(2954);const yt=()=>!1,At=({annoVals:t,annoIdx:s,timeZone:h,onEdit:P})=>{const R=t.id?.[s],p=(0,S.of)(Mt),{canEditAnnotations:j=yt,canDeleteAnnotations:et=yt,onAnnotationDelete:W}=(0,E.d2)(),L=t.dashboardUID?.[s],z=R!==0&&j(L),ot=R!==0&&et(L)&&W!=null,V=l=>(0,D.LE)(l,{format:d.WC.fullDate,timeZone:h});let I=V(t.time[s]),H=t.text?.[s]??"";t.isRegion?.[s]&&(I+=" - "+V(t.timeEnd[s]));let st;t.login?.[s]&&t.avatarUrl?.[s]&&(st=(0,e.jsx)("img",{className:p.avatar,alt:"Annotation avatar",src:t.avatarUrl[s]}));let it=null,q="";if(t.alertId?.[s]!==void 0&&t.newState?.[s]){const l=xt.A.getStateDisplayModel(t.newState[s]);it=(0,e.jsx)("div",{className:p.alertState,children:(0,e.jsx)("i",{className:l.stateClass,children:l.text})}),q=t.data?.[s]?xt.A.getAlertAnnotationText(t.data[s]):""}else t.title?.[s]&&(H=t.title[s]+(H?`<br />${H}`:""));return(0,e.jsxs)("div",{className:p.wrapper,children:[(0,e.jsx)("div",{className:p.header,children:(0,e.jsxs)(nt.Gy,{justify:"space-between",align:"center",spacing:"md",children:[(0,e.jsxs)("div",{className:p.meta,children:[(0,e.jsxs)("span",{children:[st,it]}),I]}),(z||ot)&&(0,e.jsxs)("div",{className:p.editControls,children:[z&&(0,e.jsx)(rt.K,{name:"pen",size:"sm",onClick:P,tooltip:"Edit"}),ot&&(0,e.jsx)(rt.K,{name:"trash-alt",size:"sm",onClick:()=>W(R),tooltip:"Delete"})]})]})}),(0,e.jsxs)("div",{className:p.body,children:[H&&(0,e.jsx)("div",{className:p.text,dangerouslySetInnerHTML:{__html:B.sQ.sanitize(H)}}),q,(0,e.jsx)("div",{children:(0,e.jsx)(nt.Gy,{spacing:"xs",wrap:!0,children:t.tags?.[s]?.map((l,A)=>(0,e.jsx)(w.v,{name:l},`${l}-${A}`))})})]})]})},Mt=t=>({wrapper:(0,r.css)({zIndex:t.zIndex.tooltip,whiteSpace:"initial",borderRadius:t.shape.radius.default,background:t.colors.background.elevated,border:`1px solid ${t.colors.border.weak}`,boxShadow:t.shadows.z3,userSelect:"text"}),header:(0,r.css)({padding:t.spacing(.5,1),borderBottom:`1px solid ${t.colors.border.weak}`,fontWeight:t.typography.fontWeightBold,fontSize:t.typography.fontSize,color:t.colors.text.primary,display:"flex"}),meta:(0,r.css)({display:"flex",justifyContent:"space-between",color:t.colors.text.primary,fontWeight:400}),editControls:(0,r.css)({display:"flex",alignItems:"center","> :last-child":{marginLeft:0}}),body:(0,r.css)({padding:t.spacing(1),fontSize:t.typography.bodySmall.fontSize,color:t.colors.text.secondary,fontWeight:400,a:{color:t.colors.text.link,"&:hover":{textDecoration:"underline"}}}),text:(0,r.css)({paddingBottom:t.spacing(1)}),avatar:(0,r.css)({borderRadius:t.shape.radius.circle,width:16,height:16,marginRight:t.spacing(1)}),alertState:(0,r.css)({paddingRight:t.spacing(1),fontWeight:t.typography.fontWeightMedium})}),pt=0,dt=1,vt=2,St=({annoVals:t,annoIdx:s,className:h,style:P,exitWipEdit:R,timeZone:p,portalRoot:j})=>{const et=(0,S.of)(Dt),[W,L]=(0,m.useState)(R!=null?dt:pt),{refs:z,floatingStyles:ot}=(0,Z.we)({open:!0,placement:"bottom",middleware:[(0,b.UU)({fallbackAxisSideDirection:"end",crossAxis:!1,boundary:document.body}),(0,b.BN)()],whileElementsMounted:b.ll,strategy:"fixed"}),V=W===vt?(0,e.jsx)(At,{annoIdx:s,annoVals:t,timeZone:p,onEdit:()=>L(dt)}):W===dt?(0,e.jsx)(gt,{annoIdx:s,annoVals:t,timeZone:p,dismiss:()=>{R?.(),L(pt)}}):null;return(0,e.jsx)("div",{ref:z.setReference,className:h,style:P,onMouseEnter:()=>W!==dt&&L(vt),onMouseLeave:()=>W!==dt&&L(pt),"data-testid":$.Tp.pages.Dashboard.Annotations.marker,children:V&&(0,N.createPortal)((0,e.jsx)("div",{ref:z.setFloating,className:et.annoBox,style:ot,"data-testid":"annotation-marker",children:V}),j)})},Dt=t=>({annoBox:(0,r.css)({top:0,left:0,zIndex:t.zIndex.tooltip,borderRadius:t.shape.radius.default,position:"absolute",background:t.colors.background.primary,border:`1px solid ${t.colors.border.weak}`,boxShadow:t.shadows.z2,userSelect:"text",minWidth:"300px"})}),Et=(t,s,h,P,R)=>{t.beginPath(),t.moveTo(P,s),t.lineTo(P,h),t.strokeStyle=R,t.stroke()},ht=(0,F.A)(O.Mk).toHex8String();function Pt(t){let s={};return t.fields.forEach(h=>{s[h.name]=h.values}),s}const Tt=({annotations:t,timeZone:s,config:h,newRange:P,setNewRange:R,canvasRegionRendering:p=!0})=>{const[j,et]=(0,m.useState)(),[W]=(0,m.useState)(()=>(0,tt.gF)()),L=(0,S.of)(jt),z=(0,S.$j)().visualization.getColorByName,[ot,V]=(0,m.useReducer)(l=>l+1,0),I=(0,m.useMemo)(()=>{let l=t.filter(A=>A.name!=="exemplar"&&A.length>0&&A.fields.some(a=>a.name==="time"));if(P){let A=P.to>P.from;const a=(0,Q.I)([{time:P.from,timeEnd:A?P.to:null,isRegion:A,color:ht}]);a.meta={dataTopic:v.QR.Annotations,custom:{isWip:!0}},l.push(a)}return l},[t,P]),H=(0,m.useCallback)(()=>{R(null)},[R]),st=(0,m.useRef)(I);st.current=I;const it=(0,m.useRef)(P);it.current=P;const q=(0,m.useRef)();if((0,m.useLayoutEffect)(()=>{h.addHook("ready",l=>{let A=l.root.querySelector(".u-axis");q.current=A,et(l)}),h.addHook("draw",l=>{let A=st.current;const a=l.ctx;a.save(),a.beginPath(),a.rect(l.bbox.left,l.bbox.top,l.bbox.width,l.bbox.height),a.clip(),A.forEach(x=>{let y=Pt(x);if(x.name==="xymark"){let M=h.scales[0].props.scaleKey,X=h.scales[1].props.scaleKey;for(let i=0;i<x.length;i++){let G=z(y.color?.[i]||ht),K=l.valToPos(y.xMin[i],M,!0),k=l.valToPos(y.xMax[i],M,!0),_=l.valToPos(y.yMax[i],X,!0),ct=l.valToPos(y.yMin[i],X,!0);a.fillStyle=Y.MV.alpha(G,y.fillOpacity[i]),a.fillRect(K,_,k-K,ct-_),a.lineWidth=Math.round(y.lineWidth[i]*C.A.pxRatio),y.lineStyle[i]==="dash"?a.setLineDash([5,5]):a.setLineDash([]),a.strokeStyle=G,a.strokeRect(K,_,k-K,ct-_)}}else{let M=l.bbox.top,X=M+l.bbox.height;a.lineWidth=2,a.setLineDash([5,5]);for(let i=0;i<y.time.length;i++){let G=z(y.color?.[i]||ht),K=l.valToPos(y.time[i],"x",!0);if(Et(a,M,X,K,G),y.isRegion?.[i]){let k=l.valToPos(y.timeEnd[i],"x",!0);Et(a,M,X,k,G),p&&(a.fillStyle=Y.MV.alpha(G,.1),a.fillRect(K,M,k-K,l.bbox.height))}}}}),a.restore()})},[h,p,z]),(0,m.useEffect)(()=>{j&&(j.redraw(),setTimeout(()=>{V()},0))},[I,j]),j){let l=I.flatMap((A,a)=>{let x=Pt(A),y=[];for(let M=0;M<x.time.length;M++){let X=z(x.color?.[M]||O.Mk),i=Math.round(j.valToPos(x.time[M],"x"))||0,G=null,K="",k=!0;if(x.isRegion?.[M]){let _=Math.round(j.valToPos(x.timeEnd?.[M],"x"))||0;if(k=i<j.rect.width&&_>0,k){let ct=Math.max(0,i),Ct=Math.min(j.rect.width,_);G={left:ct,background:X,width:Ct-ct},K=L.annoRegion}}else k=i>=0&&i<=j.rect.width,k&&(G={left:i,borderBottomColor:X},K=L.annoMarker);if(k){let _=A.meta?.custom?.isWip;y.push((0,e.jsx)(St,{annoIdx:M,annoVals:x,className:K,style:G,timeZone:s,exitWipEdit:_?H:null,portalRoot:W},`${a}:${M}`))}}return y});return(0,N.createPortal)(l,q.current)}return null},jt=()=>({annoMarker:(0,r.css)({position:"absolute",width:0,height:0,borderLeft:"5px solid transparent",borderRight:"5px solid transparent",borderBottomWidth:"5px",borderBottomStyle:"solid",transform:"translateX(-50%)",cursor:"pointer",zIndex:1}),annoRegion:(0,r.css)({position:"absolute",height:"5px",cursor:"pointer",zIndex:1})})},13507:(ft,J,o)=>{o.d(J,{U:()=>N});var e=o(74848),r=o(96540),m=o(45861);const N=({config:F,onChangeTimeRange:C})=>{const Q=(0,r.useRef)(),[v,Y]=(0,r.useState)([]),[O,tt]=(0,r.useState)();if((0,r.useLayoutEffect)(()=>{F.addHook("init",g=>{Q.current=g}),F.addHook("setScale",g=>{Y(g.data?.[0]??[]),tt(g.scales.x??void 0)})},[F]),v.length<2||!C||!O||!O.time||!O.min||!O.max)return null;let S=0,b=v.length-1;for(;S<=b&&v[S]==null;)S++;for(;b>=0&&v[b]==null;)b--;const Z=v[S],$=v[b],n=O.min,f=O.max;return Z==null||$==null||Z<=f&&$>=n?null:(0,e.jsx)("div",{style:{position:"absolute",top:"50%",transform:"translateY(-50%)",width:"100%",textAlign:"center"},children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"Data outside time range"}),(0,e.jsx)(m.$n,{onClick:g=>C({from:Z,to:$}),variant:"secondary","data-testid":"time-series-zoom-to-data",children:"Zoom to data"})]})})};N.displayName="OutsideRangePlugin"},76234:(ft,J,o)=>{o.d(J,{B_:()=>tt,Fg:()=>Z,O2:()=>b,T5:()=>$});var e=o(95004),r=o(16515),m=o(63409),N=o(34455),F=o(55386),C=o(11576),Q=o(406),v=o(739),Y=o(70332);function O(n){let f=new Map;return n.map(D=>({...D,fields:D.fields.map(d=>{if(d.type===e.PU.enum){let E=(0,Y.M)(d.config,d.type),c=f.get(E);c||(c=[],f.set(E,c));let T=d.values.toArray().slice(),U=d.config.type.enum.text;if(c.length>0)for(let u=0;u<T.length;u++)T[u]+=c.length;return c.push(...U),d.config.type.enum.text=c,{...d,values:T}}return d})}))}function tt(n,f,g,D){if(!n?.length)return null;(0,r.Fm)(n);let d=D!=null;D!=null&&D>0&&(n=[{...n[0],fields:[n[0].fields[D],...n[0].fields.filter((U,u)=>u!==D)]}]);for(let U of n)for(let u of U.fields)u.type===e.PU.time&&typeof u.values[0]!="number"&&(u.values=(0,Q.s7)(u,{destinationType:e.PU.time}).values);let E=0;t:for(let U of n)for(let u of U.fields)if(u.type===e.PU.enum&&++E>1){n=O(n);break t}let c;const T=[];for(let U of n){const u=[];let ut=!1,at=!1,mt=d?U:(0,m.M)({frame:U,refFieldPseudoMin:g?.from.valueOf(),refFieldPseudoMax:g?.to.valueOf()});const gt=(0,N.C)(mt).fields;for(let lt=0;lt<(gt?.length||0);lt++){const B=gt[lt];switch(B.type){case e.PU.time:ut=!0,u.push(B);break;case e.PU.number:at=d?lt>0:!0,c={...B,values:B.values.map(w=>Number.isFinite(w)||w==null?w:null)},u.push(c);break;case e.PU.enum:at=!0;case e.PU.string:c={...B,values:B.values},u.push(c);break;case e.PU.boolean:at=!0;const nt=B.config?.custom??{},rt={...B.config,max:1,min:0,custom:nt};nt.lineInterpolation!==v.dx.StepBefore&&(nt.lineInterpolation=v.dx.StepAfter),c={...B,config:rt,type:e.PU.number,values:B.values.map(w=>w==null?w:w?1:0)},(0,F.j9)(rt.unit)||(rt.unit="bool",c.display=(0,C.J)({field:c,theme:f})),u.push(c);break}}(d||ut)&&at&&T.push({...U,length:mt.length,fields:u})}return T.length?(b(T,f,0),S(T,f),T):null}const S=(n,f)=>{const{palette:g}=f.visualization;for(const D of n)for(const d of D.fields)if(d.type===e.PU.enum){const E=g[d.state?.seriesIndex%g.length],c=f.visualization.getColorByName(E),T=d.config.type.enum;T.color=Array(T.text.length).fill(c),d.display=(0,C.J)({field:d,theme:f})}},b=(n,f,g)=>{let D=0;n.forEach(d=>{d.fields.forEach((E,c)=>{c!==g&&(E.type===e.PU.number||E.type===e.PU.boolean||E.type===e.PU.enum)&&(E.state={...E.state,seriesIndex:D++},E.display=(0,C.J)({field:E,theme:f}))})})};function Z(n,f){return!n||!n.length?[f]:n.map(g=>g?.length?g:f)}const $=n=>n.mode===v.$N.Multi&&n.maxHeight!=null}}]);

//# sourceMappingURL=7011.ecaf905b10e6ea2d2583.js.map