"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6315],{38396:(k,U,n)=>{n.d(U,{o:()=>N});var e=n(96540),f=n(96673),F=n(20018);function N(b){const z=(0,f.useDispatch)(),E=(0,e.useRef)(b);E.current=b,(0,e.useEffect)(()=>()=>{z((0,F.N)({cleanupAction:E.current}))},[z])}},83904:(k,U,n)=>{n.d(U,{i:()=>z});var e=n(74848),f=n(22803),F=n(96540),N=n(63142),b=n(12266);const z=({label:R,description:G,children:I,className:Y,size:J="xl"})=>{const D=(0,N.of)(E),[P,S]=(0,F.useState)(!0),O=()=>S(!P);return(0,e.jsxs)("div",{className:(0,f.cx)(D.wrapper,Y),children:[(0,e.jsx)(b.e,{className:D.toggle,size:J,onToggle:O,isCollapsed:P,text:R}),G&&(0,e.jsx)("p",{className:D.description,children:G}),(0,e.jsx)("div",{className:P?D.hidden:D.content,children:I})]})},E=R=>({wrapper:(0,f.css)({marginTop:R.spacing(1),paddingBottom:R.spacing(1)}),toggle:(0,f.css)({margin:R.spacing(1,0),padding:0}),hidden:(0,f.css)({display:"none"}),description:(0,f.css)({color:R.colors.text.secondary,fontSize:R.typography.size.sm,fontWeight:R.typography.fontWeightRegular,margin:0}),content:(0,f.css)({paddingLeft:R.spacing(3)})})},28365:(k,U,n)=>{n.d(U,{e:()=>le});var e=n(74848),f=n(22803),F=n(2543),N=n(96540),b=n(49785),z=n(37386),E=n(63142),R=n(32635),G=n(48767),I=n(63527),Y=n(18857),J=n(16203),D=n(40601),P=n(87105),S=n(41654),O=n(45861),s=n(56840),l=n(71774);const d=({value:t,onChange:o,readOnly:r=!1})=>{const i=(0,E.of)(u),[m,c]=(0,N.useState)(h(t)),[a,p]=(0,N.useState)(void 0),x=y=>{o(g(y))},$=y=>{const v=m.slice(),T=v.splice(y,1)[0];c(v),T[0]&&x(v)};return(0,e.jsxs)("div",{children:[!!m.length&&(0,e.jsxs)("table",{className:i.table,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(s.x6,{i18nKey:"alerting.key-value-map-input.name",children:"Name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(s.x6,{i18nKey:"alerting.key-value-map-input.value",children:"Value"})}),!r&&(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:m.map(([y,v],T)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(I.p,{readOnly:r,value:y,disabled:!0})}),(0,e.jsx)("td",{children:(0,e.jsx)(I.p,{readOnly:r,value:v,disabled:!0})}),!r&&(0,e.jsx)("td",{children:(0,e.jsx)(l.M,{icon:"trash-alt",tooltip:(0,s.t)("alerting.common.delete","Delete"),onClick:()=>$(T)})})]},T))})]}),a&&(0,e.jsx)("table",{className:i.table,children:(0,e.jsx)("tr",{children:(0,e.jsxs)(S.B,{gap:1,children:[(0,e.jsx)("td",{children:(0,e.jsx)(I.p,{value:a[0],onChange:y=>p([y.currentTarget.value,a[1]])})}),(0,e.jsx)("td",{children:(0,e.jsx)(I.p,{value:a[1],onChange:y=>p([a[0],y.currentTarget.value])})}),(0,e.jsx)("td",{children:(0,e.jsxs)(S.B,{gap:1,children:[(0,e.jsx)(l.M,{icon:"check",tooltip:(0,s.t)("alerting.contact-points.key-value-map.confirm-add","Confirm to add"),onClick:()=>{c([...m,a]),p(void 0),x([...m,a])}}),(0,e.jsx)(l.M,{icon:"times",tooltip:(0,s.t)("alerting.common.cancel","Cancel"),onClick:()=>p(void 0)})]})})]})})}),!r&&(0,e.jsx)(O.$n,{className:i.addButton,type:"button",variant:"secondary",icon:"plus",size:"sm",disabled:!!a,onClick:()=>p(["",""]),children:(0,e.jsx)(s.x6,{i18nKey:"alerting.contact-points.key-value-map.add",children:"Add"})})]})},u=t=>({addButton:(0,f.css)({marginTop:t.spacing(1)}),table:(0,f.css)({"tbody td":{padding:`0 ${t.spacing(1)} ${t.spacing(1)} 0`}})}),g=t=>{const o={};for(const[r,i]of t)r&&(o[r]=i);return o},h=t=>Object.entries(t??{}),j=({value:t,onChange:o,readOnly:r=!1})=>{const i=(0,E.of)(M),m=a=>{if(!t)return;const p=t.slice();p.splice(a,1),o(p)},c=(a,p)=>{t&&o(t.map((x,$)=>$===p?a:x))};return(0,e.jsxs)("div",{children:[!!t?.length&&t.map((a,p)=>(0,e.jsxs)("div",{className:i.row,children:[(0,e.jsx)(I.p,{readOnly:r,value:a,onChange:x=>c(x.currentTarget.value,p)}),!r&&(0,e.jsx)(l.M,{className:i.deleteIcon,icon:"trash-alt",tooltip:(0,s.t)("alerting.string-array-input.tooltip-delete","delete"),onClick:()=>m(p)})]},p)),!r&&(0,e.jsx)(O.$n,{className:i.addButton,type:"button",variant:"secondary",icon:"plus",size:"sm",onClick:()=>o([...t??[],""]),children:(0,e.jsx)(s.x6,{i18nKey:"alerting.string-array-input.add",children:"Add"})})]})},M=t=>({row:(0,f.css)({display:"flex",flexDirection:"row",marginBottom:t.spacing(1),alignItems:"center"}),deleteIcon:(0,f.css)({marginLeft:t.spacing(1)}),addButton:(0,f.css)({marginTop:t.spacing(1)})});var K=n(82203),H=n(83904);const te=t=>({collapsibleSection:(0,f.css)({margin:0,padding:0}),wrapper:(0,f.css)({margin:t.spacing(2,0),padding:t.spacing(1),border:`solid 1px ${t.colors.border.medium}`,borderRadius:t.shape.radius.default,position:"relative"}),description:(0,f.css)({color:t.colors.text.secondary,fontSize:t.typography.size.sm,fontWeight:t.typography.fontWeightRegular,margin:0}),deleteIcon:(0,f.css)({position:"absolute",right:t.spacing(1),top:t.spacing(1)}),addButton:(0,f.css)({marginTop:t.spacing(1)})}),se=({option:t,pathPrefix:o,errors:r,defaultValues:i,readOnly:m=!1})=>{const c=(0,E.of)(te),a=`${o}${t.propertyName}`,p=(0,b.xW)(),{fields:x,append:$,remove:y}=(0,K.r)({name:a,formAPI:p,defaults:i});return(0,e.jsx)("div",{className:c.wrapper,children:(0,e.jsxs)(H.i,{className:c.collapsibleSection,label:`${t.label} (${x.length})`,description:t.description,children:[(x??i??[]).map((v,T)=>(0,e.jsxs)("div",{className:c.wrapper,children:[!m&&(0,e.jsx)(l.M,{"data-testid":`${a}.${T}.delete-button`,icon:"trash-alt",tooltip:(0,s.t)("alerting.subform-array-field.tooltip-delete","delete"),onClick:()=>y(T),className:c.deleteIcon}),t.subformOptions?.map(A=>(0,e.jsx)(le,{readOnly:m,defaultValue:v?.[A.propertyName],option:A,pathPrefix:`${a}.${T}.`,error:r?.[T]?.[A.propertyName]},A.propertyName))]},T)),!m&&(0,e.jsx)(O.$n,{"data-testid":`${a}.add-button`,className:c.addButton,type:"button",variant:"secondary",icon:"plus",size:"sm",onClick:()=>$({__id:String(Math.random())}),children:(0,e.jsx)(s.x6,{i18nKey:"alerting.subform-array-field.add",children:"Add"})})]})})},ue=({option:t,pathPrefix:o,errors:r,defaultValue:i,readOnly:m=!1,secureFields:c={},onResetSecureField:a})=>{const p=(0,E.of)(te),x=`${o}${t.propertyName}`,{watch:$}=(0,b.xW)(),y=$(x),v=y===void 0?i:y,[T,A]=(0,N.useState)(!!v);return(0,e.jsxs)("div",{className:p.wrapper,"data-testid":`${x}.container`,children:[(0,e.jsx)("h6",{children:t.label}),t.description&&(0,e.jsx)("p",{className:p.description,children:t.description}),T&&(0,e.jsxs)(e.Fragment,{children:[!m&&(0,e.jsx)(l.M,{"data-testid":`${x}.delete-button`,icon:"trash-alt",tooltip:(0,s.t)("alerting.subform-field.tooltip-delete","delete"),onClick:()=>A(!1),className:p.deleteIcon}),(t.subformOptions??[]).map(V=>(0,e.jsx)(le,{readOnly:m,secureFields:c,onResetSecureField:a,defaultValue:i?.[V.propertyName],parentOption:t,option:V,pathPrefix:`${x}.`,error:r?.[V.propertyName]},V.propertyName))]}),!T&&!m&&(0,e.jsx)(O.$n,{className:p.addButton,type:"button",variant:"secondary",icon:"plus",size:"sm",onClick:()=>A(!0),"data-testid":`${x}.add-button`,children:(0,e.jsx)(s.x6,{i18nKey:"alerting.subform-field.add",children:"Add"})})]})};var me=n(73287),pe=n(8207),fe=n(77824),ge=n(76319),xe=n(72636),ve=n(66404),ne=n(74268),he=n(43730),je=n(40403),ie=n(5358),ye=n(34666),Ce=n(70713),Ee=n(31286),Te=n(52161),Ne=n(30130),Se=n(1332),$e=n(64179),w=n(87988);function be({payload:t,templateContent:o,templateName:r,payloadFormatError:i,setPayloadFormatError:m,className:c}){const a=(0,E.of)(Oe),{selectedAlertmanager:p}=(0,ie.VI)(),x=p===Te.hY;return(0,e.jsxs)("div",{className:(0,f.cx)(c,a.mainContainer),children:[(0,e.jsxs)("div",{className:a.container,children:[(0,e.jsx)(Ne.D,{label:(0,s.t)("alerting.template-content-and-preview.label-template-content","Template content")}),(0,e.jsx)(Ee.a,{flex:1,children:(0,e.jsx)("div",{className:a.viewerContainer({height:400}),children:(0,e.jsx)(Ce.default,{children:({width:$,height:y})=>(0,e.jsx)(Se.K,{value:o,containerStyles:a.editorContainer,width:$,height:y,readOnly:!0})})})})]}),x&&(0,e.jsx)($e.p,{payload:t,templateName:"",templateContent:(0,w.Jl)(r),setPayloadFormatError:m,payloadFormatError:i,className:(0,f.cx)(a.templatePreview,a.minEditorSize)})]})}const Oe=t=>({mainContainer:(0,f.css)({display:"flex",flexDirection:"column",gap:t.spacing(2)}),container:(0,f.css)({label:"template-preview-container",display:"flex",flexDirection:"column",borderRadius:t.shape.radius.default,border:`1px solid ${t.colors.border.medium}`}),templatePreview:(0,f.css)({flex:1,display:"flex"}),minEditorSize:(0,f.css)({minHeight:300,minWidth:300}),viewerContainer:({height:o})=>(0,f.css)({height:o,overflow:"auto",backgroundColor:t.colors.background.primary}),editorContainer:(0,f.css)({width:"fit-content",border:"none"})}),{useGetDefaultTemplatesQuery:Re}=he.E3;function ae({onSelect:t,option:o,valueInForm:r}){const[i,m]=(0,N.useState)(!1),c=()=>{m(!0),(0,ne.U6)()},a=()=>m(!1);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(O.$n,{icon:"edit",tooltip:`Edit ${o.label.toLowerCase()} using existing notification templates.`,onClick:c,variant:"secondary",size:"sm",children:`Edit ${o.label}`}),i&&(0,e.jsx)(pe._,{title:`Edit ${o.label}`,size:"md",onClose:a,children:(0,e.jsx)(Me,{onSelect:t,onClose:a,option:o,valueInForm:r})})]})}function Pe(t,o=[]){const r=new Map;return t.forEach(({content:i})=>{(0,w.D)(i).forEach(c=>{r.set(c.name,{label:c.name,value:{name:c.name,content:c.content}})})}),o.forEach(i=>{r.set(i.name,{label:i.name,value:{name:i.name,content:i.content}})}),Array.from(r.values())}function Me({onSelect:t,onClose:o,option:r,valueInForm:i}){const m=(0,E.of)(ce),c=!!i&&!(0,w.G7)(i),[a,p]=(0,N.useState)(void 0),[x,$]=(0,N.useState)(i),{selectedAlertmanager:y}=(0,ie.VI)(),{data:v=[],error:T,isLoading:A}=(0,je.cC)({alertmanager:y}),{data:V}=Re(),[Q,B]=(0,N.useState)(c?"Custom":"Existing"),[q,_]=(0,me.A)(),Z=[{label:"Select notification template",ariaLabel:"Select notification template",value:"Existing",description:`Select an existing notification template and preview it, or copy it to paste it in the custom tab. ${Q==="Existing"?"Clicking Save saves your changes to the selected template.":""}`},{label:`Enter custom ${r.label.toLowerCase()}`,ariaLabel:`Enter custom ${r.label.toLowerCase()}`,value:"Custom",description:`Enter custom ${r.label.toLowerCase()}. ${Q==="Custom"?"Clicking Save will save the custom value only.":""}`}];(0,N.useEffect)(()=>{a?.value?.name&&$((0,w.Jl)(a.value.name))},[a]);function ee(L){$(L)}const C=L=>{B(L)},W=(0,N.useMemo)(()=>!V||!v||A||T?[]:Pe(v,V),[v,V,A,T]),X=(0,N.useMemo)(()=>{if(!W.length||!i||!(0,w.G7)(i))return null;const L=(0,w.gY)(i);return W.find(de=>de.label===L)||null},[W,i]);return T?(0,e.jsx)("div",{children:(0,e.jsx)(s.x6,{i18nKey:"alerting.template-selector.error-loading-templates",children:"Error loading templates"})}):A||!v||!V?(0,e.jsx)("div",{children:(0,e.jsx)(s.x6,{i18nKey:"alerting.template-selector.loading",children:"Loading..."})}):(0,e.jsxs)(S.B,{direction:"column",gap:1,justifyContent:"space-between",height:"100%",children:[(0,e.jsxs)(S.B,{direction:"column",gap:1,children:[(0,e.jsx)(fe.z,{options:Z,value:Q,onChange:C,className:m.templateTabOption}),Q==="Existing"?(0,e.jsxs)(S.B,{direction:"column",gap:1,children:[(0,e.jsxs)(S.B,{direction:"row",gap:1,alignItems:"center",children:[(0,e.jsx)(Y.l6,{"data-testid":"existing-templates-selector",placeholder:(0,s.t)("alerting.template-selector.existing-templates-selector-placeholder-choose-notification-template","Choose notification template"),"aria-label":(0,s.t)("alerting.template-selector.existing-templates-selector-aria-label-choose-notification-template","Choose notification template"),onChange:(L,de)=>{p(L)},options:W,width:50,defaultValue:X}),(0,e.jsx)(ge.K,{tooltip:"Copy selected notification template to clipboard. You can use it in the custom tab.",onClick:()=>_(a?.value?.content??X?.value?.content??""),name:"copy"})]}),(0,e.jsx)(be,{templateContent:a?.value?.content??X?.value?.content??"",payload:ye.R_,templateName:a?.value?.name??X?.value?.name??"",setPayloadFormatError:()=>{},className:(0,f.cx)(m.templatePreview,m.minEditorSize),payloadFormatError:null})]}):(0,e.jsx)(Ae,{option:r,onCustomTemplateChange:ee,initialValue:x})]}),(0,e.jsxs)("div",{className:m.actions,children:[(0,e.jsx)(O.$n,{variant:"secondary",onClick:o,children:(0,e.jsx)(s.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(O.$n,{variant:"primary",onClick:()=>{if(Q==="Custom")(0,ne.t6)(),t(x);else{(0,ne.Cl)();const L=a?.value?.name??X?.value?.name??"";t((0,w.Jl)(L))}return o()},children:(0,e.jsx)(s.x6,{i18nKey:"common.save",children:"Save"})})]})]})}function Ae({option:t,onCustomTemplateChange:o,initialValue:r}){const i=`custom-template-${t.label}`;return(0,e.jsxs)(S.B,{direction:"column",gap:1,children:[(0,e.jsx)(xe.J,{htmlFor:i,children:(0,e.jsx)(s.x6,{i18nKey:"alerting.contact-points.custom-template-value",children:"Custom template value"})}),(0,e.jsx)(P.f,{id:i,label:(0,s.t)("alerting.option-customfield.label-custom-template","Custom template"),placeholder:t.placeholder,onChange:m=>o(m.currentTarget.value),defaultValue:r})]})}function oe({useTemplates:t,onSelectTemplate:o,option:r,name:i,children:m}){const c=(0,E.of)(ce),{getValues:a}=(0,b.xW)(),p=a(i)??"";return!r.placeholder.includes("{{ template ")||typeof p!="string"?(0,e.jsx)(e.Fragment,{children:m}):p?(p?(0,w.G7)(p):!1)?(0,e.jsx)("div",{className:c.inputContainer,children:(0,e.jsxs)(S.B,{direction:"row",gap:1,alignItems:"center",children:[(0,e.jsx)(ve.E,{variant:"bodySmall",children:`Template: ${(0,w.gY)(p)}`}),t&&(0,e.jsx)(ae,{onSelect:o,option:r,valueInForm:a(i)??""})]})}):(0,e.jsx)("div",{className:c.inputContainer,children:(0,e.jsxs)(S.B,{direction:"row",gap:1,alignItems:"center",children:[m,t&&(0,e.jsx)(ae,{onSelect:o,option:r,valueInForm:a(i)??""})]})}):(0,e.jsx)("div",{className:c.inputContainer,children:(0,e.jsx)(S.B,{direction:"row",gap:1,alignItems:"center",children:t&&(0,e.jsx)(ae,{onSelect:o,option:r,valueInForm:a(i)??""})})})}const ce=t=>({actions:(0,f.css)({flex:0,justifyContent:"flex-end",display:"flex",gap:t.spacing(1)}),templatePreview:(0,f.css)({flex:1,display:"flex"}),templateTabOption:(0,f.css)({width:"fit-content"}),minEditorSize:(0,f.css)({minHeight:300,minWidth:300}),inputContainer:(0,f.css)({marginTop:t.spacing(1.5)})}),le=({option:t,parentOption:o,invalid:r,pathPrefix:i,pathSuffix:m="",error:c,defaultValue:a,readOnly:p=!1,customValidator:x,onResetSecureField:$,secureFields:y={}})=>{const v=`${i}${m}`;return t.element==="subform"?(0,e.jsx)(ue,{secureFields:y,onResetSecureField:$,readOnly:p,defaultValue:a,option:t,errors:c,pathPrefix:v}):t.element==="subform_array"?(0,e.jsx)(se,{readOnly:p,defaultValues:a,option:t,pathPrefix:v,errors:c}):(0,e.jsx)(z.D,{label:t.element!=="checkbox"&&t.element!=="radio"?t.label:void 0,description:t.description||void 0,invalid:!!c,error:c?.message,"data-testid":`${v}${t.propertyName}`,children:(0,e.jsx)(Be,{id:`${v}${t.propertyName}`,defaultValue:a,option:t,invalid:r,pathPrefix:v,readOnly:p,pathIndex:i,parentOption:o,customValidator:x,onResetSecureField:$,secureFields:y})})},Be=({option:t,invalid:o,id:r,pathPrefix:i="",pathIndex:m="",readOnly:c=!1,customValidator:a,onResetSecureField:p,secureFields:x={},parentOption:$})=>{const y=(0,E.of)(Ie),{control:v,register:T,unregister:A,getValues:V,setValue:Q}=(0,b.xW)(),B=`${i}${t.propertyName}`,q=$?`${$.propertyName}.${t.propertyName}`:t.propertyName,_=x?.[q];(0,N.useEffect)(()=>()=>{A(B,{keepValue:!1})},[A,B]);const Z=t.placeholder.includes("{{ template");function ee(C){Q(B,C)}switch(t.element){case"checkbox":return(0,e.jsx)(R.S,{id:r,readOnly:c,disabled:c,className:y.checkbox,...T(B),label:t.label,description:t.description});case"input":return(0,e.jsx)(oe,{useTemplates:Z,option:t,name:B,onSelectTemplate:ee,children:_?(0,e.jsx)(G.L4,{onReset:()=>p?.(q),isConfigured:!0}):(0,e.jsx)(I.p,{id:r,readOnly:c||Z||Fe(t,V,m),invalid:o,type:t.inputType,...T(B,{required:De(t,V,m),validate:{validationRule:C=>t.validationRule?re(C,t.validationRule,t.required):!0,customValidator:C=>a?a(C):!0},setValueAs:t.setValueAs}),placeholder:t.placeholder})});case"select":return(0,e.jsx)(b.xI,{render:({field:{onChange:C,ref:W,...X}})=>(0,e.jsx)(Y.l6,{disabled:c,options:t.selectOptions??void 0,invalid:o,onChange:L=>C(L.value),...X}),control:v,name:B,defaultValue:t.defaultValue?.value,rules:{validate:{customValidator:C=>a?a(C):!0}}});case"radio":return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("legend",{className:y.legend,children:t.label}),(0,e.jsx)(b.xI,{render:({field:{ref:C,...W}})=>(0,e.jsx)(J.a,{disabled:c,options:t.selectOptions??[],...W}),control:v,defaultValue:t.defaultValue?.value,name:B,rules:{required:t.required?"Option is required":!1,validate:{validationRule:C=>t.validationRule?re(C,t.validationRule,t.required):!0,customValidator:C=>a?a(C):!0}}})]});case"textarea":return(0,e.jsx)(oe,{useTemplates:Z,option:t,name:B,onSelectTemplate:ee,children:_?(0,e.jsx)(D.lp,{onReset:()=>p?.(q),isConfigured:!0}):(0,e.jsx)(P.f,{id:r,readOnly:c||Z,invalid:o,placeholder:t.placeholder,...T(B,{required:t.required?"Required":!1,validate:C=>t.validationRule!==""?re(C,t.validationRule,t.required):!0})})});case"string_array":return(0,e.jsx)(b.xI,{render:({field:{value:C,onChange:W}})=>(0,e.jsx)(j,{readOnly:c,value:C,onChange:W}),control:v,name:B});case"key_value_map":return(0,e.jsx)(b.xI,{render:({field:{value:C,onChange:W}})=>(0,e.jsx)(d,{readOnly:c,value:C,onChange:W}),control:v,name:B});default:return console.error("Element not supported",t.element),null}},Ie=t=>({checkbox:(0,f.css)({height:"auto"}),legend:(0,f.css)({fontSize:t.typography.h6.fontSize})}),re=(t,o,r)=>t===""&&!r||RegExp(o).test(t)?!0:"Invalid format",De=(t,o,r)=>{const i=o(`${r}secureFields`),m=o(`${r}secureSettings`);return t.dependsOn?(0,F.isEmpty)(i)||!i[t.dependsOn]?!!!m[t.dependsOn]&&t.required?"Required":!1:!!!i[t.dependsOn]&&t.required?"Required":!1:t.required?"Required":!1},Fe=(t,o,r)=>t.dependsOn?(0,F.isEmpty)(o(`${r}secureFields`))?o(`${r}secureSettings.${t.dependsOn}`):o(`${r}secureFields.${t.dependsOn}`):!1},82203:(k,U,n)=>{n.d(U,{r:()=>b});var e=n(2543),f=n.n(e),F=n(96540);const N=[];function b(z){const{name:E,formAPI:R,defaults:G,softDelete:I}=z,{watch:Y,getValues:J,reset:D,setValue:P}=R,S=Y(E)??G??N,O=(0,F.useCallback)(s=>{const l=JSON.parse(JSON.stringify(J())),d=s(S??[]);D((0,e.set)(l,E,d))},[J,E,D,S]);return{fields:S,append:(0,F.useCallback)(s=>O(l=>[...l,s]),[O]),remove:(0,F.useCallback)(s=>{I?P(`${E}.${s}.__deleted`,!0):O(l=>{const d=l.slice();return d.splice(s,1),d})},[O,E,P,I])}}},22316:(k,U,n)=>{n.d(U,{FN:()=>P,Iq:()=>N,QX:()=>z,Xo:()=>F,bB:()=>b,qg:()=>J});var e=n(2543),f=n.n(e);function F(s,l){const d={};let u=1;return[{name:s.name,items:s.grafana_managed_receiver_configs?.map(h=>{const j=String(u++);d[j]=h;const M=l.find(({type:K})=>K===h.type);return I(j,h,M)})??[]},d]}function N(s,l){const d={};let u=1;const g=Object.entries(s).filter(([j])=>j.endsWith("_configs")&&j!=="grafana_managed_receiver_configs").map(([j,M])=>[j.replace("_configs",""),M]).map(([j,M])=>M.map(K=>{const H=String(u++);if(d[H]={type:j,config:K},!l.find(se=>se.type===j))throw new Error(`unknown cloud notifier: ${j}`);return G(H,j,K)})).flat();return[{name:s.name,items:g},d]}function b(s,l,d,u){return{name:s.name,grafana_managed_receiver_configs:(s.items??[]).map(g=>{const h=l[g.__id],j=u.find(M=>M.type===g.type);return J(g,d,s.name,h,j)})}}function z(s,l){const d={name:s.name};return s.items.forEach(({__id:u,type:g,settings:h,sendResolved:j})=>{const M=P({...O(h),send_resolved:j??l.sendResolved}),K=g==="jira"?E(M):M;`${g}_configs`in d?d[`${g}_configs`]?.push(K):d[`${g}_configs`]=[K]}),d}function E(s){const l=structuredClone(s);if(typeof l.fields=="object")for(const[d,u]of Object.entries(l.fields)){let g;try{g=JSON.parse(u)}catch{g=u}l.fields[d]=g}return l}function R(s){const l=structuredClone(s);if(typeof l.fields=="object")for(const[d,u]of Object.entries(l.fields)){let g;typeof u=="object"?g=JSON.stringify(u):g=u,l.fields[d]=g}return l}function G(s,l,d){return{__id:s,type:l,settings:{...l==="jira"?R(d):d},secureFields:{},secureSettings:{},sendResolved:d.send_resolved}}function I(s,l,d){const u={__id:s,type:l.type,provenance:l.provenance,secureSettings:{},settings:{...l.settings},secureFields:{...l.secureFields},disableResolveMessage:l.disableResolveMessage};return d?.options.forEach(g=>{g.secure&&u.settings[g.propertyName]&&(u.secureSettings[g.propertyName]=u.settings[g.propertyName],delete u.settings[g.propertyName])}),u}function Y(s){const l=[];function d(u,g){for(const h of u){const j=g?`${g}.${h.propertyName}`:h.propertyName;if(h.subformOptions){d(h.subformOptions,j);continue}if(h.secure){l.push(j);continue}}}return d(s.options),l}function J(s,l,d,u,g){const h={settings:P({...u&&u.type===s.type?u.settings??{}:{},...s.settings??{}}),secureSettings:S(s.secureSettings,u?.secureFields),type:s.type,name:d,disableResolveMessage:s.disableResolveMessage??u?.disableResolveMessage??l.disableResolveMessage},j=g?Y(g):[],M=(0,e.reduce)(j,(K={},H)=>(K[H]=(0,e.get)(h.settings,H)??(0,e.get)(s.secureFields,H),K),{});return h.secureSettings={...M,...h.secureSettings},h.settings=(0,e.omit)(h.settings,j),u&&(h.uid=u.uid),h}const D=s=>(0,e.isNil)(s)||s==="";function P(s){return(0,e.isArray)(s)?s.forEach(P):typeof s=="object"&&s!==null&&Object.entries(s).forEach(([l,d])=>{D(d)?delete s[l]:P(d)}),s}function S(s={},l={}){return(0,e.omitBy)(s,(d,u)=>D(d)&&!(0,e.has)(l,u))}function O(s){function l(u){(0,e.isArray)(u)?u.forEach(l):typeof u=="object"&&u!==null&&("__id"in u&&delete u.__id,Object.values(u).forEach(l))}const d=structuredClone(s);return l(d),d}}}]);

//# sourceMappingURL=6315.8ab070df1ccae1aace39.js.map