"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9119],{91087:(Z,E,e)=>{e.d(E,{y:()=>l});var s=e(74848),o=e(96540),T=e(41053),v=e(73427),P=e(96673),U=e(59812),x=e(12037);const l=({basicRole:y,roles:m,userId:d,orgId:i,onBasicRoleChange:g,roleOptions:f,disabled:L,basicRoleDisabled:h,basicRoleDisabledMessage:I,apply:O=!1,onApplyRoles:M,pendingRoles:C,maxWidth:K,width:u,isLoading:B})=>{const[{loading:Y,value:w=m||[]},W]=(0,T.A)(async()=>{try{if(m)return m;if(O&&C?.length)return C;if(v.TP.hasPermission(P.AccessControlAction.ActionUserRolesList)&&d>0)return await(0,x.Xh)(d,i)}catch{console.error("Error loading options")}return[]},[i,d,C,m]);(0,o.useEffect)(()=>{i&&W()},[W,i]);const n=async A=>{O?M&&M(A,d,i):(await(0,x.eA)(A,d,i),await W())},a=v.TP.hasPermission(P.AccessControlAction.ActionUserRolesAdd)&&v.TP.hasPermission(P.AccessControlAction.ActionUserRolesRemove);return(0,s.jsx)(U.n,{appliedRoles:w,basicRole:y,onRolesChange:n,onBasicRoleChange:g,roleOptions:f,isLoading:Y||B,disabled:L,basicRoleDisabled:h,basicRoleDisabledMessage:I,showBasicRole:!0,apply:O,canUpdateRoles:a,maxWidth:K,width:u})}},31908:(Z,E,e)=>{e.d(E,{I:()=>i});var s=e(74848),o=e(49785),T=e(47184),v=e(89640),P=e(8207),U=e(37386),x=e(77824),l=e(56840),y=e(96673);const m=Object.keys(y.OrgRole).map(T.z),d=(0,s.jsxs)(l.x6,{i18nKey:"role-picker.title.description",children:["Assign roles to users to ensure granular control over access to Grafana\u2018s features and resources. Find out more in our"," ",(0,s.jsx)(v.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/roles-and-permissions/#organization-roles",children:"documentation"}),"."]}),i=({onClose:g})=>{const f=(0,o.xW)(),{control:L,getValues:h,setValue:I}=f,[O,M]=h(["name","roles"]);return(0,s.jsx)(P._,{title:O,subtitle:d,onClose:g,children:(0,s.jsx)(U.D,{label:(0,l.t)("role-picker-drawer.basic-roles.label","Basic Roles"),children:(0,s.jsx)(o.xI,{name:"role",control:L,render:({field:{onChange:C,ref:K,...u}})=>(0,s.jsx)(x.z,{...u,options:m,onChange:B=>{I("roleCollection",[B,...M]),C(B)}})})})})}},88947:(Z,E,e)=>{e.r(E),e.d(E,{default:()=>W});var s=e(74848),o=e(96540),T=e(49785),v=e(54148),P=e(41053),U=e(34999),x=e(53487),l=e(37386),y=e(63527),m=e(45861),d=e(13791),i=e(73427),g=e(56840),f=e(96673),L=e(77527),h=e(68143),I=e(81871);const O=30,M=async n=>await(0,h.AI)().get(`/api/orgs/${n}`),C=async(n,a)=>i.TP.hasPermission(f.AccessControlAction.OrgUsersRead)?(0,h.AI)().get(`/api/orgs/${n}/users/search`,(0,I.F)({perpage:O,page:a})):{orgUsers:[]},K=async(n,a)=>{const A=a.map(j=>j.userId),S=await(0,h.AI)().post("/api/access-control/users/roles/search?includeMapped=true",{userIds:A,orgId:n});a.forEach(j=>{j.roles=S?S[j.userId]||[]:[]})},u=(n,a)=>(0,h.AI)().patch(`/api/orgs/${a}/users/${n.userId}`,n),B=(n,a)=>(0,h.AI)().delete(`/api/orgs/${a}/users/${n.userId}`),Y=(n,a)=>(0,h.AI)().put(`/api/orgs/${a}`,{name:n}),W=()=>{const{id:n=""}=(0,v.g)(),a=parseInt(n,10),A=i.TP.hasPermission(f.AccessControlAction.OrgsWrite),S=i.TP.hasPermission(f.AccessControlAction.OrgUsersRead),[j,q]=(0,o.useState)([]),[z,D]=(0,o.useState)(1),[c,N]=(0,o.useState)(1),[R,F]=(0,P.A)(()=>M(a),[]),{handleSubmit:G,register:$,formState:{errors:V}}=(0,T.mN)(),[,p]=(0,P.A)(async t=>{const r=await C(a,t);i.TP.licensedAccessControlEnabled()&&await K(a,r.orgUsers);const J=r?.perPage!==0?Math.ceil(r.totalCount/r.perPage):0;return N(J),q(r.orgUsers),r.orgUsers},[]);(0,o.useEffect)(()=>{F(),p(z)},[F,p,z]);const b=async({orgName:t})=>{await Y(t,a)},X=()=>(0,s.jsx)(U.F,{severity:"info",title:(0,g.t)("admin.admin-edit-org-page.render-missing-permission-message.title-access-denied","Access denied"),children:(0,s.jsx)(g.x6,{i18nKey:"admin.edit-org.access-denied",children:"You do not have permission to see users in this organization. To update this organization, contact your server administrator."})}),H=t=>{D(t)},k=async t=>{await B(t,a),p(z)},_=async(t,r)=>{await u({...r,role:t},a),p(z)},ee={text:R?.value?.name??"",icon:"shield",subTitle:"Manage settings and user roles for an organization."};return(0,s.jsx)(d.Y,{navId:"global-orgs",pageNav:ee,subTitle:"Manage settings for this specific org.",children:(0,s.jsx)(d.Y.Contents,{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.s,{children:(0,s.jsx)(g.x6,{i18nKey:"admin.edit-org.heading",children:"Edit Organization"})}),R.value&&(0,s.jsxs)("form",{onSubmit:G(b),style:{maxWidth:"600px"},children:[(0,s.jsx)(l.D,{label:(0,g.t)("admin.admin-edit-org-page.label-name","Name"),invalid:!!V.orgName,error:"Name is required",disabled:!A,children:(0,s.jsx)(y.p,{...$("orgName",{required:!0}),id:"org-name-input",defaultValue:R.value.name})}),(0,s.jsx)(m.$n,{type:"submit",disabled:!A,children:(0,s.jsx)(g.x6,{i18nKey:"admin.edit-org.update-button",children:"Update"})})]}),(0,s.jsxs)("div",{style:{marginTop:"20px"},children:[(0,s.jsx)(x.s,{children:(0,s.jsx)(g.x6,{i18nKey:"admin.edit-org.users-heading",children:"Organization users"})}),!S&&X(),S&&!!j.length&&(0,s.jsx)(L.b,{users:j,orgId:a,onRoleChange:_,onRemoveUser:k,changePage:H,page:z,totalPages:c})]})]})})})}},9390:(Z,E,e)=>{e.d(E,{r:()=>x});var s=e(74848),o=e(90382),T=e(18857),v=e(56840);const U=Object.values(o.X).filter(l=>l!==o.X.None).map(l=>({label:l,value:l}));function x({value:l,onChange:y,"aria-label":m,inputId:d,autoFocus:i,...g}){return(0,s.jsx)(T.l6,{inputId:d,value:l,options:U,onChange:f=>y(f.value??o.X.None),placeholder:(0,v.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":m,autoFocus:i,...g})}},77527:(Z,E,e)=>{e.d(E,{b:()=>z});var s=e(74848),o=e(96540),T=e(85629),v=e(43173),P=e(71555),U=e(66404),x=e(31286),l=e(45967),y=e(30703),m=e(94018),d=e(45861),i=e(41654),g=e(27594),f=e(34213),L=e(71599),h=e(91087),I=e(12037),O=e(22803),M=e(49785),C=e(63142),K=e(99887),u=e(56840),B=e(31908);const Y=({disabled:D,user:c})=>{const[N,R]=(0,o.useState)(!1),{badge:F,badgeDisabled:G}=(0,C.of)(w),$=D?G:F,V=(0,M.mN)({defaultValues:{name:c.name,role:c.role,roles:c.roles}}),{watch:p}=V,b=()=>{D||R(!0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i.B,{gap:1,children:[(0,s.jsx)(K.E,{className:$,color:"blue",onClick:b,text:p("role")}),c.roles&&c.roles.length>0&&(0,s.jsx)(K.E,{className:$,color:"blue",onClick:b,text:(0,u.t)("role-picker-drawer.user-count","+{{numUsers}}",{numUsers:c.roles.length})})]}),N&&(0,s.jsx)(M.Op,{...V,children:(0,s.jsx)(B.I,{onClose:()=>R(!1)})})]})};function w(D){return{badge:(0,O.css)({cursor:"pointer"}),badgeDisabled:(0,O.css)({cursor:"not-allowed"})}}var W=e(11297),n=e(73427),a=e(96673),A=e(9390);const S=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,j=D=>{const c=D?.isExternallySynced;return!n.TP.hasPermissionInMetadata(a.AccessControlAction.OrgUsersWrite,D)||c},q=T.Tp.pages.UserListPage.UsersListPage,z=({users:D,orgId:c,onRoleChange:N,onUserRolesChange:R,onRemoveUser:F,fetchData:G,changePage:$,page:V,totalPages:p,rolesLoading:b})=>{const[X,H]=(0,o.useState)(null),[k,_]=(0,o.useState)([]);(0,o.useEffect)(()=>{async function t(){try{if(n.TP.hasPermission(a.AccessControlAction.ActionRolesList)){let r=await(0,I.RL)(c);_(r)}}catch{console.error("Error loading options")}}n.TP.licensedAccessControlEnabled()&&t()},[c]);const ee=(0,o.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:t}})=>t&&(0,s.jsx)(P.e,{src:t,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:t}})=>(0,s.jsx)("div",{children:t}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:t}})=>t,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:t}})=>t,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:t}})=>(0,s.jsx)(s.Fragment,{children:t&&(0,s.jsx)(s.Fragment,{children:t==="10 years"?(0,s.jsx)(U.E,{color:"disabled",children:(0,s.jsx)(u.x6,{i18nKey:"admin.org-uers.last-seen-never",children:"Never"})}):t})}),sortType:(t,r)=>new Date(t.original.lastSeenAt).getTime()-new Date(r.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:t},row:{original:r}})=>{const J=j(r),se=async(Q,te,ae)=>{await(0,I.eA)(Q,te,ae),R&&R()};return v.$.featureToggles.rolePickerDrawer?(0,s.jsx)(Y,{disabled:J,user:r}):n.TP.licensedAccessControlEnabled()?(0,s.jsx)(h.y,{userId:r.userId,roles:r.roles,apply:!0,onApplyRoles:se,isLoading:b,orgId:c,roleOptions:k,basicRole:t,onBasicRoleChange:Q=>N(Q,r),basicRoleDisabled:J,basicRoleDisabledMessage:S,width:40}):(0,s.jsx)(A.r,{"aria-label":(0,u.t)("admin.org-users-table.columns.aria-label-role","Role"),value:t,disabled:J,onChange:Q=>N(Q,r)})}},{id:"info",header:"",cell:({row:{original:t}})=>j(t)&&(0,s.jsx)(x.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,s.jsx)(l.m,{interactive:!0,content:(0,s.jsx)("div",{children:(0,s.jsxs)(u.x6,{i18nKey:"admin.org-users.not-editable",children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,s.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,s.jsx)(y.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:t}})=>(0,s.jsx)(s.Fragment,{children:Array.isArray(t)&&t.length>0&&(0,s.jsx)(W.E,{label:t[0],removeIcon:!1,count:0})})},{id:"isProvisioned",header:"Provisioned",cell:({cell:{value:t}})=>(0,s.jsx)(s.Fragment,{children:t&&(0,s.jsx)(m.v,{colorIndex:14,name:"Provisioned"})})},{id:"isDisabled",header:"",cell:({cell:{value:t}})=>(0,s.jsx)(s.Fragment,{children:t&&(0,s.jsx)(m.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:t}})=>n.TP.hasPermissionInMetadata(a.AccessControlAction.OrgUsersRemove,t)&&(0,s.jsx)(d.$n,{size:"sm",variant:"destructive",onClick:()=>{H(t)},icon:"times","aria-label":(0,u.t)("admin.org-users-table.delete-aria-label","Delete user: {{name}}",{name:t.name})})}],[b,c,k,R,N]);return(0,s.jsxs)(i.B,{direction:"column",gap:2,"data-testid":q.container,children:[(0,s.jsx)(g.j,{columns:ee,data:D,getRowId:t=>String(t.userId),fetchData:G}),(0,s.jsx)(i.B,{justifyContent:"flex-end",children:(0,s.jsx)(f.d,{onNavigate:$,currentPage:V,numberOfPages:p,hideWhenSinglePage:!0})}),!!X&&(0,s.jsx)(L.u,{body:`Are you sure you want to delete user ${X?.login}?`,confirmText:"Delete",title:(0,u.t)("admin.org-users-table.title-delete","Delete"),onDismiss:()=>{H(null)},isOpen:!0,onConfirm:()=>{X&&(F(X),H(null))}})]})}}}]);

//# sourceMappingURL=AdminEditOrgPage.75c0e780117332147ba3.js.map