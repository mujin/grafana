"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4666],{30130:(he,Y,t)=>{t.d(Y,{D:()=>I});var e=t(74848),a=t(22803),V=t(63142),G=t(72636),W=t(41654);function I({label:j,actions:_,id:M}){const ee=(0,V.of)($);return(0,e.jsxs)("div",{className:ee.container,children:[(0,e.jsx)(G.J,{className:ee.label,id:M,children:j}),(0,e.jsx)(W.B,{direction:"row",gap:1,children:_})]})}const $=j=>({container:(0,a.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:j.spacing(1,2),backgroundColor:j.colors.background.secondary,borderBottom:`1px solid ${j.colors.border.medium}`}),label:(0,a.css)({margin:0})})},34666:(he,Y,t)=>{t.d(Y,{By:()=>xt,R_:()=>Se});var e=t(74848),a=t(22803),V=t(16172);function G(n,d,o){return(0,V.f)(n,-d,o)}const W=null;var I=t(61501),$=t(29407);function j(n,d,o){const s=(0,$.a)(n,o?.in);return s.setTime(s.getTime()+d*I.Cg),s}const _=null;var M=t(79197);function ee(n,d,o){return(0,M.A)(n,d*I.s0,o)}const Ae=null;function de(n,d,o){return ee(n,-d,o)}const Ce=null;var b=t(96540),te=t(49785),ge=t(42941),ne=t(70713),ce=t(36490),xe=t(68143),i=t(63142),f=t(93008),O=t(34999),T=t(31286),A=t(16780),g=t(41654),z=t(18027),se=t(63527),v=t(45861),U=t(88559),K=t(87063),ye=t(8207),ve=t(66404),Ie=t(64762),l=t(56840),Le=t(46787),Re=t(52161),je=t(77256),Ne=t(1972),Ke=t(49779),De=t(30130),me=t(40403),Fe=t(59243),We=t(50992),Ee=t(91793),Me=t(30703),Ue=t(45967),Ve=t(94018),ue=t(22787),ze=t(12737),Oe=t(6975),Ge=t(91984),le=t(39659),Te=t(19161);function $e({onSelect:n,isOpen:d,onClose:o}){const s=(0,i.of)(Je),[m,P]=(0,b.useState)(),[p,N]=(0,b.useState)(null),{useGetAlertmanagerAlertsQuery:J}=Ge.m,{currentData:w=[],isFetching:S,isError:B}=J({amSourceName:Re.hY,filter:{inhibited:!0,silenced:!0,active:!0}}),[R,H]=(0,b.useState)(""),D=(0,b.useMemo)(()=>{const c={};return!S&&w&&w.forEach(r=>{c[r.labels.alertname]||(c[r.labels.alertname]=[]);const h=Object.fromEntries(Object.entries(r.annotations).filter(([F])=>!F.startsWith("__"))),L=Object.fromEntries(Object.entries(r.labels).filter(([F])=>!F.startsWith("__")));r={...r,annotations:h,labels:L},c[r.labels.alertname].push(r)}),c},[S,w]),C=(0,b.useCallback)(c=>{P(c),N(null)},[]),y=(0,b.useMemo)(()=>{const c=Object.keys(D).filter(h=>h.toLowerCase().includes(R.toLowerCase())),r={};return c.forEach(h=>{r[h]=D[h]}),r},[D,R]);if(B)return null;const u=Object.keys(y||[]),x=({index:c,style:r})=>{if(!y)return null;const h=u[c],L=h===m;return(0,e.jsxs)("button",{type:"button",title:h,style:r,className:(0,a.cx)(s.rowButton,{[s.rowOdd]:c%2===1,[s.rowSelected]:L}),onClick:()=>C(h),children:[(0,e.jsx)("div",{className:(0,a.cx)(s.ruleTitle,s.rowButtonTitle),children:h}),(0,e.jsxs)("div",{className:s.alertFolder,children:[(0,e.jsx)(Me.I,{name:"folder"})," ",y[h][0].labels.grafana_folder??""]})]})},k=(c,r)=>{const L=c.map(q=>q.labels).map(le.Dd),F=(0,Te.Q)(L),X=(0,Te.$)((0,le.Dd)(r.labels),F);return X.length?(0,le.M4)((0,le.zm)(X)):(0,le.M4)(r.labels)},oe=({index:c,style:r})=>{const h=(0,b.useMemo)(()=>m?D[m]:[],[]),L=h[c],F=p?.includes(L),X=(0,b.useMemo)(()=>k(h,L),[h,L]),fe=()=>{if(F&&p){N(p.filter(q=>q!==L));return}N([...p||[],L])};return(0,e.jsx)("button",{type:"button",style:r,className:(0,a.cx)(s.rowButton,s.instanceButton,{[s.rowOdd]:c%2===1,[s.rowSelected]:F}),onClick:fe,children:(0,e.jsx)("div",{className:s.rowButtonTitle,title:L.labels.alertname,children:(0,e.jsx)(Ue.m,{placement:"bottom",content:(0,e.jsx)("pre",{children:JSON.stringify(L,null,2)}),theme:"info",children:(0,e.jsx)("div",{children:X.map((q,E)=>(0,e.jsx)(Ve.v,{name:q,className:s.tag},E))})})})})},ae=()=>{const c=p?.map(r=>({status:"firing",annotations:r.annotations,labels:r.labels,startsAt:r.startsAt,endsAt:r.endsAt,generatorURL:r.generatorURL,fingerprint:r.fingerprint}))||[];n(c),Q()},Q=()=>{P(void 0),N(null),H(""),pe("")},re=()=>{Q(),o()},pe=c=>{H(c)};return(0,e.jsx)("div",{children:(0,e.jsxs)(ue.a,{title:(0,l.t)("alerting.alert-instance-modal-selector.title-select-alert-instances","Select alert instances"),className:s.modal,closeOnEscape:!0,isOpen:d,onDismiss:re,contentClassName:s.modalContent,children:[(0,e.jsxs)("div",{className:s.container,children:[(0,e.jsx)(ze.Z,{value:R,onChange:pe,title:(0,l.t)("alerting.alert-instance-modal-selector.title-search-alert-rule","Search alert rule"),placeholder:(0,l.t)("alerting.alert-instance-modal-selector.placeholder-search-alert-rule","Search alert rule"),autoFocus:!0}),(0,e.jsx)("div",{children:m&&"Select one or more instances from the list below"||""}),(0,e.jsxs)("div",{className:s.column,children:[S&&(0,e.jsx)(Oe._,{text:(0,l.t)("alerting.alert-instance-modal-selector.text-loading-rules","Loading rules..."),className:s.loadingPlaceholder}),!S&&(0,e.jsx)(ne.default,{children:({height:c,width:r})=>(0,e.jsx)(Ee.Y1,{itemSize:50,height:c,width:r,itemCount:u.length,children:x})})]}),(0,e.jsxs)("div",{className:s.column,children:[!m&&!S&&(0,e.jsx)("div",{className:s.selectedRulePlaceholder,children:(0,e.jsx)("div",{children:"Select an alert rule to get a list of available firing instances"})}),S&&(0,e.jsx)(Oe._,{text:(0,l.t)("alerting.alert-instance-modal-selector.text-loading-rule","Loading rule..."),className:s.loadingPlaceholder}),m&&D[m].length&&!S&&(0,e.jsx)(ne.default,{children:({width:c,height:r})=>(0,e.jsx)(Ee.Y1,{itemSize:32,height:r,width:c,itemCount:D[m].length||0,children:oe})})]})]}),(0,e.jsxs)(ue.a.ButtonRow,{children:[(0,e.jsx)(v.$n,{type:"button",variant:"secondary",onClick:re,children:(0,e.jsx)(l.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,e.jsx)(v.$n,{type:"button",variant:"primary",disabled:!(m&&p),onClick:()=>{m&&p&&ae()},children:(0,e.jsx)(l.x6,{i18nKey:"alerting.alert-instance-modal-selector.add-alert-data-to-payload",children:"Add alert data to payload"})})]})]})})}const Je=n=>{const d=(0,v.my)(n);return{container:(0,a.css)({display:"grid",gridTemplateColumns:"1fr 1.5fr",gridTemplateRows:"min-content auto",gap:n.spacing(2),flex:1}),tag:(0,a.css)({margin:"5px"}),column:(0,a.css)({flex:"1 1 auto"}),alertLabels:(0,a.css)({overflowX:"auto",height:"32px"}),ruleTitle:(0,a.css)({height:"22px",fontWeight:n.typography.fontWeightBold}),rowButton:(0,a.css)(d,{padding:n.spacing(.5),overflow:"hidden",textOverflow:"ellipsis",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer",border:"2px solid transparent","&:disabled":{cursor:"not-allowed",color:n.colors.text.disabled}}),rowButtonTitle:(0,a.css)({overflowX:"auto"}),rowSelected:(0,a.css)({borderColor:n.colors.primary.border}),rowOdd:(0,a.css)({backgroundColor:n.colors.background.secondary}),instanceButton:(0,a.css)({display:"flex",gap:n.spacing(1),justifyContent:"space-between",alignItems:"center"}),loadingPlaceholder:(0,a.css)({height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),selectedRulePlaceholder:(0,a.css)({width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",fontWeight:n.typography.fontWeightBold}),modal:(0,a.css)({height:"100%"}),modalContent:(0,a.css)({flex:1,display:"flex",flexDirection:"column"}),modalAlert:(0,a.css)({flexGrow:0}),warnIcon:(0,a.css)({fill:n.colors.warning.main}),labels:(0,a.css)({justifyContent:"flex-start"}),alertFolder:(0,a.css)({height:"20px",fontSize:n.typography.bodySmall.fontSize,color:n.colors.text.secondary,display:"flex",flexDirection:"row",justifyContent:"flex-start",columnGap:n.spacing(1),alignItems:"center"})}},He=[{name:"Receiver",type:"string",notes:"Name of the contact point that the notification is being sent to."},{name:"Status",type:"string",notes:"firing if at least one alert is firing, otherwise resolved"},{name:"Alerts",type:"[]Alert",notes:"List of alert objects that are included in this notification."},{name:"Alerts.Firing",type:"[]Alert",notes:"List of firing alerts"},{name:"Alerts.Resolved",type:"[]Alert",notes:"List of resolved alerts"},{name:"GroupLabels",type:"KeyValue",notes:"Labels these alerts were grouped by."},{name:"CommonLabels",type:"KeyValue",notes:"Labels common to all the alerts included in this notification."},{name:"CommonAnnotations",type:"KeyValue",notes:"Annotations common to all the alerts included in this notification."},{name:"ExternalURL",type:"string",notes:"Back link to the Grafana that sent the notification."}],ke=[{name:"labels",type:"Object{}",notes:"Set of labels attached to the alert."},{name:"annotations",type:"Object{}",notes:"Set of annotations attached to the alert."},{name:"startsAt",type:"string (ISO8601)",notes:"Time the alert started firing."},{name:"endsAt",type:"string (ISO8601)",notes:"Time the alert ends firing."}],Ze=[{name:"Status",type:"string",notes:"firing or resolved."},{name:"Labels",type:"KeyValue",notes:"Set of labels attached to the alert."},{name:"Annotations",type:"KeyValue",notes:"Set of annotations attached to the alert."},{name:"Values",type:"KeyValue",notes:"The values of all instant queries, reduce and math expressions, and classic conditions for the alert. It does not contain time series data."},{name:"StartsAt",type:"time.Time",notes:"Time the alert started firing."},{name:"EndsAt",type:"time.Time",notes:"Only set if the end time of an alert is known. Otherwise set to a configurable timeout period from the time since the last alert was received."},{name:"GeneratorURL",type:"string",notes:"A back link to Grafana or external Alertmanager."},{name:"SilenceURL",type:"string",notes:"Link to Grafana silence for with labels for this alert pre-filled. Only for Grafana managed alerts."},{name:"DashboardURL",type:"string",notes:"Link to Grafana dashboard, if alert rule belongs to one. Only for Grafana managed alerts."},{name:"PanelURL",type:"string",notes:"Link to Grafana dashboard panel, if alert rule belongs to one. Only for Grafana managed alerts."},{name:"Fingerprint",type:"string",notes:"Fingerprint that can be used to identify the alert."},{name:"ValueString",type:"string",notes:"String that contains the labels and value of each reduced expression in the alert."}],Ye=[{name:"SortedPairs",returns:"KeyValue",notes:"Returns sorted list of key & value string pairs"},{name:"Remove",args:"[]string",returns:"KeyValue",notes:"Returns a copy of the Key/Value map without the given keys."},{name:"Names",returns:"[]string",notes:"List of label names"},{name:"Values",returns:"[]string",notes:"List of label values"}],Qe=`{
  "summary": "alert summary",
  "description": "alert description"
}
`;var Pe=t(38055);function Xe(){const n=(0,i.of)(qe),d=(0,e.jsx)(be,{caption:(0,e.jsxs)("h4",{className:n.header,children:["Alert template data ",(0,e.jsx)("span",{children:"Available only when in the context of an Alert (e.g. inside .Alerts loop)"})]}),dataItems:Ze});return(0,e.jsx)(g.B,{gap:2,children:(0,e.jsx)(be,{caption:(0,e.jsxs)("h4",{className:n.header,children:["Notification template data ",(0,e.jsx)("span",{children:"Available in the context of a notification."})," "]}),dataItems:He,typeRenderer:o=>o==="[]Alert"?(0,e.jsx)(Pe.B,{content:d,children:(0,e.jsx)("div",{className:n.interactiveType,children:o})}):o==="KeyValue"?(0,e.jsx)(Pe.B,{content:(0,e.jsx)(_e,{}),children:(0,e.jsx)("div",{className:n.interactiveType,children:o})}):o})})}const qe=n=>({header:(0,a.css)({color:n.colors.text.primary,span:{color:n.colors.text.secondary,fontSize:n.typography.bodySmall.fontSize}}),interactiveType:(0,a.css)({color:n.colors.text.link})});function be({dataItems:n,caption:d,typeRenderer:o}){const s=(0,i.of)(we);return(0,e.jsxs)("table",{className:s.table,children:[d&&(0,e.jsx)("caption",{children:d}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.template-data-table.name",children:"Name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.template-data-table.type",children:"Type"})}),(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.template-data-table.notes",children:"Notes"})})]})}),(0,e.jsx)("tbody",{children:n.map(({name:m,type:P,notes:p},N)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:m}),(0,e.jsx)("td",{children:o?o(P):P}),(0,e.jsx)("td",{children:p})]},N))})]})}function _e(){const n=(0,i.of)(we);return(0,e.jsxs)("div",{children:["KeyValue is a set of key/value string pairs that represent labels and annotations.",(0,e.jsx)("pre",{children:(0,e.jsx)("code",{children:Qe})}),(0,e.jsxs)("table",{className:n.table,children:[(0,e.jsx)("caption",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.key-value-template-data-table.keyvalue-methods",children:"Key-value methods"})}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.key-value-template-data-table.name",children:"Name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.key-value-template-data-table.arguments",children:"Arguments"})}),(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.key-value-template-data-table.returns",children:"Returns"})}),(0,e.jsx)("th",{children:(0,e.jsx)(l.x6,{i18nKey:"alerting.key-value-template-data-table.notes",children:"Notes"})})]})}),(0,e.jsx)("tbody",{children:Ye.map(({name:d,args:o,returns:s,notes:m})=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:d}),(0,e.jsx)("td",{children:o}),(0,e.jsx)("td",{children:s}),(0,e.jsx)("td",{children:m})]},d))})]})]})}const we=n=>({table:(0,a.css)({borderCollapse:"collapse",width:"100%",caption:{captionSide:"top"},"td, th":{padding:n.spacing(1,1)},thead:{fontWeight:n.typography.fontWeightBold},"tbody tr:nth-child(2n + 1)":{backgroundColor:n.colors.background.secondary},"tbody td:nth-child(1)":{fontWeight:n.typography.fontWeightBold},"tbody td:nth-child(2)":{fontStyle:"italic"}})});var et=t(2543),tt=t(8073),nt=t(77824),at=t(25471),st=t(8402);const lt={annotations:[{key:"",value:""}],labels:[{key:"",value:""}],status:"firing"},ot=({isOpen:n,onDismiss:d,onAccept:o})=>{const s=(0,i.of)(rt),[m,P]=(0,b.useState)([]),p=(0,te.mN)({defaultValues:lt,mode:"onBlur"}),N=p.watch("annotations"),J=p.watch("labels"),[w,S]=(0,b.useState)("firing"),B=()=>{const C={annotations:N.filter(({key:y,value:u})=>!!y&&!!u).reduce((y,{key:u,value:x})=>({...y,[u]:x}),{}),labels:J.filter(({key:y,value:u})=>!!y&&!!u).reduce((y,{key:u,value:x})=>({...y,[u]:x}),{}),startsAt:"2023-04-01T00:00:00Z",endsAt:w==="firing"?(0,V.f)(new Date,1).toISOString():G(new Date,1).toISOString(),status:w,fingerprint:(0,et.uniqueId)("fingerprint_")};P(y=>[...y,C]),p.reset()},R=()=>{o(m),P([]),p.reset(),S("firing")},H=()=>{const C=J.some(u=>u.key!==""&&u.value!==""),y=N.some(u=>u.key!==""&&u.value!=="");return C||y},D=[{label:"Firing",value:"firing"},{label:"Resolved",value:"resolved"}];return(0,e.jsx)(ue.a,{onDismiss:d,isOpen:n,title:(0,l.t)("alerting.generate-alert-data-modal.title-add-custom-alerts","Add custom alerts"),children:(0,e.jsx)(te.Op,{...p,children:(0,e.jsxs)("form",{onSubmit:C=>{C.preventDefault(),C.stopPropagation(),p.reset(),S("firing")},children:[(0,e.jsx)(tt.Z,{children:(0,e.jsxs)(g.B,{direction:"column",gap:1,children:[(0,e.jsx)("div",{className:s.section,children:(0,e.jsx)(at.A,{})}),(0,e.jsx)("div",{className:s.section,children:(0,e.jsx)(st.Ay,{})}),(0,e.jsxs)("div",{className:s.flexWrapper,children:[(0,e.jsx)(nt.z,{value:w,options:D,onChange:C=>S(C)}),(0,e.jsx)(v.$n,{onClick:B,className:s.onAddButton,icon:"plus-circle",type:"button",variant:"secondary",disabled:!H(),children:(0,e.jsx)(l.x6,{i18nKey:"alerting.generate-alert-data-modal.add-alert-data",children:"Add alert data"})})]})]})}),(0,e.jsx)("div",{className:s.onSubmitWrapper}),m.length>0&&(0,e.jsxs)(g.B,{direction:"column",gap:1,children:[(0,e.jsx)("h5",{children:(0,e.jsxs)(l.x6,{i18nKey:"alerting.generate-alert-data-modal.review-alert-payload",children:[" ","Review alert data to add to the payload:"]})}),(0,e.jsx)("pre",{className:s.result,"data-testid":"payloadJSON",children:JSON.stringify(m,null,2)})]}),(0,e.jsx)("div",{className:s.onSubmitWrapper,children:(0,e.jsx)(ue.a.ButtonRow,{children:(0,e.jsx)(v.$n,{onClick:R,disabled:m.length===0,className:s.onSubmitButton,children:(0,e.jsx)(l.x6,{i18nKey:"alerting.generate-alert-data-modal.add-alert-data-to-payload",children:"Add alert data to payload"})})})})]})})})},rt=n=>({section:(0,a.css)({marginBottom:n.spacing(2)}),onAddButton:(0,a.css)({flex:"none",width:"fit-content",paddingRight:n.spacing(1),marginLeft:"auto"}),flexWrapper:(0,a.css)({display:"flex",flexDirection:"row",justifyContent:"space-between"}),onSubmitWrapper:(0,a.css)({display:"flex",flexDirection:"row",alignItems:"baseline",justifyContent:"flex-end"}),onSubmitButton:(0,a.css)({marginLeft:n.spacing(2)}),result:(0,a.css)({width:"570px",height:"363px"})}),it="Reset to defaults";function dt({payload:n,setPayload:d,defaultPayload:o,setPayloadFormatError:s,payloadFormatError:m,className:P}){const p=(0,i.of)(mt),N=()=>{d(o)},[J,w]=(0,b.useState)(!1),S=()=>{w(!1)},B=m!==null,R=()=>{try{const x=JSON.parse(n);JSON.stringify([...x]),s(null)}catch(x){throw s(x instanceof Error?x.message:"Invalid JSON."),x}},H=()=>{try{R(),w(!0)}catch{}},D=()=>{try{R(),u(!0)}catch{}},C=x=>{S(),u(!1),d(k=>{const oe=JSON.parse(k);return JSON.stringify([...oe,...x],void 0,2)})},[y,u]=(0,b.useState)(!1);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:(0,a.cx)(p.wrapper,P),children:[(0,e.jsx)(De.D,{label:(0,l.t)("alerting.payload-editor.label-payload","Payload"),actions:(0,e.jsxs)(g.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(U.m,{overlay:(0,e.jsxs)(K.W,{children:[(0,e.jsx)(K.W.Item,{label:(0,l.t)("alerting.payload-editor.label-use-existing-alert-instances","Use existing alert instances"),disabled:B,onClick:D}),(0,e.jsx)(K.W.Item,{label:(0,l.t)("alerting.payload-editor.label-add-custom-alert-instance","Add custom alert instance"),disabled:B,onClick:H}),(0,e.jsx)(K.W.Divider,{}),(0,e.jsx)(K.W.Item,{label:it,onClick:N,destructive:!0})]}),children:(0,e.jsx)(v.$n,{variant:"secondary",size:"sm",icon:"angle-down",children:(0,e.jsx)(l.x6,{i18nKey:"alerting.payload-editor.edit-payload",children:"Edit payload"})})}),(0,e.jsx)(Fe.G,{content:(0,e.jsx)(ct,{}),placement:"top",fitContent:!0,children:(0,e.jsx)(v.$n,{variant:"secondary",fill:"outline",size:"sm",icon:"question-circle",children:(0,e.jsx)(l.x6,{i18nKey:"alerting.payload-editor.reference",children:"Reference"})})})]})}),(0,e.jsx)("div",{className:p.editorWrapper,children:(0,e.jsx)(ne.default,{children:({width:x,height:k})=>(0,e.jsx)(We.B,{containerStyles:p.editorContainer,width:x,height:k,language:"json",showLineNumbers:!0,showMiniMap:!1,value:n,readOnly:!1,onBlur:d,monacoOptions:{scrollBeyondLastLine:!1}})})})]}),(0,e.jsx)(ot,{isOpen:J,onDismiss:S,onAccept:C}),(0,e.jsx)($e,{onSelect:C,isOpen:y,onClose:()=>u(!1)})]})}const ct=()=>(0,e.jsx)(be,{dataItems:ke}),mt=n=>({wrapper:(0,a.css)({display:"flex",flexDirection:"column",height:"100%"}),tooltip:(0,a.css)({paddingLeft:n.spacing(1)}),label:(0,a.css)({margin:0}),editorWrapper:(0,a.css)({flex:1}),editorContainer:(0,a.css)({width:"fit-content",border:"none"}),templateDataDocsHeader:(0,a.css)({color:n.colors.text.primary,span:{color:n.colors.text.secondary,fontSize:n.typography.bodySmall.fontSize}})}),ut=[{description:"Default templates for notification titles",example:`{{- /* This is a copy of the "default.title" template. */ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "default.title.copy" }}
  [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ if gt (.Alerts.Resolved | len) 0 }}, RESOLVED:{{ .Alerts.Resolved | len }}{{ end }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}
{{ end }}`},{description:"Default templates for notification messages",example:`{{- /* This is a copy of the "default.message" template. */ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "default.message.copy" }}{{ if gt (len .Alerts.Firing) 0 }}**Firing**
{{ template "__text_alert_list.copy" .Alerts.Firing }}{{ if gt (len .Alerts.Resolved) 0 }}

{{ end }}{{ end }}{{ if gt (len .Alerts.Resolved) 0 }}**Resolved**
{{ template "__text_alert_list.copy" .Alerts.Resolved }}{{ end }}{{ end }}

{{ define "__text_alert_list.copy" }}{{ range . }}
Value: {{ template "__text_values_list.copy" . }}
Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}{{ if gt (len .GeneratorURL) 0 }}Source: {{ .GeneratorURL }}
{{ end }}{{ if gt (len .SilenceURL) 0 }}Silence: {{ .SilenceURL }}
{{ end }}{{ if gt (len .DashboardURL) 0 }}Dashboard: {{ .DashboardURL }}
{{ end }}{{ if gt (len .PanelURL) 0 }}Panel: {{ .PanelURL }}
{{ end }}{{ end }}{{ end }}

{{ define "__text_values_list.copy" }}{{ if len .Values }}{{ $first := true }}{{ range $refID, $value := .Values -}}
{{ if $first }}{{ $first = false }}{{ else }}, {{ end }}{{ $refID }}={{ $value }}{{ end -}}
{{ else }}[no value]{{ end }}{{ end }}`},{description:"Print alerts with summary and description",example:`{{- /* Example displaying the summary and description annotations of each alert in the notification. */ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.alerts" -}}
{{ len .Alerts }} alert(s)
{{ range .Alerts -}}
  {{ template "alert.summary_and_description" . -}}
{{ end -}}
{{ end -}}

{{ define "alert.summary_and_description" }}
  Summary: {{.Annotations.summary}}
  Status: {{ .Status }}
  Description: {{.Annotations.description}}
{{ end -}}`},{description:"Print firing and resolved alerts",example:`{{- /* Example displaying firing and resolved alerts separately in the notification. */ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.firing_and_resolved_alerts" -}}
{{ len .Alerts.Resolved }} resolved alert(s)
{{ range .Alerts.Resolved -}}
  {{ template "alert.summary_and_description" . -}}
{{ end }}
{{ len .Alerts.Firing }} firing alert(s)
{{ range .Alerts.Firing -}}
  {{ template "alert.summary_and_description" . -}}
{{ end -}}
{{ end -}}

{{ define "alert.summary_and_description" }}
  Summary: {{.Annotations.summary}}
  Status: {{ .Status }}
  Description: {{.Annotations.description}}
{{ end -}}`},{description:"Print common labels and annotations",example:`{{- /* Example displaying labels and annotations that are common to all alerts in the notification.*/ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.common_labels_and_annotations" -}}
{{ len .Alerts.Resolved }} resolved alert(s)
{{ len .Alerts.Firing }} firing alert(s)

Common labels: {{ len .CommonLabels.SortedPairs }}
{{ range .CommonLabels.SortedPairs -}}
- {{ .Name }} = {{ .Value }}
{{ end }}

Common annotations: {{ len .CommonAnnotations.SortedPairs }}
{{ range .CommonAnnotations.SortedPairs }}
- {{ .Name }} = {{ .Value }}
{{ end }}

{{ end -}}`},{description:"Print individual labels and annotations",example:`{{- /* Example displaying all labels and annotations for each alert in the notification.*/ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.alert_labels_and_annotations" -}}
{{ len .Alerts.Resolved }} resolved alert(s)
{{ range .Alerts.Resolved -}}
  {{ template "alert.labels_and_annotations" . -}}
{{ end }}
{{ len .Alerts.Firing }} firing alert(s)
{{ range .Alerts.Firing -}}
  {{ template "alert.labels_and_annotations" . -}}
{{ end -}}
{{ end -}}

{{ define "alert.labels_and_annotations" }}
Alert labels: {{ len .Labels.SortedPairs }}
{{ range .Labels.SortedPairs -}}
- {{ .Name }} = {{ .Value }}
{{ end -}}
Alert annotations: {{ len .Annotations.SortedPairs }}
{{ range .Annotations.SortedPairs -}}
- {{ .Name }} = {{ .Value }}
{{ end -}}
{{ end -}}`},{description:"Print URLs for runbook and alert data in Grafana",example:`{{- /* Example displaying additional information, such as runbook link, DashboardURL and SilenceURL, for each alert in the notification.*/ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{ define "custom.alert_additional_details" -}}
{{ len .Alerts.Resolved }} resolved alert(s)
{{ range .Alerts.Resolved -}}
  {{ template "alert.additional_details" . -}}
{{ end }}
{{ len .Alerts.Firing }} firing alert(s)
{{ range .Alerts.Firing -}}
  {{ template "alert.additional_details" . -}}
{{ end -}}
{{ end -}}

{{ define "alert.additional_details" }}
- Dashboard: {{ .DashboardURL }}
- Panel: {{ .PanelURL }}
- AlertGenerator: {{ .GeneratorURL }}
- Silence: {{ .SilenceURL }}
- RunbookURL: {{ .Annotations.runbook_url}}
{{ end -}}`},{description:"Create JSON payload for webhook contact point",example:`{{- /* Example displaying a custom JSON payload for a webhook contact point.*/ -}}
{{- /* Edit the template name and template content as needed. */ -}}
{{- /* Variables defined in the webhook contact point can be accessed in .Vars but will not be previewable. */ -}}
{{ define "webhook.custom.payload" -}}
  {{ coll.Dict
  "receiver" .Receiver
  "status" .Status
  "alerts" (tmpl.Exec "webhook.custom.simple_alerts" .Alerts | data.JSON)
  "groupLabels" .GroupLabels
  "commonLabels" .CommonLabels
  "commonAnnotations" .CommonAnnotations
  "externalURL" .ExternalURL
  "version" "1"
  "orgId"  (index .Alerts 0).OrgID
  "truncatedAlerts"  .TruncatedAlerts
  "groupKey" .GroupKey
  "state"  (tmpl.Inline "{{ if eq .Status \\"resolved\\" }}ok{{ else }}alerting{{ end }}" . )
  "allVariables"  .Vars
  "title" (tmpl.Exec "default.title" . )
  "message" (tmpl.Exec "default.message" . )
  | data.ToJSONPretty " "}}
{{- end }}

{{- /* Example showcasing embedding json templates in other json templates. */ -}}
{{ define "webhook.custom.simple_alerts" -}}
  {{- $alerts := coll.Slice -}}
  {{- range . -}}
    {{ $alerts = coll.Append (coll.Dict
    "status" .Status
    "labels" .Labels
    "startsAt" .StartsAt
    "endsAt" .EndsAt
    ) $alerts}}
  {{- end -}}
  {{- $alerts | data.ToJSON -}}
{{- end }}`}];var pt=t(1332),ft=t(64179),ht=t(32443);const gt=Object.freeze({title:"",content:""}),bt=n=>n.pathname.endsWith("/duplicate"),xt=({originalTemplate:n,prefill:d,alertmanager:o})=>{const s=(0,i.of)(Be),m=(0,Ie._2)(),[P,{error:p}]=(0,me.xW)({alertmanager:o}),[N,{error:J}]=(0,me.A1)({alertmanager:o}),{titleIsUnique:w}=(0,me.lx)({alertmanager:o,originalTemplate:n}),S=(0,b.useRef)(null),B=o===Re.hY,R=J??p,[H,D]=(0,ge.A)(!1),[C,y]=(0,b.useState)(Se),[u,x]=(0,b.useState)(null),{isProvisioned:k}=(0,me.OA)(n),oe=n?{title:n.title,content:n.content}:void 0,ae=(0,f.h)({direction:"column",initialSize:B?.5:1,dragPosition:"middle"}),Q=(0,f.h)({direction:"row",initialSize:B?.6:1,dragPosition:"middle"}),re=(0,te.mN)({mode:"onSubmit",defaultValues:d??oe??gt}),{handleSubmit:pe,register:c,formState:{errors:r,isSubmitting:h},getValues:L,setValue:F,watch:X}=re,fe=async E=>{const Z=(0,je.nL)("/alerting/notifications",o,{tab:Le.ActiveTab.NotificationTemplates});try{n?await N.execute({template:n,patch:E}):await P.execute({templateValues:E}),m.success("Template saved",`Template ${E.title} has been saved`),ce.Ny.push(Z)}catch(ie){m.error("Error saving template",(0,je.JZ)(ie))}},q=E=>{const Z=L("content"),ie=Z?`${Z}
${E}`:E;F("content",ie)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(te.Op,{...re,children:(0,e.jsxs)("form",{onSubmit:pe(fe),ref:S,className:s.form,"aria-label":(0,l.t)("alerting.template-form.aria-label-template-form","Template form"),children:[R&&(0,e.jsx)(O.F,{severity:"error",title:(0,l.t)("alerting.template-form.title-error-saving-template","Error saving template"),children:R.message||(0,xe.NF)(R)&&R.data?.message||String(R)}),k&&(0,e.jsx)(T.a,{grow:0,children:(0,e.jsx)(Ne.Yi,{resource:Ne.hk.Template})}),(0,e.jsx)(A.n,{disabled:k,className:s.fieldset,children:(0,e.jsxs)(g.B,{direction:"column",gap:1,alignItems:"stretch",minHeight:"100%",children:[(0,e.jsxs)(g.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(z.I,{label:(0,l.t)("alerting.template-form.label-template-group-name","Template group name"),error:r?.title?.message,invalid:!!r.title?.message,required:!0,children:(0,e.jsx)(se.p,{...c("title",{required:{value:!0,message:"Required."},validate:{titleIsUnique:w}}),placeholder:(0,l.t)("alerting.template-form.new-template-name-placeholder-give-your-template-group-a-name","Give your template group a name"),width:42,autoFocus:!0,id:"new-template-name"})}),(0,e.jsx)(Ke.h,{}),(0,e.jsxs)(g.B,{children:[(0,e.jsx)(v.$n,{onClick:()=>S.current?.requestSubmit(),variant:"primary",disabled:h,children:(0,e.jsx)(l.x6,{i18nKey:"common.save",children:"Save"})}),(0,e.jsx)(v.z9,{disabled:h,href:(0,je.nL)("alerting/notifications",o,{tab:Le.ActiveTab.NotificationTemplates}),variant:"secondary",children:(0,e.jsx)(l.x6,{i18nKey:"common.cancel",children:"Cancel"})})]})]}),(0,e.jsxs)("div",{...Q.containerProps,className:s.contentContainer,children:[(0,e.jsx)("div",{...Q.primaryProps,children:(0,e.jsxs)("div",{...ae.containerProps,className:s.contentField,children:[(0,e.jsx)("div",{...ae.primaryProps,children:(0,e.jsxs)("div",{className:(0,a.cx)(s.flexColumn,s.containerWithBorderAndRadius,s.minEditorSize),children:[(0,e.jsx)("div",{children:(0,e.jsx)(De.D,{label:(0,l.t)("alerting.template-form.label-template-group","Template group"),actions:(0,e.jsxs)(e.Fragment,{children:[B&&(0,e.jsx)(U.m,{overlay:(0,e.jsxs)(K.W,{children:[ut.map((E,Z)=>(0,e.jsx)(K.W.Item,{label:E.description,onClick:()=>q(E.example)},Z)),(0,e.jsx)(K.W.Divider,{}),(0,e.jsx)(K.W.Item,{label:(0,l.t)("alerting.template-form.label-examples-documentation","Examples documentation"),url:"https://grafana.com/docs/grafana/latest/alerting/configure-notifications/template-notifications/examples/",target:"_blank",icon:"external-link-alt"})]}),children:(0,e.jsx)(v.$n,{variant:"secondary",size:"sm",icon:"angle-down",children:(0,e.jsx)(l.x6,{i18nKey:"alerting.templates.editor.add-example",children:"Add example"})})}),(0,e.jsx)(v.$n,{icon:"question-circle",size:"sm",fill:"outline",variant:"secondary",onClick:D,children:(0,e.jsx)(l.x6,{i18nKey:"common.help",children:"Help"})})]})})}),(0,e.jsx)(T.a,{flex:1,children:(0,e.jsx)(ne.default,{children:({width:E,height:Z})=>(0,e.jsx)(pt.K,{value:L("content"),onBlur:ie=>F("content",ie),containerStyles:s.editorContainer,width:E,height:Z})})})]})}),B&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{...ae.splitterProps}),(0,e.jsx)("div",{...ae.secondaryProps,children:(0,e.jsx)("div",{className:(0,a.cx)(s.containerWithBorderAndRadius,s.minEditorSize,s.payloadEditor,s.flexFull),children:(0,e.jsx)(dt,{payload:C,defaultPayload:Se,setPayload:y,setPayloadFormatError:x,payloadFormatError:u})})})]})]})}),B&&(0,e.jsxs)("div",{...Q.secondaryProps,children:[(0,e.jsx)("div",{...Q.splitterProps}),(0,e.jsx)(ft.p,{payload:C,templateName:X("title"),templateContent:X("content"),setPayloadFormatError:x,payloadFormatError:u,className:(0,a.cx)(s.templatePreview,s.minEditorSize)})]})]})]})})]})}),H&&(0,e.jsx)(ye._,{title:(0,l.t)("alerting.template-form.title-templating-cheat-sheet","Templating cheat sheet"),onClose:D,size:"lg",children:(0,e.jsx)(vt,{})})]})};function yt(){const n=(0,i.of)(Be),d=(0,l.t)("alerting.templates.help.intro",`Notification templates use Go templating language to create notification messages.

In Grafana, a template group can define multiple notification templates using {{ define "<NAME>" }}.
These templates can then be used in contact points and within other notification templates by calling {{ template "<NAME>" }}.
For detailed information about notification templates, refer to our documentation.`);return(0,e.jsx)(O.F,{title:"",severity:"info",children:(0,e.jsxs)(g.B,{direction:"column",gap:2,children:[(0,e.jsxs)(g.B,{direction:"row",children:[(0,e.jsx)("div",{style:{whiteSpace:"pre"},children:d}),(0,e.jsx)("div",{children:(0,e.jsx)(v.z9,{href:"https://grafana.com/docs/grafana/latest/alerting/manage-notifications/template-notifications/",target:"_blank",icon:"external-link-alt",variant:"secondary",children:(0,e.jsx)(l.x6,{i18nKey:"alerting.templates.editor.goto-docs",children:"Notification templates documentation"})})})]}),(0,e.jsxs)(ve.E,{variant:"bodySmall",children:[(0,e.jsx)(l.x6,{i18nKey:"alerting.templates.editor.auto-complete",children:"For auto-completion of common templating code, type the following keywords in the content editor:"}),(0,e.jsx)("div",{className:n.code,children:Object.values(ht.L).map(o=>o.label).join(", ")})]})]})})}function vt(){return(0,e.jsxs)(g.B,{direction:"column",gap:1,children:[(0,e.jsx)(yt,{}),(0,e.jsx)(Xe,{})]})}const Be=n=>{const d=n.breakpoints.down("md");return{flexFull:(0,a.css)({flex:1}),minEditorSize:(0,a.css)({minHeight:300,minWidth:300}),payloadEditor:(0,a.css)({minHeight:0}),containerWithBorderAndRadius:(0,a.css)({borderRadius:n.shape.radius.default,border:`1px solid ${n.colors.border.medium}`}),flexColumn:(0,a.css)({display:"flex",flex:1,flexDirection:"column"}),form:(0,a.css)({label:"template-form",height:"100%",display:"flex",flexDirection:"column"}),fieldset:(0,a.css)({label:"template-fieldset",flex:1,display:"flex",flexDirection:"column"}),label:(0,a.css)({margin:0}),contentContainer:(0,a.css)({flex:1,display:"flex",flexDirection:"row"}),contentField:(0,a.css)({display:"flex",flexDirection:"column",flex:1,marginBottom:0}),templatePreview:(0,a.css)({flex:1,display:"flex"}),templatePayload:(0,a.css)({flex:1}),editorContainer:(0,a.css)({width:"fit-content",border:"none"}),payloadCollapseButton:(0,a.css)({backgroundColor:n.colors.info.transparent,margin:0,[d]:{display:"none"}}),code:(0,a.css)({color:n.colors.text.secondary,fontWeight:n.typography.fontWeightBold})}},jt=[{status:"firing",annotations:{summary:"Instance instance1 has been down for more than 5 minutes"},labels:{alertname:"InstanceDown",instance:"instance1"},startsAt:G(new Date,1).toISOString(),endsAt:j(new Date,5).toISOString(),fingerprint:"a5331f0d5a9d81d4",generatorURL:"http://grafana.com/alerting/grafana/cdeqmlhvflz40f/view"},{status:"resolved",annotations:{summary:"CPU usage above 90%"},labels:{alertname:"CpuUsage",instance:"instance1"},startsAt:de(new Date,4).toISOString(),endsAt:new Date().toISOString(),fingerprint:"b77d941310f9d381",generatorURL:"http://grafana.com/alerting/grafana/oZSMdGj7z/view"}],Se=JSON.stringify(jt,null,2)},64179:(he,Y,t)=>{t.d(Y,{p:()=>te});var e=t(74848),a=t(22803),V=t(2543),G=t(70713),W=t(63142),I=t(45861),$=t(31286),j=t(50992),_=t(34999),M=t(56840),ee=t(77256),Ae=t(30130),de=t(96540),Ce=t(43730);function b(i,f,O,T){const[A,{data:g,error:z,isLoading:se}]=(0,Ce.vj)(),v=(0,de.useCallback)(()=>{try{const U=JSON.parse(O);JSON.stringify([...U]),A({template:i,alerts:U,name:f}),T(null)}catch(U){T(U instanceof Error?U.message:"Invalid JSON.")}},[i,f,O,T,A]);return(0,de.useEffect)(()=>v(),[v]),{data:g,error:z,isLoading:se,onPreview:v}}function te({payload:i,templateName:f,templateContent:O,payloadFormatError:T,setPayloadFormatError:A,className:g}){const z=(0,W.of)(ce),{data:se,isLoading:v,onPreview:U,error:K}=b(O,f,i,A),ye=xe(K,T,se);return(0,e.jsxs)("div",{className:(0,a.cx)(z.container,g),children:[(0,e.jsx)(Ae.D,{label:(0,M.t)("alerting.template-preview.label-preview","Preview"),actions:(0,e.jsx)(I.$n,{disabled:v,icon:"sync","aria-label":(0,M.t)("alerting.template-preview.aria-label-refresh-preview","Refresh preview"),onClick:U,size:"sm",variant:"secondary",children:(0,e.jsx)(M.x6,{i18nKey:"alerting.template-preview.refresh",children:"Refresh"})})}),(0,e.jsx)($.a,{flex:1,children:(0,e.jsx)(G.default,{disableWidth:!0,children:({height:ve})=>(0,e.jsx)("div",{className:z.viewerContainer({height:ve}),children:ye})})})]})}function ge({previews:i}){const f=(0,W.of)(ce),O=i.length===1,T=A=>{try{return JSON.parse(A),!0}catch{return!1}};return(0,e.jsx)("ul",{className:f.viewer.container,"data-testid":"template-preview",children:i.map(A=>{const g=T(A.text)?"json":"plaintext";return(0,e.jsxs)("li",{className:f.viewer.box,children:[O?null:(0,e.jsxs)("header",{className:f.viewer.header,children:[A.name,(0,e.jsx)("div",{className:f.viewer.language,children:g})]}),(0,e.jsx)(j.B,{containerStyles:f.editorContainer,language:g,showLineNumbers:!1,showMiniMap:!1,value:A.text,readOnly:!0,monacoOptions:{scrollBeyondLastLine:!1}})]},A.name)})})}function ne({errors:i}){return i.map(f=>(0,e.jsx)(_.F,{title:(0,V.compact)([f.name,f.kind]).join(" \u2013 "),children:f.message},(0,V.uniqueId)("errors-list")))}const ce=i=>({container:(0,a.css)({label:"template-preview-container",display:"flex",flexDirection:"column",borderRadius:i.shape.radius.default,border:`1px solid ${i.colors.border.medium}`}),editorContainer:(0,a.css)({width:"100%",height:"100%",border:"none"}),viewerContainer:({height:f})=>(0,a.css)({height:f,overflow:"auto",backgroundColor:i.colors.background.primary}),viewer:{container:(0,a.css)({display:"flex",flexDirection:"column",height:"inherit"}),box:(0,a.css)({display:"flex",flexDirection:"column",borderBottom:`1px solid ${i.colors.border.medium}`,height:"inherit"}),header:(0,a.css)({display:"flex",justifyContent:"space-between",fontSize:i.typography.bodySmall.fontSize,padding:i.spacing(1,2),borderBottom:`1px solid ${i.colors.border.medium}`,backgroundColor:i.colors.background.secondary}),language:(0,a.css)({marginLeft:"auto",fontStyle:"italic"}),errorText:(0,a.css)({color:i.colors.error.text})}});function xe(i,f,O){const T=i?(0,ee.JZ)(i):void 0,A=f||T,g=O?.results??[],z=O?.errors;return(0,e.jsxs)(e.Fragment,{children:[A&&(0,e.jsx)(_.F,{severity:"error",title:(0,M.t)("alerting.get-preview-results.title-error","Error"),children:A}),z&&(0,e.jsx)(ne,{errors:z}),g&&(0,e.jsx)(ge,{previews:g})]})}},19161:(he,Y,t)=>{t.d(Y,{$:()=>V,Q:()=>G});var e=t(2543),a=t.n(e);function V(W,I){return W.filter($=>!I.find(j=>JSON.stringify(j)===JSON.stringify($)))}function G(W){const I=W.flatMap(j=>j);return(0,e.uniqBy)(I.filter(j=>I.filter(M=>(0,e.isEqual)(j,M)).length===Object.keys(W).length),j=>JSON.stringify(j))}}}]);

//# sourceMappingURL=4666.b8bc5613331f8e715c93.js.map