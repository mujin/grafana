"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8528],{39910:(Oe,te,o)=>{o.r(te),o.d(te,{DashboardScenePage:()=>x,default:()=>h});var e=o(74848),U=o(96540),Y=o(54148),B=o(84596),ne=o(75683),oe=o(36490),I=o(56838),re=o(31286),p=o(13791),m=o(11098),$=o(99362),ae=o(96673),le=o(22803),f=o(8515),T=o(63142),P=o(22787),ge=o(45861),M=o(83560),N=o(56840),de=o(15130),ye=o(17732),Ue=o(8285);const Pe=(0,U.memo)(({dashboard:y})=>{const W=(0,U.useMemo)(()=>oe.Ny.getLocation().pathname,[y]),{showModal:k,hideModal:L}=(0,U.useContext)(f.wE);(0,U.useEffect)(()=>{const V=A=>{w(y)||y.state.isDirty&&(A.preventDefault(),A.returnValue="")};return window.addEventListener("beforeunload",V),()=>window.removeEventListener("beforeunload",V)},[y]);const z=V=>{const A=y.state.editPanel,q=A?.getPanel(),je=new URLSearchParams(V.search);if(A&&q&&(0,Ue.ME)(q)&&A.state.isDirty&&!je.has("editPanel")){const F=(0,Ue.iL)(q);return k(ye.Z,{dashboard:y,isUnsavedPrompt:!0,libraryPanel:F,onConfirm:()=>{A.onConfirmSaveLibraryPanel(),L(),ce(V)},onDiscard:()=>{A.onDiscard(),L(),ce(V)},onDismiss:L}),!1}return W===V.pathname||w(y)||!y.state.isDirty?!0:(k(Z,{dashboard:y,onSaveDashboardClick:()=>{L(),y.openSaveDrawer({onSaveSuccess:()=>{ce(V)}})},onDiscard:()=>{y.exitEditMode({skipConfirm:!0}),L(),ce(V)},onDismiss:L}),!1)};return(0,e.jsx)(M.X,{when:!0,message:z})});Pe.displayName="DashboardPrompt";function ce(y){y&&setTimeout(()=>oe.Ny.push(y),10)}const Z=({onDiscard:y,onDismiss:W,onSaveDashboardClick:k})=>{const L=(0,T.of)(Ne);return(0,e.jsxs)(P.a,{isOpen:!0,title:(0,N.t)("dashboard-scene.unsaved-changes-modal.title-unsaved-changes","Unsaved changes"),onDismiss:W,icon:"exclamation-triangle",className:L.modal,children:[(0,e.jsx)("h5",{children:(0,e.jsx)(N.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.changes",children:"Do you want to save your changes?"})}),(0,e.jsxs)(P.a.ButtonRow,{children:[(0,e.jsx)(ge.$n,{variant:"secondary",onClick:W,fill:"outline",children:(0,e.jsx)(N.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.cancel",children:"Cancel"})}),(0,e.jsx)(ge.$n,{variant:"destructive",onClick:y,children:(0,e.jsx)(N.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.discard",children:"Discard"})}),(0,e.jsx)(ge.$n,{onClick:k,children:(0,e.jsx)(N.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.save-dashboard",children:"Save dashboard"})})]})]})},Ne=()=>({modal:(0,le.css)({width:"500px"})});function w(y){if(!y?.getInitialSaveModel()||y?.state.meta.version===0||!de.TP.isSignedIn||!y)return!0;const{canSave:k,fromScript:L,fromFile:z}=y.state.meta;return!de.TP.isEditor&&!k?!0:!k||L||z}var Be=o(63704),nt=o(43173),se=o(34999),me=o(41654),ze=o(30703),at=o(19164),he=o(96727);const Ie={severity:"info",style:{flex:0}};function ve({queryParams:y,slug:W,path:k}){const L=(0,he.H)(),z=(0,at.Kw)({name:W,path:k,ref:y.ref});if(z.data?.errors)return(0,e.jsx)(se.F,{title:(0,N.t)("dashboard-scene.dashboard-preview-banner.title-error-loading-dashboard","Error loading dashboard"),severity:"error",style:{flex:0},children:z.data.errors.map((A,q)=>(0,e.jsx)("div",{children:A},q))});if(L?.length)return(0,e.jsx)(se.F,{...Ie,title:(0,N.t)("dashboard-scene.dashboard-preview-banner.title-dashboard-loaded-request-git-hub","This dashboard is loaded from a pull request in GitHub."),buttonContent:(0,e.jsxs)(me.B,{alignItems:"center",children:[(0,e.jsx)(N.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.view-pull-request-in-git-hub",children:"View pull request in GitHub"}),(0,e.jsx)(ze.I,{name:"external-link-alt"})]}),onRemove:()=>window.open(Be.sQ.sanitizeUrl(L),"_blank"),children:(0,e.jsx)(N.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.value-not-saved",children:"The value is not yet saved in the Grafana database"})});const V=z.data?.urls?.newPullRequestURL??z.data?.urls?.compareURL;return V?(0,e.jsx)(se.F,{...Ie,title:(0,N.t)("dashboard-scene.dashboard-preview-banner.title-dashboard-loaded-branch-git-hub","This dashboard is loaded from a branch in GitHub."),buttonContent:(0,e.jsxs)(me.B,{alignItems:"center",children:[(0,e.jsx)(N.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.open-pull-request-in-git-hub",children:"Open pull request in GitHub"}),(0,e.jsx)(ze.I,{name:"external-link-alt"})]}),onRemove:()=>window.open(Be.sQ.sanitizeUrl(V),"_blank"),children:(0,e.jsx)(N.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.not-saved",children:"The value is not yet saved in the Grafana database"})}):(0,e.jsx)(se.F,{...Ie,title:(0,N.t)("dashboard-scene.dashboard-preview-banner.title-dashboard-loaded-external-repository","This dashboard is loaded from an external repository"),children:(0,e.jsx)(N.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.not-yet-saved",children:"The value is not saved in the Grafana database"})})}function Me({queryParams:y,route:W,slug:k,path:L}){return!nt.$.featureToggles.provisioning||"kiosk"in y||!L||W!==ae.DashboardRoutes.Provisioning||!k?null:(0,e.jsx)(ve,{queryParams:y,slug:k,path:L})}var ie=o(41644);function x({route:y,queryParams:W,location:k}){const L=(0,Y.g)(),{type:z,slug:V,uid:A}=L,q=L["*"],je=(0,B.A)({params:L}),F=(0,ie.sP)(),{dashboard:be,isLoading:Ke,loadError:Fe}=F.useState(),st=k.state?.routeReloadCounter,Se=(0,U.useRef)(L);if((0,U.useEffect)(()=>(y.routeName===ae.DashboardRoutes.Normal&&z==="snapshot"?F.loadSnapshot(V):F.loadDashboard({uid:(y.routeName===ae.DashboardRoutes.Provisioning?q:A)??"",type:z,slug:V,route:y.routeName,urlFolderUid:W.folderUid}),()=>{F.clearState()}),[F,A,y.routeName,W.folderUid,st,z]),(0,U.useEffect)(()=>{if(y.routeName===ae.DashboardRoutes.Normal&&A===Se.current.uid&&Se.current.slug&&!V){const De=`/d/${A}/${Se.current.slug}`;oe.Ny.replace({...oe.Ny.getLocation(),pathname:De})}return()=>{Se.current={uid:A,slug:V||Se.current.slug}}},[y,V,z,A]),!be){let De;return Fe&&(De=(0,e.jsx)($.i,{error:Fe,type:z})),De||(0,e.jsx)(p.Y,{navId:"dashboards/browse",layout:ne.k.Canvas,"data-testid":"dashboard-scene-page",children:(0,e.jsx)(re.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:Ke&&(0,e.jsx)(m.A,{})})})}return z!=="snapshot"&&(!je||A!==je?.params.uid)?(console.log("skipping rendering"),null):(0,e.jsxs)(I.$L,{scene:be,updateUrlOnInit:!0,createBrowserHistorySteps:!0,children:[(0,e.jsx)(Me,{queryParams:W,route:y.routeName,slug:V,path:q}),(0,e.jsx)(be.Component,{model:be},be.state.key),(0,e.jsx)(Pe,{dashboard:be})]})}const h=x},99362:(Oe,te,o)=>{o.d(te,{i:()=>p});var e=o(74848),U=o(75683),Y=o(31286),B=o(34999),ne=o(13791),oe=o(1506),I=o(56840),re=o(47797);function p({error:m,type:$}){const ae=(0,re.do)(m),le=(0,re.q6)(m),f=$==="snapshot"?"Snapshot":"Dashboard";return(0,e.jsx)(ne.Y,{navId:"dashboards/browse",layout:U.k.Canvas,pageNav:{text:"Not found"},children:(0,e.jsx)(Y.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:ae===404?(0,e.jsx)(oe.L,{entity:f}):(0,e.jsx)(B.F,{title:(0,I.t)("dashboard.errors.failed-to-load","Failed to load dashboard"),severity:"error","data-testid":"dashboard-page-error",children:le})})})}},8528:(Oe,te,o)=>{o.r(te),o.d(te,{default:()=>Po});var e=o(74848),U=o(54148),Y=o(16817),B=o(43173),ne=o(39910),oe=o(41644),I=o(96673),re=o(60171),p=o(22803),m=o(96540),$=o(71468),ae=o(75683),le=o(92138),f=o(85629),T=o(36490),P=o(63142),ge=o(6890),M=o(13791),N=o(27963),de=o(64762);function ye(t){switch(t.kiosk){case"1":case!0:return I.KioskMode.Full;default:return null}}var Ue=o(38206),Pe=o(84057),ce=o(79718),Z=o(87745),Ne=o(39167),w=o(99305),Be=o(25157),nt=o(46505),se=o(2543),me=o(8515),ze=o(45229),at=o(83560),he=o(15130),Ie=o(40996),ve=o(22787),Me=o(63527),ie=o(30703),x=o(45861),h=o(56840),y=o(30124),W=o(37666),k=o(12048);const L=({panel:t,folderUid:n,isUnsavedPrompt:a,onDismiss:s,onConfirm:i,onDiscard:r})=>{const[l,d]=(0,m.useState)(""),c=(0,Y.A)(async()=>{const j=await(0,y.xV)(t.libraryPanel.uid);return j.length>0?j.map(Q=>Q.title):[]},[t.libraryPanel.uid]),[u,g]=(0,m.useState)([]);(0,Ie.A)(()=>c.value?g(c.value.filter(j=>j.toLowerCase().includes(l.toLowerCase()))):g([]),300,[c.value,l]);const{saveLibraryPanel:v}=(0,k.b)(),b=(0,P.of)(W.o),E=(0,m.useCallback)(()=>{r()},[r]),C=a?"Unsaved library panel changes":"Save library panel";return(0,e.jsx)(ve.a,{title:C,icon:"save",onDismiss:s,isOpen:!0,children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{className:b.textInfo,children:["This update will affect ",(0,e.jsxs)("strong",{children:[t.libraryPanel.meta?.connectedDashboards," ",t.libraryPanel.meta?.connectedDashboards===1?"dashboard":"dashboards","."]}),"The following dashboards using the panel will be affected:"]}),(0,e.jsx)(Me.p,{className:b.dashboardSearch,prefix:(0,e.jsx)(ie.I,{name:"search"}),placeholder:(0,h.t)("library-panels.save-library-panel-modal.placeholder-search-affected-dashboards","Search affected dashboards"),value:l,onChange:j=>d(j.currentTarget.value)}),c.loading?(0,e.jsx)("p",{children:(0,e.jsx)(h.x6,{i18nKey:"library-panels.save-library-panel-modal.loading-connected-dashboards",children:"Loading connected dashboards..."})}):(0,e.jsxs)("table",{className:b.myTable,children:[(0,e.jsx)("thead",{children:(0,e.jsx)("tr",{children:(0,e.jsx)("th",{children:(0,e.jsx)(h.x6,{i18nKey:"library-panels.save-library-panel-modal.dashboard-name",children:"Dashboard name"})})})}),(0,e.jsx)("tbody",{children:u.map((j,Q)=>(0,e.jsx)("tr",{children:(0,e.jsx)("td",{children:j})},`dashrow-${Q}`))})]}),(0,e.jsxs)(ve.a.ButtonRow,{children:[(0,e.jsx)(x.$n,{variant:"secondary",onClick:s,fill:"outline",children:(0,e.jsx)(h.x6,{i18nKey:"library-panels.save-library-panel-modal.cancel",children:"Cancel"})}),a&&(0,e.jsx)(x.$n,{variant:"destructive",onClick:E,children:(0,e.jsx)(h.x6,{i18nKey:"library-panels.save-library-panel-modal.discard",children:"Discard"})}),(0,e.jsx)(x.$n,{onClick:()=>{v(t,n).then(()=>{i()})},children:(0,e.jsx)(h.x6,{i18nKey:"library-panels.save-library-panel-modal.update-all",children:"Update all"})})]})]})})};var z=o(7817),V=o(29043),A=o(17097),q=o(87390),je=o(89224),F=o(42795);function be(t,n){return async a=>{const s=n.initEditPanel(t);a((0,F.GU)({panel:s,sourcePanel:t}))}}function Ke(){return async(t,n)=>{const{getPanel:a}=n().panelEditor;a().configRev=0,t((0,F.MJ)(!0))}}function Fe(t,n){return a=>{if(t.libraryPanel?.uid===void 0||!n)return;const s=t.getSaveModel();for(const i of n.panels){if(st(t,i))continue;i.restoreModel({...s,...(0,se.pick)(i,"gridPos","id")});const r=i.plugin?.meta.id!==t.plugin?.meta.id;i.plugin=t.plugin,i.configRev++,r&&(i.generateNewKey(),a((0,je.XM)({key:i.key,plugin:i.plugin}))),setTimeout(()=>{i.getQueryRunner().useLastResultFrom(t.getQueryRunner())},20)}t.repeat&&setTimeout(()=>n.processRepeats(),20)}}function st(t,n){return!!(n.libraryPanel?.uid!==t.libraryPanel.uid||n.id&&n.id===t.id||n.repeatPanelId)}function Se(){return async(t,n)=>{const a=n().dashboard.getModel(),{getPanel:s,getSourcePanel:i,shouldDiscardChanges:r}=n().panelEditor,l=s();a&&a.exitPanelEditor();const d=i();if(De(l)&&!r){const c=l.getSaveModel(),u=d.type!==l.type;t(Fe(l,a)),d.restoreModel(c),d.configRev++,u&&(d.plugin=l.plugin,d.generateNewKey(),await t((0,je.XM)({key:d.key,plugin:l.plugin}))),setTimeout(()=>{d.getQueryRunner().useLastResultFrom(l.getQueryRunner()),d.render(),l.hasSavedPanelEditChange&&!l.hasChanged&&(d.configRev=0)},20)}d.isNew&&(r?a&&(0,A.FC)(a,d,!0):delete d.isNew),t((0,q.O6)(l.key)),t((0,F.Ox)())}}function De(t){return t.hasChanged||t.hasSavedPanelEditChange||t.isAngularPlugin()}function it(t){return(n,a)=>{const s={...a().panelEditor.ui,...t};n((0,F.fR)(s));try{V.A.setObject(F.wi,s)}catch(i){console.error(i)}}}var ot=o(78159);const En=({dashboard:t,onSaveSuccess:n,onDiscard:a,onDismiss:s})=>(0,e.jsxs)(ve.a,{isOpen:!0,title:(0,h.t)("dashboard.unsaved-changes-modal.title-unsaved-changes","Unsaved changes"),onDismiss:s,icon:"exclamation-triangle",className:(0,p.css)({width:"500px"}),children:[(0,e.jsx)("h5",{children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.unsaved-changes-modal.changes",children:"Do you want to save your changes?"})}),(0,e.jsxs)(ve.a.ButtonRow,{children:[(0,e.jsx)(x.$n,{variant:"secondary",onClick:s,fill:"outline",children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.unsaved-changes-modal.cancel",children:"Cancel"})}),(0,e.jsx)(x.$n,{variant:"destructive",onClick:a,children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.unsaved-changes-modal.discard",children:"Discard"})}),(0,e.jsx)(ot.C,{dashboard:t,onSaveSuccess:n})]})]}),Mt=(0,m.memo)(({dashboard:t})=>{const[n,a]=(0,m.useState)({original:null}),s=(0,I.useDispatch)(),{original:i,originalPath:r}=n,{showModal:l,hideModal:d}=(0,m.useContext)(me.wE);(0,m.useEffect)(()=>{const u=setTimeout(()=>{const v=T.Ny.getLocation().pathname,b=t.getSaveModelCloneOld();a({originalPath:v,original:b})},1e3),g=ze.l.subscribe(Z.Eu,()=>{const v=t.getSaveModelCloneOld();a({originalPath:r,original:v})});return()=>{clearTimeout(u),g.unsubscribe()}},[t,r]),(0,m.useEffect)(()=>{const u=g=>{wt(t,i)||Vt(t,i)&&(g.preventDefault(),g.returnValue="")};return window.addEventListener("beforeunload",u),()=>window.removeEventListener("beforeunload",u)},[t,i]);const c=u=>{const g=t.panelInEdit,v=new URLSearchParams(u.search);return g&&g.libraryPanel&&g.hasChanged&&!v.has("editPanel")?(l(L,{isUnsavedPrompt:!0,panel:t.panelInEdit,folderUid:t.meta.folderUid??"",onConfirm:()=>{d(),$e(u)},onDiscard:()=>{s(Ke()),$e(u),d()},onDismiss:d}),!1):r===u.pathname||!i?(g&&!v.has("editPanel")&&s(Se()),!0):wt(t,i)||!Vt(t,i)?!0:(l(En,{dashboard:t,onSaveSuccess:()=>{d(),$e(u)},onDiscard:()=>{a({...n,original:null}),d(),$e(u)},onDismiss:d}),!1)};return(0,e.jsx)(at.X,{when:!0,message:c})});Mt.displayName="DashboardPrompt";function $e(t){t&&setTimeout(()=>T.Ny.push(t),10)}function wt(t,n){if(!n||n.version===0||!he.TP.isSignedIn||!t)return!0;const{canSave:a,fromScript:s,fromFile:i}=t.meta;return!he.TP.isEditor&&!a?!0:!a||s||i}function Lt(t){const n=new z.G(t);n.expandRows();const a=n.getSaveModelClone();if(delete a.time,delete a.refresh,a.schemaVersion=0,delete a.timezone,a.panels=[],a.templating?.list)for(const s of a.templating.list)delete s.current,delete s.options,delete s.filters;return a}function Vt(t,n){if(t.hasUnsavedChanges())return!0;const a=Lt(t.getSaveModelCloneOld()),s=Lt(n),i=(0,se.find)(a.nav,{type:"timepicker"}),r=(0,se.find)(s.nav,{type:"timepicker"});i&&r&&(i.now=r.now);const l=JSON.stringify(a,null),d=JSON.stringify(s,null);return l!==d}var At=o(36219),K=o(41654),ke=o(66404),Rt=o(43707),Ot=o(14644),ue=o(27489),rt=o(74475),fe=o(32881),lt=o(68079),Ge=o(45967),Te=o(76319),dt=o(27690);const Nn=({id:t,usages:n})=>{const a=(0,m.useMemo)(()=>n.find(i=>i.variable.id===t),[t,n]);if(!a)return null;const s=a.nodes.map(i=>i.label.includes(`$${t}`)?{...i,color:"#FB7E81"}:i);return(0,e.jsx)(dt.i,{show:!1,title:(0,h.t)("variables.variables-unknown-button.usage-title","Showing usages for: {{variableId}}",{variableId:`$${t}`}),nodes:s,edges:a.edges,children:({showModal:i})=>(0,e.jsx)(Te.K,{onClick:()=>i(),name:"code-branch",tooltip:(0,h.t)("variables.variables-unknown-button.VariablesUnknownButton-tooltip-show-usages","Show usages"),"data-testid":"VariablesUnknownButton"})})};var Ce=o(47969);const In=1e3;function Mn({variables:t,dashboard:n}){const[a,s]=(0,m.useState)(!1),[i,r]=(0,m.useState)(0),[l,d]=(0,m.useState)([]),c=(0,P.of)(ct);(0,m.useEffect)(()=>r(v=>v+1),[t,n]);const{loading:u}=(0,Y.A)(async()=>{if(a&&i>0){const v=Date.now(),b=await(0,Ce.g0)(t,n),C=Date.now()-v;return C>=In&&(0,ue.rR)("Slow unknown variables expansion",{elapsed:C}),r(0),d(b),b}return[]},[t,n,a,i]),g=v=>{v&&(0,ue.rR)("Unknown variables section expanded"),s(v)};return(0,e.jsx)("div",{className:c.container,children:(0,e.jsxs)(rt.M,{label:(0,e.jsx)(wn,{}),isOpen:a,onToggle:g,children:[u&&(0,e.jsx)(fe.gW,{justify:"center",children:(0,e.jsxs)(fe.Gy,{justify:"center",children:[(0,e.jsx)("span",{children:(0,e.jsx)(h.x6,{i18nKey:"variables.variables-unknown-table.loading",children:"Loading..."})}),(0,e.jsx)(lt.y,{})]})}),!u&&l&&(0,e.jsxs)(e.Fragment,{children:[l.length===0&&(0,e.jsx)(Ln,{}),l.length>0&&(0,e.jsx)(Vn,{usages:l})]})]})})}function wn(){const t=(0,P.of)(ct);return(0,e.jsxs)("h5",{children:[(0,e.jsx)(h.x6,{i18nKey:"variables.variables-unknown-table.collapse-label",children:"Renamed or missing variables"}),(0,e.jsx)(Ge.m,{content:(0,h.t)("variables.variables-unknown-table.collapse-tooltip","Click to expand a list with all variable references that have been renamed or are missing from the dashboard."),children:(0,e.jsx)(ie.I,{name:"info-circle",className:t.infoIcon})})]})}function Ln(){return(0,e.jsx)("span",{children:(0,e.jsx)(h.x6,{i18nKey:"variables.no-unknowns.no-renamed-or-missing-variables-found",children:"No renamed or missing variables found."})})}function Vn({usages:t}){const n=(0,P.of)(ct);return(0,e.jsxs)("table",{className:"filter-table filter-table--hover",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(h.x6,{i18nKey:"variables.unknown-table.variable",children:"Variable"})}),(0,e.jsx)("th",{colSpan:5})]})}),(0,e.jsx)("tbody",{children:t.map(a=>{const{variable:s}=a,{id:i,name:r}=s;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:n.firstColumn,children:(0,e.jsx)("span",{children:r})}),(0,e.jsx)("td",{className:n.defaultColumn}),(0,e.jsx)("td",{className:n.defaultColumn}),(0,e.jsx)("td",{className:n.defaultColumn}),(0,e.jsx)("td",{className:n.lastColumn,children:(0,e.jsx)(Nn,{id:s.id,usages:t})})]},i)})})]})}const ct=t=>({container:(0,p.css)({marginTop:t.spacing(4),paddingTop:t.spacing(4)}),infoIcon:(0,p.css)({marginLeft:t.spacing(1)}),defaultColumn:(0,p.css)({width:"1%"}),firstColumn:(0,p.css)({width:"1%",verticalAlign:"top",color:t.colors.text.maxContrast}),lastColumn:(0,p.css)({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%",textAlign:"right"})});var H=o(74887),X=o(93612),pe=o(88681),ht=o(71599);function Ut({varName:t,isOpen:n=!1,onConfirm:a,onDismiss:s}){return(0,e.jsx)(ht.u,{title:(0,h.t)("variables.confirm-delete-modal.title-delete-variable","Delete variable"),isOpen:n,onConfirm:a,onDismiss:s,body:`
      Are you sure you want to delete variable "${t}"?
    `,modalClass:An.modal,confirmText:"Delete"})}const An={modal:(0,p.css)({width:"max-content",maxWidth:"80vw"})};var We=o(28105),Rn=o(29),On=o(32442),Un=o(25379),Bt=o(49602),Bn=o(18387),ut=o(54742),pt=o(67933),zn=o(68577);function Kn({onChange:t,type:n}){const a=(0,m.useMemo)(()=>(0,w.AX)(),[]),s=(0,m.useMemo)(()=>a.find(i=>i.value===n)??a[0],[a,n]);return(0,e.jsx)(zn.v,{name:"Select variable type",value:s,options:a,onChange:t,testId:f.Tp.pages.Dashboard.Settings.Variables.Edit.General.generalTypeSelectV2})}var Fn=o(99703),we=o(17752);const $n=t=>async n=>{const{rootStateKey:a}=t;n((0,H.kb)(a,(0,we.sJ)({name:(0,X.dn)(t).name,id:t.id})))},kn=t=>async(n,a)=>{const{rootStateKey:s}=t;n((0,H.kb)(s,(0,we.T7)((0,w.qD)(t))))},Gn=(t,n)=>(a,s)=>{const{id:i,rootStateKey:r}=t;let l=null;if(n.match(/^(?!__).*$/)||(l="Template names cannot begin with '__', that's reserved for Grafana's global variables"),n.match(/^\w+$/)||(l="Only word characters are allowed in variable names"),(0,X.SS)(r,s()).filter(u=>u.name===n&&u.id!==i).length&&(l="Variable with the same name already exists"),l){a((0,H.kb)(r,(0,we.DW)({newName:n,errorText:l})));return}a(Wn(t,n))},Wn=(t,n)=>(a,s)=>{const{rootStateKey:i}=t,r=(0,X.dn)(t,s());if(r.name===n){a((0,H.kb)(i,(0,we.FN)((0,w.qD)(t,{newName:n}))));return}const l={...(0,se.cloneDeep)(r),name:n,id:n},d=r.global,c=r.index,u=(0,w.jX)(l);a((0,H.kb)(i,(0,pe.QV)((0,w.qD)(u,{global:d,index:c,model:l})))),a((0,H.kb)(i,(0,we.FN)((0,w.qD)(u,{newName:n})))),a((0,H.kb)(i,(0,pe.Hr)((0,w.qD)(t,{reIndex:!1}))))},Hn=(t,n="query")=>(a,s)=>{const i=(0,w.q4)(t),r=(0,X.SS)(i,s()),l=Jn(n,r),d={type:n,id:l},c=!1,u=(0,X.hk)(i,s()),g=(0,se.cloneDeep)(ut.B.get(n).initialState);g.id=l,g.name=l,g.rootStateKey=i,a((0,H.kb)(i,(0,pe.QV)((0,w.qD)(d,{global:c,model:g,index:u})))),T.Ny.partial({editIndex:r.length})},Qn=t=>(n,a)=>{const s=(0,w.q4)(t),i=a(),r=(0,X.nS)(s,i),l=i.dashboard.getModel(),{usages:d}=(0,Ce.hM)(r,l),c=(0,Ce.Ow)(d);n((0,H.kb)(s,(0,Fn.bX)({usages:d,usagesNetwork:c})))};function Jn(t,n){let a=0,s=`${t}${a}`;for(;n.find(i=>i.id===s);)s=`${t}${++a}`;return s}var Yn=o(73829);const Xn=(t,n)=>({editor:(0,X.nx)(n.identifier.rootStateKey,t).editor,variable:(0,X.dn)(n.identifier,t)}),Zn=t=>({...(0,Ot.bindActionCreators)({variableEditorMount:$n,variableEditorUnMount:kn,changeVariableName:Gn,updateOptions:Ne.mZ},t),changeVariableProp:(n,a,s)=>t((0,H.kb)(n.rootStateKey,(0,pe.QP)((0,w.qD)(n,{propName:a,propValue:s})))),changeVariableType:(n,a)=>t((0,H.kb)(n.rootStateKey,(0,pe.l_)((0,w.qD)(n,{newType:a})))),removeVariable:n=>{t((0,H.kb)(n.rootStateKey,(0,pe.Hr)((0,w.qD)(n,{reIndex:!0}))))}}),qn=(0,$.connect)(Xn,Zn);class _n extends m.PureComponent{constructor(){super(...arguments),this.state={showDeleteModal:!1},this.onNameChange=n=>{n.preventDefault(),this.props.changeVariableName(this.props.identifier,n.currentTarget.value)},this.onTypeChange=n=>{n.value&&this.props.changeVariableType(this.props.identifier,n.value)},this.onLabelChange=n=>{n.preventDefault(),this.props.changeVariableProp(this.props.identifier,"label",n.currentTarget.value)},this.onDescriptionChange=n=>{this.props.changeVariableProp(this.props.identifier,"description",n.currentTarget.value)},this.onHideChange=n=>{this.props.changeVariableProp(this.props.identifier,"hide",n)},this.onPropChanged=({propName:n,propValue:a,updateOptions:s=!1})=>{this.props.changeVariableProp(this.props.identifier,n,a),s&&this.props.updateOptions((0,w.jX)(this.props.variable))},this.onHandleSubmit=async n=>{n.preventDefault(),this.props.editor.isValid&&this.props.updateOptions((0,w.jX)(this.props.variable))},this.onModalOpen=()=>{this.setState({showDeleteModal:!0})},this.onModalClose=()=>{this.setState({showDeleteModal:!1})},this.onDelete=()=>{this.props.removeVariable(this.props.identifier),this.onModalClose(),T.Ny.partial({editIndex:null})},this.onApply=()=>{T.Ny.partial({editIndex:null})},this.getVariableOptions=()=>{const{variable:n}=this.props;return(0,pt.SP)(n)?n.options.map(a=>({label:String(a.text),value:String(a.value)})):[]}}componentDidMount(){this.props.variableEditorMount(this.props.identifier)}componentWillUnmount(){this.props.variableEditorUnMount(this.props.identifier)}render(){const{theme:n,variable:a}=this.props,s=ut.B.get(this.props.variable.type).editor;if(!s)return null;const i=a.state===We.Gu.Loading,r=window.matchMedia("(prefers-reduced-motion: reduce)").matches,l=na(n);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("form",{"aria-label":(0,h.t)("variables.variable-editor-editor-un-connected.aria-label-variable-editor-form","Variable editor Form"),onSubmit:this.onHandleSubmit,children:[(0,e.jsx)(Kn,{onChange:this.onTypeChange,type:this.props.variable.type}),(0,e.jsx)(On.Y,{children:(0,e.jsx)(h.x6,{i18nKey:"variables.variable-editor-editor-un-connected.general",children:"General"})}),(0,e.jsx)(Bt._,{value:this.props.editor.name,onChange:this.onNameChange,name:"Name",placeholder:(0,h.t)("variables.variable-editor-editor-un-connected.placeholder-variable-name","Variable name"),description:(0,h.t)("variables.variable-editor-editor-un-connected.description-template-variable-characters","The name of the template variable. (Max. 50 characters)"),invalid:!!this.props.editor.errors.name,error:this.props.editor.errors.name,testId:f.Tp.pages.Dashboard.Settings.Variables.Edit.General.generalNameInputV2,maxLength:Yn.M.MaxSize,required:!0}),(0,e.jsx)(Bt._,{name:"Label",description:(0,h.t)("variables.variable-editor-editor-un-connected.description-optional-display-name","Optional display name"),value:this.props.variable.label??"",placeholder:(0,h.t)("variables.variable-editor-editor-un-connected.placeholder-label-name","Label name"),onChange:this.onLabelChange,testId:f.Tp.pages.Dashboard.Settings.Variables.Edit.General.generalLabelInputV2}),(0,e.jsx)(Un.Z,{name:"Description",value:a.description??"",placeholder:(0,h.t)("variables.variable-editor-editor-un-connected.placeholder-descriptive-text","Descriptive text"),onChange:this.onDescriptionChange,width:52}),(0,e.jsx)(Rn.D,{onChange:this.onHideChange,hide:this.props.variable.hide,type:this.props.variable.type}),s&&(0,e.jsx)(s,{variable:this.props.variable,onPropChange:this.onPropChanged}),(0,pt.SP)(this.props.variable)?(0,e.jsx)(Bn.j,{options:this.getVariableOptions()}):null,(0,e.jsx)("div",{style:{marginTop:"16px"},children:(0,e.jsxs)(fe.Gy,{spacing:"md",height:"inherit",children:[(0,e.jsx)(x.$n,{variant:"destructive",fill:"outline",onClick:this.onModalOpen,children:(0,e.jsx)(h.x6,{i18nKey:"variables.variable-editor-editor-un-connected.delete",children:"Delete"})}),(0,e.jsxs)(x.$n,{type:"submit","data-testid":f.Tp.pages.Dashboard.Settings.Variables.Edit.General.submitButton,disabled:i,variant:"secondary",children:["Run query",i&&(0,e.jsx)(ie.I,{className:l.spin,name:r?"hourglass":"sync",size:"sm",style:{marginLeft:"2px"}})]}),(0,e.jsx)(x.$n,{variant:"primary",onClick:this.onApply,"data-testid":f.Tp.pages.Dashboard.Settings.Variables.Edit.General.applyButton,children:(0,e.jsx)(h.x6,{i18nKey:"variables.variable-editor-editor-un-connected.apply",children:"Apply"})})]})})]}),(0,e.jsx)(Ut,{isOpen:this.state.showDeleteModal,varName:this.props.editor.name,onConfirm:this.onDelete,onDismiss:this.onModalClose})]})}}const ea=(0,P.cV)(qn(_n)),ta=(0,p.keyframes)({"0%":{transform:"rotate(0deg) scaleX(-1)"},"100%":{transform:"rotate(359deg) scaleX(-1)"}}),na=t=>({spin:(0,p.css)({[t.transitions.handleMotion("no-preference")]:{animation:`${ta} 3s linear infinite`}})});var gt=o(57095),zt=o(50201),mt=o(89640);const aa=({variables:t})=>{const n=(0,m.useMemo)(()=>(0,Ce.hI)(t),[t]),a=(0,m.useMemo)(()=>(0,Ce.qJ)(t),[t]);return a.length?(0,e.jsx)(dt.i,{show:!1,title:(0,h.t)("variables.variables-dependencies-button.title-dependencies","Dependencies"),nodes:(0,Ce.H7)(n,a),edges:a,children:({showModal:s})=>(0,e.jsx)(x.$n,{onClick:()=>{(0,ue.rR)("Show variable dependencies"),s()},icon:"channel-add",variant:"secondary",children:(0,e.jsx)(h.x6,{i18nKey:"variables.variables-dependencies-button.show-dependencies",children:"Show dependencies"})})}):null},sa=({id:t,usages:n,isAdhoc:a})=>{const s=(0,m.useMemo)(()=>n.find(r=>r.variable.id===t),[n,t]);if(n.length===0||a||!s)return null;const i=s.nodes.map(r=>r.label.includes(`$${t}`)?{...r,color:"#FB7E81"}:r);return(0,e.jsx)(dt.i,{show:!1,title:(0,h.t)("variabels.variable-usages-button.usage-title","Showing usages for: {{variableId}}",{variableId:`$${t}`}),nodes:i,edges:s.edges,children:({showModal:r})=>(0,e.jsx)(Te.K,{onClick:()=>{(0,ue.rR)("Show variable usages"),r()},name:"code-branch",tooltip:(0,h.t)("variables.variable-usages-button.tooltip-show-usages","Show usages")})})};function ia({index:t,variable:n,usageTree:a,usagesNetwork:s,onEdit:i,onDuplicate:r,onDelete:l}){const d=(0,P.$j)(),c=(0,P.of)(Kt),u=oa(n),v=(0,Ce.PK)(n.id,a)>0||n.type==="adhoc",b=(0,w.jX)(n);return(0,e.jsx)(gt.Draggable,{draggableId:JSON.stringify(b),index:t,children:(E,C)=>(0,e.jsxs)("tr",{ref:E.innerRef,...E.draggableProps,style:{userSelect:C.isDragging?"none":"auto",background:C.isDragging?d.colors.background.secondary:void 0,...E.draggableProps.style},children:[(0,e.jsx)("td",{role:"gridcell",className:c.column,children:(0,e.jsx)(x.$n,{size:"xs",fill:"text",onClick:j=>{j.preventDefault(),i(b)},className:c.nameLink,"aria-label":f.Tp.pages.Dashboard.Settings.Variables.List.tableRowNameFields(n.name),children:n.name})}),(0,e.jsx)("td",{role:"gridcell",className:c.definitionColumn,onClick:j=>{j.preventDefault(),i(b)},"aria-label":f.Tp.pages.Dashboard.Settings.Variables.List.tableRowDefinitionFields(n.name),children:u}),(0,e.jsx)("td",{role:"gridcell",className:c.column,children:(0,e.jsxs)("div",{className:c.icons,children:[(0,e.jsx)(ra,{passed:v}),(0,e.jsx)(sa,{id:n.id,isAdhoc:n.type==="adhoc",usages:s}),(0,e.jsx)(Te.K,{onClick:j=>{j.preventDefault(),(0,ue.rR)("Duplicate variable"),r(b)},name:"copy",tooltip:(0,h.t)("variables.variable-editor-list-row.tooltip-duplicate-variable","Duplicate variable"),"aria-label":f.Tp.pages.Dashboard.Settings.Variables.List.tableRowDuplicateButtons(n.name)}),(0,e.jsx)(Te.K,{onClick:j=>{j.preventDefault(),(0,ue.rR)("Delete variable"),l(b)},name:"trash-alt",tooltip:(0,h.t)("variables.variable-editor-list-row.tooltip-remove-variable","Remove variable"),"aria-label":f.Tp.pages.Dashboard.Settings.Variables.List.tableRowRemoveButtons(n.name)}),(0,e.jsx)("div",{...E.dragHandleProps,className:c.dragHandle,children:(0,e.jsx)(ie.I,{name:"draggabledots",size:"lg"})})]})})]})})}function oa(t){let n="";return t.type==="query"?t.definition?n=t.definition:typeof t.query=="string"&&(n=t.query):(0,pt.SP)(t)&&(n=t.query),n}function ra({passed:t}){const n=(0,P.of)(Kt);return t?(0,e.jsx)(ie.I,{name:"check",className:n.iconPassed,title:(0,h.t)("variables.variable-check-indicator.title-variable-referenced-other-variables-dashboard","This variable is referenced by other variables or dashboard.")}):(0,e.jsx)(ie.I,{name:"exclamation-triangle",className:n.iconFailed,title:(0,h.t)("variables.variable-check-indicator.title-variable-referenced-dashboard","This variable is not referenced by any variable or dashboard.")})}function Kt(t){return{dragHandle:(0,p.css)({cursor:"grab",marginLeft:t.spacing(1)}),column:(0,p.css)({width:"1%"}),nameLink:(0,p.css)({cursor:"pointer",color:t.colors.primary.text}),definitionColumn:(0,p.css)({width:"100%",maxWidth:"200px",cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",OTextOverflow:"ellipsis",whiteSpace:"nowrap"}),iconPassed:(0,p.css)({color:t.v1.palette.greenBase,marginRight:t.spacing(2)}),iconFailed:(0,p.css)({color:t.v1.palette.orange,marginRight:t.spacing(2)}),icons:(0,p.css)({display:"flex",gap:t.spacing(2),alignItems:"center"})}}function la({variables:t,usages:n,usagesNetwork:a,onChangeOrder:s,onAdd:i,onEdit:r,onDelete:l,onDuplicate:d}){const c=(0,P.of)(ca),u=g=>{if(!g.destination||!g.source)return;(0,ue.rR)("Variable drag and drop");const v=JSON.parse(g.draggableId);s(v,t[g.source.index].index,t[g.destination.index].index)};return(0,e.jsx)("div",{children:(0,e.jsxs)("div",{children:[t.length===0&&(0,e.jsx)(da,{onAdd:i}),t.length>0&&(0,e.jsxs)(K.B,{direction:"column",gap:4,children:[(0,e.jsx)("div",{className:c.tableContainer,children:(0,e.jsxs)("table",{className:"filter-table filter-table--hover","aria-label":f.Tp.pages.Dashboard.Settings.Variables.List.table,role:"grid",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(h.x6,{i18nKey:"variables.variable-editor-list.variable",children:"Variable"})}),(0,e.jsx)("th",{children:(0,e.jsx)(h.x6,{i18nKey:"variables.variable-editor-list.definition",children:"Definition"})}),(0,e.jsx)("th",{colSpan:5})]})}),(0,e.jsx)(gt.DragDropContext,{onDragEnd:u,children:(0,e.jsx)(gt.Droppable,{droppableId:"variables-list",direction:"vertical",children:g=>(0,e.jsxs)("tbody",{ref:g.innerRef,...g.droppableProps,children:[t.map((v,b)=>(0,e.jsx)(ia,{index:b,variable:v,usageTree:n,usagesNetwork:a,onDelete:l,onDuplicate:d,onEdit:r},`${v.name}-${b}`)),g.placeholder]})})})]})}),(0,e.jsxs)(K.B,{children:[(0,e.jsx)(aa,{variables:t}),(0,e.jsx)(x.$n,{"aria-label":f.Tp.pages.Dashboard.Settings.Variables.List.newButton,onClick:i,icon:"plus",children:(0,e.jsx)(h.x6,{i18nKey:"variables.variable-editor-list.new-variable",children:"New variable"})})]})]})]})})}function da({onAdd:t}){return(0,e.jsx)(K.B,{direction:"column",children:(0,e.jsxs)(zt.p,{variant:"call-to-action",button:(0,e.jsx)(x.$n,{"data-testid":f.Tp.components.CallToActionCard.buttonV2("Add variable"),icon:"calculator-alt",onClick:t,size:"lg",children:(0,e.jsx)(h.x6,{i18nKey:"variables.empty-state.button-title",children:"Add variable"})}),message:(0,h.t)("variables.empty-state.title","There are no variables added yet"),children:[(0,e.jsx)("p",{children:(0,e.jsx)(h.x6,{i18nKey:"variables.empty-state.info-box-content",children:"Variables enable more interactive and dynamic dashboards. Instead of hard-coding things like server or sensor names in your metric queries you can use variables in their place. Variables are shown as list boxes at the top of the dashboard. These drop-down lists make it easy to change the data being displayed in your dashboard."})}),(0,e.jsxs)(h.x6,{i18nKey:"variables.empty-state.info-box-content-2",children:["Check out the"," ",(0,e.jsx)(mt.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/variables/",children:"Templates and variables documentation"})," ","for more information."]})]})})}const ca=()=>({tableContainer:(0,p.css)({overflow:"scroll",width:"100%"})}),ha=(t,n)=>{const{uid:a}=n.dashboard,s=(0,X.nx)(a,t);return{variables:(0,X.nS)(a,t),idInEditor:s.editor.id,usagesNetwork:s.inspect.usagesNetwork,usages:s.inspect.usages}},ua=t=>({...(0,Ot.bindActionCreators)({createNewVariable:Hn,initListMode:Qn},t),changeVariableOrder:(n,a,s)=>t((0,H.kb)(n.rootStateKey,(0,pe.hj)((0,w.qD)(n,{fromIndex:a,toIndex:s})))),duplicateVariable:n=>t((0,H.kb)(n.rootStateKey,(0,pe.ut)((0,w.qD)(n,{newId:void 0})))),removeVariable:n=>{t((0,H.kb)(n.rootStateKey,(0,pe.Hr)((0,w.qD)(n,{reIndex:!0}))))}}),pa=(0,$.connect)(ha,ua);class ga extends m.PureComponent{constructor(){super(...arguments),this.state={variableId:void 0},this.onEditVariable=n=>{const a=this.props.variables.findIndex(s=>s.id===n.id);T.Ny.partial({editIndex:a})},this.onNewVariable=()=>{this.props.createNewVariable(this.props.dashboard.uid)},this.onChangeVariableOrder=(n,a,s)=>{this.props.changeVariableOrder(n,a,s)},this.onDuplicateVariable=n=>{this.props.duplicateVariable(n)},this.onModalOpen=n=>{this.setState({variableId:n})},this.onModalClose=()=>{this.setState({variableId:void 0})},this.onRemoveVariable=()=>{this.props.removeVariable(this.state.variableId),this.onModalClose()}}componentDidMount(){this.props.initListMode(this.props.dashboard.uid)}render(){const{editIndex:n,variables:a,sectionNav:s}=this.props,i=n!=null?a[n]:void 0,l=s.node.parentItem,d=i?{text:i.name,parentItem:l}:l;return(0,e.jsxs)(M.Y,{navModel:this.props.sectionNav,pageNav:d,children:[!i&&(0,e.jsx)(la,{variables:this.props.variables,onAdd:this.onNewVariable,onEdit:this.onEditVariable,onChangeOrder:this.onChangeVariableOrder,onDuplicate:this.onDuplicateVariable,onDelete:this.onModalOpen,usages:this.props.usages,usagesNetwork:this.props.usagesNetwork}),!i&&this.props.variables.length>0&&(0,e.jsx)(Mn,{variables:this.props.variables,dashboard:this.props.dashboard}),i&&(0,e.jsx)(ea,{identifier:(0,w.jX)(i)}),(0,e.jsx)(Ut,{isOpen:this.state.variableId!==void 0,varName:this.state.variableId?.id??"",onConfirm:this.onRemoveVariable,onDismiss:this.onModalClose})]})}}const ma=pa(ga);var va=o(54384),Ft=o(73427);const ba=({dashboard:t,sectionNav:n})=>{const a=Ft.TP.hasPermission(I.AccessControlAction.DashboardsPermissionsWrite),s=n.node.parentItem;return(0,e.jsx)(M.Y,{navModel:n,pageNav:s,children:(0,e.jsx)(va.x,{resource:"dashboards",resourceId:t.uid,canSetPermissions:a})})};var He=o(48480),Qe=o(78282),$t=o(16780),G=o(37386),Le=o(34999),vt=o(32635),bt=o(18857),fa=o(38669),ft=o(65642),xa=o(76478),ya=o(76792);const kt="New annotation",ja=({editIdx:t,dashboard:n})=>{const a=(0,P.of)(Sa),[s,i]=(0,m.useState)(n.annotations.list[t]),r=(0,m.useMemo)(()=>s.filter?s.filter.exclude?2:1:0,[s.filter]),{value:l}=(0,Y.A)(()=>(0,Qe.l)().get(s.datasource),[s.datasource]),d=(0,Qe.l)().getInstanceSettings(s.datasource),c=S=>{const R=[...n.annotations.list];R.splice(t,1,S),i(S),n.annotations.list=R},u=S=>{c({...s,name:S.currentTarget.value})},g=S=>{const R=(0,He.p$)(S);s.datasource?.type!==R.type?c({datasource:R,builtIn:s.builtIn,enable:s.enable,iconColor:s.iconColor,name:s.name,hide:s.hide,filter:s.filter,mappings:s.mappings,type:s.type}):c({...s,datasource:R})},v=S=>{const R=S.currentTarget;c({...s,[R.name]:R.type==="checkbox"?R.checked:R.value})},b=S=>{c({...s,iconColor:S})},E=S=>{let R=S.value===0?void 0:{exclude:S.value===2,ids:s.filter?.ids??[]};c({...s,filter:R})},C=S=>{if(!Array.isArray(S))return;const R={exclude:r===2,ids:[]};S.forEach(tt=>tt.value&&R.ids.push(tt.value)),c({...s,filter:R})},j=Gt,Q=()=>{T.Ny.partial({editview:null,editIndex:null})},ee=()=>{const S=n.annotations.list;n.annotations.list=[...S.slice(0,t),...S.slice(t+1)],Gt()},J=s.name===kt,Re=(S,R)=>S.label&&R.label?S.label.toLowerCase().localeCompare(R.label.toLowerCase()):-1,et=(0,m.useMemo)(()=>n?.panels.filter(S=>ft.Ay.panels[S.type]).map(S=>({value:S.id,label:S.title??`Panel ${S.id}`,description:S.description,imgUrl:ft.Ay.panels[S.type].info.logos.small})).sort(Re)??[],[n]);return(0,e.jsxs)("div",{children:[(0,e.jsxs)($t.n,{className:a.settingsForm,children:[(0,e.jsx)(G.D,{label:(0,h.t)("dashboard.annotation-settings-edit.label-name","Name"),children:(0,e.jsx)(Me.p,{"data-testid":f.Tp.pages.Dashboard.Settings.Annotations.Settings.name,name:"name",id:"name",autoFocus:J,value:s.name,onChange:u})}),(0,e.jsx)(G.D,{label:(0,h.t)("dashboard.annotation-settings-edit.label-data-source","Data source"),htmlFor:"data-source-picker",children:(0,e.jsx)(ya.s,{annotations:!0,variables:!0,current:s.datasource,onChange:g})}),!l?.meta.annotations&&(0,e.jsx)(Le.F,{title:(0,h.t)("dashboard.annotation-settings-edit.title-annotation-support-source","No annotation support for this data source"),severity:"error",children:(0,e.jsx)(h.x6,{i18nKey:"errors.dashboard-settings.annotations.datasource",children:"The selected data source does not support annotations. Please select a different data source."})}),(0,e.jsx)(G.D,{label:(0,h.t)("dashboard.annotation-settings-edit.label-enabled","Enabled"),description:(0,h.t)("dashboard.annotation-settings-edit.description-enabled-annotation-query-issued-every-dashboard","When enabled the annotation query is issued every dashboard refresh"),children:(0,e.jsx)(vt.S,{name:"enable",id:"enable",value:s.enable,onChange:v})}),(0,e.jsx)(G.D,{label:(0,h.t)("dashboard.annotation-settings-edit.label-hidden","Hidden"),description:"Annotation queries can be toggled on or off at the top of the dashboard. With this option checked this toggle will be hidden.",children:(0,e.jsx)(vt.S,{name:"hide",id:"hide",value:s.hide,onChange:v})}),(0,e.jsx)(G.D,{label:(0,h.t)("dashboard.annotation-settings-edit.label-color","Color"),description:(0,h.t)("dashboard.annotation-settings-edit.description-color-annotation-event-markers","Color to use for the annotation event markers"),children:(0,e.jsx)(fe.Gy,{children:(0,e.jsx)(fa.a,{value:s?.iconColor,onChange:b})})}),(0,e.jsx)(G.D,{label:(0,h.t)("dashboard.annotation-settings-edit.label-show-in","Show in"),"data-testid":f.Tp.pages.Dashboard.Settings.Annotations.NewAnnotation.showInLabel,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(bt.l6,{options:Pa,value:r,onChange:E,"data-testid":f.Tp.components.Annotations.annotationsTypeInput}),r!==0&&(0,e.jsx)(bt.KF,{options:et,value:et.filter(S=>s.filter?.ids.includes(S.value)),onChange:C,isClearable:!0,placeholder:(0,h.t)("dashboard.annotation-settings-edit.placeholder-choose-panels","Choose panels"),width:100,closeMenuOnSelect:!1,className:a.select,"data-testid":f.Tp.components.Annotations.annotationsChoosePanelInput})]})})]}),(0,e.jsxs)($t.n,{children:[(0,e.jsx)("h3",{className:"page-heading",children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.annotation-settings-edit.query",children:"Query"})}),l?.annotations&&d&&(0,e.jsx)(xa.A,{datasource:l,datasourceInstanceSettings:d,annotation:s,onChange:c})]}),(0,e.jsxs)(K.B,{children:[!s.builtIn&&(0,e.jsx)(x.$n,{variant:"destructive",onClick:ee,children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.annotation-settings-edit.delete",children:"Delete"})}),(0,e.jsx)(x.$n,{variant:"secondary",onClick:Q,"data-testid":f.Tp.pages.Dashboard.Settings.Annotations.NewAnnotation.previewInDashboard,children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.annotation-settings-edit.preview-in-dashboard",children:"Preview in dashboard"})}),(0,e.jsx)(x.$n,{variant:"primary",onClick:j,children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.annotation-settings-edit.apply",children:"Apply"})})]})]})},Sa=t=>({settingsForm:(0,p.css)({maxWidth:t.spacing(60),marginBottom:t.spacing(2)}),select:(0,p.css)({marginTop:"8px"})});function Gt(){T.Ny.partial({editIndex:null})}var Ca=(t=>(t[t.AllPanels=0]="AllPanels",t[t.IncludePanels=1]="IncludePanels",t[t.ExcludePanels=2]="ExcludePanels",t))(Ca||{});const Pa=[{label:"All panels",value:0,description:"Send the annotation data to all panels that support annotations"},{label:"Selected panels",value:1,description:"Send the annotations to the explicitly listed panels"},{label:"All panels except",value:2,description:"Do not send annotation data to the following panels"}];var Wt=o(46635),Da=o(44458),Ta=o(39302);const Ea=({dashboard:t,onNew:n,onEdit:a})=>{const s=(0,P.of)(Na),[i,r]=(0,m.useState)(t.annotations.list),l=(v,b)=>{t.annotations.list=Wt.moveItemImmutably(i,v,v+b),r(t.annotations.list)},d=v=>{t.annotations.list=[...i.slice(0,v),...i.slice(v+1)],r(t.annotations.list)},c=i.length===0||i.length===1&&i[0].builtIn,u=v=>v.enable===!1?(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("em",{className:"muted",children:["(Disabled) \xA0 ",v.name]})}):v.builtIn?(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("em",{className:"muted",children:[v.name," \xA0 (Built-in)"]})}):(0,e.jsx)(e.Fragment,{children:v.name}),g=(0,Qe.l)();return(0,e.jsxs)(K.B,{direction:"column",children:[i.length>0&&(0,e.jsx)("div",{className:s.table,children:(0,e.jsxs)("table",{role:"grid",className:"filter-table filter-table--hover",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.annotation-settings-list.query-name",children:"Query name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.annotation-settings-list.data-source",children:"Data source"})}),(0,e.jsx)("th",{colSpan:3})]})}),(0,e.jsx)("tbody",{children:t.annotations.list.map((v,b)=>(0,e.jsxs)("tr",{children:[v.builtIn?(0,e.jsx)("td",{role:"gridcell",style:{width:"90%"},className:"pointer",onClick:()=>a(b),children:(0,e.jsx)(x.$n,{size:"sm",fill:"text",variant:"secondary",children:u(v)})}):(0,e.jsx)("td",{role:"gridcell",className:"pointer",onClick:()=>a(b),children:(0,e.jsx)(x.$n,{size:"sm",fill:"text",variant:"secondary",children:u(v)})}),(0,e.jsx)("td",{role:"gridcell",className:"pointer",onClick:()=>a(b),children:g.getInstanceSettings(v.datasource)?.name||v.datasource?.uid}),(0,e.jsx)("td",{role:"gridcell",style:{width:"1%"},children:b!==0&&(0,e.jsx)(Te.K,{name:"arrow-up",onClick:()=>l(b,-1),tooltip:(0,h.t)("dashboard.annotation-settings-list.tooltip-move-up","Move up")})}),(0,e.jsx)("td",{role:"gridcell",style:{width:"1%"},children:t.annotations.list.length>1&&b!==t.annotations.list.length-1?(0,e.jsx)(Te.K,{name:"arrow-down",onClick:()=>l(b,1),tooltip:(0,h.t)("dashboard.annotation-settings-list.tooltip-move-down","Move down")}):null}),(0,e.jsx)("td",{role:"gridcell",style:{width:"1%"},children:!v.builtIn&&(0,e.jsx)(Da.e,{size:"sm",onConfirm:()=>d(b),"aria-label":`Delete query with title "${v.name}"`})})]},`${v.name}-${b}`))})]})}),c&&(0,e.jsx)(K.B,{direction:"column",children:(0,e.jsxs)(zt.p,{variant:"call-to-action",button:(0,e.jsx)(x.$n,{"data-testid":f.Tp.components.CallToActionCard.buttonV2("Add annotation query"),icon:"comment-alt",onClick:n,size:"lg",children:(0,e.jsx)(h.x6,{i18nKey:"annotations.empty-state.button-title",children:"Add annotation query"})}),message:(0,h.t)("annotations.empty-state.title","There are no custom annotation queries added yet"),children:[(0,e.jsx)(h.x6,{i18nKey:"annotations.empty-state.info-box-content",children:(0,e.jsx)("p",{children:"Annotations provide a way to integrate event data into your graphs. They are visualized as vertical lines and icons on all graph panels. When you hover over an annotation icon you can get event text & tags for the event. You can add annotation events directly from grafana by holding CTRL or CMD + click on graph (or drag region). These will be stored in Grafana's annotation database."})}),(0,e.jsxs)(h.x6,{i18nKey:"annotations.empty-state.info-box-content-2",children:["Checkout the"," ",(0,e.jsx)(mt.Y,{external:!0,href:"http://docs.grafana.org/reference/annotations/",children:"Annotations documentation"})," ","for more information."]})]})}),!c&&(0,e.jsx)(Ta.d,{"data-testid":f.Tp.pages.Dashboard.Settings.Annotations.List.addAnnotationCTAV2,onClick:n,children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.annotation-settings-list.new-query",children:"New query"})})]})},Na=()=>({table:(0,p.css)({width:"100%",overflowX:"scroll"})});function Ia({dashboard:t,editIndex:n,sectionNav:a}){const s=()=>{const l={name:kt,enable:!0,datasource:(0,He.p$)((0,Qe.l)().getInstanceSettings(null)),iconColor:"red"};t.annotations.list=[...t.annotations.list,{...l}],T.Ny.partial({editIndex:t.annotations.list.length-1})},i=l=>{T.Ny.partial({editIndex:l})},r=n!=null&&n<t.annotations.list.length;return(0,e.jsxs)(M.Y,{navModel:a,pageNav:Ma(t,n,a.node),children:[!r&&(0,e.jsx)(Ea,{dashboard:t,onNew:s,onEdit:i}),r&&(0,e.jsx)(ja,{dashboard:t,editIdx:n})]})}function Ma(t,n,a){const s=a.parentItem;if(n==null)return s;const i=t.annotations.list[n];if(i)return{text:i.name,parentItem:s}}var xt=o(31286),Ht=o(72636),wa=o(87105),La=o(10928),Je=o(77824),Va=o(67804),Ye=o(85680),Xe=o(22429),Aa=o(5805),Qt=o(35137),Ra=o(15203),Oa=o(22351);const Ua={cleanUpDashboardAndVariables:Ye.Bz},Ba=(0,$.connect)(null,Ua),za=({hideModal:t,cleanUpDashboardAndVariables:n,dashboard:a})=>{const s=a.meta.provisioned,[i]=(0,Ra.uz)(),[,r]=(0,Aa.default)(async()=>{(0,ue.rR)("grafana_manage_dashboards_delete_clicked",{item_counts:{dashboard:1},source:"dashboard_settings",restore_enabled:!1}),await i({selectedItems:{dashboard:{[a.uid]:!0},folder:{}}}),n(),t(),T.Ny.replace("/")},[t]);return s?(0,e.jsx)(Ka,{hideModal:t,provisionedId:a.meta.provisionedExternalId}):(0,e.jsx)(Oa.h,{onConfirm:r,onClose:t,dashboardTitle:a.title})},Ka=({hideModal:t,provisionedId:n})=>(0,e.jsxs)(ve.a,{isOpen:!0,title:(0,h.t)("dashboard-settings.provisioned-delete-modal.title","Cannot delete provisioned dashboard"),icon:"trash-alt",onDismiss:t,className:(0,p.css)({width:"500px"}),children:[(0,e.jsx)(ke.E,{element:"p",children:(0,e.jsx)(h.x6,{i18nKey:"dashboard-settings.provisioned-delete-modal.text-1",children:"This dashboard is managed by Grafana provisioning and cannot be deleted. Remove the dashboard from the config file to delete it."})}),(0,e.jsx)(Qt.$,{v:1}),(0,e.jsxs)(ke.E,{element:"p",children:[(0,e.jsx)(h.x6,{i18nKey:"dashboard-settings.provisioned-delete-modal.text-2",children:"See grafana documentation for more information about provisioning.\xA0"}),(0,e.jsx)(mt.Y,{href:"https://grafana.com/docs/grafana/latest/administration/provisioning/#dashboards",external:!0,children:(0,h.t)("dashboard-settings.provisioned-delete-modal.text-link","Go to docs page")})]}),(0,e.jsx)(Qt.$,{v:2}),(0,e.jsx)(ke.E,{element:"p",children:(0,e.jsxs)(h.x6,{i18nKey:"dashboard-settings.provisioned-delete-modal.text-3",children:["File path: ",{provisionedId:n}]})}),(0,e.jsx)(ve.a.ButtonRow,{children:(0,e.jsx)(x.$n,{variant:"primary",onClick:t,children:(0,e.jsx)(h.x6,{i18nKey:"dashboard-settings.provisioned-delete-modal.confirm-button",children:"OK"})})})]}),Fa=Ba(za),$a=()=>{const t=(0,Xe.UA)().getCurrent();return(0,e.jsx)(me.$s,{children:({showModal:n,hideModal:a})=>(0,e.jsx)(x.$n,{variant:"destructive",onClick:()=>{n(Fa,{dashboard:t,hideModal:a})},"data-testid":f.Tp.pages.Dashboard.Settings.General.deleteDashBoard,children:(0,e.jsx)(h.x6,{i18nKey:"dashboard-settings.dashboard-delete-button",children:"Delete dashboard"})})})};var ka=o(42357),Ga=o(70969),Wa=o(56291);const Ha=[{value:0,label:"Default"},{value:1,label:"Shared crosshair"},{value:2,label:"Shared Tooltip"}];function Qa({dashboard:t,updateTimeZone:n,updateWeekStart:a,sectionNav:s}){const[i,r]=(0,m.useState)(0),[l,d]=(0,m.useState)(t.title),[c,u]=(0,m.useState)(t.description),g=s.node.parentItem,v=(D,It)=>{t.meta.folderUid=D,t.meta.folderTitle=It,t.meta.hasUnsavedFolderChange=!0,r(i+1)},b=(0,m.useCallback)(D=>{t.title=D,d(D)},[d,t]),E=(0,m.useCallback)(D=>{t.description=D,u(D)},[u,t]),C=D=>{t.graphTooltip=D,r(i+1)},j=D=>{t.timepicker.refresh_intervals=D.filter(It=>It.trim()!=="")},Q=D=>{t.timepicker.nowDelay=D},ee=D=>{t.timepicker.hidden=D,r(i+1)},J=D=>{t.liveNow=D,r(i+1)},Re=D=>{t.timezone=D,r(i+1),n(D)},et=D=>{t.weekStart=D,r(i+1),a(D)},S=D=>{t.tags=D,r(i+1)},R=D=>{t.editable=D,r(i+1)},tt=[{label:"Editable",value:!0},{label:"Read-only",value:!1}];return(0,e.jsx)(M.Y,{navModel:s,pageNav:g,children:(0,e.jsxs)("div",{style:{maxWidth:"600px"},children:[(0,e.jsxs)(xt.a,{marginBottom:5,children:[(0,e.jsx)(G.D,{label:(0,e.jsxs)(K.B,{justifyContent:"space-between",children:[(0,e.jsx)(Ht.J,{htmlFor:"title-input",children:(0,e.jsx)(h.x6,{i18nKey:"dashboard-settings.general.title-label",children:"Title"})}),B.$.featureToggles.dashgpt&&(0,e.jsx)(Ga.Z,{onGenerate:b})]}),children:(0,e.jsx)(Me.p,{id:"title-input",name:"title",value:l,onChange:D=>b(D.target.value)})}),(0,e.jsx)(G.D,{label:(0,e.jsxs)(K.B,{justifyContent:"space-between",children:[(0,e.jsx)(Ht.J,{htmlFor:"description-input",children:(0,h.t)("dashboard-settings.general.description-label","Description")}),B.$.featureToggles.dashgpt&&(0,e.jsx)(ka.V,{onGenerate:E})]}),children:(0,e.jsx)(wa.f,{id:"description-input",name:"description",value:c,onChange:D=>E(D.target.value)})}),(0,e.jsx)(G.D,{label:(0,h.t)("dashboard-settings.general.tags-label","Tags"),children:(0,e.jsx)(La.u,{id:"tags-input",tags:t.tags,onChange:S,width:40})}),(0,e.jsx)(G.D,{label:(0,h.t)("dashboard-settings.general.folder-label","Folder"),children:(0,e.jsx)(Va.d,{value:t.meta.folderUid,onChange:v,initialTitle:t.meta.folderTitle,inputId:"dashboard-folder-input",enableCreateNew:!0,dashboardId:t.id,skipInitialLoad:!0})}),(0,e.jsx)(G.D,{label:(0,h.t)("dashboard-settings.general.editable-label","Editable"),description:(0,h.t)("dashboard-settings.general.editable-description","Set to read-only to disable all editing. Reload the dashboard for changes to take effect"),children:(0,e.jsx)(Je.z,{value:t.editable,options:tt,onChange:R})})]}),(0,e.jsx)(Wa.p,{onTimeZoneChange:Re,onWeekStartChange:et,onRefreshIntervalChange:j,onNowDelayChange:Q,onHideTimePickerChange:ee,onLiveNowChange:J,refreshIntervals:t.timepicker.refresh_intervals,timePickerHidden:t.timepicker.hidden,nowDelay:t.timepicker.nowDelay,timezone:t.timezone,weekStart:t.weekStart,liveNow:t.liveNow}),(0,e.jsx)(rt.M,{label:(0,h.t)("dashboard-settings.general.panel-options-label","Panel options"),isOpen:!0,children:(0,e.jsx)(G.D,{label:(0,h.t)("dashboard-settings.general.panel-options-graph-tooltip-label","Graph tooltip"),description:(0,h.t)("dashboard-settings.general.panel-options-graph-tooltip-description","Controls tooltip and hover highlight behavior across different panels. Reload the dashboard for changes to take effect"),children:(0,e.jsx)(Je.z,{onChange:C,options:Ha,value:t.graphTooltip})})}),(0,e.jsx)(xt.a,{marginTop:3,children:t.meta.canDelete&&(0,e.jsx)($a,{})})]})})}const Ja={updateTimeZone:Ye.lC,updateWeekStart:Ye.Ss},Ya=(0,$.connect)(null,Ja)(Qa);var Jt=o(50992);function Xa({dashboard:t,sectionNav:n}){const a=t.getSaveModelClone(),[s,i]=(0,m.useState)(JSON.stringify(a,null,2)),r=n.node.parentItem,l=async()=>{await(0,Xe.UA)().saveJSONDashboard(s),ce.t.reloadPage()},d=(0,P.of)(Za);return(0,e.jsx)(M.Y,{navModel:n,pageNav:r,children:(0,e.jsxs)("div",{className:d.wrapper,children:[(0,e.jsx)(h.x6,{i18nKey:"dashboard-settings.json-editor.subtitle",children:"The JSON model below is the data structure that defines the dashboard. This includes dashboard settings, panel settings, layout, queries, and so on."}),(0,e.jsx)(Jt.B,{value:s,language:"json",showMiniMap:!0,showLineNumbers:!0,onBlur:i,containerStyles:d.codeEditor}),t.meta.canSave&&(0,e.jsx)("div",{children:(0,e.jsx)(x.$n,{type:"submit",onClick:l,children:(0,e.jsx)(h.x6,{i18nKey:"dashboard-settings.json-editor.save-button",children:"Save changes"})})})]})})}const Za=t=>({wrapper:(0,p.css)({display:"flex",height:"100%",flexDirection:"column",gap:t.spacing(2)}),codeEditor:(0,p.css)({flexGrow:1})});var yt=o(86871),qa=o(39468);const _a=({editLinkIdx:t,dashboard:n,onGoBack:a})=>{const[s,i]=(0,m.useState)(t!==null?n.links[t]:yt.q),r=l=>{const d=[...n.links];d.splice(t,1,l),n.links=d,i(l)};return(0,e.jsx)(qa.d,{link:s,onUpdate:r,onGoBack:a})};var es=o(88898);const ts=({dashboard:t,onNew:n,onEdit:a})=>{const[s,i]=(0,m.useState)(t.links),r=(c,u)=>{t.links=Wt.moveItemImmutably(s,c,c+u),i(t.links)},l=c=>{t.links=[...s,{...c}],i(t.links)},d=c=>{t.links=[...s.slice(0,c),...s.slice(c+1)],i(t.links)};return(0,e.jsx)(es.X,{links:s,onNew:n,onEdit:a,onDuplicate:l,onDelete:d,onOrderChange:r})};function ns({dashboard:t,sectionNav:n,editIndex:a}){const[s,i]=(0,m.useState)(!1),r=()=>{i(!1),T.Ny.partial({editIndex:void 0})},l=()=>{t.links=[...t.links,{...yt.q}],i(!0),T.Ny.partial({editIndex:t.links.length-1})},d=g=>{i(!1),T.Ny.partial({editIndex:g})},c=a!==void 0;let u=n.node.parentItem;return c&&(u={text:s?"New link":"Edit link",subTitle:s?"Create a new link on your dashboard":"Edit a specific link of your dashboard",parentItem:n.node.parentItem}),(0,e.jsxs)(M.Y,{navModel:n,pageNav:u,children:[!c&&(0,e.jsx)(ts,{dashboard:t,onNew:l,onEdit:d}),c&&(0,e.jsx)(_a,{dashboard:t,editLinkIdx:a,onGoBack:r})]})}var xe=o(21378),as=o(34753),ss=o(1199),is=o(61371),os=o(41053);const rs=async(t,n)=>(ce.t.ignoreNextSave(),await xe.wL.restoreDashboard(n.uid,t)),ls=(t,n)=>{const a=(0,I.useSelector)(l=>l.dashboard.getModel()),[s,i]=(0,os.A)(async()=>await rs(B.$.featureToggles.kubernetesClientDashboardsFolders?t:n,a),[]),r=(0,de._2)();return(0,m.useEffect)(()=>{if(s.value){const l=T.Ny.getLocation(),d=le.I.stripBaseFromUrl(s.value.url),c=l.state?.routeReloadCounter;T.Ny.replace({...l,pathname:d,state:{routeReloadCounter:c?c+1:1}}),r.success("Dashboard restored",`Restored from version ${n}`)}},[s,n,r]),{state:s,onRestoreDashboard:i}},Yt=({hideModal:t,id:n,version:a})=>{const{state:s,onRestoreDashboard:i}=ls(n,a);return(0,m.useEffect)(()=>{!s.loading&&s.value&&t()},[s,t]),(0,e.jsx)(ht.u,{isOpen:!0,title:(0,h.t)("dashboard.revert-dashboard-modal.title-restore-version","Restore version"),icon:"history",onDismiss:t,onConfirm:i,body:(0,e.jsxs)("p",{children:["Are you sure you want to restore the dashboard to version ",a,"? All unsaved changes will be lost."]}),confirmText:`Yes, restore to version ${a}`})},ds=({baseInfo:t,newInfo:n,diffData:a,isNewLatest:s})=>{const i=(0,is.G4)(a.lhs,a.rhs),r=(0,P.of)(cs);return(0,e.jsxs)(K.B,{direction:"column",gap:1,children:[(0,e.jsxs)(K.B,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsxs)(K.B,{alignItems:"center",children:[(0,e.jsxs)("span",{className:(0,p.cx)(r.versionInfo,r.noMarginBottom),children:[(0,e.jsxs)("strong",{children:["Version ",t.version]})," updated by ",t.createdBy," ",t.ageString,t.message]}),(0,e.jsx)(ie.I,{name:"arrow-right",size:"sm"}),(0,e.jsxs)("span",{className:r.versionInfo,children:[(0,e.jsxs)("strong",{children:["Version ",n.version]})," updated by ",n.createdBy," ",n.ageString,n.message]})]}),s&&(0,e.jsx)(me.$s,{children:({showModal:l,hideModal:d})=>(0,e.jsxs)(x.$n,{variant:"destructive",icon:"history",onClick:()=>{l(Yt,{id:t.id,version:t.version,hideModal:d})},children:["Restore to version ",t.version]})})]}),Object.entries(i).map(([l,d])=>(0,e.jsx)(as.D,{diffs:d,title:l},l)),(0,e.jsx)(xt.a,{paddingTop:2,children:(0,e.jsx)(rt.M,{isOpen:!1,label:(0,h.t)("dashboard.version-history-comparison.label-view-json-diff","View JSON diff"),children:(0,e.jsx)(ss.M,{oldValue:JSON.stringify(a.lhs,null,2),newValue:JSON.stringify(a.rhs,null,2)})})})]})},cs=t=>({versionInfo:(0,p.css)({color:t.colors.text.secondary,fontSize:t.typography.bodySmall.fontSize}),noMarginBottom:(0,p.css)({marginBottom:0})});var hs=o(94018);const us=({versions:t,canCompare:n,onCheck:a})=>{const s=(0,P.of)(ps);return(0,e.jsx)("div",{className:s.margin,children:(0,e.jsxs)("table",{className:"filter-table",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"width-4"}),(0,e.jsx)("th",{className:"width-4",children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.version-history-table.version",children:"Version"})}),(0,e.jsx)("th",{className:"width-14",children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.version-history-table.date",children:"Date"})}),(0,e.jsx)("th",{className:"width-10",children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.version-history-table.updated-by",children:"Updated by"})}),(0,e.jsx)("th",{children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.version-history-table.notes",children:"Notes"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:t.map((i,r)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(vt.S,{"aria-label":`Toggle selection of version ${i.version}`,className:(0,p.css)({display:"inline"}),checked:i.checked,onChange:l=>a(l,i.id),disabled:!i.checked&&n})}),(0,e.jsx)("td",{children:i.version}),(0,e.jsx)("td",{children:i.createdDateString}),(0,e.jsx)("td",{children:i.createdBy}),(0,e.jsx)("td",{children:i.message}),(0,e.jsx)("td",{className:"text-right",children:r===0?(0,e.jsx)(hs.v,{name:"Latest",colorIndex:17}):(0,e.jsx)(me.$s,{children:({showModal:l,hideModal:d})=>(0,e.jsx)(x.$n,{variant:"secondary",size:"sm",icon:"history",onClick:()=>{l(Yt,{id:i.id,version:i.version,hideModal:d})},children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.version-history-table.restore",children:"Restore"})})})})]},i.id))})]})})};function ps(t){return{margin:(0,p.css)({marginBottom:t.spacing(4)})}}const gs=10;class ms extends m.PureComponent{constructor(n){super(n),this.getVersions=(a=!1)=>{this.setState({isAppending:a});const s=this.continueToken?{limit:this.limit,start:this.start,continueToken:this.continueToken}:{limit:this.limit,start:this.start};xe.wL.getHistoryList(this.props.dashboard.uid,s).then(i=>{this.setState({isLoading:!1,versions:[...this.state.versions??[],...this.decorateVersions(i.versions)]}),this.start+=this.limit,this.continueToken=i.continueToken??""}).catch(i=>console.log(i)).finally(()=>this.setState({isAppending:!1}))},this.getDiff=async()=>{const a=this.state.versions.filter(c=>c.checked),[s,i]=a,r=s.version===this.props.dashboard.version;this.setState({isLoading:!0});let l,d;B.$.featureToggles.kubernetesClientDashboardsFolders?(l=await xe.wL.getDashboardVersion(this.props.dashboard.uid,i.id),d=await xe.wL.getDashboardVersion(this.props.dashboard.uid,s.id)):(l=await xe.wL.getDashboardVersion(this.props.dashboard.uid,i.version),d=await xe.wL.getDashboardVersion(this.props.dashboard.uid,s.version)),this.setState({baseInfo:i,isLoading:!1,isNewLatest:r,newInfo:s,viewMode:"compare",diffData:{lhs:l.data,rhs:d.data}})},this.decorateVersions=a=>a.map(s=>({...s,createdDateString:this.props.dashboard.formatDate(s.created),ageString:this.props.dashboard.getRelativeTime(s.created),checked:!1})),this.onCheck=(a,s)=>{this.setState({versions:this.state.versions.map(i=>i.id===s?{...i,checked:a.currentTarget.checked}:i)})},this.reset=()=>{this.continueToken="",this.setState({baseInfo:void 0,diffData:{lhs:"",rhs:""},isNewLatest:!1,newInfo:void 0,versions:this.state.versions.map(a=>({...a,checked:!1})),viewMode:"list"})},this.limit=gs,this.start=0,this.continueToken="",this.state={isAppending:!0,isLoading:!0,versions:[],viewMode:"list",isNewLatest:!1,diffData:{lhs:"",rhs:""}}}componentDidMount(){this.getVersions()}isLastPage(){return B.$.featureToggles.kubernetesClientDashboardsFolders?this.state.versions.find(n=>n.version===1)||this.state.versions.length%this.limit!==0||this.continueToken==="":this.state.versions.find(n=>n.version===1)||this.state.versions.length%this.limit!==0}render(){const{versions:n,viewMode:a,baseInfo:s,newInfo:i,isNewLatest:r,isLoading:l,diffData:d}=this.state,c=n.filter(b=>b.checked).length===2,u=n.length>1,g=n.length>=this.limit,v=this.props.sectionNav.node.parentItem;return a==="compare"?(0,e.jsxs)(M.Y,{navModel:this.props.sectionNav,pageNav:v,children:[(0,e.jsx)(xe.me,{onClick:this.reset,baseVersion:s?.version,newVersion:i?.version,isNewLatest:r}),l?(0,e.jsx)(jt,{msg:"Fetching changes\u2026"}):(0,e.jsx)(ds,{newInfo:i,baseInfo:s,isNewLatest:r,diffData:d})]}):(0,e.jsxs)(M.Y,{navModel:this.props.sectionNav,pageNav:v,children:[l?(0,e.jsx)(jt,{msg:"Fetching history list\u2026"}):(0,e.jsx)(us,{versions:n,onCheck:this.onCheck,canCompare:c}),this.state.isAppending&&(0,e.jsx)(jt,{msg:"Fetching more entries\u2026"}),u&&(0,e.jsx)(xe.rJ,{hasMore:g,canCompare:c,getVersions:this.getVersions,getDiff:this.getDiff,isLastPage:!!this.isLastPage()})]})}}const jt=({msg:t})=>(0,e.jsxs)(fe.Gy,{children:[(0,e.jsx)(lt.y,{}),(0,e.jsx)("em",{children:t})]}),vs=()=>T.Ny.partial({editview:null,editIndex:null});function bs({dashboard:t,editview:n,pageNav:a,sectionNav:s}){const[i,r]=(0,m.useState)(0);(0,m.useEffect)(()=>{t.events.subscribe(Z.Cf,()=>r(Q=>Q+1))},[t]);const l=(0,m.useMemo)(()=>fs(t),[t,i]),d=()=>{t.meta.hasUnsavedFolderChange=!1},c=l.find(Q=>Q.id===n)??l[0],u=he.TP.hasEditPermissionInFolders,g=t.meta.canSave,v=(0,U.zy)(),b=js(v),E=xs(a,s,l,c,v,t.uid),C="sm",j=[(0,e.jsx)(x.$n,{"data-testid":f.Tp.pages.Dashboard.Settings.Actions.close,variant:"secondary",fill:"outline",size:C,onClick:vs,children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.dashboard-settings.actions.close",children:"Close"})},"close"),u&&(0,e.jsx)(ot.m,{dashboard:t,onSaveSuccess:d,variant:"secondary",size:C},"save as"),g&&(0,e.jsx)(ot.C,{dashboard:t,onSaveSuccess:d,size:C},"Save")];return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Rt.H,{actions:(0,e.jsx)(At.U,{alignment:"right",children:j})}),(0,e.jsx)(c.component,{sectionNav:E,dashboard:t,editIndex:b})]})}function fs(t){const n=[],a=(0,h.t)("dashboard-settings.general.title","General");t.meta.canEdit&&(n.push({title:a,id:"settings",icon:"sliders-v-alt",component:Ya}),n.push({title:(0,h.t)("dashboard-settings.annotations.title","Annotations"),id:"annotations",icon:"comment-alt",component:Ia,subTitle:"Annotation queries return events that can be visualized as event markers in graphs across the dashboard."}),n.push({title:(0,h.t)("dashboard-settings.variables.title","Variables"),id:"templating",icon:"calculator-alt",component:ma,subTitle:"Variables can make your dashboard more dynamic and act as global filters."}),n.push({title:(0,h.t)("dashboard-settings.links.title","Links"),id:"links",icon:"link",component:ns})),t.meta.canMakeEditable&&n.push({title:a,icon:"sliders-v-alt",id:"settings",component:ys}),t.uid&&t.meta.canSave&&n.push({title:(0,h.t)("dashboard-settings.versions.title","Versions"),id:"versions",icon:"history",component:ms});const s=(0,h.t)("dashboard-settings.permissions.title","Permissions");return t.uid&&t.meta.canAdmin&&he.TP.hasPermission(I.AccessControlAction.DashboardsPermissionsRead)&&n.push({title:s,id:"permissions",icon:"lock",component:ba}),n.push({title:(0,h.t)("dashboard-settings.json-editor.title","JSON Model"),id:"dashboard_json",icon:"arrow",component:Xa}),n}function Xt(t,n){return{...t,parentItem:t.parentItem?Xt(t.parentItem,n):n}}function xs(t,n,a,s,i,r){const l={text:(0,h.t)("dashboard-settings.settings.title","Settings"),children:[],icon:"apps",hideFromBreadcrumbs:!1,url:le.I.getUrlForPartial(i,{editview:"settings",editIndex:null})};l.children=a.map(c=>({text:c.title,icon:c.icon,id:`${r}/${c.id}`,url:le.I.getUrlForPartial(i,{editview:c.id,editIndex:null}),active:c===s,parentItem:l,subTitle:c.subTitle}));const d=Xt(t,n.main);return l.parentItem=d,{main:l,node:l.children.find(c=>c.active)}}function ys({dashboard:t,sectionNav:n}){return(0,e.jsx)(M.Y,{navModel:n,children:(0,e.jsxs)(K.B,{direction:"column",gap:2,alignItems:"flex-start",children:[(0,e.jsx)(ke.E,{variant:"h3",children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.make-editable.dashboard-not-editable",children:"Dashboard not editable"})}),(0,e.jsx)(x.$n,{type:"submit",onClick:()=>t.makeEditable(),children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.make-editable.make-editable",children:"Make editable"})})]})})}function js(t){const n=new URLSearchParams(t.search).get("editIndex");if(n!=null)return parseInt(n,10)}var _=o(26689);function Zt(t,n){return t.panels[n.key]}var St=o(70713),qt=o(8207),Ct=o(54314),Ze=o(60208),_t=o(47931),Ve=o(21285),Ss=o(4213),Cs=o.n(Ss),Ps=o(80011),qe=o(55386),Ds=o(5114),Ts=o(65333),Ee=o(75421),en=o(98314),Ae=(t=>(t[t.Support=0]="Support",t[t.Data=1]="Data",t))(Ae||{}),_e=(t=>(t[t.PanelSnapshot=0]="PanelSnapshot",t[t.GithubComment=1]="GithubComment",t))(_e||{});class Es extends Ds.Q{constructor(n){super({panel:n,panelTitle:n.replaceVariables(n.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:"GitHub comment",description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:"Panel support snapshot",description:"Dashboard JSON used to help troubleshoot visualization issues",value:0}]}),this.onCurrentTabChange=a=>{this.setState({currentTab:a})},this.onShowMessageChange=a=>{this.setState({showMessage:a.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:a}=this.state,s=Math.pow(1024,2)*1.5;return a.length>s?(this.setState({error:{title:"Copy to clipboard failed",message:"Snapshot is too large, consider download and attaching a file instead"}}),""):a},this.onDownloadDashboard=()=>{const{snapshotText:a,panelTitle:s}=this.state,i=new Blob([a],{type:"text/plain"}),r=`debug-${s}-${(0,Ps.LE)(new Date)}.json.txt`;Cs()(i,r)},this.onSetSnapshotText=a=>{this.setState({snapshotText:a})},this.onToggleRandomize=a=>{const{randomize:s}=this.state;this.setState({randomize:{...s,[a]:!s[a]}})}}async buildDebugDashboard(){const{panel:n,randomize:a,snapshotUpdate:s}=this.state,i=await(0,en.E_)(n,a,(0,Ee.jG)().timeRange()),r=JSON.stringify(i,null,2),l=(0,en.jD)(n,r),d=(0,qe.cN)((0,qe.j_)("bytes")(r?.length??0));let c;if(!n.isAngularPlugin())try{const u=new z.G(i,{isEmbedded:!0});c=(0,Ts.EH)(u,i).state.body}catch(u){console.log("Error creating scene:",u)}this.setState({snapshot:i,snapshotText:r,markdownText:l,snapshotSize:d,snapshotUpdate:s+1,scene:c})}}function Ns({panel:t,plugin:n,onClose:a}){const s=(0,P.of)(Is),i=(0,m.useMemo)(()=>new Es(t),[t]),{currentTab:r,loading:l,error:d,options:c,showMessage:u,snapshotSize:g,markdownText:v,snapshotText:b,randomize:E,panelTitle:C,scene:j}=i.useState();if((0,m.useEffect)(()=>{i.buildDebugDashboard()},[i,n,E]),!n)return null;const Q=[{label:"Snapshot",value:Ae.Support},{label:"Data",value:Ae.Data}],ee=B.$.supportBundlesEnabled&&he.TP.hasPermission(I.AccessControlAction.ActionSupportBundlesCreate);return(0,e.jsxs)(qt._,{title:"Get help with this panel",size:"lg",onClose:a,subtitle:(0,e.jsxs)(K.B,{direction:"column",gap:1,children:[(0,e.jsx)(K.B,{direction:"row",gap:1,children:(0,e.jsxs)("a",{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",target:"blank",className:"external-link",rel:"noopener noreferrer",children:["Troubleshooting docs ",(0,e.jsx)(ie.I,{name:"external-link-alt"})]})}),(0,e.jsx)("span",{className:"muted",children:(0,e.jsx)(h.x6,{i18nKey:"help-wizard.troubleshooting-help",children:"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings."})}),ee&&(0,e.jsx)("span",{className:"muted",children:(0,e.jsxs)(h.x6,{i18nKey:"help-wizard.support-bundle",children:["You can also retrieve a support bundle containing information concerning your Grafana instance and configured datasources in the ",(0,e.jsx)("a",{href:"/support-bundles",children:"support bundles section"}),"."]})})]}),tabs:(0,e.jsx)(Ct.U,{children:Q.map((J,Re)=>(0,e.jsx)(Ze.o,{label:J.label,active:J.value===r,onChangeTab:()=>i.onCurrentTabChange(J.value)},`${J.value}-${Re}`))}),children:[l&&(0,e.jsx)(lt.y,{}),d&&(0,e.jsx)(Le.F,{title:d.title,children:d.message}),r===Ae.Data&&(0,e.jsxs)("div",{className:s.code,children:[(0,e.jsxs)("div",{className:s.opts,children:[(0,e.jsx)(G.D,{label:(0,h.t)("dashboard.help-wizard.label-template","Template"),className:s.field,children:(0,e.jsx)(bt.l6,{options:c,value:u,onChange:i.onShowMessageChange})}),u===_e.GithubComment?(0,e.jsx)(_t.b,{icon:"copy",getText:i.onGetMarkdownForClipboard,children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.help-wizard.copy-to-clipboard",children:"Copy to clipboard"})}):(0,e.jsxs)(x.$n,{icon:"download-alt",onClick:i.onDownloadDashboard,children:["Download (",g,")"]})]}),(0,e.jsx)(St.default,{disableWidth:!0,children:({height:J})=>(0,e.jsx)(Jt.B,{width:"100%",height:J,language:u===_e.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:u===_e.GithubComment?v:b,readOnly:!1,onBlur:i.onSetSnapshotText})})]}),r===Ae.Support&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(G.D,{label:(0,h.t)("dashboard.help-wizard.label-obfuscate-data","Obfuscate data"),description:"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal.",children:(0,e.jsxs)(K.B,{direction:"row",gap:1,children:[(0,e.jsx)(Ve.K,{label:(0,h.t)("dashboard.help-wizard.randomize-labels-label-labels","Labels"),id:"randomize-labels",showLabel:!0,value:!!E.labels,onChange:()=>i.onToggleRandomize("labels")}),(0,e.jsx)(Ve.K,{label:(0,h.t)("dashboard.help-wizard.randomize-field-names-label-field-names","Field names"),id:"randomize-field-names",showLabel:!0,value:!!E.names,onChange:()=>i.onToggleRandomize("names")}),(0,e.jsx)(Ve.K,{label:(0,h.t)("dashboard.help-wizard.randomize-string-values-label-string-values","String values"),id:"randomize-string-values",showLabel:!0,value:!!E.values,onChange:()=>i.onToggleRandomize("values")})]})}),(0,e.jsx)(G.D,{label:(0,h.t)("dashboard.help-wizard.label-support-snapshot","Support snapshot"),description:`Panel: ${C}`,children:(0,e.jsxs)(K.B,{children:[(0,e.jsxs)(x.$n,{icon:"download-alt",onClick:i.onDownloadDashboard,children:[(0,e.jsx)(h.x6,{i18nKey:"help-wizard.download-snapshot",children:"Download snapshot"})," (",g,")"]}),(0,e.jsx)(_t.b,{icon:"github",getText:i.onGetMarkdownForClipboard,title:(0,h.t)("dashboard.help-wizard.title-complete-git-hub-comment-clipboard","Copy a complete GitHub comment to the clipboard"),children:(0,e.jsx)(h.x6,{i18nKey:"help-wizard.github-comment",children:"Copy Github comment"})})]})}),(0,e.jsx)(St.default,{disableWidth:!0,children:({height:J})=>(0,e.jsx)("div",{style:{height:J,overflow:"auto"},children:j&&(0,e.jsx)(j.Component,{model:j})})})]})]})}const Is=t=>({code:(0,p.css)({flexGrow:1,height:"100%",overflow:"scroll"}),field:(0,p.css)({width:"100%"}),opts:(0,p.css)({display:"flex",width:"100%",flexGrow:0,alignItems:"center",justifyContent:"flex-end",button:{marginLeft:"8px"}})}),Pt=(t,n,a)=>{const s=(0,m.useRef)(),[i,r]=(0,m.useState)();return(0,m.useEffect)(()=>{let l=-1,d=0;return s.current=t.getQueryRunner().getData({withTransforms:n.withTransforms,withFieldConfig:!1}).subscribe({next:c=>{if(a){if(l===c.structureRev){const u=Date.now();if(u-d<1e4)return;d=u}l=c.structureRev??-1}r(c)}}),()=>{s.current&&s.current.unsubscribe()}},[t,n.withTransforms]),{data:i,isLoading:i?.state===We.Gu.Loading,hasSeries:i?!!i.series:!1,hasError:!!(i&&(i.error||i?.errors?.length||i.state===We.Gu.Error))}};var Ms=o(1906),tn=o(2863),ws=o(42836),Ls=o(80307),Vs=o(82049);const As=({data:t,metadataDatasource:n})=>!n||!n.components?.MetadataInspector?(0,e.jsx)(h.x6,{i18nKey:"dashboard.inspect-meta.no-inspector",children:"No Metadata Inspector"}):(0,e.jsx)(n.components.MetadataInspector,{datasource:n,data:t.series});var Rs=o(55072),Os=o(96065);const Us=({panel:t,plugin:n,dashboard:a,tabs:s,data:i,isDataLoading:r,dataOptions:l,metadataDatasource:d,defaultTab:c,onDataOptionsChange:u,onClose:g})=>{const[v,b]=(0,m.useState)(c??_.q.Data);if(!n)return null;let E=Bs(i),C=v;s.find(ee=>ee.value===v)||(C=_.q.JSON);const j=(0,tn.w)().replace(t.title,t.scopedVars,"text")||"Panel",Q=(0,h.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:j});return(0,e.jsxs)(qt._,{title:Q,subtitle:i&&zs(i),onClose:g,tabs:(0,e.jsx)(Ct.U,{children:s.map((ee,J)=>(0,e.jsx)(Ze.o,{label:ee.label,active:ee.value===C,onChangeTab:()=>b(ee.value||_.q.Data)},`${ee.value}-${J}`))}),children:[C===_.q.Data&&(0,e.jsx)(ws.q,{dataName:j,panelPluginId:t.type,fieldConfig:t.fieldConfig,hasTransformations:!!t.transformations?.length,data:i&&i.series,isLoading:r,options:l,onOptionsChange:u,timeZone:a.timezone,app:Ms.Jk.Dashboard}),i&&C===_.q.Meta&&(0,e.jsx)(As,{data:i,metadataDatasource:d}),C===_.q.JSON&&(0,e.jsx)(Vs.w,{panel:t,dashboard:a,data:i,onClose:g}),C===_.q.Error&&(0,e.jsx)(Ls.y,{errors:E}),i&&C===_.q.Stats&&(0,e.jsx)(Rs.N,{data:i,timeZone:a.getTimezone()}),i&&C===_.q.Query&&(0,e.jsx)(Os.e,{data:i,onRefreshQuery:()=>t.refresh()})]})};function Bs(t){let n=t?.errors??[];return t?.error&&!n.includes(t.error)&&(n=[t.error,...n]),!n.length&&t?.state===We.Gu.Error?[{message:"Error loading data"}]:n}function zs(t){const{request:n}=t;if(!n||(0,se.isEmpty)(n))return"";const a=n.targets.length,s=n.endTime?n.endTime-n.startTime:0,i=(0,qe.cN)((0,qe.j_)("ms")(s));return(0,e.jsxs)(h.x6,{i18nKey:"dashboard.inspect.subtitle",children:[{queryCount:a}," queries with total query time of ",{formatted:i}]})}var nn=o(14252);const Ks=({panel:t,dashboard:n,plugin:a})=>{const s=(0,U.zy)(),i=new URLSearchParams(s.search).get("inspectTab"),[r,l]=(0,m.useState)({withTransforms:i===_.q.Error,withFieldConfig:!0}),{data:d,isLoading:c,hasError:u}=Pt(t,r,!1),g=(0,nn.sd)(d),v=(0,nn.kx)(t,n,a,u,g),b=()=>{T.Ny.partial({inspect:null,inspectTab:null})};return a?i===_.q.Help?(0,e.jsx)(Ns,{panel:t,plugin:a,onClose:b}):(0,e.jsx)(Us,{dashboard:n,panel:t,plugin:a,defaultTab:i,tabs:v,data:d,isDataLoading:c,dataOptions:r,onDataOptionsChange:l,metadataDatasource:g,onClose:b}):null},Fs=(t,n)=>{const a=Zt(t,n.panel);return a?{plugin:a.plugin}:{plugin:null}},$s=(0,$.connect)(Fs)(Ks);var an=o(64423),Dt=o(7895),sn=o(65240),on=o(77808),Tt=o(7389),ks=o(8921);const Gs=t=>{const n=(0,m.useMemo)(()=>ut.B.get(t.variable.type).picker,[t.variable]);return t.variable?(0,e.jsxs)(K.B,{gap:0,children:[(0,e.jsx)(Ws,{variable:t.variable}),t.variable.hide!==Tt.zL.hideVariable&&n&&(0,e.jsx)(n,{variable:t.variable,readOnly:t.readOnly??!1})]}):(0,e.jsx)("div",{children:(0,e.jsx)(h.x6,{i18nKey:"variables.picker-renderer.couldnt-load-variable",children:"Couldn't load variable"})})};function Ws({variable:t}){const n=(0,m.useMemo)(()=>t.label||t.name,[t]);if(t.hide!==Tt.zL.dontHide)return null;const a=ks.qz+t.id;return t.description?(0,e.jsx)(Ge.m,{content:t.description,placement:"bottom",children:(0,e.jsx)("label",{className:"gf-form-label gf-form-label--variable","data-testid":f.Tp.pages.Dashboard.SubMenu.submenuItemLabels(n),htmlFor:a,children:n})}):(0,e.jsx)("label",{className:"gf-form-label gf-form-label--variable","data-testid":f.Tp.pages.Dashboard.SubMenu.submenuItemLabels(n),htmlFor:a,children:n})}const rn=({variables:t,readOnly:n})=>{const[a,s]=(0,m.useState)([]),i=(0,P.of)(Hs);return(0,m.useEffect)(()=>{s(t.filter(r=>r.hide!==Tt.zL.hideVariable))},[t]),a.length===0?null:(0,e.jsx)(e.Fragment,{children:a.map(r=>(0,e.jsx)("div",{className:i.submenuItem,"data-testid":f.Tp.pages.Dashboard.SubMenu.submenuItem,children:(0,e.jsx)(Gs,{variable:r,readOnly:n})},r.id))})},Hs=t=>({submenuItem:(0,p.css)({display:"inline-block",".fa-caret-down":{fontSize:"75%",paddingLeft:t.spacing(1)},".gf-form":{marginBottom:0}})});var Qs=o(69289),Js=o(12161),ln=o(75515),Ys=o(97976),Xs=o(74618),Zs=o(37010),qs=o(68373),_s=o(93256),ei=o(41097);const dn=t=>n=>n.plugins.panels[t]||(0,ei.$)(`Panel plugin not found (${t})`,!0),Et=({panel:t})=>{const n=(0,I.useDispatch)(),a=(0,I.useSelector)(dn(t.type)),s=(0,I.useSelector)(d=>d.panelEditor.ui.isPanelOptionsVisible),i=(0,I.useSelector)(d=>d.panelEditor.isVizPickerOpen),r=()=>{n((0,F.eK)(!i))},l=()=>{n(it({isPanelOptionsVisible:!s}))};return a?(0,e.jsx)("div",{className:cn.wrapper,children:(0,e.jsxs)(_s.e,{children:[(0,e.jsx)(Dt.I,{className:cn.vizButton,tooltip:(0,h.t)("dashboard.visualization-button.tooltip-click-to-change-visualization","Click to change visualization"),imgSrc:a.meta.info.logos.small,isOpen:i,onClick:r,"data-testid":f.Tp.components.PanelEditor.toggleVizPicker,"aria-label":(0,h.t)("dashboard.visualization-button.aria-label-change-visualization","Change visualization"),variant:"canvas",fullWidth:!0,children:a.meta.name}),(0,e.jsx)(Dt.I,{tooltip:s?"Close options pane":"Show options pane",icon:s?"angle-right":"angle-left",onClick:l,variant:"canvas","data-testid":f.Tp.components.PanelEditor.toggleVizOptions,"aria-label":s?"Close options pane":"Show options pane"})]})}):null};Et.displayName="VisualizationTab";const cn={wrapper:(0,p.css)({display:"flex",flexDirection:"column"}),vizButton:(0,p.css)({textAlign:"left"})};var ti=o(78685),ni=o(12737),hn=o(92807),ai=o(95943),si=o(92100),ii=o(43652);const oi=({onConfirm:t,onDismiss:n,panel:a})=>{const s=(0,ln.X)(a),i=`${s?"Changing":"Replace with"} library panel`,r=`${s?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return(0,e.jsx)(ht.u,{onConfirm:t,onDismiss:n,confirmText:s?"Change":"Replace",title:i,body:r,dismissText:"Cancel",isOpen:!0})};var ri=o(90232);const li=({panel:t,searchQuery:n})=>{const[a,s]=(0,m.useState)(!1),[i,r]=(0,m.useState)(void 0),[l,d]=(0,m.useState)([]),c=(0,m.useCallback)(C=>{d(C.map(j=>j.id))},[d]),u=(0,Xe.UA)().getCurrent(),g=(0,I.useDispatch)(),v=async()=>{i&&(r(void 0),g((0,q.Xk)(t,i)))},b=()=>s(!0),E=()=>r(void 0);return(0,e.jsxs)(fe.gW,{spacing:"md",children:[!t.libraryPanel&&(0,e.jsx)(fe.gW,{align:"center",children:(0,e.jsx)(x.$n,{icon:"plus",onClick:b,variant:"secondary",fullWidth:!0,children:(0,e.jsx)(h.x6,{i18nKey:"library-panels.panel-library-options-group.create-new-library-panel",children:"Create new library panel"})})}),(0,e.jsx)(si.$,{onChange:c}),(0,e.jsx)("div",{className:di.libraryPanelsView,children:(0,e.jsx)(ri.y,{currentPanelId:t.libraryPanel?.uid,searchString:n,panelFilter:l,onClickCard:r,showSecondaryActions:!0})}),a&&(0,e.jsx)(ii.o,{panel:t,onDismiss:()=>s(!1),initialFolderUid:u?.meta.folderUid,isOpen:a}),i&&(0,e.jsx)(oi,{panel:t,onDismiss:E,onConfirm:v})]})},di={libraryPanelsView:(0,p.css)({width:"100%"})};var ci=o(82472),hi=o(72165),O=o(62667);const un=({panel:t,data:n})=>{const a=(0,I.useSelector)(dn(t.type)),[s,i]=(0,m.useState)(""),r=ai.wV,l=O.__.Visualizations,[d,c]=(0,ti.A)(r,l),u=(0,I.useDispatch)(),g=(0,P.of)(ui),v=(0,m.useRef)(null),b=(0,m.useCallback)(j=>{u((0,q.gW)({panel:t,...j})),j.withModKey||u((0,F.eK)(!1))},[u,t]),E=()=>{u((0,F.eK)(!1))};if(!a)return null;const C=[{label:"Visualizations",value:O.__.Visualizations},{label:"Suggestions",value:O.__.Suggestions},{label:"Library panels",value:O.__.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}];return(0,e.jsxs)("div",{className:g.openWrapper,children:[(0,e.jsxs)("div",{className:g.formBox,children:[(0,e.jsxs)("div",{className:g.searchRow,children:[(0,e.jsx)(ni.Z,{value:s,onChange:i,ref:v,autoFocus:!0,placeholder:(0,h.t)("dashboard.visualization-select-pane.placeholder-search-for","Search for...")}),(0,e.jsx)(x.$n,{title:(0,h.t)("dashboard.visualization-select-pane.title-close","Close"),variant:"secondary",icon:"angle-up",className:g.closeButton,"aria-label":f.Tp.components.PanelEditor.toggleVizPicker,onClick:E})]}),(0,e.jsx)(G.D,{className:g.customFieldMargin,children:(0,e.jsx)(Je.z,{options:C,value:d,onChange:c,fullWidth:!0})})]}),(0,e.jsx)("div",{className:g.scrollWrapper,children:(0,e.jsx)(hn.P,{children:(0,e.jsxs)("div",{className:g.scrollContent,children:[d===O.__.Visualizations&&(0,e.jsx)(hi.G,{pluginId:a.meta.id,onChange:b,searchQuery:s}),d===O.__.Suggestions&&(0,e.jsx)(ci.a,{onChange:b,searchQuery:s,panel:t,data:n}),d===O.__.LibraryPanels&&(0,e.jsx)(li,{searchQuery:s,panel:t},"Panel Library")]})})})]})};un.displayName="VisualizationSelectPane";const ui=t=>({icon:(0,p.css)({color:t.v1.palette.gray33}),wrapper:(0,p.css)({display:"flex",flexDirection:"column",flex:"1 1 0",height:"100%"}),vizButton:(0,p.css)({textAlign:"left"}),scrollWrapper:(0,p.css)({flexGrow:1,minHeight:0}),scrollContent:(0,p.css)({padding:t.spacing(1)}),openWrapper:(0,p.css)({display:"flex",flexDirection:"column",flex:"1 1 100%",height:"100%",background:t.colors.background.primary,border:`1px solid ${t.colors.border.weak}`}),searchRow:(0,p.css)({display:"flex",marginBottom:t.spacing(1)}),closeButton:(0,p.css)({marginLeft:t.spacing(1)}),customFieldMargin:(0,p.css)({marginBottom:t.spacing(1)}),formBox:(0,p.css)({padding:t.spacing(1),paddingBottom:0})}),pi=({plugin:t,panel:n,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:i,dashboard:r,instanceState:l})=>{const d=(0,P.of)(gi),c=(0,I.useSelector)(g=>g.panelEditor.isVizPickerOpen),{data:u}=Pt(n,{withTransforms:!0,withFieldConfig:!1},!0);return(0,e.jsxs)("div",{className:d.wrapper,"data-testid":f.Tp.components.PanelEditor.OptionsPane.content,children:[!c&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:d.vizButtonWrapper,children:(0,e.jsx)(Et,{panel:n})}),(0,e.jsx)("div",{className:d.optionsWrapper,children:(0,e.jsx)(qs.Ff,{panel:n,dashboard:r,plugin:t,instanceState:l,data:u,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:i})})]}),c&&(0,e.jsx)(un,{panel:n,data:u})]})},gi=t=>({wrapper:(0,p.css)({height:"100%",width:"100%",display:"flex",flex:"1 1 0",flexDirection:"column",padding:0}),optionsWrapper:(0,p.css)({flexGrow:1,minHeight:0}),vizButtonWrapper:(0,p.css)({padding:`0 ${t.spacing(2,2)} 0`}),legacyOptions:(0,p.css)({label:"legacy-options",".panel-options-grid":{display:"flex",flexDirection:"column"},".panel-options-group":{marginBottom:0},".panel-options-group__body":{padding:`${t.spacing(2)} 0`},".section":{display:"block",margin:`${t.spacing(2)} 0`,"&:first-child":{marginTop:0}}})});var pn=o(75234),mi=o(67522),vi=o(35307),bi=o(67458),fi=(t=>(t.Error="Error",t.Info="Info",t.Links="Links",t))(fi||{});class xi extends m.Component{constructor(){super(...arguments),this.timeSrv=(0,Ee.jG)(),this.getInfoMode=()=>{const{panel:n,error:a}=this.props;if(a)return"Error";if(n.description)return"Info";if(n.links&&n.links.length)return"Links"},this.getInfoContent=()=>{const{panel:n,theme:a}=this.props,s=n.description||"",i=(0,tn.w)().replace(s,n.scopedVars),r=(0,bi.G)(i),l=this.props.links&&this.props.links.getLinks(n.replaceVariables),d=Si(a);return(0,e.jsxs)("div",{className:d.content,children:[(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:r}}),l&&l.length>0&&(0,e.jsx)("ul",{className:d.cornerLinks,children:l.map((c,u)=>(0,e.jsx)("li",{children:(0,e.jsx)("a",{href:c.href,target:c.target,children:c.title})},u))})]})},this.onClickError=()=>{T.Ny.partial({inspect:this.props.panel.id,inspectTab:_.q.Error})}}render(){const{error:n}=this.props,a=this.getInfoMode();return a?a==="Error"&&n?(0,e.jsx)(gn,{infoMode:a,content:n,onClick:this.onClickError}):a==="Info"||a==="Links"?(0,e.jsx)(gn,{infoMode:a,content:this.getInfoContent}):null:null}}const yi=(0,P.cV)(xi);function gn({infoMode:t,content:n,onClick:a}){const s=t==="Error"?"error":"info",i=f.Tp.components.Panels.Panel.headerCornerInfo(t.toLowerCase()),r=(0,P.of)(Ci);return(0,e.jsx)(Ge.m,{content:n,placement:"top-start",theme:s,interactive:!0,children:(0,e.jsxs)("button",{type:"button",className:r.infoCorner,onClick:a,"aria-label":i,children:[(0,e.jsx)(ie.I,{name:ji[t],size:t==="Links"?"sm":"lg",className:(0,p.cx)(r.icon,{[r.iconLinks]:t==="Links"})}),(0,e.jsx)("span",{className:(0,p.cx)(r.inner,{[r.error]:t==="Error"})})]})})}const ji={Error:"exclamation",Info:"info",Links:"external-link-alt"},Si=t=>({content:(0,p.css)({overflow:"auto",code:{whiteSpace:"normal",wordWrap:"break-word"},"pre > code":{display:"block"}}),cornerLinks:(0,p.css)({listStyle:"none",paddingLeft:0})}),Ci=t=>({icon:(0,p.css)({position:"absolute",top:0,left:0,zIndex:2,fill:t.colors.text.maxContrast}),iconLinks:(0,p.css)({left:t.spacing(.5),top:t.spacing(.25)}),inner:(0,p.css)({width:0,height:0,position:"absolute",left:0,bottom:0,borderBottom:`${t.spacing(4)} solid transparent`,borderLeft:`${t.spacing(4)} solid ${t.colors.background.secondary}`}),error:(0,p.css)({borderLeftColor:t.colors.error.main}),infoCorner:(0,p.css)({background:"none",border:"none",color:t.colors.text.secondary,cursor:"pointer",position:"absolute",left:0,top:0,width:t.spacing(4),height:t.spacing(4),zIndex:3})});function Pi({width:t,height:n,panel:a,dashboard:s}){const{data:i}=Pt(a,{withTransforms:!0,withFieldConfig:!1},!1),[r,l]=(0,m.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});if((0,m.useEffect)(()=>{const c=(0,Ee.jG)(),u=a.events.subscribe(pn._,()=>{const g=(0,A.nk)(a,c.timeRange());a.runAllPanelQueries({dashboardUID:s.uid,dashboardTimezone:s.getTimezone(),timeData:g,width:t})});return()=>{u.unsubscribe()}},[a,s,t]),!i)return null;const d=i?.errors?i.errors.length>1?"Multiple errors found. Click for more details":i.errors[0].message:i?.error?.message;return(0,e.jsx)(mi.NR,{width:t,height:n,padding:"none",children:(c,u)=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(yi,{panel:a,error:d}),(0,e.jsx)(vi.m,{title:(0,h.t)("dashboard.panel-editor-table-view.title-raw-data","Raw data"),pluginId:"table",width:c,height:u,data:i,options:r,onOptionsChange:l})]})})}var mn=o(79104),vn=o(30360),Di=o(13941),bn=o(21764);const Ti=({panel:t,dashboard:n,...a})=>{const{rules:s,loading:i}=(0,bn.S)({panelId:t.id,dashboardUID:n.uid});return(0,e.jsx)(Ze.o,{...a,counter:i?null:s.length})};var Ei=o(6975),Ni=o(5556),fn=o(74268),Ii=o(20437);const xn=({dashboard:t,panel:n,className:a})=>{const s=(0,I.useSelector)(c=>c.templating),i=(0,U.zy)(),{loading:r,value:l}=(0,Y.A)(()=>(0,Ii.mp)(n,t),[n,t,s]);if(r)return(0,e.jsx)(x.$n,{disabled:!0,children:(0,e.jsx)(h.x6,{i18nKey:"alerting.new-rule-from-panel-button.new-alert-rule",children:"New alert rule"})});if(!l)return(0,e.jsx)(Le.F,{severity:"info",title:(0,h.t)("alerting.new-rule-from-panel-button.title-no-alerting-capable-query-found","No alerting capable query found"),children:"Cannot create alerts from this panel because no query to an alerting capable datasource is found."});const d=Ni.kM.renderUrl("alerting/new",{defaults:JSON.stringify(l),returnTo:i.pathname+i.search});return(0,e.jsx)(x.z9,{icon:"bell",onClick:()=>(0,fn.fH)(fn.le.alertRuleFromPanel),href:d,className:a,"data-testid":"create-alert-rule-button",children:(0,e.jsx)(h.x6,{i18nKey:"alerting.new-rule-from-panel-button.new-alert-rule",children:"New alert rule"})})};var Mi=o(22971),yn=o(54),wi=o(77256);const Li=({dashboard:t,panel:n})=>{const a=(0,P.of)(Vi),{errors:s,loading:i,rules:r}=(0,bn.S)({dashboardUID:t.uid,panelId:n.id,poll:!0}),l=(0,yn.Wd)("grafana"),d=B.$.unifiedAlertingEnabled&&he.TP.hasPermission(l.create),c=s.length?(0,e.jsx)(Le.F,{title:(0,h.t)("alerting.panel-alert-tab-content.alert.title-errors-loading-rules","Errors loading rules"),severity:"error",children:s.map((g,v)=>(0,e.jsxs)("div",{children:["Failed to load Grafana rules state: ",(0,wi.JZ)(g)]},v))}):null;if(i&&!r.length)return(0,e.jsxs)("div",{className:a.innerWrapper,children:[c,(0,e.jsx)(Ei._,{text:(0,h.t)("alerting.panel-alert-tab-content.text-loading-rules","Loading rules...")})]});if(r.length)return(0,e.jsx)(hn.P,{minHeight:"100%",children:(0,e.jsxs)("div",{className:a.innerWrapper,children:[c,(0,e.jsx)(Mi.sF,{rules:r}),!!t.meta.canSave&&d&&(0,e.jsx)(xn,{className:a.newButton,panel:n,dashboard:t})]})});const u=!t.uid;return(0,e.jsxs)("div",{"data-testid":f.Tp.components.PanelAlertTabContent.content,className:a.noRulesWrapper,children:[c,!u&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.panel-edit.alerting-tab.no-rules",children:"There are no alert rules linked to this panel."})}),!!t.meta.canSave&&d&&(0,e.jsx)(xn,{panel:n,dashboard:t})]}),u&&!!t.meta.canSave&&(0,e.jsx)(Le.F,{severity:"info",title:(0,h.t)("alerting.panel-alert-tab-content.title-dashboard-not-saved","Dashboard not saved"),children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.panel-edit.alerting-tab.dashboard-not-saved",children:"Dashboard must be saved before alerts can be added."})})]})},Vi=t=>({newButton:(0,p.css)({marginTop:t.spacing(3)}),innerWrapper:(0,p.css)({padding:t.spacing(2)}),noRulesWrapper:(0,p.css)({margin:t.spacing(2),backgroundColor:t.colors.background.secondary,padding:t.spacing(3)})});var Ai=o(34176),Ri=o(7078),Nt=o(28998),Oi=o(32154),Ui=o(77731);class Bi extends m.PureComponent{constructor(n){super(n),this.updateLastUsedDatasource=a=>{(0,Ri.tw)(a)},this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{T.Ny.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=a=>{const{panel:s}=this.props;s.updateQueries(a),a.dataSource.uid!==s.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(n){const a=n.datasource??{default:!0},s=(0,Nt.tR)().getInstanceSettings(a);return this.updateLastUsedDatasource(a),{cacheTimeout:s?.meta.queryOptions?.cacheTimeout?n.cacheTimeout:void 0,dataSource:{default:s?.isDefault,...s?(0,He.p$)(s):{type:void 0,uid:void 0}},queryCachingTTL:s?.cachingConfig?.enabled?n.queryCachingTTL:void 0,queries:n.targets,maxDataPoints:n.maxDataPoints,minInterval:n.interval,timeRange:{from:n.timeFrom,shift:n.timeShift,hide:n.hideTimeOverride}}}async componentDidMount(){const{panel:n}=this.props;if(!n.datasource){let a;const s=(0,Xe.UA)().getCurrent()?.uid??"",i=(0,Ui.CW)(s);i?.datasourceUid!==null&&(a=(0,Nt.tR)().getInstanceSettings(i?.datasourceUid)),a||(a=(0,Nt.tR)().getInstanceSettings(null)),n.datasource=(0,He.p$)(a),this.forceUpdate()}}render(){const{panel:n}=this.props;if(!n.datasource)return null;const a=this.buildQueryOptions(n);return(0,e.jsx)(Oi.g,{options:a,queryRunner:n.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const jn=(0,m.memo)(({panel:t,dashboard:n,tabs:a,onChangeTab:s})=>{const i=(0,mn.C)(),r=(0,P.of)(Ki),l=(0,m.useCallback)(u=>{let g="panel_editor_tabs_changed";B.$.featureToggles.transformationsRedesign&&(g="transformations_redesign_"+g),u.active||(0,ue.rR)(g,{tab_id:u.id}),s(u)},[s]);(0,m.useEffect)(()=>{const u=new an.yU;return u.add(t.events.subscribe(Z.zq,i)),u.add(t.events.subscribe(Z.JI,i)),()=>u.unsubscribe()},[t,n,i]);const d=a.find(u=>u.active);if(a.length===0)return null;const c=B.$.unifiedAlertingEnabled;return(0,e.jsxs)("div",{className:r.wrapper,children:[(0,e.jsx)(Ct.U,{className:r.tabBar,hideBorder:!0,children:a.map(u=>u.id===O.M8.Alert&&c?(0,e.jsx)(Ti,{label:u.text,active:u.active,onChangeTab:()=>s(u),icon:(0,vn.Uo)(u.icon),panel:t,dashboard:n},u.id):(0,e.jsx)(Ze.o,{label:u.text,active:u.active,onChangeTab:()=>l(u),icon:(0,vn.Uo)(u.icon),counter:zi(t,u)},u.id))}),(0,e.jsxs)(Di.J,{className:r.tabContent,children:[d.id===O.M8.Query&&(0,e.jsx)(Bi,{panel:t,queries:t.targets}),d.id===O.M8.Alert&&(0,e.jsx)(Li,{panel:t,dashboard:n}),d.id===O.M8.Transform&&(0,e.jsx)(Ai.o,{panel:t})]})]})});jn.displayName="PanelEditorTabs";function zi(t,n){switch(n.id){case O.M8.Query:return t.targets.length;case O.M8.Alert:return t.alert?1:0;case O.M8.Transform:return(t.getTransformations()??[]).length}return null}const Ki=t=>({wrapper:(0,p.css)({display:"flex",flexDirection:"column",height:"100%"}),tabBar:(0,p.css)({paddingLeft:t.spacing(2)}),tabContent:(0,p.css)({padding:0,display:"flex",flexDirection:"column",flex:1,minHeight:0,background:t.colors.background.primary,border:`1px solid ${t.components.panel.borderColor}`,borderLeft:"none",borderBottom:"none",borderTopRightRadius:t.shape.borderRadius(1.5)})});var Fi=o(41811),$i=o(52161);const ki=(0,Fi.default)((t,n)=>{const a=[];if(!n)return a;let s=O.M8.Visualize;if(n.meta.skipDataQuery)return[];n.meta.skipDataQuery||(s=O.M8.Query,a.push({id:O.M8.Query,text:"Query",icon:"database",active:!1}),a.push({id:O.M8.Transform,text:"Transform data",icon:"process",active:!1})),Gi(n)&&a.push({id:O.M8.Alert,text:"Alert",icon:"bell",active:!1});const i=a.find(r=>r.id===(t||s))??a[0];return i.active=!0,a});function Gi(t){const{unifiedAlertingEnabled:n=!1}=(0,ft.zj)(),a=he.TP.hasPermission((0,yn.Wd)($i.hY).read);if(!(n&&a))return!1;const i=t.meta.id==="graph",r=t.meta.id==="timeseries";return i||r}var Wi=o(61215);const Hi=(t,n)=>{const a=t.panelEditor.getPanel(),s=Zt(t,a);return{panel:a,plugin:s?.plugin,instanceState:s?.instanceState,initDone:t.panelEditor.initDone,uiState:t.panelEditor.ui,tableViewEnabled:t.panelEditor.tableViewEnabled,variables:(0,X.SS)(n.dashboard.uid,t)}},Qi={initPanelEditor:be,discardPanelChanges:Ke,updatePanelEditorUIState:it,updateTimeZoneForSession:Qs.Cj,toggleTableView:F.kw,notifyApp:ge.dx},Ji=(0,$.connect)(Hi,Qi);class Yi extends m.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{T.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{Ft.lE.publish(new Z.S8({component:Zs.$,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,ln.X)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=n=>{T.Ny.partial({tab:n.id})},this.onFieldConfigChange=n=>{this.props.panel.updateFieldConfig({...n})},this.onPanelOptionsChanged=n=>{this.props.panel.updateOptions(n)},this.onPanelConfigChanged=(n,a)=>{this.props.panel.setProperty(n,a),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=n=>{const{updatePanelEditorUIState:a}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),a({mode:n})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{T.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:n,initDone:a}=this.props;a&&!this.eventSubs&&(this.eventSubs=new an.yU,this.eventSubs.add(n.events.subscribe(Z.PR,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(n,a){const{dashboard:s,panel:i,uiState:r,tableViewEnabled:l,theme:d}=this.props;return(0,e.jsxs)("div",{className:n.mainPaneWrapper,children:[this.renderPanelToolbar(n),(0,e.jsx)("div",{className:n.panelWrapper,children:(0,e.jsx)(St.default,{children:({width:c,height:u})=>{if(c<3||u<3)return null;if(a&&(u-=d.spacing.gridSize*2),l)return(0,e.jsx)(Pi,{width:c,height:u,panel:i,dashboard:s});const g=(0,Wi.A)(r.mode,c,u,i);return(0,e.jsx)("div",{className:n.centeringContainer,style:{width:c,height:u},children:(0,e.jsx)("div",{style:g,"data-panelid":i.id,children:(0,e.jsx)(Ys.L,{stateKey:i.key,dashboard:s,panel:i,isEditing:!0,isViewing:!1,lazy:!1,width:g.width,height:g.height},i.key)})})}})})]},"panel")}renderPanelAndEditor(n,a){const{panel:s,dashboard:i,plugin:r,tab:l}=this.props,d=ki(l,r),c=d.length===0,u=this.renderPanel(a,c);return d.length===0?(0,e.jsx)("div",{className:a.onlyPanel,children:u}):(0,e.jsxs)(on.g,{splitOrientation:"horizontal",maxSize:-200,paneSize:n.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:g=>{g&&it({topPaneSize:g/window.innerHeight})},children:[u,(0,e.jsx)("div",{className:a.tabsWrapper,"data-testid":f.Tp.components.PanelEditor.DataPane.content,children:(0,e.jsx)(jn,{panel:s,dashboard:i,tabs:d,onChangeTab:this.onChangeTab},s.key)},"panel-editor-tabs")]})}renderTemplateVariables(n){const{variables:a}=this.props;return a.length?(0,e.jsx)("div",{className:n.variablesWrapper,children:(0,e.jsx)(rn,{variables:a})}):null}renderPanelToolbar(n){const{dashboard:a,uiState:s,variables:i,updateTimeZoneForSession:r,panel:l,tableViewEnabled:d}=this.props;return(0,e.jsx)("div",{className:n.panelToolbar,children:(0,e.jsxs)(fe.Gy,{justify:i.length>0?"space-between":"flex-end",align:"flex-start",children:[this.renderTemplateVariables(n),(0,e.jsxs)(K.B,{gap:1,children:[(0,e.jsx)(Ve.K,{label:(0,h.t)("dashboard.panel-editor-unconnected.table-view-label-table-view","Table view"),showLabel:!0,id:"table-view",value:d,onClick:this.onToggleTableView,"data-testid":f.Tp.components.PanelEditor.toggleTableView}),(0,e.jsx)(Je.z,{value:s.mode,options:O.Nt,onChange:this.onDisplayModeChange}),(0,e.jsx)(Xs.$,{dashboard:a,onChangeTimeZone:r,isOnCanvas:!0}),!s.isPanelOptionsVisible&&(0,e.jsx)(Et,{panel:l})]})]})})}renderEditorActions(){const n="sm";let a=[(0,e.jsx)(x.$n,{onClick:this.onDiscard,title:(0,h.t)("dashboard.panel-editor-unconnected.editor-actions.title-undo-all-changes","Undo all changes"),size:n,variant:"destructive",fill:"outline",children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.panel-editor-unconnected.editor-actions.discard",children:"Discard"})},"discard"),this.props.dashboard.meta.canSave&&(this.props.panel.libraryPanel?(0,e.jsx)(x.$n,{onClick:this.onSaveLibraryPanel,variant:"primary",size:n,title:(0,h.t)("dashboard.panel-editor-unconnected.editor-actions.title-apply-changes-and-save-library-panel","Apply changes and save library panel"),children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.panel-editor-unconnected.editor-actions.save-library-panel",children:"Save library panel"})},"save-panel"):(0,e.jsx)(x.$n,{onClick:this.onSaveDashboard,title:(0,h.t)("dashboard.panel-editor-unconnected.editor-actions.title-apply-changes-and-save-dashboard","Apply changes and save dashboard"),size:n,variant:"secondary",children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.panel-editor-unconnected.editor-actions.save",children:"Save"})},"save")),(0,e.jsx)(x.$n,{onClick:this.onBack,variant:"primary",title:(0,h.t)("dashboard.panel-editor-unconnected.editor-actions.title-apply-changes-dashboard","Apply changes and go back to dashboard"),"data-testid":f.Tp.components.PanelEditor.applyButton,size:n,children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.panel-editor-unconnected.editor-actions.apply",children:"Apply"})},"apply")];return this.props.panel.libraryPanel&&(a.splice(1,0,(0,e.jsx)(me.$s,{children:({showModal:s,hideModal:i})=>(0,e.jsx)(Dt.I,{onClick:()=>{s(Js.l,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:i,isOpen:!0})},title:"Disconnects this panel from the library panel so that you can edit it regularly.",children:(0,e.jsx)(h.x6,{i18nKey:"dashboard.panel-editor-unconnected.unlink",children:"Unlink"})},"unlink")},"unlink-controller")),a.pop()),a}renderOptionsPane(){const{plugin:n,dashboard:a,panel:s,instanceState:i}=this.props;return n?(0,e.jsx)(pi,{plugin:n,dashboard:a,panel:s,instanceState:i,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):(0,e.jsx)("div",{})}render(){const{initDone:n,uiState:a,theme:s,sectionNav:i,pageNav:r,className:l,updatePanelEditorUIState:d}=this.props,c=Zi(s,this.props);return n?(0,e.jsxs)(M.Y,{navModel:i,pageNav:r,"data-testid":f.Tp.components.PanelEditor.General.content,layout:ae.k.Custom,className:l,children:[(0,e.jsx)(Rt.H,{actions:(0,e.jsx)(At.U,{alignment:"right",children:this.renderEditorActions()})}),(0,e.jsxs)("div",{className:c.wrapper,children:[(0,e.jsx)("div",{className:c.verticalSplitPanesWrapper,children:a.isPanelOptionsVisible?(0,e.jsxs)(on.g,{splitOrientation:"vertical",maxSize:-300,paneSize:a.rightPaneSize,primary:"second",onDragFinished:u=>{u&&d({rightPaneSize:u/window.innerWidth})},children:[this.renderPanelAndEditor(a,c),this.renderOptionsPane()]}):this.renderPanelAndEditor(a,c)}),this.state.showSaveLibraryPanelModal&&(0,e.jsx)(L,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel})]})]}):null}}const Xi=(0,P.cV)(Ji(Yi)),Zi=(0,sn.N)((t,n)=>{const{uiState:a}=n,s=t.spacing(2);return{wrapper:(0,p.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:t.spacing(2)}),verticalSplitPanesWrapper:(0,p.css)({display:"flex",flexDirection:"column",height:"100%",width:"100%",position:"relative"}),mainPaneWrapper:(0,p.css)({display:"flex",flexDirection:"column",height:"100%",width:"100%",paddingRight:`${a.isPanelOptionsVisible?0:s}`}),variablesWrapper:(0,p.css)({label:"variablesWrapper",display:"flex",flexGrow:1,flexWrap:"wrap",gap:t.spacing(1,2)}),panelWrapper:(0,p.css)({flex:"1 1 0",minHeight:0,width:"100%",paddingLeft:s}),tabsWrapper:(0,p.css)({height:"100%",width:"100%"}),panelToolbar:(0,p.css)({display:"flex",padding:`0 0 ${s} ${s}`,justifyContent:"space-between",flexWrap:"wrap"}),angularWarning:(0,p.css)({display:"flex",height:t.spacing(4),alignItems:"center"}),toolbarLeft:(0,p.css)({paddingLeft:t.spacing(1)}),centeringContainer:(0,p.css)({display:"flex",justifyContent:"center",alignItems:"center",position:"relative",flexDirection:"column"}),onlyPanel:(0,p.css)({height:"100%",position:"absolute",overflow:"hidden",width:"100%"})}});var qi=o(23753),_i=o(97095),eo=o(18027),to=o(17503),no=o(32380);const ao=({annotation:t,events:n,onEnabledChanged:a})=>{const[s,i]=(0,m.useState)(!1),r=(0,P.of)(so),l=()=>(0,no.Dh)().cancel(t);return(0,m.useEffect)(()=>{const d=n.getStream(Z.xc).subscribe({next:u=>{u.payload===t&&i(!0)}}),c=n.getStream(Z.yj).subscribe({next:u=>{u.payload===t&&i(!1)}});return()=>{d.unsubscribe(),c.unsubscribe()}}),(0,e.jsx)("div",{className:r.annotation,children:(0,e.jsxs)(_i.C,{children:[(0,e.jsx)(eo.I,{label:t.name,disabled:s,"data-testid":f.Tp.pages.Dashboard.SubMenu.Annotations.annotationLabel(t.name),children:(0,e.jsx)(Ve.K,{label:t.name,value:t.enable,onChange:()=>a(t),disabled:s,"data-testid":f.Tp.pages.Dashboard.SubMenu.Annotations.annotationToggle(t.name)})}),(0,e.jsx)("div",{className:r.indicator,children:(0,e.jsx)(to.I,{loading:s,onCancel:l})})]})},t.name)};function so(t){return{annotation:(0,p.css)({display:"inline-block",marginRight:t.spacing(1),".fa-caret-down":{fontSize:"75%",paddingLeft:t.spacing(1)},".gf-form-inline .gf-form":{marginBottom:0}}),indicator:(0,p.css)({alignSelf:"center",padding:`0 ${t.spacing(.5)}`})}}const io=({annotations:t,onAnnotationChanged:n,events:a})=>{const[s,i]=(0,m.useState)([]);return(0,m.useEffect)(()=>{i(t.filter(r=>r.hide!==!0))},[t]),s.length===0?null:(0,e.jsx)("div",{"data-testid":f.Tp.pages.Dashboard.SubMenu.Annotations.annotationsWrapper,children:s.map(r=>(0,e.jsx)(ao,{events:a,annotation:r,onEnabledChanged:n},r.name))})};var oo=o(94701),ro=o(63704),lo=o(82345),Sn=o(4137);const co=({dashboard:t,links:n})=>{const a=(0,mn.C)();return(0,oo.A)(()=>{const s=t.events.subscribe(pn.sR,a);return()=>s.unsubscribe()}),n.length?(0,e.jsx)(e.Fragment,{children:n.map((s,i)=>{const r=(0,lo.mQ)().getAnchorInfo(s),l=`${s.title}-$${i}`;if(s.type==="dashboards")return(0,e.jsx)(Sn.aK,{link:s,linkInfo:r,dashboardUID:t.uid},l);const d=yt.G[s.icon],c=(0,e.jsx)(Sn.Zx,{href:(0,ro.Jf)(r.href),target:s.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":f.Tp.components.DashboardLinks.link,icon:d,children:r.title});return(0,e.jsx)("div",{"data-testid":f.Tp.components.DashboardLinks.container,children:s.tooltip?(0,e.jsx)(Ge.m,{content:r.tooltip,children:c}):c},l)})}):null};class ho extends m.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=n=>{for(let a=0;a<this.props.dashboard.annotations.list.length;a++){const s=this.props.dashboard.annotations.list[a];if(s.name===n.name){s.enable=!s.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()},this.disableSubmitOnEnter=n=>{n.preventDefault()}}render(){const{dashboard:n,variables:a,links:s,annotations:i,theme:r}=this.props,l=po(r),d=n.meta.isSnapshot??!1;return(0,e.jsxs)("div",{className:l.submenu,children:[(0,e.jsx)("form",{"aria-label":(0,h.t)("dashboard.sub-menu-un-connected.aria-label-template-variables","Template variables"),className:l.formStyles,onSubmit:this.disableSubmitOnEnter,children:(0,e.jsx)(rn,{variables:a,readOnly:d})}),(0,e.jsx)(io,{annotations:i,onAnnotationChanged:this.onAnnotationStateChanged,events:n.events}),(0,e.jsx)("div",{className:l.spacer}),n&&(0,e.jsx)(co,{dashboard:n,links:s})]})}}const uo=(t,n)=>{const{uid:a}=n.dashboard,s=(0,X.nx)(a,t);return{variables:(0,X.pi)(a,s.variables)}},po=(0,sn.N)(t=>({formStyles:(0,p.css)({display:"contents",flexWrap:"wrap"}),submenu:(0,p.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignContent:"flex-start",alignItems:"flex-start",gap:`${t.spacing(1)} ${t.spacing(2)}`,padding:`0 0 ${t.spacing(1)} 0`}),spacer:(0,p.css)({flexGrow:1})})),Cn=(0,P.cV)((0,$.connect)(uo)(ho));Cn.displayName="SubMenu";var go=o(77598),mo=o(4405),vo=o(27081),Pn=o(99362);const bo=t=>({initPhase:t.dashboard.initPhase,initError:t.dashboard.initError,dashboard:t.dashboard.getModel(),navIndex:t.navIndex}),fo={initDashboard:vo.v,cleanUpDashboardAndVariables:Ye.Bz,notifyApp:ge.dx,cancelVariables:Ne.Y7,templateVarsChangedInUrl:Ne.Hn},xo=(0,$.connect)(bo,fo),yo=t=>({fullScreenPanel:(0,p.css)({".react-grid-layout":{height:"auto !important",transitionProperty:"none"},".react-grid-item":{display:"none !important",transitionProperty:"none !important","&--fullscreen":{display:"block !important",position:"unset !important",transform:"translate(0px, 0px) !important"}},".panel-header:hover":{backgroundColor:"inherit"},".panel-title-container":{cursor:"pointer"},".react-resizable-handle":{display:"none"}})});class jo extends m.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.updateLiveTimer=()=>{let n;this.props.dashboard?.liveNow&&(n=(0,Ee.jG)().timeRange()),mo.a.setLiveTimeRange(n)},this.setScrollRef=n=>{this.setState({scrollElement:n})},this.onCloseShareModal=()=>{T.Ny.partial({shareView:null})}}static{this.contextType=N.YE}getCleanState(){return{editView:null,editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:n,params:a,queryParams:s}=this.props;n&&this.closeDashboard(),this.props.initDashboard({urlSlug:a.slug,urlUid:a.uid,urlType:a.type,urlFolderUid:s.folderUid,panelType:s.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:a.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(n,a){const{dashboard:s,params:i,templateVarsChangedInUrl:r}=this.props,l=this.props.location.state?.routeReloadCounter;if(s){if(n.params.uid!==i.uid||l!==void 0&&this.forceRouteReloadCounter!==l){this.initDashboard(),this.forceRouteReloadCounter=l;return}if(n.location.search!==this.props.location.search){const d=n.queryParams,c=this.props.queryParams;(c?.from!==d?.from||c?.to!==d?.to)&&((0,Ee.jG)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!d?.refresh&&c?.refresh&&(0,Ee.jG)().setAutoRefresh(c.refresh);const u=(0,w.Wz)(this.props.queryParams,n.queryParams);u&&r(s.uid,u)}this.state.editPanel&&!a.editPanel&&(ce.t.setEditingState(!0),this.props.dashboard?.events.publish(new Z.sL(this.state.editPanel.id))),!this.state.editPanel&&a.editPanel&&(ce.t.setEditingState(!1),this.props.dashboard?.events.publish(new Z.i0(a.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,de.gi)("Permission to edit panel denied")),T.Ny.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,de.gi)("Panel not found")),T.Ny.partial({editPanel:null,viewPanel:null})),this.state.updateScrollTop!==void 0&&this.state.updateScrollTop!==a.updateScrollTop&&this.state.scrollElement?.scrollTo(0,this.state.updateScrollTop)}}static getDerivedStateFromProps(n,a){const{dashboard:s,queryParams:i}=n,r=i.editPanel,l=i.viewPanel,d=i.editview;if(!s)return a;const c={...a};if(!a.editView&&d?(c.editView=d,c.rememberScrollTop=a.scrollElement?.scrollTop,c.updateScrollTop=0):a.editView&&!d&&(c.updateScrollTop=a.rememberScrollTop,c.editView=null),!a.editPanel&&r){const u=s.getPanelByUrlId(r);u?s.canEditPanel(u)?(c.editPanel=u,c.rememberScrollTop=a.scrollElement?.scrollTop):c.editPanelAccessDenied=!0:c.panelNotFound=!0}else a.editPanel&&!r&&(c.editPanel=null,c.updateScrollTop=a.rememberScrollTop);if(!a.viewPanel&&l){const u=s.getPanelByUrlId(l);u?(s.initViewPanel(u),c.viewPanel=u,c.rememberScrollTop=a.scrollElement?.scrollTop,c.updateScrollTop=0):c.panelNotFound=!0}else a.viewPanel&&!l&&(s.exitViewPanel(a.viewPanel),c.viewPanel=null,c.updateScrollTop=a.rememberScrollTop);return(a.panelNotFound||a.editPanelAccessDenied&&!r)&&(c.panelNotFound=!1,c.editPanelAccessDenied=!1),So(n,c)}getInspectPanel(){const{dashboard:n,queryParams:a}=this.props,s=a.inspect;if(!n||!s)return null;const i=n.getPanelById(parseInt(s,10));return i||null}render(){const{dashboard:n,initError:a,queryParams:s,theme:i,params:r}=this.props,{editPanel:l,viewPanel:d,pageNav:c,sectionNav:u}=this.state,g=ye(this.props.queryParams),v=yo(i);if(!n||!c||!u)return(0,e.jsx)(nt.P,{initPhase:this.props.initPhase});const b=this.getInspectPanel(),E=!l&&!g&&!this.props.queryParams.editview&&n.isSubMenuVisible(),C=g!==I.KioskMode.Full&&!s.editview&&!a,j=(0,p.cx)({[v.fullScreenPanel]:!!d,"page-hidden":!!(s.editview||l)});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(M.Y,{navModel:u,pageNav:c,layout:ae.k.Canvas,className:j,onSetScrollRef:this.setScrollRef,children:[C&&(0,e.jsx)("header",{"data-testid":f.Tp.pages.Dashboard.DashNav.navV2,children:(0,e.jsx)(Be.Ay,{dashboard:n,title:n.title,folderTitle:n.meta.folderTitle,isFullscreen:!!d,kioskMode:g,hideTimePicker:n.timepicker.hidden})}),(0,e.jsx)(Mt,{dashboard:n}),a&&(0,e.jsx)(Pn.i,{error:a.error,type:r.type}),E&&(0,e.jsx)("section",{"aria-label":f.Tp.pages.Dashboard.SubMenu.submenu,children:(0,e.jsx)(Cn,{dashboard:n,annotations:n.annotations.list,links:n.links})}),!a&&(0,e.jsx)(go.N,{dashboard:n,isEditable:!!n.meta.canEdit,viewPanel:d,editPanel:l}),b&&(0,e.jsx)($s,{dashboard:n,panel:b}),s.shareView&&(0,e.jsx)(qi.Zy,{dashboard:n,onDismiss:this.onCloseShareModal,activeTab:s.shareView})]}),l&&(0,e.jsx)(Xi,{dashboard:n,sourcePanel:l,tab:this.props.queryParams.tab,sectionNav:u,pageNav:c}),s.editview&&(0,e.jsx)(bs,{dashboard:n,editview:s.editview,pageNav:c,sectionNav:u})]})}}function So(t,n){const{dashboard:a,navIndex:s}=t;if(!a)return n;let i=n.pageNav,r=n.sectionNav;(!i||a.title!==i.text||a.meta.folderUrl!==i.parentItem?.url)&&(i={text:a.title,url:le.I.getUrlForPartial(t.location,{editview:null,editPanel:null,viewPanel:null})}),r=(0,Pe.tc)(t.navIndex,Ue.L1+a.uid,(0,Pe.tc)(t.navIndex,"dashboards/browse"));const{folderUid:l}=a.meta;if(l&&i&&r.main.id!=="starred"){const d=(0,Pe.tc)(s,`folder-dashboards-${l}`).main;d.id!=="not-found"&&(i={...i,parentItem:d})}return(n.editPanel||n.viewPanel)&&(i={...i,text:`${n.editPanel?"Edit":"View"} panel`,parentItem:i,url:void 0}),n.pageNav===i&&n.sectionNav===r?n:{...n,pageNav:i,sectionNav:r}}const Dn=(0,P.cV)(jo);Dn.displayName="DashboardPage";const Tn=xo(Dn);function Co(t){const n=t.queryParams.scenes===!0,a=t.queryParams.scenes===!1,s=(0,U.g)(),i=(0,U.zy)(),r=(0,oe.sP)();if(n||B.$.featureToggles.dashboardScene&&!a)return(0,e.jsx)(ne.default,{...t});const l=!!(t.route.routeName===I.DashboardRoutes.Home||t.route.routeName===I.DashboardRoutes.Normal&&s.uid),d=(0,Y.A)(async()=>s.type==="snapshot"?null:r.fetchDashboard({route:t.route.routeName,uid:s.uid??"",type:s.type,slug:s.slug}),[s.uid,t.route.routeName]);if(d.error)return(0,e.jsx)(Pn.i,{error:d.error});if(d.loading)return null;const c=d.value&&(0,re.HG)(d.value)?d.value.metadata.name:d.value?.meta.uid,u=d.value&&(0,re.HG)(d.value)?d.value?.access.canEdit:d.value?.meta?.canEdit||d.value?.meta?.canMakeEditable,g=!c;return c!==s.uid&&!g?null:B.$.featureToggles.dashboardSceneForViewers?!u&&l&&!a?(0,e.jsx)(ne.default,{...t}):(0,e.jsx)(Tn,{...t,params:s,location:i}):(0,e.jsx)(Tn,{...t,params:s,location:i})}const Po=Co},85680:(Oe,te,o)=>{o.d(te,{Bz:()=>T,Q9:()=>le,Ss:()=>ge,TA:()=>f,lC:()=>P});var e=o(68143),U=o(6890),Y=o(64762),B=o(18646),ne=o(79718),oe=o(89224),I=o(69289),re=o(37256),p=o(39167),m=o(22429),$=o(75421),ae=o(37918);function le(M,N){return async de=>{await(0,e.AI)().post("/api/dashboards/import",M),de((0,U.dx)((0,Y.tZ)("Dashboard Imported",N))),de((0,re.h9)())}}function f(M){return async N=>{await(0,B.n)().deleteDashboard(M,!1),N((0,re.h9)())}}const T=()=>(M,N)=>{const ye=N().dashboard.getModel();ye&&(ye.destroy(),M((0,p.Y7)(ye.uid))),(0,$.jG)().stopAutoRefresh(),M((0,ae.p0)()),M((0,oe.rG)()),ne.t.leave(),(0,m.UA)().setCurrent(void 0)},P=M=>N=>{N((0,I.Cj)(M)),(0,$.jG)().refreshTimeModel()},ge=M=>N=>{N((0,I.xu)(M)),(0,$.jG)().refreshTimeModel()}},96727:(Oe,te,o)=>{o.d(te,{H:()=>Y});var e=o(63704),U=o(74101);const Y=()=>{const[B]=(0,U.z)(),ne=B.get("pull_request_url");if(ne)return e.sQ.sanitizeUrl(decodeURIComponent(ne))}}}]);

//# sourceMappingURL=8528.46e817e994668954b765.js.map