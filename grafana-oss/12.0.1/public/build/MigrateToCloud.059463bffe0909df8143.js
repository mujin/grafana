"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3704],{2681:(Ft,te,u)=>{u.r(te),u.d(te,{default:()=>wt});var e=u(74848),H=u(43173),ye=u(13791),A=u(31286),h=u(41654),r=u(56840),d=u(66404),G=u(89640);const L=({children:n,title:o,linkHref:s,linkTitle:a})=>(0,e.jsxs)(h.B,{gap:2,direction:"column",children:[(0,e.jsx)(d.E,{element:"h4",children:o}),(0,e.jsx)(d.E,{color:"secondary",children:n}),s&&(0,e.jsx)(G.Y,{href:s,external:!0,children:a??s})]}),xe=()=>(0,e.jsx)(L,{title:(0,r.t)("migrate-to-cloud.migrate-to-this-stack.title","Let us help you migrate to this stack"),children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.migrate-to-this-stack.body",children:"You can securely migrate some resources from your self-managed Grafana installation to this cloud stack. To get started, you'll need to generate a migration token. Your self-managed instance will use the token to authenticate with this cloud stack."})});var z=u(22803),V=u(63142);const je=()=>{const n=(0,V.of)(Ee);return(0,e.jsxs)(A.a,{alignItems:"flex-start",display:"flex",direction:"column",gap:2,children:[(0,e.jsx)(L,{title:(0,r.t)("migrate-to-cloud.get-started.title","Performing a migration"),linkTitle:(0,r.t)("migrate-to-cloud.get-started.link-title","Learn more about Private Data Source Connect"),linkHref:"https://grafana.com/docs/grafana-cloud/connect-externally-hosted/private-data-source-connect",children:(0,e.jsxs)(h.B,{direction:"column",gap:2,children:[(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.get-started.body",children:"The migration process must be started from your self-managed Grafana instance."}),(0,e.jsxs)("ol",{className:n.list,children:[(0,e.jsx)("li",{children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.get-started.step-1",children:"Log in to your self-managed instance and navigate to Administration > General > Migrate to Grafana Cloud."})}),(0,e.jsx)("li",{children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.get-started.step-2",children:'Select "Migrate this instance to Cloud".'})}),(0,e.jsx)("li",{children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.get-started.step-3",children:`You'll be prompted for a migration token. Generate one from this screen. Enter your token and click "Connect to this stack".`})}),(0,e.jsx)("li",{children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.get-started.step-4",children:'After connecting to the cloud stack, click "Build snapshot" to create a snapshot of your self-managed instance.'})}),(0,e.jsx)("li",{children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.get-started.step-5",children:'After a snapshot is created, click "Upload snapshot" to copy the resources to your cloud stack.'})}),(0,e.jsx)("li",{children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.get-started.step-6",children:"If some of your data sources will not work over the public internet, you\u2019ll need to install Private Data Source Connect in your self-managed environment."})})]})]})}),(0,e.jsx)(G.Y,{href:"/connections/private-data-source-connections",external:!0,children:(0,r.t)("migrate-to-cloud.get-started.configure-pdc-link","Configure PDC for this stack")}),(0,e.jsx)(G.Y,{href:"https://grafana.com/docs/grafana-cloud/account-management/migration-guide",external:!0,children:(0,r.t)("migrate-to-cloud.migrate-to-this-stack.link-title","View the full migration guide")})]})},Ee=n=>({list:(0,z.css)({padding:"revert"})});var m=u(96540),X=u(27489),v=u(45861),T=u(2495),re=u(68143);function J(n){if(!(0,re.NF)(n)||typeof n.data!="object"||!n.data)return null;const o=n?.data,s="message"in o&&typeof o.message=="string"?o.message:null,a="messageId"in o&&typeof o.messageId=="string"?o.messageId:null,i="statusCode"in o&&typeof o.statusCode=="number"?o.statusCode:null;return!s||!a||!i?null:{message:s,messageId:a,statusCode:i}}var Q=u(34999);function ne(){return(0,e.jsx)(Q.F,{severity:"error",title:(0,r.t)("migrate-to-cloud.migration-token.error-title","Something went wrong"),children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.migration-token.error-body",children:"Unable to generate a migration token. Please try again later."})})}var B=u(22787),oe=u(47931),se=u(37386),ae=u(63527);const Ie=({isOpen:n,hideModal:o,migrationToken:s})=>(0,e.jsxs)(B.a,{isOpen:n,title:(0,r.t)("migrate-to-cloud.migration-token.modal-title","Migration token created"),onDismiss:o,children:[s?(0,e.jsx)(be,{migrationToken:s}):(0,e.jsx)(ne,{}),(0,e.jsxs)(B.a.ButtonRow,{children:[(0,e.jsx)(v.$n,{variant:"secondary",onClick:o,children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.migration-token.modal-close",children:"Close"})}),s&&(0,e.jsx)(oe.b,{variant:"primary",getText:()=>s,onClipboardCopy:o,children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.migration-token.modal-copy-and-close",children:"Copy to clipboard and close"})})]})]});function be({migrationToken:n}){const o=(0,m.useId)();return(0,e.jsx)(se.D,{description:(0,r.t)("migrate-to-cloud.migration-token.modal-field-description","Copy the token now, as you will not be able to see it again. Losing this token requires creating a new one."),htmlFor:o,label:(0,r.t)("migrate-to-cloud.migration-token.modal-field-label","Token"),children:(0,e.jsxs)(h.B,{children:[(0,e.jsx)(ae.p,{id:o,value:n,readOnly:!0}),(0,e.jsx)(oe.b,{icon:"clipboard-alt",getText:()=>n,children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.migration-token.modal-copy-button",children:"Copy to clipboard"})})]})})}var ke=u(71599);function Ce(n){const{isOpen:o,hasError:s,onConfirm:a,onDismiss:i}=n,l=(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.delete-migration-token-confirm.body",children:"If you've already used this token with a self-managed installation, that installation will no longer be able to upload content."})}),s&&(0,e.jsx)(Q.F,{severity:"error",title:(0,r.t)("migrate-to-cloud.delete-migration-token-confirm.error-title","Error deleting token")})]});return(0,e.jsx)(ke.u,{isOpen:o,title:(0,r.t)("migrate-to-cloud.delete-migration-token-confirm.title","Delete migration token"),body:l,confirmText:(0,r.t)("migrate-to-cloud.delete-migration-token-confirm.confirm-button","Delete token"),onConfirm:a,onDismiss:i})}var Z=u(70255);const Te=({hasToken:n,errorMessageId:o,isFetching:s})=>s?(0,e.jsx)(Z.A,{width:100}):n?(0,e.jsx)(d.E,{color:"success",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.token-status.active",children:"Token created and active"})}):o==="cloudmigrations.tokenNotFound"?(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.token-status.no-active",children:"No active token"}):o?(0,e.jsx)(d.E,{color:"error",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.token-status.unknown-error",children:"Error retrieving token"})}):(0,e.jsx)(d.E,{color:"warning",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.token-status.unknown",children:"Unknown"})}),Se=()=>{const[n,o]=(0,m.useState)(!1),[s,a]=(0,m.useState)(!1),i=(0,T.YX)(),[l,c]=(0,T.dX)(),[g,p]=(0,T.WH)(),f=J(i.error),j=!!i.data?.id&&f?.statusCode!==404,y=i.isFetching||c.isLoading,E=(0,m.useCallback)(async()=>{(0,X.rR)("grafana_e2c_generate_token_clicked"),"error"in await l()||o(!0)},[l]),N=(0,m.useCallback)(async()=>{if(!i.data?.id)return;(0,X.rR)("grafana_e2c_delete_token_clicked"),"error"in await g({uid:i.data.id})||a(!1)},[g,i.data]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(A.a,{display:"flex",alignItems:"flex-start",direction:"column",gap:2,children:[c?.isError?(0,e.jsx)(ne,{}):(0,e.jsx)(d.E,{color:"secondary",children:(0,e.jsxs)(r.x6,{i18nKey:"migrate-to-cloud.migration-token.status",children:["Current status:"," ",(0,e.jsx)(Te,{hasToken:j,isFetching:y,errorMessageId:f?.messageId})]})}),j?(0,e.jsx)(v.$n,{onClick:()=>a(!0),variant:"destructive",children:(0,r.t)("migrate-to-cloud.migration-token.delete-button","Delete token")}):(0,e.jsx)(v.$n,{disabled:y,onClick:E,children:c.isLoading?(0,r.t)("migrate-to-cloud.migration-token.generate-button-loading","Generating a migration token..."):(0,r.t)("migrate-to-cloud.migration-token.generate-button","Generate a migration token")})]}),(0,e.jsx)(Ie,{isOpen:n,hideModal:()=>{(0,X.rR)("grafana_e2c_generated_token_modal_dismissed"),o(!1)},migrationToken:c.data?.token}),(0,e.jsx)(Ce,{isOpen:s,onConfirm:N,onDismiss:()=>a(!1),hasError:!!p.error})]})},ve=()=>(0,e.jsx)(A.a,{backgroundColor:"secondary",display:"flex",alignItems:"center",direction:"column",children:(0,e.jsxs)(A.a,{maxWidth:90,paddingY:6,paddingX:2,gap:6,direction:"column",display:"flex",children:[(0,e.jsxs)(h.B,{gap:2,direction:"column",children:[(0,e.jsx)(xe,{}),(0,e.jsx)(Se,{})]}),(0,e.jsx)(je,{})]})});var q=u(10378);function ie(n){const{error:o,children:s,...a}=n,i=Re(o);return(0,e.jsx)(Q.F,{...a,children:(0,e.jsxs)(h.B,{direction:"column",gap:1,children:[s,i&&(0,e.jsxs)(d.E,{element:"p",color:"secondary",variant:"bodySmall",children:["Trace ID: ",i]})]})})}function Re(n){const o=(0,re.NF)(n)?n.data:n;if(typeof o=="object"&&o&&"traceID"in o&&typeof o.traceID=="string")return o.traceID}var $=u(30703),ce=u(32635),_=u(35137),Ae=u(45967);function Ne(n){const o=new Map,s=new Map;for(const a of n){const i=a.resourceType,l=a.dependencies||[];o.set(i,l);for(const c of l)s.has(c)||s.set(c,[]),s.get(c)?.push(i)}return{dependencyMap:o,dependentMap:s}}function De(n,o,s){const a=new Set(o);function i(l,c){c.has(l)||(c.add(l),a.add(l),n.get(l)?.forEach(g=>i(g,c)))}return i(s,new Set),a}function Le(n,o,s){const a=new Set(o);function i(l,c){c.has(l)||(c.add(l),a.delete(l),n.get(l)?.forEach(g=>i(g,c)))}return i(s,new Set),a}function le(n){switch(n){case"DASHBOARD":return"dashboard";case"FOLDER":return"folder";case"DATASOURCE":return"database";case"LIBRARY_ELEMENT":return"library-panel";case"MUTE_TIMING":return"clock-nine";case"NOTIFICATION_TEMPLATE":return"file-alt";case"CONTACT_POINT":return"at";case"NOTIFICATION_POLICY":return"comment-alt";case"ALERT_RULE":return"bell";case"ALERT_RULE_GROUP":return"bell";case"PLUGIN":return"plug";default:return}}function de(n){switch(n){case"DASHBOARD":return(0,r.t)("migrate-to-cloud.resource-types.dashboard","Dashboards");case"FOLDER":return(0,r.t)("migrate-to-cloud.resource-types.folder","Folders");case"DATASOURCE":return(0,r.t)("migrate-to-cloud.resource-types.datasource","Data Sources");case"LIBRARY_ELEMENT":return(0,r.t)("migrate-to-cloud.resource-types.library_element","Library Elements");case"MUTE_TIMING":return(0,r.t)("migrate-to-cloud.resource-types.mute_timing","Mute Timings");case"NOTIFICATION_TEMPLATE":return(0,r.t)("migrate-to-cloud.resource-types.notification_template","Notification Templates");case"CONTACT_POINT":return(0,r.t)("migrate-to-cloud.resource-types.contact_point","Contact Points");case"NOTIFICATION_POLICY":return(0,r.t)("migrate-to-cloud.resource-types.notification_policy","Notification Policies");case"ALERT_RULE":return(0,r.t)("migrate-to-cloud.resource-types.alert_rule","Alert Rules");case"ALERT_RULE_GROUP":return(0,r.t)("migrate-to-cloud.resource-types.alert_rule_group","Alert Rule Groups");case"PLUGIN":return(0,r.t)("migrate-to-cloud.resource-types.plugin","Plugins");default:return}}const ue=["ALERT_RULE","NOTIFICATION_POLICY","NOTIFICATION_TEMPLATE","CONTACT_POINT","MUTE_TIMING"],we=["DASHBOARD","LIBRARY_ELEMENT","DATASOURCE","PLUGIN","FOLDER","ALERT_RULE_GROUP",...ue],Oe=!0;function Pe(n){return Oe&&we.filter(o=>n.includes(o))}function Ge(n){const{disabled:o,isLoading:s,onClick:a,resourceDependencies:i}=n,[l,c]=(0,m.useState)(new Set),[g,p]=(0,m.useState)(!0),{dependencyMap:f,dependentMap:j}=Ne(i),y=Pe(Array.from(f.keys()));(0,m.useEffect)(()=>{c(new Set(y))},[]);const E=b=>{const D=b.target.checked;p(D),c(D?new Set(y):new Set)},N=b=>D=>{const O=D.target.checked?De(f,l,b):Le(j,l,b);c(O),p(O.size===y.length)},S=()=>{a(Array.from(l))};return(0,e.jsxs)(h.B,{direction:"column",gap:3,children:[(0,e.jsxs)(h.B,{direction:"column",gap:1,children:[(0,e.jsx)(d.E,{variant:"h4",children:(0,e.jsxs)(h.B,{direction:"row",gap:1,alignItems:"center",children:[(0,e.jsx)($.I,{name:"cog",size:"lg"}),(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.configure-snapshot.title",children:"Configure snapshot"})]})}),(0,e.jsxs)(d.E,{color:"secondary",children:[(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.configure-snapshot.description",children:"Select which resources you want to include in the snapshot to migrate."}),(0,e.jsx)("br",{}),(0,e.jsx)(d.E,{weight:"bold",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.configure-snapshot.description-sub-line",children:"Some resources may depend on others and will be automatically selected or deselected."})})]})]}),(0,e.jsxs)(h.B,{direction:"column",gap:2,alignItems:"flex-start",children:[(0,e.jsxs)(h.B,{direction:"column",gap:1,alignItems:"flex-start",children:[(0,e.jsx)(h.B,{alignItems:"flex-start",children:(0,e.jsx)(ce.S,{indeterminate:l.size>0&&!g,value:g,onChange:E,"data-testid":"migrate-to-cloud-configure-snapshot-checkbox-resource-include-all",label:(0,e.jsx)(d.E,{variant:"h5",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.configure-snapshot.resource-include-all",children:"Include all"})})})},"include-all"),y.map(b=>(0,e.jsxs)(h.B,{gap:1,alignItems:"center",children:[(0,e.jsx)(_.$,{h:ue.includes(b)?2:.25}),(0,e.jsx)(ce.S,{value:l.has(b),onChange:N(b),"data-testid":`migrate-to-cloud-configure-snapshot-checkbox-resource-${b.toLowerCase()}`,label:(0,e.jsxs)(h.B,{gap:1,alignItems:"center",children:[(0,e.jsx)($.I,{name:le(b),size:"xl"}),(0,e.jsx)(d.E,{variant:"h5",children:de(b)??b})]})})]},b))]}),(0,e.jsxs)(A.a,{display:"flex",justifyContent:"flex-start",alignItems:"center",gap:1,children:[(0,e.jsx)(v.$n,{disabled:o||l.size===0,onClick:S,icon:s?"spinner":void 0,"data-testid":"migrate-to-cloud-configure-snapshot-build-snapshot-button",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.summary.start-migration",children:"Build snapshot"})}),(0,e.jsx)(Ae.m,{content:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.building-snapshot.description-eta",children:"Creating a snapshot typically takes less than two minutes."}),placement:"right",interactive:!0,children:(0,e.jsx)($.I,{name:"info-circle",size:"lg"})})]})]})]})}var Me=u(13943),Ue=u(49785);function Be(n){switch(n){case"cloudmigrations.createMigration.tokenInvalid":return(0,r.t)("migrate-to-cloud.connect-modal.token-errors.token-invalid","Token is not valid. Generate a new token on your cloud instance and try again.");case"cloudmigrations.createMigration.tokenRequestError":return(0,r.t)("migrate-to-cloud.connect-modal.token-errors.token-request-error","An error occurred while validating the token. Please check the Grafana instance logs.");case"cloudmigrations.createMigration.tokenValidationFailure":return(0,r.t)("migrate-to-cloud.connect-modal.token-errors.token-validation-failure","Token is not valid. Please ensure the token matches the migration token on your cloud instance.");case"cloudmigrations.createMigration.instanceUnreachable":return(0,r.t)("migrate-to-cloud.connect-modal.token-errors.instance-unreachable","The cloud instance cannot be reached. Make sure the instance is running and try again.");case"cloudmigrations.createMigration.instanceRequestError":return(0,r.t)("migrate-to-cloud.connect-modal.token-errors.instance-request-error","An error occurred while attempting to verify the cloud instance's connectivity. Please check the network settings or cloud instance status.");case"cloudmigrations.createMigration.sessionCreationFailure":return(0,r.t)("migrate-to-cloud.connect-modal.token-errors.session-creation-failure","There was an error creating the migration. Please try again.");case"cloudmigrations.createMigration.migrationDisabled":return(0,r.t)("migrate-to-cloud.connect-modal.token-errors.migration-disabled","Cloud migrations are disabled on this instance.");default:return(0,r.t)("migrate-to-cloud.connect-modal.token-errors.token-not-saved","There was an error saving the token. See the Grafana server logs for more details.")}}const Fe=({isOpen:n,isLoading:o,error:s,hideModal:a,onConfirm:i})=>{const l=(0,m.useId)(),c=(0,V.of)(Ke),{handleSubmit:g,register:p,formState:{errors:f},watch:j}=(0,Ue.mN)({defaultValues:{token:""}}),y=j("token"),E=N=>{i({cloudMigrationSessionRequestDto:{authToken:N.token}}).then(S=>{typeof S=="object"&&S&&"error"in S||a()})};return(0,e.jsx)(B.a,{isOpen:n,title:(0,r.t)("migrate-to-cloud.connect-modal.title","Connect to a cloud stack"),onDismiss:a,children:(0,e.jsxs)("form",{onSubmit:g(E),children:[(0,e.jsx)(d.E,{color:"secondary",children:(0,e.jsxs)(h.B,{direction:"column",gap:2,children:[(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.connect-modal.body-get-started",children:"To get started, you'll need a Grafana.com account."}),(0,e.jsx)("div",{children:(0,e.jsx)(G.Y,{href:"https://grafana.com/auth/sign-up/create-user?pg=prod-cloud",external:!0,children:(0,r.t)("migrate-to-cloud.connect-modal.body-sign-up","Sign up for a Grafana.com account")})}),(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.connect-modal.body-cloud-stack",children:"You'll also need a cloud stack. If you just signed up, we'll automatically create your first stack. If you have an account, you'll need to select or create a stack."}),(0,e.jsx)("div",{children:(0,e.jsx)(G.Y,{href:"https://grafana.com/auth/sign-in/",external:!0,children:(0,r.t)("migrate-to-cloud.connect-modal.body-view-stacks","View my cloud stacks")})}),(0,e.jsx)("div",{children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.connect-modal.body-token",children:"Your self-managed Grafana installation needs special access to securely migrate content. You'll need to create a migration token on your chosen cloud stack."})}),(0,e.jsx)("div",{children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.connect-modal.body-token-instructions",children:"Log into your cloud stack and navigate to Administration > General > Migrate to Grafana Cloud. Create a migration token on that screen and paste the token here."})}),s?(0,e.jsx)(ie,{error:s,severity:"error",title:(0,r.t)("migrate-to-cloud.connect-modal.token-error-title","Error saving token"),children:(0,e.jsx)(d.E,{element:"p",children:Be(J(s)?.messageId||"")||"There was an error saving the token. See the Grafana server logs for more details."})}):void 0,(0,e.jsx)(se.D,{className:c.field,invalid:!!f.token,error:f.token?.message,label:(0,r.t)("migrate-to-cloud.connect-modal.body-token-field","Migration token"),required:!0,children:(0,e.jsx)(ae.p,{...p("token",{required:(0,r.t)("migrate-to-cloud.connect-modal.token-required-error","Migration token is required")}),id:l,placeholder:(0,r.t)("migrate-to-cloud.connect-modal.body-token-field-placeholder","Paste token here"),"data-testid":"migrate-to-cloud-connect-session-modal-token-input"})})]})}),(0,e.jsxs)(B.a.ButtonRow,{children:[(0,e.jsx)(v.$n,{variant:"secondary",onClick:a,children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.connect-modal.cancel",children:"Cancel"})}),(0,e.jsx)(v.$n,{type:"submit",disabled:o||!y,"data-testid":"migrate-to-cloud-connect-session-modal-connect-button",children:o?(0,r.t)("migrate-to-cloud.connect-modal.connecting","Connecting to this stack..."):(0,r.t)("migrate-to-cloud.connect-modal.connect","Connect to this stack")})]})]})})},Ke=n=>({field:(0,z.css)({alignSelf:"stretch"})}),Ye=()=>{const[n,o]=(0,m.useState)(!1),[s,a]=(0,T.hZ)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(A.a,{display:"flex",gap:2,direction:"column",alignItems:"center",backgroundColor:"secondary",children:[(0,e.jsx)(d.E,{variant:"h3",textAlignment:"center",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.cta.header",children:"Let us manage your Grafana stack"})}),(0,e.jsx)(v.$n,{"data-testid":"migrate-to-cloud-connect-session-modal-button",disabled:a.isLoading,onClick:()=>o(!0),children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.cta.button",children:"Migrate this instance to Cloud"})})]}),(0,e.jsx)(Fe,{isOpen:n,isLoading:a.isLoading,error:a.error,onConfirm:s,hideModal:()=>o(!1)})]})},He=()=>(0,e.jsxs)(h.B,{gap:4,direction:"column",children:[(0,e.jsx)(L,{title:(0,r.t)("migrate-to-cloud.what-is-cloud.title","What is Grafana Cloud?"),linkTitle:(0,r.t)("migrate-to-cloud.what-is-cloud.link-title","Learn about cloud features"),linkHref:"https://grafana.com/products/cloud",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.what-is-cloud.body",children:"Grafana cloud is a fully managed cloud-hosted observability platform ideal for cloud native environments. It's everything you love about Grafana without the overhead of maintaining, upgrading, and supporting an installation."})}),(0,e.jsx)(L,{title:(0,r.t)("migrate-to-cloud.why-host.title","Why host with Grafana?"),linkTitle:(0,r.t)("migrate-to-cloud.why-host.link-title","More questions? Talk to an expert"),linkHref:"https://grafana.com/contact",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.why-host.body",children:"In addition to the convenience of managed hosting, Grafana Cloud includes many cloud-exclusive features like SLOs, incident management, machine learning, and powerful observability integrations."})}),(0,e.jsx)(L,{title:(0,r.t)("migrate-to-cloud.is-it-secure.title","Is it secure?"),linkTitle:(0,r.t)("migrate-to-cloud.is-it-secure.link-title","Grafana Labs Trust Center"),linkHref:"https://trust.grafana.com",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.is-it-secure.body",children:"Grafana Labs is committed to maintaining the highest standards of data privacy and security. By implementing industry-standard security technologies and procedures, we help protect our customers' data from unauthorized access, use, or disclosure."})})]}),$e=()=>(0,e.jsxs)(h.B,{gap:4,direction:"column",children:[(0,e.jsx)(L,{title:(0,r.t)("migrate-to-cloud.pdc.title","What if not all my data sources are on the public internet?"),linkTitle:(0,r.t)("migrate-to-cloud.pdc.link-title","Learn about PDC"),linkHref:"https://grafana.com/docs/grafana-cloud/connect-externally-hosted/private-data-source-connect",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.pdc.body",children:"Exposing your data sources to the internet can raise security concerns. Private data source connect (PDC) allows Grafana Cloud to access your existing data sources over a secure network tunnel."})}),(0,e.jsx)(L,{title:(0,r.t)("migrate-to-cloud.pricing.title","How much does it cost?"),linkTitle:(0,r.t)("migrate-to-cloud.pricing.link-title","Grafana Cloud pricing"),linkHref:"https://grafana.com/pricing",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.pricing.body",children:"Grafana Cloud has a generous free plan and a 14 day unlimited usage trial. After your trial expires, you'll be billed based on usage over the free plan limits."})}),(0,e.jsx)(L,{title:(0,r.t)("migrate-to-cloud.can-i-move.title","Where can I learn more about migrating to Grafana Cloud?"),linkTitle:(0,r.t)("migrate-to-cloud.can-i-move.link-title","Learn about migrating to Grafana Cloud"),linkHref:"https://grafana.com/docs/grafana-cloud/account-management/migration-guide",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.can-i-move.body",children:"You can use the migration assistant to migrate a large proportion of your Grafana resources."})})]}),We=()=>(0,e.jsx)(A.a,{backgroundColor:"secondary",display:"flex",alignItems:"center",direction:"column",children:(0,e.jsx)(A.a,{maxWidth:180,paddingY:6,paddingX:2,children:(0,e.jsxs)(h.B,{gap:5,direction:"column",children:[(0,e.jsx)(Ye,{}),(0,e.jsxs)(Me.x,{alignItems:"flex-start",gap:4,columns:{xs:1,lg:2},children:[(0,e.jsx)(He,{}),(0,e.jsx)($e,{})]})]})})});var ze=u(21285),Ve=u(12810);function F({title:n,children:o}){return(0,e.jsxs)(A.a,{minWidth:{xs:0,xxl:16},display:"flex",direction:"column",children:[(0,e.jsx)(d.E,{variant:"bodySmall",color:"secondary",children:n}),(0,e.jsx)(d.E,{variant:"h4",children:o})]})}const Xe={dateStyle:"medium",timeStyle:"short"};function Je(n){const{session:o,snapshot:s,isBusy:a,disconnectIsLoading:i,onDisconnect:l,showUploadSnapshot:c,uploadSnapshotIsLoading:g,onUploadSnapshot:p,showRebuildSnapshot:f,onRebuildSnapshot:j,isHighlightErrors:y,onHighlightErrors:E,showOnlyErrorsSwitch:N}=n,S=s?.stats?.total??0,b=s?.stats?.statuses?.ERROR??0,D=s?.stats?.statuses?.OK??0,O=s?.stats?.statuses?.WARNING??0,M=(0,r.t)("migrate-to-cloud.summary.show-errors","Only view errors");return(0,e.jsxs)(A.a,{borderColor:"weak",borderStyle:"solid",padding:2,display:"flex",gap:4,alignItems:"center",justifyContent:"space-between",children:[(0,e.jsxs)(h.B,{gap:4,wrap:!0,children:[(0,e.jsx)(F,{title:(0,r.t)("migrate-to-cloud.summary.snapshot-date","Snapshot timestamp"),children:s?.created?(0,Ve.Y)(s.created,Xe):(0,e.jsx)(d.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.summary.snapshot-not-created",children:"Not yet created"})})}),(0,e.jsx)(F,{title:(0,r.t)("migrate-to-cloud.summary.total-resource-count","Total resources"),children:S}),(0,e.jsx)(F,{title:(0,r.t)("migrate-to-cloud.summary.successful-resource-count","Successfully migrated"),children:D+O}),(0,e.jsx)(F,{title:(0,r.t)("migrate-to-cloud.summary.errored-resource-count","Errors"),children:(0,e.jsxs)(h.B,{direction:"row",alignItems:"center",children:[b,(0,e.jsx)(_.$,{h:1,layout:"inline"}),N&&(0,e.jsxs)(h.B,{children:[(0,e.jsx)(ze.d,{label:M,value:y,onChange:E}),(0,e.jsx)(d.E,{variant:"bodySmall",color:"secondary",children:M})]})]})}),(0,e.jsxs)(F,{title:(0,r.t)("migrate-to-cloud.summary.target-stack-title","Uploading to"),children:[o.slug,(0,e.jsx)(_.$,{h:1,layout:"inline"}),(0,e.jsx)(v.$n,{disabled:a,onClick:l,variant:"secondary",size:"sm",icon:i?"spinner":void 0,"data-testid":"migrate-to-cloud-summary-disconnect-button",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.summary.disconnect",children:"Disconnect"})})]})]}),(0,e.jsxs)(h.B,{gap:2,wrap:!0,justifyContent:"flex-end",children:[f&&(0,e.jsx)(v.$n,{disabled:a||g,onClick:j,variant:"secondary","data-testid":"migrate-to-cloud-summary-reconfigure-snapshot-button",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.summary.rebuild-snapshot",children:"Reconfigure snapshot"})}),c&&(0,e.jsx)(v.$n,{disabled:a||g,onClick:p,icon:g?"spinner":void 0,"data-testid":"migrate-to-cloud-summary-upload-snapshot-button",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.summary.upload-migration",children:"Upload snapshot"})})]})]})}var Qe=u(27594),Ze=u(34213),ge=u(58851),qe=u(15203);function _e(n){const o=n.row.original;return(0,e.jsxs)(h.B,{direction:"row",gap:2,alignItems:"center",children:[(0,e.jsx)(it,{resource:o}),(0,e.jsx)(h.B,{direction:"column",gap:0,children:(0,e.jsx)(et,{data:o})})]})}function et({data:n}){switch(n.type){case"DASHBOARD":return(0,e.jsx)(nt,{data:n});case"DATASOURCE":return(0,e.jsx)(tt,{data:n});case"FOLDER":return(0,e.jsx)(ot,{data:n});case"LIBRARY_ELEMENT":return(0,e.jsx)(st,{data:n});default:return(0,e.jsx)(at,{data:n})}}function tt({data:n}){const o=n.refId,s=me(o);return s?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{children:s.name}),(0,e.jsx)(d.E,{color:"secondary",children:s.type})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(d.E,{children:(0,e.jsxs)(r.x6,{i18nKey:"migrate-to-cloud.resource-table.unknown-datasource-title",children:["Data source ",{datasourceUID:o}]})}),(0,e.jsx)(d.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.resource-table.unknown-datasource-type",children:"Unknown data source"})})]})}function rt(n){return n&&"title"in n&&typeof n.title=="string"?n.title:null}function nt({data:n}){const o=n.refId,s=!!n.name&&!!n.parentName,{data:a,isLoading:i,isError:l}=(0,T.bM)({uid:o},{skip:s}),c=n.name||rt(a?.dashboard)||o,g=n.parentName||a?.meta?.folderTitle||"Dashboards";return l?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(d.E,{italic:!0,children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.resource-table.dashboard-load-error",children:"Unable to load dashboard"})}),(0,e.jsxs)(d.E,{color:"secondary",children:["Dashboard ",o]})]}):i?(0,e.jsx)(ee,{}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{children:c}),(0,e.jsx)(d.E,{color:"secondary",children:g})]})}function ot({data:n}){const o=n.refId,s=!!n.name&&!!n.parentName,{data:a,isLoading:i,isError:l}=(0,qe.kH)(o,{skip:s}),c=n.name||a?.title,g=n.parentName||a?.parents?.[a.parents.length-1]?.title;return l?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(d.E,{italic:!0,children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.folder-info.unable-to-load-folder",children:"Unable to load folder"})}),(0,e.jsxs)(d.E,{color:"secondary",children:["Folder ",n.refId]})]}):i?(0,e.jsx)(ee,{}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{children:c}),(0,e.jsx)(d.E,{color:"secondary",children:g??"Dashboards"})]})}function st({data:n}){const o=n.refId,s=!!n.name&&!!n.parentName,{data:a,isError:i,isLoading:l}=(0,T.A_)({libraryElementUid:o},{skip:s}),c=n.name||a?.result?.name||o,g=n.parentName||a?.result?.meta?.folderName||"General";return i?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(d.E,{italic:!0,children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.resource-table.error-library-element-title",children:"Unable to load library element"})}),(0,e.jsx)(d.E,{color:"secondary",children:(0,e.jsxs)(r.x6,{i18nKey:"migrate-to-cloud.resource-table.error-library-element-sub",children:["Library Element ",o]})})]}):l?(0,e.jsx)(ee,{}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{children:c}),(0,e.jsx)(d.E,{color:"secondary",children:g})]})}function ee(){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Z.A,{width:250}),(0,e.jsx)(Z.A,{width:130})]})}function at({data:n}){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{children:n.name}),n.parentName&&(0,e.jsx)(d.E,{color:"secondary",children:n.parentName})]})}function it({resource:n}){const o=(0,V.of)(ct),s=me(n.type==="DATASOURCE"?n.refId:void 0),a=lt(n.type==="PLUGIN"?n.plugin:void 0);if(n.type==="DATASOURCE"&&s?.meta?.info?.logos?.small)return(0,e.jsx)("img",{className:o.icon,src:s.meta.info.logos.small,alt:""});if(n.type==="PLUGIN"&&a)return(0,e.jsx)("img",{className:o.icon,src:a,alt:""});{const i=le(n.type);if(i)return(0,e.jsx)($.I,{size:"xl",name:i})}}function ct(){return{icon:(0,z.css)({display:"block",width:(0,ge.cs)("xl"),height:(0,ge.cs)("xl")})}}function me(n){return(0,m.useMemo)(()=>{if(n)return H.$.datasources[n]||Object.values(H.$.datasources).find(s=>s.uid===n)},[n])}function lt(n){return(0,m.useMemo)(()=>{if(n)return n?.info?.logos},[n])?.small}function he(n){switch(n){case"DATASOURCE":return(0,r.t)("migrate-to-cloud.resource-type.datasource","Data source");case"DASHBOARD":return(0,r.t)("migrate-to-cloud.resource-type.dashboard","Dashboard");case"FOLDER":return(0,r.t)("migrate-to-cloud.resource-type.folder","Folder");case"LIBRARY_ELEMENT":return(0,r.t)("migrate-to-cloud.resource-type.library_element","Library Element");case"MUTE_TIMING":return(0,r.t)("migrate-to-cloud.resource-type.mute_timing","Mute Timing");case"NOTIFICATION_TEMPLATE":return(0,r.t)("migrate-to-cloud.resource-type.notification_template","Notification Template");case"CONTACT_POINT":return(0,r.t)("migrate-to-cloud.resource-type.contact_point","Contact Point");case"NOTIFICATION_POLICY":return(0,r.t)("migrate-to-cloud.resource-type.notification_policy","Notification Policy");case"ALERT_RULE":return(0,r.t)("migrate-to-cloud.resource-type.alert_rule","Alert Rule");case"ALERT_RULE_GROUP":return(0,r.t)("migrate-to-cloud.resource-type.alert_rule_group","Alert Rule Group");case"PLUGIN":return(0,r.t)("migrate-to-cloud.resource-type.plugin","Plugin");default:return(0,r.t)("migrate-to-cloud.resource-type.unknown","Unknown")}}function dt(n){const{type:o}=n.row.original;return(0,e.jsx)(e.Fragment,{children:he(o)})}function ut(n){switch(n){case"DATASOURCE_NAME_CONFLICT":return(0,r.t)("migrate-to-cloud.resource-details.error-messages.datasource-name-conflict","There is a data source with the same name in the target instance. Rename one of them and try again.");case"DATASOURCE_INVALID_URL":return(0,r.t)("migrate-to-cloud.resource-details.error-messages.datasource-invalid-url","There is a data source which has an invalid URL. Provide a valid URL and try again.");case"DATASOURCE_ALREADY_MANAGED":return(0,r.t)("migrate-to-cloud.resource-details.error-messages.datasource-already-managed","Data source is already provisioned and managed by Grafana in the cloud instance. If this is a different resource, set another UID and try again.");case"FOLDER_NAME_CONFLICT":return(0,r.t)("migrate-to-cloud.resource-details.error-messages.folder-name-conflict","There is a folder with the same name in the target instance. Rename one of them and try again.");case"DASHBOARD_ALREADY_MANAGED":return(0,r.t)("migrate-to-cloud.resource-details.error-messages.dashboard-already-managed","Dashboard is already provisioned and managed by Grafana in the cloud instance. We recommend using the provisioned dashboard going forward. If you still wish to copy the dashboard to the cloud instance, then change the dashboard ID in the dashboard JSON, save a new snapshot and upload again.");case"LIBRARY_ELEMENT_NAME_CONFLICT":return(0,r.t)("migrate-to-cloud.resource-details.error-messages.library-element-name-conflict","There is a library element with the same name in the target instance. Rename one of them and try again.");case"UNSUPPORTED_DATA_TYPE":return(0,r.t)("migrate-to-cloud.resource-details.error-messages.unsupported-data-type","Migration of this data type is not currently supported.");case"RESOURCE_CONFLICT":return(0,r.t)("migrate-to-cloud.resource-details.error-messages.resource-conflict","There is a resource conflict with the target instance. Please check the Grafana server logs for more details.");case"UNEXPECTED_STATUS_CODE":return(0,r.t)("migrate-to-cloud.resource-details.error-messages.unexpected-error","There has been an error while migrating. Please check the Grafana server logs for more details.");case"INTERNAL_SERVICE_ERROR":return(0,r.t)("migrate-to-cloud.resource-details.error-messages.internal-service-error","There has been an error while migrating. Please check the Grafana server logs for more details.");case"GENERIC_ERROR":return(0,r.t)("migrate-to-cloud.resource-details.error-messages.generic-error","There has been an error while migrating. Please check the cloud migration logs for more information.");default:return""}}function gt(n){const{resource:o,onClose:s}=n,a=o?.refId,i=o&&he(o.type),l=o?.errorCode||o?.message;let c=(0,r.t)("migrate-to-cloud.resource-details.generic-title","Resource migration details:");return o?.status==="ERROR"?c=(0,r.t)("migrate-to-cloud.resource-details.error-title","Unable to migrate this resource:"):o?.status==="WARNING"&&(c=(0,r.t)("migrate-to-cloud.resource-details.warning-title","Resource migrated with a warning:")),(0,e.jsx)(B.a,{title:(0,r.t)("migrate-to-cloud.resource-details.title","Migration resource details"),isOpen:!!o,onDismiss:s,children:o&&(0,e.jsxs)(h.B,{direction:"column",gap:2,alignItems:"flex-start",children:[(0,e.jsx)(d.E,{element:"p",weight:"bold",children:(0,e.jsxs)(r.x6,{i18nKey:"migrate-to-cloud.resource-details.resource-summary",children:[{refId:a}," (",{typeName:i},")"]})}),l?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(d.E,{element:"p",children:c}),(0,e.jsx)(d.E,{element:"p",children:ut(o?.errorCode)||o?.message||"There has been an error while migrating. Please check the cloud migration logs for more information."})]}):(0,e.jsx)(d.E,{element:"p",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.resource-details.missing-message",children:"No message provided."})}),(0,e.jsx)(v.$n,{onClick:s,children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.resource-details.dismiss-button",children:"OK"})})]})})}function mt(n){const o=n.row.original;return o.status==="PENDING"?(0,e.jsx)(d.E,{color:"secondary",children:(0,r.t)("migrate-to-cloud.resource-status.not-migrated","Not yet uploaded")}):o.status==="OK"?(0,e.jsx)(d.E,{color:"success",children:(0,r.t)("migrate-to-cloud.resource-status.migrated","Uploaded to cloud")}):o.status==="WARNING"?(0,e.jsx)(pt,{item:o}):o.status==="ERROR"?(0,e.jsx)(ht,{item:o}):(0,e.jsx)(d.E,{color:"secondary",children:(0,r.t)("migrate-to-cloud.resource-status.unknown","Unknown")})}function ht({item:n}){return(0,e.jsxs)(h.B,{alignItems:"center",children:[(0,e.jsx)(d.E,{color:"error",children:(0,r.t)("migrate-to-cloud.resource-status.failed","Error")}),n.message&&(0,e.jsx)(v.$n,{size:"sm",variant:"secondary",onClick:()=>n.showDetails(n),children:(0,r.t)("migrate-to-cloud.resource-status.error-details-button","Details")})]})}function pt({item:n}){return(0,e.jsxs)(h.B,{alignItems:"center",children:[(0,e.jsx)(d.E,{color:"warning",children:(0,r.t)("migrate-to-cloud.resource-status.warning","Uploaded with warning")}),n.message&&(0,e.jsx)(v.$n,{size:"sm",variant:"secondary",onClick:()=>n.showDetails(n),children:(0,r.t)("migrate-to-cloud.resource-status.warning-details-button","Details")})]})}const ft=[{id:"name",header:"Name",cell:_e,sortType:"alphanumeric"},{id:"resource_type",header:"Type",cell:dt,sortType:"alphanumeric"},{id:"status",header:"Status",cell:mt,sortType:"alphanumeric"}];function yt({resources:n,localPlugins:o,numberOfPages:s=0,onChangePage:a,onChangeSort:i,page:l=1}){const c=(0,m.useMemo)(()=>[{id:"resource_type",desc:!0}],[]),[g,p]=(0,m.useState)(),f=(0,m.useCallback)(y=>{p(y)},[]),j=(0,m.useMemo)(()=>n.map(y=>{const E=xt(y,o);return{...y,showDetails:f,plugin:E}}),[n,f,o]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(h.B,{alignItems:"flex-end",direction:"column",children:[(0,e.jsx)(Qe.j,{columns:ft,data:j,getRowId:y=>y.refId,fetchData:i,initialSortBy:c}),(0,e.jsx)(Ze.d,{numberOfPages:s,currentPage:l,onNavigate:a})]}),(0,e.jsx)(gt,{resource:g,onClose:()=>p(void 0)})]})}function xt(n,o){if(!(!n||!o||n.type!=="PLUGIN"))return o.find(s=>s.id===n.refId)}var jt=u(68079);function Et(n){const{title:o,accessory:s,children:a}=n;return(0,e.jsxs)(A.a,{maxWidth:44,display:"flex",direction:"row",gap:1,alignItems:"flex-start",children:[s&&(0,e.jsx)(A.a,{children:s}),(0,e.jsxs)(h.B,{gap:2,direction:"column",alignItems:"flex-start",children:[(0,e.jsx)(d.E,{element:"h3",variant:"h5",children:o}),a]})]})}function Kt(n){const{disabled:o,isLoading:s,onClick:a}=n;return jsxs(CTAInfo,{title:t("migrate-to-cloud.build-snapshot.title","No snapshot exists"),accessory:jsx(Icon,{name:"cog",size:"lg"}),children:[jsx(Text,{element:"p",variant:"body",color:"secondary",children:jsx(Trans,{i18nKey:"migrate-to-cloud.build-snapshot.description",children:"This tool can migrate some resources from this installation to your cloud stack. To get started, you'll need to create a snapshot of this installation. Creating a snapshot typically takes less than two minutes. The snapshot is stored alongside this Grafana installation."})}),jsx(Text,{element:"p",variant:"body",color:"secondary",children:jsx(Trans,{i18nKey:"migrate-to-cloud.build-snapshot.when-complete",children:"Once the snapshot is complete, you will be able to upload it to your cloud stack."})}),jsx(Button,{disabled:o,onClick:a,icon:s?"spinner":void 0,"data-testid":"migrate-to-cloud-configure-snapshot-build-snapshot-button",children:jsx(Trans,{i18nKey:"migrate-to-cloud.summary.start-migration",children:"Build snapshot"})})]})}function It(n){const{disabled:o,isLoading:s,onClick:a}=n;return(0,e.jsxs)(Et,{title:(0,r.t)("migrate-to-cloud.building-snapshot.title","Building snapshot"),accessory:(0,e.jsx)(jt.y,{inline:!0}),children:[(0,e.jsx)(d.E,{element:"p",variant:"body",color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.building-snapshot.description",children:"We're gathering your resources for migration to Grafana Cloud. This should only take a moment."})}),(0,e.jsx)(v.$n,{disabled:o,onClick:a,icon:s?"spinner":void 0,variant:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.summary.cancel-snapshot",children:"Cancel snapshot"})})]})}function bt(){return(0,e.jsx)(d.E,{color:"secondary",textAlignment:"center",children:(0,e.jsxs)(r.x6,{i18nKey:"migrate-to-cloud.support-types-disclosure.text",children:["Resources are copied to your Grafana Cloud stack."," ",(0,e.jsx)(G.Y,{external:!0,href:"https://grafana.com/docs/grafana-cloud/security-and-account-management/migration-guide/",children:"Learn more"})," ","about the full set of supported resources and migrating other settings."]})})}var kt=u(64762);const Ct=4;function Tt(n){const o=(0,m.useRef)(void 0),s=(0,kt._2)();(0,m.useEffect)(()=>{const a=n?.status,i=o.current!=="FINISHED"&&o.current!==void 0&&a==="FINISHED";if(o.current=a,!!i&&n){const l=(0,r.t)("migrate-to-cloud.onprem.success-title","Migration completed!"),c=St(n);s.success(l,c)}},[s,n])}function St(n){const o=[];let s=0;for(const[i,l]of Object.entries(n.stats?.types??{})){if(l<=0)continue;const c=de(i);c&&(o.push(c),s+=1)}const a=n?.stats?.statuses?.OK??0;return s>Ct?(0,r.t)("migrate-to-cloud.onprem.success-message-generic","Successfully migrated {{successCount}} resources to your Grafana Cloud instance.",{successCount:a}):(0,r.t)("migrate-to-cloud.onprem.success-message","Successfully migrated {{successCount}} {{types, list}} to your Grafana Cloud instance.",{successCount:a,types:o})}function vt(){const n=(0,T.SM)(),o=n.data?.sessions?.at(-1);return{...n,data:o}}const Rt=["INITIALIZING","CREATING","UPLOADING","PENDING_PROCESSING","PROCESSING"],pe=50;function At(n,o=1,s,a=!1){const[i,l]=(0,m.useState)(!1),c=(0,T.M8)(n?{uid:n,page:1,limit:1,sort:"latest"}:q.hT),g=c.currentData?.snapshots?.at(0),p=n&&g?.uid?{uid:n,snapshotUid:g.uid,resultLimit:pe,resultPage:o,resultSortColumn:s?.column?s.column:void 0,resultSortOrder:s?.order,errorsOnly:a}:q.hT,f=(0,T.YD)(p,{pollingInterval:i?H.$.cloudMigrationPollIntervalMs:0,skipPollingIfUnfocused:!0}),j=c.isError||f.isError;return(0,m.useEffect)(()=>{const y=!j&&Rt.includes(f.data?.status);l(y)},[f?.data?.status,j]),{...f,data:p===q.hT?void 0:f.data,error:c.error||f.error,isError:j,isLoading:c.isLoading||f.isLoading,isFetching:c.isFetching||f.isFetching}}const Nt=()=>{const[n,o]=(0,m.useState)(1),[s,a]=(0,m.useState)({column:"",order:void 0}),[i,l]=(0,m.useState)(!1),{data:c={resourceDependencies:[]}}=(0,T.D0)(),[g,p]=(0,m.useState)(!1),[f,j]=(0,m.useState)(void 0),[y,E]=(0,T.ri)(),[N,S]=(0,T.aD)(),[b,D]=(0,T.r3)(),[O,M]=(0,T.AC)(),{currentData:Ot=[]}=(0,T.u)(),P=vt(),x=At(P.data?.uid,n,s,i),K=Math.ceil((i?x?.data?.stats?.statuses?.ERROR||0:x?.data?.stats?.total||0)/pe);(0,m.useEffect)(()=>{K>0&&n>K&&o(K)},[K,n]);const[k,I]=(0,m.useState)("loading");Tt(x.data);const C=P.data?.uid,w=x.data?.uid,R=x.data?.status,W=E.isLoading||S.isLoading||D.isLoading||P.isLoading||x.isLoading||M.isLoading;(0,m.useEffect)(()=>{g&&f!==x.data?.uid&&E.isSuccess&&E.data?.uid&&(j(E.data.uid),p(!1))},[E.isSuccess,E.data?.uid,f,x.data?.uid,j,p,g]),(0,m.useEffect)(()=>{if(!(!C||x.isLoading||x.isFetching)){if(k==="loading"){if(R==="CREATING"){I("building");return}if(R==="PENDING_UPLOAD"){I("built");return}if(["UPLOADING","PENDING_PROCESSING","PROCESSING"].includes(R??"")){I("uploading");return}if(R==="FINISHED"){I("uploaded");return}if(!R||R==="ERROR"){I("configure");return}}if(k==="configure"&&R==="CREATING"){I("building");return}if(!g&&k==="building"&&R==="PENDING_UPLOAD"){I("built");return}if(k==="built"&&(R==="PROCESSING"||R==="UPLOADING")){I("uploading");return}if(k==="uploading"&&R==="FINISHED"){I("uploaded");return}if(!g&&(k==="built"||k==="uploaded")&&R!=="FINISHED"&&(x.data?.results?.length===0||x.isUninitialized)){p(!0),I("configure");return}if(k==="building"&&(E.error||x.isError)){I("configure");return}if(k==="uploading"&&(S.error||R==="ERROR")){I("uploaded");return}}},[C,R,x.isLoading,x.isFetching,x.isUninitialized,x.isError,p,I,k,g,x.data?.results?.length,E.error,S.error]);const Y=Dt({snapshot:x.data,getSnapshotError:x.error,getSessionError:P.error,createSnapshotError:E.error,uploadSnapshotError:S.error,cancelSnapshotError:D.error,disconnectSnapshotError:M.error}),Pt=(0,m.useCallback)(U=>{C&&(I("building"),y({uid:C,createSnapshotRequestDto:{resourceTypes:U}}))},[y,C]),Gt=(0,m.useCallback)(()=>{C&&w&&N({uid:C,snapshotUid:w})},[N,C,w]),Mt=(0,m.useCallback)(()=>{C&&w&&(p(!0),I("configure"))},[I,p,C,w]),Ut=(0,m.useCallback)(()=>{C&&w&&(I("configure"),b({uid:C,snapshotUid:w}))},[b,I,C,w]),Bt=(0,m.useCallback)(async()=>{C&&(I("loading"),O({uid:C}))},[O,I,C]);return P.isLoading?(0,e.jsx)("div",{children:(0,e.jsx)(r.x6,{i18nKey:"migrate-to-cloud.summary.page-loading",children:"Loading..."})}):P.data?(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(h.B,{direction:"column",gap:2,children:[(0,e.jsx)(Je,{session:P.data,snapshot:x.data,isBusy:W,disconnectIsLoading:M.isLoading,onDisconnect:Bt,showUploadSnapshot:["built","uploading"].includes(k),uploadSnapshotIsLoading:S.isLoading||k==="uploading",onUploadSnapshot:Gt,showRebuildSnapshot:["built","uploading","uploaded"].includes(k),onRebuildSnapshot:Mt,onHighlightErrors:()=>l(!i),isHighlightErrors:i,showOnlyErrorsSwitch:["uploading","uploaded"].includes(k)}),(["built","uploaded"].includes(k)||!!E?.error)&&Y&&(0,e.jsx)(ie,{severity:Y.severity,title:Y.title,error:Y.error,children:(0,e.jsx)(d.E,{element:"p",children:Y.body})}),k==="configure"&&(0,e.jsx)(Ge,{disabled:W,isLoading:W,onClick:Pt,resourceDependencies:c.resourceDependencies||[]}),k==="building"&&(0,e.jsx)(A.a,{display:"flex",justifyContent:"center",paddingY:10,children:(0,e.jsx)(It,{disabled:W,isLoading:D.isLoading,onClick:Ut})}),["built","uploading","uploaded"].includes(k)&&x.data?.results&&x.data?.results.length>0&&(0,e.jsxs)(h.B,{gap:4,direction:"column",children:[(0,e.jsx)(yt,{resources:x.data.results,localPlugins:Ot,onChangePage:o,numberOfPages:K,page:n,onChangeSort:U=>{const fe=U.sortBy[0]?.desc===void 0?void 0:U.sortBy[0]?.desc?"desc":"asc";(s.column!==U.sortBy[0]?.id||fe!==s.order)&&a({column:U.sortBy[0]?.id,order:fe})}}),(0,e.jsx)(bt,{})]})]})}):(0,e.jsx)(We,{})};function Dt(n){const{snapshot:o,getSnapshotError:s,getSessionError:a,createSnapshotError:i,uploadSnapshotError:l,cancelSnapshotError:c,disconnectSnapshotError:g}=n,p=(0,r.t)("migrate-to-cloud.onprem.error-see-server-logs","See the Grafana server logs for more details");if(a)return{severity:"error",title:(0,r.t)("migrate-to-cloud.onprem.get-session-error-title","Error loading migration configuration"),body:p,error:a};if(s)return{severity:"error",title:(0,r.t)("migrate-to-cloud.onprem.get-snapshot-error-title","Error loading snapshot"),body:p,error:s};if(g)return{severity:"warning",title:(0,r.t)("migrate-to-cloud.onprem.disconnect-error-title","Error disconnecting"),body:p,error:g};if(i)return Lt(i,p);if(l)return{severity:"warning",title:(0,r.t)("migrate-to-cloud.onprem.upload-snapshot-error-title","Error uploading snapshot"),body:p,error:l};if(c)return{severity:"warning",title:(0,r.t)("migrate-to-cloud.onprem.cancel-snapshot-error-title","Error cancelling creating snapshot"),body:p,error:c};if(o?.status==="ERROR")return{severity:"warning",title:(0,r.t)("migrate-to-cloud.onprem.snapshot-error-status-title","Error migrating resources"),body:(0,r.t)("migrate-to-cloud.onprem.snapshot-error-status-body","There was an error creating the snapshot or starting the migration process. See the Grafana server logs for more details")};const f=o?.stats?.statuses?.ERROR??0,j=o?.stats?.statuses?.WARNING??0;if(o?.status==="FINISHED"&&f+j>0){let y="";return f>0?y=(0,r.t)("migrate-to-cloud.onprem.migration-finished-with-errors-body","The migration has completed, but some items could not be migrated to the cloud stack. Check the failed resources for more details."):j>0&&(y=(0,r.t)("migrate-to-cloud.onprem.migration-finished-with-warnings-body","The migration has completed with some warnings. Check individual resources for more details")),{severity:"warning",title:(0,r.t)("migrate-to-cloud.onprem.migration-finished-with-caveat-title","Resource migration complete"),body:y}}}function Lt(n,o){const s=J(n);let a="warning",i=null;switch(s?.messageId){case"cloudmigrations.emptyResourceTypes":a="error",i=(0,r.t)("migrate-to-cloud.onprem.create-snapshot-error-empty-resource-types","You need to provide at least one resource type for snapshot creation");break;case"cloudmigrations.unknownResourceType":a="error",i=(0,r.t)("migrate-to-cloud.onprem.create-snapshot-error-unknown-resource-type","Unknown resource type. See the Grafana server logs for more details");break;case"cloudmigrations.duplicateResourceType":a="error",i=(0,r.t)("migrate-to-cloud.onprem.create-snapshot-error-duplicate-resource-type","Duplicate resource type. See the Grafana server logs for more details");break;case"cloudmigrations.missingDependency":a="error",i=(0,r.t)("migrate-to-cloud.onprem.create-snapshot-error-missing-dependency","Missing dependency. See the Grafana server logs for more details");break}return{severity:a,title:(0,r.t)("migrate-to-cloud.onprem.create-snapshot-error-title","Error creating snapshot"),body:i||o,error:n}}function wt(){return(0,e.jsx)(ye.Y,{navId:"migrate-to-cloud",children:H.$.cloudMigrationIsTarget?(0,e.jsx)(ve,{}):(0,e.jsx)(Nt,{})})}}}]);

//# sourceMappingURL=MigrateToCloud.059463bffe0909df8143.js.map