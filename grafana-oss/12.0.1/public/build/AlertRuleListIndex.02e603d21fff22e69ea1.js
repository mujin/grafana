"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3511],{37935:(ve,B,n)=>{n.r(B),n.d(B,{default:()=>Wn});var e=n(74848),s=n(96540),P=n(43173),F=n(54148),j=n(41053),D=n(10940),M=n(5556),d=n(25992),E=n(41654),g=n(45861),i=n(70958),r=n(56840),u=n(96673),A=n(74268),V=n(36826),Y=n(25833),x=n(88559),X=n(87063),z=n(94535),S=n(50201),w=n(89640),b=n(74869),ee=n(88721);const je=()=>{const{canCreateGrafanaRules:a,canCreateCloudRules:o}=(0,ee.V)(),l=(0,b.AW)();return a&&o&&l?(0,e.jsx)(x.m,{overlay:(0,e.jsxs)(X.W,{children:[(0,e.jsx)(z.D,{url:"alerting/new/grafana-recording",icon:"plus",label:(0,r.t)("alerting.list-view.empty.new-grafana-recording-rule","New Grafana-managed recording rule")}),(0,e.jsx)(z.D,{url:"alerting/new/recording",icon:"plus",label:(0,r.t)("alerting.list-view.empty.new-ds-managed-recording-rule","New data source-managed recording rule")})]}),children:(0,e.jsx)(g.z9,{variant:"primary",icon:"plus",size:"lg",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.new-recording-rule",children:"New recording rule"})})}):(0,e.jsxs)(e.Fragment,{children:[a&&l&&(0,e.jsx)(g.z9,{variant:"primary",icon:"plus",size:"lg",href:"alerting/new/grafana-recording",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.new-grafana-recording-rule",children:"New Grafana-managed recording rule"})}),o&&(0,e.jsx)(g.z9,{variant:"primary",icon:"plus",size:"lg",href:"alerting/new/recording",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.new-ds-managed-recording-rule",children:"New data source-managed recording rule"})})]})},oe=()=>{const{canCreateGrafanaRules:a,canCreateCloudRules:o}=(0,ee.V)(),l=a||o;return(0,e.jsx)("div",{children:(0,e.jsx)(S.p,{message:"You haven't created any rules yet",variant:"call-to-action",button:l?(0,e.jsxs)(E.B,{direction:"column",alignItems:"center",justifyContent:"center",children:[l&&(0,e.jsx)(g.z9,{variant:"primary",icon:"plus",size:"lg",href:"alerting/new/alerting",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.new-alert-rule",children:"New alert rule"})}),(0,e.jsx)(je,{})]}):null,children:(0,e.jsxs)(r.x6,{i18nKey:"alerting.list-view.empty.provisioning",children:["You can also define rules through file provisioning or Terraform."," ",(0,e.jsx)(w.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/",external:!0,children:"Learn more"})]})})})};var ge=n(90186),m=n(22803),ie=n(55127),ne=n.n(ie),Fe=n(78685),me=n(63142),De=n(34999),Ee=n(45967),te=n(98127),c=n(52161),W=n(77256),K=n(29609);function $(){const[a,o]=(0,s.useState)(!1),[l,y]=(0,Fe.A)("grafana.unifiedalerting.hideErrors",!1),v=(0,te.$)(h=>h.promRules),f=(0,te.$)(h=>h.rulerRules),C=(0,me.of)(ce),p=(0,s.useMemo)(()=>{const[h,N]=[v,f].map(G=>(0,c.qi)().reduce((H,Q)=>{const ye=G[Q.name]?.error;return G[Q.name]&&ye&&!(0,K.$7)(G[Q.name])?[...H,{dataSource:Q,error:ye}]:H},[])),k=v[c.hY]?.error,le=f[c.hY]?.error,q=[];return k&&q.push((0,e.jsxs)(e.Fragment,{children:["Failed to load Grafana rules state: ",k.message||"Unknown error."]})),le&&q.push((0,e.jsxs)(e.Fragment,{children:["Failed to load Grafana rules config: ",le.message||"Unknown error."]})),h.forEach(({dataSource:G,error:H})=>q.push((0,e.jsxs)(e.Fragment,{children:["Failed to load rules state from"," ",(0,e.jsx)("a",{href:(0,W.GD)(G.uid),className:C.dsLink,children:G.name}),": ",H.message||"Unknown error."]}))),N.forEach(({dataSource:G,error:H})=>q.push((0,e.jsxs)(e.Fragment,{children:["Failed to load rules config from"," ",(0,e.jsx)("a",{href:(0,W.GD)(G.uid),className:C.dsLink,children:G.name}),": ",H.message||"Unknown error."]}))),q},[v,f,C.dsLink]);return(0,e.jsxs)(e.Fragment,{children:[!!p.length&&l&&(0,e.jsx)(ae,{count:p.length,onClick:()=>y(h=>!h)}),!!p.length&&!l&&(0,e.jsxs)(De.F,{"data-testid":"cloud-rulessource-errors",title:(0,r.t)("alerting.rule-list-errors.cloud-rulessource-errors-title-errors-loading-rules","Errors loading rules"),severity:"error",onRemove:()=>y(!0),children:[a&&p.map((h,N)=>(0,e.jsx)("div",{children:h},N)),!a&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:p[0]}),p.length>=2&&(0,e.jsxs)(g.$n,{className:C.moreButton,fill:"text",icon:"angle-right",size:"sm",onClick:()=>o(!0),children:[p.length-1," more ",ne()("error",p.length-1)]})]})]})]})}const ae=({count:a,onClick:o})=>{const l=(0,me.of)(ce);return(0,e.jsx)("div",{className:l.floatRight,children:(0,e.jsx)(Ee.m,{content:"Show all errors",placement:"bottom",children:(0,e.jsx)(g.$n,{fill:"text",variant:"destructive",icon:"exclamation-triangle",onClick:o,children:a>1?(0,e.jsxs)(e.Fragment,{children:[a," errors"]}):(0,e.jsx)(r.x6,{i18nKey:"alerting.error-summary-button.error",children:"1 error"})})})})},ce=a=>({moreButton:(0,m.css)({padding:0}),floatRight:(0,m.css)({display:"flex",justifyContent:"flex-end"}),dsLink:(0,m.css)({fontWeight:a.typography.fontWeightBold})});var L=n(16692),Me=n(24898),We=n(66404),Ie=n(6975),he=n(68079),Te=n(34213),Oe=n(99887),Ge=n(95943),Je=n(74048),en=n(18771),Re=n(36200),Z=n(92367),ze=n(85629),cn=n(30703),dn=n(18404),R=n(11940),O=n(29442),Ae=n(12266),T=n(40360),Be=n(70327),xe=n(77880),Se=n(25149),pe=n(78102);function Qe({folder:a,onClose:o}){const[l,y]=(0,s.useState)("yaml");return(0,e.jsx)(Se.m,{title:`Export ${a.title} rules`,activeTab:l,onTabChange:y,onClose:o,formatProviders:Object.values(pe.sl),children:(0,e.jsx)(Xe,{folder:a,exportFormat:l,onClose:o})})}function Xe({folder:a,exportFormat:o,onClose:l}){const{currentData:y="",isFetching:v}=Be.hK.endpoints.exportRules.useQuery({folderUid:a.uid,format:o});if(v)return(0,e.jsx)(Ie._,{text:(0,r.t)("alerting.grafana-rule-folder-export-preview.text-loading","Loading....")});const f=`${a.title}-${a.uid}`;return(0,e.jsx)(xe.J,{format:o,textDefinition:y,downloadFileName:f,onClose:l})}var nn=n(88589),Le=n(71774),Ze=n(46672),tn=n(22971);const ke=s.memo(({group:a,namespace:o,expandAll:l,viewMode:y})=>{const{rulesSource:v}=o,f=(0,c.EV)(v),C=(0,tn.ZI)(v),p=(0,me.of)(qe),[h,N]=(0,s.useState)(void 0),[k,le]=(0,s.useState)(!l);(0,s.useEffect)(()=>{le(!l)},[l]);const{hasRuler:q}=(0,R.y)(o.rulesSource),G=a.rules[0]?.rulerRule,H=G&&K.p.grafana.rule(G)&&G.grafana_alert.namespace_uid||void 0,{folder:Q}=(0,dn.a)(H),{canEditRules:ye}=(0,ee.V)(),we=q&&C&&!a.rules.find(ue=>!!ue.rulerRule),He=(0,K.YN)(a),Ye=a.rules.some(ue=>K.p.grafana.rule(ue.rulerRule)&&ue.rulerRule.grafana_alert.provenance),on=a.rules.some(ue=>(0,K.Tm)(ue.rulerRule??ue.promRule)),be=q&&!Ye&&!He&&!on&&ye(f),U=y==="list",$e=y==="grouped",Ce=[];if(we)Ce.push((0,e.jsxs)(E.B,{children:[(0,e.jsx)(he.y,{}),"deleting"]},"is-deleting"));else if(v===c.hY){if(H){const ue=(0,W.NH)(H);$e&&(Ce.push((0,e.jsx)(Le.M,{"aria-label":(0,r.t)("alerting.rule-group-action.details","rule group details"),icon:"info-circle",tooltip:(0,r.t)("alerting.rule-group-action.details","rule group details"),to:O.TN.detailsPageLink("grafana",H,a.name,{includeReturnTo:!0})},"rule-group-details")),Q?.canSave&&be&&Ce.push((0,e.jsx)(Le.M,{"aria-label":(0,r.t)("alerting.rule-group-action.edit","edit rule group"),icon:"pen",tooltip:(0,r.t)("alerting.rule-group-action.edit","edit rule group"),to:O.TN.editPageLink("grafana",H,a.name,{includeReturnTo:!0})},"rule-group-edit"))),Q?.canSave&&U&&(Ce.push((0,e.jsx)(Le.M,{"aria-label":(0,r.t)("alerting.rule-group-action.go-to-folder","go to folder"),icon:"folder-open",tooltip:(0,r.t)("alerting.rule-group-action.go-to-folder","go to folder"),to:ue,target:"__blank"},"goto")),Q?.canAdmin&&Ce.push((0,e.jsx)(Le.M,{"aria-label":(0,r.t)("alerting.rule-group-action.manage-permissions","manage permissions"),icon:"lock",tooltip:(0,r.t)("alerting.rule-group-action.manage-permissions","manage permissions"),to:ue+"/permissions",target:"__blank"},"manage-perms"))),Q&&U&&Ce.push((0,e.jsx)(Le.M,{"aria-label":(0,r.t)("alerting.rule-group-action.export-rules-folder","Export rules folder"),"data-testid":"export-folder",icon:"download-alt",tooltip:(0,r.t)("alerting.rule-group-action.export-rules-folder","Export rules folder"),onClick:()=>N("folder")},"export-folder"))}}else Ce.push((0,e.jsx)(Le.M,{"aria-label":(0,r.t)("alerting.rule-group-action.details","rule group details"),icon:"info-circle",tooltip:(0,r.t)("alerting.rule-group-action.details","rule group details"),to:O.TN.detailsPageLink(v.uid,o.name,a.name,{includeReturnTo:!0})},"rule-group-details")),be&&Ce.push((0,e.jsx)(Le.M,{"aria-label":(0,r.t)("alerting.rule-group-action.edit","edit rule group"),icon:"pen",tooltip:(0,r.t)("alerting.rule-group-action.edit","edit rule group"),to:O.TN.editPageLink(v.uid,o.name,a.name,{includeReturnTo:!0})},"rule-group-edit"));const hn=U?(0,e.jsx)(T.c,{namespace:(0,nn.EL)(o).name}):(0,e.jsx)(T.c,{namespace:(0,nn.EL)(o).name,group:a.name});return(0,e.jsxs)("div",{className:p.wrapper,"data-testid":"rule-group",children:[(0,e.jsxs)("div",{className:p.header,"data-testid":"rule-group-header",children:[(0,e.jsx)(Ae.e,{size:"sm",className:p.collapseToggle,isCollapsed:k,onToggle:le,"data-testid":ze.Tp.components.AlertRules.groupToggle}),(0,e.jsx)(an,{isCollapsed:k}),(0,e.jsx)(_e,{rulesSource:v}),(0,e.jsxs)("div",{className:p.groupName,onClick:()=>le(!k),children:[He&&(0,e.jsx)(Oe.E,{color:"purple",text:(0,r.t)("alerting.rules-group.text-federated","Federated")})," ",hn]}),(0,e.jsx)("div",{className:p.spacer}),(0,e.jsx)("div",{className:p.headerStats,children:(0,e.jsx)(Ze.j7,{group:a})}),Ye&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:p.actionsSeparator,children:"|"}),(0,e.jsx)("div",{className:p.actionIcons,children:(0,e.jsx)(Oe.E,{color:"purple",text:(0,r.t)("alerting.rules-group.text-provisioned","Provisioned")})})]}),!!Ce.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:p.actionsSeparator,children:"|"}),(0,e.jsx)("div",{className:p.actionIcons,children:(0,e.jsx)(E.B,{gap:.5,children:Ce})})]})]}),!k&&(0,e.jsx)(tn.sF,{showSummaryColumn:!0,className:p.rulesTable,showGuidelines:!0,showNextEvaluationColumn:!!a.interval,rules:a.rules}),Q&&h==="folder"&&(0,e.jsx)(Qe,{folder:Q,onClose:()=>N(void 0)})]})});ke.displayName="RulesGroup";const _e=s.memo(({rulesSource:a})=>{const o=(0,me.of)(qe);return(0,c.Eb)(a)?(0,e.jsx)(Ee.m,{content:a.name,placement:"top",children:(0,e.jsx)("img",{alt:a.meta.name,className:o.dataSourceIcon,src:a.meta.info.logos.small})}):null});_e.displayName="CloudSourceLogo";const an=s.memo(({isCollapsed:a})=>(0,e.jsx)(cn.I,{name:a?"folder":"folder-open"}));an.displayName="FolderIcon";const qe=a=>({wrapper:(0,m.css)({}),header:(0,m.css)({display:"flex",flexDirection:"row",alignItems:"center",padding:`${a.spacing(1)} ${a.spacing(1)} ${a.spacing(1)} 0`,flexWrap:"nowrap",borderBottom:`1px solid ${a.colors.border.weak}`,"&:hover":{backgroundColor:a.components.table.rowHoverBackground}}),headerStats:(0,m.css)({flexShrink:0,span:{verticalAlign:"middle"},[a.breakpoints.down("sm")]:{order:2,width:"100%",paddingLeft:a.spacing(1)}}),groupName:(0,m.css)({marginLeft:a.spacing(1),marginBottom:0,cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),spacer:(0,m.css)({flex:1}),collapseToggle:(0,m.css)({background:"none",border:"none",marginTop:`-${a.spacing(1)}`,marginBottom:`-${a.spacing(1)}`,svg:{marginBottom:0}}),dataSourceIcon:(0,m.css)({width:a.spacing(2),height:a.spacing(2),marginLeft:a.spacing(2)}),dataSourceOrigin:(0,m.css)({marginRight:"1em",color:a.colors.text.disabled}),actionsSeparator:(0,m.css)({margin:`0 ${a.spacing(2)}`}),actionIcons:(0,m.css)({width:"80px",alignItems:"center",flexShrink:0}),rulesTable:(0,m.css)({margin:a.spacing(2,0)}),rotate90:(0,m.css)({transform:"rotate(90deg)"})});function rn(a){return(0,s.useMemo)(()=>a.flatMap(o=>o.groups.map(l=>({namespace:o,group:l}))),[a])}const J=({namespaces:a,expandAll:o})=>{const l=(0,me.of)(de),y=(0,te.$)(U=>U.promRules),v=(0,s.useMemo)(c.qi,[]),f=rn(a),C=(0,s.useMemo)(()=>v.filter(U=>(0,Re.ML)(y[U.name])),[y,v]),p=v.some(U=>!!y[U.name]?.result?.length),h=v.length>0,N=C.length>0,k=a.length>0,{numberOfPages:le,onPageChange:q,page:G,pageItems:H}=(0,Je.W)(f,1,Ge.FG),[Q,ye]=(0,L.Ej)(L.RY.CreateAlertRule),[we,He]=(0,L.Ej)(L.RY.ViewExternalAlertRule),be=h&&(Q&&ye)&&(we&&He)&&P.$.featureToggles.alertingMigrationUI;return(0,e.jsxs)("section",{className:l.wrapper,children:[(0,e.jsx)(E.B,{gap:2,direction:"column",children:(0,e.jsx)("div",{className:l.sectionHeader,children:(0,e.jsxs)("div",{className:l.headerRow,children:[(0,e.jsx)(We.E,{element:"h2",variant:"h5",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.section.dataSourceManaged.title",children:"Data source-managed"})}),C.length?(0,e.jsx)(Ie._,{className:l.loader,text:(0,r.t)("alerting.list-view.section.loading-rules","Loading rules from {{count}} sources",{count:C.length})}):(0,e.jsx)("div",{}),(0,e.jsxs)(E.B,{gap:1,children:[be&&(0,e.jsx)(Pe,{}),(0,e.jsx)(Ue,{})]})]})})}),H.map(({group:U,namespace:$e})=>(0,e.jsx)(ke,{group:U,namespace:$e,expandAll:o,viewMode:"grouped"},`${(0,c.v0)($e.rulesSource)}-${$e.name}-${U.name}`)),!h&&(0,e.jsx)("p",{children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.no-prom-or-loki-rules",children:"There are no Prometheus or Loki data sources configured"})}),h&&!N&&!k&&(0,e.jsx)("p",{children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.no-rules",children:"No rules found."})}),!p&&N&&(0,e.jsx)(he.y,{size:"xl",className:l.spinner}),(0,e.jsx)(Te.d,{className:l.pagination,currentPage:G,numberOfPages:le,onNavigate:q,hideWhenSinglePage:!0})]})},de=a=>({loader:(0,m.css)({marginBottom:0}),sectionHeader:(0,m.css)({display:"flex",justifyContent:"space-between"}),wrapper:(0,m.css)({marginBottom:a.spacing(4)}),spinner:(0,m.css)({textAlign:"center",padding:a.spacing(2)}),pagination:(0,en.H)(a),headerRow:(0,m.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",marginBottom:a.spacing(1)})});function Ue(){const[a,o]=(0,L.Ej)(L.RY.CreateExternalAlertRule),l=(0,F.zy)();return a&&o?(0,e.jsx)(g.z9,{href:M.kM.renderUrl("alerting/new/recording",{returnTo:l.pathname+l.search}),icon:"plus",variant:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.empty.new-ds-managed-recording-rule",children:"New data source-managed recording rule"})},"new-recording-rule"):null}function Pe(){const a=(0,Z.G)("/alerting/import-datasource-managed-rules");return(0,e.jsx)(g.z9,{variant:"secondary",href:a,icon:"arrow-up",children:(0,e.jsxs)(E.B,{direction:"row",gap:1,alignItems:"center",children:[(0,e.jsx)(r.x6,{i18nKey:"alerting.rule-list.import-to-gma.text",children:"Import to Grafana-managed rules"}),(0,e.jsx)(Oe.E,{text:(0,r.t)("alerting.rule-list.import-to-gma.new-badge","New!"),"aria-label":(0,r.t)("alerting.migrate-to-gmabutton.aria-label-new","new"),color:"blue",icon:"rocket"})]})})}var re=n(42941),_=n(23265);function sn({onClose:a}){const[o,l]=(0,s.useState)("yaml");return(0,e.jsx)(Se.m,{activeTab:o,onTabChange:l,onClose:a,formatProviders:Object.values(pe.sl),children:(0,e.jsx)(un,{exportFormat:o,onClose:a})})}function un({exportFormat:a,onClose:o}){const{currentData:l="",isFetching:y}=Be.hK.endpoints.exportRules.useQuery({format:a}),v=`alert-rules-${new Date().getTime()}`;return y?(0,e.jsx)(Ie._,{text:(0,r.t)("alerting.grafana-rules-export-preview.text-loading","Loading....")}):(0,e.jsx)(xe.J,{format:a,textDefinition:l,downloadFileName:v,onClose:o})}const I=({namespaces:a,expandAll:o})=>{const l=(0,me.of)(gn),[y]=(0,i.s)(),{prom:v,ruler:f}=(0,te.$)(U=>({prom:U.promRules[c.hY]||Re.jA,ruler:U.rulerRules[c.hY]||Re.jA})),C=v.loading||f.loading,p=!!v.result||!!f.result,h=y.view==="list",N=h?(0,_.Jr)(a):a,k=rn(N),{numberOfPages:le,onPageChange:q,page:G,pageItems:H}=(0,Je.W)(k,1,Ge.FG),[Q,ye]=(0,L.Ej)(L.RY.ExportGrafanaManagedRules),we=Q&&ye,[He,Ye]=(0,re.A)(!1),on=a.length>0,be=(0,b.AW)();return(0,e.jsxs)("section",{className:l.wrapper,children:[(0,e.jsx)("div",{className:l.sectionHeader,children:(0,e.jsxs)("div",{className:l.headerRow,children:[(0,e.jsx)(We.E,{element:"h2",variant:"h5",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.title",children:"Grafana-managed"})}),C?(0,e.jsx)(Ie._,{className:l.loader,text:(0,r.t)("alerting.list-view.section.grafanaManaged.loading","Loading...")}):(0,e.jsx)("div",{}),(0,e.jsxs)(E.B,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:[on&&we&&(0,e.jsx)(g.$n,{"aria-label":(0,r.t)("alerting.grafana-rules.export-all-grafana-rules-aria-label-export-all-grafana-rules","export all grafana rules"),"data-testid":"export-all-grafana-rules",icon:"download-alt",tooltip:(0,r.t)("alerting.grafana-rules.export-all-grafana-rules-tooltip-export-all-grafanamanaged-rules","Export all Grafana-managed rules"),onClick:Ye,variant:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.export-rules",children:"Export rules"})}),be&&(0,e.jsx)(g.z9,{href:(0,Z.G)("/alerting/new/grafana-recording",{returnTo:"/alerting/list"+location.search}),icon:"plus",variant:"secondary",tooltip:(0,r.t)("alerting.grafana-rules.tooltip-create-new-grafanamanaged-recording-rule","Create new Grafana-managed recording rule"),onClick:()=>(0,A.fH)(A.le.grafanaRecording),children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.new-recording-rule",children:"New recording rule"})})]})]})}),H.map(({group:U,namespace:$e})=>(0,e.jsx)(ke,{group:U,namespace:$e,expandAll:o,viewMode:h?"list":"grouped"},`${$e.name}-${U.name}`)),p&&N?.length===0&&(0,e.jsx)("p",{children:(0,e.jsx)(r.x6,{i18nKey:"alerting.grafana-rules.no-rules-found",children:"No rules found."})}),!p&&C&&(0,e.jsx)(he.y,{size:"xl",className:l.spinner}),(0,e.jsx)(Te.d,{className:l.pagination,currentPage:G,numberOfPages:le,onNavigate:q,hideWhenSinglePage:!0}),we&&He&&(0,e.jsx)(sn,{onClose:Ye})]})},gn=a=>({loader:(0,m.css)({marginBottom:0}),sectionHeader:(0,m.css)({display:"flex",justifyContent:"space-between",marginBottom:a.spacing(1)}),wrapper:(0,m.css)({marginBottom:a.spacing(4)}),spinner:(0,m.css)({textAlign:"center",padding:a.spacing(2)}),pagination:(0,en.H)(a),headerRow:(0,m.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",flexDirection:"row"})}),mn=({namespaces:a,expandAll:o})=>{const[l,y]=(0,s.useMemo)(()=>{const v=a.map(f=>({...f,groups:f.groups.sort((C,p)=>C.name.localeCompare(p.name))})).sort((f,C)=>f.name.localeCompare(C.name));return[v.filter(f=>(0,c.z2)(f.rulesSource)),v.filter(f=>(0,c.Eb)(f.rulesSource))]},[a]);return(0,s.useEffect)(()=>{(0,A.fH)(A.le.loadedList)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Me._,{actions:[L.RY.ViewAlertRule],children:(0,e.jsx)(I,{namespaces:l,expandAll:o})}),(0,e.jsx)(Me._,{actions:[L.RY.ViewExternalAlertRule],children:(0,e.jsx)(J,{namespaces:y,expandAll:o})})]})};var Ve=n(49185),xn=n(47327),pn=n(72489),Ke=n(24619),se=n(4956),Rn=n(64628),Pn=n(94646),yn=n(74159),Cn=n(3969);const Dn=({namespaces:a})=>{const[o,{width:l}]=(0,Ve.A)(),y=On(),f=(0,s.useMemo)(()=>{const C=new Map([[Ke.cF.Firing,[]],[Ke.cF.Pending,[]],[Ke.cF.Recovering,[]],[Ke.cF.Inactive,[]]]);return a.forEach(p=>p.groups.forEach(h=>h.rules.forEach(N=>{K.R$.alertingRule(N.promRule)&&N.promRule.state&&C.get(N.promRule.state)?.push(N)}))),C.forEach(p=>p.sort((h,N)=>h.name.localeCompare(N.name))),C},[a]).entries();return(0,e.jsxs)("ul",{role:"tree",ref:o,children:[y&&(0,e.jsx)(xn.G,{width:l}),(0,e.jsx)(E.B,{direction:"column",children:Array.from(f).map(([C,p])=>(0,e.jsx)(In,{state:C,rules:p},C))})]})},Mn={[Ke.cF.Firing]:"Firing",[Ke.cF.Pending]:"Pending",[Ke.cF.Inactive]:"Normal",[Ke.cF.Recovering]:"Recovering"},In=({state:a,rules:o})=>{const{page:l,pageItems:y,numberOfPages:v,onPageChange:f}=(0,Je.W)(o,1,Ge.FG),C=a!==Ke.cF.Firing,p=o.length>0;return(0,e.jsx)(Rn.i,{title:(0,e.jsxs)(E.B,{alignItems:"center",gap:0,children:[Mn[a]??"Unknown",(0,e.jsx)(pn.p,{value:o.length})]}),collapsed:C||p,pagination:(0,e.jsx)(Te.d,{currentPage:l,numberOfPages:v,onNavigate:f,hideWhenSinglePage:!0}),children:y.map(h=>{const{rulerRule:N,promRule:k}=h,le=N?(0,K.Nv)(N):!1,q=K.R$.alertingRule(h.promRule)?(0,yn.rf)(h.instanceTotals):void 0;if(!k)return null;const G=(0,K.uo)(h.promRule);return(0,e.jsx)(se.WG,{name:h.name,href:(0,W.w$)(h.namespace.rulesSource,h),summary:h.annotations.summary,state:a,health:h.promRule?.health,error:h.promRule?.lastError,labels:h.promRule?.labels,isProvisioned:le,instancesCount:q,namespace:h.namespace.name,group:h.group.name,actions:(0,e.jsx)(Cn.l,{compact:!0,rule:h,rulesSource:h.namespace.rulesSource}),origin:G},(0,Pn.jY)(k))})})};function On(){const a=(0,te.$)(f=>f.promRules),o=(0,s.useMemo)(c.qi,[]),l=(0,te.$)(f=>{const C=(0,Re.ML)(f.promRules[c.hY]),p=(0,Re.ML)(f.rulerRules[c.hY]);return C||p}),y=o.some(f=>(0,Re.ML)(a[f.name]));return l||y}var fn=n(96784),ln=n(11018),An=n(95443);const vn={groups:mn,state:Dn},Sn=ge.Ys+1,jn=(0,b.wS)(),Ln=()=>{const a=(0,u.useDispatch)(),o=(0,s.useMemo)(c.gR,[]),[l,y]=(0,s.useState)(!1),v=(0,s.useCallback)(()=>y(!1),[]),[f]=(0,i.s)(),{filterState:C,hasActiveFilters:p}=(0,fn.dI)(),h=C.labels.length>0,N=f.view,k=N==="state"||N==="groups"?N:"groups",le=vn[k]?k:"groups",q=vn[le],G=(0,te.$)(Ne=>Ne.promRules),H=(0,te.$)(Ne=>Ne.rulerRules),Q=o.some(Ne=>G[Ne]?.loading||H[Ne]?.loading),ye=Object.entries(G),we=Object.entries(H),He=ye.every(([Ne,fe])=>fe.dispatched&&(fe?.result!==void 0||fe?.error!==void 0)),Ye=we.every(([Ne,fe])=>fe.dispatched&&(fe?.result!==void 0||fe?.error!==void 0)),on=ye.every(([Ne,fe])=>fe.dispatched&&fe?.result?.length===0),be=we.every(([Ne,fe])=>Object.entries(fe?.result??{}).every(([Vn,wn])=>wn?.length===0)&&fe.dispatched),U=h?void 0:Sn,[$e,Ce]=(0,j.A)(async()=>{Q||(jn?(await a((0,ln.eB)({rulesSourceName:c.hY})),await a((0,ln.nV)(!1,{limitAlerts:U}))):await a((0,ln.yo)(!1,{limitAlerts:U})))},[Q,U,a]);(0,s.useEffect)(()=>{(0,A.Sq)().catch(()=>{})},[]),(0,s.useEffect)(()=>{jn?(a((0,ln.eB)({rulesSourceName:c.hY})),a((0,ln.nV)(!1,{limitAlerts:U}))):a((0,ln.yo)(!1,{limitAlerts:U}))},[a,U]),(0,D.A)(Ce,An.HH);const hn=He&&on&&ye.length>0&&be&&Ye,ue=!hn,Un=(0,_.dy)(),En=(0,fn.i7)(Un,C);return(0,e.jsx)(V.d,{navId:"alert-list",isLoading:!1,actions:ue&&(0,e.jsxs)(E.B,{gap:1,children:[(0,e.jsx)(Tn,{})," ",(0,e.jsx)(Bn,{})]}),children:(0,e.jsxs)(E.B,{direction:"column",children:[(0,e.jsx)($,{}),(0,e.jsx)(Y.A,{onClear:v}),ue&&(0,e.jsx)(E.B,{direction:"row",alignItems:"center",children:le==="groups"&&p&&(0,e.jsx)(g.$n,{icon:l?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>y(!l),children:l?"Collapse all":"Expand all"})}),(0,e.jsx)(Ze.M_,{namespaces:En}),hn&&(0,e.jsx)(oe,{}),ue&&(0,e.jsx)(q,{expandAll:l,namespaces:En})]})})};function Tn(){const[a,o]=(0,L.Ej)(L.RY.CreateAlertRule),[l,y]=(0,L.Ej)(L.RY.CreateExternalAlertRule),v=(0,F.zy)();return a&&o||l&&y?(0,e.jsx)(g.z9,{href:M.kM.renderUrl("alerting/new/alerting",{returnTo:v.pathname+v.search}),icon:"plus",onClick:()=>(0,d.fH)(A.le.alertRuleFromScratch),children:(0,e.jsx)(r.x6,{i18nKey:"alerting.rule-list.new-alert-rule",children:"New alert rule"})}):null}function Bn(){const a=location.pathname+location.search,o=(0,Z.G)("/alerting/export-new-rule",{returnTo:a});return(0,e.jsx)(g.z9,{href:o,icon:"download-alt",variant:"secondary",tooltip:(0,r.t)("alerting.export-new-rule-button.tooltip-export-new-grafana-rule","Export new grafana rule"),onClick:()=>(0,d.fH)(A.le.exportNewGrafanaRule),children:(0,e.jsx)(r.x6,{i18nKey:"alerting.list-view.section.grafanaManaged.export-new-rule",children:"Export rule definition"})})}var Kn=n(88547);const Nn=(0,s.lazy)(()=>Promise.all([n.e(9886),n.e(7666)]).then(n.bind(n,75285))),Fn=()=>{const a=P.$.featureToggles.alertingListViewV2;return(0,e.jsx)(s.Suspense,{children:a?(0,e.jsx)(Nn,{}):(0,e.jsx)(Ln,{})})},Wn=(0,Kn.S)(Fn)},24898:(ve,B,n)=>{n.d(B,{_:()=>j});var e=n(74848),s=n(2543),P=n.n(s),F=n(16692);const j=({actions:i,children:r})=>{const u=(0,s.filter)(i,E),A=(0,s.filter)(i,g);return u.length?(0,e.jsx)(D,{actions:u,children:r}):A.length?(0,e.jsx)(M,{actions:A,children:r}):null},D=({actions:i,children:r})=>{const u=(0,F.iI)();return d(u,i)?(0,e.jsx)(e.Fragment,{children:r}):null},M=({actions:i,children:r})=>{const u=(0,F.e2)();return d(u,i)?(0,e.jsx)(e.Fragment,{children:r}):null};function d(i,r){return(0,s.chain)(i).pick(r).values().value().some(([u,A])=>A===!0)}function E(i){return Object.values(F.QI).includes(i)}function g(i){return Object.values(F.RY).includes(i)}},54937:(ve,B,n)=>{n.d(B,{u:()=>x});var e=n(74848),s=n(22803),P=n(96540),F=n(63142),j=n(66404),D=n(34999),M=n(41654),d=n(18857),E=n(76319),g=n(56840),i=n(24961),r=n(5358),u=n(97507);const A=500,V=S=>new Promise(w=>setTimeout(w,S)),Y=1e3,x=({selectProps:S,showRefreshButton:w,selectedContactPointName:b,onError:ee=()=>{}})=>{const{selectedAlertmanager:je}=(0,r.VI)(),{contactPoints:oe,isLoading:ge,error:m,refetch:ie}=(0,u.dK)({alertmanager:je}),[ne,Fe]=(0,P.useState)(!1),me=(0,F.of)(z),De=oe.map(c=>({label:c.name,value:c,component:()=>(0,e.jsx)(j.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(i.yz,{receivers:c.grafana_managed_receiver_configs,limit:2})})})),Ee=(0,P.useMemo)(()=>De.find(c=>c.value?.name===b)||null,[De,b]),te=()=>{Fe(!0),Promise.all([ie(),V(Y)]).finally(()=>{Fe(!1)})};return(0,P.useEffect)(()=>{!ge&&b&&!Ee&&ee(new Error(`Contact point "${b}" could not be found`))},[ge,Ee,ee,b]),m?(0,e.jsx)(D.F,{title:(0,g.t)("alerting.contact-point-selector.title-failed-to-fetch-contact-points","Failed to fetch contact points"),severity:"error"}):(0,e.jsxs)(M.B,{children:[(0,e.jsx)(d.l6,{virtualized:De.length>A,options:De,value:Ee,...S,isLoading:ge,disabled:ge}),w&&(0,e.jsx)(E.K,{name:"sync",onClick:te,"aria-label":(0,g.t)("alerting.contact-point-selector.aria-label-refresh-contact-points","Refresh contact points"),tooltip:(0,g.t)("alerting.contact-point-selector.tooltip-refresh-contact-points-list","Refresh contact points list"),className:(0,s.cx)(me.refreshButton,{[me.loading]:ne||ge})})]})},X=(0,s.keyframes)({from:{transform:"rotate(0deg)"},to:{transform:"rotate(720deg)"}}),z=S=>({refreshButton:(0,s.css)({color:S.colors.text.secondary,cursor:"pointer",borderRadius:S.shape.radius.circle,overflow:"hidden"}),loading:(0,s.css)({pointerEvents:"none",[S.transitions.handleMotion("no-preference")]:{animation:`${X} 2s infinite linear`},[S.transitions.handleMotion("reduce")]:{animation:`${X} 6s infinite linear`}})})},71774:(ve,B,n)=>{n.d(B,{M:()=>F});var e=n(74848),s=n(45967),P=n(45861);const F=({tooltip:j,icon:D,to:M,target:d,onClick:E,className:g,tooltipPlacement:i="top",...r})=>{const u=typeof j=="string"?j:void 0;return(0,e.jsx)(s.m,{content:j,placement:i,children:M?(0,e.jsx)(P.z9,{variant:"secondary",fill:"text",icon:D,href:M,size:"sm",target:d,...r,"aria-label":u}):(0,e.jsx)(P.$n,{className:g,variant:"secondary",fill:"text",size:"sm",icon:D,type:"button",onClick:E,...r,"aria-label":u})})}},25833:(ve,B,n)=>{n.d(B,{A:()=>dn});var e=n(74848),s=n(22803),P=n(96540),F=n(49785),j=n(43173),D=n(63142),M=n(30703),d=n(41654),E=n(37386),g=n(72636),i=n(45967),r=n(77824),u=n(63527),A=n(45861),V=n(95506),Y=n(73427),x=n(56840),X=n(54937),z=n(96673),S=n(24619),w=n(74268),b=n(74869),ee=n(96784),je=n(98684),oe=n(56369),ge=n(5358),m=n(52161),ie=n(29609),ne=n(38055),Fe=n(48480),me=n(29246),De=n(85629),Ee=n(78282),te=n(36580),c=n(18857),W=n(63509);const K=R=>{const O=(0,Ee.l)(),[Ae,T]=(0,P.useState)(),Be=(J,de)=>{if(de.action==="clear"&&R.onClear){R.onClear();return}const Ue=J[J.length-1];let Pe,re;de.action==="pop-value"||de.action==="remove-value"?(Pe=de.removedValue?.value,re="remove"):(Pe=Ue.value,re="add");const _=O.getInstanceSettings(Pe);_&&(R.onChange(_,re),T({error:void 0}))},xe=()=>{const{current:J,hideTextValue:de,noDefault:Ue}=R;if(!(!J&&Ue))return J?.map(Pe=>{const re=O.getInstanceSettings(Pe);if(re)return{label:re.name.slice(0,37),value:re.name,imgUrl:re.meta.info.logos.small,hideText:de,meta:re.meta};const _=(0,Fe.Iz)(Pe);return _===te.dR.uid||_===te.dR.name?{label:_,value:_,hideText:de}:{label:(_??"no name")+" - not found",value:_??void 0,imgUrl:"",hideText:de}})},Se=()=>{const{alerting:J,tracing:de,metrics:Ue,mixed:Pe,dashboard:re,variables:_,annotations:sn,pluginId:un,type:I,filter:gn,logs:mn}=R,Ve=O.getList({alerting:J,tracing:de,metrics:Ue,logs:mn,dashboard:re,mixed:Pe,variables:_,annotations:sn,pluginId:un,filter:gn,type:I}),xn=Ve.filter(m.hP).map(se=>({value:se.name,label:`${se.name}${se.isDefault?" (default)":""}`,imgUrl:se.meta.info.logos.small,meta:se.meta})),pn=Ve.filter(se=>!(0,m.hP)(se)).map(se=>({value:se.name,label:`${se.name}${se.isDefault?" (default)":""}`,imgUrl:se.meta.info.logos.small,meta:se.meta}));return[{label:"Data sources with configured alert rules",options:xn,expanded:!0},{label:"Other data sources",options:pn,expanded:!0}]},{autoFocus:pe,onBlur:Qe,onClear:Xe,openMenuOnFocus:nn,placeholder:Le,width:Ze,inputId:tn,disabled:ke=!1,isLoading:_e=!1}=R,an=Se(),qe=xe(),rn=typeof Xe=="function";return(0,e.jsx)("div",{"data-testid":De.Tp.components.DataSourcePicker.container,children:(0,e.jsx)(c.KF,{isLoading:_e,disabled:ke,"data-testid":De.Tp.components.DataSourcePicker.inputV2,inputId:tn||"data-source-picker",className:"ds-picker select-container",isClearable:rn,backspaceRemovesValue:!0,onChange:Be,options:an,autoFocus:pe,onBlur:Qe,width:Ze,openMenuOnFocus:nn,maxMenuHeight:500,placeholder:Le,noOptionsMessage:"No datasources found",value:qe??[],invalid:!!Ae?.error||!!R.invalid,getOptionLabel:J=>J.meta&&(0,me.x)(J.meta.signature)&&J!==qe?(0,e.jsxs)(d.B,{alignItems:"center",justifyContent:"space-between",children:[(0,e.jsx)("span",{children:J.label})," ",(0,e.jsx)(W.B,{status:J.meta.signature})]}):J.label||""})})};var $=n(20962);const ae=[{icon:"folder",label:"Grouped",value:"grouped"},{icon:"list-ul",label:"List",value:"list"}];function ce(){const[R,O]=(0,$.l)(),{hasActiveFilters:Ae}=(0,ee.dI)(),T=R.get("view")==="list",Be=Ae||T?"list":"grouped",xe=Se=>{Se==="list"?(O({view:Se}),(0,w.aL)({view:Se})):O({view:void 0,search:void 0})};return(0,e.jsx)(r.z,{options:ae,value:Be,onChange:xe})}const L=[{label:"Grouped",value:"grouped"},{label:"List",value:"list"},{label:"State",value:"state"}];function Me(){const[R,O]=(0,$.l)(),Ae=R.get("view"),T=We(Ae),Be=xe=>{O({view:xe})};return(0,e.jsx)(r.z,{options:L,value:T,onChange:Be})}function We(R){return R==="list"?"list":R==="state"?"state":"grouped"}const Ie=j.$.featureToggles.alertingListViewV2?ce:Me,he=[{label:"Alert ",value:S.JS.Alerting},{label:"Recording ",value:S.JS.Recording}],Te=[{label:"Ok",value:oe.Jc.Ok},{label:"No Data",value:oe.Jc.NoData},{label:"Error",value:oe.Jc.Error}],Oe=(Y.TP.hasPermission(z.AccessControlAction.AlertingReceiversRead)&&j.$.featureToggles.alertingSimplifiedRouting&&(0,b.sk)()===!1)??!1,Ge=Object.entries(S.cF).map(([R,O])=>({label:(0,ie.XI)(O),value:O})),Je=({onClear:R=()=>{}})=>{const O=(0,D.of)(en),{pluginsFilterEnabled:Ae}=cn(),{filterState:T,hasActiveFilters:Be,searchQuery:xe,setSearchQuery:Se,updateFilters:pe}=(0,ee.dI)(),[Qe,Xe]=(0,P.useState)(Math.floor(Math.random()*100)),nn=`dataSource-${Qe}`,Le=`queryString-${Qe}`,Ze=(0,P.useRef)(null),{handleSubmit:tn,register:ke,setValue:_e}=(0,F.mN)({defaultValues:{searchQuery:xe}}),{ref:an,...qe}=ke("searchQuery");(0,P.useEffect)(()=>{_e("searchQuery",xe)},[xe,_e]);const rn=(I,gn)=>{const mn=gn==="add"?[...T.dataSourceNames].concat([I.name]):T.dataSourceNames.filter(Ve=>Ve!==I.name);pe({...T,dataSourceNames:mn}),Xe(Ve=>Ve+1),(0,w.Sn)("dataSourceNames")},J=I=>{pe({...T,dashboardUid:I}),(0,w.Sn)("dashboardUid")},de=()=>{pe({...T,dataSourceNames:[]}),Xe(I=>I+1)},Ue=I=>{(0,w.fH)(w.le.clickingAlertStateFilters),pe({...T,ruleState:I}),(0,w.Sn)("ruleState")},Pe=I=>{pe({...T,ruleType:I}),(0,w.Sn)("ruleType")},re=I=>{pe({...T,ruleHealth:I}),(0,w.Sn)("ruleHealth")},_=()=>{Se(void 0),R(),setTimeout(()=>Xe(Qe+1),100)},sn=I=>{pe({...T,contactPoint:I}),(0,w.Sn)("contactPoint")},un=(0,e.jsx)(M.I,{name:"search"});return(0,e.jsxs)(d.B,{direction:"column",gap:0,children:[(0,e.jsxs)(d.B,{direction:"row",gap:1,wrap:"wrap",children:[(0,e.jsx)(E.D,{className:O.dsPickerContainer,label:(0,e.jsx)(g.J,{htmlFor:"data-source-picker",children:(0,e.jsxs)(d.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:(0,e.jsx)(x.x6,{i18nKey:"alerting.rules-filter.search-by-data-sources",children:"Search by data sources"})}),(0,e.jsx)(i.m,{content:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:"Data sources containing configured alert rules are Mimir or Loki data sources where alert rules are stored and evaluated in the data source itself."}),(0,e.jsx)("p",{children:"In these data sources, you can select Manage alerts via Alerting UI to be able to manage these alert rules in the Grafana UI as well as in the data source where they were configured."})]}),children:(0,e.jsx)(M.I,{id:"data-source-picker-inline-help",name:"info-circle",size:"sm",title:(0,x.t)("alerting.rules-filter.data-source-picker-inline-help-title-search-by-data-sources-help","Search by data sources help")})})]})}),children:(0,e.jsx)(K,{alerting:!0,noDefault:!0,placeholder:(0,x.t)("alerting.rules-filter.placeholder-all-data-sources","All data sources"),current:T.dataSourceNames,onChange:rn,onClear:de},nn)}),(0,e.jsx)(E.D,{className:O.dashboardPickerContainer,label:(0,e.jsx)(g.J,{htmlFor:"filters-dashboard-picker",children:(0,e.jsx)(x.x6,{i18nKey:"alerting.rules-filter.dashboard",children:"Dashboard"})}),children:(0,e.jsx)(V.b,{inputId:"filters-dashboard-picker",value:T.dashboardUid,onChange:I=>J(I?.uid),isClearable:!0,cacheOptions:!0},T.dashboardUid?"dashboard-defined":"dashboard-not-defined")}),(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:(0,e.jsx)(x.x6,{i18nKey:"alerting.rules-filter.state",children:"State"})}),(0,e.jsx)(r.z,{options:Ge,value:T.ruleState,onChange:Ue})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:(0,e.jsx)(x.x6,{i18nKey:"alerting.rules-filter.rule-type",children:"Rule type"})}),(0,e.jsx)(r.z,{options:he,value:T.ruleType,onChange:Pe})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:(0,e.jsx)(x.x6,{i18nKey:"alerting.rules-filter.health",children:"Health"})}),(0,e.jsx)(r.z,{options:Te,value:T.ruleHealth,onChange:re})]}),Oe&&(0,e.jsx)(ge.b9,{accessType:"notification",alertmanagerSourceName:m.hY,children:(0,e.jsx)(d.B,{direction:"column",gap:0,children:(0,e.jsx)(E.D,{label:(0,e.jsx)(g.J,{htmlFor:"contactPointFilter",children:(0,e.jsx)(x.x6,{i18nKey:"alerting.contactPointFilter.label",children:"Contact point"})}),children:(0,e.jsx)(X.u,{selectedContactPointName:T.contactPoint,selectProps:{inputId:"contactPointFilter",width:40,onChange:I=>{sn(I?.value?.name)},isClearable:!0}})})})}),Ae&&(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:(0,e.jsx)(x.x6,{i18nKey:"alerting.rules-filter.plugin-rules",children:"Plugin rules"})}),(0,e.jsx)(r.z,{options:[{label:"Show",value:void 0},{label:"Hide",value:"hide"}],value:T.plugins,onChange:I=>pe({...T,plugins:I})})]})]}),(0,e.jsxs)(d.B,{direction:"column",gap:0,children:[(0,e.jsxs)(d.B,{direction:"row",gap:1,children:[(0,e.jsxs)("form",{className:O.searchInput,onSubmit:tn(I=>{Se(I.searchQuery),Ze.current?.blur(),(0,w.zs)({oldQuery:xe,newQuery:I.searchQuery})}),children:[(0,e.jsx)(E.D,{label:(0,e.jsx)(g.J,{htmlFor:"rulesSearchInput",children:(0,e.jsxs)(d.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:(0,e.jsx)(x.x6,{i18nKey:"alerting.rules-filter.search",children:"Search"})}),(0,e.jsx)(ne.B,{content:(0,e.jsx)(Re,{}),children:(0,e.jsx)(M.I,{name:"info-circle",size:"sm",tabIndex:0,title:(0,x.t)("alerting.rules-filter.title-search-help","Search help")})})]})}),children:(0,e.jsx)(u.p,{id:"rulesSearchInput",prefix:un,ref:I=>{an(I),Ze.current=I},...qe,placeholder:(0,x.t)("alerting.rules-filter.rulesSearchInput-placeholder-search","Search"),"data-testid":"search-query-input"},Le)}),(0,e.jsx)("input",{type:"submit",hidden:!0})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:(0,e.jsx)(x.x6,{i18nKey:"alerting.rules-filter.view-as",children:"View as"})}),(0,e.jsx)(Ie,{})]})]}),Be&&(0,e.jsx)("div",{children:(0,e.jsx)(A.$n,{fullWidth:!1,icon:"times",variant:"secondary",onClick:_,children:(0,e.jsx)(x.x6,{i18nKey:"alerting.rules-filter.clear-filters",children:"Clear filters"})})})]})]})},en=R=>({dsPickerContainer:(0,s.css)({width:R.spacing(60),flexGrow:0,margin:0}),dashboardPickerContainer:(0,s.css)({minWidth:R.spacing(50)}),searchInput:(0,s.css)({flex:1,margin:0})});function Re(){const R=(0,D.of)(ze);return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"Search syntax allows to query alert rules by the parameters defined below."}),(0,e.jsx)("hr",{}),(0,e.jsxs)("div",{className:R.grid,children:[(0,e.jsx)("div",{children:(0,e.jsx)(x.x6,{i18nKey:"alerting.search-query-help.filter-type",children:"Filter type"})}),(0,e.jsx)("div",{children:(0,e.jsx)(x.x6,{i18nKey:"alerting.search-query-help.expression",children:"Expression"})}),(0,e.jsx)(Z,{title:(0,x.t)("alerting.search-query-help.title-datasources","Datasources"),expr:"datasource:mimir datasource:prometheus"}),(0,e.jsx)(Z,{title:(0,x.t)("alerting.search-query-help.title-folder-namespace","Folder/Namespace"),expr:"namespace:global"}),(0,e.jsx)(Z,{title:(0,x.t)("alerting.search-query-help.title-group","Group"),expr:"group:cpu-usage"}),(0,e.jsx)(Z,{title:(0,x.t)("alerting.search-query-help.title-rule","Rule"),expr:'rule:"cpu 80%"'}),(0,e.jsx)(Z,{title:(0,x.t)("alerting.search-query-help.title-labels","Labels"),expr:"label:team=A label:cluster=a1"}),(0,e.jsx)(Z,{title:(0,x.t)("alerting.search-query-help.title-state","State"),expr:"state:firing|normal|pending"}),(0,e.jsx)(Z,{title:(0,x.t)("alerting.search-query-help.title-type","Type"),expr:"type:alerting|recording"}),(0,e.jsx)(Z,{title:(0,x.t)("alerting.search-query-help.title-health","Health"),expr:"health:ok|nodata|error"}),(0,e.jsx)(Z,{title:(0,x.t)("alerting.search-query-help.title-dashboard-uid","Dashboard UID"),expr:"dashboard:eadde4c7-54e6-4964-85c0-484ab852fd04"}),(0,e.jsx)(Z,{title:(0,x.t)("alerting.search-query-help.title-contact-point","Contact point"),expr:"contactPoint:slack"})]})]})}function Z({title:R,expr:O}){const Ae=(0,D.of)(ze);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:R}),(0,e.jsx)("code",{className:Ae.code,children:O})]})}const ze=R=>({grid:(0,s.css)({display:"grid",gridTemplateColumns:"max-content auto",gap:R.spacing(1),alignItems:"center"}),code:(0,s.css)({display:"block",textAlign:"center"})});function cn(){const{components:R}=(0,je.u)();return{pluginsFilterEnabled:R.length>0}}const dn=Je},98684:(ve,B,n)=>{n.d(B,{u:()=>P});var e=n(54092),s=n(33604);function P(){return(0,s.f)({extensionPointId:e.S.AlertingHomePage,limitPerPlugin:1})}},4956:(ve,B,n)=>{n.d(B,{B3:()=>ne,Om:()=>De,WG:()=>m,nh:()=>ie});var e=n(74848),s=n(22803),P=n(55127),F=n.n(P),j=n(96540),D=n(66404),M=n(89640),d=n(41654),E=n(63142),g=n(34999),i=n(30703),r=n(45967),u=n(56840),A=n(24619),V=n(74268),Y=n(1625),x=n(1972),X=n(17305),z=n(52161),S=n(67598),w=n(39659),b=n(77256),ee=n(51592),je=n(1148),oe=n(87672),ge=n(76267);const m=c=>{const{name:W,summary:K,state:$,health:ae,error:ce,href:L,isProvisioned:Me,lastEvaluation:We,evaluationInterval:Ie,isPaused:he=!1,instancesCount:Te=0,namespace:Oe,group:Ge,rulesSource:Je,application:en,contactPoint:Re,labels:Z,origin:ze,actions:cn=null,operation:dn}=c,R=(0,j.useId)(),O=[];return Oe&&Ge&&O.push((0,e.jsx)(D.E,{color:"secondary",variant:"bodySmall",children:(0,e.jsx)(Ee,{namespace:Oe,group:Ge,rulesSource:Je,application:en})})),he||(We&&Ie&&O.push((0,e.jsx)(me,{lastEvaluation:We,evaluationInterval:Ie,state:$})),Te&&O.push((0,e.jsx)(Y.P,{icon:"layers-alt",children:(0,e.jsx)(M.Y,{href:L+"?tab=instances",variant:"bodySmall",color:"primary",inline:!1,children:F()("instance",Te,!0)})}))),(0,w.rm)(Z)>0&&O.push((0,e.jsx)(Y.P,{icon:"tag-alt",children:(0,e.jsx)(M.Y,{href:L,variant:"bodySmall",color:"primary",inline:!1,children:F()("label",(0,w.rm)(Z),!0)})})),!he&&Re&&O.push((0,e.jsxs)(Y.P,{icon:"at",children:[(0,e.jsx)(u.x6,{i18nKey:"alerting.contact-points.delivered-to",children:"Delivered to"})," ",(0,e.jsx)(M.Y,{href:(0,b.bI)(Re,z.hY),variant:"bodySmall",color:"primary",inline:!1,children:Re})]})),(0,e.jsx)(ee.c,{"aria-labelledby":R,title:(0,e.jsxs)(d.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(M.Y,{href:L,color:"primary",inline:!1,id:R,children:W}),ze&&(0,e.jsx)(X.T,{pluginId:ze.pluginId,size:"sm"}),Me&&!ze&&(0,e.jsx)(x.rS,{})]}),description:(0,e.jsx)(Fe,{content:K,error:ce}),icon:(0,e.jsx)(oe.c,{state:$,health:ae,isPaused:he,operation:dn}),actions:cn,meta:O})};function ie({name:c,namespace:W,group:K,rulesSource:$,application:ae,href:ce,health:L,isProvisioned:Me,error:We,isPaused:Ie,origin:he,actions:Te}){const Oe=[];return W&&K&&Oe.push((0,e.jsx)(D.E,{color:"secondary",variant:"bodySmall",children:(0,e.jsx)(Ee,{namespace:W,group:K,rulesSource:$,application:ae})})),(0,e.jsx)(ee.c,{title:(0,e.jsxs)(d.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(M.Y,{href:ce,inline:!1,children:c}),he&&(0,e.jsx)(X.T,{pluginId:he.pluginId,size:"sm"}),Me&&!he&&(0,e.jsx)(x.rS,{})]}),description:(0,e.jsx)(Fe,{error:We}),icon:(0,e.jsx)(oe.c,{recording:!0,health:L,isPaused:Ie}),actions:Te,meta:Oe})}function ne({name:c,namespace:W,group:K,rulesSource:$,application:ae,operation:ce}){const L=(0,j.useId)(),Me=[];return W&&K&&Me.push((0,e.jsx)(D.E,{color:"secondary",variant:"bodySmall",children:(0,e.jsx)(Ee,{namespace:W,group:K,rulesSource:$,application:ae})})),(0,e.jsx)(ee.c,{"aria-labelledby":L,title:(0,e.jsx)(d.B,{direction:"row",alignItems:"center",children:(0,e.jsx)(D.E,{id:L,children:c})}),icon:(0,e.jsx)(oe.c,{operation:ce}),meta:Me})}function Fe({content:c,error:W}){return W?(0,e.jsx)(D.E,{variant:"bodySmall",color:"error",weight:"light",truncate:!0,element:"p",children:W}):c?(0,e.jsx)(D.E,{variant:"bodySmall",color:"secondary",children:c}):null}function me({lastEvaluation:c,evaluationInterval:W,state:K}){const $=(0,ge.C)(c,W);return K===A.cF.Firing&&$?(0,e.jsxs)(Y.P,{icon:"clock-nine",children:[(0,e.jsx)(u.x6,{i18nKey:"alerting.alert-rules.firing-for",children:"Firing for"})," ",(0,e.jsx)(D.E,{color:"primary",children:"2m 34s"}),$&&(0,e.jsxs)(e.Fragment,{children:["\xB7 ",(0,e.jsx)(u.x6,{i18nKey:"alerting.alert-rules.next-evaluation-in",children:"next evaluation in"})," ",$.humanized]})]}):$?(0,e.jsxs)(Y.P,{icon:"clock-nine",children:[(0,e.jsx)(u.x6,{i18nKey:"alerting.alert-rules.next-evaluation",children:"Next evaluation"})," ",$.humanized]}):null}const De=({ruleName:c,groupIdentifier:W,ruleDefinition:K})=>{const $=(0,E.of)(te);return(0,j.useEffect)(()=>{const{namespace:ae,groupName:ce}=W,L={name:c,groupName:ce,namespace:JSON.stringify(ae),rulesSource:(0,S.rO)(W)};(0,V.vV)(new Error("unknown rule type"),L)},[c,W]),(0,e.jsx)(g.F,{title:(0,u.t)("alerting.unknown-rule-list-item.title-unknown-rule-type","Unknown rule type"),className:$.resetMargin,children:(0,e.jsxs)("details",{children:[(0,e.jsx)("summary",{children:(0,e.jsx)(u.x6,{i18nKey:"alerting.alert-rules.rule-definition",children:"Rule definition"})}),(0,e.jsx)("pre",{children:(0,e.jsx)("code",{children:JSON.stringify(K,null,2)})})]})})},Ee=({namespace:c,group:W,rulesSource:K,application:$})=>{const ae=$==="grafana",ce=!!K&&!!$&&!ae;return(0,e.jsxs)(d.B,{direction:"row",alignItems:"center",gap:.5,children:[ae&&(0,e.jsx)(i.I,{size:"xs",name:"folder"}),ce&&(0,e.jsx)(r.m,{content:K.name,children:(0,e.jsx)("span",{children:(0,e.jsx)(je.H,{application:$,size:14})})}),(0,e.jsxs)(d.B,{direction:"row",alignItems:"center",gap:0,children:[c,(0,e.jsx)(i.I,{size:"sm",name:"angle-right"}),W]})]})},te=c=>({alertListItemContainer:(0,s.css)({position:"relative",listStyle:"none",background:c.colors.background.primary,borderBottom:`solid 1px ${c.colors.border.weak}`,padding:c.spacing(1,1,1,1.5)}),resetMargin:(0,s.css)({margin:0})})},51592:(ve,B,n)=>{n.d(B,{c:()=>M});var e=n(74848),s=n(22803),P=n(96540),F=n(63142),j=n(41654),D=n(66404);const M=i=>{const r=(0,F.of)(g),{icon:u=null,title:A,description:V,meta:Y,metaRight:x,actions:X,"data-testid":z,...S}=i;return(0,e.jsx)("li",{className:r.alertListItemContainer,role:"treeitem","aria-selected":"false","data-testid":z,...S,children:(0,e.jsxs)(j.B,{direction:"row",alignItems:"start",gap:1,wrap:!1,children:[u,(0,e.jsxs)(j.B,{direction:"column",gap:0,flex:"1",minWidth:0,children:[(0,e.jsxs)(j.B,{direction:"column",gap:0,children:[(0,e.jsx)("div",{className:r.textOverflow,children:A}),(0,e.jsx)("div",{className:r.textOverflow,children:V})]}),(0,e.jsx)(j.B,{direction:"row",gap:.5,alignItems:"center",children:Y?.map((w,b)=>(0,e.jsxs)(P.Fragment,{children:[b>0&&(0,e.jsx)(E,{}),w]},b))})]}),(0,e.jsxs)(j.B,{direction:"row",alignItems:"center",gap:1,wrap:!1,children:[x,X]})]})})},d=()=>jsx(M,{icon:jsx(Skeleton,{width:16,height:16,circle:!0}),title:jsx(Skeleton,{height:16,width:350}),actions:jsx(Skeleton,{height:10,width:200})}),E=()=>(0,e.jsx)(D.E,{color:"secondary",variant:"bodySmall",children:"\xB7"}),g=i=>({alertListItemContainer:(0,s.css)({position:"relative",listStyle:"none",background:i.colors.background.primary,borderBottom:`solid 1px ${i.colors.border.weak}`,padding:`${i.spacing(1)} ${i.spacing(1)}`}),textOverflow:(0,s.css)({overflow:"hidden",textOverflow:"ellipsis",color:"inherit"})})},64628:(ve,B,n)=>{n.d(B,{i:()=>i});var e=n(74848),s=n(22803),P=n(2543),F=n.n(P),j=n(42941),D=n(63142),M=n(41654),d=n(76319),E=n(56840),g=n(49779);const i=({children:u,title:A,collapsed:V=!1,actions:Y=null,pagination:x=null})=>{const X=(0,D.of)(r),[z,S]=(0,j.A)(V);return(0,e.jsxs)("li",{className:X.wrapper,role:"treeitem","aria-selected":"false",children:[(0,e.jsx)("div",{className:X.sectionTitle,children:(0,e.jsxs)(M.B,{alignItems:"center",children:[(0,e.jsxs)(M.B,{alignItems:"center",gap:0,children:[(0,e.jsx)(d.K,{name:z?"angle-right":"angle-down",onClick:S,"aria-label":(0,E.t)("common.collapse","Collapse")}),A]}),Y&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(g.h,{}),Y]})]})}),!(0,P.isEmpty)(u)&&!z&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("ul",{role:"group",className:X.groupItemsWrapper,children:u}),x]})]})},r=u=>({groupItemsWrapper:(0,s.css)({position:"relative",borderRadius:u.shape.radius.default,border:`solid 1px ${u.colors.border.weak}`,borderBottom:"none",marginLeft:u.spacing(1.5)}),wrapper:(0,s.css)({display:"flex",flexDirection:"column",gap:u.spacing(1)}),sectionTitle:(0,s.css)({padding:`${u.spacing(.5)} ${u.spacing(1)}`,background:u.colors.background.secondary,border:`solid 1px ${u.colors.border.weak}`,borderRadius:u.shape.radius.default})})},1148:(ve,B,n)=>{n.d(B,{H:()=>d});var e=n(74848),s=n(22803),P=n(30703),F=n(56840),j=n(24619),D=n(2401);const M=({children:i,name:r,href:u,application:A})=>{const V=useStyles2(E);return jsxs("li",{className:V.namespaceWrapper,role:"treeitem","aria-selected":"false",children:[jsx("div",{className:V.namespaceTitle,children:jsxs(Stack,{alignItems:"center",gap:1,children:[jsx(d,{application:A}),u?jsx(WithReturnButton,{title:t("alerting.namespace.title-alert-rules","Alert rules"),component:jsx(TextLink,{href:u,inline:!1,children:r})}):r]})}),i&&jsx("ul",{role:"group",className:V.groupItemsWrapper,children:i})]})},d=({application:i,size:r=16})=>{switch(i){case j.N1.Prometheus:return(0,e.jsx)("img",{width:r,height:r,src:"public/app/plugins/datasource/prometheus/img/prometheus_logo.svg",alt:"Prometheus"});case j.N1.Mimir:return(0,e.jsx)("img",{width:r,height:r,src:"public/app/plugins/datasource/prometheus/img/mimir_logo.svg",alt:"Mimir"});case"Loki":return(0,e.jsx)("img",{width:r,height:r,src:"public/app/plugins/datasource/loki/img/loki_icon.svg",alt:"Loki"});case"grafana":default:return(0,e.jsx)(P.I,{name:"grafana"})}},E=i=>({groupItemsWrapper:css({position:"relative",borderRadius:i.shape.radius.default,border:`solid 1px ${i.colors.border.weak}`,borderBottom:"none",marginLeft:i.spacing(3),"&:before":{content:"''",position:"absolute",height:"100%",borderLeft:`solid 1px ${i.colors.border.weak}`,marginTop:0,marginLeft:`-${i.spacing(2.5)}`}}),namespaceWrapper:css({display:"flex",flexDirection:"column",gap:i.spacing(1)}),namespaceTitle:css({padding:`${i.spacing(1)} ${i.spacing(1.5)}`})});var g=null},87672:(ve,B,n)=>{n.d(B,{c:()=>Y,s:()=>g});var e=n(74848),s=n(22803),P=n(96540),F=n(63142),j=n(45967),D=n(66404),M=n(30703),d=n(24619),E=n(74159),g=(z=>(z.Creating="Creating",z.Deleting="Deleting",z))(g||{});const i={[d.cF.Inactive]:"check-circle",[d.cF.Pending]:"circle",[d.cF.Recovering]:"exclamation-circle",[d.cF.Firing]:"exclamation-circle"},r={[d.cF.Inactive]:"success",[d.cF.Pending]:"warning",[d.cF.Recovering]:"warning",[d.cF.Firing]:"error"},u={[d.cF.Inactive]:"Normal",[d.cF.Pending]:"Pending",[d.cF.Firing]:"Firing",[d.cF.Recovering]:"Recovering"},A={Creating:"plus-circle",Deleting:"minus-circle"},V=18,Y=(0,P.memo)(function({state:S,health:w,recording:b=!1,isPaused:ee=!1,operation:je}){const oe=(0,F.of)(X),ge=(0,F.$j)();let m=S?i[S]:"circle",ie=S?r[S]:"secondary",ne=S?u[S]:"unknown";return b&&(m="record-audio",ie="success",ne="Recording"),w==="nodata"&&(m="exclamation-triangle",ie="warning",ne="Insufficient data"),(0,E.lf)(w)&&(m="times-circle",ie="error",ne="Failed to evaluate rule"),ee&&(m="pause-circle",ie="warning",ne="Paused"),je&&(m=A[je],ie="secondary",ne=je),(0,e.jsx)(j.m,{content:ne,placement:"right",children:(0,e.jsx)("div",{children:(0,e.jsx)(D.E,{color:ie,children:(0,e.jsxs)("div",{className:oe.iconsContainer,children:[(0,e.jsx)(M.I,{name:m,width:18,height:18,title:ne}),je&&(0,e.jsx)("svg",{width:V,height:V,viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg",className:oe.spinning,children:(0,e.jsx)("circle",{r:V/2,cx:"12",cy:"12",stroke:ge.colors.background.primary,strokeWidth:"3",strokeLinecap:"round",fill:"transparent",strokeOpacity:.85,strokeDasharray:"24px"})})]})})})})}),x=(0,s.keyframes)({"0%":{transform:"rotate(0deg)"},"50%":{transform:"rotate(180deg)"},"100%":{transform:"rotate(360deg)"}}),X=z=>({iconsContainer:(0,s.css)({position:"relative",width:18,height:18,"> *":{position:"absolute"}}),spinning:(0,s.css)({[z.transitions.handleMotion("no-preference")]:{animationName:x,animationIterationCount:"infinite",animationDuration:"1s",animationTimingFunction:"linear"}})})},88721:(ve,B,n)=>{n.d(B,{V:()=>P});var e=n(96540),s=n(54);function P(){return(0,e.useMemo)(()=>(0,s.Q9)(),[])}},10940:(ve,B,n)=>{n.d(B,{A:()=>P});var e=n(96540),s=function(F,j){var D=(0,e.useRef)(function(){});(0,e.useEffect)(function(){D.current=F}),(0,e.useEffect)(function(){if(j!==null){var M=setInterval(function(){return D.current()},j||0);return function(){return clearInterval(M)}}},[j])};const P=s}}]);

//# sourceMappingURL=AlertRuleListIndex.02e603d21fff22e69ea1.js.map