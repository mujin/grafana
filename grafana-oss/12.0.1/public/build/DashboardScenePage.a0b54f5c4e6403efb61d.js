"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8638],{83560:(U,v,a)=>{a.d(v,{X:()=>m});var e=a(96540),l=a(36490);const m=({message:f,when:c=!0})=>{const h=l.Ny.getHistory();return(0,e.useEffect)(()=>{if(!c)return;const D=h.block(f);return()=>{D()}},[c,f,h]),null}},39910:(U,v,a)=>{a.r(v),a.d(v,{DashboardScenePage:()=>$,default:()=>na});var e=a(74848),l=a(96540),m=a(54148),f=a(84596),c=a(75683),h=a(36490),D=a(56838),b=a(31286),L=a(13791),y=a(11098),O=a(99362),P=a(96673),S=a(22803),I=a(8515),Q=a(63142),K=a(22787),T=a(45861),V=a(83560),d=a(56840),N=a(15130),X=a(17732),A=a(8285);const W=(0,l.memo)(({dashboard:n})=>{const u=(0,l.useMemo)(()=>h.Ny.getLocation().pathname,[n]),{showModal:i,hideModal:t}=(0,l.useContext)(I.wE);(0,l.useEffect)(()=>{const s=r=>{F(n)||n.state.isDirty&&(r.preventDefault(),r.returnValue="")};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[n]);const o=s=>{const r=n.state.editPanel,g=r?.getPanel(),C=new URLSearchParams(s.search);if(r&&g&&(0,A.ME)(g)&&r.state.isDirty&&!C.has("editPanel")){const x=(0,A.iL)(g);return i(X.Z,{dashboard:n,isUnsavedPrompt:!0,libraryPanel:x,onConfirm:()=>{r.onConfirmSaveLibraryPanel(),t(),j(s)},onDiscard:()=>{r.onDiscard(),t(),j(s)},onDismiss:t}),!1}return u===s.pathname||F(n)||!n.state.isDirty?!0:(i(Z,{dashboard:n,onSaveDashboardClick:()=>{t(),n.openSaveDrawer({onSaveSuccess:()=>{j(s)}})},onDiscard:()=>{n.exitEditMode({skipConfirm:!0}),t(),j(s)},onDismiss:t}),!1)};return(0,e.jsx)(V.X,{when:!0,message:o})});W.displayName="DashboardPrompt";function j(n){n&&setTimeout(()=>h.Ny.push(n),10)}const Z=({onDiscard:n,onDismiss:u,onSaveDashboardClick:i})=>{const t=(0,Q.of)(J);return(0,e.jsxs)(K.a,{isOpen:!0,title:(0,d.t)("dashboard-scene.unsaved-changes-modal.title-unsaved-changes","Unsaved changes"),onDismiss:u,icon:"exclamation-triangle",className:t.modal,children:[(0,e.jsx)("h5",{children:(0,e.jsx)(d.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.changes",children:"Do you want to save your changes?"})}),(0,e.jsxs)(K.a.ButtonRow,{children:[(0,e.jsx)(T.$n,{variant:"secondary",onClick:u,fill:"outline",children:(0,e.jsx)(d.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.cancel",children:"Cancel"})}),(0,e.jsx)(T.$n,{variant:"destructive",onClick:n,children:(0,e.jsx)(d.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.discard",children:"Discard"})}),(0,e.jsx)(T.$n,{onClick:i,children:(0,e.jsx)(d.x6,{i18nKey:"dashboard-scene.unsaved-changes-modal.save-dashboard",children:"Save dashboard"})})]})]})},J=()=>({modal:(0,S.css)({width:"500px"})});function F(n){if(!n?.getInitialSaveModel()||n?.state.meta.version===0||!N.TP.isSignedIn||!n)return!0;const{canSave:i,fromScript:t,fromFile:o}=n.state.meta;return!N.TP.isEditor&&!i?!0:!i||t||o}var z=a(63704),w=a(43173),M=a(34999),H=a(41654),G=a(30703),k=a(19164),q=a(96727);const B={severity:"info",style:{flex:0}};function _({queryParams:n,slug:u,path:i}){const t=(0,q.H)(),o=(0,k.Kw)({name:u,path:i,ref:n.ref});if(o.data?.errors)return(0,e.jsx)(M.F,{title:(0,d.t)("dashboard-scene.dashboard-preview-banner.title-error-loading-dashboard","Error loading dashboard"),severity:"error",style:{flex:0},children:o.data.errors.map((r,g)=>(0,e.jsx)("div",{children:r},g))});if(t?.length)return(0,e.jsx)(M.F,{...B,title:(0,d.t)("dashboard-scene.dashboard-preview-banner.title-dashboard-loaded-request-git-hub","This dashboard is loaded from a pull request in GitHub."),buttonContent:(0,e.jsxs)(H.B,{alignItems:"center",children:[(0,e.jsx)(d.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.view-pull-request-in-git-hub",children:"View pull request in GitHub"}),(0,e.jsx)(G.I,{name:"external-link-alt"})]}),onRemove:()=>window.open(z.sQ.sanitizeUrl(t),"_blank"),children:(0,e.jsx)(d.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.value-not-saved",children:"The value is not yet saved in the Grafana database"})});const s=o.data?.urls?.newPullRequestURL??o.data?.urls?.compareURL;return s?(0,e.jsx)(M.F,{...B,title:(0,d.t)("dashboard-scene.dashboard-preview-banner.title-dashboard-loaded-branch-git-hub","This dashboard is loaded from a branch in GitHub."),buttonContent:(0,e.jsxs)(H.B,{alignItems:"center",children:[(0,e.jsx)(d.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.open-pull-request-in-git-hub",children:"Open pull request in GitHub"}),(0,e.jsx)(G.I,{name:"external-link-alt"})]}),onRemove:()=>window.open(z.sQ.sanitizeUrl(s),"_blank"),children:(0,e.jsx)(d.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.not-saved",children:"The value is not yet saved in the Grafana database"})}):(0,e.jsx)(M.F,{...B,title:(0,d.t)("dashboard-scene.dashboard-preview-banner.title-dashboard-loaded-external-repository","This dashboard is loaded from an external repository"),children:(0,e.jsx)(d.x6,{i18nKey:"dashboard-scene.dashboard-preview-banner.not-yet-saved",children:"The value is not saved in the Grafana database"})})}function aa({queryParams:n,route:u,slug:i,path:t}){return!w.$.featureToggles.provisioning||"kiosk"in n||!t||u!==P.DashboardRoutes.Provisioning||!i?null:(0,e.jsx)(_,{queryParams:n,slug:i,path:t})}var ea=a(41644);function $({route:n,queryParams:u,location:i}){const t=(0,m.g)(),{type:o,slug:s,uid:r}=t,g=t["*"],C=(0,f.A)({params:t}),x=(0,ea.sP)(),{dashboard:E,isLoading:ta,loadError:Y}=x.useState(),sa=i.state?.routeReloadCounter,p=(0,l.useRef)(t);if((0,l.useEffect)(()=>(n.routeName===P.DashboardRoutes.Normal&&o==="snapshot"?x.loadSnapshot(s):x.loadDashboard({uid:(n.routeName===P.DashboardRoutes.Provisioning?g:r)??"",type:o,slug:s,route:n.routeName,urlFolderUid:u.folderUid}),()=>{x.clearState()}),[x,r,n.routeName,u.folderUid,sa,o]),(0,l.useEffect)(()=>{if(n.routeName===P.DashboardRoutes.Normal&&r===p.current.uid&&p.current.slug&&!s){const R=`/d/${r}/${p.current.slug}`;h.Ny.replace({...h.Ny.getLocation(),pathname:R})}return()=>{p.current={uid:r,slug:s||p.current.slug}}},[n,s,o,r]),!E){let R;return Y&&(R=(0,e.jsx)(O.i,{error:Y,type:o})),R||(0,e.jsx)(L.Y,{navId:"dashboards/browse",layout:c.k.Canvas,"data-testid":"dashboard-scene-page",children:(0,e.jsx)(b.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:ta&&(0,e.jsx)(y.A,{})})})}return o!=="snapshot"&&(!C||r!==C?.params.uid)?(console.log("skipping rendering"),null):(0,e.jsxs)(D.$L,{scene:E,updateUrlOnInit:!0,createBrowserHistorySteps:!0,children:[(0,e.jsx)(aa,{queryParams:u,route:n.routeName,slug:s,path:g}),(0,e.jsx)(E.Component,{model:E},E.state.key),(0,e.jsx)(W,{dashboard:E})]})}const na=$},99362:(U,v,a)=>{a.d(v,{i:()=>L});var e=a(74848),l=a(75683),m=a(31286),f=a(34999),c=a(13791),h=a(1506),D=a(56840),b=a(47797);function L({error:y,type:O}){const P=(0,b.do)(y),S=(0,b.q6)(y),I=O==="snapshot"?"Snapshot":"Dashboard";return(0,e.jsx)(c.Y,{navId:"dashboards/browse",layout:l.k.Canvas,pageNav:{text:"Not found"},children:(0,e.jsx)(m.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:P===404?(0,e.jsx)(h.L,{entity:I}):(0,e.jsx)(f.F,{title:(0,D.t)("dashboard.errors.failed-to-load","Failed to load dashboard"),severity:"error","data-testid":"dashboard-page-error",children:S})})})}},96727:(U,v,a)=>{a.d(v,{H:()=>m});var e=a(63704),l=a(74101);const m=()=>{const[f]=(0,l.z)(),c=f.get("pull_request_url");if(c)return e.sQ.sanitizeUrl(decodeURIComponent(c))}}}]);

//# sourceMappingURL=DashboardScenePage.a0b54f5c4e6403efb61d.js.map