"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8995],{30783:(fe,U,s)=>{s.r(U),s.d(U,{plugin:()=>de});var l=s(74848),C=s(16207),L=s(10928),M=s(67804),E=s(2543),m=s(96540),F=s(64305),$=function(e,a){a===void 0&&(a=200);var c=(0,m.useState)(e),n=c[0],d=c[1],u=(0,m.useRef)(),I=(0,m.useRef)(null),v=(0,m.useRef)(0);return(0,m.useEffect)(function(){if(u.current)I.current=e,v.current=!0;else{d(e);var w=function(){v.current?(v.current=!1,d(I.current),u.current=setTimeout(w,a)):u.current=void 0};u.current=setTimeout(w,a)}},[e]),(0,F.A)(function(){u.current&&clearTimeout(u.current)}),n};const A=$;var P=s(5556),z=s(63704),j=s(38036),O=s(63142),Q=s(76319),G=s(92807),K=s(6890),J=s(65642),W=s(73427),X=s(94232),V=s(38206),Y=s(43550),T=s(83873),Z=s(67020),k=s(22429),q=s(88813),B=s(96673),g=s(22803);const _=e=>({dashlistSectionHeader:(0,g.css)({padding:e.spacing(.25,1),marginRight:e.spacing(1)}),dashlistSection:(0,g.css)({marginBottom:e.spacing(2),paddingTop:e.spacing(.5)}),dashlistLink:(0,g.css)({display:"flex",cursor:"pointer",borderBottom:`1px solid ${e.colors.border.weak}`,margin:e.spacing(1),padding:e.spacing(1),alignItems:"center","&:hover":{a:{color:e.colors.text.link,textDecoration:"underline"}}}),dashlistFolder:(0,g.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,lineHeight:e.typography.body.lineHeight}),dashlistTitle:(0,g.css)({"&::after":{position:"absolute",content:'""',left:0,top:0,bottom:0,right:0}}),dashlistLinkBody:(0,g.css)({flexGrow:1}),dashlistItem:(0,g.css)({position:"relative",listStyle:"none"})});async function ee(e,a){let c=Promise.resolve([]);if(e.showStarred){const r={limit:e.maxItems,starred:"true"};c=(0,T.AI)().search(r)}let n=Promise.resolve([]),d=[];if(e.showRecentlyViewed){let r=await Z.A.getDashboardOpened();d=(0,E.take)(r,e.maxItems),n=(0,T.AI)().search({dashboardUIDs:d,limit:e.maxItems})}let u=Promise.resolve([]);if(e.showSearch){const r=e.folderUID===""?"general":e.folderUID,y={limit:e.maxItems,query:a(e.query,{},"text"),folderUIDs:r,tag:e.tags.map(p=>a(p,{},"text")),type:"dash-db"};u=(0,T.AI)().search(y)}const[I,v,w]=await Promise.all([c,u,n]);let f=new Map;for(const r of d){const y=w.find(p=>p.uid===r);y&&f.set(r,{...y,isRecent:!0})}return v.forEach(r=>{r.uid&&(f.has(r.uid)?f.get(r.uid).isSearchResult=!0:f.set(r.uid,{...r,isSearchResult:!0}))}),I.forEach(r=>{r.uid&&(f.has(r.uid)?f.get(r.uid).isStarred=!0:f.set(r.uid,{...r,isStarred:!0}))}),f}function te(e){const[a,c]=(0,m.useState)(new Map),n=(0,B.useDispatch)(),d=(0,B.useSelector)(i=>i.navIndex),u=A(e.renderCounter,5e3);(0,m.useEffect)(()=>{ee(e.options,e.replaceVariables).then(i=>{c(i)})},[e.options,e.replaceVariables,u]);const I=async(i,t)=>{const{uid:o,title:x,url:H}=t;i.preventDefault(),i.stopPropagation();const R=await(0,k.UA)().starDashboard(t.uid,t.isStarred),N=new Map(a);N.set(t?.uid??"",{...t,isStarred:R}),c(N),n((0,V.ci)({id:o??"",title:x,url:H,isStarred:R}));const D=d.starred;if(R)D.children?.push({id:V.L1+o,text:x,url:H??"",parentItem:D});else{n((0,Y.Im)(V.L1+o));const b=D.children?.findIndex(he=>he.id===V.L1+o);b&&D.children?.splice(b,1)}n((0,K.Vz)(D))},[v,w,f]=(0,m.useMemo)(()=>{const i=[...a.values()];return[i.filter(t=>t.isStarred).sort((t,o)=>t.title.localeCompare(o.title)),i.filter(t=>t.isRecent),i.filter(t=>t.isSearchResult).sort((t,o)=>t.title.localeCompare(o.title))]},[a]),{showStarred:r,showRecentlyViewed:y,showHeadings:p,showFolderNames:ie,showSearch:ne}=e.options,le=[{header:"Starred dashboards",dashboards:v,show:r},{header:"Recently viewed dashboards",dashboards:w,show:y},{header:"Search",dashboards:f,show:ne}],S=(0,O.of)(_),ce=se(e),ue=i=>(0,l.jsx)("ul",{children:i.map(t=>{let o=t.url;return o=P.kM.appendQueryToUrl(o,ce),o=(0,J.zj)().disableSanitizeHtml?o:z.sQ.sanitizeUrl(o),(0,l.jsx)("li",{className:S.dashlistItem,children:(0,l.jsxs)("div",{className:S.dashlistLink,children:[(0,l.jsxs)("div",{className:S.dashlistLinkBody,children:[(0,l.jsx)("a",{className:S.dashlistTitle,href:o,children:t.title}),ie&&t.folderTitle&&(0,l.jsx)("div",{className:S.dashlistFolder,children:t.folderTitle})]}),(0,l.jsx)(Q.K,{tooltip:t.isStarred?`Unmark "${t.title}" as favorite`:`Mark "${t.title}" as favorite`,name:t.isStarred?"favorite":"star",iconType:t.isStarred?"mono":"default",onClick:x=>I(x,t)})]})},`dash-${t.uid}`)})});return(0,l.jsx)(G.P,{minHeight:"100%",children:le.map(({show:i,header:t,dashboards:o},x)=>i&&(0,l.jsxs)("div",{className:S.dashlistSection,children:[p&&(0,l.jsx)("h6",{className:S.dashlistSectionHeader,children:t}),ue(o)]},`dash-group-${x}`))})}function se(e){(0,X.u)(W.lE,q.og);let a={};return e.options.keepTime&&(a[`$${j.c.keepTime}`]=!0),e.options.includeVars&&(a[`$${j.c.includeVars}`]=!0),e.replaceVariables(P.kM.toUrlParams(a))}var ae=s(68143);async function re(e){return e===0?"":(await(0,ae.AI)().get(`/api/folders/id/${e}`,void 0,void 0,{showErrorAlert:!1})).uid}async function oe(e){const a={...e.options,showStarred:e.options.showStarred??e.starred,showRecentlyViewed:e.options.showRecentlyViewed??e.recent,showSearch:e.options.showSearch??e.search,showHeadings:e.options.showHeadings??e.headings,maxItems:e.options.maxItems??e.limit,query:e.options.query??e.query,folderId:e.options.folderId??e.folderId,tags:e.options.tags??e.tags};if(parseFloat(e.pluginVersion||"6.1")<6.3&&["starred","recent","search","headings","limit","query","folderId"].forEach(d=>delete e[d]),a.folderId!==void 0){const n=a.folderId;try{const d=await re(n);a.folderUID=d,delete a.folderId}catch(d){console.warn("Dashlist: Error migrating folder ID to UID",d)}}return a}const h={includeVars:!1,keepTime:!1,maxItems:10,query:"",showFolderNames:!0,showHeadings:!0,showRecentlyViewed:!1,showSearch:!1,showStarred:!0,tags:[]},de=new C.m(te).setPanelOptions(e=>{e.addBooleanSwitch({path:"keepTime",name:"Include current time range",defaultValue:h.keepTime}).addBooleanSwitch({path:"includeVars",name:"Include current template variable values",defaultValue:h.includeVars}).addBooleanSwitch({path:"showStarred",name:"Starred",defaultValue:h.showStarred}).addBooleanSwitch({path:"showRecentlyViewed",name:"Recently viewed",defaultValue:h.showRecentlyViewed}).addBooleanSwitch({path:"showSearch",name:"Search",defaultValue:h.showSearch}).addBooleanSwitch({path:"showHeadings",name:"Show headings",defaultValue:h.showHeadings}).addBooleanSwitch({path:"showFolderNames",name:"Show folder names",defaultValue:h.showFolderNames}).addNumberInput({path:"maxItems",name:"Max items",defaultValue:h.maxItems}).addTextInput({path:"query",name:"Query",defaultValue:h.query}).addCustomEditor({path:"folderUID",name:"Folder",id:"folderUID",defaultValue:void 0,editor:function({value:c,onChange:n}){return(0,l.jsx)(M.d,{clearable:!0,permission:"view",value:c,onChange:d=>n(d)})}}).addCustomEditor({id:"tags",path:"tags",name:"Tags",description:"",defaultValue:h.tags,editor(a){return(0,l.jsx)(L.u,{tags:a.value,onChange:a.onChange})}})}).setMigrationHandler(oe)}}]);

//# sourceMappingURL=dashListPanel.f496c01da76f72b86d2e.js.map