"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9170],{57632:(F,V,l)=>{l.d(V,{z:()=>x,e:()=>M});var r=l(74848),h=l(96540),$=l(95004),z=l(62748),Y=l(7515),u=l(22803),I=l(34743),E=l(83505),Z=l(46885),D=l(55386),B=l(85629),A=l(63142),G=l(15245),O=l(70362),H=l(15840);function c(t){const s={position:"relative",top:"auto",right:"auto",marginRight:0};return(0,r.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"flex-end",paddingBottom:"6px"},children:(0,r.jsx)(H.J,{onClick:t.onClick,style:t.style??s})})}const g=({timeZone:t,dataFrame:s,dataFrameFieldIndex:e,config:a,exemplarColor:o,clickedExemplarFieldIndex:n,setClickedExemplarFieldIndex:p,maxHeight:i})=>{const d=(0,A.of)(f),[w,v]=(0,h.useState)(!1),[b,m]=(0,h.useState)(!1),L=[(0,I.UU)({fallbackAxisSideDirection:"end",crossAxis:!1,boundary:document.body}),(0,I.BN)()],{context:R,refs:j,floatingStyles:N}=(0,E.we)({open:w,placement:"bottom",onOpenChange:v,middleware:L,whileElementsMounted:Z.ll,strategy:"fixed"}),T=(0,E.s9)(R),P=(0,E.Mk)(R,{handleClose:(0,E.iB)(),enabled:n===void 0}),{getReferenceProps:U,getFloatingProps:K}=(0,E.bv)([T,P]);(0,h.useEffect)(()=>{n?.fieldIndex===e.fieldIndex&&n?.frameIndex===e.frameIndex||m(!1)},[n,e]);const q=()=>{const C=[(0,r.jsx)("rect",{fill:o,x:"3.38672",width:"4.78985",height:"4.78985",transform:"rotate(45 3.38672 0)"},"diamond"),(0,r.jsx)("path",{fill:o,d:"M1.94444 3.49988L0 5.44432L1.55552 6.99984L3.49996 5.05539L5.4444 6.99983L6.99992 5.44431L5.05548 3.49988L6.99983 1.55552L5.44431 0L3.49996 1.94436L1.5556 0L8.42584e-05 1.55552L1.94444 3.49988Z"},"x"),(0,r.jsx)("path",{fill:o,d:"M4 0L7.4641 6H0.535898L4 0Z"},"triangle"),(0,r.jsx)("rect",{fill:o,width:"5",height:"5"},"rectangle"),(0,r.jsx)("path",{fill:o,d:"M3 0.5L5.85317 2.57295L4.76336 5.92705H1.23664L0.146831 2.57295L3 0.5Z"},"pentagon"),(0,r.jsx)("path",{fill:o,d:"m2.35672,4.2425l0,2.357l1.88558,0l0,-2.357l2.3572,0l0,-1.88558l-2.3572,0l0,-2.35692l-1.88558,0l0,2.35692l-2.35672,0l0,1.88558l2.35672,0z"},"plus")];return C[e.frameIndex%C.length]},_=()=>{m(!0)},tt=(0,h.useCallback)(()=>{const C=s.fields.filter(y=>y.config.links?.length&&y.config.links?.length>0)||[],st=[...C,...s.fields.filter(y=>!C.includes(y))],ot=()=>{m(!1),v(!1),p(void 0)};let J=[],Q=[];st.map((y,rt)=>{const W=y.values[e.fieldIndex];y.config.links?.length&&Q?.push(...y.getLinks?.({valueRowIndex:e.fieldIndex})||[]);const lt=y.display?y.display(W):{text:`${W}`,numeric:+W};J.push({name:y.name,value:W,valueString:(0,D.cN)(lt),highlight:!1})});const nt={position:"relative",top:"35px",right:"5px",marginRight:0};return(0,r.jsxs)("div",{className:d.tooltip,ref:j.setFloating,style:N,...K(),children:[b&&(0,r.jsx)(c,{onClick:ot,style:nt}),(0,r.jsx)(O.i,{displayValues:J,links:Q,maxHeight:i})]})},[s.fields,e,d,b,p,N,K,j.setFloating,i]),et=a.getSeries().find(C=>C.props.dataFrameFieldIndex?.frameIndex===e.frameIndex)?.props.lineColor,X=()=>{p(e),_()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{ref:j.setReference,className:d.markerWrapper,"data-testid":B.Tp.components.DataSource.Prometheus.exemplarMarker,role:"button",tabIndex:0,...U(),onClick:X,onKeyDown:C=>{C.key==="Enter"&&X()},children:(0,r.jsx)("svg",{viewBox:"0 0 7 7",width:"7",height:"7",style:{fill:et},className:(0,u.cx)(d.marble,(w||b)&&d.activeMarble),children:q()})}),(w||b)&&(0,r.jsx)(G.ZL,{children:tt()})]})},f=t=>{const s=t.isDark?t.v1.palette.dark2:t.v1.palette.white,e=t.isDark?t.v1.palette.dark9:t.v1.palette.gray5,a=t.isDark?t.v1.palette.black:t.v1.palette.white,o=t.isDark?t.v1.palette.dark3:t.v1.palette.gray6;return{markerWrapper:(0,u.css)({padding:"0 4px 4px 4px",width:"8px",height:"8px",boxSizing:"content-box",transform:"translate3d(-50%, 0, 0)","&:hover":{"> svg":{transform:"scale(1.3)",opacity:1,filter:"drop-shadow(0 0 8px rgba(0, 0, 0, 0.5))"}}}),marker:(0,u.css)({width:0,height:0,borderLeft:"4px solid transparent",borderRight:"4px solid transparent",borderBottom:`4px solid ${t.v1.palette.red}`,pointerEvents:"none"}),wrapper:(0,u.css)({background:s,border:`1px solid ${e}`,borderRadius:t.shape.borderRadius(2),boxShadow:`0 0 20px ${a}`,padding:t.spacing(1)}),exemplarsTable:(0,u.css)({width:"100%","tr td":{padding:"5px 10px",whiteSpace:"nowrap",borderBottom:`4px solid ${t.components.panel.background}`},tr:{backgroundColor:t.colors.background.primary,"&:nth-child(even)":{backgroundColor:o}}}),valueWrapper:(0,u.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",columnGap:t.spacing(1),"> span":{flexGrow:0},"> *":{flex:"1 1",alignSelf:"center"}}),tooltip:(0,u.css)({background:"none",padding:0,overflowY:"auto",maxHeight:"95vh",boxShadow:t.shadows.z2}),header:(0,u.css)({background:e,padding:"6px 10px",display:"flex"}),title:(0,u.css)({fontWeight:t.typography.fontWeightMedium,paddingRight:t.spacing(2),overflow:"hidden",display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis",flexGrow:1}),body:(0,u.css)({fontWeight:t.typography.fontWeightMedium,borderRadius:t.shape.borderRadius(2),overflow:"hidden"}),marble:(0,u.css)({display:"block",opacity:.5,[t.transitions.handleMotion("no-preference")]:{transition:"transform 0.15s ease-out"}}),activeMarble:(0,u.css)({transform:"scale(1.3)",opacity:1,filter:"drop-shadow(0 0 8px rgba(0, 0, 0, 0.5))"})}},x=({exemplars:t,timeZone:s,config:e,visibleSeries:a,maxHeight:o})=>{const n=(0,h.useRef)(),[p,i]=(0,h.useState)();(0,h.useLayoutEffect)(()=>{e.addHook("init",v=>{n.current=v})},[e]);const d=(0,h.useCallback)((v,b)=>{const m=v.fields.find(P=>P.name===$.LE),L=v.fields.find(P=>P.name===$.Bc);if(!m||!L||!n.current)return;const R=Object.keys(n.current.scales).find(P=>!["x","y"].some(U=>U===P))??z.s,j=n.current.scales[R].min,N=n.current.scales[R].max;let T=L.values[b.fieldIndex];return j!=null&&T<j&&(T=j),N!=null&&T>N&&(T=N),{x:n.current.valToPos(m.values[b.fieldIndex],"x"),y:n.current.valToPos(T,R)}},[]),w=(0,h.useCallback)((v,b)=>{const m=a!==void 0?k(a,v,b):!0,L=a!==void 0?S(v,b,a):void 0;return m?(0,r.jsx)(g,{setClickedExemplarFieldIndex:i,clickedExemplarFieldIndex:p,timeZone:s,dataFrame:v,dataFrameFieldIndex:b,config:e,exemplarColor:L,maxHeight:o}):(0,r.jsx)(r.Fragment,{})},[e,s,a,i,p,o]);return(0,r.jsx)(Y.a,{config:e,id:"exemplars",events:t,renderEventMarker:w,mapEventToXYCoords:d})},M=(t,s)=>{const e=t.series.filter(o=>o.props.show),a=[];return s?.length&&e.forEach(o=>{const n=o.props?.dataFrameFieldIndex?.frameIndex,p=o.props?.dataFrameFieldIndex?.fieldIndex;if(n!==void 0&&p!==void 0){const i=s[n]?.fields[p];i?.labels&&a.push({labels:i.labels,color:o.props?.lineColor??""})}}),{labels:a,totalSeriesCount:t.series.length}},S=(t,s,e)=>{let a;return e.labels.some(o=>{const n=Object.keys(o.labels),p=t.fields.filter(i=>n.find(d=>d===i.name));return p.length&&p.every((d,w,v)=>{const b=d.values[s.fieldIndex];return o.labels[d.name]===b})?(a=o.color,!0):!1}),a},k=(t,s,e)=>{let a=!1;return t.labels.length===t.totalSeriesCount?a=!0:t.labels.some(o=>{const n=Object.keys(o.labels);if(Object.keys(o.labels).length===0)a=!0;else{const p=s.fields.filter(i=>n.find(d=>d===i.name));p.length&&(a=t.labels.some(i=>Object.keys(i.labels).every(d=>{const w=i.labels[d];return p.find(v=>v.values[e.fieldIndex]===w)})))}return a}),a}},66881:(F,V,l)=>{l.d(V,{p:()=>H});var r=l(74848),h=l(96540),$=l(95004),z=l(55386),Y=l(70332),u=l(22803),I=l(2543),E=l(55794),Z=l.n(E),D=l(63142);const B=({step:c,y:g,dragBounds:f,mapPositionToValue:x,formatValue:M,onChange:S})=>{const k=(0,D.$j)();let t=g,s="none";g<(f.top??0)&&(s="top"),g>(f.bottom??0)+22&&(s="bottom"),s==="bottom"&&(t=f.bottom??g),s==="top"&&(t=f.top??g);const e=typeof S!="function",a=(0,D.of)(A,c,s,e),[o,n]=(0,h.useState)(c.value),p=(0,h.useMemo)(()=>k.colors.getContrastText(k.visualization.getColorByName(c.color)),[c.color,k]);return(0,r.jsx)(Z(),{axis:"y",grid:[1,1],disabled:e,onStop:e?I.noop:(i,d)=>(S(x(d.lastY)),!1),onDrag:(i,d)=>n(x(d.lastY)),position:{x:0,y:t},bounds:f,children:(0,r.jsx)("div",{className:a.handle,style:{color:p},children:(0,r.jsx)("span",{className:a.handleText,children:M(o)})})})};B.displayName="ThresholdDragHandle";const A=(c,g,f,x)=>{const M=c.visualization.getColorByName(g.color),S=G(f),k=f!=="none";return{handle:(0,u.css)({display:"flex",alignItems:"center",position:"absolute",left:0,width:"calc(100% - 9px)",height:"18px",marginTop:"-9px",borderColor:M,cursor:x?"initial":"grab",borderTopRightRadius:c.shape.radius.default,borderBottomRightRadius:c.shape.radius.default,background:M,fontSize:c.typography.bodySmall.fontSize,"&:before":S},k&&{marginTop:0,borderRadius:c.shape.radius.default}),handleText:(0,u.css)({textAlign:"center",width:"100%",display:"block",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"})}};function G(c){const g=c==="none",f=x=>({content:"''",position:"absolute",bottom:0,top:0,width:0,height:0,left:0,borderRightStyle:"solid",borderRightWidth:`${x}px`,borderRightColor:"inherit",borderTop:`${x}px solid transparent`,borderBottom:`${x}px solid transparent`});return g?(0,u.css)({...f(9),left:"-9px"}):c==="top"?(0,u.css)({...f(5),left:"calc(50% - 2.5px)",top:"-7px",transform:"rotate(90deg)"}):c==="bottom"?(0,u.css)({...f(5),left:"calc(50% - 2.5px)",top:"calc(100% - 2.5px)",transform:"rotate(-90deg)"}):""}const O=60,H=({config:c,fieldConfig:g,onThresholdsChange:f})=>{const x=(0,h.useRef)(),[M,S]=(0,h.useState)(0);(0,h.useLayoutEffect)(()=>{c.setPadding([0,O,0,0]),c.addHook("init",t=>{x.current=t}),c.addHook("draw",()=>{S(t=>t+1)})},[c]);const k=(0,h.useMemo)(()=>{const t=x.current;if(!t)return null;const s=g.defaults.thresholds;if(!s)return null;const e=(0,Y.M)(g.defaults,$.PU.number),a=g.defaults.decimals,o=[];for(let n=0;n<s.steps.length;n++){const p=s.steps[n],i=t.valToPos(p.value,e);if(Number.isNaN(i)||!Number.isFinite(i))continue;const d=t.bbox.height/window.devicePixelRatio,v=typeof f=="function"?m=>{const L=[...s.steps.slice(0,n),...s.steps.slice(n+1),{...s.steps[n],value:m}].sort((R,j)=>R.value-j.value);f({...s,steps:L})}:void 0,b=(0,r.jsx)(B,{step:p,y:i,dragBounds:{top:0,bottom:d},mapPositionToValue:m=>t.posToVal(m,e),formatValue:m=>(0,z.j_)(e)(m,a).text,onChange:v},`${p.value}-${n}`);o.push(b)}return o},[M,g,f]);return x.current?(0,r.jsx)("div",{style:{position:"absolute",overflow:"visible",left:`${(x.current.bbox.left+x.current.bbox.width)/window.devicePixelRatio}px`,top:`${x.current.bbox.top/window.devicePixelRatio}px`,width:`${O}px`,height:`${x.current.bbox.height/window.devicePixelRatio}px`},children:k}):null};H.displayName="ThresholdControlsPlugin"}}]);

//# sourceMappingURL=9170.51b84e6690fa17b2440d.js.map