"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1743],{91087:(te,R,a)=>{a.d(R,{y:()=>P});var e=a(74848),c=a(96540),u=a(41053),j=a(73427),b=a(96673),x=a(59812),y=a(12037);const P=({basicRole:r,roles:D,userId:A,orgId:m,onBasicRoleChange:T,roleOptions:C,disabled:w,basicRoleDisabled:X,basicRoleDisabledMessage:E,apply:S=!1,onApplyRoles:W,pendingRoles:p,maxWidth:Y,width:O,isLoading:Z})=>{const[{loading:re,value:oe=D||[]},H]=(0,u.A)(async()=>{try{if(D)return D;if(S&&p?.length)return p;if(j.TP.hasPermission(b.AccessControlAction.ActionUserRolesList)&&A>0)return await(0,y.Xh)(A,m)}catch{console.error("Error loading options")}return[]},[m,A,p,D]);(0,c.useEffect)(()=>{m&&H()},[H,m]);const z=async J=>{S?W&&W(J,A,m):(await(0,y.eA)(J,A,m),await H())},V=j.TP.hasPermission(b.AccessControlAction.ActionUserRolesAdd)&&j.TP.hasPermission(b.AccessControlAction.ActionUserRolesRemove);return(0,e.jsx)(x.n,{appliedRoles:oe,basicRole:r,onRolesChange:z,onBasicRoleChange:T,roleOptions:C,isLoading:re||Z,disabled:w,basicRoleDisabled:X,basicRoleDisabledMessage:E,showBasicRole:!0,apply:S,canUpdateRoles:V,maxWidth:Y,width:O})}},31908:(te,R,a)=>{a.d(R,{I:()=>m});var e=a(74848),c=a(49785),u=a(47184),j=a(89640),b=a(8207),x=a(37386),y=a(77824),P=a(56840),r=a(96673);const D=Object.keys(r.OrgRole).map(u.z),A=(0,e.jsxs)(P.x6,{i18nKey:"role-picker.title.description",children:["Assign roles to users to ensure granular control over access to Grafana\u2018s features and resources. Find out more in our"," ",(0,e.jsx)(j.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/roles-and-permissions/#organization-roles",children:"documentation"}),"."]}),m=({onClose:T})=>{const C=(0,c.xW)(),{control:w,getValues:X,setValue:E}=C,[S,W]=X(["name","roles"]);return(0,e.jsx)(b._,{title:S,subtitle:A,onClose:T,children:(0,e.jsx)(x.D,{label:(0,P.t)("role-picker-drawer.basic-roles.label","Basic Roles"),children:(0,e.jsx)(c.xI,{name:"role",control:w,render:({field:{onChange:p,ref:Y,...O}})=>(0,e.jsx)(y.z,{...O,options:D,onChange:Z=>{E("roleCollection",[Z,...W]),p(Z)}})})})})}},9390:(te,R,a)=>{a.d(R,{r:()=>y});var e=a(74848),c=a(90382),u=a(18857),j=a(56840);const x=Object.values(c.X).filter(P=>P!==c.X.None).map(P=>({label:P,value:P}));function y({value:P,onChange:r,"aria-label":D,inputId:A,autoFocus:m,...T}){return(0,e.jsx)(u.l6,{inputId:A,value:P,options:x,onChange:C=>r(C.value??c.X.None),placeholder:(0,j.t)("admin.org-role-picker.placeholder-choose-role","Choose role..."),"aria-label":D,autoFocus:m,...T})}},12074:(te,R,a)=>{a.r(R),a.d(R,{default:()=>ys});var e=a(74848),c=a(22803),u=a(96540),j=a(85629),b=a(43173),x=a(60208),y=a(63142),P=a(54314),r=a(56840),D=a(15130),A=a(24313),m=a(13791),T=a(96673),C=a(71468),w=a(67458),X=a(34999),E=a(73427),S=a(77527),W=a(47931),p=a(45861),Y=a(61666);const O={revokeInvite:Y.eb},Z=(0,C.connect)(null,O);class re extends u.PureComponent{render(){const{invitee:n,revokeInvite:t}=this.props;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:n.email}),(0,e.jsx)("td",{children:n.name}),(0,e.jsxs)("td",{className:"text-right",children:[(0,e.jsx)(W.b,{icon:"copy",variant:"secondary",size:"sm",getText:()=>n.url,children:"Copy Invite"}),"\xA0"]}),(0,e.jsx)("td",{children:(0,e.jsx)(p.$n,{variant:"destructive",size:"sm",icon:"times",onClick:()=>t(n.code),"aria-label":(0,r.t)("invites.invitee-row.aria-label-revoke-invite","Revoke invite")})})]})}}const oe=Z(re);class H extends u.PureComponent{render(){const{invitees:n}=this.props;return(0,e.jsxs)("table",{className:"filter-table form-inline",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"invites.invitees-table.email",children:"Email"})}),(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"invites.invitees-table.name",children:"Name"})}),(0,e.jsx)("th",{}),(0,e.jsx)("th",{style:{width:"34px"}})]})}),(0,e.jsx)("tbody",{"data-testid":"InviteesTable-body",children:n.map((t,l)=>(0,e.jsx)(oe,{invitee:t},`${t.id}-${l}`))})]})}}var z=a(25508),V=a(38748);const{selectAll:J,selectById:Ce,selectTotal:he}=V.Tp,xe=(s,n)=>n,ve=(0,z.Mz)([J,xe],(s,n)=>{const t=new RegExp(n,"i");return s.filter(g=>t.test(g.name)||t.test(g.email))});var N=a(27489),U=a(18027),$=a(12737),K=a(77824),ee=a(65642),ie=a(2543),F=a(68143),se=a(81871),M=a(1302);function B(){return async(s,n)=>{try{s((0,M.Cj)());const{perPage:t,page:l,searchQuery:g,sort:h}=n().users,f=await(0,F.AI)().get("/api/org/users/search",(0,se.F)({perpage:t,page:l,query:g,sort:h}));if(E.TP.licensedAccessControlEnabled()&&E.TP.hasPermission(T.AccessControlAction.ActionUserRolesList)){s((0,M.dJ)());const d=E.TP.user.orgId,I=f?.orgUsers.map(v=>v.userId),o=await(0,F.AI)().post("/api/access-control/users/roles/search?includeMapped=true",{userIds:I,orgId:d});f.orgUsers.forEach(v=>{v.roles=o?o[v.userId]||[]:[]}),s((0,M.jE)())}s((0,M.Y_)(f))}catch{(0,M.g4)()}}}const ae=(0,ie.debounce)(s=>s(B()),300);function le(s){return async n=>{await(0,F.AI)().patch(`/api/org/users/${s.userId}`,{role:s.role}),n(B())}}function ue(s){return async n=>{await(0,F.AI)().delete(`/api/org/users/${s}`),n(B())}}function je(s){return async n=>{n((0,M.EC)(s)),n(B())}}function be({sortBy:s}){const n=s.length?`${s[0].id}-${s[0].desc?"desc":"asc"}`:void 0;return async t=>{t((0,M.$u)(n)),t(B())}}function i(s){return async n=>{n((0,M.t_)(s)),ae(n)}}const L=s=>{const n=new RegExp(s.searchQuery,"i");return s.users.filter(t=>n.test(t.login)||n.test(t.email)||n.test(t.name))},k=s=>s.searchQuery;var pe=a(79776);function q(s){return{searchQuery:k(s.users),pendingInvitesCount:he(s.invites),externalUserMngLinkName:s.users.externalUserMngLinkName,externalUserMngLinkUrl:s.users.externalUserMngLinkUrl}}const fe={changeSearchQuery:i},Qe=(0,C.connect)(q,fe)(({externalUserMngLinkName:s,externalUserMngLinkUrl:n,searchQuery:t,pendingInvitesCount:l,changeSearchQuery:g,onShowInvites:h,showInvites:f})=>{const d=[{label:"Users",value:"users"},{label:`Pending Invites (${l})`,value:"invites"}],o=E.TP.hasPermission(T.AccessControlAction.OrgUsersAdd)&&!(ee.Ay.disableLoginForm&&ee.Ay.externalUserMngInfo),v=()=>{(0,N.rR)("users_admin_actions_clicked",{category:"org_users",item:"manage_users_external"})};return(0,e.jsxs)("div",{className:"page-action-bar","data-testid":"users-action-bar",children:[(0,e.jsx)(U.I,{grow:!0,children:(0,e.jsx)($.Z,{value:t,onChange:g,placeholder:(0,r.t)("users.users-action-bar-unconnected.placeholder-search-login-email","Search user by login, email or name")})}),l>0&&(0,e.jsx)("div",{style:{marginLeft:"1rem"},children:(0,e.jsx)(K.z,{value:f?"invites":"users",options:d,onChange:h})}),o&&(0,e.jsx)(p.z9,{href:"org/users/invite",children:(0,e.jsx)(r.x6,{i18nKey:"users.users-action-bar-unconnected.invite",children:"Invite"})}),n&&(0,e.jsx)(p.z9,{onClick:v,href:(0,pe.o)("manage-users"),target:"_blank",rel:"noopener",children:s})]})});function Ge(s){const n=k(s.users);return{users:L(s.users),searchQuery:k(s.users),page:s.users.page,totalPages:s.users.totalPages,perPage:s.users.perPage,invitees:ve(s.invites,n),externalUserMngInfo:s.users.externalUserMngInfo,isLoading:s.users.isLoading,rolesLoading:s.users.rolesLoading}}const Ye={loadUsers:B,fetchInvitees:Y.G7,changePage:je,changeSort:be,updateUser:le,removeUser:ue},ye=(0,C.connect)(Ge,Ye)(({users:s,page:n,totalPages:t,invitees:l,externalUserMngInfo:g,isLoading:h,rolesLoading:f,loadUsers:d,fetchInvitees:I,changePage:o,updateUser:v,removeUser:ge,changeSort:ne})=>{const[G,Le]=(0,u.useState)(!1),Fe=g?(0,w.G)(g):"";(0,u.useEffect)(()=>{d(),I()},[I,d]);const As=(Te,Cs)=>{v({...Cs,role:Te})},Us=Te=>ge(Te.userId),Ds=()=>{Le(!G)},Ls=()=>{d()},Ts=()=>G?(0,e.jsx)(H,{invitees:l}):(0,e.jsx)(S.b,{users:s,orgId:E.TP.user.orgId,rolesLoading:f,onRoleChange:As,onRemoveUser:Us,onUserRolesChange:Ls,fetchData:ne,changePage:o,page:n,totalPages:t});return(0,e.jsxs)(m.Y.Contents,{isLoading:!h,children:[(0,e.jsx)(Qe,{onShowInvites:Ds,showInvites:G}),Fe&&(0,e.jsx)(X.F,{severity:"info",title:"",children:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:Fe}})}),h&&Ts()]})});function Os(){return jsx(Page,{navId:"users",children:jsx(ye,{})})}var Ze=a(50201),Ie=a(71555),we=a(89640),_=a(41654),ce=a(45967),me=a(30703),Re=a(66404),Pe=a(94018),Oe=a(27594),Me=a(34213),Xe=a(11297),Be=a(31286);const He=({units:s,icon:n})=>s?.length?s.length>1?(0,e.jsx)(ce.m,{placement:"top",content:(0,e.jsx)(_.B,{direction:"column",children:s?.map(t=>(0,e.jsx)("span",{children:t.name},t.name))}),children:(0,e.jsx)(Ae,{icon:n,children:s.length})}):(0,e.jsx)(Ae,{icon:n,children:s[0].name}):null,Ae=(0,u.forwardRef)(({children:s,icon:n},t)=>(0,e.jsxs)(Be.a,{ref:t,display:"flex",alignItems:"center",marginRight:1,children:[(0,e.jsx)(me.I,{name:n})," ",(0,e.jsx)(Be.a,{marginLeft:1,children:s})]}));Ae.displayName="TooltipContent";const Ve=({users:s,showPaging:n,totalPages:t,onChangePage:l,currentPage:g,fetchData:h})=>{const f=(0,u.useMemo)(()=>s.some(o=>o.licensedRole),[s]),d=(0,u.useMemo)(()=>s.some(o=>o.orgs),[s]),I=(0,u.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:o}})=>o&&(0,e.jsx)(Ie.e,{src:o,alt:"User avatar"})},{id:"login",header:"Login",cell:({row:{original:o}})=>(0,e.jsx)(we.Y,{color:"primary",inline:!1,href:`/admin/users/edit/${o.uid}`,title:(0,r.t)("admin.users-table.columns.title-edit-user","Edit user"),children:o.login}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:o}})=>o,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:o}})=>o,sortType:"string"},...d?[{id:"orgs",header:"Belongs to",cell:({cell:{value:o,row:v}})=>(0,e.jsxs)(_.B,{alignItems:"center",children:[(0,e.jsx)(He,{units:o,icon:"building"}),v.original.isAdmin&&(0,e.jsx)(ce.m,{placement:"top",content:"Grafana Admin",children:(0,e.jsx)(me.I,{name:"shield"})})]})}]:[],...f?[{id:"licensedRole",header:"Licensed role",cell:({cell:{value:o}})=>o==="None"?(0,e.jsxs)(Re.E,{color:"disabled",children:[(0,e.jsx)(r.x6,{i18nKey:"admin.users-table.no-licensed-roles",children:"Not assigned"}),(0,e.jsx)(ce.m,{placement:"top",content:"A licensed role will be assigned when this user signs in",children:(0,e.jsx)(me.I,{name:"question-circle",style:{margin:"0 0 4 4"}})})]}):o}]:[],{id:"lastSeenAtAge",header:"Last active",headerTooltip:{content:"Time since user was seen using Grafana",iconName:"question-circle"},cell:({cell:{value:o}})=>(0,e.jsx)(e.Fragment,{children:o&&(0,e.jsx)(e.Fragment,{children:o==="10 years"?(0,e.jsx)(Re.E,{color:"disabled",children:(0,e.jsx)(r.x6,{i18nKey:"admin.users-table.last-seen-never",children:"Never"})}):o})}),sortType:(o,v)=>new Date(o.original.lastSeenAt).getTime()-new Date(v.original.lastSeenAt).getTime()},{id:"authLabels",header:"Origin",cell:({cell:{value:o}})=>(0,e.jsx)(e.Fragment,{children:Array.isArray(o)&&o.length>0&&(0,e.jsx)(Xe.E,{label:o[0],removeIcon:!1,count:0})})},{id:"isProvisioned",header:"Provisioned",cell:({cell:{value:o}})=>(0,e.jsx)(e.Fragment,{children:o&&(0,e.jsx)(Pe.v,{colorIndex:14,name:"Provisioned"})})},{id:"isDisabled",header:"",cell:({cell:{value:o}})=>(0,e.jsx)(e.Fragment,{children:o&&(0,e.jsx)(Pe.v,{colorIndex:9,name:"Disabled"})})},{id:"edit",header:"",cell:({row:{original:o}})=>(0,e.jsx)(p.z9,{variant:"secondary",size:"sm",icon:"pen",href:`admin/users/edit/${o.uid}`,"aria-label":(0,r.t)("admin.users-table.edit-aria-label","Edit user: {{name}}",{name:o.name}),tooltip:(0,r.t)("admin.users-table.edit-tooltip","Edit user")})}],[f,d]);return(0,e.jsxs)(_.B,{direction:"column",gap:2,children:[(0,e.jsx)(Oe.j,{columns:I,data:s,getRowId:o=>String(o.id),fetchData:h}),n&&(0,e.jsx)(_.B,{justifyContent:"flex-end",children:(0,e.jsx)(Me.d,{numberOfPages:t,currentPage:g,onNavigate:l})})]})};var Q=a(74267);const Se=[],Ms=s=>{Se.push(s)},Je=j.Tp.pages.UserListPage.UserListAdminPage,ke={fetchUsers:Q.hU,changeQuery:Q.nM,changePage:Q.yd,changeFilter:Q.$u,changeSort:Q.Vk},qe=s=>({users:s.userListAdmin.users,query:s.userListAdmin.query,showPaging:s.userListAdmin.showPaging,totalPages:s.userListAdmin.totalPages,page:s.userListAdmin.page,filters:s.userListAdmin.filters,isLoading:s.userListAdmin.isLoading}),Ne=(0,C.connect)(qe,ke)(({fetchUsers:s,query:n,changeQuery:t,users:l,showPaging:g,changeFilter:h,filters:f,totalPages:d,page:I,changePage:o,changeSort:v,isLoading:ge})=>{const ne=(0,y.of)(_e);return(0,u.useEffect)(()=>{s()},[s]),(0,e.jsxs)(m.Y.Contents,{children:[(0,e.jsx)("div",{className:ne.actionBar,"data-testid":Je.container,children:(0,e.jsxs)("div",{className:ne.row,children:[(0,e.jsx)($.Z,{placeholder:(0,r.t)("admin.user-list-admin-page-un-connected.placeholder-search-login-email","Search user by login, email, or name."),autoFocus:!0,value:n,onChange:t,escapeRegex:!1}),(0,e.jsx)(K.z,{options:[{label:"All users",value:!1},{label:"Active last 30 days",value:!0}],onChange:G=>h({name:"activeLast30Days",value:G}),value:f.find(G=>G.name==="activeLast30Days")?.value,className:ne.filter}),Se.map((G,Le)=>(0,e.jsx)(G,{filters:f,onChange:h,className:ne.filter},Le)),E.TP.hasPermission(T.AccessControlAction.UsersCreate)&&(0,e.jsx)(p.z9,{href:"admin/users/create",variant:"primary",children:(0,e.jsx)(r.x6,{i18nKey:"admin.users-list.create-button",children:"New user"})})]})}),!ge&&l.length===0?(0,e.jsx)(Ze.p,{message:(0,r.t)("users.empty-state.message","No users found"),variant:"not-found"}):(0,e.jsx)(Ve,{users:l,showPaging:g,totalPages:d,onChangePage:o,currentPage:I,fetchData:v})]})});function Ns(){return jsx(Page,{navId:"global-users",children:jsx(Ne,{})})}const _e=s=>({filter:(0,c.css)({margin:s.spacing(0,1),[s.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,c.css)({marginBottom:s.spacing(2),display:"flex",alignItems:"flex-start",gap:s.spacing(2),[s.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,c.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:s.spacing(.5),flexGrow:1,[s.breakpoints.down("sm")]:{flexWrap:"wrap",gap:s.spacing(2),width:"100%"}})}),Ks=null;var es=a(99887),ss=a(58887);const as=s=>{if(!s.includes(" "))return{browser:s,computer:""};const n=s.split(" ");return{browser:n[0],computer:n[1]}},Ke=(s,n)=>s.length>n?s.substring(0,n)+"...":s,ns=({value:s})=>{const n=as(s);return(0,e.jsx)(ce.m,{theme:"info-alt",content:s,placement:"top-end",interactive:!0,children:(0,e.jsxs)("span",{children:[Ke(n.browser,10),Ke(n.computer,10)]})})},ts=({devices:s,showPaging:n,totalPages:t,onChangePage:l,currentPage:g,fetchData:h})=>{const f=(0,u.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:d}})=>d&&(0,e.jsx)(Ie.e,{src:d,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:d}})=>"Anonymous"},{id:"userAgent",header:"User Agent",cell:({cell:{value:d}})=>(0,e.jsx)(ns,{value:d}),sortType:"string"},{id:"updatedAt",header:"Last active",cell:({cell:{value:d}})=>d,sortType:(d,I)=>new Date(d.original.updatedAt).getTime()-new Date(I.original.updatedAt).getTime()},{id:"clientIp",header:"Origin IP (address)",cell:({cell:{value:d}})=>d&&(0,e.jsx)(es.E,{text:d,color:"orange"})}],[]);return(0,e.jsxs)(_.B,{direction:"column",gap:2,children:[(0,e.jsx)(Oe.j,{columns:f,data:s,getRowId:d=>d.deviceId,fetchData:h}),n&&(0,e.jsx)(_.B,{justifyContent:"flex-end",children:(0,e.jsx)(Me.d,{numberOfPages:t,currentPage:g,onNavigate:l})}),s.length===0&&(0,e.jsx)(ss.Z,{children:(0,e.jsx)("span",{children:(0,e.jsx)(r.x6,{i18nKey:"admin.anon-users.not-found",children:"No anonymous users found."})})})]})},rs={fetchUsersAnonymousDevices:Q.xq,changeAnonUserSort:Q.A5,changeAnonPage:Q.is,changeAnonQuery:Q.Bc},os=s=>({devices:s.userListAnonymousDevices.devices,query:s.userListAnonymousDevices.query,showPaging:s.userListAnonymousDevices.showPaging,totalPages:s.userListAnonymousDevices.totalPages,page:s.userListAnonymousDevices.page,filters:s.userListAnonymousDevices.filters}),is=j.Tp.pages.UserListPage.UserListAdminPage,We=(0,C.connect)(os,rs)(({devices:s,fetchUsersAnonymousDevices:n,query:t,changeAnonQuery:l,filters:g,showPaging:h,totalPages:f,page:d,changeAnonPage:I,changeAnonUserSort:o})=>{const v=(0,y.of)(ls);return(0,u.useEffect)(()=>{n()},[n]),(0,e.jsxs)(m.Y.Contents,{children:[(0,e.jsx)("div",{className:v.actionBar,"data-testid":is.container,children:(0,e.jsxs)("div",{className:v.row,children:[(0,e.jsx)($.Z,{placeholder:(0,r.t)("admin.user-list-anonymous-devices-page-un-connected.placeholder-search-devices-by-ip-address","Search devices by IP address."),autoFocus:!0,value:t,onChange:l}),(0,e.jsx)(K.z,{options:[{label:"Active last 30 days",value:!0}],value:g.find(ge=>ge.name==="activeLast30Days")?.value,className:v.filter})]})}),(0,e.jsx)(ts,{devices:s,showPaging:h,totalPages:f,onChangePage:I,currentPage:d,fetchData:o})]})});function $s(){return jsx(Page,{navId:"anonymous-users",children:jsx(We,{})})}const ls=s=>({filter:(0,c.css)({margin:s.spacing(0,1),[s.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,c.css)({marginBottom:s.spacing(2),display:"flex",alignItems:"flex-start",gap:s.spacing(2),[s.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,c.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:s.spacing(.5),flexGrow:1,[s.breakpoints.down("sm")]:{flexWrap:"wrap",gap:s.spacing(2),width:"100%"}})}),Fs=null;var Ue=a(62905),De=a(22787),cs=a(6975),ze=a(8515);const ds=j.Tp.pages.UserListPage.UsersListPublicDashboardsPage.DashboardsListModal,gs=({email:s,onDismiss:n})=>{const t=(0,y.of)(us),{data:l,isLoading:g}=(0,Ue.kd)(s);return(0,e.jsx)(De.a,{className:t.modal,isOpen:!0,title:b.$.featureToggles.newDashboardSharingComponent?(0,r.t)("public-dashboard-users-access-list.modal.shared-dashboard-modal-title","Shared dashboards"):(0,r.t)("public-dashboard-users-access-list.modal.dashboard-modal-title","Public dashboards"),onDismiss:n,children:g?(0,e.jsx)("div",{className:t.loading,children:(0,e.jsx)(cs._,{text:(0,r.t)("public-dashboard-users-access-list.dashboard-modal.loading-text","Loading...")})}):l?.map(h=>(0,e.jsxs)("div",{className:t.listItem,"data-testid":ds.listItem(h.dashboardUid),children:[(0,e.jsx)("p",{className:t.dashboardTitle,children:h.dashboardTitle}),(0,e.jsxs)("div",{className:t.urlsContainer,children:[(0,e.jsx)("a",{rel:"noreferrer",target:"_blank",className:(0,c.cx)("external-link",t.url),href:(0,A.mL)(h.publicDashboardAccessToken),onClick:n,children:b.$.featureToggles.newDashboardSharingComponent?(0,e.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.external-link",children:"External link"}):(0,e.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-link",children:"Public dashboard URL"})}),(0,e.jsx)("span",{className:t.urlsDivider,children:"\u2022"}),(0,e.jsx)("a",{className:(0,c.cx)("external-link",t.url),href:(0,A.gN)(h.dashboardUid,h.slug),onClick:n,children:b.$.featureToggles.newDashboardSharingComponent?(0,e.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.sharing-setting",children:"Sharing settings"}):(0,e.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-setting",children:"Public dashboard settings"})})]}),(0,e.jsx)("hr",{className:t.divider})]},h.dashboardUid))})},hs=({email:s})=>{const n=(0,r.t)("public-dashboard-users-access-list.dashboard-modal.open-dashboard-list-text","Open dashboards list");return(0,e.jsx)(ze.$s,{children:({showModal:t,hideModal:l})=>(0,e.jsx)(p.$n,{variant:"secondary",size:"sm",icon:"question-circle",title:n,"aria-label":n,onClick:()=>t(gs,{email:s,onDismiss:l})})})},us=s=>({modal:(0,c.css)({width:"590px"}),loading:(0,c.css)({display:"flex",justifyContent:"center"}),listItem:(0,c.css)({display:"flex",flexDirection:"column",gap:s.spacing(.5)}),divider:(0,c.css)({margin:s.spacing(1.5,0),color:s.colors.text.secondary}),urlsContainer:(0,c.css)({display:"flex",gap:s.spacing(.5),[s.breakpoints.down("sm")]:{flexDirection:"column"}}),urlsDivider:(0,c.css)({color:s.colors.text.secondary,[s.breakpoints.down("sm")]:{display:"none"}}),dashboardTitle:(0,c.css)({fontSize:s.typography.body.fontSize,fontWeight:s.typography.fontWeightBold,marginBottom:0}),url:(0,c.css)({fontSize:s.typography.body.fontSize})}),ms=({user:s,hideModal:n})=>{const[t]=(0,Ue.g9)(),l=(0,y.of)(vs),g=()=>{t({email:s.email}),n()};return(0,e.jsxs)(De.a,{className:l.modal,isOpen:!0,title:(0,r.t)("public-dashboard-users-access-list.delete-user-modal.revoke-access-title","Revoke access"),onDismiss:n,children:[(0,e.jsx)("p",{className:l.description,children:(0,e.jsxs)(r.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line1",children:["Are you sure you want to revoke access for ",{email:s.email},"?"]})}),(0,e.jsx)("p",{className:l.description,children:b.$.featureToggles.newDashboardSharingComponent?(0,e.jsxs)(r.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-shared-dashboards-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:s.email},"'s access to all shared dashboards."]}):(0,e.jsxs)(r.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:s.email},"'s access to all public dashboards."]})}),(0,e.jsxs)(De.a.ButtonRow,{children:[(0,e.jsx)(p.$n,{type:"button",variant:"secondary",onClick:n,fill:"outline",children:(0,e.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-cancel-button",children:"Cancel"})}),(0,e.jsx)(p.$n,{type:"button",variant:"destructive",onClick:g,children:(0,e.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-revoke-access-button",children:"Revoke access"})})]})]})},xs=({user:s})=>{const n=(0,r.t)("public-dashboard-users-access-list.delete-user-modal.delete-user-button-text","Delete user");return(0,e.jsx)(ze.$s,{children:({showModal:t,hideModal:l})=>(0,e.jsx)(p.$n,{size:"sm",variant:"destructive",onClick:()=>t(ms,{user:s,hideModal:l}),icon:"times","aria-label":n,title:n})})},vs=s=>({modal:(0,c.css)({width:"500px"}),description:(0,c.css)({fontSize:s.typography.body.fontSize,margin:0})}),js=j.Tp.pages.UserListPage.publicDashboards,bs=()=>{const{data:s,isLoading:n}=(0,Ue.AK)();return(0,e.jsx)(m.Y.Contents,{isLoading:n,children:(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":js.container,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.table-header.email-label",children:"Email"})}),(0,e.jsxs)("th",{children:[(0,e.jsx)("span",{children:(0,e.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.table-header.activated-label",children:"Activated"})}),(0,e.jsx)(ce.m,{placement:"top",content:(0,r.t)("public-dashboard-users-access-list.table-header.activated-tooltip","Earliest time user has been an active user to a dashboard"),children:(0,e.jsx)(me.I,{name:"info-circle"})})]}),(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.table-header.last-active-label",children:"Last active"})}),(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.table-header.origin-label",children:"Origin"})}),(0,e.jsx)("th",{children:(0,e.jsx)(r.x6,{i18nKey:"public-dashboard-users-access-list.table-header.role-label",children:"Role"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:s?.map(t=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsx)("span",{className:"ellipsis",title:t.email,children:t.email})}),(0,e.jsx)("td",{className:"max-width-10",children:t.firstSeenAtAge}),(0,e.jsx)("td",{className:"max-width-10",children:t.lastSeenAtAge}),(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsxs)(_.B,{gap:2,children:[(0,e.jsx)("span",{children:(0,e.jsxs)(r.x6,{i18nKey:"public-dashboard-users-access-list.table-body.dashboard-count",count:t.totalDashboards,children:[{count:t.totalDashboards}," dashboards"]})}),(0,e.jsx)(hs,{email:t.email})]})}),(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsx)(Pe.v,{name:"Viewer",colorIndex:19})}),(0,e.jsx)("td",{className:"text-right",children:(0,e.jsx)(xs,{user:t})})]},t.email))})]})})};var ps=(s=>(s.ADMIN="admin",s.ORG="org",s.PUBLIC_DASHBOARDS="public-dashboards",s.ANON="anon",s))(ps||{});const de=j.Tp.pages.UserListPage,$e=({view:s,setView:n})=>(0,e.jsx)(x.o,{label:b.$.featureToggles.newDashboardSharingComponent?(0,r.t)("users-access-list.tabs.shared-dashboard-users-tab-title","Shared dashboard users"):(0,r.t)("users-access-list.tabs.public-dashboard-users-tab-title","Public dashboard users"),active:s==="public-dashboards",onChangeTab:()=>n("public-dashboards"),"data-testid":de.tabs.publicDashboardsUsers}),fs={admin:(0,e.jsx)(Ne,{}),org:(0,e.jsx)(ye,{}),"public-dashboards":(0,e.jsx)(bs,{}),anon:(0,e.jsx)(We,{})};function ys(){const s=(0,y.of)(Ps),n=D.TP.hasPermission(T.AccessControlAction.UsersRead),t=D.TP.hasPermission(T.AccessControlAction.OrgUsersRead),[l,g]=(0,u.useState)(()=>n?"admin":t?"org":null),h=t&&n;return(0,e.jsxs)(m.Y,{navId:"global-users",children:[h?(0,e.jsxs)(P.U,{className:s.tabsMargin,children:[(0,e.jsx)(x.o,{label:(0,r.t)("admin.user-list-page.label-all-users","All users"),active:l==="admin",onChangeTab:()=>g("admin"),"data-testid":de.tabs.allUsers}),(0,e.jsx)(x.o,{label:(0,r.t)("admin.user-list-page.label-organization-users","Organization users"),active:l==="org",onChangeTab:()=>g("org"),"data-testid":de.tabs.orgUsers}),b.$.anonymousEnabled&&(0,e.jsx)(x.o,{label:(0,r.t)("admin.user-list-page.label-anonymous-devices","Anonymous devices"),active:l==="anon",onChangeTab:()=>g("anon"),"data-testid":de.tabs.anonUserDevices}),(0,A.AY)()&&(0,e.jsx)($e,{view:l,setView:g})]}):(0,A.AY)()&&(0,e.jsxs)(P.U,{className:s.tabsMargin,children:[(0,e.jsx)(x.o,{label:(0,r.t)("admin.user-list-page.label-users","Users"),active:l==="org",onChangeTab:()=>g("org"),"data-testid":de.tabs.users}),(0,e.jsx)($e,{view:l,setView:g})]}),l?fs[l]:(0,e.jsx)(ye,{})]})}const Ps=s=>({tabsMargin:(0,c.css)({marginBottom:s.spacing(3)})})},77527:(te,R,a)=>{a.d(R,{b:()=>ve});var e=a(74848),c=a(96540),u=a(85629),j=a(43173),b=a(71555),x=a(66404),y=a(31286),P=a(45967),r=a(30703),D=a(94018),A=a(45861),m=a(41654),T=a(27594),C=a(34213),w=a(71599),X=a(91087),E=a(12037),S=a(22803),W=a(49785),p=a(63142),Y=a(99887),O=a(56840),Z=a(31908);const re=({disabled:N,user:U})=>{const[$,K]=(0,c.useState)(!1),{badge:ee,badgeDisabled:ie}=(0,p.of)(oe),F=N?ie:ee,se=(0,W.mN)({defaultValues:{name:U.name,role:U.role,roles:U.roles}}),{watch:M}=se,B=()=>{N||K(!0)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(m.B,{gap:1,children:[(0,e.jsx)(Y.E,{className:F,color:"blue",onClick:B,text:M("role")}),U.roles&&U.roles.length>0&&(0,e.jsx)(Y.E,{className:F,color:"blue",onClick:B,text:(0,O.t)("role-picker-drawer.user-count","+{{numUsers}}",{numUsers:U.roles.length})})]}),$&&(0,e.jsx)(W.Op,{...se,children:(0,e.jsx)(Z.I,{onClose:()=>K(!1)})})]})};function oe(N){return{badge:(0,S.css)({cursor:"pointer"}),badgeDisabled:(0,S.css)({cursor:"not-allowed"})}}var H=a(11297),z=a(73427),V=a(96673),J=a(9390);const Ce=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,he=N=>{const U=N?.isExternallySynced;return!z.TP.hasPermissionInMetadata(V.AccessControlAction.OrgUsersWrite,N)||U},xe=u.Tp.pages.UserListPage.UsersListPage,ve=({users:N,orgId:U,onRoleChange:$,onUserRolesChange:K,onRemoveUser:ee,fetchData:ie,changePage:F,page:se,totalPages:M,rolesLoading:B})=>{const[ae,le]=(0,c.useState)(null),[ue,je]=(0,c.useState)([]);(0,c.useEffect)(()=>{async function i(){try{if(z.TP.hasPermission(V.AccessControlAction.ActionRolesList)){let L=await(0,E.RL)(U);je(L)}}catch{console.error("Error loading options")}}z.TP.licensedAccessControlEnabled()&&i()},[U]);const be=(0,c.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:i}})=>i&&(0,e.jsx)(b.e,{src:i,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:i}})=>(0,e.jsx)("div",{children:i}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:i}})=>i,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:i}})=>i,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:i}})=>(0,e.jsx)(e.Fragment,{children:i&&(0,e.jsx)(e.Fragment,{children:i==="10 years"?(0,e.jsx)(x.E,{color:"disabled",children:(0,e.jsx)(O.x6,{i18nKey:"admin.org-uers.last-seen-never",children:"Never"})}):i})}),sortType:(i,L)=>new Date(i.original.lastSeenAt).getTime()-new Date(L.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:i},row:{original:L}})=>{const k=he(L),pe=async(q,fe,Ee)=>{await(0,E.eA)(q,fe,Ee),K&&K()};return j.$.featureToggles.rolePickerDrawer?(0,e.jsx)(re,{disabled:k,user:L}):z.TP.licensedAccessControlEnabled()?(0,e.jsx)(X.y,{userId:L.userId,roles:L.roles,apply:!0,onApplyRoles:pe,isLoading:B,orgId:U,roleOptions:ue,basicRole:i,onBasicRoleChange:q=>$(q,L),basicRoleDisabled:k,basicRoleDisabledMessage:Ce,width:40}):(0,e.jsx)(J.r,{"aria-label":(0,O.t)("admin.org-users-table.columns.aria-label-role","Role"),value:i,disabled:k,onChange:q=>$(q,L)})}},{id:"info",header:"",cell:({row:{original:i}})=>he(i)&&(0,e.jsx)(y.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,e.jsx)(P.m,{interactive:!0,content:(0,e.jsx)("div",{children:(0,e.jsxs)(O.x6,{i18nKey:"admin.org-users.not-editable",children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]})}),children:(0,e.jsx)(r.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:i}})=>(0,e.jsx)(e.Fragment,{children:Array.isArray(i)&&i.length>0&&(0,e.jsx)(H.E,{label:i[0],removeIcon:!1,count:0})})},{id:"isProvisioned",header:"Provisioned",cell:({cell:{value:i}})=>(0,e.jsx)(e.Fragment,{children:i&&(0,e.jsx)(D.v,{colorIndex:14,name:"Provisioned"})})},{id:"isDisabled",header:"",cell:({cell:{value:i}})=>(0,e.jsx)(e.Fragment,{children:i&&(0,e.jsx)(D.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:i}})=>z.TP.hasPermissionInMetadata(V.AccessControlAction.OrgUsersRemove,i)&&(0,e.jsx)(A.$n,{size:"sm",variant:"destructive",onClick:()=>{le(i)},icon:"times","aria-label":(0,O.t)("admin.org-users-table.delete-aria-label","Delete user: {{name}}",{name:i.name})})}],[B,U,ue,K,$]);return(0,e.jsxs)(m.B,{direction:"column",gap:2,"data-testid":xe.container,children:[(0,e.jsx)(T.j,{columns:be,data:N,getRowId:i=>String(i.userId),fetchData:ie}),(0,e.jsx)(m.B,{justifyContent:"flex-end",children:(0,e.jsx)(C.d,{onNavigate:F,currentPage:se,numberOfPages:M,hideWhenSinglePage:!0})}),!!ae&&(0,e.jsx)(w.u,{body:`Are you sure you want to delete user ${ae?.login}?`,confirmText:"Delete",title:(0,O.t)("admin.org-users-table.title-delete","Delete"),onDismiss:()=>{le(null)},isOpen:!0,onConfirm:()=>{ae&&(ee(ae),le(null))}})]})}},58887:(te,R,a)=>{a.d(R,{Z:()=>j});var e=a(74848),c=a(22803),u=a(63142);const j=({children:x})=>{const y=(0,u.of)(b);return(0,e.jsx)("div",{className:y.container,children:x})},b=x=>({container:(0,c.css)({backgroundColor:x.colors.background.secondary,color:x.colors.text.secondary,padding:x.spacing(4),textAlign:"center"})})}}]);

//# sourceMappingURL=UserListPage.deb223dbef58a12242b5.js.map