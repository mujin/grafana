"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8758],{83813:(D,p,n)=>{n.d(p,{F:()=>t});var e=n(74848),l=n(22803),c=n(96540),o=n(54148),r=n(22787),s=n(45861),d=n(56840),i=n(83560);const t=({confirmRedirect:a,onDiscard:y,onLocationChange:g})=>{const[I,E]=(0,c.useState)(!1),[M,L]=(0,c.useState)(null),[T,k]=(0,c.useState)(!1);(0,c.useEffect)(()=>{const j=P=>{a&&(P.preventDefault(),P.returnValue="")};return window.addEventListener("beforeunload",j),()=>{window.removeEventListener("beforeunload",j)}},[a]);const A=j=>{const P=window.location.pathname,B=j.pathname;if(P===B)return!0;const O=g?.(j);let R=a&&!T;return O!==void 0&&(R=R&&O),R?(E(!0),L(j),!1):(O&&y(),!0)},K=()=>{E(!1),L(null)},S=()=>{E(!1),k(!0),y()};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.X,{when:!0,message:A}),M&&T&&(0,e.jsx)(o.C5,{replace:!0,to:M}),(0,e.jsx)(b,{isOpen:I,onDiscard:S,onBackToForm:K})]})},b=({onDiscard:a,onBackToForm:y,isOpen:g})=>(0,e.jsxs)(r.a,{isOpen:g,title:(0,d.t)("form-prompt.title","Leave page?"),onDismiss:y,icon:"exclamation-triangle",className:(0,l.css)({width:"500px"}),children:[(0,e.jsx)("h5",{children:(0,e.jsx)(d.x6,{i18nKey:"form-prompt.description",children:"Changes that you made may not be saved."})}),(0,e.jsxs)(r.a.ButtonRow,{children:[(0,e.jsx)(s.$n,{variant:"secondary",onClick:y,fill:"outline",children:(0,e.jsx)(d.x6,{i18nKey:"form-prompt.continue-button",children:"Continue editing"})}),(0,e.jsx)(s.$n,{variant:"destructive",onClick:a,children:(0,e.jsx)(d.x6,{i18nKey:"form-prompt.discard-button",children:"Discard unsaved changes"})})]})]})},83560:(D,p,n)=>{n.d(p,{X:()=>c});var e=n(96540),l=n(36490);const c=({message:o,when:r=!0})=>{const s=l.Ny.getHistory();return(0,e.useEffect)(()=>{if(!r)return;const d=s.block(o);return()=>{d()}},[r,o,s]),null}},47987:(D,p,n)=>{n.d(p,{w:()=>l});var e=n(79162);function l(c){return c?(0,e.B)(c):{type:"github",title:"Repository",token:"",url:"",branch:"main",generateDashboardPreviews:!1,readOnly:!1,prWorkflow:!0,path:"grafana/",sync:{enabled:!1,target:"instance",intervalSeconds:60}}}},33580:(D,p,n)=>{n.r(p),n.d(p,{default:()=>J});var e=n(74848),l=n(54148),c=n(50201),o=n(66404),r=n(89640),s=n(19164),d=n(13791),i=n(56840),t=n(96540),b=n(49785),a=n(37386),y=n(43243),g=n(63527),I=n(48767),E=n(32635),M=n(89599),L=n(21285),T=n(77824),k=n(41654),A=n(45861),K=n(83813),S=n(48485),j=n(67170),P=n(79162),B=n(53247),O=n(91555);function R({register:u}){const f=(0,B.ED)(),C=(0,B.hF)();return(0,e.jsxs)(M.a,{label:(0,i.t)("provisioning.config-form-github-collapse.label-git-hub-features","GitHub features"),isOpen:!0,children:[(0,e.jsx)(a.D,{children:(0,e.jsx)(E.S,{disabled:!C||!f,label:(0,i.t)("provisioning.finish-step.label-enable-previews","Enable dashboard previews in pull requests"),description:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.x6,{i18nKey:"provisioning.finish-step.description-enable-previews",children:"Adds an image preview of dashboard changes in pull requests. Images of your Grafana dashboards will be shared in your Git repository and visible to anyone with repository access."})," ",(0,e.jsx)(o.E,{italic:!0,children:(0,e.jsxs)(i.x6,{i18nKey:"provisioning.finish-step.description-image-rendering",children:["Requires image rendering."," ",(0,e.jsx)(r.Y,{variant:"bodySmall",external:!0,href:"https://grafana.com/grafana/plugins/grafana-image-renderer",children:"Set up image rendering"})]})})]}),...u("generateDashboardPreviews")})}),!f&&(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form-github-collapse.label-realtime-feedback","Realtime feedback"),children:(0,e.jsx)(o.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsxs)(i.x6,{i18nKey:"provisioning.config-form-github-collapse.description-realtime-feedback",children:[(0,e.jsx)(r.Y,{variant:"bodySmall",href:O.zM,children:"Configure webhooks"})," ","to get instant updates in Grafana as soon as changes are committed. Review and approve changes using pull requests before they go live."]})})})]})}var V=n(47987);const X=()=>{const u=[{value:"github",label:(0,i.t)("provisioning.config-form.option-github","GitHub")},{value:"local",label:(0,i.t)("provisioning.config-form.option-local","Local")}],f=[{value:"instance",label:(0,i.t)("provisioning.config-form.option-entire-instance","Entire instance")},{value:"folder",label:(0,i.t)("provisioning.config-form.option-managed-folder","Managed folder")}];return[u,f]};function Z({data:u}){const[f,C]=(0,j.A)(u?.metadata?.name),{register:h,handleSubmit:Q,reset:U,control:w,formState:{errors:m,isDirty:q},setValue:G,watch:_,getValues:N}=(0,b.mN)({defaultValues:(0,V.w)(u?.spec)}),z=!!u?.metadata?.name,[ee,ne]=(0,t.useState)(z),H=(0,l.Zp)(),[W,ie]=_(["type","readOnly"]),[oe,re]=(0,t.useMemo)(()=>X(),[]),[Y,$]=(0,t.useState)(!1);(0,t.useEffect)(()=>{if(C.isSuccess){const x=N();U(x),setTimeout(()=>{H("/admin/provisioning")},300)}},[C.isSuccess,U,N,H]);const te=async x=>{$(!0);const v=(0,P.t)(x);v.github&&(v.github.token=x.token||u?.spec?.github?.token,v.github.encryptedToken=u?.spec?.github?.encryptedToken),await f(v),$(!1)};return(0,e.jsxs)("form",{onSubmit:Q(te),style:{maxWidth:700},children:[(0,e.jsx)(K.F,{onDiscard:U,confirmRedirect:q}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-repository-type","Repository type"),children:(0,e.jsx)(b.xI,{name:"type",control:w,render:({field:{ref:x,onChange:v,...F}})=>(0,e.jsx)(y.G,{options:oe,onChange:se=>v(se?.value),placeholder:(0,i.t)("provisioning.config-form.placeholder-select-repository-type","Select repository type"),disabled:!!u?.spec,...F})})}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-title","Title"),description:(0,i.t)("provisioning.config-form.description-title","A human-readable name for the config"),invalid:!!m.title,error:m?.title?.message,children:(0,e.jsx)(g.p,{...h("title",{required:(0,i.t)("provisioning.config-form.error-required","This field is required.")}),placeholder:(0,i.t)("provisioning.config-form.placeholder-my-config","My config")})}),W==="github"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-github-token","GitHub token"),required:!0,error:m?.token?.message,invalid:!!m.token,children:(0,e.jsx)(b.xI,{name:"token",control:w,rules:{required:z?!1:(0,i.t)("provisioning.config-form.error-required","This field is required.")},render:({field:{ref:x,...v}})=>(0,e.jsx)(I.L4,{...v,id:"token",placeholder:(0,i.t)("provisioning.config-form.placeholder-github-token","ghp_yourTokenHere1234567890abcdEFGHijklMNOP"),isConfigured:ee,onReset:()=>{G("token",""),ne(!1)}})})}),(0,e.jsx)(S.c,{}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-repository-url","Repository URL"),error:m?.url?.message,invalid:!!m?.url,description:(0,i.t)("provisioning.config-form.description-repository-url","Enter the GitHub repository URL"),required:!0,children:(0,e.jsx)(g.p,{...h("url",{required:(0,i.t)("provisioning.config-form.error-required","This field is required."),pattern:{value:/^(?:https:\/\/github\.com\/)?[^/]+\/[^/]+$/,message:(0,i.t)("provisioning.config-form.error-valid-github-url","Please enter a valid GitHub repository URL")}}),placeholder:(0,i.t)("provisioning.config-form.placeholder-github-url","https://github.com/username/repo-name")})}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-branch","Branch"),children:(0,e.jsx)(g.p,{...h("branch"),placeholder:(0,i.t)("provisioning.config-form.placeholder-branch","main")})}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-path","Path"),description:(0,i.t)("provisioning.config-form.description-path","Path to a subdirectory in the Git repository"),children:(0,e.jsx)(g.p,{...h("path")})})]}),W==="local"&&(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-local-path","Local path"),error:m?.path?.message,invalid:!!m?.path,children:(0,e.jsx)(g.p,{...h("path",{required:(0,i.t)("provisioning.config-form.error-required","This field is required.")}),placeholder:(0,i.t)("provisioning.config-form.placeholder-local-path","/path/to/repo")})}),(0,e.jsx)(a.D,{children:(0,e.jsx)(E.S,{...h("readOnly",{onChange:x=>{x.target.checked&&G("prWorkflow",!1)}}),label:(0,i.t)("provisioning.finish-step.label-read-only","Read only"),description:(0,i.t)("provisioning.config-form.description-read-only","Resources can't be modified through Grafana.")})}),(0,e.jsx)(a.D,{children:(0,e.jsx)(E.S,{disabled:ie,...h("prWorkflow"),label:(0,i.t)("provisioning.config-form.label-pr-workflow","Enable pull request option when saving"),description:(0,e.jsx)(i.x6,{i18nKey:"provisioning.finish-step.description-webhooks-enable",children:"Allows users to choose whether to open a pull request when saving changes. If the repository does not allow direct changes to the main branch, a pull request may still be required."})})}),W==="github"&&(0,e.jsx)(R,{register:h}),(0,e.jsxs)(M.a,{label:(0,i.t)("provisioning.config-form.label-automatic-pulling","Automatic pulling"),isOpen:!1,children:[(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-enabled","Enabled"),description:(0,i.t)("provisioning.config-form.description-enabled","Once automatic pulling is enabled, the target cannot be changed."),children:(0,e.jsx)(L.d,{...h("sync.enabled"),id:"sync.enabled"})}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-target","Target"),required:!0,error:m?.sync?.target?.message,invalid:!!m?.sync?.target,children:(0,e.jsx)(b.xI,{name:"sync.target",control:w,rules:{required:(0,i.t)("provisioning.config-form.error-required","This field is required.")},render:({field:{ref:x,onChange:v,...F}})=>(0,e.jsx)(T.z,{options:re,onChange:v,disabled:!!u?.status?.sync.state,...F})})}),(0,e.jsx)(a.D,{label:(0,i.t)("provisioning.config-form.label-interval-seconds","Interval (seconds)"),children:(0,e.jsx)(g.p,{...h("sync.intervalSeconds",{valueAsNumber:!0}),type:"number",placeholder:(0,i.t)("provisioning.config-form.placeholder-interval-seconds","60")})})]}),(0,e.jsx)(k.B,{gap:2,children:(0,e.jsx)(A.$n,{type:"submit",disabled:Y,children:Y?(0,i.t)("provisioning.config-form.button-saving","Saving..."):(0,i.t)("provisioning.config-form.button-save","Save")})})]})}function J(){const{name:u=""}=(0,l.g)(),f=(0,s.Sw)({name:u}),C=f.isError&&f.error?.status===404;return(0,e.jsx)(d.Y,{navId:"provisioning",pageNav:{text:"Configure repository",subTitle:"Configure a repository for storing your resources."},children:(0,e.jsx)(d.Y.Contents,{isLoading:f.isLoading,children:C?(0,e.jsxs)(c.p,{message:"Repository config not found",variant:"not-found",children:[(0,e.jsx)(o.E,{element:"p",children:(0,e.jsx)(i.x6,{i18nKey:"provisioning.edit-repository-page.repository-config-exists-configuration",children:"Make sure the repository config exists in the configuration file."})}),(0,e.jsx)(r.Y,{href:O.mL,children:(0,e.jsx)(i.x6,{i18nKey:"provisioning.edit-repository-page.back-to-repositories",children:"Back to repositories"})})]}):(0,e.jsx)(Z,{data:f.data})})})}},48485:(D,p,n)=>{n.d(p,{c:()=>d});var e=n(74848),l=n(22803),c=n(63142),o=n(41654),r=n(89640),s=n(56840);function d(){const t=(0,c.of)(i);return(0,e.jsxs)("div",{className:t.container,children:[(0,e.jsxs)(o.B,{gap:.5,wrap:"wrap",children:[(0,e.jsx)(s.x6,{i18nKey:"provisioning.token-permissions-info.go-to",children:"Go to"}),(0,e.jsx)(r.Y,{external:!0,href:"https://github.com/settings/personal-access-tokens/new",children:"GitHub Personal Access Tokens"}),(0,e.jsx)(s.x6,{i18nKey:"provisioning.token-permissions-info.and-click",children:"and click"}),(0,e.jsx)("strong",{children:'"Fine-grained token".'}),(0,e.jsx)(s.x6,{i18nKey:"provisioning.token-permissions-info.make-sure",children:"Make sure to include these permissions"}),":"]}),(0,e.jsxs)("ul",{className:t.permissionsList,children:[(0,e.jsxs)("li",{children:["Content: ",(0,e.jsx)("span",{className:t.accessLevel,children:"Read and write"})]}),(0,e.jsxs)("li",{children:["Metadata: ",(0,e.jsx)("span",{className:t.accessLevel,children:"Read only"})]}),(0,e.jsxs)("li",{children:["Pull requests: ",(0,e.jsx)("span",{className:t.accessLevel,children:"Read and write"})]}),(0,e.jsxs)("li",{children:["Webhooks: ",(0,e.jsx)("span",{className:t.accessLevel,children:"Read and write"})]})]})]})}function i(t){return{container:(0,l.css)({marginBottom:t.spacing(1),position:"relative",width:"100%",display:"flex",flexDirection:"column",flex:"1 1 0",padding:t.spacing(t.components.panel.padding)}),permissionsList:(0,l.css)({marginTop:t.spacing(2),marginBottom:t.spacing(1),paddingLeft:t.spacing(3),li:(0,l.css)({marginBottom:t.spacing(1)})}),accessLevel:(0,l.css)({fontFamily:t.typography.fontFamilyMonospace,background:"#22262B",borderRadius:t.shape.radius.default,padding:t.spacing(.25,.5)})}}},67170:(D,p,n)=>{n.d(p,{A:()=>c});var e=n(96540),l=n(19164);function c(r){const[s,d]=(0,l.ZL)(),[i,t]=(0,l.hD)(),[b,a]=(0,l.L)();return[(0,e.useCallback)(async g=>(await b({name:r||"new",body:{spec:g}}).unwrap(),r?i({name:r,repository:{metadata:{name:r,finalizers:["cleanup","remove-orphan-resources"]},spec:g}}):s({repository:{metadata:o(g),spec:g}})),[s,r,i,b]),r?t:d,a]}const o=r=>{const s=r.title.toLowerCase().replaceAll(/[^a-z0-9\-_]+/g,"");if(crypto.randomUUID&&s&&s.charAt(0)>="a"&&s.charAt(0)<="z"&&s.replaceAll(/[^a-z]/g,"").length>=3){const d=crypto.randomUUID().substring(0,7);return{name:`${s.substring(0,62-d.length)}-${d}`}}else return{generateName:"r"}}},79162:(D,p,n)=>{n.d(p,{B:()=>c,t:()=>l});const e=o=>{if(o.readOnly)return[];const r=["write"];return o.prWorkflow?[...r,"branch"]:r},l=o=>{const r={type:o.type,sync:o.sync,title:o.title||"",workflows:e(o)};switch(o.type){case"github":r.github={generateDashboardPreviews:o.generateDashboardPreviews,url:o.url||"",branch:o.branch,token:o.token,path:o.path};break;case"local":r.local={path:o.path},r.workflows=r.workflows.filter(s=>s!=="branch");break}return structuredClone(r)},c=o=>structuredClone({...o,...o.github,...o.local,branch:o.github?.branch||"",url:o.github?.url||"",generateDashboardPreviews:o.github?.generateDashboardPreviews||!1,readOnly:!o.workflows.length,prWorkflow:o.workflows.includes("write")})}}]);

//# sourceMappingURL=EditRepositoryPage.c319e59fb84fe9e910d8.js.map