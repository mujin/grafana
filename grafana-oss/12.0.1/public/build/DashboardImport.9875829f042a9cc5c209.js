"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2550],{74410:(ia,R,e)=>{e.d(R,{l:()=>V});var a=e(74848),E=e(22803),g=e(96540),J=e(49785);function V({defaultValues:C,onSubmit:I,validateOnMount:S=!1,validateFieldsOnMount:$,children:K,validateOn:A="onSubmit",maxWidth:f=600,...W}){const{handleSubmit:N,trigger:x,formState:G,...U}=(0,J.mN)({mode:A,defaultValues:C});return(0,g.useEffect)(()=>{S&&x($)},[x,$,S]),(0,a.jsx)("form",{className:(0,E.css)({maxWidth:f!=="none"?f+"px":f,width:"100%"}),onSubmit:N(I),...W,children:K({errors:G.errors,formState:G,trigger:x,...U})})}},79615:(ia,R,e)=>{e.r(R),e.d(R,{default:()=>Ka});var a=e(74848),E=e(22803),g=e(96540),J=e(71468),V=e(32899),C=e(28105),I=e(85629),S=e(27489),$=e(43173),K=e(89640),A=e(40279),f=e(37386),W=e(72636),N=e(63527),x=e(45861),G=e(87105),U=e(41654),la=e(68079),X=e(63142),ca=e(65240),ha=e(45229),B=e(74410),Z=e(13791),i=e(56840),k=e(8535),ma=e(20018),ua=e(92138),z=e(36490),w=e(18646),F=e(74755),H=e(96673),M=e(49785),q=e(36580),_=e(67804),aa=e(76792),pa=e(75735),ba=e(60171),fa=e(89223);const xa=s=>{let t;try{t=JSON.parse(s)}catch{return(0,i.t)("dashboard.validation.invalid-json","Not valid JSON")}if(t&&t.hasOwnProperty("tags"))if(Array.isArray(t.tags)){if(t.tags.some(d=>typeof d!="string"))return(0,i.t)("dashboard.validation.tags-expected-strings","tags expected array of strings")}else return(0,i.t)("dashboard.validation.tags-expected-array","tags expected array");return!0},va=s=>{const t=/(^\d+$)|dashboards\/(\d+)/.exec(s);return t&&(t[1]||t[2])?!0:(0,i.t)("dashboard.validation.invalid-dashboard-id","Could not find a valid Grafana.com ID")},ta=(s,t)=>fa.P.validateNewDashboardName(t,s).then(()=>!0).catch(l=>{if(l.type==="EXISTING")return l.message}),ea=s=>(0,w.n)().getDashboardDTO(s).then(t=>{const l=(0,ba.HG)(t),d=l?t.spec:t.dashboard,r=l?t.metadata.annotations?.[pa.w2]:t.meta.folderTitle;return`Dashboard named '${d.title}' in folder '${r}' has the same UID`}).catch(t=>(t.isHandled=!0,t.status===403?"Dashboard with the same UID already exists":!0)),ga=({register:s,errors:t,control:l,inputs:d,getValues:r,uidReset:h,onUidReset:O,onCancel:D,onSubmit:v,watch:T})=>{const[m,y]=(0,g.useState)(!1),[P,n]=(0,g.useState)({});return(0,g.useEffect)(()=>{if(m&&(t.dashboard?.title||t.k8s?.name)){const o=r();v({...o,dashboard:{...o.dashboard,title:o.dashboard.title}})}},[t,r,m,v]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.x6,{i18nKey:"manage-dashboards.import-dashboard-form.options",children:"Options"}),(0,a.jsx)(f.D,{label:(0,i.t)("manage-dashboards.import-dashboard-form.label-name","Name"),invalid:!!t.dashboard?.title,error:t.dashboard?.title&&t.dashboard?.title.message,children:(0,a.jsx)(N.p,{...s("dashboard.title",{required:"Name is required",validate:async o=>await ta(o,r().folderUid??"")}),type:"text","data-testid":I.Tp.components.ImportDashboardForm.name})}),(0,a.jsx)(f.D,{label:"Folder",children:(0,a.jsx)(M.xI,{render:({field:{ref:o,value:p,onChange:c,...u}})=>(0,a.jsx)(_.d,{...u,onChange:(b,j)=>{c(b,j)},value:p}),name:"folderUid",control:l})}),d.dataSources&&d.dataSources.map(o=>{if(o.pluginId===q.dR.type)return null;const p=`datasource-${o.pluginId}`;return(0,a.jsx)(f.D,{label:o.label,description:o.description,invalid:!!t[p],error:t[p]?"Please select a data source":void 0,children:(0,a.jsx)(M.xI,{name:p,render:({field:{ref:c,...u}})=>(0,a.jsx)(aa.s,{...u,noDefault:!0,placeholder:o.info,pluginId:o.pluginId,current:P[o.pluginId],onChange:b=>{u.onChange(b),n(j=>({...j,[o.pluginId]:{uid:b.uid,type:b.type}}))}}),control:l,rules:{required:!0}})},o.pluginId)}),(0,a.jsxs)(U.B,{children:[(0,a.jsx)(x.$n,{type:"submit","data-testid":I.Tp.components.ImportDashboardForm.submit,variant:ja(t),onClick:()=>{y(!0)},children:Da(t)}),(0,a.jsx)(x.$n,{type:"reset",variant:"secondary",onClick:D,children:"Cancel"})]})]})};function ja(s){return s&&(s.dashboard?.title||s.k8s?.name)?"destructive":"primary"}function Da(s){return s&&(s.dashboard?.title||s.k8s?.name)?"Import (Overwrite)":"Import"}const ya="dashboard_import_imported";function Ia(){const[s,t]=(0,g.useState)(!1),l=(0,H.useDispatch)(),d=z.Ny.getSearchObject(),r=(0,H.useSelector)(m=>m.importDashboard.dashboard),h=(0,H.useSelector)(m=>m.importDashboard.inputs),O=d.folderUid?{uid:String(d.folderUid)}:{uid:""};function D(){t(!0)}function v(){l((0,F.FG)())}async function T(m){(0,S.rR)(ya);const y={...r,title:m.dashboard.title,annotations:r.annotations?.map(n=>{if(n.spec.query?.kind){const o=n.spec.query.kind;if(m[`datasource-${o}`]){const p=m[`datasource-${o}`];return{...n,spec:{...n.spec,datasource:{uid:p.uid,type:p.type}}}}}return n}),variables:r.variables?.map(n=>{if(n.kind==="QueryVariable"){if(n.spec.query?.kind){const o=n.spec.query.kind;if(m[`datasource-${o}`]){const p=m[`datasource-${o}`];return{...n,spec:{...n.spec,datasource:{...n.spec.datasource,uid:p.uid,type:p.type},options:[],current:{text:"",value:""},refresh:"onDashboardLoad"}}}}}else if(n.kind==="DatasourceVariable")return{...n,spec:{...n.spec,current:{text:"",value:""}}};return n}),elements:Object.fromEntries(Object.entries(r.elements).map(([n,o])=>{if(o.kind==="Panel"){const p={...o.spec};if(p.data?.kind==="QueryGroup"){const c=p.data.spec.queries.map(u=>{if(u.kind==="PanelQuery"){const b=u.spec.query?.kind;if(b&&m[`datasource-${b}`]){const j=m[`datasource-${b}`];return{...u,spec:{...u.spec,datasource:{uid:j.uid,type:j.type}}}}}return u});p.data={...p.data,spec:{...p.data.spec,queries:c}}}return[n,{kind:o.kind,spec:p}]}return[n,o]}))},P=await(0,w.n)("v2").saveDashboard({...m,dashboard:y});if(P.url){const n=ua.I.stripBaseFromUrl(P.url);z.Ny.push(n)}}return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(B.l,{onSubmit:T,defaultValues:{dashboard:r,k8s:{annotations:{"grafana.app/folder":O.uid}}},validateOnMount:!0,validateOn:"onChange",children:({register:m,errors:y,control:P,watch:n,getValues:o})=>(0,a.jsx)(ga,{register:m,inputs:h,errors:y,control:P,getValues:o,uidReset:s,onCancel:v,onUidReset:D,onSubmit:T,watch:n})})})}var Sa=e(80011),Na=e(31286),sa=e(53487),L=e(2559),Oa=e(70905);function ra({inputs:s,label:t,description:l,folderName:d}){const r=(0,X.of)(Ta);return s?.length?(0,a.jsx)("div",{className:r.spacer,children:(0,a.jsx)(f.D,{label:t,description:l,children:(0,a.jsx)(a.Fragment,{children:s.map((h,O)=>{const D=`elements[${O}]`,v=h.state===L.J7.New?{...h.model,meta:{...h.model.meta,folderName:d??"Dashboards"}}:{...h.model};return(0,a.jsx)("div",{className:r.item,children:(0,a.jsx)(Oa.E,{libraryPanel:v,onClick:()=>{}})},D)})})})}):null}function Ta(s){return{spacer:(0,E.css)({marginBottom:s.spacing(2)}),item:(0,E.css)({marginBottom:s.spacing(1)})}}const Pa=({register:s,errors:t,control:l,getValues:d,uidReset:r,inputs:h,onUidReset:O,onCancel:D,onSubmit:v,watch:T})=>{const[m,y]=(0,g.useState)(!1),P=T("dataSources"),n=T("folder");(0,g.useEffect)(()=>{m&&(t.title||t.uid)&&v(d())},[t,d,m,v]);const o=h?.libraryPanels?.filter(c=>c.state===L.J7.New)??[],p=h?.libraryPanels?.filter(c=>c.state===L.J7.Exists)??[];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(sa.s,{children:(0,a.jsx)(i.x6,{i18nKey:"manage-dashboards.import-dashboard-form.options",children:"Options"})}),(0,a.jsx)(f.D,{label:(0,i.t)("manage-dashboards.import-dashboard-form.label-name","Name"),invalid:!!t.title,error:t.title&&t.title.message,children:(0,a.jsx)(N.p,{...s("title",{required:"Name is required",validate:async c=>await ta(c,d().folder.uid)}),type:"text","data-testid":I.Tp.components.ImportDashboardForm.name})}),(0,a.jsx)(f.D,{label:(0,i.t)("manage-dashboards.import-dashboard-form.label-folder","Folder"),children:(0,a.jsx)(M.xI,{render:({field:{ref:c,value:u,onChange:b,...j}})=>(0,a.jsx)(_.d,{...j,onChange:(na,Y)=>b({uid:na,title:Y}),value:u.uid}),name:"folder",control:l})}),(0,a.jsx)(f.D,{label:(0,i.t)("manage-dashboards.import-dashboard-form.label-unique-identifier-uid","Unique identifier (UID)"),description:`The unique identifier (UID) of a dashboard can be used for uniquely identify a dashboard between multiple Grafana installs.
                The UID allows having consistent URLs for accessing dashboards so changing the title of a dashboard will not break any
                bookmarked links to that dashboard.`,invalid:!!t.uid,error:t.uid&&t.uid.message,children:(0,a.jsx)(a.Fragment,{children:r?(0,a.jsx)(N.p,{...s("uid",{required:!0,validate:async c=>await ea(c)})}):(0,a.jsx)(N.p,{disabled:!0,...s("uid",{validate:async c=>await ea(c)}),addonAfter:!r&&(0,a.jsx)(x.$n,{onClick:O,children:(0,a.jsx)(i.x6,{i18nKey:"manage-dashboards.import-dashboard-form.change-uid",children:"Change uid"})})})})}),h.dataSources&&h.dataSources.map((c,u)=>{if(c.pluginId===q.dR.type)return null;const b=`dataSources.${u}`,j=P??[];return(0,a.jsx)(f.D,{label:c.label,description:c.description,invalid:t.dataSources&&!!t.dataSources[u],error:t.dataSources&&t.dataSources[u]&&"A data source is required",children:(0,a.jsx)(M.xI,{name:b,render:({field:{ref:na,...Y}})=>(0,a.jsx)(aa.s,{...Y,noDefault:!0,placeholder:c.info,pluginId:c.pluginId,current:j[u]?.uid}),control:l,rules:{required:!0}})},b)}),h.constants&&h.constants.map((c,u)=>{const b=`constants.${u}`;return(0,a.jsx)(f.D,{label:c.label,error:t.constants&&t.constants[u]&&`${c.label} needs a value`,invalid:t.constants&&!!t.constants[u],children:(0,a.jsx)(N.p,{...s(b,{required:!0}),defaultValue:c.value})},b)}),(0,a.jsx)(ra,{inputs:o,label:(0,i.t)("manage-dashboards.import-dashboard-form.label-new-library-panels","New library panels"),description:(0,i.t)("manage-dashboards.import-dashboard-form.description-library-panels-imported","List of new library panels that will get imported."),folderName:n.title}),(0,a.jsx)(ra,{inputs:p,label:(0,i.t)("manage-dashboards.import-dashboard-form.label-existing-library-panels","Existing library panels"),description:"List of existing library panels. These panels are not affected by the import.",folderName:n.title}),(0,a.jsxs)(U.B,{children:[(0,a.jsx)(x.$n,{type:"submit","data-testid":I.Tp.components.ImportDashboardForm.submit,variant:Ea(t),onClick:()=>{y(!0)},children:Ua(t)}),(0,a.jsx)(x.$n,{type:"reset",variant:"secondary",onClick:D,children:(0,a.jsx)(i.x6,{i18nKey:"manage-dashboards.import-dashboard-form.cancel",children:"Cancel"})})]})]})};function Ea(s){return s&&(s.title||s.uid)?"destructive":"primary"}function Ua(s){return s&&(s.title||s.uid)?"Import (Overwrite)":"Import"}const Fa="dashboard_import_imported",Ca=s=>{const t=z.Ny.getSearchObject();return{dashboard:s.importDashboard.dashboard,meta:s.importDashboard.meta,source:s.importDashboard.source,inputs:s.importDashboard.inputs,folder:t.folderUid?{uid:String(t.folderUid)}:{uid:""}}},La={clearLoadedDashboard:F.FG,importDashboard:F.Q9},Ra=(0,J.connect)(Ca,La);class Ja extends g.PureComponent{constructor(){super(...arguments),this.state={uidReset:!1},this.onSubmit=t=>{(0,S.rR)(Fa),this.props.importDashboard(t)},this.onCancel=()=>{this.props.clearLoadedDashboard()},this.onUidReset=()=>{this.setState({uidReset:!0})}}render(){const{dashboard:t,inputs:l,meta:d,source:r,folder:h}=this.props,{uidReset:O}=this.state;return(0,a.jsxs)(a.Fragment,{children:[r===L.qx.Gcom&&(0,a.jsxs)(Na.a,{marginBottom:3,children:[(0,a.jsx)("div",{children:(0,a.jsxs)(sa.s,{children:["Importing dashboard from"," ",(0,a.jsx)("a",{href:`https://grafana.com/dashboards/${t.gnetId}`,className:"external-link",target:"_blank",rel:"noreferrer",children:"Grafana.com"})]})}),(0,a.jsx)("table",{className:"filter-table form-inline",children:(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:(0,a.jsx)(i.x6,{i18nKey:"manage-dashboards.import-dashboard-overview-un-connected.published-by",children:"Published by"})}),(0,a.jsx)("td",{children:d.orgName})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:(0,a.jsx)(i.x6,{i18nKey:"manage-dashboards.import-dashboard-overview-un-connected.updated-on",children:"Updated on"})}),(0,a.jsx)("td",{children:(0,Sa.LE)(d.updatedAt)})]})]})})]}),(0,a.jsx)(B.l,{onSubmit:this.onSubmit,defaultValues:{...t,constants:[],dataSources:[],elements:[],folder:h},validateOnMount:!0,validateFieldsOnMount:["title","uid"],validateOn:"onChange",children:({register:D,errors:v,control:T,watch:m,getValues:y})=>(0,a.jsx)(Pa,{register:D,errors:v,control:T,getValues:y,uidReset:O,inputs:l,onCancel:this.onCancel,onUidReset:this.onUidReset,onSubmit:this.onSubmit,watch:m})})]})}}const oa=Ra(Ja);oa.displayName="ImportDashboardOverview";const Q="dashboard_import_loaded",$a=`{
    "title": "Example - Repeating Dictionary variables",
    "uid": "_0HnEoN4z",
    "panels": [...]
    ...
}
`,Aa=s=>({loadingState:s.importDashboard.state,dashboard:s.importDashboard.dashboard}),Ga={fetchGcomDashboard:F.rw,importDashboardJson:F.iP,cleanUpAction:ma.N},Ba=(0,J.connect)(Aa,Ga);class Ma extends g.PureComponent{constructor(t){super(t),this.fileListRenderer=(d,r)=>null,this.onFileUpload=d=>{(0,S.rR)(Q,{import_source:"json_uploaded"});try{const r=JSON.parse(String(d));if(r.elements){(0,k.JD)((0,F.S7)(r));return}this.props.importDashboardJson(r)}catch(r){r instanceof Error&&ha.A.emit(V.r1.alertError,["Import failed","JSON -> JS Serialization failed: "+r.message]);return}},this.getDashboardFromJson=d=>{(0,S.rR)(Q,{import_source:"json_pasted"});const r=JSON.parse(d.dashboardJson);if(r.elements){(0,k.JD)((0,F.S7)(r));return}this.props.importDashboardJson(r)},this.getGcomDashboard=d=>{(0,S.rR)(Q,{import_source:"gcom"});let r;const h=/(^\d+$)|dashboards\/(\d+)/.exec(d.gcomDashboard);h&&h[1]?r=h[1]:h&&h[2]&&(r=h[2]),r&&this.props.fetchGcomDashboard(r)},this.pageNav={text:"Import dashboard",subTitle:"Import dashboard from file or Grafana.com"};const{gcomDashboardId:l}=this.props.queryParams;if(l){this.getGcomDashboard({gcomDashboard:l});return}}componentWillUnmount(){this.props.cleanUpAction({cleanupAction:t=>t.importDashboard=L.V9})}renderImportForm(){const t=Wa(this.props.theme),l=()=>(0,a.jsx)(K.Y,{variant:"bodySmall",href:"https://grafana.com/grafana/dashboards/",external:!0,children:"grafana.com/dashboards"});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:t.option,children:(0,a.jsx)(A.gH,{options:{multiple:!1,accept:[".json",".txt"]},readAs:"readAsText",fileListRenderer:this.fileListRenderer,onLoad:this.onFileUpload,children:(0,a.jsx)(A.wI,{primaryText:(0,i.t)("dashboard-import.file-dropzone.primary-text","Upload dashboard JSON file"),secondaryText:(0,i.t)("dashboard-import.file-dropzone.secondary-text","Drag and drop here or click to browse")})})}),(0,a.jsx)("div",{className:t.option,children:(0,a.jsx)(B.l,{onSubmit:this.getGcomDashboard,defaultValues:{gcomDashboard:""},children:({register:d,errors:r})=>(0,a.jsx)(f.D,{label:(0,a.jsx)(W.J,{className:t.labelWithLink,htmlFor:"url-input",children:(0,a.jsx)("span",{children:(0,a.jsxs)(i.x6,{i18nKey:"dashboard-import.gcom-field.label",children:["Find and import dashboards for common applications at ",(0,a.jsx)(l,{})]})})}),invalid:!!r.gcomDashboard,error:r.gcomDashboard&&r.gcomDashboard.message,children:(0,a.jsx)(N.p,{id:"url-input",placeholder:(0,i.t)("dashboard-import.gcom-field.placeholder","Grafana.com dashboard URL or ID"),type:"text",...d("gcomDashboard",{required:(0,i.t)("dashboard-import.gcom-field.validation-required","A Grafana dashboard URL or ID is required"),validate:va}),addonAfter:(0,a.jsx)(x.$n,{type:"submit",children:(0,a.jsx)(i.x6,{i18nKey:"dashboard-import.gcom-field.load-button",children:"Load"})})})})})}),(0,a.jsx)("div",{className:t.option,children:(0,a.jsx)(B.l,{onSubmit:this.getDashboardFromJson,defaultValues:{dashboardJson:""},children:({register:d,errors:r})=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.D,{label:(0,i.t)("dashboard-import.json-field.label","Import via dashboard JSON model"),invalid:!!r.dashboardJson,error:r.dashboardJson&&r.dashboardJson.message,children:(0,a.jsx)(G.f,{...d("dashboardJson",{required:(0,i.t)("dashboard-import.json-field.validation-required","Need a dashboard JSON model"),validate:xa}),"data-testid":I.Tp.components.DashboardImportPage.textarea,id:"dashboard-json-textarea",rows:10,placeholder:$a})}),(0,a.jsxs)(U.B,{children:[(0,a.jsx)(x.$n,{type:"submit","data-testid":I.Tp.components.DashboardImportPage.submit,children:(0,a.jsx)(i.x6,{i18nKey:"dashboard-import.form-actions.load",children:"Load"})}),(0,a.jsx)(x.z9,{variant:"secondary",href:`${$.$.appSubUrl}/dashboards`,children:(0,a.jsx)(i.x6,{i18nKey:"dashboard-import.form-actions.cancel",children:"Cancel"})})]})]})})})]})}getDashboardOverview(){const{loadingState:t,dashboard:l}=this.props;return t===C.Gu.Done?l.elements?(0,a.jsx)(Ia,{}):(0,a.jsx)(oa,{}):null}render(){const{loadingState:t}=this.props;return(0,a.jsx)(Z.Y,{navId:"dashboards/browse",pageNav:this.pageNav,children:(0,a.jsxs)(Z.Y.Contents,{children:[t===C.Gu.Loading&&(0,a.jsx)(U.B,{direction:"column",justifyContent:"center",children:(0,a.jsx)(U.B,{justifyContent:"center",children:(0,a.jsx)(la.y,{size:"xxl"})})}),[C.Gu.Error,C.Gu.NotStarted].includes(t)&&this.renderImportForm(),this.getDashboardOverview()]})})}}const Va=(0,X.cV)(Ma),da=Ba(Va);da.displayName="DashboardImport";const Ka=da,Wa=(0,ca.N)(s=>({option:(0,E.css)({marginBottom:s.spacing(4),maxWidth:"600px"}),labelWithLink:(0,E.css)({maxWidth:"100%"}),linkWithinLabel:(0,E.css)({fontSize:"inherit"})}))}}]);

//# sourceMappingURL=DashboardImport.9875829f042a9cc5c209.js.map