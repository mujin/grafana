"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[323],{61048:(ct,I,n)=>{n.d(I,{i:()=>j});var x=n(74848),m=n(22803),W=n(63142);const j=({children:T,className:k})=>{const R=(0,W.of)($);return(0,x.jsx)("div",{className:(0,m.cx)(R.wrapper,k),children:T})},$=T=>({wrapper:(0,m.css)({display:"flex",flexDirection:"column",fontSize:T.typography.bodySmall.fontSize})})},65672:(ct,I,n)=>{n.r(I),n.d(I,{plugin:()=>Bt});var x=n(16207),m=n(74261),W=n(83340),j=n(64394),$=n(38809),T=n(95004),k=n(79277),R=n(41069),G=n(99555),lt=n(45013),w=n(81082),M=n(74848),z=n(96540),it=n(16515),q=n(39443),r=n(63142),l=n(739),S=n(69234),P=n(36613),f=n(79243),v=n(55386),g=n(76637),O=n(47276),U=n(53568),h=n(23414),_=n(61897),N=n(54735),tt=n(92790),J=n(36192);const L={bucketCount:30,bucketOffset:0},D={fillOpacity:80,gradientMode:l.on.None,lineWidth:1};function b(e,t){return Math.floor(e/t)*t}function V(e,t){return Math.ceil(e/t)*t}function F(e){return e.fields[0].type===T.PU.string?1:(0,f.h)(e.fields[1].values[0]-e.fields[0].values[0],9)}function vt(e){return e.fields[0].type===T.PU.string?1:(0,f.h)(e.fields[1].values[1]-e.fields[0].values[1],9)}const xt=(e,t)=>{let{min:s,max:o}=e.fields[2].config,i=new O.e,d=e.fields[0].type===T.PU.string,c=F(e),E=vt(e),y=E/c,C=E!==c,B=(u,a,p,K,rt,dt)=>{let Y=u.axes[a]._space,Q=u.valToPos(u.data[0][0]+c,"x")-u.valToPos(u.data[0][0],"x"),Z=b(s??u.data[0][0],c),At=V(o??u.data[0][u.data[0].length-1]+c,c),ht=[],It=Math.ceil(Y/Q);for(let pt=0,ut=Z;ut<=At;pt++,ut+=c)!(pt%It)&&ht.push(ut);return ht};i.addScale({scaleKey:"x",isTime:!1,distribution:d?l.L4.Ordinal:C?l.L4.Log:l.L4.Linear,log:2,orientation:l.Lt.Horizontal,direction:l.ON.Right,range:C?(u,a,p)=>P.A.rangeLog(a,p*y,2,!0):(u,a,p)=>{s!=null&&(a=s),o!=null&&(p=o);let K=u.data[0][u.data[0].length-1];return a=V(a,c),p=!d&&p===K?p+c:b(p,c),[a,p]}}),i.addScale({scaleKey:"y",isTime:!1,distribution:l.L4.Linear,orientation:l.Lt.Vertical,direction:l.ON.Up,softMin:0});const A=e.fields[0].display,X=u=>(0,v.cN)(A(u));i.addAxis({scaleKey:"x",isTime:!1,placement:l.vM.Bottom,incrs:d?[1]:C?void 0:m.rW,splits:C||d?void 0:B,values:d?(u,a)=>a:(u,a)=>{const p=a.map(X),K=p.reduce((Q,Z)=>Math.max((0,U.kD)(Z,h.pi).width,Q),0),dt=u.bbox.width/((K+10)*devicePixelRatio),Y=Math.ceil(p.length/dt);return p.map((Q,Z)=>Z%Y===0?Q:null)},theme:t});let nt=e.fields[2].display;i.addAxis({scaleKey:"y",isTime:!1,placement:l.vM.Left,formatValue:(u,a)=>(0,v.cN)(nt(u,a)),theme:t}),i.setCursor({points:{show:!1},drag:{x:!0,y:!1,setScale:!0}});let ot=(0,J.ro)(ft(e));i.setStackingGroups(ot);let st=P.A.paths.bars({align:1,size:[1,1/0]}),at=0;for(let u=2;u<e.fields.length;u++){const a=e.fields[u];a.state=a.state??{},a.state.seriesIndex=at++;const p={...D,...a.config.custom},K="y",rt=(0,g.Qi)(a),Y=(0,g.lz)(a,t).color;i.addSeries({scaleKey:K,lineWidth:p.lineWidth,lineColor:Y,fillOpacity:p.fillOpacity,theme:t,colorMode:rt,pathBuilder:st,show:!p.hideFrom?.viz,gradientMode:p.gradientMode,thresholds:a.config.thresholds,hardMin:a.config.min,hardMax:a.config.max,softMin:p.axisSoftMin,softMax:p.axisSoftMax,dataFrameFieldIndex:a.state.origin})}return i},ft=e=>({...e,fields:e.fields.filter(t=>t.name!==m.dA)}),yt=(e,t)=>{for(let s=1;s<t.fields.length;s++){let o=t.fields[s].values;for(let i=0;i<o.length;i++)o[i]===0&&(o[i]=null)}return(0,J.bq)(t,e.getStackingGroups())};class Ct extends z.Component{constructor(t){super(t),this.state=this.prepState(t)}prepState(t,s=!0){const{alignedFrame:o}=t,i=s?xt(o,this.props.theme):this.state.config,d=ft(o),c=yt(i,d);return{alignedFrame:o,alignedData:c,config:i,xMinOnlyFrame:d}}renderLegend(t){const{legend:s}=this.props;if(!t||s.showLegend===!1)return null;const o=this.props.options.combine?[this.props.alignedFrame]:this.props.rawSeries;return(0,M.jsx)(_.$,{data:o,config:t,maxHeight:"35%",maxWidth:"60%",...s})}componentDidUpdate(t){const{structureRev:s,alignedFrame:o,bucketSize:i,bucketCount:d}=this.props;if(o!==t.alignedFrame){const c=this.state.config==null||d!==t.bucketCount||i!==t.bucketSize||this.props.options!==t.options||this.state.config===void 0||s!==t.structureRev||!s,E=this.prepState(this.props,c);this.setState(E)}}render(){const{width:t,height:s,children:o,alignedFrame:i}=this.props,{config:d}=this.state;return d?(0,M.jsx)(N.KU,{width:t,height:s,legend:this.renderLegend(d),children:(c,E)=>(0,M.jsx)(tt.Z,{config:this.state.config,data:this.state.alignedData,width:c,height:E,children:o?o(d,i,this.state.xMinOnlyFrame):null})}):null}}var Mt=n(55302),St=n(39064),Pt=n(61048),Ot=n(41530),Et=n(47466),Tt=n(16913),Dt=n(76234);const Ut=({series:e,xMinOnlyFrame:t,dataIdxs:s,seriesIdx:o,mode:i=l.$N.Single,sortOrder:d=l.xB.None,isPinned:c,maxHeight:E})=>{const y=e.fields[0],C=e.fields[1],{display:B}=y.config.unit!=null?y:C,{display:A}=C.config.unit!=null?C:y,X=(0,v.cN)(B(y.values[s[0]])),et=(0,v.cN)(A(C.values[s[1]])),nt=y.config.custom?.hideFrom?.tooltip?null:{label:"Bucket",value:`${X} - ${et}`},ot=(0,z.useMemo)(()=>(0,Mt.cp)(t.fields,y,s,o,i,d),[t.fields,y,s,o,i,d]);let st;if(c&&o!=null){const at=e.fields[o],u=s[o],a=(0,Tt.u6)(at,u);st=(0,M.jsx)(St.S,{dataLinks:a})}return(0,M.jsxs)(Pt.i,{children:[nt!=null&&(0,M.jsx)(Ot.A,{item:nt,isPinned:c}),(0,M.jsx)(Et.o,{items:ot,isPinned:c,scrollable:(0,Dt.T5)({mode:i,maxHeight:E}),maxHeight:E}),st]})},Ft=({data:e,options:t,width:s,height:o})=>{const i=(0,r.$j)(),d=(0,z.useMemo)(()=>{if(!e.series.length)return;if(e.series.forEach((y,C)=>{y.fields.forEach((B,A)=>{B.state={...B.state,origin:{frameIndex:C,fieldIndex:A}}})}),(0,it.Fm)(e.series),e.series.length===1||e.series.every(y=>y.meta?.type===q.m.HeatmapCells||y.meta?.type===q.m.HeatmapRows)){const y=e.series.map(C=>(0,m.ix)(C)).filter(C=>C!=null);if(y.length)return(0,m.cg)((0,m.EO)(y),i)}const E=(0,m.p3)(e.series,t,i);if(E)return(0,m.cg)(E,i)},[e.series,t,i]);if(!d||!d.fields.length)return(0,M.jsx)("div",{className:"panel-empty",children:(0,M.jsx)("p",{children:"No histogram found in response"})});const c=F(d);return(0,M.jsx)(Ct,{options:t,theme:i,legend:t.legend,rawSeries:e.series,structureRev:e.structureRev,width:s,height:o,alignedFrame:d,bucketSize:c,bucketCount:t.bucketCount,children:(E,y,C)=>(0,M.jsx)(M.Fragment,{children:t.tooltip.mode!==l.$N.None&&(0,M.jsx)(S.xl,{config:E,hoverMode:t.tooltip.mode===l.$N.Single?S.b3.xOne:S.b3.xAll,render:(B,A,X,et=!1)=>(0,M.jsx)(Ut,{series:d,xMinOnlyFrame:C,dataIdxs:A,seriesIdx:X,mode:t.tooltip.mode,sortOrder:t.tooltip.sort,isPinned:et,maxHeight:t.tooltip.maxHeight}),maxWidth:t.tooltip.maxWidth})})})},gt={stacking:{mode:l.gs.None,group:"A"}};var mt=n(2543);const Lt=(e,t,s,o)=>{if(t==="graph"&&s.angular.xaxis?.mode==="histogram"){const{fieldConfig:d,options:c}=Rt({...s.angular,fieldConfig:o});return e.fieldConfig=d,c}return{}};function Rt(e){let t={};const s={legend:{displayMode:l.lm.List,showLegend:!0,placement:"bottom",calcs:[]},tooltip:{mode:l.$N.Single,sort:l.xB.None},combine:!1};return e.stack&&(t.stacking={mode:e.percentage?l.gs.Percent:l.gs.Normal,group:gt.stacking.group},s.combine=!1),{fieldConfig:{defaults:(0,mt.omitBy)({custom:t},mt.isNil),overrides:[]},options:s}}function H(e){if(e?.length!==1)return!1;const t=e[0];if(t.fields.length<3||!(0,m.NX)(t.fields[0].name)||!(0,m.H1)(t.fields[1].name))return!1;for(const s of t.fields)if(s.type!==T.PU.number)return!1;return!0}const Bt=new x.m(Ft).setPanelChangeHandler(Lt).setPanelOptions(e=>{e.addCustomEditor({id:"__calc__",path:"__calc__",name:"Values",description:"Showing frequencies that are calculated in the query",editor:()=>null,showIf:(t,s)=>H(s)}).addNumberInput({path:"bucketCount",name:m.Rt.bucketCount.name,description:m.Rt.bucketCount.description,settings:{placeholder:`Default: ${L.bucketCount}`,min:0},showIf:(t,s)=>!H(s)}).addNumberInput({path:"bucketSize",name:m.Rt.bucketSize.name,description:m.Rt.bucketSize.description,settings:{placeholder:"Auto",min:0},defaultValue:L.bucketSize,showIf:(t,s)=>!H(s)}).addNumberInput({path:"bucketOffset",name:m.Rt.bucketOffset.name,description:m.Rt.bucketOffset.description,settings:{placeholder:`Default: ${L.bucketOffset}`,min:0},showIf:(t,s)=>!H(s)}).addBooleanSwitch({path:"combine",name:m.Rt.combine.name,description:m.Rt.combine.description,defaultValue:L.combine,showIf:(t,s)=>!H(s)}),k.D(e),R.H(e)}).useFieldConfig({standardOptions:{[W.uo.Color]:{settings:{byValueSupport:!1,bySeriesSupport:!0,preferThresholdsMode:!1},defaultValue:{mode:j.Y.PaletteClassic}},[W.uo.Links]:{settings:{showOneClick:!0}}},useCustomConfig:e=>{const t=D;e.addCustomEditor({id:"stacking",path:"stacking",name:"Stacking",category:["Histogram"],defaultValue:gt.stacking,editor:w.m,override:w.m,settings:{options:G.t.stacking},process:$.hS,shouldApply:s=>s.type===T.PU.number,showIf:(s,o)=>!H(o)}).addSliderInput({path:"lineWidth",name:"Line width",defaultValue:t.lineWidth,settings:{min:0,max:10,step:1}}).addSliderInput({path:"fillOpacity",name:"Fill opacity",defaultValue:t.fillOpacity,settings:{min:0,max:100,step:1}}).addRadio({path:"gradientMode",name:"Gradient mode",defaultValue:G.t.fillGradient[0].value,settings:{options:G.t.fillGradient}}),lt.e(e)}})},76234:(ct,I,n)=>{n.d(I,{B_:()=>w,Fg:()=>it,O2:()=>z,T5:()=>q});var x=n(95004),m=n(16515),W=n(63409),j=n(34455),$=n(55386),T=n(11576),k=n(406),R=n(739),G=n(70332);function lt(r){let l=new Map;return r.map(P=>({...P,fields:P.fields.map(f=>{if(f.type===x.PU.enum){let v=(0,G.M)(f.config,f.type),g=l.get(v);g||(g=[],l.set(v,g));let O=f.values.toArray().slice(),U=f.config.type.enum.text;if(g.length>0)for(let h=0;h<O.length;h++)O[h]+=g.length;return g.push(...U),f.config.type.enum.text=g,{...f,values:O}}return f})}))}function w(r,l,S,P){if(!r?.length)return null;(0,m.Fm)(r);let f=P!=null;P!=null&&P>0&&(r=[{...r[0],fields:[r[0].fields[P],...r[0].fields.filter((U,h)=>h!==P)]}]);for(let U of r)for(let h of U.fields)h.type===x.PU.time&&typeof h.values[0]!="number"&&(h.values=(0,k.s7)(h,{destinationType:x.PU.time}).values);let v=0;t:for(let U of r)for(let h of U.fields)if(h.type===x.PU.enum&&++v>1){r=lt(r);break t}let g;const O=[];for(let U of r){const h=[];let _=!1,N=!1,tt=f?U:(0,W.M)({frame:U,refFieldPseudoMin:S?.from.valueOf(),refFieldPseudoMax:S?.to.valueOf()});const J=(0,j.C)(tt).fields;for(let L=0;L<(J?.length||0);L++){const D=J[L];switch(D.type){case x.PU.time:_=!0,h.push(D);break;case x.PU.number:N=f?L>0:!0,g={...D,values:D.values.map(F=>Number.isFinite(F)||F==null?F:null)},h.push(g);break;case x.PU.enum:N=!0;case x.PU.string:g={...D,values:D.values},h.push(g);break;case x.PU.boolean:N=!0;const b=D.config?.custom??{},V={...D.config,max:1,min:0,custom:b};b.lineInterpolation!==R.dx.StepBefore&&(b.lineInterpolation=R.dx.StepAfter),g={...D,config:V,type:x.PU.number,values:D.values.map(F=>F==null?F:F?1:0)},(0,$.j9)(V.unit)||(V.unit="bool",g.display=(0,T.J)({field:g,theme:l})),h.push(g);break}}(f||_)&&N&&O.push({...U,length:tt.length,fields:h})}return O.length?(z(O,l,0),M(O,l),O):null}const M=(r,l)=>{const{palette:S}=l.visualization;for(const P of r)for(const f of P.fields)if(f.type===x.PU.enum){const v=S[f.state?.seriesIndex%S.length],g=l.visualization.getColorByName(v),O=f.config.type.enum;O.color=Array(O.text.length).fill(g),f.display=(0,T.J)({field:f,theme:l})}},z=(r,l,S)=>{let P=0;r.forEach(f=>{f.fields.forEach((v,g)=>{g!==S&&(v.type===x.PU.number||v.type===x.PU.boolean||v.type===x.PU.enum)&&(v.state={...v.state,seriesIndex:P++},v.display=(0,T.J)({field:v,theme:l}))})})};function it(r,l){return!r||!r.length?[l]:r.map(S=>S?.length?S:l)}const q=r=>r.mode===R.$N.Multi&&r.maxHeight!=null}}]);

//# sourceMappingURL=histogramPanel.c36c9833cbb18e7dfc99.js.map