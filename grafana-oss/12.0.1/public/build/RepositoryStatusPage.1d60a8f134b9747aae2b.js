"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6092],{11065:(z,S,n)=>{n.d(S,{R:()=>d});var e=n(84140);function d(L,K,M){if(L.isLight)return K;{if(M){const i=(0,e.A)(K);return e.A.mostReadable(M,[i.clone().lighten(25),i.clone().lighten(10),i,i.clone().darken(10),i.clone().darken(25)],{includeFallbackColors:!1}).toHex8String()}const a=(0,e.A)(K).toHsl();a.l=1-a.l;const g=(0,e.A)(a);return g.isLight()?g.darken(5).toHex8String():g.lighten(5).toHex8String()}}},21961:(z,S,n)=>{n.d(S,{Ay:()=>Y});var e=n(74848),d=n(22803),L=n(46942),K=n.n(L),M=n(30703),a=n(63142),g=n(11065),i=n(96540),R=n(45967),E=n(45861);const k=()=>({CopyIcon:(0,d.css)({backgroundColor:"transparent",border:"none",color:"inherit",height:"100%",overflow:"hidden","&:focus":{backgroundColor:"rgba(255, 255, 255, 0.25)",color:"inherit"}})});function $({copyText:l,icon:D="copy",tooltipTitle:f}){const v=(0,a.of)(k),[P,O]=(0,i.useState)(!1),x=()=>{navigator.clipboard.writeText(l),O(!0)};return(0,e.jsx)(R.m,{content:P?"Copied":f,children:(0,e.jsx)(E.$n,{className:K()(v.CopyIcon),type:"button",icon:D,onClick:x})})}const N="    ";function T(l){let D="";return l&&Object.keys(l).forEach(function(f){D+=f+":"+l[f]+";"}),D}function U(l){function D(v){return'class="'+v+'"'}function f(v){return'style="'+T(l["."+v])+'"'}return l?f:D}function w(l){return l===null?"null":Array.isArray(l)?"array":typeof l=="string"&&/^https?:/.test(l)?"link":typeof l=="object"&&typeof l.toISOString=="function"?"date":typeof l}function r(l){return l.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Z(l,D){let f="";const v=U(D);let P=function(x,A,C,p){if(!x.length)return A+" "+C;let Q=A+`
`;return f+=N,x.forEach(function(G,X){Q+=f+p(G)+(X<x.length-1?",":"")+`
`}),f=f.slice(0,-N.length),Q+f+C};function O(x){if(x===void 0)return"";switch(w(x)){case"boolean":return"<span "+v("json-markup-bool")+">"+x+"</span>";case"number":return"<span "+v("json-markup-number")+">"+x+"</span>";case"date":return'<span class="json-markup-string">"'+r(x.toISOString())+'"</span>';case"null":return"<span "+v("json-markup-null")+">null</span>";case"string":return"<span "+v("json-markup-string")+'>"'+r(x.replace(/\n/g,`
`+f))+'"</span>';case"link":return"<span "+v("json-markup-string")+'>"<a href="'+encodeURI(x)+'">'+r(x)+'</a>"</span>';case"array":return P(x,"[","]",O);case"object":const A=Object.keys(x).filter(function(C){return x[C]!==void 0});return P(A,"{","}",function(C){return"<span "+v("json-markup-key")+'>"'+r(C)+'":</span> '+O(x[C])})}return""}return"<div "+v("json-markup")+">"+O(l)+"</div>"}const y="copyIcon",B=l=>({KeyValueTable:(0,d.css)({label:"KeyValueTable",background:(0,g.R)(l,"#fff"),border:`1px solid ${(0,g.R)(l,"#ddd")}`,marginBottom:"0.5rem",maxHeight:"450px",overflow:"auto"}),table:(0,d.css)({width:"100%"}),body:(0,d.css)({label:"body",verticalAlign:"baseline"}),row:(0,d.css)({label:"row","& > td":{padding:"0.5rem 0.5rem",height:"30px"},"&:nth-child(2n) > td":{background:(0,g.R)(l,"#f5f5f5")},[`&:not(:hover) .${y}`]:{visibility:"hidden"}}),keyColumn:(0,d.css)({label:"keyColumn",color:(0,g.R)(l,"#888"),whiteSpace:"pre",width:"125px",verticalAlign:"top"}),copyColumn:(0,d.css)({label:"copyColumn",textAlign:"right"}),linkIcon:(0,d.css)({label:"linkIcon",verticalAlign:"middle",fontWeight:"bold"}),jsonTable:(0,d.css)({display:"inline-block"})}),V=/^(\[|\{)/;function H(l){if(typeof l=="string"&&V.test(l))try{return JSON.parse(l)}catch{}return l}const W=({href:l,title:D="",children:f})=>(0,e.jsxs)("a",{href:l,title:D,target:"_blank",rel:"noopener noreferrer",children:[f," ",(0,e.jsx)(M.I,{name:"external-link-alt"})]});function Y(l){const{data:D,linksGetter:f}=l,v=(0,a.of)(B);return(0,e.jsx)("div",{className:K()(v.KeyValueTable),"data-testid":"KeyValueTable",children:(0,e.jsx)("table",{className:v.table,children:(0,e.jsx)("tbody",{className:v.body,children:D.map((P,O)=>{const x={__html:Z(H(P.value))},A=(0,e.jsx)("div",{className:v.jsonTable,dangerouslySetInnerHTML:x}),C=f?f(D,O):null;let p;return C&&C.length?p=(0,e.jsx)("div",{children:(0,e.jsx)(W,{href:C[0].url,title:C[0].text,children:A})}):p=A,(0,e.jsxs)("tr",{className:v.row,children:[(0,e.jsx)("td",{className:v.keyColumn,"data-testid":"KeyValueTable--keyColumn",children:P.key}),(0,e.jsx)("td",{children:p}),(0,e.jsx)("td",{className:v.copyColumn,children:(0,e.jsx)($,{className:y,copyText:JSON.stringify(P,null,2),tooltipTitle:"Copy JSON"})})]},`${P.key}-${O}`)})})})})}},34888:(z,S,n)=>{n.d(S,{c:()=>M});var e=n(74848),d=n(41654),L=n(27594);const K=()=>[{id:"resource",header:"Resource",cell:({row:{original:a}})=>a.resource},{id:"created",header:"Created",cell:({row:{original:a}})=>a.create?.toString()||"-"},{id:"deleted",header:"Deleted",cell:({row:{original:a}})=>a.delete?.toString()||"-"},{id:"updated",header:"Updated",cell:({row:{original:a}})=>a.update?.toString()||"-"},{id:"unchanged",header:"Unchanged",cell:({row:{original:a}})=>a.noop?.toString()||"-"},{id:"errors",header:"Errors",cell:({row:{original:a}})=>a.error?.toString()||"-"},{id:"total",header:"Total",cell:({row:{original:a}})=>((a.create||0)+(a.delete||0)+(a.update||0)+(a.noop||0)+(a.error||0)).toString()}];function M({summary:a}){return(0,e.jsx)(d.B,{direction:"column",gap:2,children:(0,e.jsx)(L.j,{data:a,columns:K(),getRowId:g=>g.resource||"",pageSize:10})})}},52524:(z,S,n)=>{n.d(S,{q:()=>i});var e=n(74848),d=n(96540),L=n(54148),K=n(76319),M=n(71599),a=n(19164),g=n(56840);function i({name:R,redirectTo:E}){const[k,$]=(0,a.So)(),[N,T]=(0,d.useState)(!1),U=(0,L.Zp)();(0,d.useEffect)(()=>{$.isSuccess&&(T(!1),E&&U(E))},[$.isSuccess,E,U]);const w=(0,d.useCallback)(()=>{k({name:R})},[k,R]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(K.K,{name:"trash-alt",tooltip:(0,g.t)("provisioning.delete-repository-button.tooltip-delete-this-repository","Delete this repository"),disabled:$.isLoading,onClick:()=>{T(!0)}}),(0,e.jsx)(M.u,{isOpen:N,title:(0,g.t)("provisioning.delete-repository-button.title-delete-repository","Delete repository config"),body:(0,g.t)("provisioning.delete-repository-button.confirm-delete-repository","Are you sure you want to delete the repository config?"),confirmText:(0,g.t)("provisioning.delete-repository-button.button-delete","Delete"),onConfirm:w,onDismiss:()=>T(!1)})]})}},6299:(z,S,n)=>{n.r(S),n.d(S,{default:()=>fe});var e=n(74848),d=n(96540),L=n(61574),K=n(54148),M=n(5556),a=n(34999),g=n(50201),i=n(66404),R=n(89640),E=n(54314),k=n(60208),$=n(13941),N=n(68079),T=n(19164),U=n(13791),w=n(70958),r=n(56840),Z=n(62939),y=n(41654),B=n(45861),V=n(12737),H=n(27594),W=n(91555);function Y({repo:s}){const t=s.metadata?.name??"",o=(0,T.Bm)({name:t}),[j,I]=(0,d.useState)(""),m=[...o.data?.items??[]].filter(c=>c.path.toLowerCase().includes(j.toLowerCase())),h=[{id:"path",header:"Path",sortType:"string",cell:({row:{original:c}})=>{const{path:u}=c;return(0,e.jsx)("a",{href:`${W.mL}/${t}/file/${u}`,children:u})}},{id:"size",header:"Size (KB)",cell:({row:{original:c}})=>{const{size:u}=c;return(parseInt(u,10)/1024).toFixed(2)},sortType:"number"},{id:"hash",header:"Hash",sortType:"string"},{id:"actions",header:"",cell:({row:{original:c}})=>{const{path:u}=c;return(0,e.jsxs)(y.B,{children:[(u.endsWith(".json")||u.endsWith(".yaml")||u.endsWith(".yml"))&&(0,e.jsx)(B.z9,{href:`${W.mL}/${t}/file/${u}`,children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.files-view.columns.view",children:"View"})}),(0,e.jsx)(B.z9,{href:`${W.mL}/${t}/history/${u}`,children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.files-view.columns.history",children:"History"})})]})}}];return o.isLoading?(0,e.jsx)(y.B,{justifyContent:"center",alignItems:"center",children:(0,e.jsx)(N.y,{})}):(0,e.jsxs)(y.B,{grow:1,direction:"column",gap:2,children:[(0,e.jsx)(y.B,{gap:2,children:(0,e.jsx)(V.Z,{placeholder:(0,r.t)("provisioning.files-view.placeholder-search","Search"),autoFocus:!0,value:j,onChange:I})}),(0,e.jsx)(H.j,{columns:h,data:m,pageSize:25,getRowId:c=>String(c.path)})]})}var l=n(34145),D=n(92784),f=n(52524),v=n(31660);function P({repository:s}){const t=s.metadata?.name??"",o=(0,D.a)(s.spec?.github);return(0,e.jsxs)(y.B,{children:[(0,e.jsx)(l.W,{repo:s}),o&&(0,e.jsx)(B.$n,{variant:"secondary",icon:"github",onClick:()=>window.open(o,"_blank"),children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-actions.source-code",children:"Source Code"})}),(0,e.jsx)(v.w,{repository:s}),(0,e.jsx)(B.z9,{variant:"secondary",icon:"cog",href:`${W.mL}/${t}/edit`,children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-actions.settings",children:"Settings"})}),(0,e.jsx)(f.q,{name:t,redirectTo:W.mL})]})}var O=n(22803),x=n(63142),A=n(31286),C=n(13943),p=n(8073),Q=n(74529),G=n(99887),X=n(30703),q=n(21961),_=n(40996);function ee(s){return s?`provisioning.grafana.app/repository=${s}`:void 0}function ne({repositoryName:s}){const t=(0,T.L3)({labelSelector:ee(s),watch:!0}),o=(0,T.qC)({name:s});(0,_.A)(()=>{o.refetch()},250,[t.data]);const j=[...t.data?.items??[],...o.data?.items??[]],I=new Intl.Collator(void 0,{numeric:!0});return[j.slice().sort((h,c)=>{const u=h.metadata?.creationTimestamp??"",b=c.metadata?.creationTimestamp??"";return I.compare(b,u)}),t,o]}var J=n(79755),se=n(34888);const te=s=>{switch(s){case"success":return"green";case"working":case"pending":return"orange";case"error":return"red";default:return"darkgrey"}},re=()=>[{id:"status",header:(0,r.t)("provisioning.recent-jobs.column-status","Status"),cell:({row:{original:s}})=>(0,e.jsx)(G.E,{text:s.status?.state||"",color:te(s.status?.state),icon:s.status?.state==="working"?"spinner":void 0})},{id:"action",header:(0,r.t)("provisioning.recent-jobs.column-action","Action"),cell:({row:{original:s}})=>s.spec?.action},{id:"started",header:(0,r.t)("provisioning.recent-jobs.column-started","Started"),cell:({row:{original:s}})=>(0,J.E)(s.status?.started)},{id:"duration",header:(0,r.t)("provisioning.recent-jobs.column-duration","Duration"),cell:({row:{original:s}})=>{const t={start:s.status?.started??0,end:s.status?.finished??Date.now()};if(!t.start)return null;const o=t.end-t.start;return o<1e3?`${o}ms`:(0,Q.dU)(t,!0)}},{id:"message",header:(0,r.t)("provisioning.recent-jobs.column-message","Message"),cell:({row:{original:s}})=>(0,e.jsx)("span",{children:s.status?.message})}];function oe({row:s}){const t=!!s.status?.summary?.length,o=!!s.status?.errors?.length,j=!!s.spec;if(!t&&!o&&!j)return null;const I=(0,d.useMemo)(()=>{const m=[],h=s.spec?.action;if(!h)return m;const c=s.spec?.[h];if(!c)return m;for(const[u,b]of Object.entries(c))m.push({key:u,value:b});return m},[s.spec]);return(0,e.jsx)(A.a,{padding:2,children:(0,e.jsxs)(y.B,{direction:"column",gap:2,children:[j&&(0,e.jsxs)(y.B,{direction:"column",children:[(0,e.jsx)(i.E,{variant:"body",color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.expanded-row.job-specification",children:"Job Specification"})}),(0,e.jsx)(q.Ay,{data:I})]}),o&&(0,e.jsx)(y.B,{direction:"column",children:s.status?.errors?.map((m,h)=>m.trim()&&(0,e.jsx)(a.F,{severity:"error",title:(0,r.t)("provisioning.expanded-row.title-error","Error"),children:(0,e.jsxs)(y.B,{alignItems:"center",gap:1,children:[(0,e.jsx)(X.I,{name:"exclamation-circle",size:"sm"}),m]})},h))}),t&&(0,e.jsxs)(y.B,{direction:"column",gap:2,children:[(0,e.jsx)(i.E,{variant:"body",color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.expanded-row.summary",children:"Summary"})}),(0,e.jsx)(se.c,{summary:s.status.summary})]})]})})}function ie(){return(0,e.jsx)(y.B,{direction:"column",alignItems:"center",children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.empty-state.no-jobs",children:"No jobs..."})})})}function ae(s,t){return(0,e.jsx)(a.F,{title:(0,r.t)("provisioning.recent-jobs.error-loading","Error loading {{type}}",{type:s}),severity:"error",children:(0,e.jsx)("pre",{children:JSON.stringify(t)})})}function le(){return(0,e.jsx)(y.B,{direction:"column",alignItems:"center",children:(0,e.jsx)(N.y,{})})}function ce({repo:s}){const[t,o,j]=ne({repositoryName:s.metadata?.name??"x"}),I=(0,d.useMemo)(()=>re(),[]);let m;return o.isLoading||j.isLoading?m=le():o.isError?m=ae((0,r.t)("provisioning.recent-jobs.active-jobs","active jobs"),o.error):t?.length?m=(0,e.jsx)(H.j,{data:t,columns:I,getRowId:h=>`${h.metadata?.uid}`,renderExpandedRow:h=>(0,e.jsx)(oe,{row:h}),pageSize:10}):m=(0,e.jsx)(ie,{}),(0,e.jsxs)(p.Z,{children:[(0,e.jsx)(p.Z.Heading,{children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.recent-jobs.jobs",children:"Jobs"})}),(0,e.jsx)(p.Z.Description,{children:m})]})}function de({repository:s}){const[t,o]=(0,T.L)(),j=s.metadata?.name,I=()=>{j&&t({name:j,body:{}})};return o.isLoading?(0,e.jsx)(N.y,{}):(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(B.$n,{icon:"check-circle",variant:"secondary",disabled:o.isLoading||!j,onClick:I,children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.check-repository.check",children:"Check"})})})}function ue({health:s}){return(0,e.jsx)(y.B,{gap:2,direction:"column",alignItems:"flex-start",children:s.healthy?(0,e.jsx)(a.F,{title:(0,r.t)("provisioning.repository-health.title-repository-is-healthy","Repository is healthy"),severity:"success",style:{width:"100%"},children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-health.no-errors-found",children:"No errors found"})}):(0,e.jsx)(a.F,{title:(0,r.t)("provisioning.repository-health.title-repository-is-unhealthy","Repository is unhealthy"),severity:"warning",style:{width:"100%"},children:s.message&&s.message.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.E,{children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-health.details",children:"Details:"})}),(0,e.jsx)("ul",{children:s.message.map(t=>(0,e.jsx)("li",{children:t},t))})]})})})}function he(s){return s?4:3}function ge({repo:s}){const t=(0,x.of)(ve),o=s.status,j=ye(s),I=he(!!s.status?.webhook),m=(0,d.useMemo)(()=>[{id:"Resource",header:"Resource Type",cell:({row:{original:h}})=>(0,e.jsx)("span",{children:h.resource}),size:"auto"},{id:"count",header:"Count",cell:({row:{original:h}})=>(0,e.jsx)("span",{children:h.count}),size:100}],[]);return(0,e.jsx)(A.a,{padding:2,children:(0,e.jsxs)(y.B,{direction:"column",gap:2,children:[(0,e.jsxs)(C.x,{columns:I,gap:2,children:[(0,e.jsx)("div",{className:t.cardContainer,children:(0,e.jsxs)(p.Z,{className:t.card,children:[(0,e.jsx)(p.Z.Heading,{children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.resources",children:"Resources"})}),(0,e.jsx)(p.Z.Description,{children:s.status?.stats?(0,e.jsx)(H.j,{columns:m,data:s.status.stats,getRowId:h=>`${h.group}-${h.resource}`}):null}),(0,e.jsx)(p.Z.Actions,{className:t.actions,children:(0,e.jsx)(B.z9,{fill:"outline",size:"md",href:pe(s),icon:"folder-open",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.view-folder",children:"View Folder"})})})]})}),s.status?.health&&(0,e.jsx)("div",{className:t.cardContainer,children:(0,e.jsxs)(p.Z,{className:t.card,children:[(0,e.jsx)(p.Z.Heading,{children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.health",children:"Health"})}),(0,e.jsxs)(p.Z.Description,{children:[(0,e.jsx)(ue,{health:s.status?.health}),(0,e.jsxs)(C.x,{columns:12,gap:1,alignItems:"baseline",children:[(0,e.jsx)("div",{className:t.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.status",children:"Status:"})})}),(0,e.jsx)("div",{className:t.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.health?.healthy?"Healthy":"Unhealthy"})}),(0,e.jsx)("div",{className:t.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.checked",children:"Checked:"})})}),(0,e.jsx)("div",{className:t.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:(0,J.E)(o?.health?.checked)})}),!!o?.health?.message?.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:t.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.messages",children:"Messages:"})})}),(0,e.jsx)("div",{className:t.valueColumn,children:(0,e.jsx)(y.B,{gap:1,children:o.health.message.map((h,c)=>(0,e.jsx)(i.E,{variant:"body",children:h},c))})})]})]})]}),(0,e.jsx)(p.Z.Actions,{className:t.actions,children:(0,e.jsx)(de,{repository:s})})]})}),(0,e.jsx)("div",{className:t.cardContainer,children:(0,e.jsxs)(p.Z,{className:t.card,children:[(0,e.jsx)(p.Z.Heading,{children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.pull-status",children:"Pull status"})}),(0,e.jsx)(p.Z.Description,{children:(0,e.jsxs)(C.x,{columns:12,gap:1,alignItems:"baseline",children:[(0,e.jsx)("div",{className:t.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.status",children:"Status:"})})}),(0,e.jsx)("div",{className:t.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.sync.state??"N/A"})}),(0,e.jsx)("div",{className:t.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.job-id",children:"Job ID:"})})}),(0,e.jsx)("div",{className:t.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.sync.job??"N/A"})}),(0,e.jsx)("div",{className:t.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.last-ref",children:"Last Ref:"})})}),(0,e.jsx)("div",{className:t.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.sync.lastRef?o.sync.lastRef.substring(0,7):"N/A"})}),(0,e.jsx)("div",{className:t.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.started",children:"Started:"})})}),(0,e.jsx)("div",{className:t.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:(0,J.E)(o?.sync.started)})}),(0,e.jsx)("div",{className:t.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.finished",children:"Finished:"})})}),(0,e.jsx)("div",{className:t.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:(0,J.E)(o?.sync.finished)})}),!!o?.sync?.message?.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:t.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.messages",children:"Messages:"})})}),(0,e.jsx)("div",{className:t.valueColumn,children:(0,e.jsx)(y.B,{gap:1,children:o.sync.message.map((h,c)=>(0,e.jsx)(i.E,{variant:"body",children:h},c))})})]})]})}),(0,e.jsx)(p.Z.Actions,{className:t.actions,children:(0,e.jsx)(v.w,{repository:s})})]})}),s.status?.webhook&&(0,e.jsx)("div",{className:t.cardContainer,children:(0,e.jsxs)(p.Z,{className:t.card,children:[(0,e.jsx)(p.Z.Heading,{children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.webhook",children:"Webhook"})}),(0,e.jsx)(p.Z.Description,{children:(0,e.jsxs)(C.x,{columns:12,gap:1,alignItems:"baseline",children:[(0,e.jsx)("div",{className:t.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.webhook-id",children:"ID:"})})}),(0,e.jsx)("div",{className:t.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.webhook?.id??"N/A"})}),(0,e.jsx)("div",{className:t.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.webhook-events",children:"Events:"})})}),(0,e.jsx)("div",{className:t.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:o?.webhook?.subscribedEvents?.join(", ")??"N/A"})}),(0,e.jsx)("div",{className:t.labelColumn,children:(0,e.jsx)(i.E,{color:"secondary",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.webhook-last-event",children:"Last Event:"})})}),(0,e.jsx)("div",{className:t.valueColumn,children:(0,e.jsx)(i.E,{variant:"body",children:(0,J.E)(o?.webhook?.lastEvent)})})]})}),j&&(0,e.jsx)(p.Z.Actions,{className:t.actions,children:(0,e.jsx)(B.z9,{fill:"outline",href:j,icon:"external-link-alt",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-overview.webhook-url",children:"View Webhook"})})})]})})]}),(0,e.jsx)("div",{className:t.cardContainer,children:(0,e.jsx)(ce,{repo:s})})]})})}function pe(s){return s.spec?.sync.target==="folder"?`/dashboards/f/${s.metadata?.name}`:"/dashboards"}const ve=()=>({cardContainer:(0,O.css)({height:"100%"}),card:(0,O.css)({height:"100%",display:"flex",flexDirection:"column"}),actions:(0,O.css)({marginTop:"auto"}),labelColumn:(0,O.css)({gridColumn:"span 3"}),valueColumn:(0,O.css)({gridColumn:"span 9"})});function ye(s){const{status:t,spec:o}=s;if(o?.type==="github"&&t?.webhook?.url&&o.github?.url)return`${o.github.url}/settings/hooks/${t.webhook?.id}`}var xe=n(20941);function me({repo:s}){const t=s.metadata?.name??"",o=(0,T.nS)({name:t}),[j,I]=(0,d.useState)(""),m=(o.data?.items??[]).filter(c=>c.path.toLowerCase().includes(j.toLowerCase())),h=(0,d.useMemo)(()=>[{id:"title",header:"Title",sortType:"string",cell:({row:{original:c}})=>{const{resource:u,name:b,title:F}=c;return u==="dashboards"?(0,e.jsx)("a",{href:`/d/${b}`,children:F}):u==="folders"?(0,e.jsx)("a",{href:`/dashboards/f/${b}`,children:F}):(0,e.jsx)("span",{children:F})}},{id:"resource",header:"Type",sortType:"string",cell:({row:{original:c}})=>(0,e.jsx)("span",{style:{textTransform:"capitalize"},children:c.resource})},{id:"path",header:"Path",sortType:"string",cell:({row:{original:c}})=>{const{resource:u,name:b,path:F}=c;return u==="dashboards"?(0,e.jsx)("a",{href:`/d/${b}`,children:F}):(0,e.jsx)("span",{children:F})}},{id:"hash",header:"Hash",sortType:"string",cell:({row:{original:c}})=>{const{hash:u}=c;return(0,e.jsx)("span",{title:u,children:u.substring(0,7)})}},{id:"folder",header:"Folder",sortType:"string",cell:({row:{original:c}})=>{const{folder:u}=c;return u?.length?(0,e.jsx)(xe.N,{href:`/dashboards/f/${u}`,children:u}):(0,e.jsx)("span",{})}},{id:"actions",header:"",cell:({row:{original:c}})=>{const{resource:u,name:b,path:F}=c;return(0,e.jsxs)(y.B,{children:[u==="dashboards"&&(0,e.jsx)(B.z9,{href:`/d/${b}`,children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-resources.columns.view-dashboard",children:"View"})}),u==="folders"&&(0,e.jsx)(B.z9,{href:`/dashboards/f/${b}`,children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-resources.columns.view-folder",children:"View"})}),(0,e.jsx)(B.z9,{href:`${W.mL}/${s.metadata?.name}/history/${F}`,children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-resources.columns.history",children:"History"})})]})}}],[s.metadata?.name]);return o.isLoading?(0,e.jsx)(y.B,{justifyContent:"center",alignItems:"center",children:(0,e.jsx)(N.y,{})}):(0,e.jsxs)(y.B,{grow:1,direction:"column",gap:2,children:[(0,e.jsx)(y.B,{gap:2,children:(0,e.jsx)(V.Z,{placeholder:(0,r.t)("provisioning.repository-resources.placeholder-search","Search"),autoFocus:!0,value:j,onChange:I})}),(0,e.jsx)(H.j,{columns:h,data:m,pageSize:25,getRowId:c=>String(c.path)})]})}var je=(s=>(s.Overview="overview",s.Resources="resources",s.Files="files",s))(je||{});function fe(){const{name:s=""}=(0,K.g)(),t=(0,T.Ih)({fieldSelector:`metadata.name=${s}`,watch:!0}),o=t.data?.items?.[0],j=(0,L.zy)(),[I]=(0,w.s)(),m=(0,T.F9)(),h=I.tab??"overview",c=t.isError&&(0,Z.E)(t.error),u=(0,d.useMemo)(()=>[{value:"overview",label:(0,r.t)("provisioning.repository-status-page.tab-overview","Overview"),title:(0,r.t)("provisioning.repository-status-page.tab-overview-title","Repository overview")},{value:"resources",label:(0,r.t)("provisioning.repository-status-page.tab-resources","Resources"),title:(0,r.t)("provisioning.repository-status-page.tab-resources-title","Resources saved in grafana database")},{value:"files",label:(0,r.t)("provisioning.repository-status-page.tab-files","Files"),title:(0,r.t)("provisioning.repository-status-page.tab-files-title","The raw file list from the repository")}],[]);return(0,e.jsx)(U.Y,{navId:"provisioning",pageNav:{text:o?.spec?.title??(0,r.t)("provisioning.repository-status-page.title","Repository Status"),subTitle:o?.spec?.description},actions:o&&(0,e.jsx)(P,{repository:o}),children:(0,e.jsxs)(U.Y.Contents,{isLoading:t.isLoading,children:[m.data?.legacyStorage&&(0,e.jsx)(a.F,{title:(0,r.t)("provisioning.repository-status-page.title-legacy-storage","Legacy Storage"),severity:"error",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-status-page.legacy-storage-message",children:"Instance is not yet running unified storage -- requires migration wizard"})}),c?(0,e.jsxs)(g.p,{message:(0,r.t)("provisioning.repository-status-page.not-found-message","Repository not found"),variant:"not-found",children:[(0,e.jsx)(i.E,{element:"p",children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-status-page.repository-config-exists-configuration",children:"Make sure the repository config exists in the configuration file."})}),(0,e.jsx)(R.Y,{href:W.mL,children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-status-page.back-to-repositories",children:"Back to repositories"})})]}):(0,e.jsx)(e.Fragment,{children:o?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(E.U,{children:u.map(b=>(0,e.jsx)(k.o,{href:M.kM.renderUrl(j.pathname,{...I,tab:b.value}),label:b.label,active:h===b.value,title:b.title},b.value))}),(0,e.jsxs)($.J,{children:[o?.metadata?.deletionTimestamp&&(0,e.jsxs)(a.F,{title:(0,r.t)("provisioning.repository-status-page.title-queued-for-deletion","Queued for deletion"),severity:"warning",children:[(0,e.jsx)(N.y,{})," ",(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-status-page.cleaning-up-resources",children:"Cleaning up repository resources"})]}),h==="overview"&&(0,e.jsx)(ge,{repo:o}),h==="resources"&&(0,e.jsx)(me,{repo:o}),h==="files"&&(0,e.jsx)(Y,{repo:o})]})]}):(0,e.jsx)("div",{children:(0,e.jsx)(r.x6,{i18nKey:"provisioning.repository-status-page.not-found",children:"not found"})})})]})})}},31660:(z,S,n)=>{n.d(S,{w:()=>R});var e=n(74848),d=n(96540),L=n(54148),K=n(45861),M=n(71599),a=n(19164),g=n(56840),i=n(91555);function R({repository:E}){const[k,$]=(0,a.bS)(),[N,T]=(0,d.useState)(!1),U=(0,L.Zp)(),w=E.metadata?.name,r=()=>{w&&(k({name:w,jobSpec:{pull:{incremental:!1}}}),T(!1))},Z=!!E.status?.health.healthy;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(K.$n,{icon:"cloud-download",variant:"secondary",tooltip:Z?void 0:(0,g.t)("provisioning.sync-repository.tooltip-unhealthy-repository","Unable to pull an unhealthy repository"),disabled:$.isLoading||!w||!Z,onClick:r,children:(0,e.jsx)(g.x6,{i18nKey:"provisioning.sync-repository.pull",children:"Pull"})}),!E.spec?.sync.enabled&&(0,e.jsx)(M.u,{isOpen:N,title:(0,g.t)("provisioning.sync-repository.title-pull-not-enabled","Pull is not enabled"),body:(0,g.t)("provisioning.sync-repository.body-edit-configuration","Edit the configuration"),confirmText:(0,g.t)("provisioning.sync-repository.button-edit","Edit"),onConfirm:()=>U(`${i.mL}/${w}/edit`),onDismiss:()=>T(!1)})]})}},34145:(z,S,n)=>{n.d(S,{W:()=>M});var e=n(74848),d=n(36490),L=n(99887),K=n(91555);function M({repo:a}){if(!a)return null;let g,i="purple",R="Unknown",E="exclamation-triangle";if(a.metadata?.deletionTimestamp)i="red",R="Deleting",E="spinner";else if(!a.spec?.sync?.enabled)i="red",R="Automatic pulling disabled",E="info-circle";else if(!a.status?.sync?.state?.length)i="orange",R="Pending",E="spinner",g="Waiting for health check to run";else switch(a.status?.sync?.state){case"success":E="check",R="Up-to-date",i="green";break;case"working":case"pending":i="orange",R="Pulling",E="spinner";break;case"error":i="red",R="Error",E="exclamation-triangle";break;default:break}return(0,e.jsx)(L.E,{color:i,icon:E,text:R,style:{cursor:"pointer"},tooltip:g,onClick:()=>{d.Ny.push(`${K.mL}/${a.metadata?.name}/?tab=overview`)}})}},79755:(z,S,n)=>{n.d(S,{E:()=>e});function e(d){return d?new Date(d).toLocaleString():"N/A"}}}]);

//# sourceMappingURL=RepositoryStatusPage.1d60a8f134b9747aae2b.js.map