"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3196],{77880:(Y,v,n)=>{n.d(v,{J:()=>U});var t=n(74848),l=n(22803),c=n(4213),E=n.n(c),x=n(96540),f=n(70713),p=n(63142),L=n(50992),B=n(45861),K=n(47931),j=n(89640),i=n(34999),y=n(56840),O=n(78102);function U({format:u,textDefinition:g,downloadFileName:M,onClose:S}){const T=(0,p.of)(F),h=O.sl[u],$=(0,x.useCallback)(()=>{const s=new Blob([g],{type:`application/${u};charset=utf-8`});E()(s,`${M}.${u}`)},[g,M,u]),_=(0,x.useMemo)(()=>h.formatter?h.formatter(g):g,[h,g]);return(0,t.jsxs)("div",{className:T.container,children:[(0,t.jsx)(z,{exportProvider:h}),(0,t.jsx)("div",{className:T.content,children:(0,t.jsx)(f.default,{disableWidth:!0,children:({height:s})=>(0,t.jsx)(L.B,{width:"100%",height:s,language:u,value:_,monacoOptions:{minimap:{enabled:!1},scrollBeyondLastLine:!1,lineNumbers:"on",readOnly:!0}})})}),(0,t.jsxs)("div",{className:T.actions,children:[(0,t.jsx)(B.$n,{variant:"secondary",onClick:S,children:(0,t.jsx)(y.x6,{i18nKey:"alerting.common.cancel",children:"Cancel"})}),(0,t.jsx)(K.b,{icon:"copy",getText:()=>g,children:(0,t.jsx)(y.x6,{i18nKey:"alerting.file-export-preview.copy-code",children:"Copy code"})}),(0,t.jsx)(B.$n,{icon:"download-alt",onClick:$,children:(0,t.jsx)(y.x6,{i18nKey:"alerting.file-export-preview.download",children:"Download"})})]})]})}const F=u=>({container:(0,l.css)({display:"flex",flexDirection:"column",height:"100%",gap:u.spacing(2)}),content:(0,l.css)({flex:"1 1 100%"}),actions:(0,l.css)({flex:0,justifyContent:"flex-end",display:"flex",gap:u.spacing(1)})});function z({exportProvider:u}){const{name:g,type:M}=u,S={file:{title:"File-provisioning format",component:(0,t.jsxs)(t.Fragment,{children:[g," format is only valid for File Provisioning."," ",(0,t.jsx)(j.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/file-provisioning/",external:!0,children:"Read more in the docs."})]})},api:{title:"API-provisioning format",component:(0,t.jsxs)(t.Fragment,{children:[g," format is only valid for API Provisioning."," ",(0,t.jsx)(j.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/http-api-provisioning/",external:!0,children:"Read more in the docs."})]})},terraform:{title:"Terraform-provisioning format",component:(0,t.jsxs)(t.Fragment,{children:[g," format is only valid for Terraform Provisioning."," ",(0,t.jsx)(j.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/terraform-provisioning/",external:!0,children:"Read more in the docs."})]})}},{title:T,component:h}=S[M];return(0,t.jsx)(i.F,{title:T,severity:"info",bottomSpacing:0,topSpacing:0,children:h})}},25149:(Y,v,n)=>{n.d(v,{m:()=>x});var t=n(74848),l=n(8207),c=n(56840),E=n(29855);function x({activeTab:f,onTabChange:p,children:L,onClose:B,formatProviders:K,title:j="Export"}){const i=Object.values(K).map(O=>({label:O.name,value:O.exportFormat})),y=K.length>1?(0,c.t)("alerting.export.subtitle.formats","Select the format and download the file or copy the contents to clipboard"):(0,c.t)("alerting.export.subtitle.one-format","Download the file or copy the contents to clipboard");return(0,t.jsx)(l._,{title:j,subtitle:y,tabs:(0,t.jsx)(E.sb,{tabs:i,setActiveTab:p,activeTab:f}),onClose:B,size:"md",children:L})}},78102:(Y,v,n)=>{n.d(v,{dX:()=>c,sl:()=>E});const t={name:"JSON",exportFormat:"json",type:"file",formatter:f=>{try{return JSON.stringify(JSON.parse(f),null,4)}catch{return f}}},l={name:"YAML",exportFormat:"yaml",type:"file"},c={name:"Terraform (HCL)",exportFormat:"hcl",type:"terraform"},E={[t.exportFormat]:t,[l.exportFormat]:l,[c.exportFormat]:c},x=[t,l]},29855:(Y,v,n)=>{n.d(v,{G_:()=>g,sb:()=>M});var t=n(74848),l=n(22803),c=n(20382),E=n(96540),x=n(49785),f=n(70713),p=n(63142),L=n(8207),B=n(54314),K=n(60208),j=n(45861),i=n(45967),y=n(30703),O=n(50992),U=n(56840),F=n(20437),z=n(29609);const u=[{label:"Yaml",value:"yaml"}],g=({onClose:s})=>{const[R,C]=(0,E.useState)("yaml"),{setValue:m}=(0,x.xW)(),I=(0,p.of)(_),P=D=>{for(const W in D)m(W,D[W]);s()};return(0,t.jsx)(L._,{title:(0,U.t)("alerting.rule-inspector.title-inspect-alert-rule","Inspect Alert rule"),subtitle:(0,t.jsx)("div",{className:I.subtitle,children:(0,t.jsx)(M,{tabs:u,setActiveTab:C,activeTab:R})}),onClose:s,children:R==="yaml"&&(0,t.jsx)(S,{onSubmit:P})})};function M({tabs:s,activeTab:R,setActiveTab:C}){return(0,t.jsx)(B.U,{children:s.map((m,I)=>(0,t.jsx)(K.o,{label:m.label,value:m.value,onChangeTab:()=>C(m.value),active:R===m.value},`${m.value}-${I}`))})}const S=({onSubmit:s})=>{const R=(0,p.of)($),{getValues:C}=(0,x.xW)(),m=(0,F.l1)(C()),[I,P]=(0,E.useState)((0,c.Bh)(m)),D=()=>{const W=(0,c.Hh)(I),Z=C(),b=h(W);s({...Z,...b})};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:R.applyButton,children:[(0,t.jsx)(j.$n,{type:"button",onClick:D,children:(0,t.jsx)(U.x6,{i18nKey:"alerting.inspector-yaml-tab.apply",children:"Apply"})}),(0,t.jsx)(i.m,{content:(0,t.jsx)(T,{}),theme:"info",placement:"left-start",interactive:!0,children:(0,t.jsx)(y.I,{name:"exclamation-triangle",size:"xl"})})]}),(0,t.jsx)("div",{className:R.content,children:(0,t.jsx)(f.default,{disableWidth:!0,children:({height:W})=>(0,t.jsx)(O.B,{width:"100%",height:W,language:"yaml",value:I,onBlur:P,monacoOptions:{minimap:{enabled:!1}}})})})]})};function T(){return(0,t.jsxs)("div",{children:["The YAML content in the editor only contains alert rule configuration ",(0,t.jsx)("br",{}),"To configure Prometheus, you need to provide the rest of the"," ",(0,t.jsx)("a",{href:"https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/",target:"_blank",rel:"noreferrer",children:"configuration file content."})]})}function h(s){return z.p.dataSource.alertingRule(s)?(0,F.Qk)(s):z.p.dataSource.recordingRule(s)?(0,F.XI)(s):{}}const $=s=>({content:(0,l.css)({flexGrow:1,height:"100%",paddingBottom:"16px",marginBottom:s.spacing(2)}),applyButton:(0,l.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexGrow:0,marginBottom:s.spacing(2)})}),_=()=>({subtitle:(0,l.css)({display:"flex",alignItems:"center",justifyContent:"space-between"})})},12003:(Y,v,n)=>{n.r(v),n.d(v,{default:()=>ct});var t=n(74848),l=n(10378),c=n(96540),E=n(54148),x=n(89640),f=n(34999),p=n(45861),L=n(66404),B=n(99887),K=n(36303),j=n(1506),i=n(56840),y=n(86791),O=n(24619),U=n(70327),F=n(55143),z=n(36826),u=n(6106),g=n(6975),M=n(77880),S=n(25149),T=n(78102);function h({folderUid:a,groupName:o,onClose:e}){const[r,d]=(0,c.useState)("yaml");return(0,t.jsx)(S.m,{title:`Export ${o} rules`,activeTab:r,onTabChange:d,onClose:e,formatProviders:Object.values(T.sl),children:(0,t.jsx)($,{folderUid:a,groupName:o,exportFormat:r,onClose:e})})}function $({folderUid:a,groupName:o,exportFormat:e,onClose:r}){const{currentData:d="",isFetching:J}=U.hK.endpoints.exportRules.useQuery({folderUid:a,group:o,format:e});return J?(0,t.jsx)(g._,{text:(0,i.t)("alerting.grafana-rule-group-export-preview.text-loading","Loading....")}):(0,t.jsx)(M.J,{format:e,textDefinition:d,downloadFileName:o,onClose:r})}var _=n(18404),s=n(84523),R=n(88721),C=n(52161),m=n(77256),I=n(29442),P=n(29609),D=n(15629),W=n(41654),Z=n(39187);const b=({name:a})=>{const{returnTo:o}=(0,Z.h)("/alerting/list");return(0,t.jsxs)(W.B,{direction:"row",gap:1,minWidth:0,alignItems:"center",children:[(0,t.jsx)(p.z9,{variant:"secondary",icon:"angle-left",href:o}),(0,t.jsx)(L.E,{element:"h1",truncate:!0,children:a})]})},{useDiscoverDsFeaturesQuery:nt}=F.L,{usePrometheusRuleNamespacesQuery:et,useGetRuleGroupForNamespaceQuery:at}=U.hK;function rt(){const{dataSourceUid:a="",namespaceId:o="",groupName:e=""}=(0,E.g)(),r=a===C.hY,{folder:d,loading:J}=(0,_.a)(r?o:""),{data:A,isLoading:Q,error:V}=nt({uid:r?y.l$:a}),{data:G,isLoading:w,error:H}=et(A&&!A.rulerConfig?{ruleSourceName:A?.name??"",namespace:o,groupName:e}:l.hT,{selectFromResult:X=>({...X,data:X.data?.[0]?.groups.find(pt=>pt.name===e)})}),{data:N,isLoading:dt,error:q}=at(A?.rulerConfig?{rulerConfig:A?.rulerConfig,namespace:o,group:e}:l.hT),ut=J||Q||w||dt,gt=G?.interval?(0,D.an)(G.interval*1e3):N?.interval??s.T6,tt=d?.title??o,mt=(0,I.tx)([["namespace",tt]]),vt=r?(0,i.t)("alerting.group-details.folder","Folder"):(0,i.t)("alerting.group-details.namespace","Namespace"),ft=d?(0,t.jsx)(x.Y,{href:(0,m.NH)(d.uid),inline:!1,children:d.title}):o;return(0,t.jsx)(z.d,{pageNav:{text:e,parentItem:{text:tt,url:mt}},renderTitle:X=>(0,t.jsx)(b,{name:X}),info:[{label:vt,value:ft},{label:(0,i.t)("alerting.group-details.interval","Interval"),value:gt}],navId:"alert-list",isLoading:ut,actions:(0,t.jsx)(t.Fragment,{children:A&&(0,t.jsx)(ot,{dsFeatures:A,namespaceId:o,groupName:e,folder:d,rulerGroup:N})}),children:(0,t.jsxs)(t.Fragment,{children:[!!V&&(0,t.jsx)(f.F,{title:(0,i.t)("alerting.group-details.ds-features-error","Error loading data source details"),bottomSpacing:0,topSpacing:2,children:(0,t.jsx)("div",{children:(0,m.JZ)(V)})}),!!(H||q)&&(0,t.jsx)(f.F,{title:(0,i.t)("alerting.group-details.group-loading-error","Error loading the group"),bottomSpacing:0,topSpacing:2,children:(0,t.jsx)("div",{children:(0,m.JZ)(H||q)})}),G&&(0,t.jsx)(k,{group:lt(G)}),N&&(0,t.jsx)(k,{group:it(N)}),!G&&!N&&(0,t.jsx)(j.L,{entity:`${o}/${e}`})]})})}function ot({dsFeatures:a,namespaceId:o,groupName:e,folder:r,rulerGroup:d}){const{canEditRules:J}=(0,R.V)(),[A,Q]=(0,c.useState)(!1),V=a.uid===C.hY,G=V?!!r?.canSave:!0,w=d?(0,P.YN)(d):!1,H=d?(0,P.oI)(d):!1,N=!!a.rulerConfig&&J(a.name)&&G&&!w&&!H;return(0,t.jsxs)(t.Fragment,{children:[V&&(0,t.jsx)(p.$n,{onClick:()=>Q(!0),icon:"file-download",variant:"secondary",children:(0,t.jsx)(i.x6,{i18nKey:"alerting.group-details.export",children:"Export"})}),N&&(0,t.jsx)(p.z9,{icon:"pen",href:I.TN.editPageLink(a.uid,o,e,{includeReturnTo:!0}),variant:"secondary",children:(0,t.jsx)(i.x6,{i18nKey:"alerting.group-details.edit",children:"Edit"})}),r&&A&&(0,t.jsx)(h,{folderUid:r.uid,groupName:e,onClose:()=>Q(!1)})]})}function k({group:a}){return(0,t.jsx)("div",{children:(0,t.jsx)(st,{rules:a.rules})})}function st({rules:a}){const o=a.map((r,d)=>({id:d,data:r})),e=(0,c.useMemo)(()=>[{id:"alertName",label:(0,i.t)("alerting.group-details.rule-name","Rule name"),renderCell:({data:r})=>(0,t.jsx)(L.E,{truncate:!0,children:r.name}),size:.4},{id:"for",label:(0,i.t)("alerting.group-details.pending-period","Pending period"),renderCell:({data:r})=>{switch(r.type){case"alerting":return(0,t.jsx)(t.Fragment,{children:r.pendingPeriod});case"recording":return(0,t.jsx)(B.E,{text:(0,i.t)("alerting.group-details.recording","Recording"),color:"purple"})}},size:.3},{id:"numberEvaluations",label:(0,i.t)("alerting.group-details.evaluations-to-fire","Evaluation cycles to fire"),renderCell:({data:r})=>{switch(r.type){case"alerting":return(0,t.jsx)(t.Fragment,{children:r.evaluationsToFire});case"recording":return null}},size:.3}],[]);return(0,t.jsx)(u.E,{items:o,cols:e})}function lt(a){const o=a.interval*1e3;return{name:a.name,interval:(0,D.an)(a.interval*1e3),rules:a.rules.map(e=>{switch(e.type){case O.JS.Alerting:return{name:e.name,type:"alerting",pendingPeriod:(0,D.an)(e.duration?e.duration*1e3:0),evaluationsToFire:(0,P.Cl)(e.duration?e.duration*1e3:0,o)};case O.JS.Recording:return{name:e.name,type:"recording"}}})}}function it(a){const o=(0,D.P8)(a.interval??s.T6);return{name:a.name,interval:a.interval??s.T6,rules:a.rules.map(e=>{const r=(0,P.qz)(e);return P.p.any.alertingRule(e)?{name:r,type:"alerting",pendingPeriod:e.for??"0s",evaluationsToFire:(0,P.Cl)(e.for?(0,D.P8)(e.for):0,o)}:{name:r,type:"recording"}})}}const ct=(0,K.Xc)(rt,{style:"page"})},88721:(Y,v,n)=>{n.d(v,{V:()=>c});var t=n(96540),l=n(54);function c(){return(0,t.useMemo)(()=>(0,l.Q9)(),[])}}}]);

//# sourceMappingURL=AlertingGroupDetails.9a98bfe4dda33a61772e.js.map