"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7666],{75285:(En,Se,f)=>{f.r(Se),f.d(Se,{RuleListActions:()=>pt,default:()=>Cn});var o=f(74848),v=f(96540),B=f(87063),P=f(41654),$=f(45861),Ae=f(88559),O=f(30703),j=f(56840),gt=f(36826),ht=f(43173),yt=f(25833);const xt=(0,v.lazy)(()=>f.e(1853).then(f.bind(f,71853))),vt=e=>{const r=ht.$.featureToggles.alertingFilterV2;return(0,o.jsx)(v.Suspense,{children:r?(0,o.jsx)(xt,{...e}):(0,o.jsx)(yt.A,{...e})})};var V=f(16692),jt=f(96784),bt=f(20962),d=f(31635);function wt(e,r,a){if(typeof r>"u")return e;switch(a){case 0:return function(){return e.call(r)};case 1:return function(n){return e.call(r,n)};case 2:return function(n,s){return e.call(r,n,s)};case 3:return function(n,s,l){return e.call(r,n,s,l)};default:return function(){return e.apply(r,arguments)}}}function Mn(e){return e}function Q(e){return(0,d.__awaiter)(this,void 0,void 0,function*(){return e})}const Rt=e=>typeof e=="number",Le=e=>typeof e=="boolean",I=e=>typeof e=="function",T=e=>e!=null&&Object(e)===e,ue=e=>T(e)&&I(e.then);function Ne(e){return T(e)&&Rt(e.length)}function Ie(e){return e!=null&&I(e[Symbol.iterator])}function Gt(e){return T(e)&&!I(e[Symbol.iterator])&&I(e.next)}function Fe(e){return T(e)&&I(e[Symbol.asyncIterator])}function Pe(e){return e!=null&&Object(e)===e&&typeof e.subscribe=="function"}const St=e=>T(e)&&I(e.pipe)&&I(e._read)&&Le(e.readable)&&T(e._readableState),At=e=>T(e)&&I(e.end)&&I(e._write)&&Le(e.writable)&&T(e._writableState),Lt=e=>T(e)&&I(e.cancel)&&I(e.getReader),Dn=e=>T(e)&&I(e.abort)&&I(e.getWriter),Bn=e=>T(e)&&Lt(e.body);function Nt(e){const r=Number(e);return isNaN(r)?0:r===0||!isFinite(r)?r:(r>0?1:-1)*Math.floor(Math.abs(r))}const It=Math.pow(2,53)-1;function Ft(e){const r=Nt(e);return Math.min(Math.max(r,0),It)}class W extends Error{constructor(r="The operation has been aborted"){super(r),Object.setPrototypeOf(this,W.prototype),Error.captureStackTrace(this,this.constructor),this.name="AbortError"}get[Symbol.toStringTag](){return"AbortError"}}function C(e){if(e&&e.aborted)throw new W}Object.defineProperty(W,Symbol.hasInstance,{writable:!0,configurable:!0,value(e){return T(e)&&(e.constructor.name==="AbortError"||e[Symbol.toStringTag]==="AbortError")}});class G{forEach(r,a,n){var s,l,u,i;return(0,d.__awaiter)(this,void 0,void 0,function*(){const c=n?new Te(this,n):this;let m=0;try{for(var p=!0,g=(0,d.__asyncValues)(c),h;h=yield g.next(),s=h.done,!s;p=!0){i=h.value,p=!1;const y=i;yield r.call(a,y,m++,n)}}catch(y){l={error:y}}finally{try{!p&&!s&&(u=g.return)&&(yield u.call(g))}finally{if(l)throw l.error}}})}pipe(...r){let a=-1;const n=r.length;let s=this;for(;++a<n;)s=r[a](G.as(s));return s}static from(r,a=Q,n){const s=wt(a,n,2);if(Ie(r)||Fe(r))return new de(r,s);if(ue(r))return new Ce(r,s);if(Pe(r))return new Ee(r,s);if(Ne(r))return new te(r,s);if(Gt(r))return new de({[Symbol.asyncIterator]:()=>r},s);throw new TypeError("Input type not supported")}static as(r){return r instanceof G?r:typeof r=="string"?new te([r],Q):Ie(r)||Fe(r)?new de(r,Q):ue(r)?new Ce(r,Q):Pe(r)?new Ee(r,Q):Ne(r)?new te(r,Q):new te([r],Q)}}G.prototype[Symbol.toStringTag]="AsyncIterableX",Object.defineProperty(G,Symbol.hasInstance,{writable:!0,configurable:!0,value(e){return!!(e&&e[Symbol.toStringTag]==="AsyncIterableX")}});const Pt="value",ce="error";class Ct{constructor(){this._ended=!1,this._values=[],this._resolvers=[]}[Symbol.asyncIterator](){return this}write(r){this._push({type:Pt,value:r})}error(r){this._push({type:ce,error:r})}_push(r){if(this._ended)throw new Error("AsyncSink already ended");if(this._resolvers.length>0){const{resolve:a,reject:n}=this._resolvers.shift();r.type===ce?n(r.error):a({done:!1,value:r.value})}else this._values.push(r)}next(){if(this._values.length>0){const{type:r,value:a,error:n}=this._values.shift();return r===ce?Promise.reject(n):Promise.resolve({done:!1,value:a})}return this._ended?Promise.resolve({done:!0}):new Promise((r,a)=>{this._resolvers.push({resolve:r,reject:a})})}end(){for(;this._resolvers.length>0;)this._resolvers.shift().resolve({done:!0});this._ended=!0}}class te extends G{constructor(r,a){super(),this._source=r,this._selector=a}[Symbol.asyncIterator](){return(0,d.__asyncGenerator)(this,arguments,function*(){let a=0;const n=Ft(this._source.length);for(;a<n;)yield yield(0,d.__await)(yield(0,d.__await)(this._selector(this._source[a],a++)))})}}class de extends G{constructor(r,a){super(),this._source=r,this._selector=a}[Symbol.asyncIterator](r){return(0,d.__asyncGenerator)(this,arguments,function*(){var n,s,l,u,i,c,m,p;let g=0;if(r&&this._source instanceof G)try{for(var h=!0,y=(0,d.__asyncValues)(new Te(this._source,r)),x;x=yield(0,d.__await)(y.next()),n=x.done,!n;h=!0){u=x.value,h=!1;const w=u;yield yield(0,d.__await)(yield(0,d.__await)(this._selector(w,g++)))}}catch(w){s={error:w}}finally{try{!h&&!n&&(l=y.return)&&(yield(0,d.__await)(l.call(y)))}finally{if(s)throw s.error}}else{C(r);try{for(var b=!0,R=(0,d.__asyncValues)(this._source),S;S=yield(0,d.__await)(R.next()),i=S.done,!i;b=!0){p=S.value,b=!1;const w=p;C(r);const L=yield(0,d.__await)(this._selector(w,g++));C(r),yield yield(0,d.__await)(L)}}catch(w){c={error:w}}finally{try{!b&&!i&&(m=R.return)&&(yield(0,d.__await)(m.call(R)))}finally{if(c)throw c.error}}}})}}class Ce extends G{constructor(r,a){super(),this._source=r,this._selector=a}[Symbol.asyncIterator](){return(0,d.__asyncGenerator)(this,arguments,function*(){const a=yield(0,d.__await)(this._source);yield yield(0,d.__await)(yield(0,d.__await)(this._selector(a,0)))})}}class Ee extends G{constructor(r,a){super(),this._observable=r,this._selector=a}[Symbol.asyncIterator](r){return(0,d.__asyncGenerator)(this,arguments,function*(){C(r);const n=new Ct,s=this._observable.subscribe({next(i){n.write(i)},error(i){n.error(i)},complete(){n.end()}});function l(){n.error(new W)}r&&r.addEventListener("abort",l);let u=0;try{for(let i;!(i=yield(0,d.__await)(n.next())).done;)C(r),yield yield(0,d.__await)(yield(0,d.__await)(this._selector(i.value,u++)))}finally{r&&r.removeEventListener("abort",l),s.unsubscribe()}})}}class Te{constructor(r,a){this._source=r,this._signal=a}[Symbol.asyncIterator](){return this._source[Symbol.asyncIterator](this._signal)}}try{(e=>{if(e)return;G.prototype.pipe=a;const r=(n,s=n._writableState||{objectMode:!0})=>s;function a(...n){let s=-1,l;const u=n.length;let i=this,c;for(;++s<u;)if(c=n[s],typeof c=="function")i=c(G.as(i));else if(At(c))return{end:l=!0}=n[s+1]||{},St(i)?i.pipe(c,{end:l}):G.as(i).toNodeStream(r(c)).pipe(c,{end:l});return i}})(typeof window=="object"&&typeof document=="object"&&document.nodeType===9)}catch{}const $n=G.as,Me=G.from;function Et(e,r){return new Promise((a,n)=>{r&&r.aborted&&n(new W);const s=setTimeout(()=>{if(r&&(r.removeEventListener("abort",l),r.aborted)){l();return}a()},e);r&&r.addEventListener("abort",l,{once:!0});function l(){clearTimeout(s),n(new W)}})}class Tt extends G{constructor(r){super(),this._dueTime=r}[Symbol.asyncIterator](r){return(0,d.__asyncGenerator)(this,arguments,function*(){C(r);let n=0;for(;;)yield(0,d.__await)(Et(this._dueTime,r)),yield yield(0,d.__await)(n++)})}}function Mt(e){return new Tt(e)}class re extends G{constructor(r,a){super(),this._source=r,this._signal=a}withAbort(r){return new re(this._source,r)}[Symbol.asyncIterator](){return this._source[Symbol.asyncIterator](this._signal)}}function De(e){return function(a){return new re(a,e)}}function U(e,r){return r?new re(e,r):e}class Be extends G{constructor(r){super(),this._source=r}[Symbol.asyncIterator](r){return(0,d.__asyncGenerator)(this,arguments,function*(){var n,s,l,u;C(r);for(const p of this._source)try{for(var i=!0,c=(s=void 0,(0,d.__asyncValues)(U(p,r))),m;m=yield(0,d.__await)(c.next()),n=m.done,!n;i=!0){u=m.value,i=!1;const g=u;yield yield(0,d.__await)(g)}}catch(g){s={error:g}}finally{try{!i&&!n&&(l=c.return)&&(yield(0,d.__await)(l.call(c)))}finally{if(s)throw s.error}}})}}function On(e){return new Be(e)}function Dt(...e){return new Be(e)}class Bt extends G{constructor(r){super(),this._args=r}[Symbol.asyncIterator](r){return(0,d.__asyncGenerator)(this,arguments,function*(){C(r);for(const n of this._args)yield yield(0,d.__await)(n)})}}function $t(...e){return new Bt(e)}class Ot extends G{constructor(r,a,n){super(),this._source=r,this._selector=a,this._thisArg=n}[Symbol.asyncIterator](r){return(0,d.__asyncGenerator)(this,arguments,function*(){var n,s,l,u;C(r);let i=0;try{for(var c=!0,m=(0,d.__asyncValues)(U(this._source,r)),p;p=yield(0,d.__await)(m.next()),n=p.done,!n;c=!0){u=p.value,c=!1;const g=u,h=yield(0,d.__await)(this._selector.call(this._thisArg,g,i++,r));yield yield(0,d.__await)(h)}}catch(g){s={error:g}}finally{try{!c&&!n&&(l=m.return)&&(yield(0,d.__await)(l.call(m)))}finally{if(s)throw s.error}}})}}function Wt(e,r){return function(n){return new Ot(n,e,r)}}function $e(e){return e===null||typeof e!="object"&&typeof e!="function"}const fe=new WeakMap;function Ut(e){let r;return new Promise((n,s)=>{r={resolve:n,reject:s};for(const l of e){if($e(l)){Promise.resolve(l).then(n,s);continue}let u=fe.get(l);u===void 0?(u={deferreds:new Set([r]),settled:!1},fe.set(l,u),Promise.resolve(l).then(i=>{for(const{resolve:c}of u.deferreds)c(i);u.deferreds.clear(),u.settled=!0},i=>{for(const{reject:c}of u.deferreds)c(i);u.deferreds.clear(),u.settled=!0})):u.settled?Promise.resolve(l).then(n,s):u.deferreds.add(r)}}).finally(()=>{for(const n of e)$e(n)||fe.get(n).deferreds.delete(r)})}const zt=new Promise(()=>{});function Oe(e,r){return e.then(({value:a,done:n})=>({value:a,done:n,index:r})).catch(a=>({error:a,index:r}))}class Qt extends G{constructor(r){super(),this._source=r}[Symbol.asyncIterator](r){return(0,d.__asyncGenerator)(this,arguments,function*(){C(r);const n=this._source.length,s=new Array(n),l=new Array(n);let u=n;for(let i=0;i<n;i++){const c=U(this._source[i],r)[Symbol.asyncIterator]();s[i]=c,l[i]=Oe(c.next(),i)}for(;u>0;){const i=yield(0,d.__await)(Ut(l));if(i.hasOwnProperty("error"))throw i.error;if(i.done)l[i.index]=zt,u--;else{const c=s[i.index];l[i.index]=Oe(c.next(),i.index),yield yield(0,d.__await)(i.value)}}})}}function We(e,...r){return new Qt([e,...r])}const me={},Ue={};class Vt extends G{constructor(r,a,n){super(),this.source=r,this.bufferSize=a,this.maxWaitTime=n}[Symbol.asyncIterator](r){return(0,d.__asyncGenerator)(this,arguments,function*(){var n,s,l,u;const i=[],c=Mt(this.maxWaitTime).pipe(Wt(()=>me)),m=Dt(this.source,$t(Ue)),p=We(m,c);try{for(var g=!0,h=(0,d.__asyncValues)(U(p,r)),y;y=yield(0,d.__await)(h.next()),n=y.done,!n;g=!0){u=y.value,g=!1;const x=u;if(x===Ue)break;x!==me&&i.push(x),(i.length>=this.bufferSize||i.length&&x===me)&&(yield yield(0,d.__await)(i.slice()),i.length=0)}}catch(x){s={error:x}}finally{try{!g&&!n&&(l=h.return)&&(yield(0,d.__await)(l.call(h)))}finally{if(s)throw s.error}}i.length&&(yield yield(0,d.__await)(i))})}}function Kt(e,r){return function(n){return new Vt(n,e,r)}}const K=e=>{};function Yt(e,r,a){const n=e;return n&&typeof n=="object"?{next:I(n.next)?s=>n.next(s):K,error:I(n.error)?s=>n.error(s):K,complete:I(n.complete)?()=>n.complete():K}:{next:I(e)?e:K,error:I(r)?r:K,complete:I(a)?a:K}}function Wn(e){typeof e?.return=="function"&&e.return()}function pe(e){return(0,d.__awaiter)(this,void 0,void 0,function*(){typeof e?.return=="function"&&(yield e.return())})}class Ht extends G{constructor(r,a){super(),this._source=r,this._observer=a}[Symbol.asyncIterator](r){return(0,d.__asyncGenerator)(this,arguments,function*(){C(r);const n=this._observer,s=this._source[Symbol.asyncIterator](r);try{for(let l;!(l=yield(0,d.__await)(s.next())).done;)n.next&&(yield(0,d.__await)(n.next(l.value))),yield yield(0,d.__await)(l.value);n.complete&&(yield(0,d.__await)(n.complete()))}catch(l){throw!(l instanceof W)&&n.error&&(yield(0,d.__await)(n.error(l))),l}finally{yield(0,d.__await)(pe(s))}})}}function Zt(e,r,a){return function(s){return new Ht(s,Yt(e,r,a))}}var Jt=f(64305),kt=f(50201),Xt=f(74268),ne=f(80218),F=f(94646),ge=f(10378),Y=f(70327),ae=f(55143),A=f(29609),he=f(24619),oe=f(95443),ye=f(92367),D=f(4956);function xe({rule:e,rulerRule:r,groupIdentifier:a,application:n,actions:s}){const{rulesSource:l,namespace:u,groupName:i}=a,c=r?(0,F.P1)(l.name,u.name,i,r):(0,F.Lg)(l.name,u.name,i,e),m=_t(c),p=(0,A.uo)(e),g=r?(0,A.qz)(r):e.name,h=r?r.labels:e.labels,y={name:g,rulesSource:l,application:n,group:i,namespace:u.name,href:m,health:e.health,error:e.lastError,labels:h,actions:s,origin:p};switch(e.type){case he.JS.Alerting:const b=((A.p.any.alertingRule(r)?r.annotations:e.annotations)??{})[oe.YH.summary];return(0,o.jsx)(D.WG,{...y,summary:b,state:e.state,instancesCount:e.alerts?.length});case he.JS.Recording:return(0,o.jsx)(D.nh,{...y});default:return(0,o.jsx)(D.Om,{ruleName:g,groupIdentifier:a,ruleDefinition:e})}}function _t(e,r){const a=encodeURIComponent((0,F.$9)(e)),n=encodeURIComponent(e.ruleSourceName);return(0,ye.G)(`/alerting/${n}/${a}/view`,r?{returnTo:r}:{})}var qt=f(94380),er=f(53567),tr=f(14050),rr=f(2218);function ve({compact:e,rule:r,promRule:a,groupIdentifier:n}){const s=!e,[l,u]=(0,er.w)(s),[i,c]=(0,v.useState)(!1),[m,p]=(0,v.useState)(void 0),g=(0,A.Nv)(r),[h,y]=(0,V.mW)(r,n,V.j5.Update),x=h&&y,b=[],R=e?"sm":"md",S=F.co(n,r);if(x){const w=(0,ye.G)(`/alerting/${encodeURIComponent(F.$9(S))}/edit`);b.push((0,o.jsx)($.z9,{title:(0,j.t)("alerting.rule-actions-buttons.title-edit","Edit"),size:R,variant:"secondary",icon:"pen",href:w,children:(0,o.jsx)(j.x6,{i18nKey:"common.edit",children:"Edit"})},"edit"))}return(0,o.jsxs)(P.B,{gap:1,alignItems:"center",wrap:"nowrap",children:[b,(0,o.jsx)(qt.A,{buttonSize:R,rulerRule:r,promRule:a,groupIdentifier:n,identifier:S,handleDelete:()=>u(S,n),handleSilence:()=>c(!0),handleDuplicateRule:()=>p({identifier:S,isProvisioned:g})}),l,A.p.grafana.alertingRule(r)&&i&&(0,o.jsx)(rr.A,{rulerRule:r,onClose:()=>c(!1)}),m?.identifier&&(0,o.jsx)(tr.Z,{identifier:m.identifier,isProvisioned:m.isProvisioned,onDismiss:()=>p(void 0)})]})}var se=f(70255);function je(){return(0,o.jsx)(se.A,{width:50,height:16})}function nr(e,r){const a=e.rules.filter(l=>(0,A.qz)(l)===r.name);if(a.length===1)return a[0];const n=a.filter(l=>(0,F.vL)(l,!1).join("-")===(0,F.Tn)(r,!1).join("-"));if(n.length===1)return n[0];const s=a.filter(l=>(0,F.vL)(l,!0).join("-")===(0,F.Tn)(r,!0).join("-"));if(s.length===1)return s[0]}function ar(e,r){const a=e.rules.filter(l=>l.name===(0,A.qz)(r));if(a.length===1)return a[0];const n=a.filter(l=>(0,F.Tn)(l,!1).join("-")===(0,F.vL)(r,!1).join("-"));if(n.length===1)return n[0];const s=a.filter(l=>(0,F.Tn)(l,!0).join("-")===(0,F.vL)(r,!0).join("-"));if(s.length===1)return s[0]}function or(e,r){const a=e.rules.reduce((n,s)=>{const{matches:l,unmatchedPromRules:u}=n,i=ar(r,s);return i&&(l.set(s,i),u.delete(i)),n},{matches:new Map,unmatchedPromRules:new Set(r.rules)});return{matches:a.matches,promOnlyRules:Array.from(a.unmatchedPromRules)}}const{useDiscoverDsFeaturesQuery:sr}=ae.L,{useGetRuleGroupForNamespaceQuery:ir}=Y.hK,lr=(0,v.memo)(function({rule:r,groupIdentifier:a}){const{rulesSource:n,namespace:s,groupName:l}=a,{data:u}=sr({uid:n.uid}),{isLoading:i,data:c}=ir(u?.rulerConfig?{namespace:s.name,group:l,rulerConfig:u?.rulerConfig}:ge.hT),m=(0,v.useMemo)(()=>{if(c&&(0,A.x6)(c))return nr(c,r)},[c,r]),p=(0,v.useMemo)(()=>i?(0,o.jsx)(je,{}):m?(0,o.jsx)(ve,{rule:m,promRule:r,groupIdentifier:a,compact:!0}):null,[a,i,r,m]);return(0,o.jsx)(xe,{rule:r,rulerRule:m,groupIdentifier:a,application:u?.application,actions:p})});var ur=f(8073),H=f(66404);function cr({state:e,numberOfRules:r,onCancel:a}){return(0,o.jsxs)(ur.Z,{children:[(0,o.jsxs)(H.E,{color:"secondary",children:[e==="done"&&(0,o.jsxs)(j.x6,{i18nKey:"alerting.rule-list.filter-view.no-more-results",children:["No more results \u2013 found ",{numberOfRules:r}," rules"]}),e==="aborted"&&(0,o.jsxs)(j.x6,{i18nKey:"alerting.rule-list.filter-view.results-with-cancellation",children:["Search cancelled \u2013 found ",{numberOfRules:r}," rules"]}),e==="searching"&&(0,o.jsxs)(j.x6,{i18nKey:"alerting.rule-list.filter-view.results-loading",children:["Searching \u2013 found ",{numberOfRules:r}," rules"]})]}),e==="searching"&&(0,o.jsx)($.$n,{variant:"secondary",size:"sm",onClick:()=>a(),children:(0,j.t)("alerting.rule-list.filter-view.cancel-search","Cancel search")})]})}var Z=f(34999),E=f(52161),ze=f(51592),X=f(87672);function _(){return(0,o.jsx)(ze.c,{title:(0,o.jsx)(se.A,{width:64}),icon:(0,o.jsx)(X.c,{isPaused:!1}),description:(0,o.jsx)(se.A,{width:256}),actions:(0,o.jsx)(je,{}),"data-testid":"alert-rule-list-item-loader"})}function dr({rule:e}){return(0,o.jsx)(ze.c,{title:e.name,description:(0,j.t)("alerting.rule-list.rulerrule-loading-error","Failed to load the rule"),"data-testid":"ruler-rule-loading-error"})}const{useGetGrafanaRulerGroupQuery:fr}=Y.hK;function mr({rule:e,groupIdentifier:r,namespaceName:a}){const{data:n,isError:s,isLoading:l}=fr({folderUid:r.namespace.uid,groupName:r.groupName}),u=n?.rules.find(i=>i.grafana_alert.uid===e.uid);return s?(0,o.jsx)(dr,{rule:e}):l?(0,o.jsx)(_,{}):u?(0,o.jsx)(be,{rule:e,rulerRule:u,groupIdentifier:r,namespaceName:a}):(0,o.jsx)(Z.F,{title:(0,j.t)("alerting.rule-list.cannot-load-rule-details-for","Cannot load rule details for {{name}}",{name:e.name}),severity:"error",children:(0,o.jsxs)(j.x6,{i18nKey:"alerting.rule-list.cannot-find-rule-details-for",children:["Cannot find rule details for ",{uid:e.uid??"<empty uid>"}]})})}function be({rule:e,rulerRule:r,groupIdentifier:a,namespaceName:n,operation:s}){const{grafana_alert:{uid:l,title:u,provenance:i,is_paused:c},annotations:m={},labels:p={}}=r,g={name:u,rulesSource:E.r6,group:a.groupName,namespace:n,href:(0,ye.G)(`/alerting/grafana/${l}/view`),health:e?.health,error:e?.lastError,labels:p,isProvisioned:!!i,isPaused:c,application:"grafana",actions:(0,o.jsx)(ve,{rule:r,promRule:e,groupIdentifier:a,compact:!0})};if(A.p.grafana.alertingRule(r)){const h=e&&e.type===he.JS.Alerting?e:void 0;return(0,o.jsx)(D.WG,{...g,summary:m.summary,state:h?.state,instancesCount:h?.alerts?.length,operation:s})}return A.p.grafana.recordingRule(r)?(0,o.jsx)(D.nh,{...g}):(0,o.jsx)(D.Om,{ruleName:u,groupIdentifier:a,ruleDefinition:r})}var pr=function(e,r){var a=(0,v.useState)(null),n=a[0],s=a[1];return(0,v.useEffect)(function(){if(e.current&&typeof IntersectionObserver=="function"){var l=function(i){s(i[0])},u=new IntersectionObserver(l,r);return u.observe(e.current),function(){s(null),u.disconnect()}}return function(){}},[e.current,r.threshold,r.root,r.rootMargin]),n};const gr=pr;function hr({handleLoad:e}){const r=(0,v.useRef)(null),a=gr(r,{root:null,threshold:1});return(0,v.useEffect)(()=>{a&&a.intersectionRatio>0&&e()},[a,e]),(0,o.jsx)("div",{ref:r,"data-testid":"load-more-helper"})}const yr=hr;class xr extends G{[Symbol.asyncIterator](r){return(0,d.__asyncGenerator)(this,arguments,function*(){C(r)})}}function Qe(){return new xr}class vr extends G{constructor(r,a,n){super(),this._source=r,this._selector=a,this._thisArg=n}[Symbol.asyncIterator](r){return(0,d.__asyncGenerator)(this,arguments,function*(){var n,s,l,u,i,c,m,p;C(r);let g=0;const{_thisArg:h,_selector:y}=this;try{for(var x=!0,b=(0,d.__asyncValues)(U(this._source,r)),R;R=yield(0,d.__await)(b.next()),n=R.done,!n;x=!0){u=R.value,x=!1;const N=u,M=y.call(h,N,g++,r),k=ue(M)?yield(0,d.__await)(M):M;try{for(var S=!0,w=(c=void 0,(0,d.__asyncValues)(U(G.as(k),r))),L;L=yield(0,d.__await)(w.next()),i=L.done,!i;S=!0){p=L.value,S=!1;const Ge=p;yield yield(0,d.__await)(Ge)}}catch(Ge){c={error:Ge}}finally{try{!S&&!i&&(m=w.return)&&(yield(0,d.__await)(m.call(w)))}finally{if(c)throw c.error}}}}catch(N){s={error:N}}finally{try{!x&&!n&&(l=b.return)&&(yield(0,d.__await)(l.call(b)))}finally{if(s)throw s.error}}})}}function Ve(e,r){return function(n){return new vr(n,e,r)}}class jr extends G{constructor(r,a){super(),this._source=r,this._handler=a}[Symbol.asyncIterator](r){return(0,d.__asyncGenerator)(this,arguments,function*(){var n,s,l,u;C(r);let i,c=!1;const p=U(this._source,r)[Symbol.asyncIterator]();for(;;){let x={};try{if(x=yield(0,d.__await)(p.next()),x.done){yield(0,d.__await)(pe(p));break}}catch(b){i=yield(0,d.__await)(this._handler(b,r)),c=!0,yield(0,d.__await)(pe(p));break}yield yield(0,d.__await)(x.value)}if(c)try{for(var g=!0,h=(0,d.__asyncValues)(U(i,r)),y;y=yield(0,d.__await)(h.next()),n=y.done,!n;g=!0){u=y.value,g=!1;const x=u;yield yield(0,d.__await)(x)}}catch(x){s={error:x}}finally{try{!g&&!n&&(l=h.return)&&(yield(0,d.__await)(l.call(h)))}finally{if(s)throw s.error}}})}}function Ke(e){return function(a){return new jr(a,e)}}var J=f(2543),br=f(47078),wr=f.n(br),Ye=f(86017),Rr=f(63895);function He(e,r){const{name:a,file:n}=e;return!(r.namespace&&!n.toLowerCase().includes(r.namespace)||r.groupName&&!a.toLowerCase().includes(r.groupName))}function Ze(e,r){const{name:a,labels:n={},health:s,type:l}=e,u=a.toLowerCase();if(r.freeFormWords.length>0&&!r.freeFormWords.some(i=>u.includes(i))||r.ruleName&&!u.includes(r.ruleName))return!1;if(r.labels.length>0){const i=(0,J.compact)(r.labels.map(Gr)),c=i.length>0&&(0,Ye.Av)(n,i),m=i.length>0&&A.R$.alertingRule(e)&&e.alerts&&e.alerts.some(p=>(0,Ye.Av)(p.labels||{},i));if(!c&&!m)return!1}if(r.ruleType&&l!==r.ruleType||r.ruleState&&(!A.R$.alertingRule(e)||e.state!==r.ruleState)||r.ruleHealth&&s!==r.ruleHealth||r.dashboardUid&&(!A.R$.alertingRule(e)||e.annotations?.[oe.YH.dashboardUID]!==r.dashboardUid)||r.plugins==="hide"&&(0,A.Tm)(e))return!1;if(r.dataSourceNames.length>0&&A.R$.grafana.rule(e))try{const c=Sr(r.dataSourceNames);if(!(e.queriedDatasourceUIDs||[]).some(g=>c.includes(g)))return!1}catch{return!1}return!0}function Gr(e){try{return(0,Rr.qR)(e)}catch{return{name:e,value:"",isRegex:!0,isEqual:!0}}}const Sr=wr()(e=>e.map(r=>(0,J.attempt)(E.w5,r)).filter(J.isString),{maxSize:1});var Je=f(52763),Ar=f(5709),Lr=f(78467);const q=Ar.H.injectEndpoints({endpoints:e=>({getGroups:e.query({query:({ruleSource:r,namespace:a,groupName:n,ruleName:s,groupLimit:l,excludeAlerts:u,groupNextToken:i,notificationOptions:c})=>{if(r.uid===E.hY)throw new Error("Please use getGrafanaGroups endpoint for grafana rules");return{url:`api/prometheus/${r.uid}/api/v1/rules`,params:{file:a,"file[]":a,rule_group:n,"rule_group[]":n,rule_name:s,"rule_name[]":s,exclude_alerts:u?.toString(),group_limit:l?.toFixed(0),group_next_token:i},notificationOptions:c}},transformResponse:r=>({...r,data:{...r.data,groups:r.data.groups.map(Lr.JY)}})}),getGrafanaGroups:e.query({query:({folderUid:r,groupName:a,ruleName:n,groupLimit:s,excludeAlerts:l,groupNextToken:u})=>({url:"api/prometheus/grafana/api/v1/rules",params:{folder_uid:r,rule_group:a,rule_name:n,exclude_alerts:l?.toString(),group_limit:s?.toFixed(0),group_next_token:u}})})})}),{useLazyGetGroupsQuery:Nr,useLazyGetGrafanaGroupsQuery:Ir}=q;function ke(e={}){const r=(0,Je.wA)(),[a]=Nr();return(0,v.useCallback)(async function*(n,s){yield*qe(async u=>{const i=await a({ruleSource:{uid:n.uid},notificationOptions:{showErrorAlert:!1},...u}).unwrap();return e.populateCache&&i.data.groups.forEach(c=>{r(q.util.upsertQueryData("getGroups",{ruleSource:{uid:n.uid},namespace:c.file,groupName:c.name},{data:{groups:[c]},status:"success"}))}),i},s)},[a,r,e.populateCache])}function Xe(e={}){const r=(0,Je.wA)(),[a]=Ir(),n=(0,v.useCallback)(async s=>{const l=await a(s).unwrap();if(e.populateCache){const u=l.data.groups.map(async i=>{r(Y.hK.util.prefetch("getGrafanaRulerGroup",{folderUid:i.folderUid,groupName:i.name},{force:!0})),await r(q.util.upsertQueryData("getGrafanaGroups",{folderUid:i.folderUid,groupName:i.name},{data:{groups:[i]},status:"success"}))});await Promise.allSettled(u)}return l},[a,r,e.populateCache]);return(0,v.useCallback)(async function*(s){yield*qe(n,s)},[n])}function _e(e){return async function*(){for await(const r of e)for(const a of r)yield a}()}async function*qe(e,r){let a=await e({groupLimit:r});yield a.data.groups;let n=a.data?.groupNextToken;for(;n;)a=await e({groupNextToken:n,groupLimit:r}),yield a.data.groups,n=a.data?.groupNextToken}function Fr(){const e=(0,E.TG)(),r=ke(),a=Xe();return(s,l)=>{const u=new AbortController,i=Tr(s),c=!!s.dataSourceNames.length,m=Me(a(l)).pipe(De(u.signal),Ve(h=>h.filter(y=>He(y,i)).flatMap(y=>y.rules.map(x=>[y,x])).filter(([,y])=>Ze(y,i)).map(([y,x])=>Er(y,x))),Ke(()=>Qe())),p=c?Pr(s):e;if((0,J.isEmpty)(p))return{iterable:m,abortController:u};const g=p.map(h=>Me(r(h,l)).pipe(De(u.signal),Ve(x=>x.filter(b=>He(b,i)).flatMap(b=>b.rules.map(R=>[b,R])).filter(([,b])=>Ze(b,i)).map(([b,R])=>Cr(h,b,R))),Ke(()=>Qe())));return{iterable:We(m,...g),abortController:u}}}function Pr(e){return e.dataSourceNames.reduce((r,a)=>{try{const n=(0,E.w5)(a),s=(0,E.$e)(n)?.type;if(s===void 0||(0,E.cl)(s)===!1)return r;r.push({name:a,uid:n,ruleSourceType:"datasource"})}catch{}return r},[])}function Cr(e,r,a){return{rule:a,groupIdentifier:{rulesSource:e,namespace:{name:r.file},groupName:r.name,groupOrigin:"datasource"},origin:"datasource"}}function Er(e,r){return{rule:r,groupIdentifier:{namespace:{uid:e.folderUid},groupName:e.name,groupOrigin:"grafana"},namespaceName:e.file,origin:"grafana"}}function Tr(e){return{...e,freeFormWords:e.freeFormWords.map(r=>r.toLowerCase()),ruleName:e.ruleName?.toLowerCase(),groupName:e.groupName?.toLowerCase(),namespace:e.namespace?.toLowerCase()}}const et=100,Mr=2e3;function Dr({filterState:e}){return(0,o.jsx)(Br,{filterState:e},JSON.stringify(e))}function Br({filterState:e}){const[r,a]=(0,v.useTransition)(),n=Fr(),s=(0,v.useRef)(null),[l,u]=(0,v.useState)([]),[i,c]=(0,v.useState)(!1),m=(0,v.useCallback)(()=>{if(!s.current){const{iterable:w,abortController:L}=n(e,Mr),N=w.pipe(Kt(et,1e3),$r(()=>c(!0)))[Symbol.asyncIterator]();s.current={rulesBatchIterator:N,abortController:L}}return s.current.rulesBatchIterator},[e,n]),[{execute:p},g]=(0,ne.Yb)((0,Xt.QA)(async()=>{const w=m();let L=0;for(;L<et;){const N=await w.next();if(N.done)return;N.value&&a(()=>{u(M=>M.concat(N.value.map(k=>({key:Or(k),...k}))))}),L+=N.value.length}},"alerting.rule-list.filter-view.load-result-page")),h=(0,ne.VP)(g)||r,y=l.length,x=y===0&&!h,b=s.current?.abortController.signal.aborted,R=(0,v.useCallback)(()=>{s.current?.abortController.abort()},[]);(0,Jt.A)(()=>{R()});const S=(0,v.useMemo)(()=>b?"aborted":i?"done":"searching",[i,b]);return x&&i?(0,o.jsx)(kt.p,{variant:"not-found",message:"No matching rules found",children:(0,o.jsx)(j.x6,{i18nKey:"alerting.rule-list.filter-view.no-rules-found",children:"No alert or recording rules matched your current set of filters."})}):(0,o.jsxs)(P.B,{direction:"column",gap:0,children:[(0,o.jsxs)("ul",{"aria-label":(0,j.t)("alerting.filter-view-results.aria-label-filteredrulelist","filtered-rule-list"),children:[l.map(w=>{const{key:L,rule:N,groupIdentifier:M,origin:k}=w;switch(k){case"grafana":return(0,o.jsx)(mr,{rule:N,groupIdentifier:M,namespaceName:w.namespaceName},L);case"datasource":return(0,o.jsx)(lr,{rule:N,groupIdentifier:M},L);default:return(0,o.jsx)(D.Om,{ruleName:(0,j.t)("alerting.rule-list.unknown-rule-type","Unknown rule type"),groupIdentifier:M,ruleDefinition:N},L)}}),h&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_,{}),(0,o.jsx)(_,{})]})]}),!x&&(0,o.jsx)(cr,{state:S,numberOfRules:y,onCancel:R}),!i&&!h&&!b&&(0,o.jsx)(yr,{handleLoad:p})]})}function $r(e){return Zt(void 0,void 0,e)}function Or(e){return e.origin==="grafana"?Wr(e):Ur(e)}function Wr(e){const{groupIdentifier:{namespace:r,groupName:a},rule:n}=e;return`grafana-${r.uid}-${a}-${n.uid}}`}function Ur(e){const{rule:r,groupIdentifier:{rulesSource:a,namespace:n,groupName:s}}=e;return`${a.name}-${n.name}-${s}-${r.name}-${r.type}-${(0,F.jY)(r)}`}var ee=f(29442),tt=f(68143);const{useDiscoverDsFeaturesQuery:zr}=ae.L,{useGetGroupsQuery:Qr}=q,{useGetRuleGroupForNamespaceQuery:Vr}=Y.hK;function Kr({groupIdentifier:e,expectedRulesCount:r=3}){const{namespace:a,groupName:n}=e,s=a.name,{data:l,isLoading:u,isError:i}=Qr({ruleSource:{uid:e.rulesSource.uid},namespace:s,groupName:n},{pollingInterval:oe.HH}),{data:c,isLoading:m,isError:p}=zr({uid:e.rulesSource.uid}),{data:g,error:h,isFetching:y,isError:x}=Vr(c?.rulerConfig?{rulerConfig:c?.rulerConfig,namespace:s,group:n}:ge.hT);if(u||m||y)return(0,o.jsx)(o.Fragment,{children:Array.from({length:r}).map((w,L)=>(0,o.jsx)(_,{},L))});if(i||p||x)return(0,tt.NF)(h)&&h.status===404?(0,o.jsx)(Z.F,{severity:"warning",title:(0,j.t)("alerting.ds-group-loader.group-deleting","The group is being deleted")}):(0,o.jsx)(Z.F,{title:(0,j.t)("alerting.ds-group-loader.group-load-failed","Failed to load rules from group {{ groupName }} in {{ namespaceName }}",{groupName:n,namespaceName:s}),severity:"error"});const S=l?.data.groups.find(w=>w.file===s&&w.name===n);return c?.rulerConfig&&g&&(0,A.x6)(g)&&S?(0,o.jsx)(Yr,{groupIdentifier:e,promGroup:S,rulerGroup:g,application:c.application}):S?(0,o.jsx)(o.Fragment,{children:S.rules.map(w=>(0,o.jsx)(xe,{rule:w,groupIdentifier:e,application:c?.application},(0,F.jY)(w)))}):(0,o.jsx)(Z.F,{title:(0,j.t)("alerting.ds-group-loader.group-load-failed","Failed to load rules from group {{ groupName }} in {{ namespaceName }}",{groupName:n,namespaceName:s}),severity:"warning"})}function Yr({groupIdentifier:e,application:r,promGroup:a,rulerGroup:n}){const{namespace:s,groupName:l}=e,{matches:u,promOnlyRules:i}=(0,v.useMemo)(()=>or(n,a),[a,n]);return(0,o.jsxs)(o.Fragment,{children:[n.rules.map(c=>{const m=u.get(c);return m?(0,o.jsx)(xe,{rule:m,rulerRule:c,groupIdentifier:e,application:r,actions:(0,o.jsx)(ve,{rule:c,promRule:m,groupIdentifier:e,compact:!0})},(0,F.jY)(m)):(0,o.jsx)(D.B3,{name:(0,A.qz)(c),namespace:s.name,group:l,rulesSource:e.rulesSource,application:r,operation:X.s.Creating},(0,A.qz)(c))}),i.map(c=>(0,o.jsx)(D.B3,{name:c.name,namespace:s.name,group:l,rulesSource:e.rulesSource,application:r,operation:X.s.Deleting},c.name))]})}var z=f(22803),rt=f(42941),ie=f(63142),we=f(76319),Re=f(86791),nt=f(49779),Hr=f(2401),Zr=f(34184),Jr=f(24296),kr=f(77256),Xr=f(1148),_r=f(49185),qr=f(47327),Un=f(74048),zn=f(1625),Qn=f(50072);const Vn=({name:e,provenance:r,interval:a,onToggle:n,isOpen:s=!1,children:l})=>{const u=useStyles2(en),i=!!r;return jsxs(Stack,{direction:"column",role:"treeitem","aria-expanded":s,"aria-selected":"false",gap:0,children:[jsx("div",{className:u.headerWrapper,children:jsxs(Stack,{direction:"row",alignItems:"center",gap:1,children:[jsx("button",{className:cx(u.hiddenButton,u.largerClickTarget),type:"button",onClick:n,children:jsxs(Stack,{alignItems:"center",gap:.5,children:[jsx(Icon,{name:s?"angle-down":"angle-right"}),jsx(Text,{truncate:!0,variant:"body",children:e})]})}),i&&jsx(Badge,{color:"purple",text:t("alerting.evaluation-group.text-provisioned","Provisioned")}),jsx(Spacer,{}),a&&jsx(MetaText,{icon:"history",children:a}),jsx(Button,{size:"sm",icon:"pen",variant:"secondary",disabled:i,"data-testid":"edit-group-action",children:jsx(Trans,{i18nKey:"common.edit",children:"Edit"})}),jsx(Dropdown,{overlay:jsxs(Menu,{children:[jsx(Menu.Item,{label:t("alerting.evaluation-group.label-reorder-rules","Re-order rules"),icon:"flip",disabled:i}),jsx(Menu.Divider,{}),jsx(Menu.Item,{label:t("alerting.evaluation-group.label-export","Export"),icon:"download-alt"}),jsx(Menu.Item,{label:t("alerting.evaluation-group.label-delete","Delete"),icon:"trash-alt",destructive:!0,disabled:i})]}),children:jsx(MoreButton,{size:"sm"})})]})}),s&&jsx("div",{role:"group",children:l})]})},en=e=>({headerWrapper:css({padding:`${e.spacing(1)} ${e.spacing(1)}`,background:e.colors.background.secondary,border:"none",borderBottom:`solid 1px ${e.colors.border.weak}`,borderTopLeftRadius:e.shape.radius.default,borderTopRightRadius:e.shape.radius.default}),hiddenButton:css({border:"none",background:"transparent"}),largerClickTarget:css({padding:e.spacing(.5),margin:`-${e.spacing(.5)}`})}),tn=15,Kn=({name:e,provenance:r,interval:a,namespace:n,rulerConfig:s})=>{const[l,u]=useToggle(!1),[i,{currentData:c,isLoading:m,error:p}]=alertRuleApi.endpoints.prometheusRuleNamespaces.useLazyQuery(),g=c?.flatMap(R=>R.groups).flatMap(R=>R.rules),{page:h,pageItems:y,onPageChange:x,numberOfPages:b}=usePagination(g??[],1,tn);return useEffect(()=>{l&&s&&i({namespace:n,groupName:e,ruleSourceName:s.dataSourceName})},[i,l,e,n,s]),jsx(EvaluationGroup,{name:e,interval:a,provenance:r,isOpen:l,onToggle:u,children:p?jsx(Alert,{title:t("alerting.evaluation-group-loader.title-something-wrong-trying-fetch-group-details","Something went wrong when trying to fetch group details"),children:String(p)}):jsxs(Fragment,{children:[m?jsx(nn,{}):y.map((R,S)=>(AlertRuleListItem,PromAlertingRuleState.Inactive,R.name,prometheusRuleType.alertingRule(R)&&R.annotations?.[Annotation.summary],null)),b>1&&jsx(Pagination,{currentPage:h,numberOfPages:b,onNavigate:x})]})})},rn=({datasourceUid:e})=>{const[r,{width:a}]=(0,_r.A)();return(0,o.jsx)("div",{ref:r,"data-testid":`ds-loading-indicator-${e}`,children:(0,o.jsx)(qr.G,{width:a})})},nn=()=>{const[e,{width:r}]=useMeasure();return jsxs("div",{ref:e,children:[jsx(LoadingBar,{width:r}),jsx(SkeletonListItem,{})]})},le=({uid:e,name:r,application:a,children:n,loader:s,isLoading:l=!1,description:u=null})=>{const i=(0,ie.of)(an),{rulesSourcesWithRuler:c}=(0,Jr.z)(),m=e!==Re.l$&&c.some(({uid:y,type:x})=>y===e&&Zr.supportedImportTypes.includes(x)),[p,g]=(0,rt.A)(!1),h=e===Re.l$?(0,kr.qc)()?"/alerting/admin":void 0:`/connections/datasources/edit/${String(e)}`;return(0,o.jsx)("section",{"aria-labelledby":`datasource-${String(e)}-heading`,role:"listitem",children:(0,o.jsxs)(P.B,{direction:"column",gap:1,children:[(0,o.jsxs)(P.B,{direction:"column",gap:0,children:[l&&(0,o.jsx)(rn,{datasourceUid:String(e)}),(0,o.jsx)("div",{className:i.dataSourceSectionTitle,children:s??(0,o.jsxs)(P.B,{alignItems:"center",children:[(0,o.jsx)(we.K,{name:p?"angle-right":"angle-down",onClick:g,"aria-label":(0,j.t)("common.collapse","Collapse")}),a&&(0,o.jsx)(Xr.H,{application:a}),(0,o.jsx)(H.E,{variant:"body",weight:"bold",element:"h2",id:`datasource-${String(e)}-heading`,children:r}),u&&(0,o.jsxs)(o.Fragment,{children:["\xB7",u]}),(0,o.jsx)(nt.h,{}),m&&(0,o.jsx)($.z9,{variant:"secondary",size:"sm",href:`/alerting/import-datasource-managed-rules?datasourceUid=${String(e)}`,icon:"arrow-up",children:(0,o.jsx)(j.x6,{i18nKey:"alerting.data-source-section.import-to-grafana",children:"Import to Grafana rules"})}),h&&(0,o.jsx)(Hr.d,{title:(0,j.t)("alerting.rule-list.return-button.title","Alert rules"),component:(0,o.jsx)($.z9,{variant:"secondary",size:"sm",href:h,children:(0,o.jsx)(j.x6,{i18nKey:"alerting.rule-list.configure-datasource",children:"Configure"})})})]})})]}),!p&&(0,o.jsx)("div",{className:i.itemsWrapper,children:n})]})})},an=e=>({itemsWrapper:(0,z.css)({position:"relative",marginLeft:e.spacing(1.5),"&:before":{content:"''",position:"absolute",height:"100%",marginLeft:`-${e.spacing(1.5)}`,borderLeft:`solid 1px ${e.colors.border.weak}`}}),dataSourceSectionTitle:(0,z.css)({background:e.colors.background.secondary,padding:`${e.spacing(1)} ${e.spacing(1.5)}`,border:`solid 1px ${e.colors.border.weak}`,borderRadius:e.shape.radius.default})});function at({canMoveForward:e,canMoveBackward:r,nextPage:a,previousPage:n}){return(0,o.jsxs)(P.B,{direction:"row",gap:1,children:[(0,o.jsx)($.$n,{"aria-label":(0,j.t)("alerting.rule-list.pagination.previous-page","previous page"),size:"sm",variant:"secondary",onClick:n,disabled:!r,children:(0,o.jsx)(O.I,{name:"angle-left"})}),(0,o.jsx)($.$n,{"aria-label":(0,j.t)("alerting.rule-list.pagination.next-page","next page"),size:"sm",variant:"secondary",onClick:a,disabled:!e,children:(0,o.jsx)(O.I,{name:"angle-right"})})]})}var on=f(89640);const ot=({name:e,description:r,isOpen:a=!0,metaRight:n=null,actions:s=null,href:l,children:u})=>{const i=(0,ie.of)(st),[c,m]=(0,rt.A)(a);return(0,o.jsxs)("div",{className:i.groupWrapper,role:"treeitem","aria-expanded":c,"aria-selected":"false",children:[(0,o.jsx)(sn,{onToggle:()=>m(),isOpen:c,description:r,name:e,metaRight:n,actions:s,href:l}),c&&(0,o.jsx)("div",{role:"group",children:u})]})},sn=e=>{const{name:r,description:a,metaRight:n=null,actions:s=null,isOpen:l=!1,onToggle:u,href:i}=e,c=(0,ie.of)(st);return(0,o.jsx)("div",{className:c.headerWrapper,children:(0,o.jsxs)(P.B,{direction:"row",alignItems:"center",gap:1,children:[(0,o.jsxs)(P.B,{alignItems:"center",gap:0,children:[(0,o.jsx)(we.K,{name:l?"angle-down":"angle-right",onClick:u,"aria-label":(0,j.t)("common.collapse","Collapse")}),i?(0,o.jsx)(on.Y,{href:i,color:"primary",inline:!1,children:r}):(0,o.jsx)(H.E,{truncate:!0,variant:"body",element:"h4",children:r})]}),a,(0,o.jsx)(nt.h,{}),n,s]})})},st=e=>({groupWrapper:(0,z.css)({display:"flex",flexDirection:"column"}),headerWrapper:(0,z.css)({padding:`${e.spacing(.5)} ${e.spacing(1)}`,background:e.colors.background.secondary,border:"none",borderBottom:`solid 1px ${e.colors.border.weak}`,borderTopLeftRadius:e.shape.radius.default,borderTopRightRadius:e.shape.radius.default})});var it=f(64628),ln=f(18404),lt=f(88721),un=f(45967);function cn({status:e}){const r=(0,ie.of)(fn);return(0,o.jsxs)("div",{className:r.container,children:[(0,o.jsx)("div",{className:r.loader}),e==="deleting"&&(0,o.jsx)(un.m,{content:"The group is being deleted",children:(0,o.jsx)("div",{className:r.iconWrapper,children:(0,o.jsx)(O.I,{name:"trash-alt",size:"sm"})})})]})}const dn=(0,z.keyframes)({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),fn=e=>({container:(0,z.css)({position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",margin:e.spacing(.5)}),loader:(0,z.css)({position:"absolute",inset:`-${e.spacing(.5)}`,border:"2px solid #FFF",borderRadius:e.shape.radius.circle,boxSizing:"border-box",[e.transitions.handleMotion("no-preference")]:{animationName:dn,animationIterationCount:"infinite",animationDuration:"1s",animationTimingFunction:"linear"},"&::after":{content:'""',boxSizing:"border-box",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"calc(100% + 4px)",height:"calc(100% + 4px)",borderRadius:e.shape.radius.circle,border:"2px solid transparent",borderBottomColor:e.colors.action.selectedBorder}}),iconWrapper:(0,z.css)({position:"relative",zIndex:1,display:"flex"}),"@keyframes rotation":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}),{useGetGrafanaRulerGroupQuery:mn,useGetRuleGroupForNamespaceQuery:pn}=Y.hK,{useDiscoverDsFeaturesQuery:gn}=ae.L;function ut({groupIdentifier:e}){switch(e.groupOrigin){case"grafana":return(0,o.jsx)(yn,{groupIdentifier:e});case"datasource":return(0,o.jsx)(hn,{groupIdentifier:e});default:return null}}function hn({groupIdentifier:e}){const{canEditRules:r}=(0,lt.V)(),{data:a}=gn({uid:e.rulesSource.uid}),{data:n,error:s,isLoading:l}=pn(a?.rulerConfig?{namespace:e.namespace.name,group:e.groupName,rulerConfig:a?.rulerConfig}:ge.hT),u=n?(0,A.YN)(n):!1,i=n?(0,A.Sk)(n):!1,c=!u&&!i&&r(e.rulesSource.name),m=(0,E.of)(e.rulesSource.uid);return!m||!a?.rulerConfig?null:l?(0,o.jsx)(je,{}):s?(0,tt.NF)(s)&&s.status===404?(0,o.jsx)(cn,{status:"deleting"}):(0,o.jsx)(O.I,{name:"exclamation-triangle",title:(0,j.t)("alerting.group-actions-menu.group-load-failed","Failed to load group details")}):n?(0,o.jsx)(Ae.m,{placement:"right-start",overlay:(0,o.jsxs)(B.W,{children:[(0,o.jsx)(B.W.Item,{label:(0,j.t)("alerting.group-actions.details","Details"),icon:"info-circle","data-testid":"details-group-action",url:ee.TN.detailsPageLink(m.uid,e.namespace.name,e.groupName)}),c&&(0,o.jsx)(B.W.Item,{label:(0,j.t)("alerting.group-actions.edit","Edit"),icon:"pen","data-testid":"edit-group-action",url:ee.TN.editPageLink(m.uid,e.namespace.name,e.groupName)})]}),children:(0,o.jsx)(we.K,{name:"ellipsis-h","aria-label":(0,j.t)("alerting.group-actions.actions-trigger","Rule group actions")})}):(0,o.jsx)(O.I,{name:"exclamation-triangle",title:(0,j.t)("alerting.group-actions-menu.unknown-error","Unknown error")})}function yn({groupIdentifier:e}){const{canEditRules:r}=(0,lt.V)(),{data:a}=mn({folderUid:e.namespace.uid,groupName:e.groupName}),n=a?(0,A.oI)(a):!1,s=a?(0,A.Sk)(a):!1,l=e.namespace.uid,{folder:u}=(0,ln.a)(l);return u?.canSave&&!n&&!s&&r(E.hY)?(0,o.jsx)($.z9,{icon:"pen",variant:"secondary",size:"sm",href:ee.TN.editPageLink(E.hY,l,e.groupName),children:(0,j.t)("alerting.group-actions.edit","Edit")}):null}function ct(e,r){const[a,n]=(0,v.useState)(1),[s,l]=(0,v.useState)([]),[u,i]=(0,v.useState)(void 0),[{execute:c},m]=(0,ne.Yb)(async S=>{let w=!1;const L=[];for(;L.length<S;){const N=await e.next();if(N.done){w=!0;break}const M=N.value;L.push(M)}if(w){const N=s.length+L.length;i(Math.ceil(N/r))}l(N=>[...N,...L])}),p=(0,ne.VP)(m),g=!p&&(!u||a<u),h=a>1,y=(0,v.useCallback)(async()=>{g&&n(S=>S+1)},[g]),x=(0,v.useCallback)(async()=>{h&&n(S=>S-1)},[h]);s.length-r<r*a&&u===void 0&&!p&&c(r);const R=(0,v.useMemo)(()=>s.slice((a-1)*r,a*r),[s,a,r]);return{isLoading:p,page:R,nextPage:y,previousPage:x,canMoveForward:g,canMoveBackward:h}}const dt=40;function xn({rulesSourceIdentifier:e,application:r}){const{uid:a,name:n}=e,s=ke({populateCache:!0}),l=(0,v.useRef)(_e(s(e,dt)));(0,v.useEffect)(()=>{const y=l.current;return()=>{y.return()}},[l]);const{page:u,nextPage:i,previousPage:c,canMoveForward:m,canMoveBackward:p,isLoading:g}=ct(l.current,dt),h=(0,v.useMemo)(()=>(0,J.groupBy)(u,"file"),[u]);return(0,o.jsx)(le,{name:n,application:r,uid:a,isLoading:g,children:(0,o.jsxs)(P.B,{direction:"column",gap:1,children:[Object.entries(h).map(([y,x])=>(0,o.jsx)(it.i,{title:(0,o.jsxs)(P.B,{direction:"row",gap:1,alignItems:"center",children:[(0,o.jsx)(O.I,{name:"folder"})," ",(0,o.jsx)(H.E,{variant:"body",element:"h3",children:y})]}),children:x.map(b=>(0,o.jsx)(vn,{group:b,rulesSourceIdentifier:e,namespaceName:y},`${e.uid}-${y}-${b.name}`))},y)),(0,o.jsx)(at,{nextPage:i,previousPage:c,canMoveForward:m,canMoveBackward:p})]})})}function vn({rulesSourceIdentifier:e,group:r,namespaceName:a}){const n=(0,v.useMemo)(()=>({rulesSource:e,namespace:{name:a},groupName:r.name,groupOrigin:"datasource"}),[e,a,r.name]);return(0,o.jsx)(ot,{name:r.name,href:ee.TN.detailsPageLink(e.uid,a,r.name),isOpen:!1,actions:(0,o.jsx)(ut,{groupIdentifier:n}),children:(0,o.jsx)(Kr,{groupIdentifier:n,expectedRulesCount:r.rules.length})},r.name)}const{useGetGrafanaRulerGroupQuery:jn}=Y.hK,{useGetGrafanaGroupsQuery:bn}=q;function wn({groupIdentifier:e,namespaceName:r,expectedRulesCount:a=3}){const{data:n,isLoading:s}=bn({folderUid:e.namespace.uid,groupName:e.groupName},{pollingInterval:oe.HH}),{data:l,isLoading:u}=jn({folderUid:e.namespace.uid,groupName:e.groupName}),{matches:i,promOnlyRules:c}=(0,v.useMemo)(()=>{const p=n?.data.groups.at(0)?.rules??[],g=l?.rules??[];return Rn(p,g)},[n,l]);return s||u?(0,o.jsx)(o.Fragment,{children:Array.from({length:a}).map((p,g)=>(0,o.jsx)(_,{},g))}):!l||!n?(0,o.jsx)(Z.F,{title:(0,j.t)("alerting.group-loader.group-load-failed","Failed to load rules from group {{ groupName }} in {{ namespaceName }}",{groupName:e.groupName,namespaceName:r}),severity:"error"}):(0,o.jsxs)(o.Fragment,{children:[l.rules.map(p=>{const g=i.get(p);return g?(0,o.jsx)(be,{rule:g,rulerRule:p,groupIdentifier:e,namespaceName:r},g.uid):(0,o.jsx)(be,{rule:g,rulerRule:p,groupIdentifier:e,namespaceName:r,operation:X.s.Creating},p.grafana_alert.uid)}),c.map(p=>(0,o.jsx)(D.B3,{name:p.name,namespace:r,group:e.groupName,rulesSource:E.r6,application:"grafana",operation:X.s.Deleting},p.uid))]})}function Rn(e,r){const a=new Map(e.map(s=>[s.uid,s])),n=r.reduce((s,l)=>{const{matches:u}=s,i=a.get(l.grafana_alert.uid);return i&&(u.set(l,i),a.delete(l.grafana_alert.uid)),s},{matches:new Map,promOnlyRules:[]});return n.promOnlyRules.push(...a.values()),n}const ft=40;function Gn(){const e=Xe({populateCache:!0}),r=(0,v.useRef)(_e(e(ft)));(0,v.useEffect)(()=>{const m=r.current;return()=>{m.return()}},[]);const{page:a,nextPage:n,previousPage:s,canMoveForward:l,canMoveBackward:u,isLoading:i}=ct(r.current,ft),c=(0,v.useMemo)(()=>(0,J.groupBy)(a,"folderUid"),[a]);return(0,o.jsx)(le,{name:"Grafana",application:"grafana",uid:Re.l$,isLoading:i,children:(0,o.jsxs)(P.B,{direction:"column",gap:1,children:[Object.entries(c).map(([m,p])=>{const g=p[0].file;return(0,o.jsx)(it.i,{title:(0,o.jsxs)(P.B,{direction:"row",gap:1,alignItems:"center",children:[(0,o.jsx)(O.I,{name:"folder"})," ",(0,o.jsx)(H.E,{variant:"body",element:"h3",children:g})]}),children:p.map(h=>(0,o.jsx)(Sn,{group:h,namespaceName:g},`grafana-ns-${m}-${h.name}`))},m)}),(0,o.jsx)(at,{nextPage:n,previousPage:s,canMoveForward:l,canMoveBackward:u})]})})}function Sn({group:e,namespaceName:r}){const a=(0,v.useMemo)(()=>({groupName:e.name,namespace:{uid:e.folderUid},groupOrigin:"grafana"}),[e.name,e.folderUid]);return(0,o.jsx)(ot,{name:e.name,href:ee.TN.detailsPageLink(E.hY,e.folderUid,e.name),isOpen:!1,actions:(0,o.jsx)(ut,{groupIdentifier:a}),children:(0,o.jsx)(wn,{groupIdentifier:a,namespaceName:r})},e.name)}var An=f(36303),Ln=f(56297);function mt({children:e,rulesSourceIdentifier:r}){return(0,o.jsx)(An.tH,{children:({error:a,errorInfo:n})=>{if(a||n){const{uid:s,name:l}=r;return(0,o.jsx)(le,{uid:s,name:l,children:(0,o.jsxs)(Z.F,{title:(0,j.t)("alerting.rule-list.ds-error-boundary.title","Unable to load rules from this data source"),children:[(0,o.jsx)(H.E,{children:(0,o.jsx)(j.x6,{i18nKey:"alerting.rule-list.ds-error-boundary.description",children:"Check the data source configuration. Does the data source support Prometheus API?"})}),(0,o.jsx)(Ln.D,{error:a,errorInfo:n,title:(0,j.t)("alerting.rule-list.ds-error-boundary.title","Unable to load rules from this data source")})]})})}return e}})}const{useDiscoverDsFeaturesQuery:Nn}=ae.L;function In(){const e=(0,v.useMemo)(()=>(0,E.TG)(),[]);return(0,o.jsxs)(P.B,{direction:"column",gap:1,role:"list",children:[(0,o.jsx)(mt,{rulesSourceIdentifier:E.r6,children:(0,o.jsx)(Gn,{})}),e.map(r=>(0,o.jsx)(Fn,{rulesSourceIdentifier:r},r.uid))]})}function Yn(){return jsx(DataSourceSection,{name:"Grafana",application:"grafana",uid:"grafana",isLoading:!0})}function Fn({rulesSourceIdentifier:e}){const{data:r,isLoading:a}=Nn({uid:e.uid}),{uid:n,name:s}=e;return a?(0,o.jsx)(le,{loader:(0,o.jsx)(se.A,{width:250,height:16}),uid:n,name:s}):r?(0,o.jsx)(mt,{rulesSourceIdentifier:e,children:(0,o.jsx)(xn,{rulesSourceIdentifier:e,application:r.application},e.uid)}):null}function Pn(){const[e]=(0,bt.l)(),{filterState:r,hasActiveFilters:a}=(0,jt.dI)(),n=e.get("view")==="list"?"list":"grouped",s=a||n==="list";return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(vt,{onClear:()=>{}}),s?(0,o.jsx)(Dr,{filterState:r}):(0,o.jsx)(In,{})]})}function pt(){const[e,r]=(0,V.Ej)(V.RY.CreateAlertRule),[a,n]=(0,V.Ej)(V.RY.CreateExternalAlertRule),s=e&&r,l=a&&n,u=s||l,i=(0,v.useMemo)(()=>(0,o.jsxs)(B.W,{children:[(0,o.jsx)(B.W.Group,{children:(0,o.jsx)(B.W.Item,{label:(0,j.t)("alerting.rule-list.draft-new-rule","Draft a new rule"),icon:"file-export",url:"/alerting/export-new-rule"})}),(0,o.jsxs)(B.W.Group,{label:(0,j.t)("alerting.rule-list.recording-rules","Recording rules"),children:[s&&(0,o.jsx)(B.W.Item,{label:(0,j.t)("alerting.rule-list.new-grafana-recording-rule","New Grafana recording rule"),icon:"grafana",url:"/alerting/new/grafana-recording"}),l&&(0,o.jsx)(B.W.Item,{label:(0,j.t)("alerting.rule-list.new-datasource-recording-rule","New Data source recording rule"),icon:"gf-prometheus",url:"/alerting/new/recording"})]})]}),[s,l]);return(0,o.jsxs)(P.B,{direction:"row",gap:1,children:[u&&(0,o.jsx)($.z9,{variant:"primary",icon:"plus",href:"/alerting/new/alerting",children:(0,o.jsx)(j.x6,{i18nKey:"alerting.rule-list.new-alert-rule",children:"New alert rule"})}),(0,o.jsx)(Ae.m,{overlay:i,children:(0,o.jsxs)($.$n,{variant:"secondary",children:[(0,o.jsx)(j.x6,{i18nKey:"alerting.rule-list.more",children:"More"})," ",(0,o.jsx)(O.I,{name:"angle-down"})]})})]})}function Cn(){return(0,o.jsx)(gt.d,{navId:"alert-list",isLoading:!1,actions:(0,o.jsx)(pt,{}),children:(0,o.jsx)(Pn,{})})}}}]);

//# sourceMappingURL=7666.986b1d205273ff3a5dd3.js.map