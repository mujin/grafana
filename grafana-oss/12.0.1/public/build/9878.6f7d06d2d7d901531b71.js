"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9878],{60093:(xe,de,l)=>{l.d(de,{BI:()=>K,TO:()=>P,kl:()=>ae,w7:()=>oe,wU:()=>_});var b=l(74848),Y=l(96540),S=l(43173),A=l(41654),J=l(18027),ie=l(63527),O=l(12282);const P=[{value:O.U3.Range,label:"Range",description:"Run query over a range of time."},{value:O.U3.Instant,label:"Instant",description:'Run query against a single point in time. For this query, the "To" time is used.'}],K=[{value:O.ti.Backward,label:"Backward",description:"Search in backward direction."},{value:O.ti.Forward,label:"Forward",description:"Search in forward direction."}];S.$.featureToggles.lokiShardSplitting&&K.push({value:O.ti.Scan,label:"Scan",description:"Experimental. Split the query into smaller units and stop at the requested log line limit.",icon:"exclamation-triangle"});function oe(j){return K.find(v=>v.value===j)?.label??"Unknown"}function ae(j){const{lineLimitValue:v,onRunQuery:ge,runOnBlur:I,onChange:le}=j,Z=j.query??{};function y(Q){const V={...Z,maxLines:_(Q)};le(V)}function L(Q){Z.maxLines!==_(Q.currentTarget.value)&&y(Q.currentTarget.value)}function M(Q){Q.key==="Enter"&&ge()}return(0,b.jsx)(A.B,{alignItems:"flex-start",gap:.5,"aria-label":"Loki extra field",children:(0,b.jsx)(A.B,{wrap:"nowrap",gap:0,"data-testid":"lineLimitField","aria-label":"Line limit field",children:(0,b.jsx)(J.I,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query.",children:(0,b.jsx)(ie.p,{className:"width-4",placeholder:"auto",type:"number",min:0,onChange:L,onKeyDown:M,value:v,onBlur:()=>{I&&ge()}})})})})}var d=(0,Y.memo)(ae);function _(j){const v=parseInt(j,10);if(!(isNaN(v)||v<0))return v}},76864:(xe,de,l)=>{l.d(de,{W:()=>O});var b=l(74848),Y=l(96540),S=l(22420);const A=(0,Y.lazy)(()=>l.e(1952).then(l.bind(l,32833))),J=P=>(0,b.jsx)(Y.Suspense,{fallback:null,children:(0,b.jsx)(A,{...P})}),ie=P=>{const K=(0,Y.useRef)(null),{onRunQuery:oe,onChange:ae,...d}=P,_=v=>{K.current=v,ae(v),oe()},j=v=>{ae(v)};return(0,b.jsx)(J,{onRunQuery:_,onBlur:j,onChange:ae,...d})};class O extends Y.PureComponent{constructor(K){super(K),this._isMounted=!1,this.onChangeQuery=(oe,ae)=>{const{query:d,onChange:_,onRunQuery:j}=this.props;if(_){const v={...d,expr:oe};_(v),ae&&j&&j()}},this.state={labelsLoaded:!1}}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(this.props.range),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(K){const{range:oe,datasource:{languageProvider:ae}}=this.props;(0,S.WV)(oe,K.range)&&ae.fetchLabels({timeRange:oe})}render(){const{ExtraFieldElement:K,query:oe,datasource:ae,history:d,onRunQuery:_,range:j}=this.props,v=this.props.placeholder??"Enter a Loki query (run with Shift+Enter)";return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"],children:(0,b.jsx)("div",{className:"gf-form--grow flex-shrink-1 min-width-15",children:(0,b.jsx)(ie,{datasource:ae,history:d??[],onChange:this.onChangeQuery,onRunQuery:_,initialValue:oe.expr??"",placeholder:v,timeRange:j})})}),K]})}}},27522:(xe,de,l)=>{l.d(de,{B:()=>Y,a:()=>ie});var b=l(96426);function Y(O,P,K,oe){if(!O)return!1;const ae=S(P,oe);if(!ae.length)return!1;let d=ae;if(O!==P){const _=S(O,oe);d=ae.flatMap(j=>_.filter(v=>j.text===v.text)||j)}return d.map(_=>A(O,K,_)).filter(J)}function S(O,P){const K=[];return P.parse(O).iterate({enter:ae=>{if(ae.type.id===b.Ql){const d=ae.node;K.push({node:d,text:O.substring(d.from,d.to)})}}}),K}function A(O,P,K){if(P.length===1){const d=K.node.from===K.node.to,_=d&&K.node.parent?K.node.parent:K.node,j=d?O.substring(_.from,_.to):K.text;return{startLineNumber:1,startColumn:_.from+1,endLineNumber:1,endColumn:_.to+1,error:j}}let oe=0,ae=0;for(let d=0;d<P.length;d++){if(ae=oe+P[d].length,K.node.from>ae){oe+=P[d].length+1;continue}return{startLineNumber:d+1,startColumn:K.node.from-oe+1,endLineNumber:d+1,endColumn:K.node.to-oe+1,error:K.text}}return null}function J(O){return O!==null}const ie={__interval:{text:"1s",value:"1s"},__rate_interval:{text:"1s",value:"1s"},__auto:{text:"1s",value:"1s"},__interval_ms:{text:"1000",value:1e3},__range_ms:{text:"1000",value:1e3},__range_s:{text:"1",value:1},__range:{text:"1s",value:"1s"}}},76484:(xe,de,l)=>{l.d(de,{we:()=>He,VQ:()=>ta,lb:()=>Ye,Gf:()=>ct,M1:()=>dt,ow:()=>nr,mL:()=>ar,In:()=>Je});var b=l(2543),Y=l(13288),S=l(44240),A=l(62467),J=l(75505),ie=l(81160),O=l(66847),P=l(59099),K=l(63720),oe=l(17548),ae=l(28105),d=l(67770),_=l(1906),j=l(5556),v=l(88673),ge=l(428),I=l(36195),le=l(36580),Z=l(2863),y=l(43173),L=l(22429);const M=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Q=new Set,V=typeof process=="object"&&process?process:{},G=(c,t,e,r)=>{typeof V.emitWarning=="function"?V.emitWarning(c,t,e,r):console.error(`[${e}] ${t}: ${c}`)};let T=globalThis.AbortController,U=globalThis.AbortSignal;if(typeof T>"u"){U=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(r,a){this._onabort.push(a)}},T=class{constructor(){t()}signal=new U;abort(r){if(!this.signal.aborted){this.signal.reason=r,this.signal.aborted=!0;for(const a of this.signal._onabort)a(r);this.signal.onabort?.(r)}}};let c=V.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const t=()=>{c&&(c=!1,G("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}const R=c=>!Q.has(c),H=Symbol("type"),p=c=>c&&c===Math.floor(c)&&c>0&&isFinite(c),m=c=>p(c)?c<=Math.pow(2,8)?Uint8Array:c<=Math.pow(2,16)?Uint16Array:c<=Math.pow(2,32)?Uint32Array:c<=Number.MAX_SAFE_INTEGER?w:null:null;class w extends Array{constructor(t){super(t),this.fill(0)}}class N{heap;length;static#l=!1;static create(t){const e=m(t);if(!e)return[];N.#l=!0;const r=new N(t,e);return N.#l=!1,r}constructor(t,e){if(!N.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}}class X{#l;#d;#p;#m;#F;#_;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#n;#O;#a;#r;#e;#u;#f;#o;#s;#v;#i;#y;#b;#h;#P;#L;#c;static unsafeExposeInternals(t){return{starts:t.#b,ttls:t.#h,sizes:t.#y,keyMap:t.#a,keyList:t.#r,valList:t.#e,next:t.#u,prev:t.#f,get head(){return t.#o},get tail(){return t.#s},free:t.#v,isBackgroundFetch:e=>t.#t(e),backgroundFetch:(e,r,a,n)=>t.#A(e,r,a,n),moveToTail:e=>t.#R(e),indexes:e=>t.#E(e),rindexes:e=>t.#x(e),isStale:e=>t.#g(e)}}get max(){return this.#l}get maxSize(){return this.#d}get calculatedSize(){return this.#O}get size(){return this.#n}get fetchMethod(){return this.#F}get memoMethod(){return this.#_}get dispose(){return this.#p}get disposeAfter(){return this.#m}constructor(t){const{max:e=0,ttl:r,ttlResolution:a=1,ttlAutopurge:n,updateAgeOnGet:o,updateAgeOnHas:f,allowStale:h,dispose:$,disposeAfter:B,noDisposeOnSet:F,noUpdateTTL:W,maxSize:k=0,maxEntrySize:ee=0,sizeCalculation:re,fetchMethod:he,memoMethod:ne,noDeleteOnFetchRejection:Oe,noDeleteOnStaleGet:Le,allowStaleOnFetchRejection:be,allowStaleOnFetchAbort:Se,ignoreFetchAbort:Te}=t;if(e!==0&&!p(e))throw new TypeError("max option must be a nonnegative integer");const Re=e?m(e):Array;if(!Re)throw new Error("invalid max value: "+e);if(this.#l=e,this.#d=k,this.maxEntrySize=ee||this.#d,this.sizeCalculation=re,this.sizeCalculation){if(!this.#d&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(ne!==void 0&&typeof ne!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#_=ne,he!==void 0&&typeof he!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#F=he,this.#L=!!he,this.#a=new Map,this.#r=new Array(e).fill(void 0),this.#e=new Array(e).fill(void 0),this.#u=new Re(e),this.#f=new Re(e),this.#o=0,this.#s=0,this.#v=N.create(e),this.#n=0,this.#O=0,typeof $=="function"&&(this.#p=$),typeof B=="function"?(this.#m=B,this.#i=[]):(this.#m=void 0,this.#i=void 0),this.#P=!!this.#p,this.#c=!!this.#m,this.noDisposeOnSet=!!F,this.noUpdateTTL=!!W,this.noDeleteOnFetchRejection=!!Oe,this.allowStaleOnFetchRejection=!!be,this.allowStaleOnFetchAbort=!!Se,this.ignoreFetchAbort=!!Te,this.maxEntrySize!==0){if(this.#d!==0&&!p(this.#d))throw new TypeError("maxSize must be a positive integer if specified");if(!p(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#W()}if(this.allowStale=!!h,this.noDeleteOnStaleGet=!!Le,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!f,this.ttlResolution=p(a)||a===0?a:1,this.ttlAutopurge=!!n,this.ttl=r||0,this.ttl){if(!p(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#C()}if(this.#l===0&&this.ttl===0&&this.#d===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#d){const Qe="LRU_CACHE_UNBOUNDED";R(Qe)&&(Q.add(Qe),G("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",Qe,X))}}getRemainingTTL(t){return this.#a.has(t)?1/0:0}#C(){const t=new w(this.#l),e=new w(this.#l);this.#h=t,this.#b=e,this.#M=(n,o,f=M.now())=>{if(e[n]=o!==0?f:0,t[n]=o,o!==0&&this.ttlAutopurge){const h=setTimeout(()=>{this.#g(n)&&this.#$(this.#r[n],"expire")},o+1);h.unref&&h.unref()}},this.#S=n=>{e[n]=t[n]!==0?M.now():0},this.#Q=(n,o)=>{if(t[o]){const f=t[o],h=e[o];if(!f||!h)return;n.ttl=f,n.start=h,n.now=r||a();const $=n.now-h;n.remainingTTL=f-$}};let r=0;const a=()=>{const n=M.now();if(this.ttlResolution>0){r=n;const o=setTimeout(()=>r=0,this.ttlResolution);o.unref&&o.unref()}return n};this.getRemainingTTL=n=>{const o=this.#a.get(n);if(o===void 0)return 0;const f=t[o],h=e[o];if(!f||!h)return 1/0;const $=(r||a())-h;return f-$},this.#g=n=>{const o=e[n],f=t[n];return!!f&&!!o&&(r||a())-o>f}}#S=()=>{};#Q=()=>{};#M=()=>{};#g=()=>!1;#W(){const t=new w(this.#l);this.#O=0,this.#y=t,this.#T=e=>{this.#O-=t[e],t[e]=0},this.#U=(e,r,a,n)=>{if(this.#t(r))return 0;if(!p(a))if(n){if(typeof n!="function")throw new TypeError("sizeCalculation must be a function");if(a=n(r,e),!p(a))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return a},this.#w=(e,r,a)=>{if(t[e]=r,this.#d){const n=this.#d-t[e];for(;this.#O>n;)this.#D(!0)}this.#O+=t[e],a&&(a.entrySize=r,a.totalCalculatedSize=this.#O)}}#T=t=>{};#w=(t,e,r)=>{};#U=(t,e,r,a)=>{if(r||a)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#E({allowStale:t=this.allowStale}={}){if(this.#n)for(let e=this.#s;!(!this.#X(e)||((t||!this.#g(e))&&(yield e),e===this.#o));)e=this.#f[e]}*#x({allowStale:t=this.allowStale}={}){if(this.#n)for(let e=this.#o;!(!this.#X(e)||((t||!this.#g(e))&&(yield e),e===this.#s));)e=this.#u[e]}#X(t){return t!==void 0&&this.#a.get(this.#r[t])===t}*entries(){for(const t of this.#E())this.#e[t]!==void 0&&this.#r[t]!==void 0&&!this.#t(this.#e[t])&&(yield[this.#r[t],this.#e[t]])}*rentries(){for(const t of this.#x())this.#e[t]!==void 0&&this.#r[t]!==void 0&&!this.#t(this.#e[t])&&(yield[this.#r[t],this.#e[t]])}*keys(){for(const t of this.#E()){const e=this.#r[t];e!==void 0&&!this.#t(this.#e[t])&&(yield e)}}*rkeys(){for(const t of this.#x()){const e=this.#r[t];e!==void 0&&!this.#t(this.#e[t])&&(yield e)}}*values(){for(const t of this.#E())this.#e[t]!==void 0&&!this.#t(this.#e[t])&&(yield this.#e[t])}*rvalues(){for(const t of this.#x())this.#e[t]!==void 0&&!this.#t(this.#e[t])&&(yield this.#e[t])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(t,e={}){for(const r of this.#E()){const a=this.#e[r],n=this.#t(a)?a.__staleWhileFetching:a;if(n!==void 0&&t(n,this.#r[r],this))return this.get(this.#r[r],e)}}forEach(t,e=this){for(const r of this.#E()){const a=this.#e[r],n=this.#t(a)?a.__staleWhileFetching:a;n!==void 0&&t.call(e,n,this.#r[r],this)}}rforEach(t,e=this){for(const r of this.#x()){const a=this.#e[r],n=this.#t(a)?a.__staleWhileFetching:a;n!==void 0&&t.call(e,n,this.#r[r],this)}}purgeStale(){let t=!1;for(const e of this.#x({allowStale:!0}))this.#g(e)&&(this.#$(this.#r[e],"expire"),t=!0);return t}info(t){const e=this.#a.get(t);if(e===void 0)return;const r=this.#e[e],a=this.#t(r)?r.__staleWhileFetching:r;if(a===void 0)return;const n={value:a};if(this.#h&&this.#b){const o=this.#h[e],f=this.#b[e];if(o&&f){const h=o-(M.now()-f);n.ttl=h,n.start=Date.now()}}return this.#y&&(n.size=this.#y[e]),n}dump(){const t=[];for(const e of this.#E({allowStale:!0})){const r=this.#r[e],a=this.#e[e],n=this.#t(a)?a.__staleWhileFetching:a;if(n===void 0||r===void 0)continue;const o={value:n};if(this.#h&&this.#b){o.ttl=this.#h[e];const f=M.now()-this.#b[e];o.start=Math.floor(Date.now()-f)}this.#y&&(o.size=this.#y[e]),t.unshift([r,o])}return t}load(t){this.clear();for(const[e,r]of t){if(r.start){const a=Date.now()-r.start;r.start=M.now()-a}this.set(e,r.value,r)}}set(t,e,r={}){if(e===void 0)return this.delete(t),this;const{ttl:a=this.ttl,start:n,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:f=this.sizeCalculation,status:h}=r;let{noUpdateTTL:$=this.noUpdateTTL}=r;const B=this.#U(t,e,r.size||0,f);if(this.maxEntrySize&&B>this.maxEntrySize)return h&&(h.set="miss",h.maxEntrySizeExceeded=!0),this.#$(t,"set"),this;let F=this.#n===0?void 0:this.#a.get(t);if(F===void 0)F=this.#n===0?this.#s:this.#v.length!==0?this.#v.pop():this.#n===this.#l?this.#D(!1):this.#n,this.#r[F]=t,this.#e[F]=e,this.#a.set(t,F),this.#u[this.#s]=F,this.#f[F]=this.#s,this.#s=F,this.#n++,this.#w(F,B,h),h&&(h.set="add"),$=!1;else{this.#R(F);const W=this.#e[F];if(e!==W){if(this.#L&&this.#t(W)){W.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:k}=W;k!==void 0&&!o&&(this.#P&&this.#p?.(k,t,"set"),this.#c&&this.#i?.push([k,t,"set"]))}else o||(this.#P&&this.#p?.(W,t,"set"),this.#c&&this.#i?.push([W,t,"set"]));if(this.#T(F),this.#w(F,B,h),this.#e[F]=e,h){h.set="replace";const k=W&&this.#t(W)?W.__staleWhileFetching:W;k!==void 0&&(h.oldValue=k)}}else h&&(h.set="update")}if(a!==0&&!this.#h&&this.#C(),this.#h&&($||this.#M(F,a,n),h&&this.#Q(h,F)),!o&&this.#c&&this.#i){const W=this.#i;let k;for(;k=W?.shift();)this.#m?.(...k)}return this}pop(){try{for(;this.#n;){const t=this.#e[this.#o];if(this.#D(!0),this.#t(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(t!==void 0)return t}}finally{if(this.#c&&this.#i){const t=this.#i;let e;for(;e=t?.shift();)this.#m?.(...e)}}}#D(t){const e=this.#o,r=this.#r[e],a=this.#e[e];return this.#L&&this.#t(a)?a.__abortController.abort(new Error("evicted")):(this.#P||this.#c)&&(this.#P&&this.#p?.(a,r,"evict"),this.#c&&this.#i?.push([a,r,"evict"])),this.#T(e),t&&(this.#r[e]=void 0,this.#e[e]=void 0,this.#v.push(e)),this.#n===1?(this.#o=this.#s=0,this.#v.length=0):this.#o=this.#u[e],this.#a.delete(r),this.#n--,e}has(t,e={}){const{updateAgeOnHas:r=this.updateAgeOnHas,status:a}=e,n=this.#a.get(t);if(n!==void 0){const o=this.#e[n];if(this.#t(o)&&o.__staleWhileFetching===void 0)return!1;if(this.#g(n))a&&(a.has="stale",this.#Q(a,n));else return r&&this.#S(n),a&&(a.has="hit",this.#Q(a,n)),!0}else a&&(a.has="miss");return!1}peek(t,e={}){const{allowStale:r=this.allowStale}=e,a=this.#a.get(t);if(a===void 0||!r&&this.#g(a))return;const n=this.#e[a];return this.#t(n)?n.__staleWhileFetching:n}#A(t,e,r,a){const n=e===void 0?void 0:this.#e[e];if(this.#t(n))return n;const o=new T,{signal:f}=r;f?.addEventListener("abort",()=>o.abort(f.reason),{signal:o.signal});const h={signal:o.signal,options:r,context:a},$=(re,he=!1)=>{const{aborted:ne}=o.signal,Oe=r.ignoreFetchAbort&&re!==void 0;if(r.status&&(ne&&!he?(r.status.fetchAborted=!0,r.status.fetchError=o.signal.reason,Oe&&(r.status.fetchAbortIgnored=!0)):r.status.fetchResolved=!0),ne&&!Oe&&!he)return F(o.signal.reason);const Le=k;return this.#e[e]===k&&(re===void 0?Le.__staleWhileFetching?this.#e[e]=Le.__staleWhileFetching:this.#$(t,"fetch"):(r.status&&(r.status.fetchUpdated=!0),this.set(t,re,h.options))),re},B=re=>(r.status&&(r.status.fetchRejected=!0,r.status.fetchError=re),F(re)),F=re=>{const{aborted:he}=o.signal,ne=he&&r.allowStaleOnFetchAbort,Oe=ne||r.allowStaleOnFetchRejection,Le=Oe||r.noDeleteOnFetchRejection,be=k;if(this.#e[e]===k&&(!Le||be.__staleWhileFetching===void 0?this.#$(t,"fetch"):ne||(this.#e[e]=be.__staleWhileFetching)),Oe)return r.status&&be.__staleWhileFetching!==void 0&&(r.status.returnedStale=!0),be.__staleWhileFetching;if(be.__returned===be)throw re},W=(re,he)=>{const ne=this.#F?.(t,n,h);ne&&ne instanceof Promise&&ne.then(Oe=>re(Oe===void 0?void 0:Oe),he),o.signal.addEventListener("abort",()=>{(!r.ignoreFetchAbort||r.allowStaleOnFetchAbort)&&(re(void 0),r.allowStaleOnFetchAbort&&(re=Oe=>$(Oe,!0)))})};r.status&&(r.status.fetchDispatched=!0);const k=new Promise(W).then($,B),ee=Object.assign(k,{__abortController:o,__staleWhileFetching:n,__returned:void 0});return e===void 0?(this.set(t,ee,{...h.options,status:void 0}),e=this.#a.get(t)):this.#e[e]=ee,ee}#t(t){if(!this.#L)return!1;const e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof T}async fetch(t,e={}){const{allowStale:r=this.allowStale,updateAgeOnGet:a=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:f=this.noDisposeOnSet,size:h=0,sizeCalculation:$=this.sizeCalculation,noUpdateTTL:B=this.noUpdateTTL,noDeleteOnFetchRejection:F=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:W=this.allowStaleOnFetchRejection,ignoreFetchAbort:k=this.ignoreFetchAbort,allowStaleOnFetchAbort:ee=this.allowStaleOnFetchAbort,context:re,forceRefresh:he=!1,status:ne,signal:Oe}=e;if(!this.#L)return ne&&(ne.fetch="get"),this.get(t,{allowStale:r,updateAgeOnGet:a,noDeleteOnStaleGet:n,status:ne});const Le={allowStale:r,updateAgeOnGet:a,noDeleteOnStaleGet:n,ttl:o,noDisposeOnSet:f,size:h,sizeCalculation:$,noUpdateTTL:B,noDeleteOnFetchRejection:F,allowStaleOnFetchRejection:W,allowStaleOnFetchAbort:ee,ignoreFetchAbort:k,status:ne,signal:Oe};let be=this.#a.get(t);if(be===void 0){ne&&(ne.fetch="miss");const Se=this.#A(t,be,Le,re);return Se.__returned=Se}else{const Se=this.#e[be];if(this.#t(Se)){const Me=r&&Se.__staleWhileFetching!==void 0;return ne&&(ne.fetch="inflight",Me&&(ne.returnedStale=!0)),Me?Se.__staleWhileFetching:Se.__returned=Se}const Te=this.#g(be);if(!he&&!Te)return ne&&(ne.fetch="hit"),this.#R(be),a&&this.#S(be),ne&&this.#Q(ne,be),Se;const Re=this.#A(t,be,Le,re),Xe=Re.__staleWhileFetching!==void 0&&r;return ne&&(ne.fetch=Te?"stale":"refresh",Xe&&Te&&(ne.returnedStale=!0)),Xe?Re.__staleWhileFetching:Re.__returned=Re}}async forceFetch(t,e={}){const r=await this.fetch(t,e);if(r===void 0)throw new Error("fetch() returned undefined");return r}memo(t,e={}){const r=this.#_;if(!r)throw new Error("no memoMethod provided to constructor");const{context:a,forceRefresh:n,...o}=e,f=this.get(t,o);if(!n&&f!==void 0)return f;const h=r(t,f,{options:o,context:a});return this.set(t,h,o),h}get(t,e={}){const{allowStale:r=this.allowStale,updateAgeOnGet:a=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,status:o}=e,f=this.#a.get(t);if(f!==void 0){const h=this.#e[f],$=this.#t(h);return o&&this.#Q(o,f),this.#g(f)?(o&&(o.get="stale"),$?(o&&r&&h.__staleWhileFetching!==void 0&&(o.returnedStale=!0),r?h.__staleWhileFetching:void 0):(n||this.#$(t,"expire"),o&&r&&(o.returnedStale=!0),r?h:void 0)):(o&&(o.get="hit"),$?h.__staleWhileFetching:(this.#R(f),a&&this.#S(f),h))}else o&&(o.get="miss")}#I(t,e){this.#f[e]=t,this.#u[t]=e}#R(t){t!==this.#s&&(t===this.#o?this.#o=this.#u[t]:this.#I(this.#f[t],this.#u[t]),this.#I(this.#s,t),this.#s=t)}delete(t){return this.#$(t,"delete")}#$(t,e){let r=!1;if(this.#n!==0){const a=this.#a.get(t);if(a!==void 0)if(r=!0,this.#n===1)this.#N(e);else{this.#T(a);const n=this.#e[a];if(this.#t(n)?n.__abortController.abort(new Error("deleted")):(this.#P||this.#c)&&(this.#P&&this.#p?.(n,t,e),this.#c&&this.#i?.push([n,t,e])),this.#a.delete(t),this.#r[a]=void 0,this.#e[a]=void 0,a===this.#s)this.#s=this.#f[a];else if(a===this.#o)this.#o=this.#u[a];else{const o=this.#f[a];this.#u[o]=this.#u[a];const f=this.#u[a];this.#f[f]=this.#f[a]}this.#n--,this.#v.push(a)}}if(this.#c&&this.#i?.length){const a=this.#i;let n;for(;n=a?.shift();)this.#m?.(...n)}return r}clear(){return this.#N("delete")}#N(t){for(const e of this.#x({allowStale:!0})){const r=this.#e[e];if(this.#t(r))r.__abortController.abort(new Error("deleted"));else{const a=this.#r[e];this.#P&&this.#p?.(r,a,t),this.#c&&this.#i?.push([r,a,t])}}if(this.#a.clear(),this.#e.fill(void 0),this.#r.fill(void 0),this.#h&&this.#b&&(this.#h.fill(0),this.#b.fill(0)),this.#y&&this.#y.fill(0),this.#o=0,this.#s=0,this.#v.length=0,this.#O=0,this.#n=0,this.#c&&this.#i){const e=this.#i;let r;for(;r=e?.shift();)this.#m?.(...r)}}}var D=l(94644),ue=l(22592),q=l(22420),te=l(24162),x=l(32783),u=l(69457),s=l(12282);const i=1e6,g="{}",E=["__aggregated_metric__","__tenant_id__","__stream_shard__"];class C extends D.Is{constructor(t,e){super(),this.started=!1,this.seriesCache=new X({max:10}),this.labelsCache=new X({max:10}),this.detectedFieldValuesCache=new X({max:10}),this.labelsPromisesCache=new X({max:10}),this.detectedLabelValuesPromisesCache=new X({max:10}),this.request=async(r,a,n,o)=>{try{return await this.datasource.metadataRequest(r,a,o)}catch(f){if(n)throw f;console.error(f)}},this.start=r=>{const a=r??this.getDefaultTimeRange(),n=this.datasource.getTimeRangeParams(a),o=this.startedTimeRange?this.datasource.getTimeRangeParams(this.startedTimeRange):null;return(!this.startTask||!o||n.start!==o.start||n.end!==o.end)&&(this.startedTimeRange=a,this.startTask=this.fetchLabels({timeRange:a}).then(()=>(this.started=!0,[]))),this.startTask},this.fetchSeriesLabels=async(r,a)=>{const n=this.datasource.interpolateString(r),o="series",f=a?.timeRange??this.getDefaultTimeRange(),{start:h,end:$}=this.datasource.getTimeRangeParams(f),B=this.generateCacheKey(o,h,$,n);let F=this.seriesCache.get(B);if(!F){const W={"match[]":n,start:h,end:$},k=await this.request(o,W);if(!Array.isArray(k))return{};const{values:ee}=(0,q.P7)(k);F=ee,this.seriesCache.set(B,F)}return F},this.fetchSeries=async(r,a)=>{const n="series",o=a?.timeRange??this.getDefaultTimeRange(),{start:f,end:h}=this.datasource.getTimeRangeParams(o),$={"match[]":r,start:f,end:h};return await this.request(n,$)},this.datasource=t,this.labelKeys=[],Object.assign(this,e)}getLabelKeys(){return this.labelKeys}importFromAbstractQuery(t){return{refId:t.refId,expr:(0,q.tt)(t),queryType:s.U3.Range}}exportToAbstractQuery(t){if(!t.expr||t.expr.length===0)return{refId:t.refId,labelMatchers:[]};const r=(0,te.pk)(t.expr).map(a=>(0,x.u_)(a).query.labels.map(f=>({name:f.label,value:f.value,operator:q.sM[f.op]})));return{refId:t.refId,labelMatchers:(0,b.flatten)(r)}}async fetchLabels(t){if(y.$.featureToggles.lokiLabelNamesQueryApi||!t?.streamSelector)return this.fetchLabelsByLabelsEndpoint(t);{const e=await this.fetchSeriesLabels(t.streamSelector,{timeRange:t.timeRange});return Object.keys(e??{})}}async fetchLabelsByLabelsEndpoint(t){const e="labels",r=t?.timeRange??this.getDefaultTimeRange(),{start:a,end:n}=this.datasource.getTimeRangeParams(r),o={start:a,end:n};t?.streamSelector&&t?.streamSelector!==g&&(o.query=t.streamSelector);const f=await this.request(e,o);if(Array.isArray(f)){const h=Array.from(new Set(f)).slice().sort().filter($=>E.includes($)===!1);return this.labelKeys=h,this.labelKeys}return[]}generateCacheKey(t,e,r,a){return[t,this.roundTime(e),this.roundTime(r),a].join()}roundTime(t){return t?Math.floor(t/i/1e3/60/5):0}async fetchDetectedFields(t,e){const r=t.expr&&t.expr!==g?this.datasource.interpolateString(t.expr,t.scopedVars):void 0;if(!r)throw new Error("fetchDetectedFields requires query expression");const a="detected_fields",n=t?.timeRange??this.getDefaultTimeRange(),o=this.datasource.getTimeRangeParams(n),{start:f,end:h}=o,$={start:f,end:h,limit:t?.limit??1e3};return $.query=r,new Promise(async(B,F)=>{try{const W=await this.request(a,$,!0,e);B(W)}catch(W){console.error("error",W),F(W)}})}async fetchDetectedFieldValues(t,e,r){return this.fetchDetectedLabelValues(t,e,r)}async fetchDetectedLabelValues(t,e,r){const a=encodeURIComponent(this.datasource.interpolateString(t)),n=e?.expr&&e.expr!==g?this.datasource.interpolateString(e.expr,e.scopedVars):void 0,o=`detected_field/${a}/values`,f=e?.timeRange??this.getDefaultTimeRange(),h=this.datasource.getTimeRangeParams(f),{start:$,end:B}=h,F={start:$,end:B,limit:e?.limit??1e3};let W=a;n&&(F.query=n,W+=n);const k=this.generateCacheKey(o,$,B,W),ee=this.detectedFieldValuesCache.get(k);if(ee)return ee;let re=this.detectedLabelValuesPromisesCache.get(k);return re||(re=new Promise(async(he,ne)=>{try{const Oe=await this.request(o,F,e?.throwError,r);if(Array.isArray(Oe)){const Le=Oe.slice().sort();this.detectedFieldValuesCache.set(k,Le),this.detectedLabelValuesPromisesCache.delete(k),he(Le)}}catch(Oe){e?.throwError?ne(Oe):(console.error(Oe),he([]))}}),this.detectedLabelValuesPromisesCache.set(k,re),re)}async fetchLabelValues(t,e){const r=encodeURIComponent(this.datasource.interpolateString(t)),a=e?.streamSelector&&e.streamSelector!==g?this.datasource.interpolateString(e.streamSelector):void 0,n=`label/${r}/values`,o=e?.timeRange??this.getDefaultTimeRange(),f=this.datasource.getTimeRangeParams(o),{start:h,end:$}=f,B={start:h,end:$};let F=r;a&&(B.query=a,F+=a);const W=this.generateCacheKey(n,h,$,F),k=this.labelsCache.get(W);if(k)return k;let ee=this.labelsPromisesCache.get(W);return ee||(ee=new Promise(async re=>{try{const he=await this.request(n,B);if(Array.isArray(he)){const ne=he.slice().sort();this.labelsCache.set(W,ne),this.labelsPromisesCache.delete(W),re(ne)}}catch(he){console.error(he),re([])}}),this.labelsPromisesCache.set(W,ee),ee)}async getParserAndLabelKeys(t,e){const r={extractedLabelKeys:[],structuredMetadataKeys:[],unwrapLabelKeys:[],hasJSON:!1,hasLogfmt:!1,hasPack:!1};if(!y.$.featureToggles.lokiQueryHints)return r;const a=await this.datasource.getDataSamples({expr:t,refId:"data-samples",maxLines:e?.maxLines||He},e?.timeRange??this.getDefaultTimeRange());if(!a.length)return r;const{hasLogfmt:n,hasJSON:o,hasPack:f}=(0,u.YB)(a[0]);return{extractedLabelKeys:[...(0,u.fV)(a[0],s.HD.Indexed),...(0,u.fV)(a[0],s.HD.Parsed)],structuredMetadataKeys:(0,u.fV)(a[0],s.HD.StructuredMetadata),unwrapLabelKeys:(0,u.aN)(a[0]),hasJSON:o,hasPack:f,hasLogfmt:n}}getDefaultTimeRange(){return(0,ue.E2)()}}var z=l(39697),se=l(37748),fe=l(69862),pe=l(69850),Pe=l(31635),ve=l(13752),$e=l(75508),Ce=l(88483),Ie=l(64423),ze=l(39741),lr={url:"",deserializer:function(c){return JSON.parse(c.data)},serializer:function(c){return JSON.stringify(c)}},ur="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",cr=function(c){(0,Pe.__extends)(t,c);function t(e,r){var a=c.call(this)||this;if(a._socket=null,e instanceof Ce.c)a.destination=r,a.source=e;else{var n=a._config=(0,Pe.__assign)({},lr);if(a._output=new ve.B,typeof e=="string")n.url=e;else for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);if(!n.WebSocketCtor&&WebSocket)n.WebSocketCtor=WebSocket;else if(!n.WebSocketCtor)throw new Error("no WebSocket constructor can be found");a.destination=new ze.m}return a}return t.prototype.lift=function(e){var r=new t(this._config,this.destination);return r.operator=e,r.source=this,r},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new ze.m),this._output=new ve.B},t.prototype.multiplex=function(e,r,a){var n=this;return new Ce.c(function(o){try{n.next(e())}catch(h){o.error(h)}var f=n.subscribe({next:function(h){try{a(h)&&o.next(h)}catch($){o.error($)}},error:function(h){return o.error(h)},complete:function(){return o.complete()}});return function(){try{n.next(r())}catch(h){o.error(h)}f.unsubscribe()}})},t.prototype._connectSocket=function(){var e=this,r=this._config,a=r.WebSocketCtor,n=r.protocol,o=r.url,f=r.binaryType,h=this._output,$=null;try{$=n?new a(o,n):new a(o),this._socket=$,f&&(this._socket.binaryType=f)}catch(F){h.error(F);return}var B=new Ie.yU(function(){e._socket=null,$&&$.readyState===1&&$.close()});$.onopen=function(F){var W=e._socket;if(!W){$.close(),e._resetState();return}var k=e._config.openObserver;k&&k.next(F);var ee=e.destination;e.destination=$e.vU.create(function(re){if($.readyState===1)try{var he=e._config.serializer;$.send(he(re))}catch(ne){e.destination.error(ne)}},function(re){var he=e._config.closingObserver;he&&he.next(void 0),re&&re.code?$.close(re.code,re.reason):h.error(new TypeError(ur)),e._resetState()},function(){var re=e._config.closingObserver;re&&re.next(void 0),$.close(),e._resetState()}),ee&&ee instanceof ze.m&&B.add(ee.subscribe(e.destination))},$.onerror=function(F){e._resetState(),h.error(F)},$.onclose=function(F){$===e._socket&&e._resetState();var W=e._config.closeObserver;W&&W.next(F),F.wasClean?h.complete():h.error(F)},$.onmessage=function(F){try{var W=e._config.deserializer;h.next(W(F))}catch(k){h.error(k)}}},t.prototype._subscribe=function(e){var r=this,a=this.source;return a?a.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add(function(){var n=r._socket;r._output.observers.length===0&&(n&&(n.readyState===1||n.readyState===0)&&n.close(),r._resetState())}),e)},t.prototype.unsubscribe=function(){var e=this._socket;e&&(e.readyState===1||e.readyState===0)&&e.close(),this._resetState(),c.prototype.unsubscribe.call(this)},t}(ve.k);function ht(c){return new cr(c)}var dr=l(35479),_e=l(95004);function gt(c,t,e,r){switch(c){case 0:return t&e^~t&r;case 1:return t^e^r;case 2:return t&e^t&r^e&r;case 3:return t^e^r}}function Ke(c,t){return c<<t|c>>>32-t}function pt(c){const t=[1518500249,1859775393,2400959708,3395469782],e=[1732584193,4023233417,2562383102,271733878,3285377520],r=new Uint8Array(c.length+1);r.set(c),r[c.length]=128,c=r;const a=c.length/4+2,n=Math.ceil(a/16),o=new Array(n);for(let f=0;f<n;++f){const h=new Uint32Array(16);for(let $=0;$<16;++$)h[$]=c[f*64+$*4]<<24|c[f*64+$*4+1]<<16|c[f*64+$*4+2]<<8|c[f*64+$*4+3];o[f]=h}o[n-1][14]=(c.length-1)*8/Math.pow(2,32),o[n-1][14]=Math.floor(o[n-1][14]),o[n-1][15]=(c.length-1)*8&4294967295;for(let f=0;f<n;++f){const h=new Uint32Array(80);for(let ee=0;ee<16;++ee)h[ee]=o[f][ee];for(let ee=16;ee<80;++ee)h[ee]=Ke(h[ee-3]^h[ee-8]^h[ee-14]^h[ee-16],1);let $=e[0],B=e[1],F=e[2],W=e[3],k=e[4];for(let ee=0;ee<80;++ee){const re=Math.floor(ee/20),he=Ke($,5)+gt(re,B,F,W)+k+t[re]+h[ee]>>>0;k=W,W=F,F=Ke(B,30)>>>0,B=$,$=he}e[0]=e[0]+$>>>0,e[1]=e[1]+B>>>0,e[2]=e[2]+F>>>0,e[3]=e[3]+W>>>0,e[4]=e[4]+k>>>0}return Uint8Array.of(e[0]>>24,e[0]>>16,e[0]>>8,e[0],e[1]>>24,e[1]>>16,e[1]>>8,e[1],e[2]>>24,e[2]>>16,e[2]>>8,e[2],e[3]>>24,e[3]>>16,e[3]>>8,e[3],e[4]>>24,e[4]>>16,e[4]>>8,e[4])}const mt=pt;var fr=l(41391);function hr(c){if(!(0,fr.A)(c))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(c.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,t&255,(t=parseInt(c.slice(9,13),16))>>>8,t&255,(t=parseInt(c.slice(14,18),16))>>>8,t&255,(t=parseInt(c.slice(19,23),16))>>>8,t&255,(t=parseInt(c.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255)}const Ot=hr;var gr=l(71060);function pr(c){c=unescape(encodeURIComponent(c));const t=new Uint8Array(c.length);for(let e=0;e<c.length;++e)t[e]=c.charCodeAt(e);return t}const mr="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Or="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function vr(c,t,e,r,a,n){const o=typeof e=="string"?pr(e):e,f=typeof r=="string"?Ot(r):r;if(typeof r=="string"&&(r=Ot(r)),r?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let h=new Uint8Array(16+o.length);if(h.set(f),h.set(o,f.length),h=t(h),h[6]=h[6]&15|c,h[8]=h[8]&63|128,a){n=n||0;for(let $=0;$<16;++$)a[n+$]=h[$];return a}return(0,gr.k)(h)}function qe(c,t,e,r){return vr(80,mt,c,t,e,r)}qe.DNS=mr,qe.URL=Or;const yr=qe,br="6ec946da-0f49-47a8-983a-1d76d17e7c92";function Pr(c,t){const e=c.streams;if(!e||!e.length)return;const r=t.fields[0],a=t.fields[1],n=t.fields[2],o={};for(const f of e){const h=Object.entries(f.stream).map(([$,B])=>`${$}="${B}"`).sort().join("");for(const[$,B]of f.values)r.values.push(new Date(parseInt($.slice(0,-6),10)).toISOString()),a.values.push(B),n.values.push(vt($,h,B,o,t.refId))}}function vt(c,t,e,r,a){let n=yr(`${c}_${t}_${e}`,br);if(n in r){const o=r[n]+1;r[n]=o,n=`${n}_${o}`}else r[n]=0;return a?`${a}_${n}`:n}class yt{constructor(){this.streams={}}getStream(t,e=5e3){let r=this.streams[t.url];if(r)return r;const a=new dr.x({capacity:t.size});return a.addField({name:"Time",type:_e.PU.time,config:{}}),a.addField({name:"Line",type:_e.PU.string}),a.addField({name:"id",type:_e.PU.string}),a.meta={...a.meta,preferredVisualisationType:"logs"},a.refId=t.refId,r=ht(t.url).pipe((0,ie.T)(n=>(Pr(n,a),[a])),(0,se.l)(n=>n.pipe((0,fe.Z)((o,f)=>{const h=f+1;return o.code===1006&&h<30?(h>10&&console.warn(`Websocket connection is being disrupted. We keep reconnecting but consider starting new live tailing again. Error: ${o.reason}`),(0,z.O)(e)):(0,Y.$)(o)}))),(0,pe.j)(()=>{delete this.streams[t.url]})),this.streams[t.url]=r,r}}var Ae=l(25229),bt=l(10279),ce=l(74848),we=l(22803),Ee=l(96540),Pt=l(16817),Er=l(67458),Et=l(54078),Ue=l(27489),xr=l(63142),$r=l(34999),et=l(45967),xt=l(45861),$t=l(89599),Qt=l(30703),Lt=l(68079),tt=l(72636),We=l(18857),rt=l(97095),Ge=l(18027),St=l(70663),Tt=l(21285),Rt=l(77236);function Qr(c){return{labels:(0,we.css)({display:"flex",gap:c.spacing(.5)}),wrapper:(0,we.css)({display:"flex",flexDirection:"column",flex:1,gap:c.spacing(.5),position:"relative"}),textWrapper:(0,we.css)({display:"flex",alignItems:"center"}),hidden:(0,we.css)({visibility:"hidden"}),label:(0,we.css)({maxWidth:"100%","&:first-of-type":{marginBottom:c.spacing(2)},"&:not(:first-of-type)":{margin:c.spacing(2,0)}}),rawQueryContainer:(0,we.css)({textAlign:"start",lineBreak:"anywhere",marginTop:c.spacing(-.25),marginRight:c.spacing(6),minHeight:c.spacing(4)}),ui:(0,we.css)({backgroundColor:c.colors.background.secondary,padding:c.spacing(2)}),notification:(0,we.css)({position:"absolute",zIndex:c.zIndex.portal,top:0,right:0}),rawQuery:(0,we.css)({display:"inline"}),queryDescription:(0,we.css)({marginLeft:c.spacing(.5)}),iconButton:(0,we.css)({position:"absolute",top:c.spacing(1),right:c.spacing(1),zIndex:c.zIndex.navbarFixed}),operationsToggle:(0,we.css)({margin:c.spacing(1,0,-1,0),"& > div":{margin:0,"& > label":{padding:0}}})}}const at="isLogContextQueryUiOpen";function Lr(c){const{row:t,logContextProvider:e,updateFilter:r,onClose:a,origQuery:n,runContextQuery:o}=c,f=(0,xr.of)(Qr),[h,$]=(0,Ee.useState)([]),[B,F]=(0,Ee.useState)(!1),[W,k]=(0,Ee.useState)(!1),[ee,re]=(0,Ee.useState)(!1),[he,ne]=(0,Ee.useState)(window.localStorage.getItem(at)==="true"),[Oe,Le]=(0,Ee.useState)(window.localStorage.getItem(Ve)==="true"),be=(0,Ee.useRef)(),Se=(0,Ee.useRef)(!1),Te=(0,Ee.useRef)([]),Re=(0,Ee.useMemo)(()=>!(W&&h.some(me=>me.nonIndexed===me.enabled)||Oe&&e.queryContainsValidPipelineStages(n)),[h,Oe,W,e,n]);(0,Ee.useEffect)(()=>{if(W){if(!Se.current){Se.current=W;return}if(h.filter(({enabled:me,nonIndexed:De})=>me&&!De).length===0){$(Te.current);return}return Te.current=structuredClone(h),be.current&&clearTimeout(be.current),re(!0),be.current=window.setTimeout(()=>{r(h.filter(({enabled:De})=>De));const me={removedLabels:[],selectedExtractedLabels:[]};h.forEach(({enabled:De,nonIndexed:Fe,label:je})=>{!De&&!Fe&&me.removedLabels.push(je),De&&Fe&&me.selectedExtractedLabels.push(je)}),window.localStorage.setItem(ke,JSON.stringify(me)),re(!1)},1500),()=>{clearTimeout(be.current)}}},[h,W]),(0,Ee.useEffect)(()=>()=>{clearTimeout(be.current),a()},[a]),(0,Pt.A)(async()=>{re(!0);const me=await e.getInitContextFilters(t,n,{from:(0,Ae.KQ)(t.timeEpochMs),to:(0,Ae.KQ)(t.timeEpochMs),raw:{from:(0,Ae.KQ)(t.timeEpochMs),to:(0,Ae.KQ)(t.timeEpochMs)}});$(me.contextFilters),F(me.preservedFiltersApplied),k(!0),re(!1)}),(0,Ee.useEffect)(()=>{B&&setTimeout(()=>{F(!1)},2e3)},[B]),(0,Ee.useEffect)(()=>((0,Ue.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:t.uid,type:"load"}),()=>{(0,Ue.rR)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:t.uid,type:"unload"})}),[t.uid]);const Qe=h.filter(({nonIndexed:me})=>!me),Xe=Qe.filter(({enabled:me})=>me),Me=h.filter(({nonIndexed:me})=>me),or=Me.filter(({enabled:me})=>me),ft=(0,Ee.useCallback)(me=>({label:`${me.label}="${(0,q.Bb)(me.value)}"`,value:me.label}),[]),ra=Me.length>0;let aa=e.prepareExpression(h.filter(({enabled:me})=>me),n);return(0,ce.jsxs)("div",{className:f.wrapper,children:[B&&(0,ce.jsx)($r.F,{className:f.notification,title:"Previously used filters have been applied.",severity:"info",elevated:!0}),(0,ce.jsx)(et.m,{content:"Revert to initial log context query.",children:(0,ce.jsx)("div",{className:f.iconButton,children:(0,ce.jsx)(xt.$n,{"data-testid":"revert-button",icon:"history-alt",variant:"secondary",disabled:Re,onClick:me=>{(0,Ue.rR)("grafana_explore_logs_loki_log_context_reverted",{logRowUid:t.uid}),$(De=>De.map(Fe=>({...Fe,enabled:!Fe.nonIndexed}))),window.localStorage.removeItem(ke),window.localStorage.removeItem(Ve),Le(!1)}})})}),(0,ce.jsx)($t.S,{collapsible:!0,isOpen:he,onToggle:()=>{window.localStorage.setItem(at,(!he).toString()),ne(me=>!me),(0,Ue.rR)("grafana_explore_logs_loki_log_context_toggled",{logRowUid:t.uid,action:he?"close":"open"})},label:(0,ce.jsx)("div",{className:f.rawQueryContainer,children:W?(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsx)(Et.Z,{language:{grammar:Rt.vB,name:"loki"},query:aa,className:f.rawQuery}),(0,ce.jsx)(et.m,{content:"The initial log context query is created from all labels defining the stream for the selected log line. Use the editor below to customize the log context query.",children:(0,ce.jsx)(Qt.I,{name:"info-circle",size:"sm",className:f.queryDescription})})]}):(0,ce.jsx)(Lt.y,{})}),children:(0,ce.jsxs)("div",{className:f.ui,children:[(0,ce.jsx)(tt.J,{className:f.label,description:"The initial log context query is created from all labels defining the stream for the selected log line. You can broaden your search by removing one or more of the label filters.",children:"Widen the search"}),(0,ce.jsx)(We.KF,{isLoading:ee,options:Qe.map(ft),value:Xe.map(ft),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",onChange:(me,De)=>(De.action==="select-option"&&(0,Ue.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"label",action:"select"}),De.action==="remove-value"&&(0,Ue.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"label",action:"remove"}),$(h.map(Fe=>(Fe.nonIndexed||(Fe.enabled=me.some(je=>je.value===Fe.label)),Fe))))}),ra&&(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsx)(tt.J,{className:f.label,description:"By using a parser in your original query, you can use filters for extracted labels. Refine your search by applying extracted labels created from the selected log line.",children:"Refine the search"}),(0,ce.jsx)(We.KF,{isLoading:ee,options:Me.map(ft),value:or.map(ft),closeMenuOnSelect:!0,maxMenuHeight:200,noOptionsMessage:"No further labels available",isClearable:!0,onChange:(me,De)=>{De.action==="select-option"&&(0,Ue.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"parsed_label",action:"select"}),De.action==="remove-value"&&(0,Ue.rR)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"parsed_label",action:"remove"}),$(h.map(Fe=>(Fe.nonIndexed&&(Fe.enabled=me.some(je=>je.value===Fe.label)),Fe)))}})]}),e.queryContainsValidPipelineStages(n)&&(0,ce.jsx)(rt.C,{className:f.operationsToggle,children:(0,ce.jsx)(Ge.I,{label:"Include LogQL pipeline operations",tooltip:(0,ce.jsx)(St.I,{content:(0,Er.G)("This will include LogQL operations such as `line_format` or `label_format`. It won't include line or label filter operations.")}),children:(0,ce.jsx)(Tt.K,{value:Oe,showLabel:!0,transparent:!0,onChange:me=>{(0,Ue.rR)("grafana_explore_logs_loki_log_context_pipeline_toggled",{logRowUid:t.uid,action:me.currentTarget.checked?"enable":"disable"}),window.localStorage.setItem(Ve,me.currentTarget.checked.toString()),Le(me.currentTarget.checked),o&&o()}})})})]})})]})}var ye=l(35725),nt=(c=>(c[c.Ascending=0]="Ascending",c[c.Descending=1]="Descending",c))(nt||{});function Ft(c,t){const e=c.values,{nanos:r}=c,a=Array(e.length);for(let o=0;o<a.length;o++)a[o]=o;const n=t===0;return a.sort((o,f)=>{const h=e[o],$=e[f];if(h<$)return n?-1:1;if(h>$)return n?1:-1;if(r===void 0)return 0;const B=r[o],F=r[f];return B<F?n?-1:1:B>F?n?1:-1:0}),a}function _t(c,t){const{fields:e,...r}=c,a=e.find(o=>o.type===_e.PU.time);if(a===void 0)throw new Error("missing timestamp field. should never happen");const n=Ft(a,t);return{...r,fields:e.map(o=>({...o,values:st(o.values,n),nanos:o.nanos===void 0?void 0:st(o.nanos,n)}))}}function st(c,t){return c.map((e,r)=>c[t[r]])}const ke="lokiLogContextPreservedLabels",Ve="lokiLogContextShouldIncludePipelineOperations";class wt{constructor(t){this.getLogRowContextQuery=async(e,r,a,n=!0)=>{a&&r?.scopedVars&&(a=this.datasource.applyTemplateVariables(a,r?.scopedVars));const{query:o}=await this.getQueryAndRange(e,r,a,n);return n||(this.cachedContextFilters=[]),o},this.getLogRowContext=async(e,r,a)=>{a&&r?.scopedVars&&(a=this.datasource.applyTemplateVariables(a,r?.scopedVars));const n=r&&r.direction||d.ZF.Backward,{query:o,range:f}=await this.getQueryAndRange(e,r,a),h=B=>{const W=B.data.map(k=>_t(k,nt.Descending));return{...B,data:W}},$=_.Jk.Explore;return(0,J.s)(this.datasource.query(Je(o,f,$,`${dt}${n}`)).pipe((0,O.W)(B=>{throw{message:"Error during context query. Please check JS console logs.",status:B.status,statusText:B.statusText}}),(0,K.n)(B=>(0,A.of)(h(B)))))},this.processContextFiltersToExpr=(e,r)=>{let n=`{${e.map(o=>!o.nonIndexed&&o.enabled?`${o.label}="${(0,q.Qn)(o.value)}"`:"").filter(o=>!!o).join(",")}}`;if(r){let o=!1;if((0,te.MX)(r.expr).parserCount===1){o=!0;const h=(0,te.aw)(r.expr);h&&(n=(0,ye.aH)(n,h))}const f=e.filter(h=>h.nonIndexed&&h.enabled);for(const h of f)h.enabled&&(n=(0,ye.tE)(n,h.label,"=",h.value,o?s.HD.Parsed:s.HD.StructuredMetadata))}return n},this.processPipelineStagesToExpr=(e,r)=>{let a=e;const n=r?.expr??"";if((0,te.MX)(n).parserCount>1)return a;const o=(0,te.TQ)(n,[I.t3,I.iT,I.c$,I.LM,I.CX,I.bY]),f=o.filter($=>$.type?.id===I.t3),h=o.filter($=>$.type?.id!==I.t3);for(const $ of f)h.some(B=>$.contains(B))||(a+=` ${$.getExpression(n)}`);return a},this.queryContainsValidPipelineStages=e=>{const r=e?.expr??"",a=(0,te.TQ)(r,[I.t3,I.iT,I.CX,I.bY]),n=a.filter(f=>f.type?.id===I.t3),o=a.filter(f=>f.type?.id!==I.t3);return n.some(f=>o.every(h=>f.contains(h)===!1))},this.getInitContextFilters=async(e,r,a)=>{let n=!1;if(!r||(0,b.isEmpty)(e.labels))return{contextFilters:[],preservedFiltersApplied:n};const o=e.labels;let f=[];if(!(0,te.MX)(r.expr).queryWithParser)await this.datasource.languageProvider.start(a),f=this.datasource.languageProvider.getLabelKeys();else{const F=(0,te.pk)(r.expr);f=await this.datasource.languageProvider.fetchLabels({streamSelector:F[0],timeRange:a})}const h=[];Object.entries(o).forEach(([F,W])=>{const k=(0,q.Ed)(F,e.dataFrame,e.rowIndex),ee={label:F,value:W,enabled:f.includes(F),nonIndexed:k!==null&&k!==s.HD.Indexed};h.push(ee)});let $;const B=window.localStorage.getItem(ke);if(B)try{$=JSON.parse(B)}catch{}if($){let F=!1;const W=h.map(ee=>$.removedLabels.includes(ee.label)?(F=!0,{...ee,enabled:!1}):$.selectedExtractedLabels.includes(ee.label)?(F=!0,{...ee,enabled:!0}):{...ee});return W.some(({enabled:ee,nonIndexed:re})=>ee&&!re)?(F&&(n=!0),{contextFilters:W,preservedFiltersApplied:n}):{contextFilters:h,preservedFiltersApplied:n}}else return{contextFilters:h,preservedFiltersApplied:n}},this.datasource=t,this.cachedContextFilters=[]}async getQueryAndRange(t,e,r,a=!0){const n=e&&e.direction||d.ZF.Backward,o=e&&e.limit||this.datasource.maxLines;if(this.cachedContextFilters.length===0||!a){const f=(await this.getInitContextFilters(t,r,{from:(0,Ae.KQ)(t.timeEpochMs),to:(0,Ae.KQ)(t.timeEpochMs),raw:{from:(0,Ae.KQ)(t.timeEpochMs),to:(0,Ae.KQ)(t.timeEpochMs)}})).contextFilters.filter(h=>h.enabled);this.cachedContextFilters=f}return await this.prepareLogRowContextQueryTarget(t,o,n,r)}async prepareLogRowContextQueryTarget(t,e,r,a){const n=this.prepareExpression(this.cachedContextFilters,a),o=2*60*60*1e3,f=r===d.ZF.Forward?s.ti.Forward:s.ti.Backward,h={expr:n,queryType:s.U3.Range,refId:`${dt}_${Math.random().toString()}`,maxLines:e,direction:f,datasource:{uid:this.datasource.uid,type:this.datasource.type}},B=new bt.L(t.dataFrame).getFirstFieldOfType(_e.PU.time);if(B===void 0)throw new Error("loki: data frame missing time-field, should never happen");const F=B.values[t.rowIndex],W=(0,Ae.yT)(F),k=f===s.ti.Forward?{from:W,to:(0,Ae.yT)(t.timeEpochMs+o)}:{from:(0,Ae.yT)(t.timeEpochMs-o),to:W};return{query:h,range:{from:k.from,to:k.to,raw:k}}}getLogRowContextUi(t,e,r,a){r&&a&&(r=this.datasource.applyTemplateVariables(r,a));const n=o=>{this.cachedContextFilters=o,e&&e()};return this.onContextClose=this.onContextClose??(()=>{this.cachedContextFilters=[]}),Lr({row:t,origQuery:r,updateFilter:n,onClose:this.onContextClose,logContextProvider:this,runContextQuery:e})}prepareExpression(t,e){let r=this.processContextFiltersToExpr(t,e);return window.localStorage.getItem(Ve)==="true"&&(r=this.processPipelineStagesToExpr(r,e)),r}}var Dt=l(65474),Sr=l(48592),Tr=l(84596),Be=l(63527);const At=/^label_names\(\)\s*$/,Ct=/^label_values\((?:(.+),\s*)?([a-zA-Z_$][a-zA-Z0-9_]*)\)\s*$/;function Rr(c){if(typeof c!="string")return c;const t={refId:"LokiVariableQueryEditor-VariableQuery",type:s.ie.LabelNames};if(c.match(At))return{...t,type:s.ie.LabelNames};const r=c.match(Ct);return r?{...t,type:s.ie.LabelValues,label:r[2]?r[2]:r[1],stream:r[2]?r[1]:void 0}:t}const Fr=[{label:"Label names",value:s.ie.LabelNames},{label:"Label values",value:s.ie.LabelValues}],_r="LokiVariableQueryEditor-VariableQuery",wr=({onChange:c,query:t,datasource:e,range:r})=>{const[a,n]=(0,Ee.useState)(void 0),[o,f]=(0,Ee.useState)(""),[h,$]=(0,Ee.useState)([]),[B,F]=(0,Ee.useState)(""),W=(0,Tr.A)(a);(0,Ee.useEffect)(()=>{if(!t)return;const ne=typeof t=="string"?Rr(t):t;n(ne.type),f(ne.label||""),F(ne.stream||"")},[t]),(0,Ee.useEffect)(()=>{a!==s.ie.LabelValues||W===a||e.languageProvider.fetchLabels({timeRange:r}).then(ne=>{$(ne.map(Oe=>({label:Oe,value:Oe})))})},[e,a,r,W]);const k=ne=>{n(ne.value),ne.value!==void 0&&c({type:ne.value,label:o,stream:B,refId:_r})},ee=ne=>{f(ne.value||"")},re=ne=>{F(ne.currentTarget.value)},he=()=>{a!==void 0&&c({type:a,label:o,stream:B,refId:"LokiVariableQueryEditor-VariableQuery"})};return(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsxs)(rt.C,{children:[(0,ce.jsx)(Ge.I,{label:"Query type",labelWidth:20,children:(0,ce.jsx)(We.l6,{"aria-label":"Query type",onChange:k,onBlur:he,value:a,options:Fr,width:16})}),a===s.ie.LabelValues&&(0,ce.jsx)(ce.Fragment,{children:(0,ce.jsx)(Ge.I,{label:"Label",labelWidth:20,children:(0,ce.jsx)(We.l6,{"aria-label":"Label",onChange:ee,onBlur:he,value:{label:o,value:o},options:h,width:16,allowCustomValue:!0})})})]}),a===s.ie.LabelValues&&(0,ce.jsx)(rt.C,{children:(0,ce.jsx)(Ge.I,{label:"Stream selector",labelWidth:20,grow:!0,tooltip:(0,ce.jsx)("div",{children:'Optional. If defined, a list of values for the specified log stream selector is returned. For example: {label="value"} or {label="$variable"}'}),children:(0,ce.jsx)(Be.p,{type:"text","aria-label":"Stream selector",placeholder:"Optional stream selector",value:B,onChange:re,onBlur:he})})})]})};class Dr extends Sr.f5{constructor(t){super(),this.datasource=t,this.editor=wr}async execute(t,e,r){return this.datasource.metricFindQuery(t,{scopedVars:e,range:r})}query(t){const e=this.execute(t.targets[0],t.scopedVars,t.range);return(0,Dt.H)(e).pipe((0,ie.T)(r=>({data:r})))}}var Mt=l(41119),Ut=l(78282);function Ar(c,t){if(!t.length)return[];const e=(0,b.groupBy)(t,"name"),r=Object.values(e).map(Cr),a=c.fields.find(o=>o.type===_e.PU.string);if(a===void 0)throw new Error("invalid logs-dataframe, string-field missing");const n=c.fields.find(o=>o.type===_e.PU.other&&o.name==="labels");for(let o=0;o<a.values.length;o++)for(const f of r)if(e[f.name][0].matcherType==="label"&&n){const h=n.values[o];if(h){const $=Object.keys(h).find(B=>new RegExp(e[f.name][0].matcherRegex).test(B));if($){f.values.push(h[$]);continue}}f.values.push(null)}else if(e[f.name][0].matcherType==="regex"||e[f.name][0].matcherType===void 0){const $=a.values[o].match(e[f.name][0].matcherRegex);if($&&$[1]){f.values.push($[1]);continue}f.values.push(null)}else f.values.push(null);return r}function Cr(c){const t=(0,Ut.l)(),e=c.reduce((r,a)=>{if(a.datasourceUid){const n=t.getInstanceSettings(a.datasourceUid),o=f=>{switch(f){case"tempo":return"traceql";case"grafana-x-ray-datasource":return"getTrace";default:return}};r.push({title:a.urlDisplayLabel||"",url:"",internal:{query:{query:a.url,queryType:o(n?.type)},datasourceUid:a.datasourceUid,datasourceName:n?.name??"Data source not found"},targetBlank:a.targetBlank})}else a.url&&r.push({title:a.urlDisplayLabel||"",url:a.url,targetBlank:a.targetBlank});return r},[]);return{name:c[0].name,type:_e.PU.string,config:{links:e},values:[]}}function Xt(c){const t=c.filter(r=>r.refId!==void 0),e=(0,b.groupBy)(t,r=>r.refId);return Object.entries(e).map(([r,a])=>It(a,r))}function It(c,t){const e={name:"Time",config:{},values:[],type:_e.PU.time},r={name:`Value #${t}`,config:{},values:[],type:_e.PU.number},a=new Set(c.map(f=>f.fields.map(h=>Object.keys(h.labels??{})).flat()).flat()),o=Array.from(a).sort().map(f=>({name:f,config:{filterable:!0},values:[],type:_e.PU.string}));return c.forEach(f=>{const h=f.fields.find(k=>k.type===_e.PU.time),$=f.fields.find(k=>k.type===_e.PU.number);if(h==null||$==null)return;const B=h.values,F=$.values;for(let k of B)e.values.push(k);for(let k of F)r.values.push(k);const W=$.labels??{};for(let k of o){const ee=W[k.name]??"";for(let re=0;re<F.length;re++)k.values.push(ee)}}),{fields:[e,...o,r],refId:t,meta:{preferredVisualisationType:"table"},length:e.values.length}}function Mr(c){return c.fields.every(t=>t.type===_e.PU.time||t.type===_e.PU.number)}function it(c,t){const{meta:e,...r}=c,a={...e,...t};return{...r,meta:a}}function Ur(c,t,e){const r={...c.meta?.custom,lokiQueryStatKey:"Summary: total bytes processed"};(0,u.nE)(c)&&(r.error="Error when parsing some of the logs");const a={preferredVisualisationType:"logs",limit:t?.maxLines,searchWords:t?(0,te.H0)(t.expr):void 0,custom:r},n=it(c,a),o=Ar(n,e);return{...n,fields:[...n.fields,...o]}}function Nt(c,t,e){return c.map(r=>{const a=r.refId!==void 0?t.get(r.refId):void 0;return Ur(r,a,e)})}function Wt(c){return c.length>0?Xt(c):[]}function Vt(c){const t={preferredVisualisationType:"graph"};return c.map(e=>it(e,t))}function Bt(c,t){const e=[],r=[],a=[];return c.forEach(n=>{Mr(n)?n.refId!=null&&t.get(n.refId)?.queryType===s.U3.Instant?r.push(n):a.push(n):e.push(n)}),{streamsFrames:e,metricInstantFrames:r,metricRangeFrames:a}}function jt(c,t){if(c===void 0)return c;const{refId:e,message:r}=c;if(e===void 0||r===void 0)return c;const a=t.get(e);return a===void 0?c:r.includes("escape")&&a.expr.includes("\\")?{...c,message:`${r}. Make sure that all special characters are escaped with \\. For more information on escaping of special characters visit LogQL documentation at https://grafana.com/docs/loki/latest/logql/.`}:c}function zt(c,t,e){const{data:r,error:a,...n}=c,o=r.map(F=>{if(!(0,Mt.ci)(F))throw new Error("transformation only supports dataframe responses");return F}),f=new Map(t.map(F=>{const W=c.data.find(ee=>ee.refId===F.refId)?.meta.executedQueryString,k={...F,expr:W?(0,te.mW)(W):F.expr};return[F.refId,k]})),{streamsFrames:h,metricInstantFrames:$,metricRangeFrames:B}=Bt(o,f);return{...n,error:jt(a,f),data:[...Vt(B),...Wt($),...Nt(h,f,e)]}}var Kt=l(32300),Ze=l(30048),ot=l(41654),Xr=l(60093),Ir=l(76864);const Nr=(0,Ee.memo)(function(t){const{annotation:e,onAnnotationChange:r,history:a}=t;if(e===void 0||r===void 0)return null;const n=f=>{r({...e,expr:f.expr,maxLines:f.maxLines,queryType:"range"})},o={refId:"",expr:e.expr,maxLines:e.maxLines,instant:e.instant,queryType:e.queryType};return(0,ce.jsxs)(ot.B,{gap:5,direction:"column",children:[(0,ce.jsx)(ot.B,{gap:0,direction:"column",children:(0,ce.jsx)(Ir.W,{datasource:t.datasource,query:o,onChange:n,onRunQuery:()=>{},history:a,ExtraFieldElement:(0,ce.jsx)(Xr.kl,{lineLimitValue:o?.maxLines?.toString()||"",query:o,onRunQuery:()=>{},onChange:n})})}),(0,ce.jsxs)(Kt.U,{children:[(0,ce.jsx)(Ze.c,{label:"Title",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.",children:(0,ce.jsx)(Be.p,{type:"text",placeholder:"alertname",value:e.titleFormat,onChange:f=>{r({...e,titleFormat:f.currentTarget.value})}})}),(0,ce.jsx)(Ze.c,{label:"Tags",children:(0,ce.jsx)(Be.p,{type:"text",placeholder:"label1,label2",value:e.tagKeys,onChange:f=>{r({...e,tagKeys:f.currentTarget.value})}})}),(0,ce.jsx)(Ze.c,{label:"Text",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance.",children:(0,ce.jsx)(Be.p,{type:"text",placeholder:"instance",value:e.textFormat,onChange:f=>{r({...e,textFormat:f.currentTarget.value})}})})]})]})});var lt=l(27522);function Wr(c,t){if(t.length===0)return[];const e=[],{queryWithParser:r,parserCount:a}=(0,te.MX)(c);if(!r){const{hasLogfmt:f,hasJSON:h,hasPack:$}=(0,u.YB)(t[0]);h&&($?e.push({type:"ADD_UNPACK_PARSER",label:"Selected log stream selector has packed logs.",fix:{title:"add unpack parser",label:"Consider using unpack parser.",action:{type:"ADD_UNPACK_PARSER",query:c}}}):e.push({type:"ADD_JSON_PARSER",label:"Selected log stream selector has JSON formatted logs.",fix:{title:"add json parser",label:"Consider using JSON parser.",action:{type:"ADD_JSON_PARSER",query:c}}})),f&&e.push({type:"ADD_LOGFMT_PARSER",label:"Selected log stream selector has logfmt formatted logs.",fix:{title:"add logfmt parser",label:"Consider using logfmt parser to turn key-value pairs in your log lines to labels.",action:{type:"ADD_LOGFMT_PARSER",query:c}}})}if(r){if(a===1){const h=(0,te.d_)(c);(0,u.db)(t[0])&&!h&&e.push({type:"ADD_NO_PIPELINE_ERROR",label:"Some logs in your selected log streams have parsing error.",fix:{title:"remove pipeline errors",label:"Consider filtering out logs with parsing errors.",action:{type:"ADD_NO_PIPELINE_ERROR",query:c}}})}(0,te.pS)(c)||e.push({type:"ADD_LABEL_FILTER",label:"Consider filtering logs by their label and value.",fix:{title:"add label filter",label:"",action:{type:"ADD_LABEL_FILTER",query:c}}})}if(!(0,te._i)(c)){const f=(0,u.Ac)(t[0]),h=(0,u.sz)(t[0]);!f&&h&&e.push({type:"ADD_LEVEL_LABEL_FORMAT",label:`Some logs in your selected log stream have "${h}" label.`,fix:{title:"add label level format",label:`If ${h} label has level values, consider using label_format to rename it to "level". Level label can be then visualized in log volumes.`,action:{type:"ADD_LEVEL_LABEL_FORMAT",query:c,options:{renameTo:"level",originalLabel:h}}}})}return(0,te.Rn)(c)||e.push({type:"ADD_LINE_FILTER",label:"Consider filtering logs for specific string.",fix:{title:"add line filter",label:"",action:{type:"ADD_LINE_FILTER",query:c}}}),e}var ut=l(68088),Gt=l(96426),Vr=l(24726),kt=l(23235);function Br(c,t){const e=c.interpolateVariablesInQueries(t.targets,t.scopedVars).filter(r=>r.expr).filter(r=>!r.hide);return jr(c,t,e)}function jr(c,t,e){let r=!1,a={data:[],state:ae.Gu.Streaming,key:(0,Vr.A)()},n=null,o=new Map,f=null;const h=(B,F,W)=>{let k=W[F].groupSize;const{shards:ee,groupSize:re,cycle:he}=W[F];let ne=!1;n!=null&&(n.unsubscribe(),n=null);const Oe=()=>{a.state=r?ae.Gu.Error:ae.Gu.Done,B.next(a),B.complete()};if(r){Oe();return}const Le=()=>{const Qe=W[F+1]&&Zt(W[F+1])?W[F+1]:W.find(Xe=>Zt(Xe));if(Qe===void 0){Oe();return}W[F].groupSize=k,h(B,W.indexOf(Qe),W)},be=Qe=>{try{if(Qe&&!(0,u.BY)(Qe))return!1}catch(or){return console.error(or),r=!0,!1}if(re!==void 0&&re>1)return W[F].groupSize=Math.floor(Math.sqrt(re)),Ne(`Possible time out, new group size ${W[F].groupSize}`),ne=!0,h(B,F,W),!0;const Xe=`${F}_${he}`,Me=o.get(Xe)??0;return Me>1?(r=!0,!1):(o.set(Xe,Me+1),f=setTimeout(()=>{console.warn(`Retrying ${F} ${he} (${Me+1})`),h(B,F,W),f=null},1500*Math.pow(2,Me)),ne=!0,!0)},Se=(0,ut.gn)(W[F].targets,a);if(!Se.length){Le();return}const Te=ee&&he!==void 0&&re?Ht(ee,he,re):[],Re={...t,targets:(0,te.Bg)(Se,Te)};t.requestId&&(Re.requestId=Te.length>0?`${t.requestId}_shard_${F}_${he}_${re}`:t.requestId),Ne(Te.length?`Querying ${Te.join(", ")}`:"Running regular query"),n=(0,ut.K9)(c,Re,{skipPartialUpdates:!0,disableRetry:!0}).subscribe({next:Qe=>{((Qe.errors??[]).length>0||Qe.error!=null)&&be(Qe)||(re&&he!==void 0&&ee!==void 0&&(k=Gr(he+re,Kr(Qe,W[F]),ee.length),k!==re&&Ne(`New group size ${k}`)),a=Te.length>0?(0,kt.Wn)(a,Qe):(0,kt.Df)(a,Qe),Te.length===0&&B.next(a))},complete:()=>{ne||(B.next(a),Le())},error:Qe=>{console.error(Qe,{msg:"failed to shard"}),B.next(a),!be()&&Le()}})};return new Ce.c(B=>(zr(e,c,t).then(F=>{h(B,0,F)}),()=>{r=!0,f&&clearTimeout(f),n!=null&&(n.unsubscribe(),n=null)}))}async function zr(c,t,e){const[r,a]=(0,b.partition)(c,f=>(0,te.E2)([f])),n=[];a.length&&n.push({targets:a});const o=(0,b.groupBy)(r,f=>(0,te.tO)(f.expr));for(const f in o)try{const $=(await t.languageProvider.fetchLabelValues("__stream_shard__",{timeRange:e.range,streamSelector:f})).map(B=>parseInt(B,10));$&&($.sort((B,F)=>F-B),Ne(`Querying ${f} with shards ${$.join(", ")}`)),n.push({targets:o[f],shards:$.length?$:void 0,groupSize:$.length?Yt($):void 0,cycle:0})}catch(h){console.error(h,{msg:"failed to fetch label values for __stream_shard__"}),n.push({targets:o[f]})}return n}function Zt(c){if(c.cycle===void 0||!c.groupSize||!c.shards)return!1;const{cycle:t,groupSize:e,shards:r}=c,a=Math.min(t+e,r.length);return c.cycle=a,t<r.length&&a<=r.length}function Kr(c,t){const{groupSize:e}=t;if(!e)return 1;if(!c.data.length)return e+1;const r=c.data[0].meta?.stats?.find(a=>a.displayName==="Summary: exec time");if(r){const a=Math.round(r.value);return Ne(`${r.value}`),a<=1?Math.floor(e*1.5):a<6?Math.ceil(e*1.1):e===1?e:a<20?Math.ceil(e*.9):Math.floor(e/2)}return e}function Gr(c,t,e){return Math.min(t,Math.max(Math.floor((e-c)*.7),1))}function Ht(c,t,e){return t===c.length?[-1]:c.slice(t,t+e)}function Yt(c){return Math.floor(Math.sqrt(c.length))}const kr=!!localStorage.getItem("loki.sharding_debug_enabled");function Ne(c){kr&&console.log(c)}var Jt=l(72316),Zr=l(51388),Hr=l(38619),Yr=l(33184);async function qt(c){const t=JSON.stringify({expr:c.expr}),e=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-1",e);return Array.from(new Uint8Array(r.slice(0,8))).map(n=>n.toString(16).padStart(2,"0")).join("")}function Jr(c,t,e){const r=e.range,a=r.to.valueOf()-r.from.valueOf()+1e3;let n=e.maxDataPoints??1e3;n>100&&(n*=2);let o;const f=h=>{if("message"in h&&h.message){const $=h.message;o?o.push($):o=Zr.k9.fromDataFrameJSON($,{maxLength:n,maxDelta:a,displayNameFormat:c.legendFormat})}return o};return(0,Jt.v)(()=>qt(c)).pipe((0,fe.Z)(h=>(0,Yr.oF)().getStream({scope:Hr.qD.DataSource,namespace:t.uid,path:`tail/${h}`,data:{...c,timeRange:{from:r.from.valueOf().toString(),to:r.to.valueOf().toString()}}}).pipe((0,ie.T)($=>{const B=f($);return{data:B?[B]:[],state:ae.Gu.Streaming}}))))}const er=c=>{let e=`${window.location.protocol==="https:"?"wss://":"ws://"}${window.location.host}${y.$.appSubUrl}`;return e.endsWith("/")&&(e=e.slice(0,-1)),`${e}${c}`};var tr=l(47126);const rr=1e3,He=10,qr="/loki/api/v1",Ye="loki-data-samples",ct="annotation-",dt="log-row-context-query-",ar="log-volume-",nr="log-sample-",ea="log-stats-",sr=1e6;function Je(c,t,e,r,a){const n=oe.calculateInterval(t,1);return{targets:[c],requestId:r,interval:n.interval,intervalMs:n.intervalMs,range:t,scopedVars:{},timezone:"UTC",app:e,startTime:Date.now(),hideFromInspector:a}}class ta extends le.iy{constructor(t,e=(0,Z.w)()){super(t),this.instanceSettings=t,this.templateSrv=e,this.streams=new yt,this.runLiveQuery=(a,n)=>{const o=this.createLiveTarget(a,n);return this.streams.getStream(o).pipe((0,ie.T)(f=>({data:f||[],key:`loki-${o.refId}`,state:ae.Gu.Streaming})),(0,O.W)(f=>(0,Y.$)(()=>`Live tailing was stopped due to following error: ${f.reason}`)))},this.getLogRowContext=async(a,n,o)=>await this.logContextProvider.getLogRowContext(a,n,(0,te.sc)(o)),this.getLogRowContextQuery=async(a,n,o,f)=>await this.logContextProvider.getLogRowContextQuery(a,n,(0,te.sc)(o),f),this.languageProvider=new C(this);const r=t.jsonData||{};this.maxLines=parseInt(r.maxLines??"0",10)||rr,this.predefinedOperations=r.predefinedOperations??"",this.annotations={QueryEditor:Nr},this.variables=new Dr(this),this.logContextProvider=new wt(this)}getSupplementaryRequest(t,e,r){switch(t){case d.cF.LogsVolume:const a=r?.type===d.cF.LogsVolume?r:{type:t};return this.getLogsVolumeDataProvider(e,a);case d.cF.LogsSample:const n=r?.type===d.cF.LogsSample?r:{type:t};return this.getLogsSampleDataProvider(e,n);default:return}}getSupportedSupplementaryQueryTypes(){return[d.cF.LogsVolume,d.cF.LogsSample]}getSupplementaryQuery(t,e){if(e.hide)return;const r=(0,te.vV)(e);let a=(0,ye.Lv)(r.expr),n=!1;switch(t.type){case d.cF.LogsVolume:if(n=!!(a&&(0,te.sI)(a)&&r.queryType===s.U3.Range),!n)return;const o=`${a} | drop __error__`,f=t.field||"level, detected_level";return(0,te.FV)(this.interpolateString(o,lt.a))===!1&&(a=o),{...r,refId:`${ar}${r.refId}`,queryType:s.U3.Range,supportingQueryType:s.Q$.LogsVolume,expr:`sum by (${f}) (count_over_time(${a}[$__auto]))`};case d.cF.LogsSample:return n=!!(a&&!(0,te.sI)(a)),n?{...r,queryType:s.U3.Range,refId:`${nr}${r.refId}`,expr:(0,te.OT)(a),maxLines:Number.isNaN(Number(t.limit))?this.maxLines:Number(t.limit),supportingQueryType:s.Q$.LogsSample}:void 0;default:return}}getLogsVolumeDataProvider(t,e){const r=(0,b.cloneDeep)(t),a=r.targets.map(n=>this.getSupplementaryQuery(e,n)).filter(n=>!!n);if(a.length)return{...r,targets:a}}getLogsSampleDataProvider(t,e){const r=(0,b.cloneDeep)(t),a=r.targets.map(n=>this.getSupplementaryQuery({type:d.cF.LogsSample,limit:100},n)).filter(n=>!!n);if(a.length)return{...r,targets:a}}getQueryHeaders(t){const e={};if(!y.$.featureToggles.lokiSendDashboardPanelNames||[_.Jk.Dashboard.toString(),_.Jk.PanelEditor.toString(),_.Jk.PanelViewer.toString()].includes(t.app)===!1)return e;const r=(0,L.UA)().getCurrent(),a=r?.title,n=r?.panels.find(o=>o.id===t?.panelId)?.title;return a&&(e["X-Dashboard-Title"]=a),n&&(e["X-Panel-Title"]=n),e}query(t){const e=t.targets.map(te.vV).map(o=>({...o,maxLines:o.maxLines??this.maxLines})),r={...t,targets:e};r.headers=this.getQueryHeaders(t);const a=r.targets.filter(o=>o.queryType===s.U3.Stream);if(y.$.featureToggles.lokiExperimentalStreaming&&a.length>0&&r.rangeRaw?.to==="now"){const o={...r,targets:a};return(0,S.h)(...a.map(f=>Jr(this.applyTemplateVariables(f,t.scopedVars,t.filters),this,o)))}if(r.liveStreaming)return this.runLiveQueryThroughBackend(r);if(y.$.featureToggles.lokiShardSplitting&&(0,te.E2)(r.targets))return Br(this,r);if(y.$.featureToggles.lokiQuerySplitting&&(0,te.gy)(r.targets))return(0,ut.K9)(this,r);const n=new Date;return this.runQuery(r).pipe((0,P.M)(o=>(0,tr.Ex)(o,r,n,{predefinedOperations:this.predefinedOperations})))}runQuery(t){return super.query(t).pipe((0,ie.T)(e=>zt(e,t.targets,this.instanceSettings.jsonData.derivedFields??[])))}runLiveQueryThroughBackend(t){const e=t.targets.filter(a=>a.expr!==""&&(0,te.sI)(a.expr));if(e.length===0)return(0,A.of)({data:[],state:ae.Gu.Done});const r=e.map(a=>{const n=this.applyTemplateVariables(a,t.scopedVars,t.filters),o=n.maxLines||this.maxLines;return this.runLiveQuery(n,o)});return(0,S.h)(...r)}createLiveTarget(t,e){const r=t.expr,a=this.instanceSettings.url,n=j.kM.serializeParams({query:r});return{query:r,url:er(`${a}/loki/api/v1/tail?${n}`),refId:t.refId,size:e}}interpolateVariablesInQueries(t,e,r){let a=t;return t&&t.length&&(a=t.map(n=>({...n,datasource:this.getRef(),expr:this.addAdHocFilters(this.templateSrv.replace(n.expr,e,this.interpolateQueryExpr),r)}))),a}getQueryDisplayText(t){return t.expr}getTimeRangeParams(t){return{start:t.from.valueOf()*sr,end:t.to.valueOf()*sr}}async importFromAbstractQueries(t){await this.languageProvider.start();const e=this.languageProvider.labelKeys;return e&&e.length&&(t=t.map(r=>(r.labelMatchers=r.labelMatchers.filter(a=>e.includes(a.name)),r))),t.map(r=>this.languageProvider.importFromAbstractQuery(r))}async exportToAbstractQueries(t){return t.map(e=>this.languageProvider.exportToAbstractQuery(e))}async metadataRequest(t,e,r){if(t.startsWith("/"))throw new Error(`invalid metadata request url: ${t}`);const a=await this.getResource(t,e,r);return!a.data&&a.values?a.values??[]:!a.data&&a.fields?a.fields??[]:a.data??[]}async statsMetadataRequest(t,e,r){if(t.startsWith("/"))throw new Error(`invalid metadata request url: ${t}`);return await this.getResource(t,e,r)}async getQueryStats(t,e){if((0,te.FV)(this.interpolateString(t.expr,lt.a)))return;const r=(0,te.pk)(t.expr);let a={streams:0,chunks:0,bytes:0,entries:0};for(const n in r){const{start:o,end:f}=this.getStatsTimeRange(t,Number(n),e);if(o===void 0||f===void 0)return{streams:0,chunks:0,bytes:0,entries:0,message:"Query size estimate not available."};try{const h=await this.statsMetadataRequest("index/stats",{query:r[n],start:o,end:f},{showErrorAlert:!1,requestId:`${ea}${t.refId}`});a={streams:a.streams+h.streams,chunks:a.chunks+h.chunks,bytes:a.bytes+h.bytes,entries:a.entries+h.entries}}catch{break}}return a}getStatsTimeRange(t,e,r){let a,n;const h=(0,te.QH)(t.expr,[I.dw]).map($=>t.expr.substring($.from,$.to));return(0,te.sI)(t.expr)?t.queryType===s.U3.Instant?{start:void 0,end:void 0}:this.getTimeRangeParams(r):t.queryType===s.U3.Instant?h[e]?(n=this.getTimeRangeParams(r).end,a=n-oe.intervalToMs(h[e])*1e6,{start:a,end:n}):/(\$__auto|\$__range)/.test(t.expr)?this.getTimeRangeParams(r):{start:void 0,end:void 0}:this.getTimeRangeParams(r)}async getStats(t,e){if(!t.expr)return null;const r=await this.getQueryStats(t,e);return r?Object.values(r).every(a=>a===0)?null:r:null}async metricFindQuery(t,e){if(!t)return Promise.resolve([]);let r;return typeof t=="string"?r=this.parseStringToVariableQuery(this.interpolateString(t,e?.scopedVars)):r={...t,label:this.interpolateString(t.label||"",e?.scopedVars),stream:this.interpolateString(t.stream||"",e?.scopedVars)},r?await this.processMetricFindQuery(r,e?.range):Promise.resolve([])}async processMetricFindQuery(t,e){return t.type===s.ie.LabelNames?(await this.languageProvider.fetchLabels({timeRange:e})).map(n=>({text:n})):t.label?(await this.languageProvider.fetchLabelValues(t.label,{streamSelector:t.stream,timeRange:e})).map(a=>({text:a})):[]}parseStringToVariableQuery(t){const e="LokiVariableQueryEditor-VariableQuery";if(t.match(At))return{type:s.ie.LabelNames,refId:e};const a=t.match(Ct);if(a)return{type:s.ie.LabelValues,label:a[2],stream:a[1],refId:e}}async getDataSamples(t,e){if(!(0,te.sI)(t.expr)||(0,te.FV)(this.interpolateString(t.expr,lt.a)))return[];const r={expr:t.expr,queryType:s.U3.Range,refId:Ye,maxLines:t.maxLines||He,supportingQueryType:s.Q$.DataSample},a=Je(r,e,_.Jk.Unknown,Ye,!0);return await(0,J.s)(this.query(a).pipe((0,K.n)(n=>(0,A.of)(n.data))))}async getTagKeys(t){let e="{}";for(const a of t?.filters??[])e=(0,ye.tE)(e,a.key,a.operator,a.value);return(await this.languageProvider.fetchLabels({timeRange:t?.timeRange,streamSelector:e})).map(a=>({text:a}))}async getTagValues(t){let e="{}";for(const a of t?.filters??[])e=(0,ye.tE)(e,a.key,a.operator,a.value);return(await this.languageProvider.fetchLabelValues(t.key,{timeRange:t.timeRange,streamSelector:e})).map(a=>({text:a}))}interpolateQueryExpr(t,e){return!e.multi&&!e.includeAll?t:typeof t=="string"?ir(t):(0,b.map)(t,ir).join("|")}toggleQueryFilter(t,e){let r=t.expr??"";const a=(0,q.Ed)(e.options.key,e.frame,0);switch(e.type){case"FILTER_FOR":{if(e.options?.key&&e.options?.value){const n=(0,q.Bb)(e.options.value);r=(0,ye.je)(r,e.options.key,"=",n)?(0,ye.FN)(r,e.options.key,"=",n):(0,ye.tE)(r,e.options.key,"=",n,a)}break}case"FILTER_OUT":{if(e.options?.key&&e.options?.value){const n=(0,q.Bb)(e.options.value);(0,ye.je)(r,e.options.key,"=",n)&&(r=(0,ye.FN)(r,e.options.key,"=",n)),r=(0,ye.tE)(r,e.options.key,"!=",n,a)}break}default:break}return{...t,expr:r}}queryHasFilter(t,e){let r=t.expr??"";return(0,ye.je)(r,e.key,"=",e.value)}modifyQuery(t,e){let r=t.expr??"";switch(e.type){case"ADD_FILTER":{if(e.options?.key&&e.options?.value){const a=(0,q.Ed)(e.options.key,e.frame,0),n=(0,q.Bb)(e.options.value);r=(0,ye.tE)(r,e.options.key,"=",n,a)}break}case"ADD_FILTER_OUT":{if(e.options?.key&&e.options?.value){const a=(0,q.Ed)(e.options.key,e.frame,0),n=(0,q.Bb)(e.options.value);r=(0,ye.tE)(r,e.options.key,"!=",n,a)}break}case"ADD_LOGFMT_PARSER":{r=(0,ye.aH)(r,"logfmt");break}case"ADD_JSON_PARSER":{r=(0,ye.aH)(r,"json");break}case"ADD_UNPACK_PARSER":{r=(0,ye.aH)(r,"unpack");break}case"ADD_NO_PIPELINE_ERROR":{r=(0,ye.yI)(r);break}case"ADD_LEVEL_LABEL_FORMAT":{e.options?.originalLabel&&e.options?.renameTo&&(r=(0,ye.o9)(r,{renameTo:e.options.renameTo,originalLabel:e.options.originalLabel}));break}case"ADD_LABEL_FILTER":{const a=(0,ye.cH)(t.expr),n=(0,ye.lN)(t.expr),o=(0,ye.lq)([...a,...n]),f=(0,ye.i6)("","","=");r=(0,ye.cQ)(r,[o],f);break}case"ADD_STRING_FILTER":case"ADD_LINE_FILTER":{r=(0,ye.OS)(r,e.options?.value);break}case"ADD_STRING_FILTER_OUT":case"ADD_LINE_FILTER_OUT":{r=(0,ye.OS)(r,e.options?.value,"!=");break}default:break}return{...t,expr:r}}getSupportedQueryModifications(){return["ADD_FILTER","ADD_FILTER_OUT","ADD_LOGFMT_PARSER","ADD_JSON_PARSER","ADD_UNPACK_PARSER","ADD_NO_PIPELINE_ERROR","ADD_LEVEL_LABEL_FORMAT","ADD_LABEL_FILTER","ADD_STRING_FILTER","ADD_STRING_FILTER_OUT"]}getLogRowContextUi(t,e,r,a){return this.logContextProvider.getLogRowContextUi(t,e,(0,te.sc)(r),a)}async annotationQuery(t){const{expr:e,maxLines:r,instant:a,tagKeys:n="",titleFormat:o="",textFormat:f=""}=t.annotation;if(!e)return[];const h=`${ct}${t.annotation.name}`,$={refId:h,expr:e,maxLines:r,instant:a,queryType:a?s.U3.Instant:s.U3.Range},B=Je($,t.range,_.Jk.Dashboard,h),{data:F}=await(0,J.s)(this.query(B)),W=[],k=n.split(",").filter(re=>re!==""),ee=y.$.featureToggles.lokiLogsDataplane;for(const re of F)new v.R(re).forEach(ne=>{const{labels:Oe}=ne,Le=Object.entries(Oe).map(([Te,Re])=>[Te,Re.trim()]).filter(([Te,Re])=>!(Re===""||k.length&&!k.includes(Te))).map(([Te,Re])=>Re),be=Array.from(new Set(Le)),Se=ee?ne.body:ne.Line;W.push({time:ee?new Date(ne.timestamp).valueOf():new Date(ne.Time).valueOf(),title:(0,ge.j)(o,Oe),text:(0,ge.j)(f,Oe)||Se,tags:be})});return W}addAdHocFilters(t,e){if(!e?.length)return t;let r=(0,Gt.qk)(t);return r=e.reduce((a,n)=>{const{key:o,operator:f}=n;let{value:h}=n;return(0,q.N4)(f)||(h=(0,q.Bb)(h,f)),(0,ye.tE)(a,o,f,h)},r),(0,Gt.If)(r)}filterQuery(t){return!(t.hide||t.expr==="")}applyTemplateVariables(t,e,r){const{__auto:a,__interval:n,__interval_ms:o,__range:f,__range_s:h,__range_ms:$,...B}=e||{},F={...B,__interval:{value:"$__interval"},__interval_ms:{value:"$__interval_ms"}},W=this.addAdHocFilters(this.templateSrv.replace(t.expr,F,this.interpolateQueryExpr),r),k=this.templateSrv.replace(t.step,F),ee=this.templateSrv.replace(t.legendFormat,F);return{...t,expr:W,step:k,legendFormat:ee}}interpolateString(t,e){return this.templateSrv.replace(t,e,this.interpolateQueryExpr)}getVariables(){return this.templateSrv.getVariables().map(t=>`$${t.name}`)}getQueryHints(t,e){return Wr(t.expr,e)}getDefaultQuery(t){const e={refId:"A",expr:""};return t===_.Jk.UnifiedAlerting?{...e,queryType:s.U3.Instant}:{...e,queryType:s.U3.Range}}}function ir(c){return typeof c=="string"?c.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&"):c}},22420:(xe,de,l)=>{l.d(de,{Bb:()=>_,Cs:()=>d,Ed:()=>ge,N4:()=>j,P7:()=>y,Qn:()=>oe,WV:()=>O,qv:()=>ae,sM:()=>le,tY:()=>v,tt:()=>Z});var b=l(2543),Y=l.n(b),S=l(46933),A=l(12282);function J(Q){return ie(Q/1e3)}function ie(Q){return Math.floor(Q/60)}function O(Q,V){if(Q&&V){const G=J(Q.from.valueOf())===J(V.from.valueOf()),T=J(Q.to.valueOf())===J(V.to.valueOf());return!(G&&T)}return!1}const P=/[*+?()|\\.\[\]{}^$]/g;function K(Q){return Q.replace(P,"\\$&")}function oe(Q){return Q.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function ae(Q){return Q.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function d(Q){return oe(K(Q))}function _(Q,V){return j(V)?d(Q):oe(Q)}function j(Q){return!!(Q&&(Q.includes("=~")||Q.includes("!~")))}function v(Q){const V=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],G=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${V.join("|")})$`);return!!Q.match(G)}function ge(Q,V,G){if(!V||G===void 0)return null;const T=V.fields.find(U=>U.name==="labelTypes")?.values[G];if(!T)return null;switch(T[Q]){case"I":return A.HD.Indexed;case"S":return A.HD.StructuredMetadata;case"P":return A.HD.Parsed;default:return null}}const I={[S.D_.Equal]:"=",[S.D_.NotEqual]:"!=",[S.D_.EqualRegEx]:"=~",[S.D_.NotEqualRegEx]:"!~"},le=(0,b.invert)(I);function Z(Q){const V=Q.labelMatchers.map(G=>{const T=I[G.operator];return T?`${G.name}${T}"${G.value}"`:""}).filter(G=>G!=="").join(", ");return V?`{${V}}`:""}function y(Q){const V={};Q.forEach(T=>{Object.keys(T).forEach(U=>{V[U]||(V[U]=new Set),V[U].has(T[U])||V[U].add(T[U])})});const G={};return M(Object.keys(V)).forEach(T=>{G[T]=M(Array.from(V[T]))}),{values:G,keys:Object.keys(G)}}const L=1e4;function M(Q){return Q.slice(0,L)}},23235:(xe,de,l)=>{l.d(de,{Df:()=>P,Wn:()=>O});var b=l(28105),Y=l(95004),S=l(51388),A=l(76732),J=l(39443),ie=l(68088);function O(y,L){if(!y)return I(L);L.data.forEach(G=>{const T=y.data.find(U=>Z(U,G));if(!T){y.data.push(le(G));return}K(T,G)});const M=[...y.errors??[],...L.errors??[]];M.length>0&&(y.errors=M);const Q=y.error??L.error;Q!=null&&(y.error=Q);const V=[...y.traceIds??[],...L.traceIds??[]];return V.length>0&&(y.traceIds=V),y}function P(y,L){if(!y)return I(L);L.data.forEach(G=>{const T=y.data.findIndex(U=>Z(U,G));if(T<0){y.data.push(le(G));return}y.data[T]=G}),L.state===b.Gu.Done&&(y.data=y.data.filter(G=>G.name!==ie.NW));const M=[...y.errors??[],...L.errors??[]];M.length>0&&(y.errors=M);const Q=y.error??L.error;Q!=null&&(y.error=Q);const V=[...y.traceIds??[],...L.traceIds??[]];return V.length>0&&(y.traceIds=V),y}function K(y,L){const M=y.fields.find(R=>R.type===Y.PU.time),Q=y.fields.find(R=>R.type===Y.PU.string&&R.name==="id"),V=L.fields.find(R=>R.type===Y.PU.time),G=L.fields.find(R=>R.type===Y.PU.string&&R.name==="id");if(!M||!V){console.error(new Error("Time fields not found in the data frames"));return}const T=V?.values.slice(0)??[],U=Math.max(y.fields.length,L.fields.length);for(let R=0;R<T.length;R++){const H=oe(M,V,R),p=ae(M,Q,H,V,G,R);for(let m=0;m<U;m++){if(!y.fields[m])continue;const w=_(y.fields[m],L.fields,m);if(w)if(p){if(y.fields[m].type===Y.PU.time)continue;y.fields[m].type===Y.PU.number?y.fields[m].values[H]=(y.fields[m].values[H]??0)+w.values[R]:y.fields[m].type===Y.PU.other?typeof w.values[R]=="object"?y.fields[m].values[H]={...y.fields[m].values[H],...w.values[R]}:w.values[R]&&(y.fields[m].values[H]=w.values[R]):y.fields[m].values[H]=w.values[R]}else w.values[R]!==void 0&&(y.fields[m].values.splice(H,0,w.values[R]),w.nanos?(y.fields[m].nanos=y.fields[m].nanos??new Array(y.fields[m].values.length-1).fill(0),y.fields[m].nanos?.splice(H,0,w.nanos[R])):y.fields[m].nanos&&y.fields[m].nanos?.splice(H,0,0))}}y.length=y.fields[0].values.length,y.meta={...y.meta,stats:ge(y.meta?.stats??[],L.meta?.stats??[])}}function oe(y,L,M){const Q=(0,S.Ls)(L.values[M],y.values);return Q<0?0:L.values[M]===y.values[Q]&&L.nanos&&y.nanos?L.nanos[M]>y.nanos[Q]?Q+1:Q:L.values[M]>y.values[Q]?Q+1:Q}function ae(y,L,M,Q,V,G){return d(y,M,Q,G)?!L||!V?!0:L.values[M]!==void 0&&L.values[M]===V.values[G]:!1}function d(y,L,M,Q){return y.nanos&&M.nanos?y.values[L]!==void 0&&y.values[L]===M.values[Q]&&y.nanos[L]!==void 0&&y.nanos[L]===M.nanos[Q]:y.values[L]!==void 0&&y.values[L]===M.values[Q]}function _(y,L,M){const Q=L.filter(V=>V.name===y.name);return Q.length===1?Q[0]:y.labels?Q.find(V=>(0,A.ab)(y.labels??{},V.labels??{})):L[M]}const j="Summary: total bytes processed",v="Summary: exec time";function ge(y,L){const M=[];for(const Q of[j,v]){const V=y.find(U=>U.displayName===Q),G=L.find(U=>U.displayName===Q);if(G!=null&&V!=null){M.push({value:G.value+V.value,displayName:Q,unit:V.unit});continue}const T=G??V;T!=null&&M.push(T)}return M}function I(y){return{...y,data:y.data.map(le)}}function le(y){return{...y,fields:y.fields.map(L=>({...L,values:L.values}))}}function Z(y,L){if(y.refId!==L.refId||y.name!==L.name)return!1;const M=y.meta?.type,Q=L.meta?.type;if(M!==Q)return!1;if(M===J.m.TimeSeriesMulti){const T=y.fields.find(R=>R.type===Y.PU.number),U=L.fields.find(R=>R.type===Y.PU.number);return T===void 0||U===void 0?!1:(0,A.ab)(T.labels??{},U.labels??{})}const V=y.meta?.custom?.frameType,G=L.meta?.custom?.frameType;return V==="LabeledTimeValues"&&G==="LabeledTimeValues"?!0:V===G}},35725:(xe,de,l)=>{l.d(de,{Ch:()=>K,FN:()=>ae,Gk:()=>le,Lv:()=>M,OS:()=>w,aH:()=>I,cH:()=>V,cQ:()=>p,i6:()=>R,je:()=>oe,lN:()=>G,lq:()=>D,o9:()=>L,tE:()=>v,yB:()=>Q,yI:()=>y});var b=l(2543),Y=l.n(b),S=l(36195),A=l(22420),J=l(24162),ie=l(18362),O=l(32783),P=l(12282);class K{constructor(s,i,g){this.from=s,this.to=i,this.type=g}static fromNode(s){return new K(s.from,s.to,s.type)}contains(s){return this.from<=s.from&&this.to>=s.to}getExpression(s){return s.substring(this.from,this.to)}}function oe(u,s,i,g){return j(u,s,i,g).length>0}function ae(u,s,i,g){const E=j(u,s,i,g);for(const C of E)u=C.parent?.type.id===S.bY?d(u,C):_(u,C);return u}function d(u,s){const i=s.parent?.parent;return!i||i.type.id!==S.t3?u:(u.substring(0,i.from)+u.substring(i.to)).trim()}function _(u,s){let i=s;do i=i.parent;while(i&&i.type.id!==S.MD);const g=s.getChild(S.gw);if(!i||!g)return u;const E=u.substring(g.from,g.to),C=u.substring(0,i.from),z=u.substring(i.to),se=(0,O.u_)(u.substring(i.from,i.to));return se.query.labels=se.query.labels.filter(fe=>fe.label!==E),C+ie.y.renderQuery(se.query)+z}function j(u,s,i,g){const E=S.K3.parse(u),C=[];return E.iterate({enter:({type:z,node:se})=>{z.id===S.g$&&C.push(se)}}),C.filter(z=>{const se=z.getChild(S.gw),fe=se?.nextSibling,pe=z.getChild(S.Qf);if(!se||!fe||!pe||u.substring(se.from,se.to)!==s)return!1;const ve=u.substring(pe.from,pe.to);return!((0,O.w4)(ve)!==(0,A.qv)(g)||u.substring(fe.from,fe.to)!==i)})}function v(u,s,i,g,E){if(!s)throw new Error("Need label to add to query.");const C=Q(u);if(!C.length)return u;const z=V(u),se=G(u),fe=te(u),pe=(0,J.TQ)(u,[S.J_]);E||x(u).map(Ie=>Ie.getExpression(u)).includes(s)&&(E=P.HD.Indexed);const Pe=C.every($e=>fe.some(Ce=>Ce.from>=$e.from&&Ce.to<=$e.to)),ve=R(s,g,i);if(E===P.HD.Parsed||E===P.HD.StructuredMetadata){const $e=ge(u,[...C,...se,...z,...pe]);return p(u,$e,ve)}else{if(E===P.HD.Indexed)return H(u,C,ve);if(z.length===0||Pe===!1)return H(u,C,ve);{const $e=ge(u,[...z,...se,...pe]);return p(u,$e,ve)}}}function ge(u,s){const i=ue((0,J.TQ)(u,[S.GN])),g=[...s];return i.map(C=>D(g.filter(z=>C.contains(z))))}function I(u,s){const i=T(u);if(i.length)return Z(u,i,s);{const g=Q(u);return g.length?Z(u,g,s):u}}function le(u,s){const i=T(u);if(i.length)return Z(u,i,`drop ${s.join(", ")}`);{const g=Q(u);return g.length?Z(u,g,`drop ${s.join(", ")}`):u}}function Z(u,s,i){let g="",E=0;for(let C=0;C<s.length;C++){const z=s[C],se=C===s.length-1,fe=u.substring(E,z.to),pe=se?u.substring(z.to):"";g+=fe+` | ${i}`+pe,E=z.to}return g}function y(u){const s=V(u);if(!s.length)return u;const i=R("__error__","","=");return p(u,s,i)}function L(u,s){const i=U(u);return m(u,i,s)}function M(u){const s=N(u);if(!s.length)return u;let i="",g=0;for(let E of s)i=i+u.substring(g,E.from),g=E.to;return i=i+u.substring(g),i}function Q(u){const s=S.K3.parse(u),i=[];return s.iterate({enter:({type:g,node:E})=>{if(g.id===S.MD)return i.push(K.fromNode(E)),!1}}),i}function V(u){const s=S.K3.parse(u),i=[],g=[S.iT,S.eF,S.Zj,S.Tz];return s.iterate({enter:({type:E,node:C})=>{if(g.includes(E.id))return i.push(K.fromNode(C)),!1}}),i}function G(u){const s=S.K3.parse(u),i=[];return s.iterate({enter:({type:g,node:E})=>{if(g.id===S.bY)return i.push(K.fromNode(E)),!1}}),i}function T(u){const s=S.K3.parse(u),i=[];return s.iterate({enter:({type:g,node:E})=>{if(g.id===S.CX)return i.push(K.fromNode(E)),!1}}),i}function U(u){const s=S.K3.parse(u),i=[];return s.iterate({enter:({type:g,node:E})=>{if(g.id===S.UK)return i.push(K.fromNode(E)),!1;if(g.id===S.xo){const C=[],z=E.getChild(S.MD);z&&C.push(K.fromNode(z));const se=E.getChild(S.AL);se&&C.push(K.fromNode(se));const fe=E.getChild(S.HV);fe&&C.push(K.fromNode(fe));const pe=(0,b.sortBy)(C,Pe=>Pe.to);return i.push(new K(pe[0].from,pe[pe.length-1].to)),!1}}}),i}function R(u,s,i){return{label:u,op:i,value:s}}function H(u,s,i){let g="",E=0;for(let C=0;C<s.length;C++){const z=s[C],se=C===s.length-1,fe=u.substring(E,z.from),pe=se?u.substring(z.to):"",Pe=(0,O.u_)(u.substring(z.from,z.to));X(Pe.query.labels,i)||Pe.query.labels.push(i);const ve=ie.y.renderQuery(Pe.query);g+=fe+ve+pe,E=z.to}return g}function p(u,s,i){let g="",E=0;for(let C=0;C<s.length;C++){const z=s[C],se=C===s.length-1,fe=u.substring(E,z.to),pe=se?u.substring(z.to):"";let Pe="";!Number.isNaN(Number(i.value))&&(i.op==="<"||i.op===">")?Pe=` | ${i.label}${i.op}${Number(i.value)}`:Pe=` | ${i.label}${i.op}\`${(0,A.qv)(i.value)}\``,g+=fe+Pe+pe,E=z.to}return g}function m(u,s,i){let g="",E=0;for(let C=0;C<s.length;C++){const z=s[C],se=C===s.length-1,fe=u.substring(E,z.to),pe=se?u.substring(z.to):"",Pe=` | label_format ${i.renameTo}=${i.originalLabel}`;g+=fe+Pe+pe,E=z.to}return g}function w(u,s="",i="|="){const g=Q(u);if(!g.length)return u;const E=g[0].to;return u.slice(0,E)+` ${i} \`${s}\``+u.slice(E)}function N(u){const s=S.K3.parse(u),i=[];return s.iterate({enter:({type:g,from:E,to:C})=>{if(g.id===S.uk)return i.push(new K(E,C,g)),!1}}),i}function X(u,s){return u.find(i=>i.label===s.label&&i.value===s.value)}function D(u){return u.length?u.reduce((s,i)=>s.to>i.to?s:i):new K(0,0)}function ue(u){return u.filter(s=>u.every(i=>s.contains(i)===!1||s===i))}function q(u,s){if(u.type.id===s)return[K.fromNode(u)];const i=[];let g=0,E=u.childAfter(g);for(;E;)i.push(...q(E,s)),g=E.to,E=u.childAfter(g);return i}function te(u){const s=S.K3.parse(u),i=[];return s.iterate({enter:({node:g})=>{g.type.id===S.MD&&i.push(...q(g,S.g$))}}),i}function x(u){const s=S.K3.parse(u),i=[];return s.iterate({enter:({node:g})=>{g.type.id===S.MD&&i.push(...q(g,S.gw))}}),i}},68088:(xe,de,l)=>{l.d(de,{NW:()=>L,gn:()=>Z,K9:()=>G});var b=l(2543),Y=l(88483),S=l(59099),A=l(24726),J=l(25229),ie=l(28105),O=l(27359),P=l(739),K=l(74529),oe=l(17548);function ae(U,R,H){if(R-U<=H)return[[U,R]];const p=[];for(let m=R;m>U;m-=H){const w=Math.max(m-H,U);p.push([w,m])}return p.reverse(),p}var d=l(23235);function _(U,R,H,p){if(p<H)return[[U,R]];const m=Math.trunc(p/H)*H,w=U-U%H,N=[];for(let X=w;X<R;X+=m){const D=Math.min(X+m-H,R);N.push([X,D])}return N}var j=l(24162),v=l(69457),ge=l(47126),I=l(12282);function le(U,R,H,p){const m=R.from.toDate().getTime(),w=R.to.toDate().getTime();return(U?ae(m,w,p):_(m,w,H,p)).map(([X,D])=>{const ue=(0,J.KQ)(X),q=(0,J.KQ)(D);return{from:ue,to:q,raw:{from:ue,to:q}}})}function Z(U,R){return R?U.map(H=>{if(!H.maxLines||!(0,j.sI)(H.expr))return H;const p=R.data.find(w=>w.refId===H.refId);if(!p)return H;const m=H.maxLines-p.length;return{...H,maxLines:m<0?0:m}}).filter(H=>H.maxLines===void 0||H.maxLines>0):U}function y(U,R,H={}){const p=R.length?R[0].request.queryGroupId:(0,A.A)();let m={data:[],state:ie.Gu.Streaming,key:p};const w=Math.max(...R.map(({partition:u})=>u.length)),N=R.filter(({partition:u})=>u.length===w)[0].partition;let X=!1,D=null,ue=new Map,q=null;const te=(u,s,i)=>{let g=!1;if(D!=null&&(D.unsubscribe(),D=null),X){u.complete();return}const E=()=>{m.state=ie.Gu.Done,u.next(m),u.complete()},C=()=>{const{nextRequestN:ve,nextRequestGroup:$e}=Q(R,i,s);if(ve>0&&$e>=0){te(u,ve,$e);return}E()},z=ve=>{if(H.disableRetry)return!1;try{if(ve&&!(0,v.BY)(ve))return!1}catch(Ie){return console.error(Ie),X=!0,!1}const $e=`${s}-${i}`,Ce=ue.get($e)??0;return Ce>0?!1:(ue.set($e,Ce+1),q=setTimeout(()=>{te(u,s,i)},1500*Math.pow(2,Ce)),g=!0,!0)},se=R[i],fe=se.partition[s-1],pe=Z(se.request.targets,m);if(!pe.length){C();return}const Pe={...R[i].request,range:fe,targets:pe};se.request.requestId&&(Pe.requestId=`${se.request.requestId}_${s}`),D=U.runQuery(Pe).subscribe({next:ve=>{if((ve.errors??[]).length>0||ve.error!=null){if(z(ve))return;X=!0}m=(0,d.Wn)(m,ve),H.skipPartialUpdates||(m=M(m,Pe,N,s))},complete:()=>{g||(H.skipPartialUpdates||u.next(m),C())},error:ve=>{u.error(ve),z()}})};return new Y.c(u=>(te(u,w,0),()=>{X=!0,q&&(clearTimeout(q),q=null),D!=null&&(D.unsubscribe(),D=null)}))}const L="loki-splitting-progress";function M(U,R,H,p){if((0,j.sI)(R.targets[0].expr)||(U.data=U.data.filter(w=>w.name!==L),p<=1))return U;const m=(0,O.I)([{time:H[0].from.valueOf(),timeEnd:H[p-2].to.valueOf(),isRegion:!0,color:"rgba(120, 120, 120, 0.1)"}]);return m.name=L,m.meta={dataTopic:P.QR.Annotations},U.data.push(m),U}function Q(U,R,H){for(let p=R+1;p<U.length;p++)if(U[p].partition[H-1])return{nextRequestGroup:p,nextRequestN:H};return{nextRequestGroup:U.findIndex(p=>p?.partition[H-1]!==void 0),nextRequestN:H-1}}function V(U){return U.queryType!==I.U3.Instant&&!(0,j.Cg)(U.expr)}function G(U,R,H={}){const p=R.targets.filter(u=>!u.hide).filter(u=>u.expr),[m,w]=(0,b.partition)(p,u=>!V(u)),[N,X]=(0,b.partition)(w,u=>(0,j.sI)(u.expr));R.queryGroupId=(0,A.A)();const D=24*60*60*1e3,ue=(0,b.groupBy)(N,u=>u.direction===I.ti.Forward?I.ti.Forward:I.ti.Backward),q=[];for(const u in ue){const s=(0,b.groupBy)(ue[u],i=>i.splitDuration?(0,K.WT)((0,K.E9)(i.splitDuration)):D);for(const[i,g]of Object.entries(s)){const E=(0,b.groupBy)(g,C=>C.resolution||1);for(const C in E){const z={request:{...R,targets:E[C]},partition:le(!0,R.range,R.intervalMs,Number(i))};u===I.ti.Forward&&z.partition.reverse(),q.push(z)}}}const te=(0,b.groupBy)(X,u=>u.splitDuration?(0,K.WT)((0,K.E9)(u.splitDuration)):D);for(const[u,s]of Object.entries(te)){const i=(0,b.groupBy)(s,g=>T(R.intervalMs,R.range,g.resolution||1,g.step));for(const g in i){const E=i[g].map(C=>{const{maxLines:z,...se}=C;return se});q.push({request:{...R,targets:E},partition:le(!1,R.range,Number(g),Number(u))})}}m.length&&q.push({request:{...R,targets:m},partition:[R.range]});const x=new Date;return y(U,q,H).pipe((0,S.M)(u=>{u.state===ie.Gu.Done&&(0,ge.uJ)(u,q,R,x,{predefinedOperations:U.predefinedOperations})}))}function T(U,R,H,p){const m=/(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])/;if(p?.match(m))return oe.intervalToMs(p)*H;const w=U*H,N=Math.round((R.to.valueOf()-R.from.valueOf())/11e3);return Math.max(w,N)}},24162:(xe,de,l)=>{l.d(de,{$F:()=>j,Bg:()=>te,Cg:()=>p,E2:()=>N,FV:()=>y,H0:()=>O,Io:()=>ae,MX:()=>M,OT:()=>T,QH:()=>I,Rn:()=>H,TQ:()=>le,_i:()=>G,aw:()=>Q,d_:()=>V,g5:()=>U,gy:()=>w,kr:()=>ue,mW:()=>P,pS:()=>R,pk:()=>m,sI:()=>L,sc:()=>q,tO:()=>u,vV:()=>oe});var b=l(2543),Y=l.n(b),S=l(36195),A=l(35725),J=l(96426),ie=l(12282);function O(s=""){const i=[],g=I(s,[S.PN]);for(const E of g){const C=E.getChild(S.dJ)?.getChild(S.Sg),z=E.getChild(S.dJ)?.getChild(S.q5),se=K(E);if(!(!C&&!z||!se.length))for(const fe of se){const pe=s.substring(fe.from,fe.to).trim(),Pe=pe[0]==="`",ve=pe.substring(1,pe.length-1);if(!ve)continue;let $e="";z?$e=Pe?ve:ve.replace(/\\\\/g,"\\"):$e=(0,b.escapeRegExp)(ve),$e&&i.push($e)}}return i}function P(s){return s.replace("Expr: ","")}function K(s){const i=[];let g=s;do{const E=g.getChild(S.Qf);E&&!g.getChild(S.w7)&&i.push(E),g=g.getChild(S.ih)}while(g!=null);return i}function oe(s){let i=ae(s);const{instant:g,range:E,...C}=s;try{L(s.expr)&&i===ie.U3.Instant&&(i=ie.U3.Range)}catch{}return{...C,queryType:i}}function ae(s){const{queryType:i}=s;return i===ie.U3.Range||i===ie.U3.Instant||i===ie.U3.Stream?i:s.instant===!0?ie.U3.Instant:ie.U3.Range}const d=["String","Identifier","LineComment","Number"],_=["__error__","__interval","__interval_ms","__auto"];function j(s){let i=s;return S.K3.parse(s).iterate({enter:({name:E,from:C,to:z})=>{const se=s.substring(C,z);d.includes(E)&&!_.includes(se)&&(i=i.replace(se,E))}}),i}function v(s){const i=[];return parser.parse(s).iterate({enter:({name:E})=>{i.push(E)}}),i}function ge(s,i){let g=!1;return S.K3.parse(s).iterate({enter:({type:C})=>{if(C.id===i)return g=!0,!1}}),g}function I(s,i){const g=[];return S.K3.parse(s).iterate({enter:C=>{(i===void 0||i.includes(C.type.id))&&g.push(C.node)}}),g}function le(s,i){const g=[];return S.K3.parse(s).iterate({enter:C=>{(i===void 0||i.includes(C.type.id))&&g.push(A.Ch.fromNode(C.node))}}),g}function Z(s,i){const g=I(s,[i]);return g.length>0?g[0]:void 0}function y(s){return ge(s,J.Ql)}function L(s){return s.trim().length>2&&!ge(s,S.Yw)}function M(s){const g=I(s,[S.iT,S.eF,S.c$]).length;return{queryWithParser:g>0,parserCount:g}}function Q(s){const i=I(s,[S.iT,S.LM,S.c$]);return i.length>0?s.substring(i[0].from,i[0].to).trim():void 0}function V(s){const i=I(s,[S.bY]);for(const g of i){const E=g.getChild(S.g$)?.getChild(S.gw);if(E&&s.substring(E.from,E.to)==="__error__")return!0}return!1}function G(s){return ge(s,S.J_)}function T(s){if(L(s))return s;const i=Z(s,S.MD);if(!i)return"";const g=s.substring(i.from,i.to),E=Z(s,S.AL),C=E?s.substring(E.from,E.to):"";return`${g} ${C}`.trim()}function U(s,i){if(L(s))return s;const g=I(s,[S.Yw]).reverse().find(E=>E.from<=i&&E.to>=i);return g?T(s.substring(g.from,g.to)):""}function R(s){return ge(s,S.bY)}function H(s){return ge(s,S.PN)}function p(s){const i=I(s,[S.Q6]);for(const g of i)if(s.substring(g.from,g.to).match(/\[\$__range(_s|_ms)?/))return!0;return!1}function m(s){return(0,A.yB)(s).map(E=>s.slice(E.from,E.to))}function w(s){return s.filter(g=>!g.hide).filter(g=>!g.refId.includes("do-not-chunk")).filter(g=>g.expr).length>0}function N(s){return s.filter(g=>!g.hide).filter(g=>g.queryType!==ie.U3.Instant).filter(g=>!g.refId.includes("do-not-shard")).filter(g=>g.expr).filter(g=>g.direction===ie.ti.Scan&&L(g.expr)||X(g.expr)).length>0}function X(s){if(L(s)||(s=s.trim().toLowerCase(),I(s,[S.MK]).length>0))return!1;const g=I(s,[S.ZQ]),E=g.filter(pe=>D(s,pe)==="sum"),C=g.filter(pe=>D(s,pe)!=="sum"),z=E.filter(pe=>C.every(Pe=>pe.from<Pe.from));if(C.length>0)return z.length>0;const se=I(s,[S.lo]),fe=["count_over_time","sum_over_time","bytes_over_time"];for(const pe of se)if(!fe.includes(D(s,pe)))return z.length>0;return!0}function D(s,i){return s.substring(i.from,i.to)}const ue=s=>s?"expr"in s&&s.expr!==void 0:!1,q=s=>{if(!(!s||!ue(s)))return s},te=(s,i)=>{if(i.length===0)return s;let g=i.join("|");return g==="-1"||i.length===1?(g=g==="-1"?"":g,s.map(E=>({...E,expr:x(E.expr,"=",g)}))):s.map(E=>({...E,expr:x(E.expr,"=~",g)}))};function x(s,i,g){const E=(0,A.tE)(s,"__stream_shard__",i,g,ie.HD.Indexed);return L(s)?E:(0,A.Gk)(E,["__stream_shard__"])}const u=s=>{const i=I(s,[S.MD]);return i.length>0?s.substring(i[0].from,i[0].to):""}},18362:(xe,de,l)=>{l.d(de,{y:()=>oe});var b=l(42954),Y=l(55060),S=Object.defineProperty,A=(ae,d,_)=>d in ae?S(ae,d,{enumerable:!0,configurable:!0,writable:!0,value:_}):ae[d]=_,J=(ae,d,_)=>A(ae,typeof d!="symbol"?d+"":d,_);class ie{constructor(d,_){J(this,"operationsRegistry"),J(this,"categories",[]),J(this,"innerQueryPlaceholder"),this.operationsRegistry=new b.O(()=>d),this.innerQueryPlaceholder=_||"<query>"}setOperationCategories(d){this.categories=d}getOperationsForCategory(d){return this.operationsRegistry.list().filter(_=>_.category===d&&!_.hideFromList)}getAlternativeOperations(d){return this.operationsRegistry.list().filter(_=>_.alternativesKey&&_.alternativesKey===d)}getCategories(){return this.categories}getOperationDefinition(d){return this.operationsRegistry.getIfExists(d)}hasBinaryOp(d){return d.operations.find(_=>{const j=this.getOperationDefinition(_.id);return j?.category===Y.T})!==void 0}}var O=l(38903),P=l(95826);class K extends ie{constructor(){super(O.sp,"<expr>"),this.setOperationCategories([P.Ln.Aggregations,P.Ln.RangeFunctions,P.Ln.Formats,P.Ln.BinaryOps,P.Ln.LabelFilters,P.Ln.LineFilters])}renderOperations(d,_){for(const j of _){if(j.disabled)continue;const v=this.operationsRegistry.getIfExists(j.id);if(!v){console.error(`Could not find operation ${j.id} in the registry`);continue}d=v.renderer(j,v,d)}return d}renderBinaryQueries(d,_){if(_)for(const j of _)d=`${this.renderBinaryQuery(d,j)}`;return d}renderBinaryQuery(d,_){let j=d+` ${_.operator} `;return _.vectorMatches&&(j+=`${_.vectorMatchesType}(${_.vectorMatches}) `),j+this.renderQuery(_.query,!0)}renderLabels(d){if(d.length===0)return"{}";let _="{";for(const j of d)_!=="{"&&(_+=", "),_+=`${j.label}${j.op}"${j.value}"`;return _+"}"}renderQuery(d,_){let j=this.renderLabels(d.labels);return j=this.renderOperations(j,d.operations),!_&&this.hasBinaryOp(d)&&d.binaryQueries?.length&&(j=`(${j})`),j=this.renderBinaryQueries(j,d.binaryQueries),j}getQueryPatterns(){return[{name:"Parse log lines with logfmt parser",type:P.IQ.Log,operations:[{id:P.EF.Logfmt,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log lines with JSON parser",type:P.IQ.Log,operations:[{id:P.EF.Json,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log line and parse with logfmt parser",type:P.IQ.Log,operations:[{id:P.EF.LineContains,params:[""]},{id:P.EF.Logfmt,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]}]},{name:"Filter log lines and parse with json parser",type:P.IQ.Log,operations:[{id:P.EF.LineContains,params:[""]},{id:P.EF.Json,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]}]},{name:"Parse log line with logfmt parser and use label filter",type:P.IQ.Log,operations:[{id:P.EF.LineContains,params:[""]},{id:P.EF.Logfmt,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]},{id:P.EF.LabelFilter,params:["label","=","value"]}]},{name:"Parse log lines with nested json",type:P.IQ.Log,operations:[{id:P.EF.LineContains,params:[""]},{id:P.EF.Json,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]},{id:P.EF.LineFormat,params:["{{.message}}"]},{id:P.EF.Json,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]}]},{name:"Reformat log lines",type:P.IQ.Log,operations:[{id:P.EF.LineContains,params:[""]},{id:P.EF.Logfmt,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]},{id:P.EF.LineFormat,params:["{{.message}}"]}]},{name:"Rename lvl label to level",type:P.IQ.Log,operations:[{id:P.EF.LineContains,params:[""]},{id:P.EF.Logfmt,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]},{id:P.EF.LabelFormat,params:["lvl","level"]}]},{name:"Query on value inside a log line",type:P.IQ.Metric,operations:[{id:P.EF.LineContains,params:[""]},{id:P.EF.Logfmt,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]},{id:P.EF.Unwrap,params:[""]},{id:P.EF.LabelFilterNoErrors,params:[]},{id:P.EF.SumOverTime,params:["$__auto"]},{id:P.EF.Sum,params:[]}]},{name:"Total requests per label of streams",type:P.IQ.Metric,operations:[{id:P.EF.LineContains,params:[""]},{id:P.EF.CountOverTime,params:["$__auto"]},{id:P.EF.Sum,params:[]}]},{name:"Total requests per parsed label or label of streams",type:P.IQ.Metric,operations:[{id:P.EF.LineContains,params:[""]},{id:P.EF.Logfmt,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]},{id:P.EF.CountOverTime,params:["$__auto"]},{id:P.EF.Sum,params:[]}]},{name:"Bytes used by a log stream",type:P.IQ.Metric,operations:[{id:P.EF.LineContains,params:[""]},{id:P.EF.BytesOverTime,params:["$__auto"]}]},{name:"Count of log lines per stream",type:P.IQ.Metric,operations:[{id:P.EF.LineContains,params:[""]},{id:P.EF.CountOverTime,params:["$__auto"]}]},{name:"Top N results by label or parsed label",type:P.IQ.Metric,operations:[{id:P.EF.Logfmt,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]},{id:P.EF.CountOverTime,params:["$__auto"]},{id:P.EF.Sum,params:[]},{id:P.EF.TopK,params:[10]}]},{name:"Extracted quantile",type:P.IQ.Metric,operations:[{id:P.EF.Logfmt,params:[]},{id:P.EF.LabelFilterNoErrors,params:[]},{id:P.EF.Unwrap,params:["latency"]},{id:P.EF.LabelFilterNoErrors,params:[]},{id:P.EF.QuantileOverTime,params:["$__auto",.5]},{id:P.EF.Sum,params:[]}]}]}}const oe=new K},80124:(xe,de,l)=>{l.d(de,{C:()=>S,I:()=>A});var b=l(88744),Y=l(95826);const S=[{id:Y.EF.Addition,name:"Add scalar",sign:"+"},{id:Y.EF.Subtraction,name:"Subtract scalar",sign:"-"},{id:Y.EF.MultiplyBy,name:"Multiply by scalar",sign:"*"},{id:Y.EF.DivideBy,name:"Divide by scalar",sign:"/"},{id:Y.EF.Modulo,name:"Modulo by scalar",sign:"%"},{id:Y.EF.Exponent,name:"Exponent",sign:"^"},{id:Y.EF.EqualTo,name:"Equal to",sign:"==",comparison:!0},{id:Y.EF.NotEqualTo,name:"Not equal to",sign:"!=",comparison:!0},{id:Y.EF.GreaterThan,name:"Greater than",sign:">",comparison:!0},{id:Y.EF.LessThan,name:"Less than",sign:"<",comparison:!0},{id:Y.EF.GreaterOrEqual,name:"Greater or equal to",sign:">=",comparison:!0},{id:Y.EF.LessOrEqual,name:"Less or equal to",sign:"<=",comparison:!0}],A=S.map(ie=>{const O=[{name:"Value",type:"number"}];let P=[2];return ie.comparison&&(O.push({name:"Bool",type:"boolean",description:"If checked comparison will return 0 or 1 for the value rather than filtering."}),P=[2,!1]),{id:ie.id,name:ie.name,params:O,defaultParams:P,toggleable:!0,alternativesKey:"binary scalar operations",category:Y.Ln.BinaryOps,renderer:J(ie.sign),addOperationHandler:b.iZ}});function J(ie){return function(P,K,oe){let ae=P.params[0],d="";return P.params.length===2&&(d=P.params[1]?" bool":""),`${oe} ${ie}${d} ${ae}`}}},88744:(xe,de,l)=>{l.d(de,{af:()=>M,VR:()=>Q,G3:()=>w,jC:()=>q,fu:()=>_,yD:()=>j,iZ:()=>m,UF:()=>V,OS:()=>T,hh:()=>le,sn:()=>I,EP:()=>Z});var b=l(2543),Y=l(55127),S=l.n(Y),A=l(22420),J=l(77236),ie=l(74848),O=l(96540),P=l(18857);const K=({onChange:x,index:u,operationId:s,value:i,query:g,datasource:E,queryModeller:C})=>{const[z,se]=(0,O.useState)({});return(0,ie.jsx)(P.l6,{inputId:T(s,u),autoFocus:i==="",openMenuOnFocus:!0,onOpenMenu:async()=>{se({isLoading:!0});const fe=await oe(g,E,C);se({options:fe,isLoading:void 0})},isLoading:z.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:z.options,value:ae(i),onChange:fe=>x(u,fe.value)})};async function oe(x,u,s){let i=x.labels;const g=s.renderLabels(i);return(await u.languageProvider.fetchLabels({streamSelector:g})).map(C=>({label:C,value:C}))}const ae=x=>({label:x?.toString(),value:x});var d=l(95826);function _(x,u){const s=[G()],i=["$__auto"];let g;return x===d.EF.QuantileOverTime&&(i.push("0.95"),s.push({name:"Quantile",type:"number"})),u&&(s.push({name:"By label",type:"string",restParam:!0,optional:!0}),g=U(`__${x}_by`)),{id:x,name:p(x),params:s,defaultParams:i,toggleable:!0,alternativesKey:"range function",category:d.Ln.RangeFunctions,orderRank:d.h5.RangeVectorFunction,renderer:ge,addOperationHandler:M,paramChangedHandler:g,explainHandler:(E,C)=>{let z=J.AW.find(se=>se.insertText===E.id)?.documentation??"";return E.params[0]==="$__auto"?`${z} \`$__auto\` is a variable that will be replaced with the [value of step](https://grafana.com/docs/grafana/next/datasources/loki/query-editor/#options) for range queries and with the value of the selected time range (calculated to - from) for instant queries.`:`${z} The [range vector](https://grafana.com/docs/loki/latest/logql/metric_queries/#range-vector-aggregation) is set to \`${E.params[0]}\`.`}}}function j(x){const u=_(x,!0),s=u.params.slice(0,-1);return[u,{id:`__${x}_by`,name:`${p(x)} by`,params:[...s,{name:"Label",type:"string",restParam:!0,optional:!0,editor:K}],defaultParams:[...u.defaultParams,""],toggleable:!0,alternativesKey:"range function with grouping",category:d.Ln.RangeFunctions,renderer:v(x,"by"),paramChangedHandler:H(x),explainHandler:R(x,"by"),addOperationHandler:M,hideFromList:!0},{id:`__${x}_without`,name:`${p(x)} without`,params:[...s,{name:"Label",type:"string",restParam:!0,optional:!0,editor:K}],defaultParams:[...u.defaultParams,""],alternativesKey:"range function with grouping",category:d.Ln.RangeFunctions,renderer:v(x,"without"),paramChangedHandler:H(x),explainHandler:R(x,"without"),addOperationHandler:M,hideFromList:!0}]}function v(x,u){return function(i,g,E){const C=g.params.findIndex(fe=>fe.restParam),z=i.params.slice(0,C),se=i.params.slice(C);return z.length===2&&x===d.EF.QuantileOverTime?`${x}(${z[1]}, ${E} [${z[0]}]) ${u} (${se.join(", ")})`:`${x}(${E} [${z[0]}]) ${u} (${se.join(", ")})`}}function ge(x,u,s){const i=x.params??[],g=i[0]??"$__auto";if(i.length===2&&x.id===d.EF.QuantileOverTime){const E=i[1];return`${x.id}(${E}, ${s} [${g}])`}return`${x.id}(${s} [${i[0]??"$__auto"}])`}function I(x,u,s){return["<","<=",">",">="].includes(String(x.params[1]))?`${s} | ${x.params[0]} ${x.params[1]} ${x.params[2]}`:`${s} | ${x.params[0]} ${x.params[1]} \`${x.params[2]}\``}function le(x,u){if(!x)return!1;const s=x.params[1].toString().startsWith("!");return u.filter(E=>E.id===d.EF.LabelFilter&&E.params[0]===x.params[0]&&E.params[2]===x.params[2]).some(E=>!!(s&&E.params[1].toString().startsWith("!")===!1||s===!1&&E.params[1].toString().startsWith("!")))}function Z(x,u,s){switch(x.id){case d.EF.Logfmt:const[i=!1,g=!1,...E]=x.params;return`${s} | logfmt${i?" --strict":""}${g?" --keep-empty":""} ${E.filter(C=>C).join(", ")}`.trim();case d.EF.Json:return`${s} | json ${x.params.filter(C=>C).join(", ")}`.trim();case d.EF.Drop:return`${s} | drop ${x.params.filter(C=>C).join(", ")}`.trim();case d.EF.Keep:return`${s} | keep ${x.params.filter(C=>C).join(", ")}`.trim();default:return`${s} | ${x.id}`}}function y(x){return x.category===d.Ln.RangeFunctions}function L(x,u,s){const i=x.findIndex(g=>{const E=u.getOperationDefinition(g.id);return E?s(E):!1});return i===-1?x.length:i}function M(x,u,s){const i={id:x.id,params:x.defaultParams},g=[...u.operations],E=g.find(C=>{const z=s.getOperationDefinition(C.id);return z?y(z):!1});switch(x.category){case d.Ln.Aggregations:case d.Ln.Functions:if(!E){const z=L(g,s,se=>se.category===d.Ln.Functions);g.splice(z,0,{id:d.EF.Rate,params:["$__auto"]})}g.push(i);break;case d.Ln.RangeFunctions:if(E){const z=g.indexOf(E);g[z]=i;break}default:const C=L(g,s,z=>(x.orderRank??100)<(z.orderRank??100));g.splice(C,0,i);break}return{...u,operations:g}}function Q(x,u){return{...u,binaryQueries:[...u.binaryQueries??[],{operator:"/",query:u}]}}function V(x,u){return function(i,g,E){const C=i.params.some(fe=>typeof fe=="string"&&fe.includes("`")),z=C?'"':"`";let se;return C?se=i.params.map(fe=>typeof fe=="string"?(0,A.Qn)(fe):fe):se=i.params,u?`${E} ${x} ${z}(?i)${se.join(`${z} or ${z}(?i)`)}${z}`:`${E} ${x} ${z}${se.join(`${z} or ${z}`)}${z}`}}function G(){return{name:"Range",type:"string",options:["$__auto"],description:'Use the default value "$__auto". Change the "step" value in the query options to change the bucket size.'}}function T(x,u){return`operations.${x}.param.${u}`}function U(x){return function(s,i,g){return i.params.length===g.params.length?{...i,id:x}:i}}function R(x,u){return function(i){const g=i.params.map(C=>`\`${C}\``).join(" and "),E=S()("label",i.params.length);switch(u){case"by":return`Calculates ${x} over dimensions while preserving ${E} ${g}.`;case"without":return`Calculates ${x} over the dimensions ${g}. All other labels are preserved.`;default:return`Calculates ${x} over the dimensions.`}}}function H(x){return function(s,i,g){return i.params.length<g.params.length?{...i,id:x}:i}}function p(x){return(0,b.capitalize)(x.replace(/_/g," "))}function m(x,u){const s={id:x.id,params:x.defaultParams};return{...u,operations:[...u.operations,s]}}function w(x,u={}){return[{id:x,name:p(x),params:[{name:"By label",type:"string",restParam:!0,optional:!0}],defaultParams:[],toggleable:!0,alternativesKey:"plain aggregations",category:d.Ln.Aggregations,renderer:X,paramChangedHandler:U(`__${x}_by`),explainHandler:R(x,""),addOperationHandler:m,...u},{id:`__${x}_by`,name:`${p(x)} by`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:K}],defaultParams:[""],alternativesKey:"aggregations by",category:d.Ln.Aggregations,renderer:ue(x),paramChangedHandler:H(x),explainHandler:R(x,"by"),addOperationHandler:m,hideFromList:!0,...u},{id:`__${x}_without`,name:`${p(x)} without`,params:[{name:"Label",type:"string",restParam:!0,optional:!0,editor:K}],defaultParams:[""],alternativesKey:"aggregations by",category:d.Ln.Aggregations,renderer:N(x),paramChangedHandler:H(x),explainHandler:R(x,"without"),addOperationHandler:m,hideFromList:!0,...u}]}function N(x){return function(s,i,g){return`${x} without(${s.params.join(", ")}) (${g})`}}function X(x,u,s){const i=D(x,u,s),g=x.id+"(";return s&&i.push(s),g+i.join(", ")+")"}function D(x,u,s){return(x.params??[]).map((i,g)=>u.params[g].type==="string"?'"'+i+'"':i)}function ue(x){return function(s,i,g){return`${x} by(${s.params.join(", ")}) (${g})`}}function q(x,u,s={}){const i=w(x,s);return i[0].params.unshift(...u.params),i[1].params.unshift(...u.params),i[2].params.unshift(...u.params),i[0].defaultParams=u.defaultParams,i[1].defaultParams=[...u.defaultParams,""],i[2].defaultParams=[...u.defaultParams,""],i[1].renderer=te(x),i[2].renderer=te(x),i}function te(x){return function(s,i,g){const E=i.params.findIndex(se=>se.restParam),C=s.params.slice(0,E),z=s.params.slice(E);return`${x} by(${z.join(", ")}) (${C.map((se,fe)=>i.params[fe].type==="string"?`"${se}"`:se).join(", ")}, ${g})`}}},38903:(xe,de,l)=>{l.d(de,{VI:()=>y,y6:()=>le,mD:()=>Z,sp:()=>I});var b=l(80124),Y=l(74848),S=l(96540),A=l(47184),J=l(22592),ie=l(43173),O=l(18857),P=l(27522),K=l(76484),oe=l(24162),ae=l(69457),d=l(88744);function _({onChange:L,index:M,operationId:Q,value:V,query:G,datasource:T,timeRange:U,queryModeller:R}){const[H,p]=(0,S.useState)({});return(0,Y.jsx)(O.l6,{inputId:(0,d.OS)(Q,M),onOpenMenu:async()=>{if(T instanceof K.VQ&&ie.$.featureToggles.lokiQueryHints){p({isLoading:!0});const m=await j(G,T,R,U);p({options:m,isLoading:void 0})}},isLoading:H.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:H.options,value:V?(0,A.z)(V.toString()):null,onChange:m=>{m.value&&L(M,m.value)}})}async function j(L,M,Q,V=(0,J.E2)()){const G=Q.renderQuery(L),T=(0,oe.OT)(G);if((0,oe.FV)(M.interpolateString(T,P.a)))return[];const U=await M.getDataSamples({expr:T,refId:"unwrap_samples"},V);return(0,ae.aN)(U[0]).map(p=>({label:p,value:p}))}var v=l(95826);function ge(){const L=[v.EF.Sum,v.EF.Min,v.EF.Max,v.EF.Avg,v.EF.Stddev,v.EF.Stdvar,v.EF.Count].flatMap(T=>(0,d.G3)(T,{addOperationHandler:d.af,orderRank:v.h5.Last})),M=[v.EF.TopK,v.EF.BottomK].flatMap(T=>(0,d.jC)(T,{params:[{name:"K-value",type:"number"}],defaultParams:[5]},{addOperationHandler:d.af,orderRank:v.h5.Last})),Q=[(0,d.fu)(v.EF.Rate),(0,d.fu)(v.EF.RateCounter),(0,d.fu)(v.EF.CountOverTime),(0,d.fu)(v.EF.SumOverTime),(0,d.fu)(v.EF.BytesRate),(0,d.fu)(v.EF.BytesOverTime),(0,d.fu)(v.EF.AbsentOverTime)],V=[...(0,d.yD)(v.EF.AvgOverTime),...(0,d.yD)(v.EF.MaxOverTime),...(0,d.yD)(v.EF.MinOverTime),...(0,d.yD)(v.EF.FirstOverTime),...(0,d.yD)(v.EF.LastOverTime),...(0,d.yD)(v.EF.StdvarOverTime),...(0,d.yD)(v.EF.StddevOverTime),...(0,d.yD)(v.EF.QuantileOverTime)];return[...L,...M,...Q,...V,{id:v.EF.Json,name:"Json",params:[{name:"Expression",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'server="servers[0]"',description:"Using expressions with your json parser will extract only the specified json fields to labels. You can specify one or more expressions in this way. All expressions must be quoted."}],defaultParams:[],toggleable:!0,alternativesKey:"format",category:v.Ln.Formats,orderRank:v.h5.Parsers,renderer:d.EP,addOperationHandler:d.af,explainHandler:()=>"This will extract keys and values from a [json](https://grafana.com/docs/loki/latest/logql/log_queries/#json) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:v.EF.Logfmt,name:"Logfmt",params:[{name:"Strict",type:"boolean",optional:!0,description:"With strict parsing enabled, the logfmt parser immediately stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair."},{name:"Keep empty",type:"boolean",optional:!0,description:"The logfmt parser retains standalone keys (keys without a value) as labels with its value set to empty string. "},{name:"Expression",type:"string",optional:!0,restParam:!0,minWidth:18,placeholder:"field_name",description:"Using expressions with your logfmt parser will extract and rename (if provided) only the specified fields to labels. You can specify one or more expressions in this way."}],defaultParams:[!1,!1],toggleable:!0,alternativesKey:"format",category:v.Ln.Formats,orderRank:v.h5.Parsers,renderer:d.EP,addOperationHandler:d.af,explainHandler:()=>"This will extract all keys and values from a [logfmt](https://grafana.com/docs/loki/latest/logql/log_queries/#logfmt) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:v.EF.Regexp,name:"Regexp",params:[{name:"String",type:"string",hideName:!0,placeholder:"<re>",description:"The regexp expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:v.Ln.Formats,orderRank:v.h5.Parsers,renderer:(T,U,R)=>`${R} | regexp \`${T.params[0]}\``,addOperationHandler:d.af,explainHandler:()=>'The [regexp parser](https://grafana.com/docs/loki/latest/logql/log_queries/#regular-expression) takes a single parameter | regexp "<re>" which is the regular expression using the Golang RE2 syntax. The regular expression must contain a least one named sub-match (e.g (?P<name>re)), each sub-match will extract a different label. The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.'},{id:v.EF.Pattern,name:"Pattern",params:[{name:"String",type:"string",hideName:!0,placeholder:"<pattern-expression>",description:"The expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:v.Ln.Formats,orderRank:v.h5.Parsers,renderer:(T,U,R)=>`${R} | pattern \`${T.params[0]}\``,addOperationHandler:d.af,explainHandler:()=>"The [pattern parser](https://grafana.com/docs/loki/latest/logql/log_queries/#pattern) allows the explicit extraction of fields from log lines by defining a pattern expression (| pattern `<pattern-expression>`). The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:v.EF.Unpack,name:"Unpack",params:[],defaultParams:[],toggleable:!0,alternativesKey:"format",category:v.Ln.Formats,orderRank:v.h5.Parsers,renderer:d.EP,addOperationHandler:d.af,explainHandler:()=>"This will extract all keys and values from a JSON log line, [unpacking](https://grafana.com/docs/loki/latest/logql/log_queries/#unpack) all embedded labels in the pack stage. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:v.EF.LineFormat,name:"Line format",params:[{name:"String",type:"string",hideName:!0,placeholder:"{{.status_code}}",description:"A line template that can refer to stream labels and extracted labels.",minWidth:20}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:v.Ln.Formats,orderRank:v.h5.PipeOperations,renderer:(T,U,R)=>`${R} | line_format \`${T.params[0]}\``,addOperationHandler:d.af,explainHandler:()=>`This will replace log line using a specified template. The template can refer to stream labels and extracted labels.

Example: \`{{.status_code}} - {{.message}}\`

[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#line-format-expression) for more.
        `},{id:v.EF.LabelFormat,name:"Label format",params:[{name:"Label",type:"string"},{name:"Rename to",type:"string"}],defaultParams:["",""],toggleable:!0,alternativesKey:"format",category:v.Ln.Formats,orderRank:v.h5.PipeOperations,renderer:(T,U,R)=>`${R} | label_format ${T.params[1]}=${T.params[0]}`,addOperationHandler:d.af,explainHandler:()=>'This will change name of label to desired new label. In the example below, label "error_level" will be renamed to "level".\n\nExample: ``error_level=`level` ``\n\n[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#labels-format-expression) for more.\n        '},{id:v.EF.LineContains,name:"Line contains",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:20,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:v.Ln.LineFilters,orderRank:v.h5.LineFilters,renderer:(0,d.UF)("|="),addOperationHandler:d.af,explainHandler:T=>`Return log lines that contain string \`${T.params?.join("`, or `")}\`.`},{id:v.EF.LineContainsNot,name:"Line does not contain",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:26,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:v.Ln.LineFilters,orderRank:v.h5.LineFilters,renderer:(0,d.UF)("!="),addOperationHandler:d.af,explainHandler:T=>`Return log lines that does not contain string \`${T.params?.join("`, or `")}\`.`},{id:v.EF.LineContainsCaseInsensitive,name:"Line contains case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:33,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:v.Ln.LineFilters,orderRank:v.h5.LineFilters,renderer:(0,d.UF)("|~",!0),addOperationHandler:d.af,explainHandler:T=>`Return log lines that match regex \`(?i)${T.params?.join("`, or `(?i)")}\`.`},{id:v.EF.LineContainsNotCaseInsensitive,name:"Line does not contain case insensitive",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:40,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:v.Ln.LineFilters,orderRank:v.h5.LineFilters,renderer:(0,d.UF)("!~",!0),addOperationHandler:d.af,explainHandler:T=>`Return log lines that does not match regex \`(?i)${T.params?.join("`, or `(?i)")}\`.`},{id:v.EF.LineMatchesRegex,name:"Line contains regex match",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to match",description:"Find log lines that match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:v.Ln.LineFilters,orderRank:v.h5.LineFilters,renderer:(0,d.UF)("|~"),addOperationHandler:d.af,explainHandler:T=>`Return log lines that match a \`RE2\` regex pattern. \`${T.params?.join("`, or `")}\`.`},{id:v.EF.LineMatchesRegexNot,name:"Line does not match regex",params:[{name:"",type:"string",hideName:!0,restParam:!0,placeholder:"Pattern to exclude",description:"Find log lines that does not match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],toggleable:!0,alternativesKey:"line filter",category:v.Ln.LineFilters,orderRank:v.h5.LineFilters,renderer:(0,d.UF)("!~"),addOperationHandler:d.af,explainHandler:T=>`Return log lines that doesn't match a \`RE2\` regex pattern. \`${T.params?.join("`, or `")}\`.`},{id:v.EF.LineFilterIpMatches,name:"IP line filter expression",params:[{name:"Operator",type:"string",minWidth:16,options:[v.NS.contains,v.NS.doesNotContain]},{name:"Pattern",type:"string",placeholder:"<pattern>",minWidth:16,runQueryOnEnter:!0}],defaultParams:["|=",""],toggleable:!0,alternativesKey:"line filter",category:v.Ln.LineFilters,orderRank:v.h5.LineFilters,renderer:(T,U,R)=>`${R} ${T.params[0]} ip(\`${T.params[1]}\`)`,addOperationHandler:d.af,explainHandler:T=>`Return log lines using IP matching of \`${T.params[1]}\``},{id:v.EF.LabelFilter,name:"Label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[v.NS.equals,v.NS.doesNotEqual,v.NS.matchesRegex,v.NS.doesNotMatchRegex,v.NS.greaterThan,v.NS.lessThan,v.NS.greaterThanOrEqual,v.NS.lessThanOrEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],toggleable:!0,alternativesKey:"label filter",category:v.Ln.LabelFilters,orderRank:v.h5.PipeOperations,renderer:d.sn,addOperationHandler:d.af,explainHandler:()=>"Label expression filter allows filtering using original and extracted labels."},{id:v.EF.LabelFilterIpMatches,name:"IP label filter expression",params:[{name:"Label",type:"string",minWidth:14},{name:"Operator",type:"string",minWidth:14,options:[v.NS.equals,v.NS.doesNotEqual]},{name:"Value",type:"string",minWidth:14}],defaultParams:["","=",""],toggleable:!0,alternativesKey:"label filter",category:v.Ln.LabelFilters,orderRank:v.h5.PipeOperations,renderer:(T,U,R)=>`${R} | ${T.params[0]} ${T.params[1]} ip(\`${T.params[2]}\`)`,addOperationHandler:d.af,explainHandler:T=>`Return log lines using IP matching of \`${T.params[2]}\` for \`${T.params[0]}\` label`},{id:v.EF.LabelFilterNoErrors,name:"No pipeline errors",params:[],defaultParams:[],toggleable:!0,alternativesKey:"label filter",category:v.Ln.LabelFilters,orderRank:v.h5.NoErrors,renderer:(T,U,R)=>`${R} | __error__=\`\``,addOperationHandler:d.af,explainHandler:()=>"Filter out all formatting and parsing errors."},{id:v.EF.Unwrap,name:"Unwrap",params:[{name:"Identifier",type:"string",hideName:!0,minWidth:16,placeholder:"Label key",editor:_},{name:"Conversion function",hideName:!0,type:"string",options:["duration","duration_seconds","bytes"],optional:!0}],defaultParams:["",""],toggleable:!0,alternativesKey:"format",category:v.Ln.Formats,orderRank:v.h5.Unwrap,renderer:(T,U,R)=>`${R} | unwrap ${T.params[1]?`${T.params[1]}(${T.params[0]})`:T.params[0]}`,addOperationHandler:d.af,explainHandler:T=>{let U=String(T.params[0]).length>0?T.params[0]:"<label>";return`Use the extracted label \`${U}\` as sample values instead of log lines for the subsequent range aggregation.${T.params[1]?` Conversion function \`${T.params[1]}\` wrapping \`${U}\` will attempt to convert this label from a specific format (e.g. 3k, 500ms).`:""}`}},{id:v.EF.Decolorize,name:"Decolorize",params:[],defaultParams:[],toggleable:!0,alternativesKey:"format",category:v.Ln.Formats,orderRank:v.h5.PipeOperations,renderer:(T,U,R)=>`${R} | decolorize`,addOperationHandler:d.af,explainHandler:()=>"This will remove ANSI color codes from log lines."},{id:v.EF.Drop,name:"Drop",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to drop."}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:v.Ln.Formats,orderRank:v.h5.PipeOperations,renderer:d.EP,addOperationHandler:d.af,explainHandler:()=>"The drop expression will drop the given labels in the pipeline."},{id:v.EF.Keep,name:"Keep",params:[{name:"Label",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'job="grafana"',description:"Specify labels or expressions to keep."}],defaultParams:[""],toggleable:!0,alternativesKey:"format",category:v.Ln.Formats,orderRank:v.h5.PipeOperations,renderer:d.EP,addOperationHandler:d.af,explainHandler:()=>"The keep expression will keep only the specified labels in the pipeline and drop all the other labels."},...b.I,{id:v.EF.NestedQuery,name:"Binary operation with query",params:[],defaultParams:[],toggleable:!0,category:v.Ln.BinaryOps,renderer:(T,U,R)=>R,addOperationHandler:d.VR}]}const I=ge();function le(L){return(I.find(V=>V.id===L)?.explainHandler?.({id:"",params:["<value>"]})||"").replace(/\[(.*)\]\(.*\)/g,"$1")}function Z(L){return I.find(M=>M.id===L)}function y(L,M){return!(M.length<L.params.filter(Q=>!Q.optional).length)}},32783:(xe,de,l)=>{l.d(de,{u_:()=>ie,w4:()=>V});var b=l(36195),Y=l(80124),S=l(38903),A=l(96426),J=l(95826);function ie(p){const m=(0,A.qk)(p),N=b.K3.parse(m).topNode,D={query:{labels:[],operations:[]},errors:[]};try{O(m,N,D)}catch(ue){console.error(ue),ue instanceof Error&&D.errors.push({text:ue.message})}return U(D.query)&&(D.errors=[]),D}function O(p,m,w){const N=w.query;switch(m.type.id){case b.g$:{N.labels.push(P(p,m));const X=m.getChild(A.Ql);X&&w.errors.push((0,A.xz)(p,X));break}case b.PN:{const{operation:X,error:D}=K(p,m);X&&N.operations.push(X),D&&w.errors.push(T(p,m,D));break}case b.iT:{N.operations.push(oe(p,m));break}case b.bY:{const{operation:X,error:D}=_(p,m);X&&N.operations.push(X),D&&w.errors.push(T(p,m,D));break}case b.eF:{N.operations.push(ae(p,m));break}case b.Zj:case b.Tz:{const{operation:X,error:D}=d(p,m);X&&N.operations.push(X),D&&w.errors.push(T(p,m,D));break}case b.pH:{N.operations.push(j(p,m));break}case b.e_:{N.operations.push(v(p,m));break}case b.HV:{const{operation:X,error:D}=I(p,m,w);X&&N.operations.push(X),D&&w.errors.push(T(p,m,D));break}case b.Zg:{N.operations.push(ge());break}case b.h1:{N.operations.push(le(p,m,w));break}case b.Rh:{N.operations.push(Z(p,m,w));break}case b.MK:{L(p,m,w);break}case A.Ql:{if(Q(m))break;w.errors.push((0,A.xz)(p,m));break}case b.i8:{N.operations.push(R(p,m,w));break}case b.UP:{N.operations.push(H(p,m,w));break}default:{let X=m.firstChild;for(;X;)O(p,X,w),X=X.nextSibling}}}function P(p,m){const w=m.getChild(b.gw),N=(0,A.AA)(p,w),X=(0,A.AA)(p,w?.nextSibling);let D=(0,A.AA)(p,m.getChild(b.Qf));return D=D.substring(1,D.length-1),{label:N,op:X,value:D}}function K(p,m){const w=(0,A.AA)(p,m.getChild(b.dJ)),N=V((0,A.AA)(p,m.getChild(b.Qf)));if(m.getChild(b.w7)?.getChild(b.Ip))return{operation:{id:J.EF.LineFilterIpMatches,params:[w,N]}};const D=[N];let ue=m.getChild(b.ih);for(;ue;)D.push(V((0,A.AA)(p,ue.getChild(b.Qf)))),ue=ue.getChild(b.ih);return{operation:{id:{"|=":J.EF.LineContains,"!=":J.EF.LineContainsNot,"|~":J.EF.LineMatchesRegex,"!~":J.EF.LineMatchesRegexNot}[w],params:D}}}function oe(p,m){const w=m.firstChild,N=(0,A.AA)(p,w),X=V((0,A.AA)(p,m.getChild(b.Qf)));let D=X?[X]:[];const ue=(0,S.mD)(N);return ue&&!(0,S.VI)(ue,D)&&(D=ue?.defaultParams||[]),{id:N,params:D}}function ae(p,m){const w=m.getChild(b.LM),N=(0,A.AA)(p,w),X=[...(0,A.R1)(p,m,b.Gn)];return{id:N,params:X}}function d(p,m){const w=[],N=[];let X;const D=m.from;return m.toTree().iterate({enter:q=>{q.type.id===b.ov?w.push(p.substring(q.from+D,q.to+D)):q.type.id===b.Gn?N.push(p.substring(q.from+D,q.to+D)):q.type.id===A.Ql&&(X=`Unexpected string "${p.substring(q.from+D,q.to+D)}"`)}}),{operation:{id:J.EF.Logfmt,params:[w.includes("--strict"),w.includes("--keep-empty"),...N]},error:X}}function _(p,m){if(m.getChild(b.Or)||m.getChild(b.KD)||m.getChild("Comma"))return{error:'Label filter with comma, "and", "or" not supported in query builder'};if(m.firstChild.type.id===b.GA){const te=m.firstChild,x=te?.getChild(b.gw),u=x?.nextSibling,s=te?.getChild(b.Qf),i=V((0,A.AA)(p,s));return{operation:{id:J.EF.LabelFilterIpMatches,params:[(0,A.AA)(p,x),(0,A.AA)(p,u),i]}}}const w=J.EF.LabelFilter;if(m.firstChild.type.id===b.Jq){const x=m.firstChild.firstChild.firstChild,u=x.nextSibling,s=u.nextSibling,i=V((0,A.AA)(p,s));return{operation:{id:w,params:[(0,A.AA)(p,x),(0,A.AA)(p,u),i]}}}const X=m.firstChild.firstChild,D=X.nextSibling,ue=D.nextSibling,q=[(0,A.AA)(p,X),(0,A.AA)(p,D),V((0,A.AA)(p,ue))];return q.join("")==="__error__="?{operation:{id:J.EF.LabelFilterNoErrors,params:[]}}:{operation:{id:w,params:q}}}function j(p,m){const w=J.EF.LineFormat,N=V((0,A.AA)(p,m.getChild(b.Qf)));return{id:w,params:[N]}}function v(p,m){const w=J.EF.LabelFormat,N=m.getChild(b.gw),D=N.nextSibling.nextSibling;return{id:w,params:[(0,A.AA)(p,D),V((0,A.AA)(p,N))]}}function ge(){return{id:J.EF.Decolorize,params:[]}}function I(p,m,w){const N=m.getChild(b.HV),X=m.getChild(b.bY),D=m.getChild(b.sK);if(N&&O(p,N,w),X&&O(p,X,w),D){if(D.nextSibling?.type.id===b.yW){const ue=D.nextSibling,q=ue.nextSibling;return{operation:{id:J.EF.Unwrap,params:[(0,A.AA)(p,q),(0,A.AA)(p,ue)]}}}return{operation:{id:J.EF.Unwrap,params:[(0,A.AA)(p,D?.nextSibling),""]}}}return{}}function le(p,m,w){const N=m.getChild(b.lo),X=(0,A.AA)(p,N),D=m.getChild(b.wN),ue=m.getChild(b.xo),q=D!=null?[(0,A.AA)(p,D)]:[],te=ue?.getChild(b.Q6),x=te?(0,A.AA)(p,te):null,u=m.getChild(b.aU);x&&q.unshift(x.substring(1,x.length-1)),u&&q.push(...(0,A.R1)(p,u,b.gw));const s={id:X,params:q};return ue&&O(p,ue,w),s}function Z(p,m,w){const N=m.getChild(b.ZQ);let X=(0,A.AA)(p,N);const D=m.getChild(b.aU),ue=[],q=m.getChild(b.wN);q&&ue.push(Number((0,A.AA)(p,q))),D&&(D.getChild(b.By)&&X&&(X=`__${X}_by`),D.getChild(b.xB)&&(X=`__${X}_without`),ue.push(...(0,A.R1)(p,D,b.gw)));const te=m.getChild(b.Yw),x={id:X,params:ue};return te&&(te.firstChild?.type.id===b.MK&&w.errors.push({text:"Query parsing is ambiguous.",from:te.firstChild.from,to:te.firstChild?.to}),O(p,te,w)),x}const y=Y.C.reduce((p,m)=>(p[m.sign]={id:m.id,comparison:m.comparison},p),{});function L(p,m,w){const N=w.query,X=m.firstChild,D=(0,A.AA)(p,X.nextSibling),ue=M(p,m.getChild(b.o5)),q=m.lastChild,te=y[D],x=G(X,"MetricExpr.LiteralExpr.Number"),u=G(q,"MetricExpr.LiteralExpr.Number"),s=q.getChild(b.MK);if(x||O(p,X,w),u)N.operations.push((0,A.rq)(te,p,q,!!ue?.isBool));else if(s){const i=(0,A.z9)(q);i?.type.id===b.wN&&N.operations.push((0,A.rq)(te,p,i,!!ue?.isBool)),O(p,q,w)}else{N.binaryQueries=N.binaryQueries||[];const i={operator:D,query:{labels:[],operations:[]}};ue?.isMatcher&&(i.vectorMatchesType=ue.matchType,i.vectorMatches=ue.matches),N.binaryQueries.push(i),O(p,q,{query:i.query,errors:w.errors})}}function M(p,m){if(!m)return;const w=m.getChild(b.wT),N=m.getChild(b.x);if(!w&&N)return{isBool:!0,isMatcher:!1};{if(!w)return;const X=(0,A.AA)(p,w.getChild(b.x$)?.getChild(b.qJ));return{isMatcher:!0,isBool:!!N,matches:X,matchType:w.getChild(b.On)?"on":"ignoring"}}}function Q(p){return p?.parent?.type.id===b.Q6}function V(p){return p[0]==='"'&&p[p.length-1]==='"'?p.substring(1,p.length-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"):p.replace(/`/g,"")}function G(p,m){let w=p;const N=m.split(".");for(const X of N)if(w=w.getChild(X),!w)return null;return w}function T(p,m,w){const N=(0,A.xz)(p,m);return N.text=`${w}: ${N.text}`,N}function U(p){return p.labels.length===0&&p.operations.length===0}function R(p,m,w){const N=[];let X=m.getChild(b.LQ);for(;X;){const D=(0,A.AA)(p,X.getChild(b.yj));D&&N.push(D),X=X?.getChild(b.LQ)}return N.reverse(),{id:J.EF.Drop,params:N}}function H(p,m,w){const N=[];let X=m.getChild(b.J3);for(;X;){const D=(0,A.AA)(p,X.getChild(b.UM));D&&N.push(D),X=X?.getChild(b.J3)}return N.reverse(),{id:J.EF.Keep,params:N}}},96426:(xe,de,l)=>{l.d(de,{AA:()=>P,If:()=>O,Ql:()=>b,R1:()=>oe,SY:()=>A,qk:()=>J,rq:()=>K,xz:()=>S,z9:()=>Y});const b=0;function Y(d){return d.firstChild?Y(d.firstChild):d}function S(d,_){return{text:P(d,_),from:_.from,to:_.to,parentType:_.parent?.name}}const A=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function J(d){return d.replace(A,(_,j,v,ge,I,le,Z)=>{const y=ge||Z;let L=j,M="0";return v&&(L=v,M="1"),I&&(L=I,M="2"),`__V_${M}__`+L+"__V__"+(y?"__F__"+y+"__F__":"")})}const ie=[(d,_)=>`$${d}`,(d,_)=>`[[${d}${_?`:${_}`:""}]]`,(d,_)=>`\${${d}${_?`:${_}`:""}}`];function O(d){return d.replace(/__V_(\d)__(.+?)__V__(?:__F__(\w+)__F__)?/g,(_,j,v,ge)=>ie[parseInt(j,10)](v,ge))}function P(d,_){return _?O(d.substring(_.from,_.to)):""}function K(d,_,j,v){const ge=[parseFloat(P(_,j))];return d.comparison&&ge.push(v),{id:d.id,params:ge}}function oe(d,_,j){if(_.type.id===j||_.name===j)return[P(d,_)];const v=[];let ge=0,I=_.childAfter(ge);for(;I;)v.push(...oe(d,I,j)),ge=I.to,I=_.childAfter(ge);return v}const ae=d=>d.split(" ").map(j=>`${j}.*`).join("")},95826:(xe,de,l)=>{l.d(de,{EF:()=>A,IQ:()=>Y,Ln:()=>S,NS:()=>ie,h5:()=>J});var b=l(55060),Y=(O=>(O.Log="log",O.Metric="metric",O))(Y||{}),S=(O=>(O.Aggregations="Aggregations",O.RangeFunctions="Range functions",O.Functions="Functions",O.Formats="Formats",O.LineFilters="Line filters",O.LabelFilters="Label filters",O.BinaryOps=`${b.T}`,O))(S||{}),A=(O=>(O.Json="json",O.Logfmt="logfmt",O.Regexp="regexp",O.Pattern="pattern",O.Unpack="unpack",O.LineFormat="line_format",O.LabelFormat="label_format",O.Decolorize="decolorize",O.Drop="drop",O.Keep="keep",O.Rate="rate",O.RateCounter="rate_counter",O.CountOverTime="count_over_time",O.SumOverTime="sum_over_time",O.AvgOverTime="avg_over_time",O.MaxOverTime="max_over_time",O.MinOverTime="min_over_time",O.FirstOverTime="first_over_time",O.LastOverTime="last_over_time",O.StdvarOverTime="stdvar_over_time",O.StddevOverTime="stddev_over_time",O.QuantileOverTime="quantile_over_time",O.BytesRate="bytes_rate",O.BytesOverTime="bytes_over_time",O.AbsentOverTime="absent_over_time",O.Sum="sum",O.Avg="avg",O.Min="min",O.Max="max",O.Stddev="stddev",O.Stdvar="stdvar",O.Count="count",O.TopK="topk",O.BottomK="bottomk",O.LineContains="__line_contains",O.LineContainsNot="__line_contains_not",O.LineContainsCaseInsensitive="__line_contains_case_insensitive",O.LineContainsNotCaseInsensitive="__line_contains_not_case_insensitive",O.LineMatchesRegex="__line_matches_regex",O.LineMatchesRegexNot="__line_matches_regex_not",O.LineFilterIpMatches="__line_filter_ip_matches",O.LabelFilter="__label_filter",O.LabelFilterNoErrors="__label_filter_no_errors",O.LabelFilterIpMatches="__label_filter_ip_marches",O.Unwrap="unwrap",O.SumBy="__sum_by",O.SumWithout="__sum_without",O.Addition="__addition",O.Subtraction="__subtraction",O.MultiplyBy="__multiply_by",O.DivideBy="__divide_by",O.Modulo="__modulo",O.Exponent="__exponent",O.NestedQuery="__nested_query",O.EqualTo="__equal_to",O.NotEqualTo="__not_equal_to",O.GreaterThan="__greater_than",O.LessThan="__less_than",O.GreaterOrEqual="__greater_or_equal",O.LessOrEqual="__less_or_equal",O))(A||{}),J=(O=>(O[O.LineFilters=1]="LineFilters",O[O.Parsers=2]="Parsers",O[O.PipeOperations=3]="PipeOperations",O[O.Unwrap=4]="Unwrap",O[O.NoErrors=5]="NoErrors",O[O.RangeVectorFunction=5]="RangeVectorFunction",O[O.Last=6]="Last",O))(J||{});const ie={equals:{label:"=",value:"=",description:"Equals",isMultiValue:!1},doesNotEqual:{label:"!=",value:"!=",description:"Does not equal",isMultiValue:!1},matchesRegex:{label:"=~",value:"=~",description:"Matches regex",isMultiValue:!0},doesNotMatchRegex:{label:"!~",value:"!~",description:"Does not match regex",isMultiValue:!0},greaterThan:{label:">",value:">",description:"Greater than",isMultiValue:!1},greaterThanOrEqual:{label:">=",value:">=",description:"Greater than or equal to",isMultiValue:!1},lessThan:{label:"<",value:"<",description:"Less than",isMultiValue:!1},lessThanOrEqual:{label:"<=",value:"<=",description:"Less than or equal to",isMultiValue:!1},contains:{label:"|=",value:"|=",description:"Contains",isMultiValue:!1},doesNotContain:{label:"!=",value:"!=",description:"Does not contain",isMultiValue:!1}}},69457:(xe,de,l)=>{l.d(de,{Ac:()=>oe,nE:()=>K,db:()=>j,fV:()=>d,sz:()=>v,YB:()=>ae,aN:()=>_,BY:()=>ge});var b=l(95004),Y=l(74529),S=l(22420);function A(I){let le;try{le=JSON.parse(I)}catch{}return typeof le=="object"}const J=/(?:^|\s)([\w\(\)\[\]\{\}]+)=(""|(?:".*?[^\\]"|[^"\s]\S*))/;function ie(I){return J.test(I)}function O(I){let le;try{return le=JSON.parse(I),le.hasOwnProperty("_entry")}catch{return!1}}var P=l(12282);function K(I){return(I.fields.find(Z=>Z.name==="labels")?.values??[]).some(Z=>Z.__error__!==void 0)}function oe(I){return(I.fields.find(Z=>Z.name==="labels")?.values??[]).some(Z=>Z.level!==void 0)}function ae(I){const le=I.fields.find(Q=>Q.type===b.PU.string);if(le==null)return{hasJSON:!1,hasLogfmt:!1,hasPack:!1};const Z=le.values;let y=!1,L=!1,M=!1;return Z.forEach(Q=>{A(Q)&&(y=!0,M=O(Q)),ie(Q)&&(L=!0)}),{hasLogfmt:L,hasJSON:y,hasPack:M}}function d(I,le=P.HD.Indexed){const Z=I?.fields?.find(M=>M.name==="labels")?.values??[],y=I?.fields?.find(M=>M.name==="labelTypes")?.values??[];if(!Z?.length)return[];if(!y?.length){if(le===P.HD.Indexed){const{keys:M}=(0,S.P7)(Z);return M}return[]}let L=new Set;for(let M=0;M<Z.length;M++){const Q=Z[M],V=y[M],G=Object.keys(Q).filter(T=>V[T]===le);L=new Set([...L,...G])}return Array.from(L)}function _(I){const le=I?.fields?.find(y=>y.name==="labels")?.values??[];return le?.length?Object.keys(le[0]).filter(y=>{const L=le[0][y];return L?!isNaN(Number(L))||(0,Y.pp)(L)||(0,S.tY)(L):!1}).filter(y=>le.every(L=>L[y])):[]}function j(I){const le=I.fields.find(y=>y.name==="labels"&&y.type===b.PU.other);return le==null?!1:le.values.some(y=>y.__error__)}function v(I){const le=I.fields.find(L=>L.name==="labels"&&L.type===b.PU.other);if(le==null)return null;const Z=le.values.slice(0,2);let y=null;for(let L of Z){const M=Object.keys(L).find(Q=>Q==="level"||Q==="detected_level"||Q==="lvl"||Q.includes("level"));if(M){y=M;break}}return y}function ge(I){const le=I.errors?(I.errors[0].message??"").toLowerCase():I.error?.message??"";if(le.includes("timeout"))return!0;if(I.data.length>0&&I.data[0].fields.length>0)return!1;throw new Error(le)}},47126:(xe,de,l)=>{l.d(de,{Ex:()=>I,jg:()=>oe,uJ:()=>le});var b=l(1906),Y=l(55060),S=l(27489),A=l(43173),J=l(76484),ie=l(51814),O=l(24162),P=l(96426),K=l(12282);const oe=({payload:{dashboardId:Z,orgId:y,grafanaVersion:L,queries:M}})=>{try{const Q=M[ie.id]?.filter(D=>!D.hide)?.map(D=>(0,O.vV)(D));if(!Q?.length)return;const V=Q.filter(D=>(0,O.sI)(D.expr)),G=Q.filter(D=>!(0,O.sI)(D.expr)),T=Q.filter(D=>D.queryType===K.U3.Instant),U=Q.filter(D=>D.queryType===K.U3.Range),R=Q.filter(D=>D.editorMode===Y.f.Builder),H=Q.filter(D=>D.editorMode===Y.f.Code),p=Q.filter(ae),m=Q.filter(d),w=Q.filter(_),N=Q.filter(j),X={grafana_version:L,dashboard_id:Z,org_id:y,queries_count:Q.length,logs_queries_count:V.length,metric_queries_count:G.length,instant_queries_count:T.length,range_queries_count:U.length,builder_mode_queries_count:R.length,code_mode_queries_count:H.length,queries_with_template_variables_count:p.length,queries_with_changed_resolution_count:m.length,queries_with_changed_line_limit_count:w.length,queries_with_changed_legend_count:N.length};(0,S.rR)("grafana_loki_dashboard_loaded",X)}catch(Q){console.error("error in loki tracking handler",Q)}},ae=Z=>P.SY.test(Z.expr),d=Z=>Z.resolution?Z.resolution!==1:!1,_=Z=>Z.maxLines!==null&&Z.maxLines!==void 0,j=Z=>Z.legendFormat?Z.legendFormat!=="":!1,v=Z=>!![J.Gf,J.M1,J.mL,J.ow,J.lb].some(L=>Z.startsWith(L)),ge=Z=>{let y=0;for(const L of Z.data){const M=L.meta?.custom?.lokiQueryStatKey;M&&(y+=L.meta?.stats?.find(Q=>Q.displayName===M)?.value??0)}return y};function I(Z,y,L,M={},Q={}){const{app:V,targets:G}=y;if(V!==b.Jk.Explore)return;let T=ge(Z);for(const U of G){if(v(U.refId))return;(0,S.rR)("grafana_explore_loki_query_executed",{grafana_version:A.$.buildInfo.version,editor_mode:U.editorMode,has_data:Z.data.some(R=>R.length>0),has_error:Z.error!==void 0,legend:U.legendFormat,line_limit:U.maxLines,obfuscated_query:(0,O.$F)(U.expr),query_type:(0,O.sI)(U.expr)?"logs":"metric",query_vector_type:U.queryType,resolution:U.resolution,simultaneously_executed_query_count:G.filter(R=>!R.hide).length,simultaneously_hidden_query_count:G.filter(R=>R.hide).length,time_range_from:y?.range?.from?.toISOString(),time_range_to:y?.range?.to?.toISOString(),time_taken:Date.now()-L.getTime(),bytes_processed:T,is_split:!1,predefined_operations_applied:M.predefinedOperations?U.expr.includes(M.predefinedOperations):"n/a",...Q})}}function le(Z,y,L,M,Q={}){const V={split_query_group_count:y.length,split_query_largest_partition_size:Math.max(...y.map(({partition:G})=>G.length)),split_query_total_request_count:y.reduce((G,{partition:T})=>G+T.length,0),is_split:!0,simultaneously_executed_query_count:L.targets.filter(G=>!G.hide).length,simultaneously_hidden_query_count:L.targets.filter(G=>G.hide).length};for(const G of y){const T=G.partition.length;I(Z,G.request,M,Q,{...V,split_query_partition_size:T})}}},72316:(xe,de,l)=>{l.d(de,{v:()=>S});var b=l(88483),Y=l(15964);function S(A){return new b.c(function(J){(0,Y.Tg)(A()).subscribe(J)})}},36195:(xe,de,l)=>{l.d(de,{AL:()=>et,By:()=>gt,CX:()=>$t,GA:()=>wt,GN:()=>Ae,Gn:()=>st,HV:()=>Ne,I4:()=>_t,Ip:()=>Tt,J3:()=>jt,J_:()=>It,Jq:()=>Dt,K0:()=>yt,K3:()=>i,KD:()=>pt,LM:()=>g,LQ:()=>Wt,MD:()=>ce,MK:()=>rr,Nl:()=>Mt,On:()=>ze,Or:()=>mt,PN:()=>Qt,Q6:()=>Yt,Qf:()=>Et,Rh:()=>er,Sg:()=>tt,Tz:()=>ke,UK:()=>bt,UM:()=>zt,UP:()=>Bt,Yw:()=>Kt,ZQ:()=>tr,Zg:()=>ht,Zj:()=>at,aU:()=>qt,bY:()=>Ve,c$:()=>E,dJ:()=>Lt,dw:()=>Be,eF:()=>Ft,e_:()=>it,g$:()=>Ee,gw:()=>Pt,h1:()=>Ze,i8:()=>Nt,iT:()=>nt,ih:()=>Rt,lo:()=>ot,o5:()=>He,ov:()=>ye,pH:()=>Xt,q5:()=>We,qJ:()=>ct,sK:()=>fe,sq:()=>we,t3:()=>xt,uk:()=>vt,w7:()=>St,wN:()=>Ut,wT:()=>qr,x:()=>Ie,x$:()=>Ye,xB:()=>Ke,xo:()=>Ht,yW:()=>Jt,yj:()=>Vt});var b=l(48820);const Y=1,S=2,A=3,J=4,ie=5,O=6,P=7,K=8,oe=9,ae=10,d=11,_=12,j=13,v=14,ge=15,I=16,le=17,Z=18,y=19,L=20,M=21,Q=22,V=23,G=24,T=25,U=26,R=27,H=28,p=29,m=30,w=31,N=32,X=33,D=34,ue=35,q={json:Y,logfmt:S,unpack:A,pattern:J,regexp:ie,label_format:P,line_format:K,label_replace:oe,vector:ae,offset:d,bool:_,on:j,ignoring:v,group_left:ge,group_right:I,unwrap:O,decolorize:le,drop:Z,keep:y},te=c=>q[c.toLowerCase()]||-1,x={by:L,without:M,and:Q,or:V,unless:G,sum:T,avg:U,count:R,max:H,min:p,stddev:m,stdvar:w,bottomk:N,topk:X,sort:D,sort_desc:ue},u=c=>x[c.toLowerCase()]||-1,s={__proto__:null,ip:295,count_over_time:301,rate:303,rate_counter:305,bytes_over_time:307,bytes_rate:309,avg_over_time:311,sum_over_time:313,min_over_time:315,max_over_time:317,stddev_over_time:319,stdvar_over_time:321,quantile_over_time:323,first_over_time:325,last_over_time:327,absent_over_time:329,bytes:335,duration:337,duration_seconds:339},i=b.U1.deserialize({version:14,states:"EtOYQPOOO#cQPO'#DUOOQO'#ER'#ERO#hQPO'#ERO$}QPO'#DTOYQPO'#DTOOQO'#Ed'#EdO%[QPO'#EcOOQO'#FP'#FPO%aQPO'#FOQ%lQPOOO&mQPO'#F]O&rQPO'#F^OOQO'#Eb'#EbOOQO'#DS'#DSOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjOOQO'#Ek'#EkOOQO'#El'#ElOOQO'#Em'#EmOOQO'#En'#EnOOQO'#Eo'#EoOOQO'#Ep'#EpOOQO'#Eq'#EqOOQO'#Er'#ErOOQO'#Es'#EsO&wQPO'#DWOOQO'#DV'#DVO'VQPO,59pOOQO,5:m,5:mOOQO'#Dc'#DcO'_QPO'#DbO'gQPO'#DaO)lQPO'#D`O*{QPO'#D`OOQO'#D_'#D_O+sQPO,59oO-}QPO,59oO.UQPO,5:|O.]QPO,5:}O.hQPO'#E|O0sQPO,5;jO0zQPO,5;jO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lOYQPO,5;wO3cQPO,5;xO3hQPO,59rO#cQPO,59qOOQO1G/[1G/[OOQO'#Dh'#DhO3mQPO,59|O5^QPO,59|OOQO'#Di'#DiO5cQPO,59{OOQO,59{,59{O5kQPO'#DWO6YQPO'#DlO8PQPO'#DoO9sQPO'#DoOOQO'#Do'#DoOOQO'#Dv'#DvOOQO'#Dt'#DtO+kQPO'#DtO9xQPO,59zO;iQPO'#EVO;nQPO'#EWOOQO'#EZ'#EZO;sQPO'#E[O;xQPO'#E_OOQO,59z,59zOOQO,59y,59yOOQO1G/Z1G/ZOOQO1G0h1G0hO;}QPO'#EtO.`QPO'#EtO<XQPO1G0iO<^QPO1G0iO<cQPO,5;hO=oQPO1G1UO=vQPO1G1UO=}QPO1G1UO>UQPO'#FSO@dQPO'#FRO@nQPO'#FROYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WO@xQPO1G1cOAPQPO1G1dOOQO1G/^1G/^OOQO1G/]1G/]O5cQPO1G/hOAUQPO1G/hOAZQPO'#DjOBzQPO'#DjOOQO1G/g1G/gOCbQPO,59rOCPQPO,5:cOOQO'#Dm'#DmOClQPO,5:WOEcQPO'#DrOOQO'#Dq'#DqOGVQPO,5:_OHvQPO,5:[OOQO,5:Z,5:ZOJgQPO,5:`O+kQPO,5:`O+kQPO,5:`OOQO,5:q,5:qOJuQPO'#EYOOQO'#EX'#EXOJzQPO,5:rOLkQPO'#E^OOQO'#E^'#E^OOQO'#E]'#E]ONbQPO,5:vO!!RQPO'#EaOOQO'#Ea'#EaOOQO'#E`'#E`O!#xQPO,5:yO!%iQPO'#D`O;}QPO,5;`O!%pQPO'#EuO!%uQPO,5;`O!%}QPO,5;`O!&[QPO,5;`O!&iQPO,5;`O!&nQPO7+&TO.`QPO7+&TOOQO'#E}'#E}O!(OQPO1G1SOOQO1G1S1G1SOYQPO7+&pO!(WQPO7+&pO!)hQPO7+&pO!)oQPO7+&pO!)vQQO'#FTOOQO,5;n,5;nO!,UQPO,5;mO!,]QPO,5;mO!-nQPO7+&rO!-uQPO7+&rOOQO7+&r7+&rO!.SQPO7+&rO!.ZQPO7+&rO!/`QPO7+&rO!/pQPO7+&}OOQO7+'O7+'OOOQO7+%S7+%SO!/uQPO7+%SO5cQPO,5:UO!/zQPO,5:UO!0PQPO1G/{OOQO1G/}1G/}OOQO1G0U1G0UOOQO1G0W1G0WOOQO,5:X,5:XO!0UQPO1G/yO!1uQPO,5:^O!1zQPO,5:]OOQO1G/z1G/zO!2PQPO1G/zO!3pQPO,5:tO;nQPO,5:sO;sQPO,5:wO;xQPO,5:zO!3xQPO,5;cO!%uQPO1G0zO!4WQPO1G0zO!4`QPO,5;aO+kQPO,5;cO!4eQPO1G0zO!4oQPO'#EvO!4tQPO1G0zO!4eQPO1G0zO!4|QPO1G0zO!5ZQPO1G0zO!%xQPO1G0zOOQO1G0z1G0zOOQO<<Io<<IoO!5fQPO<<IoO!5kQPO,5;iOOQO7+&n7+&nO!5pQPO<<J[OOQO<<J[<<J[OYQPO<<J[OOQO'#FV'#FVO!5wQPO,5;oOOQO'#FU'#FUOOQO,5;o,5;oOOQO1G1X1G1XO!6PQPO1G1XO!8YQPO<<JiOOQO<<Hn<<HnOOQO1G/p1G/pO!8_QPO1G/pO!8dQPO7+%gOOQO1G/x1G/xOOQO1G/w1G/wOOQO1G0`1G0`OOQO1G0_1G0_OOQO1G0c1G0cOOQO1G0f1G0fOOQO'#Ex'#ExOOQO1G0}1G0}O!8iQPO1G0}OOQO'#Ey'#EyOOQO'#Ez'#EzOOQO'#E{'#E{OOQO7+&f7+&fOOQO1G0{1G0{O!8nQPO1G0}O!9SQPO7+&fOOQO,5;b,5;bO!9[QPO7+&fO!%xQPO7+&fO!9fQPO7+&fO!9qQPOAN?ZOOQO1G1T1G1TO!;RQPOAN?vO!<cQPOAN?vO!<jQQO1G1ZOOQO1G1Z1G1ZOOQO7+&s7+&sO!<rQPOAN@TOOQO7+%[7+%[O!<wQPO<<IRO!<|QPO7+&iO!=RQPO<<JQO!=ZQPO<<JQO!=cQPO'#EwO!=hQPO<<JQOOQOG24uG24uOOQOG25bG25bOOQO1G1[1G1[OOQO7+&u7+&uO!=pQPOG25oOOQOAN>mAN>mO!=uQPO<<JTOOQOAN?lAN?lO!=zQPOAN?lO!>SQPOLD+ZOOQOAN?oAN?oOOQO,5:r,5:rO!>XQPO!$'NuO!>^QPO!)9DaO!>cQPO!.K9{OOQO!4//g!4//gO;nQPO'#EWO!>hQPO'#D`O!?`QPO,59oO!@fQPO'#DTOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WOYQPO1G1WO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO1PQPO,5;lO!AqQPO7+&rO!AxQPO7+&rO!BVQPO7+&rO!C_QPO7+&rO!CfQPO7+&rO!B^QPO'#FQ",stateData:"!Cs~O$TOStOS~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!vQO!wRO!xRO$UPO$YTO$[_O$]`O$^aO$_bO$`cO$adO$beO$cfO$dgO$ehO$fiO$gjO$hkO$ilO$jmO~O{nO~O!vqO~O!OrO!QrO!WrO!XrO!YrO!ZrOfwXgwXhwX!lwX!nwX!owX!pwX!qwX!wwX!xwX#{wX#|wX#}wX$OwX~O!_vO$RwX$ZwX~P#mO$Y{O~Od|Oe|O$Y}O~Of!QOg!POh!QO!O!UO!l!UO!n!UO!o!UO!p!UO!q!UO!w!RO!x!RO#{!SO#|!SO#}!SO$O!TO~O$Y!VO~O$Y!WO~O|!XO!O!XO!P!XO!Q!XO~O$V!YO$W!ZO~O}!]O$X!_O~Og!`Of!TXh!TX!O!TX!Q!TX!W!TX!X!TX!Y!TX!Z!TX!_!TX!l!TX!n!TX!o!TX!p!TX!q!TX!w!TX!x!TX#{!TX#|!TX#}!TX$O!TX$R!TX$Z!TX$k!TX$V!TX~O!OrO!QrO!WrO!XrO!YrO!ZrO~Of!SXg!SXh!SX!_!SX!l!SX!n!SX!o!SX!p!SX!q!SX!w!SX!x!SX#{!SX#|!SX#}!SX$O!SX$R!SX$Z!SX$k!SX$V!SX~P)WOP!dOQ!cOR!fOS!eOT!eOV!lOW!kOa!mOb!nOc!oO{!bO$Y!iO~O!_vOfwagwahwa!lwa!nwa!owa!pwa!qwa!wwa!xwa#{wa#|wa#}wa$Owa$Rwa$Zwa~P)WOfvXgvXhvX!OvX!lvX!nvX!ovX!pvX!qvX!wvX!xvX#{vX#|vX#}vX$OvX~O$Z!rO~P,|O$Z!sO~P,|O!v!wO$UPO$Y!uO~O$Y!xO~OXZOY[OiWOjWOkWOlWOmWOnWOoWOpWOqWOrWOsWO!wRO!xRO$UPO$YTO$[_O$]`O$^aO$_bO$`cO$adO$beO$cfO$dgO$ehO$fiO$gjO$hkO$ilO$jmO~O!v!yO~P.mO$Y!{O~O[#OO]!|O^!|OX#uPY#uPi#uPj#uPk#uPl#uPm#uPn#uPo#uPp#uPq#uPr#uPs#uP!v#uP!w#uP!x#uP$U#uP$Y#uP$[#uP$]#uP$^#uP$_#uP$`#uP$a#uP$b#uP$c#uP$d#uP$e#uP$f#uP$g#uP$h#uP$i#uP$j#uP~O!v#WO~O}#XO~Og#ZOf!Uah!Ua!O!Ua!Q!Ua!W!Ua!X!Ua!Y!Ua!Z!Ua!_!Ua!l!Ua!n!Ua!o!Ua!p!Ua!q!Ua!w!Ua!x!Ua#{!Ua#|!Ua#}!Ua$O!Ua$R!Ua$Z!Ua$k!Ua$V!Ua~O$Y#[O~O}#]O$X!_O~O|#`O!O#`O!P!XO!Q!XO!l#aO!n#aO!o#aO!p#aO!q#aO~O{#dO!b#bOf!`Xg!`Xh!`X!O!`X!Q!`X!W!`X!X!`X!Y!`X!Z!`X!_!`X!l!`X!n!`X!o!`X!p!`X!q!`X!w!`X!x!`X#{!`X#|!`X#}!`X$O!`X$R!`X$Z!`X$k!`X$V!`X~O{#dOf!cXg!cXh!cX!O!cX!Q!cX!W!cX!X!cX!Y!cX!Z!cX!_!cX!l!cX!n!cX!o!cX!p!cX!q!cX!w!cX!x!cX#{!cX#|!cX#}!cX$O!cX$R!cX$Z!cX$k!cX$V!cX~O}#hO~Of#jOg#kO$V#jOh!Sa!O!Sa!Q!Sa!W!Sa!X!Sa!Y!Sa!Z!Sa!_!Sa!l!Sa!n!Sa!o!Sa!p!Sa!q!Sa!w!Sa!x!Sa#{!Sa#|!Sa#}!Sa$O!Sa$R!Sa$Z!Sa$k!Sa~O}#lO~O{#mO~O{#pO~O{#tO~O!_#xO$k#zO~P)WO$Z$PO~O$V$QO~O{$RO$Z$TO~Of!uXg!uXh!uX!O!uX!l!uX!n!uX!o!uX!p!uX!q!uX!w!uX!x!uX#{!uX#|!uX#}!uX$O!uX$Z!uX~O$V$UO~P<kO$Z$VO~P,|O!v$WO~P.mO$Y$YO~OX#uXY#uXi#uXj#uXk#uXl#uXm#uXn#uXo#uXp#uXq#uXr#uXs#uX!v#uX!w#uX!x#uX$U#uX$Y#uX$[#uX$]#uX$^#uX$_#uX$`#uX$a#uX$b#uX$c#uX$d#uX$e#uX$f#uX$g#uX$h#uX$i#uX$j#uX~O_$[O`$[O~P>ZO]!|O^!|O~P>ZO$V$dO~P,|O$Z$eO~O}$gO~Og$hOf!^Xh!^X!O!^X!Q!^X!W!^X!X!^X!Y!^X!Z!^X!_!^X!l!^X!n!^X!o!^X!p!^X!q!^X!w!^X!x!^X#{!^X#|!^X#}!^X$O!^X$R!^X$Z!^X$k!^X$V!^X~O$Y$iO~O!m$kO!s$lO!vQO!wRO!xRO~O}#XO$X!_O~PCPO{#dO!b$nOf!`ag!`ah!`a!O!`a!Q!`a!W!`a!X!`a!Y!`a!Z!`a!_!`a!l!`a!n!`a!o!`a!p!`a!q!`a!w!`a!x!`a#{!`a#|!`a#}!`a$O!`a$R!`a$Z!`a$k!`a$V!`a~O|$pOf!fXg!fXh!fX!O!fX!Q!fX!W!fX!X!fX!Y!fX!Z!fX!_!fX!l!fX!n!fX!o!fX!p!fX!q!fX!w!fX!x!fX#{!fX#|!fX#}!fX$O!fX$R!fX$V!fX$Z!fX$k!fX~O$V$qOf!gag!gah!ga!O!ga!Q!ga!W!ga!X!ga!Y!ga!Z!ga!_!ga!l!ga!n!ga!o!ga!p!ga!q!ga!w!ga!x!ga#{!ga#|!ga#}!ga$O!ga$R!ga$Z!ga$k!ga~O$V$qOf!dag!dah!da!O!da!Q!da!W!da!X!da!Y!da!Z!da!_!da!l!da!n!da!o!da!p!da!q!da!w!da!x!da#{!da#|!da#}!da$O!da$R!da$Z!da$k!da~Of#jOg#kO$V#jO$Z$rO~O|$tO~O$V$uOf!zag!zah!za!O!za!Q!za!W!za!X!za!Y!za!Z!za!_!za!l!za!n!za!o!za!p!za!q!za!w!za!x!za#{!za#|!za#}!za$O!za$R!za$Z!za$k!za~O|!XO!O!XO!P!XO!Q!XOf#QXg#QXh#QX!W#QX!X#QX!Y#QX!Z#QX!_#QX!l#QX!n#QX!o#QX!p#QX!q#QX!w#QX!x#QX#{#QX#|#QX#}#QX$O#QX$R#QX$V#QX$Z#QX$k#QX~O$V$vOf#Oag#Oah#Oa!O#Oa!Q#Oa!W#Oa!X#Oa!Y#Oa!Z#Oa!_#Oa!l#Oa!n#Oa!o#Oa!p#Oa!q#Oa!w#Oa!x#Oa#{#Oa#|#Oa#}#Oa$O#Oa$R#Oa$Z#Oa$k#Oa~O|!XO!O!XO!P!XO!Q!XOf#TXg#TXh#TX!W#TX!X#TX!Y#TX!Z#TX!_#TX!l#TX!n#TX!o#TX!p#TX!q#TX!w#TX!x#TX#{#TX#|#TX#}#TX$O#TX$R#TX$V#TX$Z#TX$k#TX~O$V$wOf#Rag#Rah#Ra!O#Ra!Q#Ra!W#Ra!X#Ra!Y#Ra!Z#Ra!_#Ra!l#Ra!n#Ra!o#Ra!p#Ra!q#Ra!w#Ra!x#Ra#{#Ra#|#Ra#}#Ra$O#Ra$R#Ra$Z#Ra$k#Ra~OU$xO~P*{O!m${O~O!_$|O$k#zO~OZ%OO!_#xO$Z#ha~P)WO!_#xO$Z%TO$k#zO~P)WO$Z%UO~Od|Oe|Of#Vqg#Vqh#Vq!O#Vq!l#Vq!n#Vq!o#Vq!p#Vq!q#Vq!w#Vq!x#Vq#{#Vq#|#Vq#}#Vq$O#Vq$R#Vq$Z#Vq$V#Vq~O$V%XO$Z%YO~Od|Oe|Of#rqg#rqh#rq!O#rq!l#rq!n#rq!o#rq!p#rq!q#rq!w#rq!x#rq#{#rq#|#rq#}#rq$O#rq$R#rq$Z#rq$V#rq~O$V%]O~P<kO$Z%[O~P,|O#z%^O$Z%aO~OX#uaY#uai#uaj#uak#ual#uam#uan#uao#uap#uaq#uar#uas#ua!v#ua!w#ua!x#ua$U#ua$[#ua$]#ua$^#ua$_#ua$`#ua$a#ua$b#ua$c#ua$d#ua$e#ua$f#ua$g#ua$h#ua$i#ua$j#ua~O$Y$YO~P!*OO_%cO`%cO$Y#ua~P!*OOf!QOh!QO!O!UO!l!UO!n!UO!o!UO!p!UO!q!UO!w!RO!x!RO#{#tq#|#tq#}#tq$O#tq$R#tq$Z#tq~Og#tq~P!,jOf#tqg#tqh#tq~P!,pOg!PO~P!,jO$R#tq$Z#tq~P%lOf#tqg#tqh#tq!O#tq!l#tq!n#tq!o#tq!p#tq!q#tq#{#tq#|#tq#}#tq$O#tq~O!w!RO!x!RO$R#tq$Z#tq~P!.eO}%dO~O$Z%eO~O}%gO~O$Y%hO~O$V$qOf!gig!gih!gi!O!gi!Q!gi!W!gi!X!gi!Y!gi!Z!gi!_!gi!l!gi!n!gi!o!gi!p!gi!q!gi!w!gi!x!gi#{!gi#|!gi#}!gi$O!gi$R!gi$Z!gi$k!gi~O}%iO~O{#dO~Of#jO$V#jOg!hih!hi!O!hi!Q!hi!W!hi!X!hi!Y!hi!Z!hi!_!hi!l!hi!n!hi!o!hi!p!hi!q!hi!w!hi!x!hi#{!hi#|!hi#}!hi$O!hi$R!hi$Z!hi$k!hi~O{%kO}%kO~O{%pO$m%rO$n%sO$o%tO~OZ%OO$Z#hi~O$l%vO~O!_#xO$Z#hi~P)WO!m%yO~O!_$|O$Z#hi~O!_#xO$Z%{O$k#zO~P)WO!_$|O$Z%{O$k#zO~O$Z%}O~O{&OO~O$Z&PO~P,|O$V&RO$Z&SO~O$Y$YOX#uiY#uii#uij#uik#uil#uim#uin#uio#uip#uiq#uir#uis#ui!v#ui!w#ui!x#ui$U#ui$[#ui$]#ui$^#ui$_#ui$`#ui$a#ui$b#ui$c#ui$d#ui$e#ui$f#ui$g#ui$h#ui$i#ui$j#ui~O$V&UO~O$Z&VO~O}&WO~O$Y&XO~Of#jOg#kO$V#jO!_#ki$k#ki$Z#ki~O!_$|O$Z#hq~O!_#xO$Z#hq~P)WOZ%OO!_&[O$Z#hq~Od|Oe|Of#V!Rg#V!Rh#V!R!O#V!R!l#V!R!n#V!R!o#V!R!p#V!R!q#V!R!w#V!R!x#V!R#{#V!R#|#V!R#}#V!R$O#V!R$R#V!R$Z#V!R$V#V!R~Od|Oe|Of#r!Rg#r!Rh#r!R!O#r!R!l#r!R!n#r!R!o#r!R!p#r!R!q#r!R!w#r!R!x#r!R#{#r!R#|#r!R#}#r!R$O#r!R$R#r!R$Z#r!R$V#r!R~O$Z&_O~P,|O#z%^O$Z&aO~O}&bO~O$Z&cO~O{&dO~O!_$|O$Z#hy~OZ%OO$Z#hy~OU$xO~O!_&[O$Z#hy~O$V&gO~O$Z&hO~O!_$|O$Z#h!R~O}&jO~O$V&kO~O}&lO~O$Z&mO~OP!dOQ!cOR!fOS!eOT!eOV&nOW!kOa!mOb!nOc!oO{!bO$Y!iO~O!_&oOfwagwahwa!lwa!nwa!owa!pwa!qwa!wwa!xwa#{wa#|wa#}wa$Owa$Vwa~P)WO!_&oO$VwX~P#mOf&yOh&yO!O&}O!l&}O!n&}O!o&}O!p&}O!q&}O!w&zO!x&zO#{#tq#|#tq#}#tq$O#tq$V#tq~Og#tq~P!@pOf#tqg#tqh#tq~P!@vOg&xO~P!@pOf&yOg&xOh&yO!O&}O!l&}O!n&}O!o&}O!p&}O!q&}O!w&zO!x&zO#{&{O#|&{O#}&{O$O&|O~O$V#tq~P!B^O!w&zO!x&zO$V#tq~P!.eO",goto:"1l$RPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$S%R%j&Y&]PPPPPP&t'W'h'v(XPPPP(h(p(yP)S)XP)S)S)[)e)S)m*O*O*XPPPPPP*XP*O*bPPP)S)S*{+R)S)S+Y+])S+c+f+l,_,t-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-Z-p-y.^.j/S/V/V/V/Y/i,_/l,_0R0w1Y1c1fPPPPP,_,_[YOT}!{$U%]Q$^#PQ$_#QS$`#R&tQ$a#SQ$b#TQ$c#UQ'O&rQ'P&sQ'Q&uQ'R&vQ'S&wR'T!Vt^O}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wRyTjSOT}!V!{#P#Q#R#S#T#U$U%]S!t{$QQ#}!u]&q&r&s&t&u&v&wRpPQoP^!hv!i#j#k#x$|&oQ#Y!YS#q!n$vT#u!o$wQxSQ#y!tQ$}#|Q%R#}Q%z%QR&p&q[wS!t#|#}%Q&q]!qx#y$}%R%z&piuSx!t#y#|#}$}%Q%R%z&p&qhtSx!t#y#|#}$}%Q%R%z&p&qR!auksSux!t#y#|#}$}%Q%R%z&p&qQ!^sV#^!`#Z$hW![s!`#Z$hR$j#`Q#_!`Q$f#ZR%f$hV!pv#x&oR#c!cQ#f!cQ#g!dR$o#cU#e!c!d#cR%j$qU!jv#x&oQ#i!iQ$r#jQ$s#kR%w$|_!hv!i#j#k#x$|&o_!gv!i#j#k#x$|&ov]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wT$m#`#aQ#o!lR&i&nS#n!l&nR%l$uR#s!nQ#r!nR%m$vR#w!oQ#v!oR%n$wj^O#P#Q#R#S#T#U&r&s&t&u&v&wQzTQ!z}Q#V!VQ$X!{Q%Z$UR&Q%]w]OT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwVOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wwUOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ!v{Q$O!uR%W$QS#|!t#}W$z#y#{%R%SQ%u$yQ%|%TR&Z%{Q%Q#|Q%u$zQ&]%|R&e&ZQ#{!tS$y#y%RQ%P#|Q%S#}S%x$}%QS&Y%z%|R&f&]R%q$xR%o$xQ!OXQ%V$PQ%[$VQ&^%}R&_&PR$S!xwXOT}!V!{#P#Q#R#S#T#U$U%]&r&s&t&u&v&wQ#P!PQ#Q!QQ#R!RQ#S!SQ#T!TQ#U!UQ&r&xQ&s&yQ&t&zQ&u&{Q&v&|R&w&}h!}!P!Q!R!S!T!U&x&y&z&{&|&}R$]#OQ$Z!|Q%b$[R&T%cR%_$YQ%`$YR&`&R",nodeNames:"\u26A0 Json Logfmt Unpack Pattern Regexp Unwrap LabelFormat LineFormat LabelReplace Vector Offset Bool On Ignoring GroupLeft GroupRight Decolorize Drop Keep By Without And Or Unless Sum Avg Count Max Min Stddev Stdvar Bottomk Topk Sort Sort_Desc LineComment LogQL Expr LogExpr Selector Matchers Matcher Identifier Eq String Neq Re Nre PipelineExpr PipelineStage LineFilters LineFilter Filter PipeExact PipeMatch PipePattern Npa FilterOp Ip OrFilter Pipe LogfmtParser LogfmtParserFlags ParserFlag LabelParser JsonExpressionParser LabelExtractionExpressionList LabelExtractionExpression LogfmtExpressionParser LabelFilter IpLabelFilter UnitFilter DurationFilter Gtr Duration Gte Lss Lte Eql BytesFilter Bytes NumberFilter LiteralExpr Number Add Sub LineFormatExpr LabelFormatExpr LabelsFormat LabelFormatMatcher DecolorizeExpr DropLabelsExpr DropLabels DropLabel KeepLabelsExpr KeepLabels KeepLabel MetricExpr RangeAggregationExpr RangeOp CountOverTime Rate RateCounter BytesOverTime BytesRate AvgOverTime SumOverTime MinOverTime MaxOverTime StddevOverTime StdvarOverTime QuantileOverTime FirstOverTime LastOverTime AbsentOverTime LogRangeExpr Range OffsetExpr UnwrapExpr ConvOp BytesConv DurationConv DurationSecondsConv Grouping Labels VectorAggregationExpr VectorOp BinOpExpr BinOpModifier OnOrIgnoringModifier GroupingLabels GroupingLabelList GroupingLabel LabelName Mul Div Mod Pow LabelReplaceExpr VectorExpr",maxTerm:169,skippedNodes:[0,36],repeatNodeCount:0,tokenData:"<n~RvX^#ipq#iqr$^rs$yst%kuv%vxy%{yz&Qz{&V{|&[|}&a}!O&f!O!P2v!P!Q3v!Q!R3{!R![7^![!]9]!^!_9q!_!`:O!`!a:e!c!}:r!}#O;Y#P#Q;_#Q#R;d#R#S:r#S#T;i#T#o:r#o#p;u#p#q;z#q#r<i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~#nY$T~X^#ipq#i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~$aR!_!`$j!`!a$o#r#s$t~$oO!O~~$tO!Z~~$yO!Q~~$|UOY$yZr$yrs%`s#O$y#O#P%e#P~$y~%eO}~~%hPO~$y~%pQt~OY%kZ~%k~%{O#}~~&QO$Y~~&VO$Z~~&[O#{~~&aO!w~~&fO$V~~&kQ!x~}!O&q!Q![(w~&tQ#_#`&z#g#h(X~&}P#X#Y'Q~'TP#X#Y'W~'ZP#d#e'^~'aP}!O'd~'gP#X#Y'j~'mP#a#b'p~'sP#d#e'v~'yP#h#i'|~(PP#m#n(S~(XO!b~~([P#h#i(_~(bP#f#g(e~(hP#]#^(k~(nP#V#W(q~(tP#h#i(S~(zZ!O!P)m!Q![(w#W#X0`#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T#m#n1{${$|.^~)pP!Q![)s~)vV!Q![)s#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~*bP!m~!Q![*e~*hV!O!P*}!Q![*e#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~+QP!Q![+T~+WU!Q![+T#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~+oQ!m~!Q![+u#g#h-Q~+xV!O!P,_!Q![+u#a#b,z#b#c.R#g#h/X#i#j.^${$|.^~,bP!Q![,e~,hU!Q![,e#a#b,z#b#c.R#g#h/X#i#j.^${$|.^~,}P#g#h-Q~-VP!m~!Q![-Y~-]T!O!P-l!Q![-Y#b#c.R#i#j.^${$|.^~-oP!Q![-r~-uS!Q![-r#b#c.R#i#j.^${$|.^~.UP#g#h.X~.^O!m~~.aP#g#h.d~.iP!m~!Q![.l~.oR!O!P.x!Q![.l#b#c.R~.{P!Q![/O~/RQ!Q![/O#b#c.R~/^P!m~!Q![/a~/dU!O!P/v!Q![/a#a#b,z#b#c.R#i#j.^${$|.^~/yP!Q![/|~0PT!Q![/|#a#b,z#b#c.R#i#j.^${$|.^~0eP!m~!Q![0h~0kW!O!P)m!Q![0h#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~1YP!m~!Q![1]~1`X!O!P)m!Q![1]#W#X0`#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~2QP!m~!Q![2T~2WY!O!P)m!Q![2T#W#X0`#[#]*]#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T${$|.^~2yP!Q![2|~3RR!v~!Q![2|!g!h3[#X#Y3[~3_R{|3h}!O3h!Q![3n~3kP!Q![3n~3sP!v~!Q![3n~3{O#|~~4Qe!v~!O!P5c!Q![7^!d!e6x!g!h3[!i!j6}!m!n6}!o!p6}!r!s6}!v!w6}#W#X0`#X#Y3[#[#]*]#_#`7W#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T#l#m8q#m#n1{${$|.^~5hR!v~!Q![5q!g!h3[#X#Y3[~5v`!v~!Q![5q!d!e6x!g!h3[!i!j6}!m!n6}!o!p6}!r!s6}!v!w6}#X#Y3[#[#]*]#_#`7W#a#b+j#b#c.R#g#h/X#i#j.^${$|.^~6}O!s~~7QQ!d!e6x#]#^7W~7ZP!d!e6x~7cd!v~!O!P5c!Q![7^!d!e6x!g!h3[!i!j6}!m!n6}!o!p6}!r!s6}!v!w6}#W#X0`#X#Y3[#[#]*]#_#`7W#a#b+j#b#c.R#g#h/X#i#j.^#k#l1T#m#n1{${$|.^~8tR!Q![8}!c!i8}#T#Z8}~9SR!v~!Q![8}!c!i8}#T#Z8}P9bT{P!Q![9]![!]9]!c!}9]#R#S9]#T#o9]~9vP!o~!_!`9y~:OO!p~~:TQ|~!_!`:Z#r#s:`~:`O!q~~:eO!P~~:jP!l~!_!`:m~:rO!n~R:yT{P#zQ!Q![:r![!]9]!c!}:r#R#S:r#T#o:r~;_O$k~~;dO$l~~;iO$O~~;lRO#S;i#S#T%`#T~;i~;zO$U~~<PR!_~!_!`<Y!`!a<_#r#s<d~<_O!W~~<dO!Y~~<iO!X~~<nO$W~",tokenizers:[0,1],topRules:{LogQL:[0,37]},specialized:[{term:43,get:(c,t)=>te(c)<<1},{term:43,get:(c,t)=>u(c)<<1|1},{term:43,get:c=>s[c]||-1}],tokenPrec:0}),g=1,E=2,C=3,z=4,se=5,fe=6,pe=7,Pe=8,ve=9,$e=10,Ce=11,Ie=12,ze=13,lr=14,ur=15,cr=16,ht=17,dr=18,_e=19,gt=20,Ke=21,pt=22,mt=23,fr=24,hr=25,Ot=26,gr=27,pr=28,mr=29,Or=30,vr=31,qe=32,yr=33,br=34,Pr=35,vt=36,yt=37,Ae=38,bt=39,ce=40,we=41,Ee=42,Pt=43,Er=44,Et=45,Ue=46,xr=47,$r=48,et=49,xt=50,$t=51,Qt=52,Lt=53,tt=54,We=55,rt=56,Ge=57,St=58,Tt=59,Rt=60,Qr=61,at=62,Lr=63,ye=64,nt=65,Ft=66,_t=67,st=68,ke=69,Ve=70,wt=71,Dt=72,Sr=73,Tr=74,Be=75,At=76,Ct=77,Rr=78,Fr=79,_r=80,wr=81,Dr=82,Mt=83,Ut=84,Ar=85,Cr=86,Xt=87,It=88,Mr=89,it=90,Ur=91,Nt=92,Wt=93,Vt=94,Bt=95,jt=96,zt=97,Kt=98,Ze=99,ot=100,Xr=101,Ir=102,Nr=103,lt=104,Wr=105,ut=106,Gt=107,Vr=108,kt=109,Br=110,jr=111,zr=112,Zt=113,Kr=114,Gr=115,Ht=116,Yt=117,kr=118,Ne=119,Jt=120,Zr=121,Hr=122,Yr=123,qt=124,Jr=125,er=126,tr=127,rr=128,He=129,qr=130,Ye=131,ct=132,dt=133,ar=134,nr=135,ea=136,sr=137,Je=138,ta=139,ir=140},54078:(xe,de,l)=>{l.d(de,{Z:()=>ie});var b=l(22803),Y=l(28848),S=l(96540),A=l(63704),J=l(63142);function ie({query:P,language:K,className:oe}){const ae=(0,J.$j)(),d=O(ae),_=Y.highlight(P,K.grammar,K.name);return S.createElement("div",{className:(0,b.cx)(d.editorField,"prism-syntax-highlight",oe),"aria-label":"selector",dangerouslySetInnerHTML:{__html:A.sQ.sanitize(_)}})}const O=P=>({editorField:(0,b.css)({fontFamily:P.typography.fontFamilyMonospace,fontSize:P.typography.bodySmall.fontSize})})},55060:(xe,de,l)=>{l.d(de,{T:()=>S,f:()=>Y});var b=l(96540),Y=(A=>(A.Code="code",A.Builder="builder",A))(Y||{});const S="Binary operations"},41391:(xe,de,l)=>{l.d(de,{A:()=>S});const b=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Y(A){return typeof A=="string"&&b.test(A)}const S=Y}}]);

//# sourceMappingURL=9878.6f7d06d2d7d901531b71.js.map