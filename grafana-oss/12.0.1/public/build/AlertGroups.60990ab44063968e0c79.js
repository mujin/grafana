"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8427],{13549:(H,T,e)=>{e.r(T),e.d(T,{default:()=>rt});var t=e(74848),a=e(96540),M=e(6975),u=e(34999),b=e(31286),G=e(66404),E=e(70958),d=e(56840),N=e(96673),D=e(84266),g=e(91984),y=e(36826),A=e(82658),O=e(22803),L=e(63142),K=e(45861),P=e(77256),F=e(72636),R=e(45967),U=e(30703),Y=e(77824);const J=({onStateFilterChange:l,stateFilter:f})=>{const C=Object.entries(D.Or).sort(([i],[n])=>i<n?-1:1).map(([i,n])=>({label:i,value:n}));return(0,t.jsxs)("div",{children:[(0,t.jsxs)(F.J,{children:[(0,t.jsx)("span",{children:"Notification state\xA0"}),(0,t.jsx)(R.m,{content:(0,t.jsx)("div",{children:(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Active: The alert notification has been handled. The alert is still firing and continues to be managed."}),(0,t.jsx)("li",{children:(0,t.jsx)(d.x6,{i18nKey:"alerting.alert-state-filter.suppressed-the-alert-has-been-silenced",children:"Suppressed: The alert has been silenced."})}),(0,t.jsx)("li",{children:"Unprocessed: The alert is received but its notification has not been processed yet."})]})}),children:(0,t.jsx)(U.I,{name:"info-circle",size:"sm"})})]}),(0,t.jsx)(Y.z,{options:C,value:f,onChange:l})]})};var W=e(2543),V=e(18857),X=e(39659);const Z=({groups:l,groupBy:f,onGroupingChange:C})=>{const i=(0,W.uniq)(l.flatMap(n=>n.alerts).flatMap(({labels:n})=>Object.keys(n))).filter(n=>!(0,X.F2)(n)).map(n=>({label:n,value:n}));return(0,t.jsxs)("div",{"data-testid":"group-by-container",children:[(0,t.jsxs)(F.J,{children:[(0,t.jsx)("span",{children:"Custom group by\xA0"}),(0,t.jsx)(R.m,{content:(0,t.jsx)("div",{children:"Group notifications using a different combination of labels. This option can help validate the grouping settings of your notification policies."}),children:(0,t.jsx)(U.I,{name:"info-circle",size:"sm"})})]}),(0,t.jsx)(V.KF,{"aria-label":(0,d.t)("alerting.group-by.aria-label-group-by-label-keys","Group by label keys"),value:f,placeholder:(0,d.t)("alerting.group-by.placeholder-group-by","Group by"),prefix:(0,t.jsx)(U.I,{name:"tag-alt"}),onChange:n=>{C(n.map(({value:j})=>j))},options:i,width:34})]})};var w=e(87133);const k=({groups:l})=>{const[f,C]=(0,a.useState)(Math.floor(Math.random()*100)),[i,n]=(0,E.s)(),{groupBy:j=[],queryString:o,alertState:c}=(0,P.Ht)(i),p=`matcher-${f}`,S=(0,L.of)(q),I=()=>{n({groupBy:null,queryString:null,alertState:null,contactPoint:null}),setTimeout(()=>C(f+1),100)},$=!!(j.length>0||o||c);return(0,t.jsx)("div",{className:S.wrapper,children:(0,t.jsxs)("div",{className:S.filterSection,children:[(0,t.jsx)(w.X,{defaultQueryString:o,onFilterChange:x=>n({queryString:x||null})},p),(0,t.jsx)(Z,{groups:l,groupBy:j,onGroupingChange:x=>n({groupBy:x.length?x.join(","):null})}),(0,t.jsx)(J,{stateFilter:c,onStateFilterChange:x=>n({alertState:x||null})}),$&&(0,t.jsx)(K.$n,{className:S.clearButton,variant:"secondary",icon:"times",onClick:I,children:(0,t.jsx)(d.x6,{i18nKey:"alerting.alert-group-filter.clear-filters",children:"Clear filters"})})]})})},q=l=>({wrapper:(0,O.css)({borderBottom:`1px solid ${l.colors.border.medium}`,marginBottom:l.spacing(3)}),filterSection:(0,O.css)({display:"flex",flexDirection:"row",marginBottom:l.spacing(3),gap:l.spacing(1)}),clearButton:(0,O.css)({marginLeft:l.spacing(1),marginTop:"19px"})});var _=e(86017),tt=e(63895);const et=l=>{const[f]=(0,E.s)(),{queryString:C,alertState:i}=(0,P.Ht)(f);return(0,a.useMemo)(()=>{const n=C?(0,tt.Zc)(C):[];return l.reduce((j,o)=>{const c=o.alerts.filter(({labels:p,status:S})=>{const I=(0,_.Av)(p,n),$=i?S.state===i:!0;return I&&$});return c.length>0&&(Object.keys(o.labels).length===0?j.unshift({...o,alerts:c}):j.push({...o,alerts:c})),j},[])},[C,l,i])},s=(l,f)=>(0,a.useMemo)(()=>f.length===0?l.filter(n=>Object.keys(n.labels).length===0).length>1?l.reduce((n,j)=>{if(Object.keys(j.labels).length===0){const o=n.find(({labels:c})=>Object.keys(c));o?o.alerts=(0,W.uniqBy)([...o.alerts,...j.alerts],"labels"):n.push({alerts:j.alerts,labels:{},receiver:{name:"NONE"}})}else n.push(j);return n},[]):l:(0,W.uniqBy)(l.flatMap(({alerts:i})=>i),i=>i.fingerprint).reduce((i,n)=>{if(f.every(o=>Object.keys(n.labels).includes(o)))n.receivers.map(c=>({alerts:[n],labels:f.reduce((p,S)=>(p={...p,[S]:n.labels[S]},p),{}),receiver:c})).forEach(c=>{const p=i.find(S=>Object.keys(c.labels).every(I=>S.labels[I]===c.labels[I])&&S.receiver.name===c.receiver.name);p?p.alerts.push(n):i.push(c)});else{const o=i.find(c=>Object.keys(c.labels).length===0);o?o.alerts.push(n):i.push({alerts:[n],labels:{},receiver:{name:"NONE"}})}return i},[]),[l,f]);var v=e(98127),h=e(5358),B=e(11018),m=e(95443),r=e(52161),z=e(36200),st=e(88547);const nt=()=>{const{selectedAlertmanager:l}=(0,h.VI)(),f=(0,N.useDispatch)(),[C]=(0,E.s)(),{groupBy:i=[]}=(0,P.Ht)(C),{currentData:n}=g.m.endpoints.getGrafanaAlertingConfigurationStatus.useQuery(),j=(0,v.$)(x=>x.amAlertGroups),{loading:o,error:c,result:p=[]}=j[l||""]??z.jA,S=s(p,i),I=et(S),$=l===r.hY&&n?.alertmanagersChoice===D.nA.External;return(0,a.useEffect)(()=>{function x(){l&&f((0,B.D3)(l))}x();const Q=setInterval(x,m.U3);return()=>{clearInterval(Q)}},[f,l]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k,{groups:p}),o&&(0,t.jsx)(M._,{text:(0,d.t)("alerting.alert-groups.text-loading-notifications","Loading notifications")}),c&&!o&&(0,t.jsx)(u.F,{title:(0,d.t)("alerting.alert-groups.title-error-loading-notifications","Error loading notifications"),severity:"error",children:c.message||"Unknown error"}),$&&(0,t.jsx)(u.F,{title:(0,d.t)("alerting.alert-groups.title-grafana-alerts-delivered-alertmanager","Grafana alerts are not delivered to Grafana Alertmanager"),children:"Grafana is configured to send alerts to external alertmanagers only. No alerts are expected to be available here for the selected Alertmanager."}),p&&I.map((x,Q)=>(0,t.jsxs)(a.Fragment,{children:[(Q===1&&Object.keys(I[0].labels).length===0||Q===0&&Object.keys(x.labels).length>0)&&(0,t.jsx)(b.a,{paddingY:2,children:(0,t.jsxs)(G.E,{element:"h2",variant:"body",children:["Grouped by: ",Object.keys(x.labels).join(", ")]})}),(0,t.jsx)(A._,{alertManagerSourceName:l||"",group:x})]},`${JSON.stringify(x.labels)}-group-${Q}`)),p&&!I.length&&(0,t.jsx)("p",{children:(0,t.jsx)(d.x6,{i18nKey:"alerting.alert-groups.no-results",children:"No results."})})]})};function at(){return(0,t.jsx)(y.y,{navId:"groups",accessType:"instance",children:(0,t.jsx)(nt,{})})}const rt=(0,st.S)(at)},24898:(H,T,e)=>{e.d(T,{_:()=>b});var t=e(74848),a=e(2543),M=e.n(a),u=e(16692);const b=({actions:g,children:y})=>{const A=(0,a.filter)(g,N),O=(0,a.filter)(g,D);return A.length?(0,t.jsx)(G,{actions:A,children:y}):O.length?(0,t.jsx)(E,{actions:O,children:y}):null},G=({actions:g,children:y})=>{const A=(0,u.iI)();return d(A,g)?(0,t.jsx)(t.Fragment,{children:y}):null},E=({actions:g,children:y})=>{const A=(0,u.e2)();return d(A,g)?(0,t.jsx)(t.Fragment,{children:y}):null};function d(g,y){return(0,a.chain)(g).pick(y).values().value().some(([A,O])=>O===!0)}function N(g){return Object.values(u.QI).includes(g)}function D(g){return Object.values(u.RY).includes(g)}},12266:(H,T,e)=>{e.d(T,{e:()=>M});var t=e(74848),a=e(45861);const M=({isCollapsed:u,onToggle:b,idControlled:G,className:E,text:d,size:N="xl",...D})=>(0,t.jsx)(a.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!u,"aria-controls":G,className:E,icon:u?"angle-right":"angle-down",onClick:()=>b(!u),...D,children:d})},1625:(H,T,e)=>{e.d(T,{P:()=>E});var t=e(74848),a=e(22803),M=e(63142),u=e(66404),b=e(41654),G=e(30703);const E=({children:N,icon:D,color:g="secondary",direction:y="row",...A})=>{const O=(0,M.of)(d),L=typeof A.onClick=="function",K=y==="row",P=K?"center":"flex-start",F=K?.5:0;return(0,t.jsx)("div",{className:(0,a.cx)({[O.interactive]:L}),...A,children:(0,t.jsx)(u.E,{variant:"bodySmall",color:g,children:(0,t.jsxs)(b.B,{direction:y,alignItems:P,gap:F,wrap:"wrap",children:[D&&(0,t.jsx)(G.I,{size:"xs",name:D}),N]})})})},d=()=>({interactive:(0,a.css)({cursor:"pointer"})})},82658:(H,T,e)=>{e.d(T,{_:()=>tt});var t=e(74848),a=e(22803),M=e(96540),u=e(63142),b=e(41654),G=e(89640),E=e(56840),d=e(77256),N=e(7840),D=e(12266),g=e(1625),y=e(74529),A=e(57487),O=e(83903),L=e(45861),K=e(15130),P=e(84266),F=e(96673),R=e(16692),U=e(52161),Y=e(83750),J=e(24898);const W=({alert:s,alertManagerSourceName:v})=>{const h=(0,u.of)(V),B=(0,U.z2)(v),m=B?K.TP.hasPermission(F.AccessControlAction.AlertingRuleRead):!0;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:h.actionsRow,children:[s.status.state===P.Or.Suppressed&&(0,t.jsx)(J._,{actions:[R.QI.CreateSilence,R.QI.UpdateSilence],children:(0,t.jsx)(L.z9,{href:`${(0,d.nL)("/alerting/silences",v)}&silenceIds=${s.status.silencedBy.join(",")}`,className:h.button,icon:"bell",size:"sm",children:(0,t.jsx)(E.x6,{i18nKey:"alerting.alert-details.manage-silences",children:"Manage silences"})})}),s.status.state===P.Or.Active&&(0,t.jsx)(J._,{actions:[R.QI.CreateSilence],children:(0,t.jsx)(L.z9,{href:(0,d.BK)(v,s.labels),className:h.button,icon:"bell-slash",size:"sm",children:(0,t.jsx)(E.x6,{i18nKey:"alerting.alert-details.silence",children:"Silence"})})}),m&&s.generatorURL&&(0,t.jsx)(L.z9,{className:h.button,href:s.generatorURL,icon:"chart-line",size:"sm",children:B?"See alert rule":"See source"})]}),Object.entries(s.annotations).map(([r,z])=>(0,t.jsx)(Y.s,{annotationKey:r,value:z},r)),(0,t.jsxs)("div",{className:h.receivers,children:["Receivers:"," ",s.receivers.map(({name:r})=>r).filter(r=>!!r).join(", ")]})]})},V=s=>({button:(0,a.css)({"& + &":{marginLeft:s.spacing(1)}}),actionsRow:(0,a.css)({padding:`${s.spacing(2,0)} !important`,borderBottom:`1px solid ${s.colors.border.medium}`}),receivers:(0,a.css)({padding:s.spacing(1,0)})}),X=({alerts:s,alertManagerSourceName:v})=>{const h=(0,u.of)(Z),B=(0,M.useMemo)(()=>[{id:"state",label:"Notification state",renderCell:({data:r})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(O.y,{state:r.status.state}),(0,t.jsxs)("span",{className:h.duration,children:["for"," ",(0,y.dU)({start:new Date(r.startsAt),end:new Date(r.endsAt)})]})]}),size:"220px"},{id:"labels",label:"Instance labels",renderCell:({data:{labels:r}})=>(0,t.jsx)(N.m,{labels:r,size:"sm"}),size:1}],[h]),m=(0,M.useMemo)(()=>s.map(r=>({id:r.fingerprint,data:r})),[s]);return(0,t.jsx)("div",{className:h.tableWrapper,"data-testid":"alert-group-table",children:(0,t.jsx)(A.B,{cols:B,items:m,isExpandable:!0,renderExpandedContent:({data:r})=>(0,t.jsx)(W,{alert:r,alertManagerSourceName:v})})})},Z=s=>({tableWrapper:(0,a.css)({marginTop:s.spacing(3),[s.breakpoints.up("md")]:{marginLeft:s.spacing(4.5)}}),duration:(0,a.css)({marginLeft:s.spacing(1),fontSize:s.typography.bodySmall.fontSize})});var w=e(55127),k=e.n(w);const q=s=>({[P.Or.Active]:(0,a.css)({color:s.colors.error.text}),[P.Or.Suppressed]:(0,a.css)({color:s.colors.primary.text}),[P.Or.Unprocessed]:(0,a.css)({color:s.colors.secondary.text})}),_=({group:s})=>{const v=(0,u.of)(q),h=s.alerts.length,B=s.alerts.reduce((m,r)=>(m[r.status.state]?m[r.status.state]+=1:m[r.status.state]=1,m),{});return(0,t.jsxs)("div",{children:[`${h} ${k()("alert",h)}: `,Object.entries(B).map(([m,r],z)=>(0,t.jsxs)("span",{className:v[m],children:[z>0&&", ",`${r} ${m}`]},`${JSON.stringify(s.labels)}-notifications-${z}`))]})},tt=({alertManagerSourceName:s,group:v})=>{const[h,B]=(0,M.useState)(!0),m=(0,u.of)(et),r=v.receiver.name!=="NONE",z=v.receiver.name;return(0,t.jsxs)("div",{className:m.wrapper,children:[(0,t.jsxs)("div",{className:m.header,children:[(0,t.jsxs)("div",{className:m.group,"data-testid":"alert-group",children:[(0,t.jsx)(D.e,{size:"sm",isCollapsed:h,onToggle:()=>B(!h),"data-testid":"alert-group-collapse-toggle"}),Object.keys(v.labels).length?(0,t.jsxs)(b.B,{direction:"row",alignItems:"center",children:[(0,t.jsx)(N.m,{labels:v.labels,size:"sm"}),r&&(0,t.jsxs)(g.P,{icon:"at",children:["Delivered to"," ",(0,t.jsx)(G.Y,{href:(0,d.bI)(z,s),variant:"bodySmall",color:"primary",inline:!1,children:v.receiver.name})]})]}):(0,t.jsx)("span",{children:(0,t.jsx)(E.x6,{i18nKey:"alerting.alert-group.no-grouping",children:"No grouping"})})]}),(0,t.jsx)(_,{group:v})]}),!h&&(0,t.jsx)(X,{alertManagerSourceName:s,alerts:v.alerts})]})},et=s=>({wrapper:(0,a.css)({"& + &":{marginTop:s.spacing(2)}}),header:(0,a.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:s.spacing(1),backgroundColor:s.colors.background.secondary,width:"100%"}),group:(0,a.css)({display:"flex",flexDirection:"row",alignItems:"center"})})}}]);

//# sourceMappingURL=AlertGroups.60990ab44063968e0c79.js.map