"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4340],{98102:(xt,gt,n)=>{n.d(gt,{P0:()=>u,LE:()=>_,Q5:()=>O,$f:()=>ct});var e=n(74848),v=n(22803),k=n(96540),a=n(84140),y=n(76487),M=n(25461),S=n(87063),N=n(88559),U=n(76319),F=n(56840),at=n(74746),R=n(29457);const w=({log:s,styles:L})=>{const{getRowContextQuery:d,onOpenContext:B,onPermalinkClick:l,onPinLine:E,onUnpinLine:x,logSupportsContext:H}=(0,R.fl)(),D=(0,R.u0)(s),z=(0,k.useRef)(null),tt=(0,k.useCallback)(()=>{(0,at.Dk)(s.entry,z)},[s.entry]),$=(0,k.useCallback)(()=>{l?.(s)},[s,l]),o=(0,k.useMemo)(()=>H?H(s):!1,[s,H]),f=(0,k.useCallback)(async I=>{(0,at.R)(I,s,d,Q=>B?.(Q,()=>{}))},[B,d,s]),p=(0,k.useCallback)(()=>{D?x?.(s):E?.(s)},[s,E,x,D]),C=(0,k.useCallback)(()=>(0,e.jsxs)(S.W,{ref:z,children:[(0,e.jsx)(S.W.Item,{onClick:tt,label:(0,F.t)("logs.log-line-menu.copy-log","Copy log line")}),l&&s.rowId!==void 0&&s.uid&&(0,e.jsx)(S.W.Item,{onClick:$,label:(0,F.t)("logs.log-line-menu.copy-link","Copy link to log line")}),(o||E||x)&&(0,e.jsx)(S.W.Divider,{}),o&&(0,e.jsx)(S.W.Item,{onClick:f,label:(0,F.t)("logs.log-line-menu.show-context","Show context")}),!D&&E&&(0,e.jsx)(S.W.Item,{onClick:p,label:(0,F.t)("logs.log-line-menu.pin-to-outline","Pin log")}),D&&x&&(0,e.jsx)(S.W.Item,{onClick:p,label:(0,F.t)("logs.log-line-menu.unpin-from-outline","Unpin log")})]}),[$,tt,s.rowId,s.uid,l,E,x,D,o,f,p]);return(0,e.jsx)(N.m,{overlay:C,placement:"bottom-start",children:(0,e.jsx)(U.K,{className:L.menuIcon,name:"ellipsis-v","aria-label":(0,F.t)("logs.log-line-menu.icon-label","Log menu")})})};var V=n(55439);const u=({displayedFields:s,index:L,log:d,style:B,styles:l,onOverflow:E,showTime:x,variant:H,wrapLogMessage:D})=>{const{onLogLineHover:z}=(0,R.fl)(),tt=(0,k.useRef)(null),$=(0,R.u0)(d),o=(0,k.useCallback)(()=>{z?.(d)},[d,z]);return(0,k.useEffect)(()=>{if(!E||!tt.current)return;const f=typeof B.height=="number"?B.height:void 0,p=(0,V.SC)(tt.current,f);p&&E(L,d.uid,p)},[L,d.uid,E,B.height]),(0,e.jsxs)("div",{style:B,className:`${l.logLine} ${H??""} ${$?l.pinnedLogLine:""}`,ref:E?tt:void 0,onMouseOver:o,children:[(0,e.jsx)(w,{styles:l,log:d}),(0,e.jsx)("div",{className:`${D?l.wrappedLogLine:`${l.unwrappedLogLine} unwrapped-log-line`}`,children:(0,e.jsx)(j,{displayedFields:s,log:d,showTime:x,styles:l,wrapLogMessage:D})})]})},j=({displayedFields:s,log:L,showTime:d,styles:B,wrapLogMessage:l})=>(0,e.jsxs)(e.Fragment,{children:[d&&(0,e.jsx)("span",{className:`${B.timestamp} level-${L.logLevel} field`,children:L.timestamp}),(L.displayLevel||!l)&&(0,e.jsx)("span",{className:`${B.level} level-${L.logLevel} field`,children:L.displayLevel}),s.length>0?s.map(E=>E===y.I?(0,e.jsx)(K,{log:L},E):(0,e.jsx)("span",{className:"field",title:E,children:_(E,L)},E)):(0,e.jsx)(K,{log:L})]}),K=({log:s})=>{const{syntaxHighlighting:L}=(0,R.fl)();if(s.hasAnsi){const B=s.searchWords&&s.searchWords.length>0&&s.searchWords[0]&&s.searchWords[0].length>0?{searchWords:s.searchWords??[],highlightClassName:""}:void 0;return(0,e.jsx)("span",{className:"field no-highlighting",children:(0,e.jsx)(M.$,{value:s.body,highlight:B})})}return L?(0,e.jsx)("span",{className:"field log-syntax-highlight",dangerouslySetInnerHTML:{__html:s.highlightedBody}}):(0,e.jsx)("span",{className:"field no-highlighting",children:s.body})};function _(s,L){if(s===y.I)return L.body;if(L.labels[s]!=null)return L.labels[s];const d=L.fields.find(B=>B.keys[0]===s);return d?d.values.toString():""}function O(s){return`${s.map(d=>d.width).join("px ")}px 1fr`}const ct=s=>{const L={critical:"#B877D9",error:s.colors.error.text,warning:"#FBAD37",debug:"#6E9FFF",trace:"#6ed0e0",info:"#6CCF8E",metadata:s.colors.text.primary,parsedField:s.colors.text.primary};return{logLine:(0,v.css)({color:(0,a.A)(s.colors.text.secondary).setAlpha(.75).toRgbString(),display:"flex",gap:s.spacing(.5),flexDirection:"row",fontFamily:s.typography.fontFamilyMonospace,fontSize:s.typography.fontSize,wordBreak:"break-all","&:hover":{background:"hsla(0, 0%, 0%, 0.2)"},"&.infinite-scroll":{"&::before":{borderTop:`solid 1px ${s.colors.border.strong}`,content:'""',height:0,left:0,position:"absolute",top:-3,width:"100%"}},"& .log-syntax-highlight":{".log-token-string":{color:(0,a.A)(s.colors.text.secondary).setAlpha(.75).toRgbString()},".log-token-duration":{color:s.colors.success.text},".log-token-size":{color:s.colors.success.text},".log-token-uuid":{color:s.colors.success.text},".log-token-key":{color:L.parsedField,opacity:.9,fontWeight:s.typography.fontWeightMedium},".log-token-json-key":{color:L.parsedField,opacity:.9,fontWeight:s.typography.fontWeightMedium},".log-token-label":{color:L.metadata,fontWeight:s.typography.fontWeightBold},".log-token-method":{color:s.colors.info.shade}},"& .no-highlighting":{color:s.colors.text.primary}}),pinnedLogLine:(0,v.css)({backgroundColor:(0,a.A)(s.colors.info.transparent).setAlpha(.25).toString()}),menuIcon:(0,v.css)({height:(0,V.ks)(),margin:0,padding:s.spacing(0,0,0,.5)}),logLineMessage:(0,v.css)({fontFamily:s.typography.fontFamily,justifyContent:"center"}),timestamp:(0,v.css)({color:s.colors.text.disabled,display:"inline-block"}),level:(0,v.css)({color:s.colors.text.secondary,fontWeight:s.typography.fontWeightBold,textTransform:"uppercase",display:"inline-block","&.level-critical":{color:L.critical},"&.level-error":{color:L.error},"&.level-warning":{color:L.warning},"&.level-info":{color:L.info},"&.level-debug":{color:L.debug}}),loadMoreButton:(0,v.css)({background:"transparent",border:"none",display:"inline"}),overflows:(0,v.css)({outline:"solid 1px red"}),unwrappedLogLine:(0,v.css)({display:"grid",gridColumnGap:s.spacing(V.yb),whiteSpace:"pre",paddingBottom:s.spacing(.75)}),wrappedLogLine:(0,v.css)({alignSelf:"flex-start",paddingBottom:s.spacing(.75),whiteSpace:"pre-wrap","& .field":{marginRight:s.spacing(V.yb)},"& .field:last-child":{marginRight:0}})}}},94340:(xt,gt,n)=>{n.d(gt,{Z:()=>C});var e=n(74848),v=n(22803),k=n(2543),a=n(96540),y=n(91793),M=n(78012),S=n(19379),N=n(1906),U=n(63142),F=n(84596),at=n(739),R=n(27489),w=n(43173),V=n(68079),u=n(56840),j=n(17896),K=n(98102);const _=({children:i,onClick:h,style:t,styles:c})=>(0,e.jsx)("div",{style:t,className:`${c.logLine} ${c.logLineMessage}`,children:h?(0,e.jsx)("button",{className:c.loadMoreButton,onClick:h,children:i}):i}),O=({children:i,displayedFields:h,handleOverflow:t,loadMore:c,logs:g,scrollElement:m,setInitialScrollPosition:P,showTime:J,sortOrder:Y,timeRange:nt,timeZone:et,wrapLogMessage:X})=>{const[W,Z]=(0,a.useState)("idle"),[ot,lt]=(0,a.useState)(!1),r=(0,F.A)(g),G=(0,F.A)(Y),rt=(0,a.useRef)(m?.scrollTop||0),ut=(0,a.useRef)(null),ft=(0,a.useRef)(0),T=(0,a.useRef)([]),st=(0,U.of)(K.$f);(0,a.useEffect)(()=>{!r||r===g||(W==="loading"?Z(g.length===r.length?"out-of-bounds":"idle"):(T.current=[],lt(!0)))},[W,g,r]),(0,a.useEffect)(()=>{G&&G!==Y&&Z("idle")},[G,Y]),(0,a.useEffect)(()=>{ot&&(P(),lt(!1))},[ot,P]);const dt=(0,a.useCallback)(()=>{const A=(0,j.rg)((0,j.K6)(g),nt,et,Y);if(!A){Z("out-of-bounds");return}T.current.push(g[g.length-1].uid),Z("loading"),c?.(A),(0,R.rR)("grafana_logs_infinite_scrolling",{direction:"bottom",sort_order:Y})},[c,g,Y,nt,et]);(0,a.useEffect)(()=>{if(!m||!c||!w.$.featureToggles.logsInfiniteScrolling)return;function A(it){if(!m||!c||!g.length||W!=="pre-scroll")return;const q=(0,j.V7)(it,ut.current,ft,m,rt.current);ut.current=it,rt.current=m.scrollTop,q===j.Dh.Bottom&&dt()}return m.addEventListener("scroll",A),m.addEventListener("wheel",A),()=>{m.removeEventListener("scroll",A),m.removeEventListener("wheel",A)}},[W,c,g.length,dt,m]);const ht=(0,a.useCallback)(({index:A,style:it})=>!g[A]&&W!=="idle"?(0,e.jsx)(_,{style:it,styles:st,onClick:W==="pre-scroll"?dt:void 0,children:ct(W,Y)}):(0,e.jsx)(K.P0,{displayedFields:h,index:A,log:g[A],showTime:J,style:it,styles:st,variant:s(g,A,T.current),wrapLogMessage:X,onOverflow:t}),[h,t,W,g,dt,J,Y,st,X]),mt=(0,a.useCallback)(A=>{if(!m||W==="loading"||W==="out-of-bounds"||m.scrollHeight<=m.clientHeight)return;const it=g.length-1,q=g.length-2;A.visibleStopIndex>=it?Z("pre-scroll"):A.visibleStartIndex<q&&Z("idle")},[W,g.length,m]),pt=(0,a.useCallback)(A=>g[A]?g[A].uid:A.toString(),[g]),vt=g.length&&c&&W!=="idle"?g.length+1:g.length;return(0,e.jsx)(e.Fragment,{children:i({getItemKey:pt,itemCount:vt,onItemsRendered:mt,Renderer:ht})})};function ct(i,h){switch(i){case"out-of-bounds":return(0,u.t)("logs.infinite-scroll.end-of-range","End of the selected time range.");case"loading":return(0,e.jsxs)(e.Fragment,{children:[h===at.uH.Ascending?(0,u.t)("logs.infinite-scroll.load-newer","Loading newer logs..."):(0,u.t)("logs.infinite-scroll.load-older","Loading older logs...")," ",(0,e.jsx)(V.y,{inline:!0})]});case"pre-scroll":return(0,u.t)("logs.infinite-scroll.load-more","Scroll to load more");default:return null}}function s(i,h,t){if(!t.length||!i[h-1])return;const c=i[h-1];for(const g of t)if(c.uid===g)return"infinite-scroll"}var L=n(29457),d=n(92252),B=n(28848),l=n.n(B),E=n(80011),x=n(67770),H=n(74746),D=n(62215);const z={"log-token-uuid":/[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}/g,"log-token-json-key":/"(\b|\B)[\w-]+"(?=\s*:)/gi,"log-token-key":/(\b|\B)[\w_]+(?=\s*=)/gi,"log-token-size":/(?:\b|")\d+\.{0,1}\d*\s*[kKmMGgtTPp]*[bB]{1}(?:"|\b)/g,"log-token-duration":/(?:\b)\d+(\.\d+)?(ns|Âµs|ms|s|m|h|d)(?:\b)/g,"log-token-method":/\b(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS|TRACE|CONNECT)\b/g,"log-token-string":/"(?!:)([^'"])*?"(?!:)/g},tt=i=>{const h=Object.keys(i.labels).concat(i.fields.map(c=>c.keys[0]));return{...{"log-token-label":new RegExp(`\\b(${h.join("|")})(?:[=:]{1})\\b`,"g")},...z}},$=(i,{escape:h,getFieldLinks:t,order:c,timeZone:g},m)=>(0,H.oR)(i,c).map(J=>o(J,{escape:h,getFieldLinks:t,timeZone:g},m)),o=(i,{escape:h,getFieldLinks:t,timeZone:c},g)=>{let m=i.raw;const P=(0,E.LE)(i.timeEpochMs,{timeZone:c,defaultWithMS:!0});return h&&i.hasUnescapedContent&&(m=(0,H.Hw)(m)),m=m.replace(/(\r\n|\n|\r)/g,""),{...i,body:m,_highlightedBody:"",get highlightedBody(){return this._highlightedBody||(this._highlightedBody=l().highlight(m,g||tt(this),"lokiql")),this._highlightedBody},displayLevel:f(i.logLevel),fields:(0,D.jE)(i,t),timestamp:P}};function f(i=""){switch(i){case x.$b.critical:return"crit";case x.$b.warning:return"warn";case x.$b.unknown:return"";default:return i}}var p=n(55439);const C=({app:i,displayedFields:h,containerElement:t,dedupStrategy:c,eventBus:g,filterLevels:m,getFieldLinks:P,getRowContextQuery:J,grammar:Y,initialScrollPosition:nt="top",loadMore:et,logOptionsStorageKey:X,logs:W,logsMeta:Z,logSupportsContext:ot,onLogOptionsChange:lt,onLogLineHover:r,onPermalinkClick:G,onPinLine:rt,onOpenContext:ut,onUnpinLine:ft,pinLineButtonTooltipTitle:T,pinnedLogs:st,showControls:dt,showTime:ht,sortOrder:mt,syntaxHighlighting:pt=X?M.M.getBool(`${X}.syntaxHighlighting`,!0):!0,timeRange:vt,timeZone:A,wrapLogMessage:it})=>(0,e.jsx)(L.vv,{app:i,dedupStrategy:c,displayedFields:h,filterLevels:m,getRowContextQuery:J,logs:W,logsMeta:Z,logOptionsStorageKey:X,logSupportsContext:ot,onLogOptionsChange:lt,onLogLineHover:r,onPermalinkClick:G,onPinLine:rt,onOpenContext:ut,onUnpinLine:ft,pinLineButtonTooltipTitle:T,pinnedLogs:st,showControls:dt,showTime:ht,sortOrder:mt,syntaxHighlighting:pt,wrapLogMessage:it,children:(0,e.jsx)(I,{containerElement:t,eventBus:g,getFieldLinks:P,grammar:Y,initialScrollPosition:nt,loadMore:et,logs:W,showControls:dt,timeRange:vt,timeZone:A})}),I=({containerElement:i,eventBus:h=new S.o,getFieldLinks:t,grammar:c,initialScrollPosition:g="top",loadMore:m,logs:P,showControls:J,timeRange:Y,timeZone:nt})=>{const{app:et,displayedFields:X,filterLevels:W,forceEscape:Z,showTime:ot,sortOrder:lt,wrapLogMessage:r}=(0,L.fl)(),[G,rt]=(0,a.useState)([]),[ut,ft]=(0,a.useState)(et===N.Jk.Explore?window.innerHeight*.75:i.clientHeight),T=(0,U.$j)(),st=(0,a.useRef)(null),dt=(0,a.useRef)(i.clientWidth),ht=(0,a.useRef)(null),mt=(0,a.useMemo)(()=>r?[]:(0,p.u)(G,X),[X,G,r]),pt=Q(mt,{showTime:ot});(0,a.useEffect)(()=>{(0,p.Ts)(T)},[T]),(0,a.useEffect)(()=>{const q=h.subscribe(p._B,Lt=>b(Lt,P.length,st.current));return()=>q.unsubscribe()},[h,P.length]),(0,a.useEffect)(()=>{rt($(P,{getFieldLinks:t,escape:Z??!1,order:lt,timeZone:nt},c))},[Z,t,c,P,lt,nt]),(0,a.useEffect)(()=>{(0,p.MY)(),st.current?.resetAfterIndex(0)},[r,G]),(0,a.useEffect)(()=>{const q=(0,k.debounce)(()=>{ft(et===N.Jk.Explore?window.innerHeight*.75:i.clientHeight)},50);return window.addEventListener("resize",q),q(),()=>{window.removeEventListener("resize",q)}},[et,i.clientHeight]),(0,a.useLayoutEffect)(()=>{dt.current!==i.clientWidth&&((0,p.MY)(),st.current?.resetAfterIndex(0),dt.current=i.clientWidth)});const vt=(0,a.useCallback)((q,Lt,yt)=>{i&&((0,p.PQ)(Lt,i,yt),st.current?.resetAfterIndex(q))},[i]),A=(0,a.useCallback)(()=>{st.current?.scrollToItem(g==="top"?0:P.length-1)},[g,P.length]);if(!i||ut==null)return null;const it=(0,a.useMemo)(()=>W.length===0?G:G.filter(q=>W.includes(q.logLevel)),[W,G]);return(0,e.jsxs)("div",{className:pt.logListContainer,children:[(0,e.jsx)(O,{displayedFields:X,handleOverflow:vt,logs:it,loadMore:m,scrollElement:ht.current,showTime:ot,sortOrder:lt,timeRange:Y,timeZone:nt,setInitialScrollPosition:A,wrapLogMessage:r,children:({getItemKey:q,itemCount:Lt,onItemsRendered:yt,Renderer:Ct})=>(0,e.jsx)(y._m,{className:pt.logList,height:ut,itemCount:Lt,itemSize:p.gn.bind(null,it,i,X,{wrap:r,showControls:J,showTime:ot}),itemKey:q,layout:"vertical",onItemsRendered:yt,outerRef:ht,ref:st,style:{overflowY:"scroll"},width:"100%",children:Ct})}),J&&(0,e.jsx)(d.V,{eventBus:h})]})};function Q(i,{showTime:h}){const t=h?i:i.filter((c,g)=>g>0);return{logList:(0,v.css)({"& .unwrapped-log-line":{display:"grid",gridTemplateColumns:(0,K.Q5)(t)}}),logListContainer:(0,v.css)({display:"flex"})}}function b(i,h,t){i.payload.scrollTo==="top"?t?.scrollTo(0):t?.scrollToItem(h-1)}},29457:(xt,gt,n)=>{n.d(gt,{KB:()=>V,Q4:()=>w,fl:()=>F,u0:()=>at,vv:()=>R});var e=n(74848),v=n(96540),k=n(1906),a=n(739),y=n(78012),M=n(76732),S=n(74746);const N=(0,v.createContext)({app:k.Jk.Unknown,dedupStrategy:a.fY.none,displayedFields:[],downloadLogs:()=>{},filterLevels:[],hasUnescapedContent:!1,setDedupStrategy:()=>{},setDisplayedFields:()=>{},setFilterLevels:()=>{},setForceEscape:()=>{},setLogListState:()=>{},setPinnedLogs:()=>{},setPrettifyJSON:()=>{},setShowTime:()=>{},setShowUniqueLabels:()=>{},setSortOrder:()=>{},setSyntaxHighlighting:()=>{},setWrapLogMessage:()=>{},showTime:!0,sortOrder:a.uH.Ascending,syntaxHighlighting:!0,wrapLogMessage:!1}),U=u=>useContext(N)[u],F=()=>(0,v.useContext)(N),at=u=>{const{pinnedLogs:j}=(0,v.useContext)(N);return j?.some(K=>K===u.rowId)},R=({app:u,children:j,dedupStrategy:K,displayedFields:_,filterLevels:O,forceEscape:ct=!1,hasUnescapedContent:s,getRowContextQuery:L,logs:d,logsMeta:B,logOptionsStorageKey:l,logSupportsContext:E,onLogOptionsChange:x,onLogLineHover:H,onPermalinkClick:D,onPinLine:z,onOpenContext:tt,onUnpinLine:$,pinLineButtonTooltipTitle:o,pinnedLogs:f,prettifyJSON:p,showControls:C,showTime:I,showUniqueLabels:Q,sortOrder:b,syntaxHighlighting:i,wrapLogMessage:h})=>{const[t,c]=(0,v.useState)({dedupStrategy:K,displayedFields:_,filterLevels:O??(l?y.M.getObject(`${l}.filterLevels`,[]):[]),forceEscape:ct,hasUnescapedContent:s,pinnedLogs:f,prettifyJSON:p,showTime:I,showUniqueLabels:Q,sortOrder:b,syntaxHighlighting:i,wrapLogMessage:h});(0,v.useEffect)(()=>{if(C&&u!==k.Jk.PanelEditor)return;const r={...t,dedupStrategy:K,showTime:I,sortOrder:b,syntaxHighlighting:i,wrapLogMessage:h};(0,M.ab)(t.displayedFields,_)||(r.displayedFields=_),(0,M.ab)(t.pinnedLogs??[],f??[])||(r.pinnedLogs=f),(0,M.ab)(t,r)||c(r)},[u,K,_,t,f,C,I,b,i,h]),(0,v.useEffect)(()=>{O!==void 0&&((0,M.ab)(t.filterLevels,O)||c({...t,filterLevels:O}))},[O,t]),(0,v.useEffect)(()=>{t.hasUnescapedContent!==s&&c({...t,hasUnescapedContent:s})},[s,t]);const g=(0,v.useCallback)(r=>{c({...t,dedupStrategy:r}),x?.("dedupStrategy",r)},[t,x]),m=(0,v.useCallback)(r=>{c({...t,displayedFields:r}),x?.("displayedFields",r)},[t,x]),P=(0,v.useCallback)(r=>{c({...t,forceEscape:r})},[t]),J=(0,v.useCallback)(r=>{c({...t,filterLevels:r}),x?.("filterLevels",r)},[t,x]),Y=(0,v.useCallback)(r=>{c({...t,pinnedLogs:r}),x?.("pinnedLogs",r)},[t,x]),nt=(0,v.useCallback)(r=>{c({...t,showTime:r}),x?.("showTime",r),l&&y.M.set(`${l}.showTime`,r)},[t,l,x]),et=(0,v.useCallback)(r=>{c({...t,showUniqueLabels:r}),x?.("showUniqueLabels",r),l&&y.M.set(`${l}.showLabels`,r)},[t,l,x]),X=(0,v.useCallback)(r=>{c({...t,prettifyJSON:r}),x?.("prettifyJSON",r),l&&y.M.set(`${l}.prettifyLogMessage`,r)},[t,l,x]),W=(0,v.useCallback)(r=>{c({...t,syntaxHighlighting:r}),x?.("syntaxHighlighting",r),l&&y.M.set(`${l}.syntaxHighlighting`,r)},[t,l,x]),Z=(0,v.useCallback)(r=>{c({...t,sortOrder:r}),x?.("sortOrder",r),l&&y.M.set(`${l}.sortOrder`,r)},[t,l,x]),ot=(0,v.useCallback)(r=>{c({...t,wrapLogMessage:r}),x?.("wrapLogMessage",r),l&&y.M.set(`${l}.wrapLogMessage`,r)},[t,l,x]),lt=(0,v.useCallback)(r=>{const G=t.filterLevels.length===0?d:d.filter(rt=>t.filterLevels.includes(rt.logLevel));(0,S.K7)(r,G,B)},[t.filterLevels,d,B]);return(0,e.jsx)(N.Provider,{value:{app:u,dedupStrategy:t.dedupStrategy,displayedFields:t.displayedFields,downloadLogs:lt,filterLevels:t.filterLevels,forceEscape:t.forceEscape,hasUnescapedContent:t.hasUnescapedContent,getRowContextQuery:L,logSupportsContext:E,onLogLineHover:H,onPermalinkClick:D,onPinLine:z,onOpenContext:tt,onUnpinLine:$,pinLineButtonTooltipTitle:o,pinnedLogs:t.pinnedLogs,prettifyJSON:t.prettifyJSON,setDedupStrategy:g,setDisplayedFields:m,setFilterLevels:J,setForceEscape:P,setLogListState:c,setPinnedLogs:Y,setPrettifyJSON:X,setShowTime:nt,setShowUniqueLabels:et,setSortOrder:Z,setSyntaxHighlighting:W,setWrapLogMessage:ot,showTime:t.showTime,showUniqueLabels:t.showUniqueLabels,sortOrder:t.sortOrder,syntaxHighlighting:t.syntaxHighlighting,wrapLogMessage:t.wrapLogMessage},children:j})};function w(u){return u===a.uH.Ascending||u===a.uH.Descending}function V(u){return u===a.fY.exact||u===a.fY.none||u===a.fY.numbers||u===a.fY.signature}},92252:(xt,gt,n)=>{n.d(gt,{V:()=>s});var e=n(74848),v=n(22803),k=n(2543),a=n.n(k),y=n(96540),M=n(739),S=n(67770),N=n(1906),U=n(27489),F=n(43173),at=n(63142),R=n(87063),w=n(76319),V=n(88559),u=n(56840),j=n(74746),K=n(29457),_=n(55439);const O=[M.fY.none,M.fY.exact,M.fY.numbers,M.fY.signature],ct=[S.$b.info,S.$b.debug,S.$b.trace,S.$b.warning,S.$b.error,S.$b.critical],s=({eventBus:d,visualisationType:B="logs"})=>{const l=(0,at.of)(L),{app:E,dedupStrategy:x,downloadLogs:H,filterLevels:D,forceEscape:z,hasUnescapedContent:tt,prettifyJSON:$,setDedupStrategy:o,setFilterLevels:f,setForceEscape:p,setPrettifyJSON:C,setShowTime:I,setShowUniqueLabels:Q,setSortOrder:b,setSyntaxHighlighting:i,setWrapLogMessage:h,showTime:t,showUniqueLabels:c,sortOrder:g,syntaxHighlighting:m,wrapLogMessage:P}=(0,K.fl)(),J=(0,y.useCallback)(()=>{(0,U.rR)("logs_log_list_controls_scroll_top_clicked"),d.publish(new _._B({scrollTo:"top"}))},[d]),Y=(0,y.useCallback)(()=>{(0,U.rR)("logs_log_list_controls_scroll_bottom_clicked"),d.publish(new _._B({scrollTo:"bottom"}))},[d]),nt=(0,y.useCallback)(()=>{(0,U.rR)("logs_log_list_controls_force_escape_clicked"),p(!z)},[z,p]),et=(0,y.useCallback)(T=>{(0,U.rR)("logs_log_list_controls_level_clicked"),T===void 0?f([]):D.includes(T)?f(D.filter(st=>st!==T)):f([...D,T])},[D,f]),X=(0,y.useCallback)(()=>{(0,U.rR)("logs_log_list_controls_show_time_clicked",{show_time:!t}),I(!t)},[I,t]),W=(0,y.useCallback)(()=>{(0,U.rR)("logs_log_list_controls_show_unique_labels_clicked",{show_unique_labels:c}),Q(!c)},[Q,c]),Z=(0,y.useCallback)(()=>{(0,U.rR)("logs_log_list_controls_sort_order_clicked",{order:g===M.uH.Ascending?M.uH.Descending:M.uH.Ascending}),b(g===M.uH.Ascending?M.uH.Descending:M.uH.Ascending)},[b,g]),ot=(0,y.useCallback)(()=>{(0,U.rR)("logs_log_list_controls_prettify_json_clicked",{state:!$}),C(!$)},[$,C]),lt=(0,y.useCallback)(()=>{(0,U.rR)("logs_log_list_controls_syntax_clicked",{state:!m}),i(!m)},[i,m]),r=(0,y.useCallback)(T=>{T.preventDefault(),(0,U.rR)("logs_log_list_controls_wrap_clicked",{state:!P}),h(!P)},[h,P]),G=(0,y.useMemo)(()=>(0,e.jsx)(R.W,{children:O.map(T=>(0,e.jsx)(R.W.Item,{className:x===T?l.menuItemActive:void 0,description:S._C[T],label:(0,k.capitalize)(T),onClick:()=>o(T)},T))}),[x,o,l.menuItemActive]),rt=(0,y.useMemo)(()=>(0,e.jsxs)(R.W,{children:[(0,e.jsx)(R.W.Item,{className:D.length===0?l.menuItemActive:void 0,label:(0,u.t)("logs.logs-controls.display-level-all","All levels"),onClick:()=>et()},"all"),ct.map(T=>(0,e.jsx)(R.W.Item,{className:D.includes(T)?l.menuItemActive:void 0,label:(0,k.capitalize)(T),onClick:()=>et(T)},T))]}),[D,et,l.menuItemActive]),ut=(0,y.useMemo)(()=>(0,e.jsxs)(R.W,{children:[(0,e.jsx)(R.W.Item,{label:(0,u.t)("logs.logs-controls.download-logs.txt","txt"),onClick:()=>H(j.s.Text)}),(0,e.jsx)(R.W.Item,{label:(0,u.t)("logs.logs-controls.download-logs.json","json"),onClick:()=>H(j.s.Json)}),(0,e.jsx)(R.W.Item,{label:(0,u.t)("logs.logs-controls.download-logs.csv","csv"),onClick:()=>H(j.s.CSV)})]}),[H]),ft=E===N.Jk.Dashboard||E===N.Jk.PanelEditor||E===N.Jk.PanelViewer;return(0,e.jsxs)("div",{className:l.navContainer,children:[B==="logs"&&(0,e.jsx)(w.K,{name:"arrow-down",className:l.controlButton,variant:"secondary",onClick:Y,tooltip:(0,u.t)("logs.logs-controls.scroll-bottom","Scroll to bottom"),size:"lg"}),ft?(0,e.jsx)(V.m,{overlay:rt,placement:"auto-end",children:(0,e.jsx)(w.K,{name:"gf-logs",className:D&&D.length>0?l.controlButtonActive:l.controlButton,tooltip:(0,u.t)("logs.logs-controls.display-level","Display levels"),size:"lg"})}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(w.K,{name:g===M.uH.Descending?"sort-amount-up":"sort-amount-down",className:l.controlButton,onClick:Z,tooltip:g===M.uH.Descending?(0,u.t)("logs.logs-controls.newest-first","Newest logs first"):(0,u.t)("logs.logs-controls.oldest-first","Oldest logs first"),size:"lg"}),B==="logs"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(V.m,{overlay:G,placement:"auto-end",children:(0,e.jsx)(w.K,{name:"filter",className:x!==M.fY.none?l.controlButtonActive:l.controlButton,tooltip:(0,u.t)("logs.logs-controls.deduplication","Deduplication"),size:"lg"})}),(0,e.jsx)(V.m,{overlay:rt,placement:"auto-end",children:(0,e.jsx)(w.K,{name:"gf-logs",className:D&&D.length>0?l.controlButtonActive:l.controlButton,tooltip:(0,u.t)("logs.logs-controls.display-level","Display levels"),size:"lg"})}),(0,e.jsx)(w.K,{name:"clock-nine","aria-pressed":t,className:t?l.controlButtonActive:l.controlButton,onClick:X,tooltip:t?(0,u.t)("logs.logs-controls.hide-timestamps","Hide timestamps"):(0,u.t)("logs.logs-controls.show-timestamps","Show timestamps"),size:"lg"}),c!==void 0&&(0,e.jsx)(w.K,{name:"tag-alt","aria-pressed":c,className:c?l.controlButtonActive:l.controlButton,onClick:W,tooltip:c?(0,u.t)("logs.logs-controls.hide-unique-labels","Hide unique labels"):(0,u.t)("logs.logs-controls.show-unique-labels","Show unique labels"),size:"lg"}),(0,e.jsx)(w.K,{name:"wrap-text",className:P?l.controlButtonActive:l.controlButton,"aria-pressed":P,onClick:r,tooltip:P?(0,u.t)("logs.logs-controls.unwrap-lines","Unwrap lines"):(0,u.t)("logs.logs-controls.wrap-lines","Wrap lines"),size:"lg"}),$!==void 0&&(0,e.jsx)(w.K,{name:"brackets-curly","aria-pressed":$,className:$?l.controlButtonActive:l.controlButton,onClick:ot,tooltip:$?(0,u.t)("logs.logs-controls.disable-prettify-json","Collapse JSON logs"):(0,u.t)("logs.logs-controls.prettify-json","Expand JSON logs"),size:"lg"}),m!==void 0&&(0,e.jsx)(w.K,{name:"brackets-curly",className:m?l.controlButtonActive:l.controlButton,"aria-pressed":m,onClick:lt,tooltip:m?(0,u.t)("logs.logs-controls.disable-highlighting","Disable highlighting"):(0,u.t)("logs.logs-controls.enable-highlighting","Enable highlighting"),size:"lg"}),tt&&(0,e.jsx)(w.K,{name:"enter","aria-pressed":z,className:z?l.controlButtonActive:l.controlButton,onClick:nt,tooltip:z?(0,u.t)("logs.logs-controls.remove-escaping","Remove escaping"):(0,u.t)("logs.logs-controls.escape-newlines","Fix incorrectly escaped newline and tab sequences in log lines"),size:"lg"})]}),!F.$.exploreHideLogsDownload&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:l.divider}),(0,e.jsx)(V.m,{overlay:ut,placement:"auto-end",children:(0,e.jsx)(w.K,{name:"download-alt",className:l.controlButton,"aria-pressed":P,tooltip:(0,u.t)("logs.logs-controls.download","Download logs"),size:"lg"})})]})]}),B==="logs"&&(0,e.jsx)(w.K,{name:"arrow-up","data-testid":"scrollToTop",className:l.scrollToTopButton,variant:"secondary",onClick:J,tooltip:(0,u.t)("logs.logs-controls.scroll-top","Scroll to top"),size:"lg"})]})},L=d=>({navContainer:(0,v.css)({maxHeight:"100%",display:"flex",gap:d.spacing(3),flexDirection:"column",justifyContent:"flex-start",width:d.spacing(4),paddingTop:d.spacing(.75),paddingLeft:d.spacing(1),borderLeft:`solid 1px ${d.colors.border.medium}`}),scrollToTopButton:(0,v.css)({margin:0,marginTop:"auto",color:d.colors.text.secondary,height:d.spacing(2)}),controlButton:(0,v.css)({margin:0,color:d.colors.text.secondary,height:d.spacing(2)}),divider:(0,v.css)({borderTop:`solid 1px ${d.colors.border.medium}`,height:1,marginTop:d.spacing(-.25),marginBottom:d.spacing(-1.75)}),controlButtonActive:(0,v.css)({margin:0,color:d.colors.text.secondary,height:d.spacing(2),"&:after":{display:"block",content:'" "',position:"absolute",height:2,borderRadius:d.shape.radius.default,bottom:d.spacing(-1),backgroundImage:d.colors.gradients.brandHorizontal,width:"95%",opacity:1}}),menuItemActive:(0,v.css)({"&:before":{content:'""',position:"absolute",left:0,top:d.spacing(.5),height:`calc(100% - ${d.spacing(1)})`,width:"2px",backgroundColor:d.colors.warning.main}})})},55439:(xt,gt,n)=>{n.d(gt,{MY:()=>D,PQ:()=>z,SC:()=>B,Ts:()=>w,_B:()=>$,gn:()=>L,ks:()=>R,u:()=>d,yb:()=>F});var e=n(68388),v=n(76487),k=n(98102);let a=null,y=8,M=y*.75,S=22,N="canvas";const U=24,F=1.5,at=28,R=()=>S;function w(o){const f=`${o.typography.fontSize}px ${o.typography.fontFamilyMonospace}`,p=o.typography.body.letterSpacing;return K(f,p),u(f,p),y=o.spacing.gridSize,M=y*.75,S=o.typography.fontSize*o.typography.body.lineHeight,_=new Map,D(),V(),!0}function V(){if(!a){N="dom";return}const o=a.measureText("e").width;ct("e")-o>=.1&&(console.warn("Virtualized log list: falling back to DOM for measurement"),N="dom")}function u(o,f){a=document.createElement("canvas").getContext("2d"),a&&(a.font=o,a.fontKerning="normal",a.fontStretch="normal",a.fontVariantCaps="normal",a.textRendering="optimizeLegibility",f&&(a.letterSpacing=f))}const j=document.createElement("span");function K(o,f){j.style.font=o,j.style.visibility="hidden",j.style.position="absolute",j.style.wordBreak="break-all",f&&(j.style.letterSpacing=f)}let _=new Map;function O(o){if(!a)throw new Error("Measuring context canvas is not initialized. Call init() before.");const f=o.length,p=_.get(f);if(p)return p;const C=N==="canvas"?a.measureText(o).width:ct(o);return _.set(f,C),C}function ct(o){j.textContent=o,document.body.appendChild(j);const f=j.getBoundingClientRect().width;return document.body.removeChild(j),f}function s(o,f,p=0){let C=0;const I=O("e");let Q=Math.round(f/I);const b=Math.floor((f-p)/I)-2*I,i=o.split(`
`);if(i.length===1&&o.length<b)return{lines:1,height:S+M};const h=f-p;for(const c of i)for(let g=0;g<c.length;){let m,P=0,J=0;do m=c.substring(g,g+Q-J),P=O(m),J+=1;while(P>=h);p&&(p=0),C+=1,g+=m.length}const t=C*S+M;return{lines:C,height:t}}function L(o,f,p,{wrap:C,showControls:I,showTime:Q},b){if(!f)return 0;if(!C||!o[b])return S+M;const i=tt(o[b].uid,f);if(i)return i;let h="";const t=y*F;let c=0;I&&(c+=at),Q&&(c+=t,h+=o[b].timestamp),(o[b].displayLevel||!C)&&(c+=t,h+=o[b].displayLevel??"");for(const m of p)h=(0,k.LE)(m,o[b])+h;p.length||(h+=o[b].body);const{height:g}=s(h,E(f),c);return g}const d=(o,f=[])=>{if(!o.length)return[];let p=0,C=0;const I={};for(let b=0;b<o.length;b++){let i=O(o[b].timestamp);i>p&&(p=Math.round(i)),i=O(o[b].displayLevel),i>C&&(C=Math.round(i));for(const h of f)i=O((0,k.LE)(h,o[b])),I[h]=!I[h]||i>I[h]?Math.round(i):I[h]}const Q=[{field:"timestamp",width:p},{field:"level",width:C}];for(const b in I)b!==v.I&&Q.push({field:b,width:I[b]});return Q};function B(o,f){const p=f??o.clientHeight;if(o.scrollHeight>p)return o.scrollHeight;const C=o.children[1];return C instanceof HTMLDivElement&&C.clientHeight<p?C.clientHeight:null}const l=x();function E(o){return o.clientWidth-l-U}function x(){const o=document.createElement("div");o.style.width="100px",o.style.height="100px",o.style.overflow="scroll",o.style.position="absolute",o.style.top="-9999px",document.body.appendChild(o);const f=o.offsetWidth-o.clientWidth;return document.body.removeChild(o),f}let H=new Map;function D(){H=new Map}function z(o,f,p){const C=`${o}_${E(f)}`;H.set(C,p)}function tt(o,f){const p=`${o}_${E(f)}`;return H.get(p)}class $ extends e.x{static{this.type="logs-panel-scroll-to"}}}}]);

//# sourceMappingURL=4340.ec44f83a06a58fadfbbf.js.map