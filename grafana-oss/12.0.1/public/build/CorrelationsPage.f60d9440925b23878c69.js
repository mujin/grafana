"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9981],{88103:(ie,U,a)=>{a.r(U),a.d(U,{default:()=>Be});var e=a(74848),x=a(22803),B=a(2543),f=a(96540),T=a(27489),C=a(68143),$=a(44458),w=a(45861),V=a(30703),Y=a(6975),W=a(34999),le=a(27594),ce=a(34213),F=a(63142),de=a(99887),H=a(13791),ue=a(73427),fe=a(45776),t=a(56840),me=a(96673),ge=a(3023),xe=a(15840),p=a(49785);const J=(0,f.createContext)(void 0);function he(o){const[r,n]=(0,f.useState)(0),{pages:s,onSubmit:i,children:u}=o;return(0,e.jsx)(J.Provider,{value:{currentPage:r,CurrentPageComponent:s[r],isLastPage:r===s.length-1,nextPage:()=>n(r+1),prevPage:()=>n(r-1),onSubmit:i},children:u})}const Z=()=>{const o=(0,f.useContext)(J);if(!o)throw new Error("useWizardContext must be used within a WizardContextProvider");return o};function pe(o){const{navigation:r}=o,{handleSubmit:n}=(0,p.xW)(),{CurrentPageComponent:s,isLastPage:i,nextPage:u,onSubmit:l}=Z(),d=r;return(0,e.jsxs)("form",{onSubmit:n(c=>{i?l(c):u()}),children:[(0,e.jsx)(s,{}),(0,e.jsx)(d,{})]})}function G(o){const{defaultValues:r,pages:n,onSubmit:s,navigation:i}=o,u=(0,p.mN)({defaultValues:r});return(0,e.jsx)(p.Op,{...u,children:(0,e.jsx)(he,{pages:n,onSubmit:s,children:(0,e.jsx)(pe,{navigation:i})})})}var z=a(52860),M=a(16780),v=a(37386),P=a(63527),ve=a(87105);const X=(0,f.createContext)({loading:!1,correlation:void 0,readOnly:!1}),k=o=>{const{data:r,children:n}=o;return(0,e.jsx)(X.Provider,{value:r,children:n})},L=()=>(0,f.useContext)(X),q=(o,r)=>r?`${o}_${r.sourceUID}-${r.uid}`:o,ye=o=>({label:(0,x.css)({maxWidth:o.spacing(80)}),description:(0,x.css)({maxWidth:o.spacing(80)})}),_=()=>{const{register:o,formState:r}=(0,p.xW)(),n=(0,F.of)(ye),{correlation:s,readOnly:i}=L();return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(M.n,{label:(0,t.t)("correlations.basic-info-form.title","Define correlation label (Step 1 of 3)"),children:[(0,e.jsx)(t.x6,{i18nKey:"correlations.basic-info-form.sub-text",children:(0,e.jsx)("p",{children:"Define text that will describe the correlation."})}),(0,e.jsx)("input",{type:"hidden",...o("type")}),(0,e.jsx)(v.D,{label:(0,t.t)("correlations.basic-info-form.label-label","Label"),description:(0,t.t)("correlations.basic-info-form.label-description","This name will be used as the label for the correlation. This will show as button text, a menu item, or hover text on a link."),className:n.label,invalid:!!r.errors.label,error:r.errors.label?.message,children:(0,e.jsx)(P.p,{id:q("label",s),...o("label",{required:{value:!0,message:(0,t.t)("correlations.basic-info-form.label-required","This field is required.")}}),readOnly:i,placeholder:(0,t.t)("correlations.basic-info-form.label-placeholder","e.g. Tempo traces")})}),(0,e.jsx)(v.D,{label:(0,t.t)("correlations.basic-info-form.description-label","Description"),description:(0,t.t)("correlations.basic-info-form.description-description","Optional description with more information about the link"),className:(0,x.cx)(n.description),children:(0,e.jsx)(ve.f,{id:q("description",s),...o("description"),readOnly:i})})]})})};var R=a(8073),ee=a(76792),je=a(28998),be=a(78529),S=a(41654),Ce=a(66404),N=a(72636),A=a(45967),re=a(18857),De=a(76319),I=a(58843);const Te=()=>({removeButton:(0,x.css)({marginTop:"25px"})}),Se=o=>{const{index:r,value:n,readOnly:s,remove:i}=o,{control:u,formState:l,register:d,setValue:c,watch:h,getValues:y}=(0,p.xW)(),[j,D]=(0,f.useState)({});d(`config.transformations.${r}.type`,{required:{value:!0,message:(0,t.t)("correlations.transform-row.transform-required","Please select a transformation type")}});const K=(0,p.FH)({name:`config.transformations.${r}.type`,control:u}),m=(0,F.of)(Te),b=(0,I.jN)();return(0,e.jsxs)(S.B,{direction:"row",alignItems:"flex-start",children:[(0,e.jsx)(v.D,{label:(0,e.jsxs)(S.B,{gap:.5,children:[(0,e.jsx)(N.J,{htmlFor:`config.transformations.${n.id}-${r}.type`,children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.type-label",children:"Type"})}),(0,e.jsx)(A.m,{content:(0,e.jsx)("div",{children:(0,e.jsx)("p",{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.type-tooltip",children:"The type of transformation that will be applied to the source data."})})}),children:(0,e.jsx)(V.I,{name:"info-circle",size:"sm"})})]}),invalid:!!l.errors?.config?.transformations?.[r]?.type,error:l.errors?.config?.transformations?.[r]?.message,validationMessageHorizontalOverflow:!0,children:(0,e.jsx)(re.l6,{value:K,onChange:O=>{if(!s){const g=y()?.config?.transformations?.[r];if(g&&D({expression:g.expression,mapValue:g.mapValue}),O.value){const E=(0,I.hr)(O.value);E.expressionDetails.show?c(`config.transformations.${r}.expression`,j?.expression||""):c(`config.transformations.${r}.expression`,""),E.mapValueDetails.show?c(`config.transformations.${r}.mapValue`,j?.mapValue||""):c(`config.transformations.${r}.mapValue`,""),c(`config.transformations.${r}.type`,O.value)}}},options:b,width:25,inputId:`config.transformations.${n.id}-${r}.type`})}),(0,e.jsx)(v.D,{label:(0,e.jsxs)(S.B,{gap:.5,children:[(0,e.jsx)(N.J,{htmlFor:`config.transformations.${n.id}.field`,children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.field-label",children:"Field"})}),(0,e.jsx)(A.m,{content:(0,e.jsx)("div",{children:(0,e.jsx)("p",{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.field-tooltip",children:"Optional. The field to transform. If not specified, the transformation will be applied to the results field."})})}),children:(0,e.jsx)(V.I,{name:"info-circle",size:"sm"})})]}),children:(0,e.jsx)(P.p,{...d(`config.transformations.${r}.field`),readOnly:s,defaultValue:n.field,label:(0,t.t)("correlations.transform-row.field-input","field"),id:`config.transformations.${n.id}.field`})}),(0,e.jsx)(v.D,{label:(0,e.jsxs)(S.B,{gap:.5,children:[(0,e.jsxs)(N.J,{htmlFor:`config.transformations.${n.id}.expression`,children:[(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.expression-label",children:"Expression"}),(0,I.hr)(h(`config.transformations.${r}.type`)).expressionDetails.required?" *":""]}),(0,e.jsx)(A.m,{content:(0,e.jsx)("div",{children:(0,e.jsx)("p",{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.expression-tooltip",children:"Required for regular expression. The expression the transformation will use. Logfmt does not use further specifications."})})}),children:(0,e.jsx)(V.I,{name:"info-circle",size:"sm"})})]}),invalid:!!l.errors?.config?.transformations?.[r]?.expression,error:l.errors?.config?.transformations?.[r]?.expression?.message,children:(0,e.jsx)(P.p,{...d(`config.transformations.${r}.expression`,{required:(0,I.hr)(h(`config.transformations.${r}.type`)).expressionDetails.required?(0,t.t)("correlations.transform-row.expression-required","Please define an expression"):void 0}),defaultValue:n.expression,readOnly:s,disabled:!(0,I.hr)(h(`config.transformations.${r}.type`)).expressionDetails.show,id:`config.transformations.${n.id}.expression`})}),(0,e.jsx)(v.D,{label:(0,e.jsxs)(S.B,{gap:.5,children:[(0,e.jsx)(N.J,{htmlFor:`config.transformations.${n.id}.mapValue`,children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.map-value-label",children:"Map value"})}),(0,e.jsx)(A.m,{content:(0,e.jsx)("div",{children:(0,e.jsx)("p",{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.map-value-tooltip",children:"Optional. Defines the name of the variable. This is currently only valid for regular expressions with a single, unnamed capture group."})})}),children:(0,e.jsx)(V.I,{name:"info-circle",size:"sm"})})]}),children:(0,e.jsx)(P.p,{...d(`config.transformations.${r}.mapValue`),defaultValue:n.mapValue,readOnly:s,disabled:!(0,I.hr)(h(`config.transformations.${r}.type`)).mapValueDetails.show,id:`config.transformations.${n.id}.mapValue`})}),!s&&(0,e.jsx)("div",{className:m.removeButton,children:(0,e.jsx)(De.K,{tooltip:(0,t.t)("correlations.transform-row.remove-tooltip","Remove transformation"),name:"trash-alt",onClick:()=>{i(r)},children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform-row.remove-button",children:"Remove"})})})]},n.id)},Ie=o=>{const{control:r,register:n}=(0,p.xW)(),{fields:s,append:i,remove:u}=(0,p.jz)({control:r,name:"config.transformations"}),{readOnly:l}=o;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("input",{type:"hidden",...n("id")}),(0,e.jsxs)(S.B,{direction:"column",alignItems:"flex-start",children:[(0,e.jsx)(Ce.E,{variant:"h5",children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform.heading",children:"Transformations"})}),s.length===0&&(0,e.jsx)("div",{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform.no-transform",children:"No transformations defined."})}),s.length>0&&(0,e.jsx)("div",{children:s.map((d,c)=>(0,e.jsx)(Se,{value:d,index:c,readOnly:l,remove:u},c))}),!l&&(0,e.jsx)(w.$n,{icon:"plus",onClick:()=>i({type:void 0},{shouldFocus:!1}),variant:"secondary",type:"button",children:(0,e.jsx)(t.x6,{i18nKey:"correlations.transform.add-button",children:"Add transformation"})})]})]})},we=o=>({label:(0,x.css)({maxWidth:o.spacing(80)}),variable:(0,x.css)({fontFamily:o.typography.fontFamilyMonospace,fontWeight:o.typography.fontWeightMedium})}),Fe=(o,r)=>o==="query"?{title:(0,t.t)("correlations.source-form.query-title","Configure the data source that will link to {{dataSourceName}} (Step 3 of 3)",{dataSourceName:r}),descriptionPre:(0,t.t)("correlations.source-form.description-query-pre","You have used following variables in the target query:"),heading:(0,t.t)("correlations.source-form.heading-query","Variables used in the target query")}:{title:(0,t.t)("correlations.source-form.external-title","Configure the data source that will use the URL (Step 3 of 3)"),descriptionPre:(0,t.t)("correlations.source-form.description-external-pre","You have used following variables in the target URL:"),heading:(0,t.t)("correlations.source-form.heading-external","Variables used in the target URL")},te=()=>{const{control:o,formState:r,register:n,getValues:s}=(0,p.xW)(),i=(0,F.of)(we),u=m=>b=>m(b.uid),{correlation:l,readOnly:d}=L(),c=s("config.target"),h=s("type"),y=(0,be.O1)(c,{}).variables.map(m=>m.variableName+(m.fieldPath?`.${m.fieldPath}`:"")),j=(0,je.tR)().getInstanceSettings(s("targetUID"))?.name,D=Fe(h,j);function K(){return(0,e.jsx)(e.Fragment,{children:y.map((m,b)=>(0,e.jsxs)("span",{className:i.variable,children:[m,b<y.length-1?", ":""]},b))})}return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(M.n,{label:D.title,children:[(0,e.jsx)(t.x6,{i18nKey:"correlations.source-form.sub-text",children:(0,e.jsx)("p",{children:"Define what data source will display the correlation, and what data will replace previously defined variables."})}),(0,e.jsx)(p.xI,{control:o,name:"sourceUID",rules:{required:{value:!0,message:(0,t.t)("correlations.source-form.control-required","This field is required.")}},render:({field:{onChange:m,value:b}})=>(0,e.jsx)(v.D,{label:(0,t.t)("correlations.source-form.source-label","Source"),description:(0,t.t)("correlations.source-form.source-description","Results from selected source data source have links displayed in the panel"),htmlFor:"source",invalid:!!r.errors.sourceUID,error:r.errors.sourceUID?.message,children:(0,e.jsx)(ee.s,{onChange:u(m),noDefault:!0,current:b,inputId:"source",width:32,disabled:l!==void 0})})}),(0,e.jsx)(v.D,{label:(0,t.t)("correlations.source-form.results-label","Results field"),description:(0,t.t)("correlations.source-form.results-description","The link will be shown next to the value of this field"),className:i.label,invalid:!!r.errors?.config?.field,error:r.errors?.config?.field?.message,children:(0,e.jsx)(P.p,{id:q("field",l),...n("config.field",{required:(0,t.t)("correlations.source-form.results-required","This field is required.")}),readOnly:d})}),y.length>0&&(0,e.jsxs)(R.Z,{children:[(0,e.jsx)(R.Z.Heading,{children:D.heading}),(0,e.jsxs)(R.Z.Description,{children:[D.descriptionPre,(0,e.jsx)(K,{}),(0,e.jsx)("br",{}),(0,e.jsxs)(t.x6,{i18nKey:"correlations.source-form.description",children:["A data point needs to provide values to all variables as fields or as transformations output to make the correlation button appear in the visualization.",(0,e.jsx)("br",{}),"Note: Not every variable needs to be explicitly defined below. A transformation such as"," ",(0,e.jsx)("span",{className:i.variable,children:"logfmt"})," will create variables for every key/value pair."]})]})]}),(0,e.jsx)(Ie,{readOnly:d})]})})};var Pe=a(16817),Re=a(1906),Ee=a(78282);const $e=({dsUid:o,invalid:r,error:n,name:s})=>{const{value:i,loading:u,error:l}=(0,Pe.A)(async()=>{if(o)return(0,Ee.l)().get(o)},[o]),d=i?.components?.QueryEditor;return(0,e.jsx)(v.D,{label:(0,t.t)("correlations.query-editor.query-label","Query"),description:(0,e.jsx)("span",{children:(0,e.jsxs)(t.x6,{i18nKey:"correlations.query-editor.query-description",children:["Define the query that is run when the link is clicked. You can use"," ",(0,e.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/panels-visualizations/configure-data-links/",target:"_blank",rel:"noreferrer",children:"variables"})," ","to access specific field values."]})}),invalid:r,error:n,children:(0,e.jsx)(p.xI,{name:s,rules:{validate:{hasQueryEditor:(c,h)=>h.type==="query"&&d===void 0?(0,t.t)("correlations.query-editor.control-rules","The selected target data source must export a query editor."):!0}},render:({field:{value:c,onChange:h}})=>u?(0,e.jsx)(Y._,{text:(0,t.t)("correlations.query-editor.loading","Loading query editor...")}):l?(0,e.jsx)(W.F,{title:(0,t.t)("correlations.query-editor.error-title","Error loading data source"),children:(0,e.jsx)(t.x6,{i18nKey:"correlations.query-editor.error-text",children:"The selected data source could not be loaded."})}):i?d?(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(d,{onRunQuery:()=>{},app:Re.Jk.Correlations,onChange:y=>{h(y)},datasource:i,query:c})}):(0,e.jsx)(W.F,{title:(0,t.t)("correlations.query-editor.query-editor-title","Data source does not export a query editor.")}):(0,e.jsx)(W.F,{title:(0,t.t)("correlations.query-editor.data-source-title","No data source selected"),severity:"info",children:(0,e.jsx)(t.x6,{i18nKey:"correlations.query-editor.data-source-text",children:"Please select a target data source first."})})})})},Ve={query:{value:"query",label:"Query",description:"Open a query"},external:{value:"external",label:"External",description:"Open an external URL"}},Ke=o=>({typeSelect:(0,x.css)({maxWidth:o.spacing(40)})}),oe=()=>{const{control:o,formState:{errors:r}}=(0,p.xW)(),n=c=>h=>c(h.uid),{correlation:s}=L(),i=s&&"targetUID"in s?s.targetUID:void 0,u=(0,p.FH)({name:"targetUID"})||i,l=(0,p.FH)({name:"type"})||s?.type,d=(0,F.of)(Ke);return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(M.n,{label:(0,t.t)("correlations.target-form.title","Setup the target for the correlation (Step 2 of 3)"),children:[(0,e.jsx)(t.x6,{i18nKey:"correlations.target-form.sub-text",children:(0,e.jsx)("p",{children:"Define what the correlation will link to. With the query type, a query will run when the correlation is clicked. With the external type, clicking the correlation will open a URL."})}),(0,e.jsx)(p.xI,{control:o,name:"type",rules:{required:{value:!0,message:(0,t.t)("correlations.target-form.control-rules","This field is required.")}},render:({field:{onChange:c,value:h,...y}})=>(0,e.jsx)(v.D,{label:(0,t.t)("correlations.target-form.type-label","Type"),description:(0,t.t)("correlations.target-form.target-type-description","Specify the type of correlation"),htmlFor:"corrType",invalid:!!r.type,children:(0,e.jsx)(re.l6,{className:d.typeSelect,value:l,onChange:j=>c(j.value),options:Object.values(Ve),"aria-label":(0,t.t)("correlations.configure-correlation-target-form.aria-label-correlation-type","Correlation type")})})}),l==="query"&&((0,I.L5)(r),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p.xI,{control:o,name:"targetUID",rules:{required:{value:!0,message:(0,t.t)("correlations.target-form.control-rules","This field is required.")}},render:({field:{onChange:c,value:h}})=>(0,e.jsx)(v.D,{label:(0,t.t)("correlations.target-form.target-label","Target"),description:(0,t.t)("correlations.target-form.target-description-query","Specify which data source is queried when the link is clicked"),htmlFor:"target",invalid:!!r.targetUID,error:r.targetUID?.message,children:(0,e.jsx)(ee.s,{onChange:n(c),noDefault:!0,current:h,inputId:"target",width:32,disabled:s!==void 0})})}),(0,e.jsx)($e,{name:"config.target",dsUid:u,invalid:!!r?.config?.target,error:r?.config?.target&&"message"in r?.config?.target?(r?.config?.target).message:"Error"})]})),l==="external"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(p.xI,{control:o,name:"config.target",rules:{required:{value:!0,message:(0,t.t)("correlations.target-form.control-rules","This field is required.")}},render:({field:{onChange:c,value:h}})=>{const y=h;return(0,e.jsx)(v.D,{label:(0,t.t)("correlations.target-form.target-label","Target"),description:(0,t.t)("correlations.target-form.target-description-external","Specify the URL that will open when the link is clicked"),htmlFor:"target",children:(0,e.jsx)(P.p,{value:y.url||"",onChange:j=>{c({url:j.currentTarget.value})}})})}})})]})})},ne=()=>{const{currentPage:o,prevPage:r,isLastPage:n}=Z(),{readOnly:s,loading:i,correlation:u}=L(),l=!s&&(0,e.jsx)(w.$n,{variant:"primary",icon:i?"spinner":"save",type:"submit",disabled:i,children:u===void 0?(0,t.t)("correlations.navigation-form.add-button","Add"):(0,t.t)("correlations.navigation-form.save-button","Save")}),d=(0,e.jsx)(w.$n,{variant:"primary",type:"submit",children:(0,e.jsx)(t.x6,{i18nKey:"correlations.navigation-form.next-button",children:"Next"})});return(0,e.jsxs)(S.B,{justifyContent:"flex-start",children:[o>0?(0,e.jsx)(w.$n,{variant:"secondary",onClick:r,children:(0,e.jsx)(t.x6,{i18nKey:"correlations.navigation-form.back-button",children:"Back"})}):void 0,n?l:d]})},Oe=o=>({panelContainer:(0,x.css)({position:"relative",padding:o.spacing(1),marginBottom:o.spacing(2)}),infoBox:(0,x.css)({marginTop:"20px"})}),Ue=({onClose:o,onCreated:r})=>{const n=(0,F.of)(Oe),{create:{execute:s,loading:i,error:u,value:l}}=(0,z.lW)();(0,f.useEffect)(()=>{!u&&!i&&l&&r()},[u,i,l,r]);const d={type:"query",config:{target:{},field:""}};return(0,e.jsxs)(ge._,{className:n.panelContainer,children:[(0,e.jsx)(xe.J,{onClick:o}),(0,e.jsx)(k,{data:{loading:i,readOnly:!1,correlation:void 0},children:(0,e.jsx)(G,{defaultValues:d,pages:[_,oe,te],navigation:ne,onSubmit:s})})]})},We=({onUpdated:o,correlation:r,readOnly:n=!1})=>{const{update:{execute:s,loading:i,error:u,value:l}}=(0,z.lW)(),d=c=>s({...c,sourceUID:r.sourceUID,uid:r.uid});return(0,f.useEffect)(()=>{!u&&!i&&l&&o()},[u,i,l,o]),(0,e.jsx)(k,{data:{loading:i,readOnly:n,correlation:r},children:(0,e.jsx)(G,{defaultValues:r,pages:[_,oe,te],onSubmit:n?c=>()=>{}:d,navigation:ne})})};var Le=a(50201);const Ne=({onClick:o,canWriteCorrelations:r})=>r?(0,e.jsx)(Le.p,{variant:"call-to-action",button:(0,e.jsx)(w.$n,{icon:"gf-glue",onClick:o,size:"lg",children:(0,e.jsx)(t.x6,{i18nKey:"correlations.empty-state.button-title",children:"Add correlation"})}),message:(0,t.t)("correlations.empty-state.title","You haven't defined any correlations yet"),children:(0,e.jsx)(t.x6,{i18nKey:"correlations.empty-state.pro-tip",children:"You can also define correlations via datasource provisioning"})}):(0,e.jsxs)(R.Z,{children:[(0,e.jsx)(R.Z.Heading,{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.empty-correlations-cta.there-are-no-correlations-configured-yet",children:"There are no correlations configured yet."})}),(0,e.jsx)(R.Z.Description,{children:(0,e.jsx)(t.x6,{i18nKey:"correlations.empty-correlations-cta.please-contact-administrator-create-correlations",children:"Please contact your administrator to create new correlations."})})]}),ae=(o,r,n)=>o.values[n].name.localeCompare(r.values[n].name),Q=o=>o.provisioned,Ae=(0,x.css)({display:"flex",justifyContent:"center"});function Be(){const o=(0,fe.C)("correlations"),[r,n]=(0,f.useState)(!1),s=(0,f.useRef)(1),i=g=>{n(g),g&&(0,T.rR)("grafana_correlations_adding_started")},{remove:u,get:{execute:l,...d}}=(0,z.lW)(),c=ue.TP.hasPermission(me.AccessControlAction.DataSourcesWrite),h=(0,f.useCallback)(()=>{(0,T.rR)("grafana_correlations_added"),l({page:s.current}),i(!1)},[l]),y=(0,f.useCallback)(()=>{(0,T.rR)("grafana_correlations_edited"),l({page:s.current})},[l]),j=(0,f.useCallback)(async(g,E)=>{await u.execute(g),(0,T.rR)("grafana_correlations_deleted"),E&&s.current--,l({page:s.current})},[u,l]);(0,f.useEffect)(()=>{l({page:s.current})},[l]);const D=(0,f.useCallback)(({row:{index:g,original:{source:{uid:E},provisioned:Ye,uid:He}}})=>!Ye&&(0,e.jsx)($.e,{"aria-label":(0,t.t)("correlations.list.delete","delete correlation"),onConfirm:()=>j({sourceUID:E,uid:He},s.current>1&&g===0&&m?.correlations.length===1),closeOnConfirm:!0}),[j]),K=(0,f.useMemo)(()=>[{id:"info",cell:Qe,disableGrow:!0,visible:g=>g.some(Q)},{id:"source",header:(0,t.t)("correlations.list.source","Source"),cell:se,sortType:ae},{id:"target",header:(0,t.t)("correlations.list.target","Target"),cell:se,sortType:ae},{id:"label",header:(0,t.t)("correlations.list.label","Label"),sortType:"alphanumeric"},{id:"actions",cell:D,disableGrow:!0,visible:g=>c&&g.some((0,B.negate)(Q))}],[D,c]),m=(0,f.useMemo)(()=>d.value,[d.value]),b=m?.correlations.length===0&&!r&&!d.error,O=c&&m?.correlations?.length!==0&&m!==void 0&&!r&&(0,e.jsx)(w.$n,{icon:"plus",onClick:()=>i(!0),children:(0,e.jsx)(t.x6,{i18nKey:"correlations.add-new",children:"Add new"})});return(0,e.jsx)(H.Y,{navModel:o,subTitle:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(t.x6,{i18nKey:"correlations.sub-title",children:["Define how data living in different data sources relates to each other. Read more in the"," ",(0,e.jsxs)("a",{href:"https://grafana.com/docs/grafana/next/administration/correlations/",target:"_blank",rel:"noreferrer",children:["documentation",(0,e.jsx)(V.I,{name:"external-link-alt"})]})]})}),actions:O,children:(0,e.jsx)(H.Y.Contents,{children:(0,e.jsxs)("div",{children:[!m&&d.loading&&(0,e.jsx)("div",{className:Ae,children:(0,e.jsx)(Y._,{text:(0,t.t)("correlations.list.loading","loading...")})}),b&&(0,e.jsx)(Ne,{canWriteCorrelations:c,onClick:()=>i(!0)}),d.error&&(0,e.jsx)(W.F,{severity:"error",title:(0,t.t)("correlations.alert.title","Error fetching correlation data"),topSpacing:2,children:(0,C.NF)(d.error)&&d.error.data?.message||(0,t.t)("correlations.alert.error-message","An unknown error occurred while fetching correlation data. Please try again.")}),r&&(0,e.jsx)(Ue,{onClose:()=>i(!1),onCreated:h}),m&&m.correlations.length>=1&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(le.j,{renderExpandedRow:g=>(0,e.jsx)(ze,{correlation:g,onUpdated:y,readOnly:Q(g)||!c}),columns:K,data:m.correlations,getRowId:g=>`${g.source.uid}-${g.uid}`}),(0,e.jsx)(ce.d,{currentPage:s.current,numberOfPages:Math.ceil(m.totalCount/m.limit),onNavigate:g=>{l({page:s.current=g})}})]})]})})})}function ze({correlation:{source:o,...r},readOnly:n,onUpdated:s}){(0,f.useEffect)(()=>(0,T.rR)("grafana_correlations_details_expanded"),[]);let i=r.type==="query"?{...r,type:"query",sourceUID:o.uid,targetUID:r.target.uid}:{...r,type:"external",sourceUID:o.uid};return(0,e.jsx)(We,{correlation:i,onUpdated:s,readOnly:n})}const Me=o=>({root:(0,x.css)({display:"flex",alignItems:"center"}),dsLogo:(0,x.css)({marginRight:o.spacing(),height:"16px",width:"16px"})}),se=(0,f.memo)(function({cell:{value:r}}){const n=(0,F.of)(Me);return(0,e.jsx)("span",{className:n.root,children:r?.name!==void 0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("img",{src:r.meta.info.logos.small,alt:"",className:n.dsLogo}),r.name]})})},({cell:{value:o}},{cell:{value:r}})=>o?.type===r?.type&&o?.name===r?.name),qe=(0,x.css)({whiteSpace:"nowrap"}),Qe=(0,f.memo)(function({...r}){return r.row.original.provisioned?(0,e.jsx)(de.E,{text:(0,t.t)("correlations.list.read-only","Read only"),color:"purple",className:qe}):null},(o,r)=>o.row.original.source.readOnly===r.row.original.source.readOnly)},58843:(ie,U,a)=>{a.d(U,{L5:()=>B,hr:()=>f,jN:()=>T});var e=a(79609),x=a(56840);function B(C){}function f(C){switch(C){case e.CC.Logfmt:return{label:(0,x.t)("correlations.trans-details.logfmt-label","Logfmt"),value:e.CC.Logfmt,description:(0,x.t)("correlations.trans-details.logfmt-description","Parse provided field with logfmt to get variables"),expressionDetails:{show:!1},mapValueDetails:{show:!1}};case e.CC.Regex:return{label:(0,x.t)("correlations.trans-details.regex-label","Regular expression"),value:e.CC.Regex,description:(0,x.t)("correlations.trans-details.regex-description","Field will be parsed with regex. Use named capture groups to return multiple variables, or a single unnamed capture group to add variable to named map value. Regex is case insensitive."),expressionDetails:{show:!0,required:!0,helpText:(0,x.t)("correlations.trans-details.regex-expression","Use capture groups to extract a portion of the field.")},mapValueDetails:{show:!0,required:!1,helpText:(0,x.t)("correlations.trans-details.regex-map-values","Defines the name of the variable if the capture group is not named.")}};default:return{label:C,value:C,expressionDetails:{show:!1},mapValueDetails:{show:!1}}}}const T=()=>Object.values(e.CC).map(C=>{const $=f(C);return{label:$.label,value:$.value,description:$.description}})}}]);

//# sourceMappingURL=CorrelationsPage.f60d9440925b23878c69.js.map