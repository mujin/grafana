"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6199],{47220:(Y,A,t)=>{t.d(A,{o:()=>n});var h=t(74848),v=t(96540),g=t(36638),D=t(57866),L=t(95004),f=t(60519),K=t(54735),C=t(36192),x=t(92790),r=t(17669);function u(s,e,l=[]){for(const a of l)if(typeof a=="function"){if(!a(s,e))return!1}else if(e[a]!==s[a])return!1;return!0}const d={x:g.sJ.get(D.Ct.firstTimeField).get({}),y:g.sJ.get(D.Ct.byTypes).get(new Set([L.PU.number,L.PU.enum]))};class n extends v.Component{constructor(e){super(e),this.getTimeRange=()=>this.props.timeRange;let l=this.prepState(e);l.alignedData=l.config.prepData([l.alignedFrame]),this.state=l,this.plotInstance=v.createRef()}prepState(e,l=!0){let a=null;const{frames:i,fields:o=d,preparePlotFrame:E,replaceVariables:T,dataLinkPostProcessor:p}=e,N=E??r.m,B=i.some(y=>y.fields.some(H=>(H.config.links?.length??0)>0)),m=N(i,{...o,y:B?()=>!0:o.y},e.timeRange);if((0,C.uY)("GraphNG",!1,"data aligned",m),m){let y=m;if(B){const S=Array.isArray(this.props.timeZone)?this.props.timeZone[0]:this.props.timeZone;let V=i.map((F,M)=>({...F,fields:m.fields.filter((U,W)=>W===0||U.state?.origin?.frameIndex===M),length:m.length}));V.forEach((F,M)=>{F.fields.forEach(U=>{U.getLinks=(0,f._M)(F,U,{...U.state?.scopedVars,__dataContext:{value:{data:V,field:U,frame:F,frameIndex:M}}},T,S,p)})}),y={...m,fields:m.fields.filter((F,M)=>M===0||o.y(F,m,[m]))}}if(e.omitHideFromViz){const S=y.fields.filter(V=>V.config.custom?.hideFrom?.viz!==!0);y={...y,fields:S,length:S.length}}let H=this.state?.config;l&&(H=e.prepConfig(y,this.props.frames,this.getTimeRange),(0,C.uY)("GraphNG",!1,"config prepared",H)),a={alignedFrame:y,config:H},(0,C.uY)("GraphNG",!1,"data prepared",a.alignedData)}return a}componentDidUpdate(e){const{frames:l,structureRev:a,timeZone:i,cursorSync:o,propsToDiff:E}=this.props,T=!u(e,this.props,E);if(l!==e.frames||T||i!==e.timeZone||o!==e.cursorSync){let p=this.prepState(this.props,!1);p&&((this.state.config===void 0||i!==e.timeZone||o!==e.cursorSync||a!==e.structureRev||!a||T)&&(p.config=this.props.prepConfig(p.alignedFrame,this.props.frames,this.getTimeRange),(0,C.uY)("GraphNG",!1,"config recreated",p.config)),p.alignedData=p.config.prepData([p.alignedFrame]),this.setState(p))}}render(){const{width:e,height:l,children:a,renderLegend:i}=this.props,{config:o,alignedFrame:E,alignedData:T}=this.state;return o?(0,h.jsx)(K.KU,{width:e,height:l,legend:i(o),children:(p,N)=>(0,h.jsx)(x.Z,{config:o,data:T,width:p,height:N,plotRef:B=>this.plotInstance.current=B,children:a?a(o,E):null})}):null}}},17669:(Y,A,t)=>{t.d(A,{m:()=>x});var h=t(95004),v=t(63409),g=t(8721);function D(r,u,d){let n,s;for(let e=0;e<u.length;e++)if(u[e]==null)s==null&&n!=null&&(s=e);else{if(s!=null&&n!=null){if(r[e]-n<d)for(;s<e;)u[s++]=void 0;s=null}n=r[e]}return u}var L=t(739);function f(r){return r.type===h.PU.number&&r.config.custom?.drawStyle===L.GR.Bars&&!r.config.custom?.hideFrom?.viz}function K(r,u){return r.fields.find(d=>u!=null?d.name===u:d.type===h.PU.time)}function C(r,u){const d=K(r,u);let n=d?.values;for(let s=0;s<r.fields.length;s++){let e=r.fields[s];if(e===d||f(e))continue;let l=e.config.custom?.spanNulls;typeof l=="number"&&l!==-1&&n&&(e.values=D(n,e.values,l))}return r}function x(r,u,d){let n;t:for(let a of r)for(let i of a.fields)if(u.x(i,a,r)){n=i;break t}r=r.map(a=>n?.state?.nullThresholdApplied?a:(0,v.M)({frame:a,refFieldName:n.name,refFieldPseudoMin:d?.from.valueOf(),refFieldPseudoMax:d?.to.valueOf()}));let s=r.reduce((a,i)=>a+i.fields.reduce((o,E)=>o+(f(E)?1:0),0),0),e=1/0;s>1&&r.forEach(a=>{if(!a.fields.some(f))return;const i=n.values;for(let o=0;o<i.length;o++)o>0&&(e=Math.min(e,i[o]-i[o-1]))});let l=(0,g.Fd)({frames:r,joinBy:u.x,keep:u.y,keepOriginIndices:!0,keepDisplayNames:!0,nullMode:a=>{if(f(a))return g.WO;let i=a.config.custom?.spanNulls;return i===!0?g.RC:i===-1?g.WO:g.JI}});return l?(l=C(l,n.name),e!==1/0&&(l.fields.forEach((a,i)=>{let o=a.values;if(i===0){let E=o[o.length-1];o.push(E+e,E+2*e)}else f(a)?o.push(null,null):o.push(void 0,void 0)}),l.length+=2),l):null}},16608:(Y,A,t)=>{t.d(A,{I:()=>u});var h=t(74848),v=t(96540),g=t(64394),D=t(95004),L=t(739),f=t(54735),K=t(78055),C=t(47220),x=t(68706);const r=["rowHeight","colWidth","showValue","mergeValues","alignValue","tooltip","paginationRev"];class u extends v.Component{constructor(){super(...arguments),this.getValueColor=(n,s,e)=>{const l=this.props.frames[n]?.fields[s];if(l?.display){const a=l.display(e);if(a.color)return a.color}return g.F},this.prepConfig=(n,s,e)=>(0,x.iE)({frame:n,getTimeRange:e,allFrames:this.props.frames,...this.props,timeZones:Array.isArray(this.props.timeZone)?this.props.timeZone:[this.props.timeZone],rowHeight:n.fields.length>2?this.props.rowHeight:1,getValueColor:this.getValueColor,hoverMulti:this.props.tooltip?.mode===L.$N.Multi}),this.renderLegend=n=>{const{legend:s,legendItems:e}=this.props;return!n||!e||!s||s.showLegend===!1?null:(0,h.jsx)(f.KU.Legend,{placement:s.placement,children:(0,h.jsx)(K.t,{placement:s.placement,items:e,displayMode:s.displayMode,readonly:!0})})}}render(){return(0,h.jsx)(C.o,{...this.props,fields:{x:n=>n.type===D.PU.time,y:n=>n.type===D.PU.number||n.type===D.PU.boolean||n.type===D.PU.string||n.type===D.PU.enum},prepConfig:this.prepConfig,propsToDiff:r,renderLegend:this.renderLegend,omitHideFromViz:!0})}}},44391:(Y,A,t)=>{t.d(A,{K:()=>d});var h=t(74848),v=t(95004),g=t(739),D=t(55302),L=t(39064),f=t(61048),K=t(41530),C=t(47466),x=t(68706),r=t(16913),u=t(76234);const d=({series:n,dataIdxs:s,seriesIdx:e,mode:l=g.$N.Single,sortOrder:a=g.xB.None,isPinned:i,annotate:o,timeRange:E,withDuration:T,maxHeight:p,replaceVariables:N,dataLinks:B})=>{const m=n.fields[0],y=e!=null?s[e]:s.find(M=>M!=null),H=m.display(m.values[y]).text;l=i?g.$N.Single:l;const S=(0,D.cp)(n.fields,m,s,e,l,a);if(T&&l===g.$N.Single){const M=n.fields[e],U=(0,x.GY)(M,y);let W;U&&(W=m.values[U]);const Q=m.values[y];let c;if(W)c=W&&(0,x.c5)(W-Q);else{const P=E.to.valueOf();c=(0,x.c5)(P-Q)}S.push({label:"Duration",value:c})}let V;if(e!=null){const M=n.fields[e],U=B.some(W=>W.oneClick===!0);if(i||U){const W=s[e],Q=(0,r.OG)(n,M,N,W);V=(0,h.jsx)(L.S,{dataLinks:B,actions:Q,annotate:o})}}const F={label:m.type===v.PU.time?"":m.state?.displayName??m.name,value:H};return(0,h.jsxs)(f.i,{children:[(0,h.jsx)(K.A,{item:F,isPinned:i}),(0,h.jsx)(C.o,{items:S,isPinned:i,scrollable:(0,u.T5)({mode:l,maxHeight:p}),maxHeight:p}),V]})}},44372:(Y,A,t)=>{t.r(A),t.d(A,{plugin:()=>Q});var h=t(16207),v=t(83340),g=t(64394),D=t(95004),L=t(38809),f=t(739),K=t(45013),C=t(44017),x=t(41069),r=t(79277),u=t(17914),d=t(76548),n=t(74848),s=t(96540),e=t(84229),l=t(63142),a=t(64400),i=t(18667),o=t(69234),E=t(16608),T=t(68706),p=t(36327),N=t(13507),B=t(76234),m=t(44391),y=t(28343);const H=({data:c,timeRange:P,timeZone:I,options:O,width:j,height:_,replaceVariables:J,onChangeTimeRange:$})=>{const R=(0,l.$j)(),[G,Z]=(0,s.useState)(null),{sync:z,eventsScope:ot,canAddAnnotations:et,dataLinkPostProcessor:rt,eventBus:ut}=(0,a.d2)(),q=z?.()??e.y.Off,{frames:dt,warn:nt}=(0,s.useMemo)(()=>(0,T.Qe)(c.series,O.mergeValues??!0,P,R),[c.series,O.mergeValues,P,R]),{paginatedFrames:X,paginationRev:ft,paginationElement:gt,paginationHeight:mt}=(0,y.W)(dt,O.perPage),ct=(0,s.useMemo)(()=>(0,T.Or)(X,O.legend,R),[X,O.legend,R]),ht=(0,s.useMemo)(()=>(0,B.Fg)(O.timezone,I),[O.timezone,I]);if(!X||nt)return(0,n.jsx)("div",{className:"panel-empty",children:(0,n.jsx)("p",{children:nt??"No data found in response"})});const at=!!(et&&et());return(0,n.jsxs)("div",{className:y.i.container,children:[(0,n.jsx)(E.I,{theme:R,frames:X,structureRev:c.structureRev,paginationRev:ft,timeRange:P,timeZone:ht,width:j,height:_-mt,legendItems:ct,...O,mode:T.pm.Changes,replaceVariables:J,dataLinkPostProcessor:rt,cursorSync:q,children:(w,b)=>(0,n.jsxs)(n.Fragment,{children:[q!==e.y.Off&&(0,n.jsx)(i.K,{config:w,eventBus:ut,frame:b}),O.tooltip.mode!==f.$N.None&&(0,n.jsx)(o.xl,{config:w,hoverMode:O.tooltip.mode===f.$N.Multi?o.b3.xAll:o.b3.xOne,queryZoom:$,syncMode:q,syncScope:ot,getDataLinks:(k,tt)=>b.fields[k].getLinks?.({valueRowIndex:tt})??[],render:(k,tt,pt,vt,st,lt,Et,Mt)=>{if(at&&lt!=null){Z(lt),st();return}const Pt=()=>{let it=k.posToVal(k.cursor.left,"x");Z({from:it,to:it}),st()};return(0,n.jsx)(m.K,{series:b,dataIdxs:tt,seriesIdx:pt,mode:Et?f.$N.Multi:O.tooltip.mode,sortOrder:O.tooltip.sort,isPinned:vt,timeRange:P,annotate:at?Pt:void 0,withDuration:!0,maxHeight:O.tooltip.maxHeight,replaceVariables:J,dataLinks:Mt})},maxWidth:O.tooltip.maxWidth}),b.fields[0].config.custom?.axisPlacement!==f.vM.Hidden&&(0,n.jsx)(p.W,{annotations:c.annotations??[],config:w,timeZone:I,newRange:G,setNewRange:Z,canvasRegionRendering:!1}),(0,n.jsx)(N.U,{config:w,onChangeTimeRange:$})]})}),gt]})};var S=t(2543),V=t(18600);const F=(c,P,I)=>{let O=c.options??{};if(P==="natel-discrete-panel"&&I.angular){const j=I.angular,_=c.fieldConfig??{defaults:{},overrides:[]};j.units&&(_.defaults.unit=j.units);const J={fillOpacity:100,lineWidth:0};_.defaults.custom=J,O.mergeValues=!0;const $={type:V.d.ValueToText,options:{}};if(_.defaults.mappings=[$],(0,S.isArray)(j.colorMaps))for(const R of j.colorMaps){const G=R.color;G&&($.options[R.text]={color:G})}if((0,S.isArray)(j.valueMaps))for(const R of j.valueMaps){const G=R.text,Z=R.value;if(G&&Z){let z=$.options[Z];z?z.text=G:$.options[Z]={text:G}}}if((0,S.isArray)(j.rangeMaps))for(const R of j.rangeMaps){let G=+R.from,Z=+R.to;const z=R.text;z&&_.defaults.mappings.push({type:V.d.RangeToText,options:{from:G,to:Z,result:{text:z}}})}c.fieldConfig=_}return O};var M=t(11686),U=t(73495);class W{getSuggestionsForData(P){const{dataSummary:I}=P;if(!I.hasData||!I.hasTimeField||!I.hasStringField&&!I.hasNumberField||I.numberFieldCount>=30||I.preferredVisualisationType==="logs")return;P.getListAppender({name:"",pluginId:"state-timeline",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}}).append({name:U.m.StateTimeline})}}const Q=new h.m(H).setPanelChangeHandler(F).useFieldConfig({standardOptions:{[v.uo.Color]:{settings:{byValueSupport:!0},defaultValue:{mode:g.Y.ContinuousGrYlRd}},[v.uo.Links]:{settings:{showOneClick:!0}},[v.uo.Actions]:{hideFromDefaults:!1}},useCustomConfig:c=>{c.addSliderInput({path:"lineWidth",name:"Line width",defaultValue:M.Q.lineWidth,settings:{min:0,max:10,step:1}}).addSliderInput({path:"fillOpacity",name:"Fill opacity",defaultValue:M.Q.fillOpacity,settings:{min:0,max:100,step:1}}).addCustomEditor({id:"spanNulls",path:"spanNulls",name:"Connect null values",defaultValue:!1,editor:d.e,override:d.e,shouldApply:P=>P.type!==D.PU.time,process:L.hS,settings:{isTime:!0}}).addCustomEditor({id:"insertNulls",path:"insertNulls",name:"Disconnect values",defaultValue:!1,editor:u.Z,override:u.Z,shouldApply:P=>P.type!==D.PU.time,process:L.hS,settings:{isTime:!0}}),K.e(c),C.Wq(c,P=>P===f.vM.Auto||P===f.vM.Hidden),C.T4(c)}}).setPanelOptions(c=>{c.addBooleanSwitch({path:"mergeValues",name:"Merge equal consecutive values",defaultValue:M.K.mergeValues}).addRadio({path:"showValue",name:"Show values",settings:{options:[{value:f.yL.Auto,label:"Auto"},{value:f.yL.Always,label:"Always"},{value:f.yL.Never,label:"Never"}]},defaultValue:M.K.showValue}).addRadio({path:"alignValue",name:"Align values",settings:{options:[{value:"left",label:"Left"},{value:"center",label:"Center"},{value:"right",label:"Right"}]},defaultValue:M.K.alignValue}).addSliderInput({path:"rowHeight",name:"Row height",settings:{min:0,max:1,step:.01},defaultValue:M.K.rowHeight}).addNumberInput({path:"perPage",name:"Page size (enable pagination)",settings:{min:1,step:1,integer:!0}}),x.H(c,!1),r.D(c)}).setSuggestionsSupplier(new W).setDataSupport({annotations:!0})},11686:(Y,A,t)=>{t.d(A,{K:()=>v,Q:()=>g});var h=t(739);const v={alignValue:"left",mergeValues:!0,perPage:20,rowHeight:.9,showValue:h.yL.Auto},g={fillOpacity:70,lineWidth:0}},28343:(Y,A,t)=>{t.d(A,{W:()=>r,i:()=>C});var h=t(74848),v=t(22803),g=t(96540),D=t(49185),L=t(34213),f=t(68706),K=t(11686);const C={container:(0,v.css)({display:"flex",flexDirection:"column"})},x={paginationContainer:(0,v.css)({display:"flex",justifyContent:"center",width:"100%"}),paginationElement:(0,v.css)({marginTop:"8px"})};function r(u,d){const[n,s]=(0,g.useState)(1),[e,{height:l,width:a}]=(0,D.A)(),i=(0,g.useMemo)(()=>!d||u==null?u:(0,f.uB)(u),[u,d]);if(!d||i==null)return{paginatedFrames:i,paginationRev:"disabled",paginationElement:void 0,paginationHeight:0};d||=K.K.perPage;const o=Math.ceil(i.length/d),E=Math.min(n,o),T=(E-1)*d,p=i.slice(T,T+d),N=`${E}/${d}`,B=a<550,m=(0,h.jsx)("div",{className:x.paginationContainer,ref:e,children:(0,h.jsx)(L.d,{className:x.paginationElement,currentPage:E,numberOfPages:o,showSmallVersion:B,onNavigate:s})});return{paginatedFrames:p,paginationRev:N,paginationElement:m,paginationHeight:l}}}}]);

//# sourceMappingURL=stateTimelinePanel.6a53d25819c4c9e70c58.js.map