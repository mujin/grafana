"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2835],{37011:(P,g,a)=>{a.d(g,{R:()=>h});var t=a(74848),i=a(22803),u=a(63142),c=a(76319),p=a(56840);const h=({labelKey:r,value:v,operator:y="=",onRemoveLabel:x})=>{const j=(0,u.of)(f);return(0,t.jsxs)("div",{className:j.wrapper,children:[r,y,v,!!x&&(0,t.jsx)(c.K,{name:"times",size:"xs",onClick:x,tooltip:(0,p.t)("alerting.alert-label.tooltip-remove-label","Remove label")})]})},f=r=>({wrapper:(0,i.css)({padding:r.spacing(.5,1),borderRadius:r.shape.radius.default,border:`solid 1px ${r.colors.border.medium}`,fontSize:r.typography.bodySmall.fontSize,backgroundColor:r.colors.background.secondary,fontWeight:r.typography.fontWeightBold,color:r.colors.text.primary,display:"inline-block",lineHeight:"1.2"})})},32835:(P,g,a)=>{a.r(g),a.d(g,{default:()=>J,groupStateByLabels:()=>C,matchKey:()=>T});var t=a(74848),i=a(22803),u=a(2543),c=a(96540),p=a(80011),h=a(63142),f=a(6975),r=a(34999),v=a(37386),y=a(72636),x=a(41654),j=a(45967),S=a(30703),R=a(63527),m=a(56840),B=a(96673),M=a(11018),O=a(98127);function K(e){const n=(0,B.useDispatch)(),s=(0,O.$)(o=>o.managedAlertStateHistory);return(0,c.useEffect)(()=>{n((0,M.JH)(e))},[n,e]),s}var I=a(37011),W=a(6106),z=a(65420);const b=({ruleUID:e})=>{const[n,s]=(0,c.useState)(""),o=(0,c.useCallback)(l=>{s(l.currentTarget.value)},[]),{loading:d,error:E,result:X=[]}=K(e),A=(0,h.of)(L);if(d&&!E)return(0,t.jsx)(f._,{text:(0,m.t)("alerting.state-history.text-loading-history","Loading history...")});if(E&&!d)return(0,t.jsx)(r.F,{title:(0,m.t)("alerting.state-history.title-failed-to-fetch-alert-state-history","Failed to fetch alert state history"),children:E.message});const $=[{id:"state",label:"State",size:"max-content",renderCell:F},{id:"value",label:"",size:"auto",renderCell:H},{id:"timestamp",label:"Time",size:"max-content",renderCell:N}],V=Object.entries(C(X)).sort().filter(([l])=>T(l,n)).map(([l,Q])=>{const Y=Q.map(D=>({id:D.id,data:D}));return(0,t.jsxs)("div",{children:[(0,t.jsx)("header",{className:A.tableGroupKey,children:(0,t.jsx)("code",{className:A.goupKeyText,"aria-label":l,children:l})}),(0,t.jsx)(W.E,{cols:$,items:Y,pagination:{itemsPerPage:25}})]},l)});return(0,t.jsxs)("div",{children:[(0,t.jsx)("nav",{children:(0,t.jsx)(v.D,{label:(0,t.jsx)(y.J,{children:(0,t.jsxs)(x.B,{gap:.5,alignItems:"center",children:[(0,t.jsx)("span",{children:(0,t.jsx)(m.x6,{i18nKey:"alerting.state-history.filter-group",children:"Filter group"})}),(0,t.jsx)(j.m,{content:(0,t.jsxs)("div",{children:["Filter each state history group either by exact match or a regular expression, ex:"," ",(0,t.jsx)("code",{children:"region=eu-west-1"})," or ",(0,t.jsx)("code",{children:"/region=us-.+/"})]}),children:(0,t.jsx)(S.I,{name:"info-circle",size:"sm"})})]})}),children:(0,t.jsx)(R.p,{prefix:(0,t.jsx)(S.I,{name:"search"}),onChange:o,placeholder:(0,m.t)("alerting.state-history.placeholder-search","Search")})})}),V]})};function C(e){const n=e.map(s=>{const o=/{.*?}/g,d=s.text.match(o)?.at(-1)??"";return{id:String(s.id),state:s.newState,text:s.text.replace(d,""),data:s.data,timestamp:s.updated,stringifiedLabels:d}});return(0,u.groupBy)(n,s=>s.stringifiedLabels)}function T(e,n){if(n==="")return!0;if(!(n.startsWith("/")&&n.endsWith("/")))return e.includes(n);try{return new RegExp(n.slice(1,-1)).test(e)}catch{return!1}}function H(e){const n=e.data.data?.evalMatches??[];return(0,t.jsxs)(t.Fragment,{children:[e.data.text,(0,t.jsx)(U,{children:n.map(s=>(0,t.jsx)(I.R,{labelKey:s.metric,value:String(s.value)},s.metric))})]})}function F(e){return(0,t.jsx)(z.C,{state:e.data.state})}function N(e){return(0,t.jsx)("div",{className:G,children:e.data.timestamp&&(0,t.jsx)("span",{children:(0,p.LE)(e.data.timestamp)})})}const U=({children:e})=>{const{wrapper:n}=(0,h.of)(L);return(0,t.jsx)("div",{className:n,children:e})},G=(0,i.css)({display:"flex",alignItems:"flex-end",flexDirection:"column"}),L=e=>({wrapper:(0,i.css)({"& > *":{marginRight:e.spacing(1)}}),tableGroupKey:(0,i.css)({marginTop:e.spacing(2),marginBottom:e.spacing(2)}),goupKeyText:(0,i.css)({overflowX:"auto",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"})}),J=b}}]);

//# sourceMappingURL=2835.6eae4ddb04d6089d3fc4.js.map