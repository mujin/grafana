"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4656],{44351:(ne,w,t)=>{t.d(w,{gv:()=>F});var e=t(74848),c=t(2543),$=t.n(c),f=t(43173),v=t(41654),E=t(45861),l=t(15629);const s=f.$.unifiedAlerting.minInterval??"10s",B=((x=s)=>{const M=[(0,l.M9)("10s"),(0,l.M9)("30s"),(0,l.M9)("1m"),(0,l.M9)("5m"),(0,l.M9)("10m"),(0,l.M9)("15m"),(0,l.M9)("30m"),(0,l.M9)("1h")],D=(0,l.P8)(x),K=M.filter(y=>D<=y),q=(0,c.times)(8-K.length,y=>{const z=(0,c.last)(K)??D,R=K.length===0?1:2;return z*R*(y+1)});return[...K,...q].map(l.an)})(s),F=({currentInterval:x,onSelect:C})=>(0,e.jsx)(v.B,{direction:"row",gap:.5,role:"listbox",children:B.map(M=>{const D=x===M;return(0,e.jsx)(E.$n,{role:"option","aria-selected":D,variant:D?"primary":"secondary",size:"sm",onClick:()=>C(M),children:M},M)})})},10321:(ne,w,t)=>{t.d(w,{H$:()=>ye,Ix:()=>fe});var e=t(74848),c=t(22803),$=t(2543),f=t(96540),v=t(49785),E=t(85629),l=t(63142),s=t(41654),p=t(37386),B=t(18857),F=t(31286),x=t(66404),C=t(45861),M=t(3271),D=t(21285),K=t(45967),q=t(30703),y=t(63527),z=t(22787),R=t(72636),a=t(56840),se=t(76944),ue=t(70327),de=t(55143);const ce=r=>ue.hK.endpoints.rulerNamespace.useQuery({namespace:r,rulerConfig:de.b},{refetchOnMountOrArgChange:!0,skip:!r});var k=t(84523),G=t(29609),J=t(15629),ve=t(12266),ge=t(1972);function pe(r){const n=(0,J.P8)(r);return[0,n*1,n*2,n*3,n*4,n*5].map(J.an)}function oe({selectedDuration:r,groupEvaluationInterval:n,onSelect:i}){const o=u=>r===u,d=pe(n);return(0,e.jsx)(s.B,{direction:"row",gap:.5,role:"listbox",children:d.map(u=>(0,e.jsx)(C.$n,{role:"option","aria-selected":o(u),variant:o(u)?"primary":"secondary",size:"sm",onClick:()=>{i(u)},children:u==="0s"?"None":u},u))})}var me=t(44351),b=t(24619);const _=[{value:b.Q8.Alerting,label:"Alerting"},{value:b.Q8.NoData,label:"No Data"},{value:b.Q8.OK,label:"Normal"},{value:b.Q8.Error,label:"Error"},{value:b.Q8.KeepLast,label:"Keep Last State"}],ie=({includeNoData:r,includeError:n,...i})=>{const o=(0,f.useMemo)(()=>r?n?_:_.filter(d=>d.value!==b.Q8.Error):_.filter(d=>d.value!==b.Q8.NoData),[r,n]);return(0,e.jsx)(B.l6,{options:o,...i})};var le=t(25521),he=t(58872);const fe=10,Ne=1e3,xe=(r,n)=>Object.values(r).flat().map(o=>{const d=(0,G.oI)(o);return{label:o.name,value:o.name,description:o.interval??k.T6,isDisabled:n?!1:d,isProvisioned:d}}).sort(je),je=(r,n)=>r.label?.localeCompare(n.label??"")||0,Ee=r=>({required:{value:!0,message:"Required."},validate:n=>{if(n==="0")return!0;try{const i=(0,J.M9)(n);if(i===0)return!0;try{const o=(0,J.M9)(r);return i>=o?!0:(0,a.t)("alerting.rule-form.evaluation-behaviour-for.validation","Pending period must be greater than or equal to the evaluation interval.")}catch{return!0}}catch(i){return i instanceof Error?i.message:(0,a.t)("alerting.rule-form.evaluation-behaviour-for.error-parsing","Failed to parse duration")}}});function ye({existing:r,enableProvisionedGroups:n}){const i=(0,l.of)(X),[o,d]=(0,f.useState)(!1),{watch:u,setValue:g,getValues:I,formState:{errors:j},control:T,register:ee}=(0,v.xW)(),[P,S,te,m,L]=u(["group","type","isPaused","folder","evaluateEvery","keepFiringFor"]),W=(0,G.Mu)(S),Y=(0,G.pq)(S),{currentData:N,isLoading:Z}=ce(m?.uid??""),ae=(0,f.useMemo)(()=>N?xe(N,n):[],[n,N]),A=Object.values(N??{}).flat().find(h=>h.name===P);(0,f.useEffect)(()=>{A&&g("evaluateEvery",A.interval??k.T6)},[A,g]);const[re,Q]=(0,f.useState)(!1),U=(h,V)=>{g("group",h),g("evaluateEvery",V),Q(!1)},Oe=P?{value:P,label:P}:void 0,Ce=Y?(0,a.t)("alerting.rule-form.evaluation.pause.recording","Turn on to pause evaluation for this recording rule."):(0,a.t)("alerting.rule-form.evaluation.pause.alerting","Turn on to pause evaluation for this alert rule."),De=()=>Q(!0),be=(0,G.H2)(S)?4:3,Se=(0,G.H2)(S)&&!m?.uid?(0,a.t)("alerting.rule-form.evaluation.select-folder-before","Select a folder before setting evaluation group and interval"):(0,a.t)("alerting.rule-form.evaluation.evaluation-group-and-interval","Evaluation group and interval");return(0,e.jsxs)(he.P,{stepNo:be,title:(0,a.t)("alerting.grafana-evaluation-behavior-step.title-set-evaluation-behavior","Set evaluation behavior"),description:Te(Y),children:[(0,e.jsxs)(s.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsxs)(s.B,{alignItems:"center",children:[(0,e.jsx)("div",{style:{width:420},children:(0,e.jsx)(p.D,{label:Se,"data-testid":"group-picker",className:i.formInput,error:j.group?.message,invalid:!!j.group?.message,htmlFor:"group",children:(0,e.jsx)(v.xI,{render:({field:{ref:h,...V},fieldState:H})=>(0,e.jsx)(B.l6,{disabled:!m?.uid||Z,inputId:"group",...V,onChange:O=>{V.onChange(O.label??"")},isLoading:Z,invalid:!!m?.uid&&!P&&!!H.error,cacheOptions:!0,loadingMessage:"Loading groups...",defaultValue:Oe,options:ae,getOptionLabel:O=>(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{children:O.label}),O.isProvisioned&&(0,e.jsxs)(e.Fragment,{children:[" ",(0,e.jsx)(ge.rS,{})]})]}),placeholder:(0,a.t)("alerting.grafana-evaluation-behavior-step.placeholder-select-an-evaluation-group","Select an evaluation group...")},(0,$.uniqueId)()),name:"group",control:T,rules:{required:{value:!0,message:"Must enter a group name"}}})})}),(0,e.jsxs)(F.a,{gap:1,display:"flex",alignItems:"center",children:[(0,e.jsx)(x.E,{color:"secondary",children:(0,e.jsx)(a.x6,{i18nKey:"alerting.grafana-evaluation-behavior-step.or",children:"or"})}),(0,e.jsx)(C.$n,{onClick:De,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!m?.uid,"data-testid":E.Tp.components.AlertRules.newEvaluationGroupButton,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.evaluation.new-group",children:"New evaluation group"})})]}),re&&(0,e.jsx)(Ie,{onCreate:U,onClose:()=>Q(!1),groupfoldersForGrafana:N})]}),m?.title&&P&&(0,e.jsx)("div",{className:i.evaluationContainer,children:(0,e.jsx)(s.B,{direction:"column",gap:0,children:(0,e.jsx)("div",{className:i.marginTop,children:(0,e.jsx)(s.B,{direction:"column",gap:1,children:I("group")&&I("evaluateEvery")&&(0,e.jsxs)(a.x6,{i18nKey:"alerting.rule-form.evaluation.group-text",values:{evaluateEvery:L},children:["All rules in the selected group are evaluated every ",{evaluateEvery:L},"."]})})})})}),W&&(0,e.jsx)(Pe,{evaluateEvery:L}),(0,e.jsx)(M.c,{}),W&&(0,e.jsx)(Fe,{evaluateEvery:L}),r&&(0,e.jsx)(p.D,{htmlFor:"pause-alert-switch",children:(0,e.jsx)(v.xI,{render:()=>(0,e.jsxs)(s.B,{gap:1,direction:"row",alignItems:"center",children:[(0,e.jsx)(D.d,{id:"pause-alert",onChange:h=>{g("isPaused",h.currentTarget.checked)},value:!!te}),(0,e.jsxs)("label",{htmlFor:"pause-alert",className:i.switchLabel,children:[(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.pause.label",children:"Pause evaluation"}),(0,e.jsx)(K.m,{placement:"top",content:Ce,theme:"info",children:(0,e.jsx)(q.I,{tabIndex:0,name:"info-circle",size:"sm",className:i.infoIcon})})]})]}),name:"isPaused"})})]}),W&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ve.e,{isCollapsed:!o,onToggle:h=>d(!h),text:(0,a.t)("alerting.grafana-evaluation-behavior-step.text-configure-no-data-and-error-handling","Configure no data and error handling")}),o&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Me,{}),(0,e.jsx)(p.D,{htmlFor:"no-data-state-input",label:(0,a.t)("alerting.alert.state-no-data","Alert state if no data or all values are null"),children:(0,e.jsx)(v.xI,{render:({field:{onChange:h,ref:V,...H}})=>(0,e.jsx)(ie,{...H,inputId:"no-data-state-input",width:42,includeNoData:!0,includeError:!1,onChange:O=>h(O?.value)}),name:"noDataState"})}),(0,e.jsx)(p.D,{htmlFor:"exec-err-state-input",label:(0,a.t)("alerting.alert.state-error-timeout","Alert state if execution error or timeout"),children:(0,e.jsx)(v.xI,{render:({field:{onChange:h,ref:V,...H}})=>(0,e.jsx)(ie,{...H,inputId:"exec-err-state-input",width:42,includeNoData:!1,includeError:!0,onChange:O=>h(O?.value)}),name:"execErrState"})}),(0,e.jsx)(p.D,{label:(0,a.t)("alerting.alert.missing-series-resolve","Missing series evaluations to resolve"),description:(0,a.t)("alerting.alert.description-missing-series-evaluations","How many consecutive evaluation intervals with no data for a dimension must pass before the alert state is considered stale and automatically resolved. If no value is provided, the value will default to 2."),invalid:!!j.missingSeriesEvalsToResolve?.message,error:j.missingSeriesEvalsToResolve?.message,className:i.inlineField,htmlFor:"missing-series-resolve",children:(0,e.jsx)(y.p,{placeholder:(0,a.t)("alerting.grafana-evaluation-behavior-step.missing-series-resolve-placeholder","Default: 2"),id:"missing-series-resolve",...ee("missingSeriesEvalsToResolve",{pattern:{value:/^\d+$/,message:"Must be a positive integer."}}),width:21})})]})]})]})}function Ie({onClose:r,onCreate:n,groupfoldersForGrafana:i}){const o=(0,l.of)(X),{watch:d}=(0,v.xW)(),u="eval-every-input",g="new-eval-group-name",[I,j,T]=d(["group","folder.title","type"]),ee=T?(0,G.pq)(T):!1,P=(0,v.mN)({defaultValues:{group:"",evaluateEvery:k.T6},mode:"onChange",shouldFocusError:!0}),{register:S,handleSubmit:te,formState:m,setValue:L,getValues:W,watch:Y}=P,N=Y("evaluateEvery"),Z=(i&&i[j]?.find(U=>U.name===I)?.rules)??[],ae=()=>{n(W("group"),W("evaluateEvery"))},A=()=>{r()},re=U=>{L("evaluateEvery",U,{shouldValidate:!0})},Q=ee?(0,a.t)("alerting.folderAndGroup.evaluation.modal.text.recording","Create a new evaluation group to use for this recording rule."):(0,a.t)("alerting.folderAndGroup.evaluation.modal.text.alerting","Create a new evaluation group to use for this alert rule.");return(0,e.jsxs)(z.a,{className:o.modal,isOpen:!0,title:(0,a.t)("alerting.evaluation-group-creation-modal.title-new-evaluation-group","New evaluation group"),onDismiss:A,onClickBackdrop:A,children:[(0,e.jsx)("div",{className:o.modalTitle,children:Q}),(0,e.jsx)(v.Op,{...P,children:(0,e.jsxs)("form",{onSubmit:te(()=>ae()),children:[(0,e.jsx)(p.D,{label:(0,e.jsx)(R.J,{htmlFor:g,description:"A group evaluates all its rules over the same evaluation interval.",children:(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.evaluation.group-name",children:"Evaluation group name"})}),error:m.errors.group?.message,invalid:!!m.errors.group,children:(0,e.jsx)(y.p,{"data-testid":E.Tp.components.AlertRules.newEvaluationGroupName,className:o.formInput,autoFocus:!0,id:g,placeholder:(0,a.t)("alerting.evaluation-group-creation-modal.placeholder-enter-a-name","Enter a name"),...S("group",{required:{value:!0,message:"Required."}})})}),(0,e.jsx)(p.D,{error:m.errors.evaluateEvery?.message,label:(0,e.jsx)(R.J,{htmlFor:u,description:(0,a.t)("alerting.evaluation-group-creation-modal.description-often-rules-group-evaluated","How often all rules in the group are evaluated."),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.evaluation.group.interval",children:"Evaluation interval"})}),invalid:!!m.errors.evaluateEvery,children:(0,e.jsx)(y.p,{"data-testid":E.Tp.components.AlertRules.newEvaluationGroupInterval,className:o.formInput,id:u,placeholder:k.T6,...S("evaluateEvery",(0,se.i)(Z))})}),(0,e.jsx)(me.gv,{currentInterval:N,onSelect:re}),(0,e.jsxs)(z.a.ButtonRow,{children:[(0,e.jsx)(C.$n,{variant:"secondary",type:"button",onClick:A,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.evaluation.group.cancel",children:"Cancel"})}),(0,e.jsx)(C.$n,{type:"submit",disabled:!m.isValid,"data-testid":E.Tp.components.AlertRules.newEvaluationGroupCreate,children:(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.evaluation.group.create",children:"Create"})})]})]})})]})}function Pe({evaluateEvery:r}){const n=(0,l.of)(X),{register:i,formState:{errors:o},setValue:d,watch:u}=(0,v.xW)(),g="eval-for-input",I=u("evaluateFor"),j=T=>{d("evaluateFor",T)};return(0,e.jsxs)(s.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsx)(p.D,{label:(0,e.jsx)(R.J,{htmlFor:g,description:'Period during which the threshold condition must be met to trigger an alert. Selecting "None" triggers the alert immediately once the condition is met.',children:(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour.pending-period",children:"Pending period"})}),className:n.inlineField,error:o.evaluateFor?.message,invalid:o.evaluateFor?.message?!0:void 0,validationMessageHorizontalOverflow:!0,children:(0,e.jsx)(y.p,{id:g,width:8,...i("evaluateFor",Ee(r))})}),(0,e.jsx)(oe,{selectedDuration:I,groupEvaluationInterval:r,onSelect:j})]})}function Fe({evaluateEvery:r}){const n=(0,l.of)(X),{register:i,formState:{errors:o},setValue:d,watch:u}=(0,v.xW)(),g=u("keepFiringFor"),I="keep-firing-for-input",j=T=>{d("keepFiringFor",T)};return(0,e.jsxs)(s.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsx)(p.D,{label:(0,e.jsx)(R.J,{htmlFor:I,description:(0,a.t)("alerting.rule-form.evaluation-behaviour.keep-firing-for.label-description",'Period during which the alert will continue to show up as firing even though the threshold condition is no longer breached. Selecting "None" means the alert will be back to normal immediately.'),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour.keep-firing-for.label-text",children:"Keep firing for"})}),className:n.inlineField,error:o.keepFiringFor?.message,invalid:o.keepFiringFor?.message?!0:void 0,validationMessageHorizontalOverflow:!0,children:(0,e.jsx)(y.p,{id:I,width:8,...i("keepFiringFor")})}),(0,e.jsx)(oe,{selectedDuration:g,groupEvaluationInterval:r,onSelect:j})]})}function Me(){return(0,e.jsxs)(s.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(x.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour.info-help.text",children:"Define the alert behavior when the evaluation fails or the query returns no data."})}),(0,e.jsx)(le.G,{contentText:(0,a.t)("alerting.rule-form.evaluation-behaviour.info-help.content","These settings can help mitigate temporary data source issues, preventing alerts from unintentionally firing due to lack of data, errors, or timeouts."),externalLink:"https://grafana.com/docs/grafana/latest/alerting/alerting-rules/create-grafana-managed-rule/#configure-no-data-and-error-handling",linkText:(0,a.t)("alerting.rule-form.evaluation-behaviour.info-help.link-text","Read more about this option"),title:(0,a.t)("alerting.rule-form.evaluation-behaviour.info-help.link-title","Configure no data and error handling")})]})}function Te(r){return(0,e.jsxs)(s.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(x.E,{variant:"bodySmall",color:"secondary",children:r?(0,e.jsx)(a.x6,{i18nKey:"alerting.alert-recording-rule-form.evaluation-behaviour.description.text",children:"Define how the recording rule is evaluated."}):(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour.description.text",children:"Define how the alert rule is evaluated."})}),(0,e.jsx)(le.G,{contentText:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour-description1",children:"Evaluation groups are containers for evaluating alert and recording rules."})}),(0,e.jsx)("p",{children:(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour-description2",children:"An evaluation group defines an evaluation interval - how often a rule is evaluated. Alert rules within the same evaluation group are evaluated over the same evaluation interval."})}),(0,e.jsx)("p",{children:(0,e.jsx)(a.x6,{i18nKey:"alerting.rule-form.evaluation-behaviour-description3",children:"Pending period specifies how long the threshold condition must be met before the alert starts firing. This option helps prevent alerts from being triggered by temporary issues."})})]}),externalLink:"https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/rule-evaluation/",linkText:(0,a.t)("alerting.rule-form.evaluation-behaviour.info-help2.link-text","Read about evaluation and alert states"),title:(0,a.t)("alerting.rule-form.evaluation-behaviour.info-help2.link-title","Alert rule evaluation")})]})}const X=r=>({inlineField:(0,c.css)({marginBottom:0}),evaluationContainer:(0,c.css)({color:r.colors.text.secondary,maxWidth:`${r.breakpoints.values.sm}px`,fontSize:r.typography.size.sm}),infoIcon:(0,c.css)({marginLeft:"10px"}),marginTop:(0,c.css)({marginTop:r.spacing(1)}),switchLabel:(0,c.css)({color:r.colors.text.primary,cursor:"pointer",fontSize:r.typography.bodySmall.fontSize}),formInput:(0,c.css)({flexGrow:1}),modal:(0,c.css)({width:`${r.breakpoints.values.sm}px`}),modalTitle:(0,c.css)({color:r.colors.text.secondary,marginBottom:r.spacing(2)})})},76944:(ne,w,t)=>{t.d(w,{i:()=>v});var e=t(10321),c=t(11018),$=t(29609),f=t(15629);const v=E=>({required:{value:!0,message:"Required."},validate:l=>{try{const s=(0,f.M9)(l);if(s<e.Ix*1e3)return`Cannot be less than ${e.Ix} seconds.`;if(s%(e.Ix*1e3)!==0)return`Must be a multiple of ${e.Ix} seconds.`;if((0,c.uQ)(E,l).length===0)return!0;{const p=E.map(F=>{const{forDuration:x}=(0,$.jg)(F,l);return x?(0,f.P8)(x):null}),B=Math.min(...p.filter(F=>F!==null&&F!==0));return`Evaluation interval should be smaller or equal to "pending period" values for existing rules in this rule group. Choose a value smaller than or equal to "${(0,f.an)(B)}".`}}catch(s){return s instanceof Error?s.message:"Failed to parse duration"}}})}}]);

//# sourceMappingURL=4656.6da008b6d3bdc705155f.js.map