"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2472],{74410:(M,P,s)=>{s.d(P,{l:()=>L});var e=s(74848),h=s(22803),y=s(96540),b=s(49785);function L({defaultValues:T,onSubmit:S,validateOnMount:E=!1,validateFieldsOnMount:g,children:v,validateOn:j="onSubmit",maxWidth:c=600,...U}){const{handleSubmit:n,trigger:p,formState:I,...O}=(0,b.mN)({mode:j,defaultValues:T});return(0,y.useEffect)(()=>{E&&p(g)},[p,g,E]),(0,e.jsx)("form",{className:(0,h.css)({maxWidth:c!=="none"?c+"px":c,width:"100%"}),onSubmit:n(S),...U,children:v({errors:I.errors,formState:I,trigger:p,...O})})}},67521:(M,P,s)=>{s.r(P),s.d(P,{UserProfileEditPage:()=>Q,default:()=>le});var e=s(74848),h=s(71468),y=s(4392),b=s(54092),L=s(33604),T=s(41654),S=s(13791),E=s(13126),g=s(96540),v=s(85629),j=s(6975),c=s(92807),U=s(45861),n=s(56840);class p extends g.PureComponent{render(){const{isLoading:u,orgs:d,user:l}=this.props;return u?(0,e.jsx)(j._,{text:(0,n.t)("profile.user-organizations.text-loading-organizations","Loading organizations...")}):d.length===0?null:(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:(0,e.jsx)(n.x6,{i18nKey:"user-orgs.title",children:"Organizations"})}),(0,e.jsx)(c.P,{overflowY:"visible",overflowX:"auto",width:"100%",children:(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":v.Tp.components.UserProfile.orgsTable,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-orgs.name-column",children:"Name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-orgs.role-column",children:"Role"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:d.map((o,i)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:o.name}),(0,e.jsx)("td",{children:o.role}),(0,e.jsx)("td",{className:"text-right",children:o.orgId===l?.orgId?(0,e.jsx)(U.$n,{variant:"secondary",size:"sm",disabled:!0,children:(0,e.jsx)(n.x6,{i18nKey:"user-orgs.current-org-button",children:"Current"})}):(0,e.jsx)(U.$n,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(o)},children:(0,e.jsx)(n.x6,{i18nKey:"user-orgs.select-org-button",children:"Select organisation"})})})]},i))})]})})]})}}const I=p;var O=s(16780),K=s(37386),N=s(63527),D=s(45967),C=s(30703),r=s(74410),a=s(65642);const{disableLoginForm:z}=a.Ay,W=({user:t,isSavingUser:u,updateProfile:d})=>{const l=f=>{d(f)},o=(t&&t.isExternal)??!1;let i=o&&t&&t.authLabels?t.authLabels[0]:"";t?.isProvisioned&&(i="SCIM");const x=i?` (Synced via ${i})`:"",m=z||o;return(0,e.jsx)(r.l,{onSubmit:l,validateOn:"onBlur",children:({register:f,errors:A})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(O.n,{children:[(0,e.jsx)(K.D,{label:(0,n.t)("user-profile.fields.name-label","Name")+x,invalid:!!A.name,error:(0,e.jsx)(n.x6,{i18nKey:"user-profile.fields.name-error",children:"Name is required"}),disabled:m,children:(0,e.jsx)(N.p,{...f("name",{required:!0}),id:"edit-user-profile-name",placeholder:(0,n.t)("user-profile.fields.name-label","Name"),defaultValue:t?.name??"",suffix:(0,e.jsx)(F,{})})}),(0,e.jsx)(K.D,{label:(0,n.t)("user-profile.fields.email-label","Email")+x,invalid:!!A.email,error:(0,e.jsx)(n.x6,{i18nKey:"user-profile.fields.email-error",children:"Email is required"}),disabled:m,children:(0,e.jsx)(N.p,{...f("email",{required:!0}),id:"edit-user-profile-email",placeholder:(0,n.t)("user-profile.fields.email-label","Email"),defaultValue:t?.email??"",suffix:(0,e.jsx)(F,{})})}),(0,e.jsx)(K.D,{label:(0,n.t)("user-profile.fields.username-label","Username")+x,disabled:m,children:(0,e.jsx)(N.p,{...f("login"),id:"edit-user-profile-username",defaultValue:t?.login??"",placeholder:(0,n.t)("user-profile.fields.username-label","Username")+x,suffix:(0,e.jsx)(F,{})})})]}),(0,e.jsx)(U.$n,{variant:"primary",disabled:u||m,"data-testid":v.Tp.components.UserProfile.profileSaveButton,type:"submit",children:(0,e.jsx)(n.x6,{i18nKey:"common.save",children:"Save"})})]})})},F=()=>z?(0,e.jsx)(D.m,{content:"Login details locked because they are managed in another system.",children:(0,e.jsx)(C.I,{name:"lock"})}):null;var Y=s(54314),V=s(60208),G=s(13941),X=s(70958);const w="tab",R="general";function H(t){const{children:u,components:d}=t,l=J(d,u),[o,i]=Z(l);return d.length>0===!1?(0,e.jsx)(e.Fragment,{children:u}):(0,e.jsx)("div",{"data-testid":v.Tp.components.UserProfile.extensionPointTabs,children:(0,e.jsxs)(T.B,{direction:"column",gap:2,children:[(0,e.jsx)(Y.U,{children:Object.values(l).map(({tabId:m,title:f})=>(0,e.jsx)(V.o,{label:f,active:o?.tabId===m,onChangeTab:()=>i(m),"data-testid":v.Tp.components.UserProfile.extensionPointTab(m)},m))}),(0,e.jsx)(G.J,{children:!!o&&(0,e.jsx)(g.Fragment,{children:o?.components.map((m,f)=>(0,e.jsx)(m,{},`${o?.tabId}-${f}`))},o?.tabId)})]})})}function J(t,u){return(0,g.useMemo)(()=>{const d={[R]:{title:(0,n.t)("user-profile.tabs.general","General"),tabId:R,components:[()=>(0,e.jsx)(e.Fragment,{children:u})]}};return t.reduce((l,o)=>{const{title:i}=o.meta,x=$(i);return l[x]||(l[x]={title:i,tabId:x,components:[]}),l[x].components.push(o),l},d)},[t,u])}function Z(t){const[u,d]=(0,X.s)(),l=k(u[w]),o=t[l],i=(0,g.useCallback)(x=>d({[w]:x}),[d]);return[o,i]}function k(t){return typeof t!="string"?R:$(t)}function $(t){return t.toLowerCase()}var q=s(22803),_=s(11297),ee=s(12810);class se extends g.PureComponent{render(){const{isLoading:u,sessions:d,revokeUserSession:l}=this.props,o=ne();return u?(0,e.jsx)(j._,{text:(0,e.jsx)(n.x6,{i18nKey:"user-sessions.loading",children:"Loading sessions..."})}):(0,e.jsx)("div",{className:o.wrapper,children:d.length>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:(0,e.jsx)(n.x6,{i18nKey:"profile.user-sessions.sessions",children:"Sessions"})}),(0,e.jsx)(c.P,{overflowY:"visible",overflowX:"auto",width:"100%",children:(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":v.Tp.components.UserProfile.sessionsTable,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-session.seen-at-column",children:"Last seen"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-session.created-at-column",children:"Logged on"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-session.ip-column",children:"IP address"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-session.browser-column",children:"Browser & OS"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"user-session.identity-provider-column",children:"Identity Provider"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:d.map((i,x)=>(0,e.jsxs)("tr",{children:[i.isActive?(0,e.jsx)("td",{children:(0,e.jsx)(n.x6,{i18nKey:"profile.user-sessions.now",children:"Now"})}):(0,e.jsx)("td",{children:i.seenAt}),(0,e.jsx)("td",{children:(0,ee.Y)(i.createdAt,{dateStyle:"long"})}),(0,e.jsx)("td",{children:i.clientIp}),(0,e.jsx)("td",{children:(0,e.jsxs)(n.x6,{i18nKey:"profile.user-sessions.browser-details",values:{browser:i.browser,os:i.os,osVersion:i.osVersion},children:["{{browser}}"," on ","{{os}}"," ","{{osVersion}}"]})}),(0,e.jsx)("td",{children:i.authModule&&(0,e.jsx)(_.E,{label:i.authModule,removeIcon:!1,count:0})}),(0,e.jsx)("td",{children:(0,e.jsx)(U.$n,{size:"sm",variant:"destructive",tooltip:(0,n.t)("user-session.revoke","Revoke user session"),onClick:()=>l(i.id),"aria-label":(0,n.t)("user-session.revoke","Revoke user session"),children:(0,e.jsx)(C.I,{name:"power"})})})]},x))})]})})]})})}}const ne=()=>({wrapper:(0,q.css)({maxWidth:"100%"})}),re=se;class te extends g.PureComponent{render(){const{isLoading:u,teams:d}=this.props;return u?(0,e.jsx)(j._,{text:(0,n.t)("profile.user-teams.text-loading-teams","Loading teams...")}):d.length===0?null:(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"page-sub-heading",children:(0,e.jsx)(n.x6,{i18nKey:"profile.user-teams.teams",children:"Teams"})}),(0,e.jsxs)("table",{className:"filter-table form-inline","aria-label":(0,n.t)("profile.user-teams.aria-label-user-teams-table","User teams table"),children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"profile.user-teams.name",children:"Name"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"profile.user-teams.email",children:"Email"})}),(0,e.jsx)("th",{children:(0,e.jsx)(n.x6,{i18nKey:"profile.user-teams.members",children:"Members"})})]})}),(0,e.jsx)("tbody",{children:d.map((l,o)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"width-4 text-center",children:(0,e.jsx)("img",{className:"filter-table__avatar",src:l.avatarUrl,alt:""})}),(0,e.jsx)("td",{children:l.name}),(0,e.jsx)("td",{children:l.email}),(0,e.jsx)("td",{children:l.memberCount})]},o))})]})]})}}const fe=null;var B=s(88482);function ie(t){const u=t.user,{user:d,teams:l,orgs:o,sessions:i,teamsAreLoading:x,orgsAreLoading:m,sessionsAreLoading:f,isUpdating:A}=u;return{orgsAreLoading:m,sessionsAreLoading:f,teamsAreLoading:x,orgs:o,sessions:i,teams:l,isUpdating:A,user:d}}const oe={initUserProfilePage:B.Qe,revokeUserSession:B._O,changeUserOrg:B.Aj,updateUserProfile:B.eg},ae=(0,h.connect)(ie,oe);function Q({orgsAreLoading:t,sessionsAreLoading:u,teamsAreLoading:d,initUserProfilePage:l,orgs:o,sessions:i,teams:x,isUpdating:m,user:f,revokeUserSession:A,changeUserOrg:de,updateUserProfile:ce}){(0,y.A)(()=>l());const{components:ue,isLoading:xe}=(0,L.f)({extensionPointId:b.S.UserProfileTab});return(0,e.jsx)(S.Y,{navId:"profile/settings",children:(0,e.jsx)(S.Y.Contents,{isLoading:!f||xe,children:(0,e.jsx)(H,{components:ue,children:(0,e.jsxs)(T.B,{direction:"column",gap:2,"data-testid":"user-profile-edit-page",children:[(0,e.jsx)(W,{updateProfile:ce,isSavingUser:m,user:f}),(0,e.jsx)(E.A,{resourceUri:"user",preferenceType:"user"}),(0,e.jsxs)(T.B,{direction:"column",gap:6,children:[(0,e.jsx)(te,{isLoading:d,teams:x}),(0,e.jsx)(I,{isLoading:t,setUserOrg:de,orgs:o,user:f}),(0,e.jsx)(re,{isLoading:u,revokeUserSession:A,sessions:i})]})]})})})})}const le=ae(Q)},88482:(M,P,s)=>{s.d(P,{ec:()=>U,Aj:()=>D,Qe:()=>n,YW:()=>p,_O:()=>N,eg:()=>C});var e=s(43173),h=s(68143);async function y(r){try{await(0,h.AI)().put("/api/user/password",r)}catch(a){console.error(a)}}function b(){return(0,h.AI)().get("/api/user")}function L(){return(0,h.AI)().get("/api/user/teams")}function T(){return(0,h.AI)().get("/api/user/orgs")}function S(){return(0,h.AI)().get("/api/user/auth-tokens")}async function E(r){await(0,h.AI)().post("/api/user/revoke-auth-token",{authTokenId:r})}async function g(r){await(0,h.AI)().post("/api/user/using/"+r.orgId,{})}async function v(r){try{await(0,h.AI)().put("/api/user",r)}catch(a){console.error(a)}}const j={changePassword:y,revokeUserSession:E,loadUser:b,loadSessions:S,loadOrgs:T,loadTeams:L,setUserOrg:g,updateUserProfile:v};var c=s(69289);function U(r){return async function(a){a((0,c.Nm)({updating:!0})),await j.changePassword(r),a((0,c.Nm)({updating:!1}))}}function n(){return async function(r){await r(p()),r(I()),r(O()),r(K())}}function p(){return async function(r){const a=await j.loadUser();r((0,c.HO)({user:a}))}}function I(){return async function(r){r((0,c.ri)());const a=await j.loadTeams();r((0,c.Q9)({teams:a}))}}function O(){return async function(r){r((0,c.Mj)());const a=await j.loadOrgs();r((0,c.ny)({orgs:a}))}}function K(){return async function(r){r((0,c.uh)());const a=await j.loadSessions();r((0,c.RS)({sessions:a}))}}function N(r){return async function(a){a((0,c.Nm)({updating:!0})),await j.revokeUserSession(r),a((0,c.g$)({tokenId:r}))}}function D(r){return async function(a){a((0,c.Nm)({updating:!0})),await j.setUserOrg(r),window.location.href=e.$.appSubUrl+"/profile"}}function C(r){return async function(a){a((0,c.Nm)({updating:!0})),await j.updateUserProfile(r),await a(p()),a((0,c.Nm)({updating:!1}))}}},4392:(M,P,s)=>{s.d(P,{A:()=>y});var e=s(94701),h=function(b){(0,e.A)(function(){b()})};const y=h}}]);

//# sourceMappingURL=UserProfileEditPage.8a10d937d06d0ecb7d87.js.map