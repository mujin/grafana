"use strict";(globalThis.webpackChunkgrafana_postgresql_datasource=globalThis.webpackChunkgrafana_postgresql_datasource||[]).push([[168],{1071:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Ot});var r=a(9728),n=a(5959),o=a(5489),i=a(624),s=a(2007),l=a(136),d=a(3277),u=a(4519),c=a(6508);function p(e,t="latest"){return b(e,t.replace(/\-.*/,""))}function b(e,t){const a={};for(const[r,n]of Object.entries(e))m(n)?a[r]=b(n,t):(h(n,r),a[r]=g(n,t));return a}function m(e){if("object"==typeof e){const[t]=Object.keys(e);return!(0,c.valid)(t)}return!1}function g(e,t){let a,r=Object.keys(e).sort(c.compare);if("latest"===t)return e[r[r.length-1]];for(const e of r)(0,c.gte)(t,e)&&(a=e);return a||(a=r[r.length-1]),e[a]}function h(e,t){if(!Object.keys(e).every((e=>(0,c.valid)(e))))throw new Error(`Invalid semver version: '${t}'`)}const y="8.5.0",v={RadioButton:{container:{"10.2.3":"data-testid radio-button"}},Breadcrumbs:{breadcrumb:{"9.4.0":e=>`data-testid ${e} breadcrumb`}},TimePicker:{openButton:{[y]:"data-testid TimePicker Open Button"},overlayContent:{"10.2.3":"data-testid TimePicker Overlay Content"},fromField:{"10.2.3":"data-testid Time Range from field",[y]:"Time Range from field"},toField:{"10.2.3":"data-testid Time Range to field",[y]:"Time Range to field"},applyTimeRange:{[y]:"data-testid TimePicker submit button"},copyTimeRange:{"10.4.0":"data-testid TimePicker copy button"},pasteTimeRange:{"10.4.0":"data-testid TimePicker paste button"},calendar:{label:{"10.2.3":"data-testid Time Range calendar",[y]:"Time Range calendar"},openButton:{"10.2.3":"data-testid Open time range calendar",[y]:"Open time range calendar"},closeButton:{"10.2.3":"data-testid Close time range Calendar",[y]:"Close time range Calendar"}},absoluteTimeRangeTitle:{[y]:"data-testid-absolute-time-range-narrow"}},DataSourcePermissions:{form:{"9.5.0":()=>'form[name="addPermission"]'},roleType:{"9.5.0":"Role to add new permission to"},rolePicker:{"9.5.0":"Built-in role picker"},permissionLevel:{"12.0.0":"Permission level","9.5.0":"Permission Level"}},DateTimePicker:{input:{"10.2.3":"data-testid date-time-input"}},DataSource:{TestData:{QueryTab:{scenarioSelectContainer:{[y]:"Test Data Query scenario select container"},scenarioSelect:{[y]:"Test Data Query scenario select"},max:{[y]:"TestData max"},min:{[y]:"TestData min"},noise:{[y]:"TestData noise"},seriesCount:{[y]:"TestData series count"},spread:{[y]:"TestData spread"},startValue:{[y]:"TestData start value"},drop:{[y]:"TestData drop values"}}},DataSourceHttpSettings:{urlInput:{"10.4.0":"data-testid Datasource HTTP settings url",[y]:"Datasource HTTP settings url"}},Jaeger:{traceIDInput:{[y]:"Trace ID"}},Prometheus:{configPage:{connectionSettings:{[y]:"Data source connection URL"},manageAlerts:{"10.4.0":"prometheus-alerts-manager"},scrapeInterval:{"10.4.0":"data-testid scrape interval"},queryTimeout:{"10.4.0":"data-testid query timeout"},defaultEditor:{"10.4.0":"data-testid default editor"},disableMetricLookup:{"10.4.0":"disable-metric-lookup"},prometheusType:{"10.4.0":"data-testid prometheus type"},prometheusVersion:{"10.4.0":"data-testid prometheus version"},cacheLevel:{"10.4.0":"data-testid cache level"},incrementalQuerying:{"10.4.0":"prometheus-incremental-querying"},queryOverlapWindow:{"10.4.0":"data-testid query overlap window"},disableRecordingRules:{"10.4.0":"disable-recording-rules"},customQueryParameters:{"10.4.0":"data-testid custom query parameters"},httpMethod:{"10.4.0":"data-testid http method"},exemplarsAddButton:{"10.3.0":"data-testid Add exemplar config button",[y]:"Add exemplar config button"},internalLinkSwitch:{"10.3.0":"data-testid Internal link switch",[y]:"Internal link switch"},codeModeMetricNamesSuggestionLimit:{"11.1.0":"data-testid code mode metric names suggestion limit"}},queryEditor:{explain:{"10.4.0":"data-testid prometheus explain switch wrapper"},editorToggle:{"10.4.0":"data-testid QueryEditorModeToggle"},options:{"10.4.0":"data-testid prometheus options"},legend:{"10.4.0":"data-testid prometheus legend wrapper"},format:{"10.4.0":"data-testid prometheus format"},step:{"10.4.0":"prometheus-step"},type:{"10.4.0":"data-testid prometheus type"},exemplars:{"10.4.0":"prometheus-exemplars"},builder:{metricSelect:{"10.4.0":"data-testid metric select"},hints:{"10.4.0":"data-testid prometheus hints"},metricsExplorer:{"10.4.0":"data-testid metrics explorer"},queryAdvisor:{"10.4.0":"data-testid query advisor"}},code:{queryField:{"10.4.0":"data-testid prometheus query field"},metricsCountInfo:{"11.1.0":"data-testid metrics count disclaimer"},metricsBrowser:{openButton:{"10.4.0":"data-testid open metrics browser"},selectMetric:{"10.4.0":"data-testid select a metric"},seriesLimit:{"10.3.1":"data-testid series limit"},metricList:{"10.4.0":"data-testid metric list"},labelNamesFilter:{"10.4.0":"data-testid label names filter"},labelValuesFilter:{"10.4.0":"data-testid label values filter"},useQuery:{"10.4.0":"data-testid use query"},useAsRateQuery:{"10.4.0":"data-testid use as rate query"},validateSelector:{"10.4.0":"data-testid validate selector"},clear:{"10.4.0":"data-testid clear"}}}},exemplarMarker:{"10.3.0":"data-testid Exemplar marker",[y]:"Exemplar marker"},variableQueryEditor:{queryType:{"10.4.0":"data-testid query type"},labelnames:{metricRegex:{"10.4.0":"data-testid label names metric regex"}},labelValues:{labelSelect:{"10.4.0":"data-testid label values label select"}},metricNames:{metricRegex:{"10.4.0":"data-testid metric names metric regex"}},varQueryResult:{"10.4.0":"data-testid variable query result"},seriesQuery:{"10.4.0":"data-testid prometheus series query"},classicQuery:{"10.4.0":"data-testid prometheus classic query"}},annotations:{minStep:{"10.4.0":"prometheus-annotation-min-step"},title:{"10.4.0":"data-testid prometheus annotation title"},tags:{"10.4.0":"data-testid prometheus annotation tags"},text:{"10.4.0":"data-testid prometheus annotation text"},seriesValueAsTimestamp:{"10.4.0":"data-testid prometheus annotation series value as timestamp"}}}},Menu:{MenuComponent:{[y]:e=>`${e} menu`},MenuGroup:{[y]:e=>`${e} menu group`},MenuItem:{[y]:e=>`${e} menu item`},SubMenu:{container:{"10.3.0":"data-testid SubMenu container",[y]:"SubMenu container"},icon:{"10.3.0":"data-testid SubMenu icon",[y]:"SubMenu icon"}}},Panels:{Panel:{title:{[y]:e=>`data-testid Panel header ${e}`},content:{"11.1.0":"data-testid panel content"},headerItems:{"10.2.0":e=>`data-testid Panel header item ${e}`},menuItems:{"9.5.0":e=>`data-testid Panel menu item ${e}`},menu:{"9.5.0":e=>`data-testid Panel menu ${e}`},containerByTitle:{[y]:e=>`${e} panel`},headerCornerInfo:{[y]:e=>`Panel header ${e}`},status:{"10.2.0":e=>`data-testid Panel status ${e}`,[y]:e=>"Panel status"},loadingBar:{"10.0.0":()=>"Panel loading bar"},HoverWidget:{container:{"10.1.0":"data-testid hover-header-container",[y]:"hover-header-container"},dragIcon:{"10.0.0":"data-testid drag-icon"}},PanelDataErrorMessage:{"10.4.0":"data-testid Panel data error message"}},Visualization:{Graph:{container:{"9.5.0":"Graph container"},VisualizationTab:{legendSection:{[y]:"Legend section"}},Legend:{legendItemAlias:{[y]:e=>`gpl alias ${e}`},showLegendSwitch:{[y]:"gpl show legend"}},xAxis:{labels:{[y]:()=>"div.flot-x-axis > div.flot-tick-label"}}},BarGauge:{valueV2:{[y]:"data-testid Bar gauge value"}},PieChart:{svgSlice:{"10.3.0":"data testid Pie Chart Slice"}},Text:{container:{[y]:()=>".markdown-html"}},Table:{header:{[y]:"table header"},footer:{[y]:"table-footer"},body:{"10.2.0":"data-testid table body"}}}},VizLegend:{seriesName:{"10.3.0":e=>`data-testid VizLegend series ${e}`}},Drawer:{General:{title:{[y]:e=>`Drawer title ${e}`},expand:{[y]:"Drawer expand"},contract:{[y]:"Drawer contract"},close:{"10.3.0":"data-testid Drawer close",[y]:"Drawer close"},rcContentWrapper:{"9.4.0":()=>".rc-drawer-content-wrapper"},subtitle:{"10.4.0":"data-testid drawer subtitle"}},DashboardSaveDrawer:{saveButton:{"11.1.0":"data-testid Save dashboard drawer button"},saveAsButton:{"11.1.0":"data-testid Save as dashboard drawer button"},saveAsTitleInput:{"11.1.0":"Save dashboard title field"}}},PanelEditor:{General:{content:{"11.1.0":"data-testid Panel editor content","8.0.0":"Panel editor content"}},OptionsPane:{content:{"11.1.0":"data-testid Panel editor option pane content",[y]:"Panel editor option pane content"},select:{[y]:"Panel editor option pane select"},fieldLabel:{[y]:e=>`${e} field property editor`},fieldInput:{"11.0.0":e=>`data-testid Panel editor option pane field input ${e}`}},DataPane:{content:{"11.1.0":"data-testid Panel editor data pane content",[y]:"Panel editor data pane content"}},applyButton:{"9.2.0":"data-testid Apply changes and go back to dashboard","9.1.0":"Apply changes and go back to dashboard","8.0.0":"panel editor apply"},toggleVizPicker:{"10.0.0":"data-testid toggle-viz-picker","8.0.0":"toggle-viz-picker"},toggleVizOptions:{"10.1.0":"data-testid toggle-viz-options",[y]:"toggle-viz-options"},toggleTableView:{"11.1.0":"data-testid toggle-table-view",[y]:"toggle-table-view"},showZoomField:{"10.2.0":"Map controls Show zoom control field property editor"},showAttributionField:{"10.2.0":"Map controls Show attribution field property editor"},showScaleField:{"10.2.0":"Map controls Show scale field property editor"},showMeasureField:{"10.2.0":"Map controls Show measure tools field property editor"},showDebugField:{"10.2.0":"Map controls Show debug field property editor"},measureButton:{"9.2.0":"show measure tools"}},PanelInspector:{Data:{content:{[y]:"Panel inspector Data content"}},Stats:{content:{[y]:"Panel inspector Stats content"}},Json:{content:{"11.1.0":"data-testid Panel inspector Json content",[y]:"Panel inspector Json content"}},Query:{content:{[y]:"Panel inspector Query content"},refreshButton:{[y]:"Panel inspector Query refresh button"},jsonObjectKeys:{[y]:()=>".json-formatter-key"}}},Tab:{title:{"11.2.0":e=>`data-testid Tab ${e}`},active:{[y]:()=>'[class*="-activeTabStyle"]'}},RefreshPicker:{runButtonV2:{[y]:"data-testid RefreshPicker run button"},intervalButtonV2:{[y]:"data-testid RefreshPicker interval button"}},QueryTab:{content:{[y]:"Query editor tab content"},queryInspectorButton:{[y]:"Query inspector button"},queryHistoryButton:{"10.2.0":"data-testid query-history-button",[y]:"query-history-button"},addQuery:{"10.2.0":"data-testid query-tab-add-query",[y]:"Query editor add query button"},addQueryFromLibrary:{"11.5.0":"data-testid query-tab-add-query-from-library"},queryGroupTopSection:{"11.2.0":"data-testid query group top section"},addExpression:{"11.2.0":"data-testid query-tab-add-expression"}},QueryHistory:{queryText:{"9.0.0":"Query text"}},QueryEditorRows:{rows:{[y]:"Query editor row"}},QueryEditorRow:{actionButton:{"10.4.0":e=>`data-testid ${e}`},title:{[y]:e=>`Query editor row title ${e}`},container:{[y]:e=>`Query editor row ${e}`}},AlertTab:{content:{"10.2.3":"data-testid Alert editor tab content",[y]:"Alert editor tab content"}},AlertRules:{groupToggle:{"11.0.0":"data-testid group-collapse-toggle"},toggle:{"11.0.0":"data-testid collapse-toggle"},expandedContent:{"11.0.0":"data-testid expanded-content"},previewButton:{"11.1.0":"data-testid alert-rule preview-button"},ruleNameField:{"11.1.0":"data-testid alert-rule name-field"},newFolderButton:{"11.1.0":"data-testid alert-rule new-folder-button"},newFolderNameField:{"11.1.0":"data-testid alert-rule name-folder-name-field"},newFolderNameCreateButton:{"11.1.0":"data-testid alert-rule name-folder-name-create-button"},newEvaluationGroupButton:{"11.1.0":"data-testid alert-rule new-evaluation-group-button"},newEvaluationGroupName:{"11.1.0":"data-testid alert-rule new-evaluation-group-name"},newEvaluationGroupInterval:{"11.1.0":"data-testid alert-rule new-evaluation-group-interval"},newEvaluationGroupCreate:{"11.1.0":"data-testid alert-rule new-evaluation-group-create-button"},step:{"11.5.0":e=>`data-testid alert-rule step-${e}`},stepAdvancedModeSwitch:{"11.5.0":e=>`data-testid advanced-mode-switch step-${e}`}},Alert:{alertV2:{[y]:e=>`data-testid Alert ${e}`}},TransformTab:{content:{"10.1.0":"data-testid Transform editor tab content",[y]:"Transform editor tab content"},newTransform:{"10.1.0":e=>`data-testid New transform ${e}`},transformationEditor:{"10.1.0":e=>`data-testid Transformation editor ${e}`},transformationEditorDebugger:{"10.1.0":e=>`data-testid Transformation editor debugger ${e}`}},Transforms:{card:{"10.1.0":e=>`data-testid New transform ${e}`},disableTransformationButton:{"10.4.0":"data-testid Disable transformation button"},Reduce:{modeLabel:{"10.2.3":"data-testid Transform mode label",[y]:"Transform mode label"},calculationsLabel:{"10.2.3":"data-testid Transform calculations label",[y]:"Transform calculations label"}},SpatialOperations:{actionLabel:{"9.1.2":"root Action field property editor"},locationLabel:{"10.2.0":"root Location Mode field property editor"},location:{autoOption:{"9.1.2":"Auto location option"},coords:{option:{"9.1.2":"Coords location option"},latitudeFieldLabel:{"9.1.2":"root Latitude field field property editor"},longitudeFieldLabel:{"9.1.2":"root Longitude field field property editor"}},geohash:{option:{"9.1.2":"Geohash location option"},geohashFieldLabel:{"9.1.2":"root Geohash field field property editor"}},lookup:{option:{"9.1.2":"Lookup location option"},lookupFieldLabel:{"9.1.2":"root Lookup field field property editor"},gazetteerFieldLabel:{"9.1.2":"root Gazetteer field property editor"}}}},searchInput:{"10.2.3":"data-testid search transformations",[y]:"search transformations"},noTransformationsMessage:{"10.2.3":"data-testid no transformations message"},addTransformationButton:{"10.1.0":"data-testid add transformation button",[y]:"add transformation button"},removeAllTransformationsButton:{"10.4.0":"data-testid remove all transformations button"}},NavBar:{Configuration:{button:{"9.5.0":"Configuration"}},Toggle:{button:{"10.2.3":"data-testid Toggle menu",[y]:"Toggle menu"}},Reporting:{button:{"9.5.0":"Reporting"}}},NavMenu:{Menu:{"10.2.3":"data-testid navigation mega-menu"},item:{"9.5.0":"data-testid Nav menu item"}},NavToolbar:{container:{"9.4.0":"data-testid Nav toolbar"},commandPaletteTrigger:{"11.5.0":"data-testid Command palette trigger"},shareDashboard:{"11.1.0":"data-testid Share dashboard"},markAsFavorite:{"11.1.0":"data-testid Mark as favorite"},editDashboard:{editButton:{"11.1.0":"data-testid Edit dashboard button"},saveButton:{"11.1.0":"data-testid Save dashboard button"},exitButton:{"11.1.0":"data-testid Exit edit mode button"},settingsButton:{"11.1.0":"data-testid Dashboard settings"},addRowButton:{"11.1.0":"data-testid Add row button"},addLibraryPanelButton:{"11.1.0":"data-testid Add a panel from the panel library button"},addVisualizationButton:{"11.1.0":"data-testid Add new visualization menu item"},pastePanelButton:{"11.1.0":"data-testid Paste panel button"},discardChangesButton:{"11.1.0":"data-testid Discard changes button"},discardLibraryPanelButton:{"11.1.0":"data-testid Discard library panel button"},unlinkLibraryPanelButton:{"11.1.0":"data-testid Unlink library panel button"},saveLibraryPanelButton:{"11.1.0":"data-testid Save library panel button"},backToDashboardButton:{"11.1.0":"data-testid Back to dashboard button"}}},PageToolbar:{container:{[y]:()=>".page-toolbar"},item:{[y]:e=>`${e}`},itemButton:{"9.5.0":e=>`data-testid ${e}`}},QueryEditorToolbarItem:{button:{[y]:e=>`QueryEditor toolbar item button ${e}`}},BackButton:{backArrow:{"10.3.0":"data-testid Go Back",[y]:"Go Back"}},OptionsGroup:{group:{"11.1.0":e=>e?`data-testid Options group ${e}`:"data-testid Options group",[y]:e=>e?`Options group ${e}`:"Options group"},toggle:{"11.1.0":e=>e?`data-testid Options group ${e} toggle`:"data-testid Options group toggle",[y]:e=>e?`Options group ${e} toggle`:"Options group toggle"}},PluginVisualization:{item:{[y]:e=>`Plugin visualization item ${e}`},current:{[y]:()=>'[class*="-currentVisualizationItem"]'}},Select:{menu:{"11.5.0":"data-testid Select menu",[y]:"Select options menu"},option:{"11.1.0":"data-testid Select option",[y]:"Select option"},toggleAllOptions:{"11.3.0":"data-testid toggle all options"},input:{[y]:()=>'input[id*="time-options-input"]'},singleValue:{[y]:()=>'div[class*="-singleValue"]'}},FieldConfigEditor:{content:{[y]:"Field config editor content"}},OverridesConfigEditor:{content:{[y]:"Field overrides editor content"}},FolderPicker:{containerV2:{[y]:"data-testid Folder picker select container"},input:{"10.4.0":"data-testid folder-picker-input"}},ReadonlyFolderPicker:{container:{[y]:"data-testid Readonly folder picker select container"}},DataSourcePicker:{container:{"10.0.0":"data-testid Data source picker select container","8.0.0":"Data source picker select container"},inputV2:{"10.1.0":"data-testid Select a data source",[y]:"Select a data source"},dataSourceList:{"10.4.0":"data-testid Data source list dropdown"},advancedModal:{dataSourceList:{"10.4.0":"data-testid Data source list"},builtInDataSourceList:{"10.4.0":"data-testid Built in data source list"}}},TimeZonePicker:{containerV2:{[y]:"data-testid Time zone picker select container"},changeTimeSettingsButton:{"11.0.0":"data-testid Time zone picker Change time settings button"}},WeekStartPicker:{containerV2:{[y]:"data-testid Choose starting day of the week"},placeholder:{[y]:"Choose starting day of the week"}},TraceViewer:{spanBar:{"9.0.0":"data-testid SpanBar--wrapper"}},QueryField:{container:{"10.3.0":"data-testid Query field",[y]:"Query field"}},QueryBuilder:{queryPatterns:{"10.3.0":"data-testid Query patterns",[y]:"Query patterns"},labelSelect:{"10.3.0":"data-testid Select label",[y]:"Select label"},inputSelect:{"11.1.0":"data-testid Select label-input"},valueSelect:{"10.3.0":"data-testid Select value",[y]:"Select value"},matchOperatorSelect:{"10.3.0":"data-testid Select match operator",[y]:"Select match operator"}},ValuePicker:{button:{"10.3.0":e=>`data-testid Value picker button ${e}`},select:{"10.3.0":e=>`data-testid Value picker select ${e}`}},Search:{sectionV2:{[y]:"data-testid Search section"},itemsV2:{[y]:"data-testid Search items"},cards:{[y]:"data-testid Search cards"},collapseFolder:{[y]:e=>`data-testid Collapse folder ${e}`},expandFolder:{[y]:e=>`data-testid Expand folder ${e}`},dashboardItem:{[y]:e=>`data-testid Dashboard search item ${e}`},dashboardCard:{[y]:e=>`data-testid Search card ${e}`},folderHeader:{"9.3.0":e=>`data-testid Folder header ${e}`},folderContent:{"9.3.0":e=>`data-testid Folder content ${e}`},dashboardItems:{[y]:"data-testid Dashboard search item"}},DashboardLinks:{container:{[y]:"data-testid Dashboard link container"},dropDown:{[y]:"data-testid Dashboard link dropdown"},link:{[y]:"data-testid Dashboard link"}},LoadingIndicator:{icon:{"10.4.0":"data-testid Loading indicator",[y]:"Loading indicator"}},CallToActionCard:{buttonV2:{[y]:e=>`data-testid Call to action button ${e}`}},DataLinksContextMenu:{singleLink:{"10.3.0":"data-testid Data link",[y]:"Data link"}},CodeEditor:{container:{"10.2.3":"data-testid Code editor container",[y]:"Code editor container"}},ReactMonacoEditor:{editorLazy:{"11.1.0":"data-testid ReactMonacoEditor editorLazy"}},DashboardImportPage:{textarea:{[y]:"data-testid-import-dashboard-textarea"},submit:{[y]:"data-testid-load-dashboard"}},ImportDashboardForm:{name:{[y]:"data-testid-import-dashboard-title"},submit:{[y]:"data-testid-import-dashboard-submit"}},PanelAlertTabContent:{content:{"10.2.3":"data-testid Unified alert editor tab content",[y]:"Unified alert editor tab content"}},VisualizationPreview:{card:{[y]:e=>`data-testid suggestion-${e}`}},ColorSwatch:{name:{[y]:"data-testid-colorswatch"}},DashboardRow:{title:{[y]:e=>`data-testid dashboard-row-title-${e}`}},UserProfile:{profileSaveButton:{[y]:"data-testid-user-profile-save"},preferencesSaveButton:{[y]:"data-testid-shared-prefs-save"},orgsTable:{[y]:"data-testid-user-orgs-table"},sessionsTable:{[y]:"data-testid-user-sessions-table"},extensionPointTabs:{"10.2.3":"data-testid-extension-point-tabs"},extensionPointTab:{"10.2.3":e=>`data-testid-extension-point-tab-${e}`}},FileUpload:{inputField:{"9.0.0":"data-testid-file-upload-input-field"},fileNameSpan:{"9.0.0":"data-testid-file-upload-file-name"}},DebugOverlay:{wrapper:{"9.2.0":"debug-overlay"}},OrgRolePicker:{input:{"9.5.0":"Role"}},AnalyticsToolbarButton:{button:{"9.5.0":"Dashboard insights"}},Variables:{variableOption:{"9.5.0":"data-testid variable-option"},variableLinkWrapper:{"11.1.1":"data-testid variable-link-wrapper"}},Annotations:{annotationsTypeInput:{"11.1.0":"data-testid annotations-type-input",[y]:"annotations-type-input"},annotationsChoosePanelInput:{"11.1.0":"data-testid choose-panels-input",[y]:"choose-panels-input"},editor:{testButton:{"11.0.0":"data-testid annotations-test-button"},resultContainer:{"11.0.0":"data-testid annotations-query-result-container"}}},Tooltip:{container:{"10.2.0":"data-testid tooltip"}},ReturnToPrevious:{buttonGroup:{"11.0.0":"data-testid dismissable button group"},backButton:{"11.0.0":"data-testid back"},dismissButton:{"11.0.0":"data-testid dismiss"}},SQLQueryEditor:{selectColumn:{"11.0.0":"data-testid select-column"},selectColumnInput:{"11.0.0":"data-testid select-column-input"},selectFunctionParameter:{"11.0.0":e=>`data-testid select-function-parameter-${e}`},selectAggregation:{"11.0.0":"data-testid select-aggregation"},selectAggregationInput:{"11.0.0":"data-testid select-aggregation-input"},selectAlias:{"11.0.0":"data-testid select-alias"},selectAliasInput:{"11.0.0":"data-testid select-alias-input"},selectInputParameter:{"11.0.0":"data-testid select-input-parameter"},filterConjunction:{"11.0.0":"data-testid filter-conjunction"},filterField:{"11.0.0":"data-testid filter-field"},filterOperator:{"11.0.0":"data-testid filter-operator"},headerTableSelector:{"11.0.0":"data-testid header-table-selector"},headerFilterSwitch:{"11.0.0":"data-testid header-filter-switch"},headerGroupSwitch:{"11.0.0":"data-testid header-group-switch"},headerOrderSwitch:{"11.0.0":"data-testid header-order-switch"},headerPreviewSwitch:{"11.0.0":"data-testid header-preview-switch"}},EntityNotFound:{container:{"11.2.0":"data-testid entity-not-found"}},Portal:{container:{"11.5.0":"data-testid portal-container"}}},f={pages:p({Alerting:{AddAlertRule:{url:{"10.1.0":"/alerting/new/alerting",[y]:"/alerting/new"}},EditAlertRule:{url:{[y]:e=>`alerting/${e}/edit`}}},Login:{url:{[y]:"/login"},username:{"10.2.3":"data-testid Username input field",[y]:"Username input field"},password:{"10.2.3":"data-testid Password input field",[y]:"Password input field"},submit:{"10.2.3":"data-testid Login button",[y]:"Login button"},skip:{"10.2.3":"data-testid Skip change password button"}},PasswordlessLogin:{url:{[y]:"/login/passwordless/authenticate"},email:{"10.2.3":"data-testid Email input field",[y]:"Email input field"},submit:{"10.2.3":"data-testid PasswordlessLogin button",[y]:"PasswordlessLogin button"}},Home:{url:{[y]:"/"}},DataSource:{name:{"10.3.0":"data-testid Data source settings page name input field",[y]:"Data source settings page name input field"},delete:{[y]:"Data source settings page Delete button"},readOnly:{"10.3.0":"data-testid Data source settings page read only message",[y]:"Data source settings page read only message"},saveAndTest:{"10.0.0":"data-testid Data source settings page Save and Test button",[y]:"Data source settings page Save and Test button"},alert:{"10.3.0":"data-testid Data source settings page Alert",[y]:"Data source settings page Alert"}},DataSources:{url:{[y]:"/datasources"},dataSources:{[y]:e=>`Data source list item ${e}`}},EditDataSource:{url:{"9.5.0":e=>`/datasources/edit/${e}`},settings:{"9.5.0":"Datasource settings page basic settings"}},AddDataSource:{url:{[y]:"/datasources/new"},dataSourcePluginsV2:{"9.3.1":e=>`Add new data source ${e}`,[y]:e=>`Data source plugin item ${e}`}},ConfirmModal:{delete:{"10.0.0":"data-testid Confirm Modal Danger Button",[y]:"Confirm Modal Danger Button"}},AddDashboard:{url:{[y]:"/dashboard/new"},itemButton:{"9.5.0":e=>`data-testid ${e}`},addNewPanel:{"11.1.0":"data-testid Add new panel","8.0.0":"Add new panel",[y]:"Add new panel"},itemButtonAddViz:{[y]:"Add new visualization menu item"},addNewRow:{"11.1.0":"data-testid Add new row",[y]:"Add new row"},addNewPanelLibrary:{"11.1.0":"data-testid Add new panel from panel library",[y]:"Add new panel from panel library"},Settings:{Annotations:{List:{url:{[y]:"/dashboard/new?orgId=1&editview=annotations"}},Edit:{url:{[y]:e=>`/dashboard/new?editview=annotations&editIndex=${e}`}}},Variables:{List:{url:{"11.3.0":"/dashboard/new?orgId=1&editview=variables",[y]:"/dashboard/new?orgId=1&editview=templating"}},Edit:{url:{"11.3.0":e=>`/dashboard/new?orgId=1&editview=variables&editIndex=${e}`,[y]:e=>`/dashboard/new?orgId=1&editview=templating&editIndex=${e}`}}}}},Dashboard:{url:{[y]:e=>`/d/${e}`},DashNav:{nav:{[y]:"Dashboard navigation"},navV2:{[y]:"data-testid Dashboard navigation"},publicDashboardTag:{"9.1.0":"data-testid public dashboard tag"},shareButton:{"10.4.0":"data-testid share-button"},scrollContainer:{"11.1.0":"data-testid Dashboard canvas scroll container"},newShareButton:{container:{"11.1.0":"data-testid new share button"},shareLink:{"11.1.0":"data-testid new share link-button"},arrowMenu:{"11.1.0":"data-testid new share button arrow menu"},menu:{container:{"11.1.0":"data-testid new share button menu"},shareInternally:{"11.1.0":"data-testid new share button share internally"},shareExternally:{"11.1.1":"data-testid new share button share externally"},shareSnapshot:{"11.2.0":"data-testid new share button share snapshot"}}},NewExportButton:{container:{"11.2.0":"data-testid new export button"},arrowMenu:{"11.2.0":"data-testid new export button arrow menu"},Menu:{container:{"11.2.0":"data-testid new export button menu"},exportAsJson:{"11.2.0":"data-testid new export button export as json"}}},playlistControls:{prev:{"11.0.0":"data-testid playlist previous dashboard button"},stop:{"11.0.0":"data-testid playlist stop dashboard button"},next:{"11.0.0":"data-testid playlist next dashboard button"}}},Controls:{"11.1.0":"data-testid dashboard controls"},SubMenu:{submenu:{[y]:"Dashboard submenu"},submenuItem:{[y]:"data-testid template variable"},submenuItemLabels:{[y]:e=>`data-testid Dashboard template variables submenu Label ${e}`},submenuItemValueDropDownValueLinkTexts:{[y]:e=>`data-testid Dashboard template variables Variable Value DropDown value link text ${e}`},submenuItemValueDropDownDropDown:{[y]:"Variable options"},submenuItemValueDropDownOptionTexts:{[y]:e=>`data-testid Dashboard template variables Variable Value DropDown option text ${e}`},Annotations:{annotationsWrapper:{"10.0.0":"data-testid annotation-wrapper"},annotationLabel:{"10.0.0":e=>`data-testid Dashboard annotations submenu Label ${e}`},annotationToggle:{"10.0.0":e=>`data-testid Dashboard annotations submenu Toggle ${e}`}}},Settings:{Actions:{close:{"9.5.0":"data-testid dashboard-settings-close"}},General:{deleteDashBoard:{"11.1.0":"data-testid Dashboard settings page delete dashboard button"},sectionItems:{[y]:e=>`Dashboard settings section item ${e}`},saveDashBoard:{[y]:"Dashboard settings aside actions Save button"},saveAsDashBoard:{[y]:"Dashboard settings aside actions Save As button"},title:{"11.2.0":"General"}},Annotations:{Edit:{urlParams:{[y]:e=>`editview=annotations&editIndex=${e}`}},List:{url:{[y]:e=>`/d/${e}?editview=annotations`},addAnnotationCTAV2:{[y]:"data-testid Call to action button Add annotation query"},annotations:{"10.4.0":"data-testid list-annotations"}},Settings:{name:{"11.1.0":"data-testid Annotations settings name input",[y]:"Annotations settings name input"}},NewAnnotation:{panelFilterSelect:{"10.0.0":"data-testid annotations-panel-filter"},showInLabel:{"11.1.0":"data-testid show-in-label"},previewInDashboard:{"10.0.0":"data-testid annotations-preview"},delete:{"10.4.0":"data-testid annotations-delete"},apply:{"10.4.0":"data-testid annotations-apply"},enable:{"10.4.0":"data-testid annotation-enable"},hide:{"10.4.0":"data-testid annotation-hide"}}},Variables:{List:{url:{"11.3.0":e=>`/d/${e}?editview=variables`,[y]:e=>`/d/${e}?editview=templating`},addVariableCTAV2:{[y]:"data-testid Call to action button Add variable"},newButton:{[y]:"Variable editor New variable button"},table:{[y]:"Variable editor Table"},tableRowNameFields:{[y]:e=>`Variable editor Table Name field ${e}`},tableRowDefinitionFields:{"10.1.0":e=>`Variable editor Table Definition field ${e}`},tableRowArrowUpButtons:{[y]:e=>`Variable editor Table ArrowUp button ${e}`},tableRowArrowDownButtons:{[y]:e=>`Variable editor Table ArrowDown button ${e}`},tableRowDuplicateButtons:{[y]:e=>`Variable editor Table Duplicate button ${e}`},tableRowRemoveButtons:{[y]:e=>`Variable editor Table Remove button ${e}`}},Edit:{urlParams:{"11.3.0":e=>`editview=variables&editIndex=${e}`,[y]:e=>`editview=templating&editIndex=${e}`},General:{headerLink:{[y]:"Variable editor Header link"},modeLabelNew:{[y]:"Variable editor Header mode New"},modeLabelEdit:{[y]:"Variable editor Header mode Edit"},generalNameInput:{[y]:"Variable editor Form Name field"},generalNameInputV2:{[y]:"data-testid Variable editor Form Name field"},generalTypeSelect:{[y]:"Variable editor Form Type select"},generalTypeSelectV2:{[y]:"data-testid Variable editor Form Type select"},generalLabelInput:{[y]:"Variable editor Form Label field"},generalLabelInputV2:{[y]:"data-testid Variable editor Form Label field"},generalHideSelect:{[y]:"Variable editor Form Hide select"},generalHideSelectV2:{[y]:"data-testid Variable editor Form Hide select"},selectionOptionsAllowCustomValueSwitch:{[y]:"data-testid Variable editor Form Allow Custom Value switch"},selectionOptionsMultiSwitch:{"10.4.0":"data-testid Variable editor Form Multi switch",[y]:"Variable editor Form Multi switch"},selectionOptionsIncludeAllSwitch:{"10.4.0":"data-testid Variable editor Form IncludeAll switch",[y]:"Variable editor Form IncludeAll switch"},selectionOptionsCustomAllInput:{"10.4.0":"data-testid Variable editor Form IncludeAll field",[y]:"Variable editor Form IncludeAll field"},previewOfValuesOption:{"10.4.0":"data-testid Variable editor Preview of Values option",[y]:"Variable editor Preview of Values option"},submitButton:{"10.4.0":"data-testid Variable editor Run Query button",[y]:"Variable editor Submit button"},applyButton:{"9.3.0":"data-testid Variable editor Apply button"}},QueryVariable:{queryOptionsDataSourceSelect:{"10.4.0":"data-testid Select a data source","10.0.0":"data-testid Data source picker select container",[y]:"Data source picker select container"},queryOptionsRefreshSelect:{[y]:"Variable editor Form Query Refresh select"},queryOptionsRefreshSelectV2:{[y]:"data-testid Variable editor Form Query Refresh select"},queryOptionsRegExInput:{[y]:"Variable editor Form Query RegEx field"},queryOptionsRegExInputV2:{[y]:"data-testid Variable editor Form Query RegEx field"},queryOptionsSortSelect:{[y]:"Variable editor Form Query Sort select"},queryOptionsSortSelectV2:{[y]:"data-testid Variable editor Form Query Sort select"},queryOptionsQueryInput:{"10.4.0":"data-testid Variable editor Form Default Variable Query Editor textarea"},valueGroupsTagsEnabledSwitch:{[y]:"Variable editor Form Query UseTags switch"},valueGroupsTagsTagsQueryInput:{[y]:"Variable editor Form Query TagsQuery field"},valueGroupsTagsTagsValuesQueryInput:{[y]:"Variable editor Form Query TagsValuesQuery field"}},ConstantVariable:{constantOptionsQueryInput:{[y]:"Variable editor Form Constant Query field"},constantOptionsQueryInputV2:{[y]:"data-testid Variable editor Form Constant Query field"}},DatasourceVariable:{datasourceSelect:{[y]:"data-testid datasource variable datasource type"}},TextBoxVariable:{textBoxOptionsQueryInput:{[y]:"Variable editor Form TextBox Query field"},textBoxOptionsQueryInputV2:{[y]:"data-testid Variable editor Form TextBox Query field"}},CustomVariable:{customValueInput:{[y]:"data-testid custom-variable-input"}},IntervalVariable:{intervalsValueInput:{[y]:"data-testid interval variable intervals input"},autoEnabledCheckbox:{"10.4.0":"data-testid interval variable auto value checkbox"},stepCountIntervalSelect:{"10.4.0":"data-testid interval variable step count input"},minIntervalInput:{"10.4.0":"data-testid interval variable mininum interval input"}},GroupByVariable:{dataSourceSelect:{"10.4.0":"data-testid Select a data source"},infoText:{"10.4.0":"data-testid group by variable info text"},modeToggle:{"10.4.0":"data-testid group by variable mode toggle"}},AdHocFiltersVariable:{datasourceSelect:{"10.4.0":"data-testid Select a data source"},infoText:{"10.4.0":"data-testid ad-hoc filters variable info text"},modeToggle:{"11.0.0":"data-testid ad-hoc filters variable mode toggle"}}}}},Annotations:{marker:{"10.0.0":"data-testid annotation-marker"}},Rows:{Repeated:{ConfigSection:{warningMessage:{"10.2.0":"data-testid Repeated rows warning message"}}}}},Dashboards:{url:{[y]:"/dashboards"},dashboards:{"10.2.0":e=>`Dashboard search item ${e}`},toggleView:{[y]:"data-testid radio-button"}},SaveDashboardAsModal:{newName:{"10.2.0":"Save dashboard title field"},save:{"10.2.0":"Save dashboard button"}},SaveDashboardModal:{save:{"10.2.0":"Dashboard settings Save Dashboard Modal Save button"},saveVariables:{"10.2.0":"Dashboard settings Save Dashboard Modal Save variables checkbox"},saveTimerange:{"10.2.0":"Dashboard settings Save Dashboard Modal Save timerange checkbox"},saveRefresh:{"11.1.0":"Dashboard settings Save Dashboard Modal Save refresh checkbox"}},SharePanelModal:{linkToRenderedImage:{[y]:"Link to rendered image"}},ShareDashboardModal:{PublicDashboard:{WillBePublicCheckbox:{"9.1.0":"data-testid public dashboard will be public checkbox"},LimitedDSCheckbox:{"9.1.0":"data-testid public dashboard limited datasources checkbox"},CostIncreaseCheckbox:{"9.1.0":"data-testid public dashboard cost may increase checkbox"},PauseSwitch:{"9.5.0":"data-testid public dashboard pause switch"},EnableAnnotationsSwitch:{"9.3.0":"data-testid public dashboard on off switch for annotations"},CreateButton:{"9.5.0":"data-testid public dashboard create button"},DeleteButton:{"9.3.0":"data-testid public dashboard delete button"},CopyUrlInput:{"9.1.0":"data-testid public dashboard copy url input"},CopyUrlButton:{"9.1.0":"data-testid public dashboard copy url button"},SettingsDropdown:{"10.1.0":"data-testid public dashboard settings dropdown"},TemplateVariablesWarningAlert:{"9.1.0":"data-testid public dashboard disabled template variables alert"},UnsupportedDataSourcesWarningAlert:{"9.5.0":"data-testid public dashboard unsupported data sources alert"},NoUpsertPermissionsWarningAlert:{"9.5.0":"data-testid public dashboard no upsert permissions alert"},EnableTimeRangeSwitch:{"9.4.0":"data-testid public dashboard on off switch for time range"},EmailSharingConfiguration:{Container:{"9.5.0":"data-testid email sharing config container"},ShareType:{"9.5.0":"data-testid public dashboard share type"},EmailSharingInput:{"9.5.0":"data-testid public dashboard email sharing input"},EmailSharingInviteButton:{"9.5.0":"data-testid public dashboard email sharing invite button"},EmailSharingList:{"9.5.0":"data-testid public dashboard email sharing list"},DeleteEmail:{"9.5.0":"data-testid public dashboard delete email button"},ReshareLink:{"9.5.0":"data-testid public dashboard reshare link button"}}},SnapshotScene:{url:{"11.1.0":e=>`/dashboard/snapshot/${e}`},PublishSnapshot:{"11.1.0":"data-testid publish snapshot button"},CopyUrlButton:{"11.1.0":"data-testid snapshot copy url button"},CopyUrlInput:{"11.1.0":"data-testid snapshot copy url input"}}},ShareDashboardDrawer:{ShareInternally:{container:{"11.3.0":"data-testid share internally drawer container"},lockTimeRangeSwitch:{"11.3.0":"data-testid share internally lock time range switch"},shortenUrlSwitch:{"11.3.0":"data-testid share internally shorten url switch"},copyUrlButton:{"11.3.0":"data-testid share internally copy url button"},SharePanel:{preview:{"11.5.0":"data-testid share panel internally image generation preview"},widthInput:{"11.5.0":"data-testid share panel internally width input"},heightInput:{"11.5.0":"data-testid share panel internally height input"},scaleFactorInput:{"11.5.0":"data-testid share panel internally scale factor input"},generateImageButton:{"11.5.0":"data-testid share panel internally generate image button"},downloadImageButton:{"11.5.0":"data-testid share panel internally download image button"}}},ShareExternally:{container:{"11.3.0":"data-testid share externally drawer container"},publicAlert:{"11.3.0":"data-testid public share alert"},emailSharingAlert:{"11.3.0":"data-testid email share alert"},shareTypeSelect:{"11.3.0":"data-testid share externally share type select"},Creation:{PublicShare:{createButton:{"11.3.0":"data-testid public share dashboard create button"},cancelButton:{"11.3.0":"data-testid public share dashboard cancel button"}},EmailShare:{createButton:{"11.3.0":"data-testid email share dashboard create button"},cancelButton:{"11.3.0":"data-testid email share dashboard cancel button"}},willBePublicCheckbox:{"11.3.0":"data-testid share dashboard will be public checkbox"}},Configuration:{enableTimeRangeSwitch:{"11.3.0":"data-testid share externally enable time range switch"},enableAnnotationsSwitch:{"11.3.0":"data-testid share externally enable annotations switch"},copyUrlButton:{"11.3.0":"data-testid share externally copy url button"},revokeAccessButton:{"11.3.0":"data-testid share externally revoke access button"},toggleAccessButton:{"11.3.0":"data-testid share externally pause or resume access button"}}},ShareSnapshot:{url:{"11.3.0":e=>`/dashboard/snapshot/${e}`},container:{"11.3.0":"data-testid share snapshot drawer container"},publishSnapshot:{"11.3.0":"data-testid share snapshot publish button"},copyUrlButton:{"11.3.0":"data-testid share snapshot copy url button"}}},ExportDashboardDrawer:{ExportAsJson:{container:{"11.3.0":"data-testid export as json drawer container"},codeEditor:{"11.3.0":"data-testid export as json code editor"},exportExternallyToggle:{"11.3.0":"data-testid export as json externally switch"},saveToFileButton:{"11.3.0":"data-testid export as json save to file button"},copyToClipboardButton:{"11.3.0":"data-testid export as json copy to clipboard button"},cancelButton:{"11.3.0":"data-testid export as json cancel button"}}},PublicDashboard:{page:{"9.5.0":"public-dashboard-page"},NotAvailable:{container:{"9.5.0":"public-dashboard-not-available"},title:{"9.5.0":"public-dashboard-title"},pausedDescription:{"9.5.0":"public-dashboard-paused-description"}},footer:{"11.0.0":"public-dashboard-footer"}},PublicDashboardScene:{loadingPage:{"11.0.0":"public-dashboard-scene-loading-page"},page:{"11.0.0":"public-dashboard-scene-page"},controls:{"11.0.0":"public-dashboard-controls"}},RequestViewAccess:{form:{"9.5.0":"request-view-access-form"},recipientInput:{"9.5.0":"request-view-access-recipient-input"},submitButton:{"9.5.0":"request-view-access-submit-button"}},PublicDashboardConfirmAccess:{submitButton:{"10.2.0":"data-testid confirm-access-submit-button"}},Explore:{url:{[y]:"/explore"},General:{container:{[y]:"data-testid Explore"},graph:{[y]:"Explore Graph"},table:{[y]:"Explore Table"},scrollView:{"9.0.0":"data-testid explorer scroll view"},addFromQueryLibrary:{"11.5.0":"data-testid explore add from query library button"}},QueryHistory:{container:{"11.1.0":"data-testid QueryHistory"}}},SoloPanel:{url:{[y]:e=>`/d-solo/${e}`}},PluginsList:{page:{[y]:"Plugins list page"},list:{[y]:"Plugins list"},listItem:{[y]:"Plugins list item"},signatureErrorNotice:{"10.3.0":"data-testid Unsigned plugins notice",[y]:"Unsigned plugins notice"}},PluginPage:{page:{[y]:"Plugin page"},signatureInfo:{"10.3.0":"data-testid Plugin signature info",[y]:"Plugin signature info"},disabledInfo:{"10.3.0":"data-testid Plugin disabled info",[y]:"Plugin disabled info"}},PlaylistForm:{name:{[y]:"Playlist name"},interval:{[y]:"Playlist interval"},itemDelete:{"10.2.0":"data-testid playlist-form-delete-item"}},BrowseDashboards:{table:{body:{"10.2.0":"data-testid browse-dashboards-table"},row:{"10.2.0":e=>`data-testid browse dashboards row ${e}`},checkbox:{"10.0.0":e=>`data-testid ${e} checkbox`}},NewFolderForm:{form:{"10.2.0":"data-testid new folder form"},nameInput:{"10.2.0":"data-testid new-folder-name-input"},createButton:{"10.2.0":"data-testid new-folder-create-button"}}},SearchDashboards:{table:{"10.2.0":"Search results table"}},Search:{url:{"9.3.0":"/?search=openn"},FolderView:{url:{"9.3.0":"/?search=open&layout=folders"}}},PublicDashboards:{ListItem:{linkButton:{"9.3.0":"public-dashboard-link-button"},configButton:{"9.3.0":"public-dashboard-configuration-button"},trashcanButton:{"9.3.0":"public-dashboard-remove-button"},pauseSwitch:{"10.1.0":"data-testid public dashboard pause switch"}}},UserListPage:{tabs:{allUsers:{"10.0.0":"data-testid all-users-tab"},orgUsers:{"10.0.0":"data-testid org-users-tab"},anonUserDevices:{"10.2.3":"data-testid anon-user-devices-tab"},publicDashboardsUsers:{"10.0.0":"data-testid public-dashboards-users-tab"},users:{"10.0.0":"data-testid users-tab"}},org:{url:{"10.2.0":"/admin/users","9.5.0":"/org/users"}},admin:{url:{"9.5.0":"/admin/users"}},publicDashboards:{container:{"11.1.0":"data-testid public-dashboards-users-list"}},UserListAdminPage:{container:{"10.0.0":"data-testid user-list-admin-page"}},UsersListPage:{container:{"10.0.0":"data-testid users-list-page"}},UserAnonListPage:{container:{"10.4.0":"data-testid user-anon-list-page"}},UsersListPublicDashboardsPage:{container:{"10.0.0":"data-testid users-list-public-dashboards-page"},DashboardsListModal:{listItem:{"10.0.0":e=>`data-testid dashboards-list-item-${e}`}}}},ProfilePage:{url:{"10.2.0":"/profile"}},Plugin:{url:{[y]:e=>`/plugins/${e}`}},MigrateToCloud:{url:{"11.2.0":"/admin/migrate-to-cloud"}}}),components:p(v)};var w=a(45),O=a(4364),S=a(2961),j=a(8442),x=a(4326),P=a(8531),C=a(9453),D=a(6089);function q({isOpen:e,onCancel:t,onDiscard:a,onCopy:o}){const i=(0,n.useRef)(null),l=(0,s.useStyles2)(k);return(0,n.useEffect)((()=>{var t;e&&(null===(t=i.current)||void 0===t||t.focus())}),[e]),(0,r.jsxs)(s.Modal,{title:(0,r.jsxs)("div",{className:l.modalHeaderTitle,children:[(0,r.jsx)(s.Icon,{name:"exclamation-triangle",size:"lg"}),(0,r.jsx)("span",{className:l.titleText,children:"Warning"})]}),onDismiss:t,isOpen:e,children:[(0,r.jsx)("p",{children:"Builder mode does not display changes made in code. The query builder will display the last changes you made in builder mode."}),(0,r.jsx)("p",{children:"Do you want to copy your code to the clipboard?"}),(0,r.jsxs)(s.Modal.ButtonRow,{children:[(0,r.jsx)(s.Button,{type:"button",variant:"secondary",onClick:t,fill:"outline",children:"Cancel"}),(0,r.jsx)(s.Button,{variant:"destructive",type:"button",onClick:a,ref:i,children:"Discard code and switch"}),(0,r.jsx)(s.Button,{variant:"primary",onClick:o,children:"Copy code and switch"})]})]})}const k=e=>({titleText:(0,D.css)({paddingLeft:e.spacing(2)}),modalHeaderTitle:(0,D.css)({fontSize:e.typography.size.lg,float:"left",paddingTop:e.spacing(1),margin:e.spacing(0,2)})});var T=a(9953);function I(e,t,a,r,n,o,i){try{var s=e[o](i),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,n)}function B(e){return function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function i(e){I(o,r,n,i,s,"next",e)}function s(e){I(o,r,n,i,s,"throw",e)}i(void 0)}))}}const V=({dataset:e,db:t,dialect:a,onChange:i,inputId:l,preconfiguredDataset:d})=>{const u=!!d||"postgres"===a,c=(0,o.A)(B((function*(){return(0,T.C)()&&u?(i((0,C.zL)(d)),[(0,C.zL)(d)]):(e&&i((0,C.zL)(e)),(yield t.datasets()).map(C.zL))})),[]);return(0,n.useEffect)((()=>{(0,T.C)()||(e?c.value&&void 0===c.value.find((t=>t.value===e))&&c.value.length>0&&i(c.value[0]):c.value&&c.value[0]&&i(c.value[0]))}),[c.value,i,e]),(0,r.jsx)(s.Select,{"aria-label":"Dataset selector",inputId:l,value:e,options:c.value,onChange:i,disabled:c.loading,isLoading:c.loading,menuShouldPortal:!0})};var E=a(7781);function $(e,t,a,r,n,o,i){try{var s=e[o](i),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,n)}function F(e){return function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function i(e){$(o,r,n,i,s,"next",e)}function s(e){$(o,r,n,i,s,"throw",e)}i(void 0)}))}}const A=({db:e,dataset:t,table:a,className:n,onChange:i,inputId:l})=>{const d=(0,o.A)(F((function*(){return t?(yield e.tables(t)).map(E.toOption):[]})),[t]);return(0,r.jsx)(s.Select,{className:n,disabled:d.loading,"aria-label":"Table selector",inputId:l,"data-testid":f.components.SQLQueryEditor.headerTableSelector,value:a,options:d.value,onChange:i,isLoading:d.loading,menuShouldPortal:!0,placeholder:d.loading?"Loading tables":"Select table"})};function L(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Q(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){L(e,t,a[t])}))}return e}function R(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t.push.apply(t,a)}return t}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}const M=[{label:"Builder",value:i.lX.Builder},{label:"Code",value:i.lX.Code}];function _({db:e,dialect:t,isQueryRunnable:a,onChange:o,onQueryRowChange:l,onRunQuery:d,preconfiguredDataset:c,query:p,queryRowFilter:b}){const{editorMode:m}=p,[g,h]=(0,u.A)(),[y,v]=(0,n.useState)(!1),D=e.toRawSql,k=(0,n.useId)(),I=(0,n.useCallback)((e=>{var t;e===i.lX.Code&&(0,P.reportInteraction)("grafana_sql_editor_mode_changed",{datasource:null===(t=p.datasource)||void 0===t?void 0:t.type,selectedEditorMode:i.lX.Code}),m!==i.lX.Code?o(R(Q({},p),{editorMode:e})):v(!0)}),[m,o,p]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(w.X,{children:[(0,r.jsx)(O.W,{label:"Format",value:p.format,placeholder:"Select format",menuShouldPortal:!0,onChange:e=>{var t;const a=R(Q({},p),{format:void 0!==e.value?e.value:C.gv.Table});(0,P.reportInteraction)("grafana_sql_format_changed",{datasource:null===(t=p.datasource)||void 0===t?void 0:t.type,selectedFormat:a.format}),o(a)},options:C.cO}),m===i.lX.Builder&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.InlineSwitch,{id:`sql-filter-${k}`,label:"Filter","data-testid":f.components.SQLQueryEditor.headerFilterSwitch,transparent:!0,showLabel:!0,value:b.filter,onChange:e=>{var t;e.target instanceof HTMLInputElement&&((0,P.reportInteraction)("grafana_sql_filter_toggled",{datasource:null===(t=p.datasource)||void 0===t?void 0:t.type,displayed:e.target.checked}),l(R(Q({},b),{filter:e.target.checked})))}}),(0,r.jsx)(s.InlineSwitch,{id:`sql-group-${k}`,label:"Group","data-testid":f.components.SQLQueryEditor.headerGroupSwitch,transparent:!0,showLabel:!0,value:b.group,onChange:e=>{var t;e.target instanceof HTMLInputElement&&((0,P.reportInteraction)("grafana_sql_group_toggled",{datasource:null===(t=p.datasource)||void 0===t?void 0:t.type,displayed:e.target.checked}),l(R(Q({},b),{group:e.target.checked})))}}),(0,r.jsx)(s.InlineSwitch,{id:`sql-order-${k}`,label:"Order","data-testid":f.components.SQLQueryEditor.headerOrderSwitch,transparent:!0,showLabel:!0,value:b.order,onChange:e=>{var t;e.target instanceof HTMLInputElement&&((0,P.reportInteraction)("grafana_sql_order_toggled",{datasource:null===(t=p.datasource)||void 0===t?void 0:t.type,displayed:e.target.checked}),l(R(Q({},b),{order:e.target.checked})))}}),(0,r.jsx)(s.InlineSwitch,{id:`sql-preview-${k}`,label:"Preview","data-testid":f.components.SQLQueryEditor.headerPreviewSwitch,transparent:!0,showLabel:!0,value:b.preview,onChange:e=>{var t;e.target instanceof HTMLInputElement&&((0,P.reportInteraction)("grafana_sql_preview_toggled",{datasource:null===(t=p.datasource)||void 0===t?void 0:t.type,displayed:e.target.checked}),l(R(Q({},b),{preview:e.target.checked})))}})]}),(0,r.jsx)(S.Z,{grow:1}),a?(0,r.jsx)(s.Button,{icon:"play",variant:"primary",size:"sm",onClick:()=>d(),children:"Run query"}):(0,r.jsx)(s.Tooltip,{theme:"error",content:(0,r.jsxs)(r.Fragment,{children:["Your query is invalid. Check below for details. ",(0,r.jsx)("br",{}),"However, you can still run this query."]}),placement:"top",children:(0,r.jsx)(s.Button,{icon:"exclamation-triangle",variant:"secondary",size:"sm",onClick:()=>d(),children:"Run query"})}),(0,r.jsx)(s.RadioButtonGroup,{options:M,size:"sm",value:m,onChange:I}),(0,r.jsx)(q,{isOpen:y,onCopy:()=>{var e;(0,P.reportInteraction)("grafana_sql_editor_mode_changed",{datasource:null===(e=p.datasource)||void 0===e?void 0:e.type,selectedEditorMode:i.lX.Builder,type:"copy"}),v(!1),h(p.rawSql),o(R(Q({},p),{rawSql:D(p),editorMode:i.lX.Builder}))},onDiscard:()=>{var e;(0,P.reportInteraction)("grafana_sql_editor_mode_changed",{datasource:null===(e=p.datasource)||void 0===e?void 0:e.type,selectedEditorMode:i.lX.Builder,type:"discard"}),v(!1),o(R(Q({},p),{rawSql:D(p),editorMode:i.lX.Builder}))},onCancel:()=>{var e;(0,P.reportInteraction)("grafana_sql_editor_mode_changed",{datasource:null===(e=p.datasource)||void 0===e?void 0:e.type,selectedEditorMode:i.lX.Builder,type:"cancel"}),v(!1)}})]}),m===i.lX.Builder&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Space,{v:.5}),(0,r.jsxs)(j.U,{children:["influx"!==t&&!(!(0,T.C)()&&"postgres"===t)&&(0,r.jsx)(x.c,{label:"Dataset",width:25,children:(0,r.jsx)(V,{db:e,inputId:`sql-dataset-${k}`,dataset:p.dataset,dialect:t,preconfiguredDataset:c,onChange:e=>{if(e.value===p.dataset)return;const t=R(Q({},p),{dataset:e.value,table:void 0,sql:void 0,rawSql:""});o(t)}})}),(0,r.jsx)(x.c,{label:"Table",width:25,children:(0,r.jsx)(A,{db:e,inputId:`sql-tableselect-${k}`,dataset:p.dataset||c,table:p.table,onChange:e=>{if(e.value===p.table)return;const t=R(Q({},p),{table:e.value,sql:void 0,rawSql:""});o(t)}})})]})]})]})}var N=a(8722),z=a(4889),G=a(9871);function U(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function H({children:e,onChange:t,query:a,width:o,height:i,editorLanguageDefinition:s}){const l=(0,n.useRef)(a);(0,n.useEffect)((()=>{l.current=a}),[a]);const d=(0,n.useCallback)(((e,a)=>{const r=(n=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){U(e,t,a[t])}))}return e}({},l.current),o=null!=(o={rawQuery:!0,rawSql:e})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t.push.apply(t,a)}return t}(Object(o)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))})),n);var n,o;t(r,a)}),[t]);return(0,r.jsx)(G.Y,{width:o,height:i,query:a.rawSql,onChange:d,language:s,children:e})}var W=a(9389),X=a(990);function J(e,t,a,r,n,o,i){try{var s=e[o](i),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,n)}function K(e){return function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function i(e){J(o,r,n,i,s,"next",e)}function s(e){J(o,r,n,i,s,"throw",e)}i(void 0)}))}}function Z({db:e,query:t,onValidate:a,range:o}){var i;const[l,d]=(0,n.useState)(),u=(0,s.useTheme2)(),c=(0,n.useMemo)((()=>(0,E.getValueFormat)("bytes")),[]),p=(0,n.useMemo)((()=>({error:(0,D.css)({color:u.colors.error.text,fontSize:u.typography.bodySmall.fontSize,fontFamily:u.typography.fontFamilyMonospace}),valid:(0,D.css)({color:u.colors.success.text}),info:(0,D.css)({color:u.colors.text.secondary})})),[u]),[b,m]=(0,W.A)(function(){var t=K((function*(t){var a;return""===(null===(a=t.rawSql)||void 0===a?void 0:a.trim())?null:yield e.validateQuery(t,o)}));return function(e){return t.apply(this,arguments)}}(),[e]),[]=(0,X.A)(K((function*(){const e=yield m(t);return e&&d(e),null})),1e3,[t,m]);if((0,n.useEffect)((()=>{(null==l?void 0:l.isError)&&a(!1),(null==l?void 0:l.isValid)&&a(!0)}),[l,a]),!b.value&&!b.loading)return null;const g=(null===(i=b.value)||void 0===i?void 0:i.error)?function(e){const t=e.split(":");return t.length>2?t.slice(2).join(":"):e}(b.value.error):"";return(0,r.jsxs)(r.Fragment,{children:[b.loading&&(0,r.jsxs)("div",{className:p.info,children:[(0,r.jsx)(s.Spinner,{inline:!0,size:"xs"})," Validating query..."]}),!b.loading&&b.value&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(r.Fragment,{children:b.value.isValid&&b.value.statistics&&(0,r.jsxs)("div",{className:p.valid,children:[(0,r.jsx)(s.Icon,{name:"check"})," This query will process"," ",(0,r.jsx)("strong",{children:(0,E.formattedValueToString)(c(b.value.statistics.TotalBytesProcessed))})," ","when run."]})}),(0,r.jsx)(r.Fragment,{children:b.value.isError&&(0,r.jsx)("div",{className:p.error,children:g})})]})]})}function Y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ee(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){Y(e,t,a[t])}))}return e}function te(e){var{showTools:t,onFormatCode:a,onExpand:o,isExpanded:i}=e,l=function(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}(e,["showTools","onFormatCode","onExpand","isExpanded"]);const d=(0,s.useTheme2)(),[u,c]=(0,n.useState)(),p=(0,n.useMemo)((()=>({container:(0,D.css)({border:`1px solid ${d.colors.border.medium}`,borderTop:"none",padding:d.spacing(.5,.5,.5,.5),display:"flex",flexGrow:1,justifyContent:"space-between",fontSize:d.typography.bodySmall.fontSize}),error:(0,D.css)({color:d.colors.error.text,fontSize:d.typography.bodySmall.fontSize,fontFamily:d.typography.fontFamilyMonospace}),valid:(0,D.css)({color:d.colors.success.text}),info:(0,D.css)({color:d.colors.text.secondary}),hint:(0,D.css)({color:d.colors.text.disabled,whiteSpace:"nowrap",cursor:"help"})})),[d]);let b={};return t||void 0!==u||(b={height:0,padding:0,visibility:"hidden"}),(0,r.jsxs)("div",{className:p.container,style:b,children:[(0,r.jsx)("div",{children:l.onValidate&&(0,r.jsx)(Z,(m=ee({},l),g={onValidate:e=>{c(e),l.onValidate(e)}},g=null!=g?g:{},Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(g)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t.push.apply(t,a)}return t}(Object(g)).forEach((function(e){Object.defineProperty(m,e,Object.getOwnPropertyDescriptor(g,e))})),m))}),t&&(0,r.jsx)("div",{children:(0,r.jsxs)(s.HorizontalGroup,{spacing:"sm",children:[a&&(0,r.jsx)(s.IconButton,{onClick:()=>{var e;(0,P.reportInteraction)("grafana_sql_query_formatted",{datasource:null===(e=l.query.datasource)||void 0===e?void 0:e.type}),a()},name:"brackets-curly",size:"xs",tooltip:"Format query"}),o&&(0,r.jsx)(s.IconButton,{onClick:()=>{var e;(0,P.reportInteraction)("grafana_sql_editor_expand",{datasource:null===(e=l.query.datasource)||void 0===e?void 0:e.type,expanded:!i}),o(!i)},name:i?"angle-up":"angle-down",size:"xs",tooltip:i?"Collapse editor":"Expand editor"}),(0,r.jsx)(s.Tooltip,{content:"Hit CTRL/CMD+Return to run query",children:(0,r.jsx)(s.Icon,{className:p.hint,name:"keyboard"})})]})})]});var m,g}function ae({db:e,query:t,onChange:a,onRunQuery:o,onValidate:i,queryToValidate:l,range:d}){const u=(0,s.useTheme2)(),c=(0,s.useStyles2)(re),[p,b]=(0,n.useState)(!1),[m,g]=(0,N.A)(),[h,y]=(0,N.A)(),v=(0,n.useMemo)((()=>e.getEditorLanguageDefinition()),[e]),f=(n,o)=>(0,r.jsx)(H,{editorLanguageDefinition:v,query:t,width:n,height:o?o-g.height:void 0,onChange:a,children:({formatQuery:t})=>(0,r.jsx)("div",{ref:m,children:(0,r.jsx)(te,{db:e,query:l,onValidate:i,onFormatCode:t,showTools:!0,range:d,onExpand:b,isExpanded:p})})}),w=(e=!1)=>e?(0,r.jsx)(z.Ay,{children:({width:e,height:t})=>f(e,t)}):(0,r.jsx)("div",{ref:h,children:f()});return(0,r.jsxs)(r.Fragment,{children:[p?(0,r.jsx)("div",{style:{width:y.width,height:y.height,background:u.colors.background.primary,display:"flex",alignItems:"center",justifyContent:"center"},children:"Editing in expanded code editor"}):w(),p&&(0,r.jsx)(s.Modal,{title:`Query ${t.refId}`,closeOnBackdropClick:!1,closeOnEscape:!1,className:c.modal,contentClassName:c.modalContent,isOpen:p,onDismiss:()=>{var e;(0,P.reportInteraction)("grafana_sql_editor_expand",{datasource:null===(e=t.datasource)||void 0===e?void 0:e.type,expanded:!1}),b(!1)},children:w(!0)})]})}function re(e){return{modal:(0,D.css)({width:"95vw",height:"95vh"}),modalContent:(0,D.css)({height:"100%",paddingTop:0})}}var ne=a(3769),oe=a(3031);function ie({rawSql:e,datasourceType:t}){const[a,n]=(0,u.A)(),o=(0,s.useStyles2)(se),i=(0,r.jsxs)("div",{className:o.labelWrapper,children:[(0,r.jsx)("span",{className:o.label,children:"Preview"}),(0,r.jsx)(s.IconButton,{tooltip:"Copy to clipboard",onClick:()=>(e=>{n(e),(0,P.reportInteraction)("grafana_sql_preview_copied",{datasource:t})})(e),name:"copy"})]});return(0,r.jsx)(s.Field,{label:i,className:o.grow,children:(0,r.jsx)(s.CodeEditor,{language:"sql",height:80,value:(0,oe.s)(e),monacoOptions:{scrollbar:{vertical:"hidden"},scrollBeyondLastLine:!1},readOnly:!0,showMiniMap:!1})})}function se(e){return{grow:(0,D.css)({flexGrow:1}),label:(0,D.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),labelWrapper:(0,D.css)({display:"flex",justifyContent:"space-between",paddingBottom:e.spacing(.5)})}}function le(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function de({query:e,onQueryChange:t,db:a}){const r=(0,n.useCallback)((r=>{const n=(0,a.toRawSql)({sql:r,dataset:e.dataset,table:e.table,refId:e.refId}),o=(i=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){le(e,t,a[t])}))}return e}({},e),s=null!=(s={sql:r,rawSql:n})?s:{},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(s)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t.push.apply(t,a)}return t}(Object(s)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(s,e))})),i);var i,s;t(o)}),[a,t,e]);return{onSqlChange:r}}var ue=a(7088),ce=a(258),pe=a(5208);function be(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function me({sql:e,columns:t,onSqlChange:a}){const o=(0,n.useCallback)((t=>{const r=t.map((e=>{var t;return(0,d.xG)(null===(t=e.property)||void 0===t?void 0:t.name)})),n=(o=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){be(e,t,a[t])}))}return e}({},e),i=null!=(i={groupBy:r})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t.push.apply(t,a)}return t}(Object(i)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(i,e))})),o);var o,i;a(n)}),[a,e]);return(0,r.jsx)(ue.o,{items:e.groupBy,onChange:o,renderItem:ge({options:t})})}function ge({options:e}){return function(t,a,n){var o;return(0,r.jsxs)(ce.M,{children:[(0,r.jsx)(s.Select,{value:(null===(o=t.property)||void 0===o?void 0:o.name)?(0,E.toOption)(t.property.name):null,"aria-label":"Group by",options:e,menuShouldPortal:!0,onChange:({value:e})=>e&&a((0,d.xG)(e))}),(0,r.jsx)(pe.Z,{title:"Remove group by column",icon:"times",variant:"secondary",onClick:n})]})}}function he({fields:e,query:t,onQueryChange:a,db:n}){const{onSqlChange:o}=de({query:t,onQueryChange:a,db:n});return(0,r.jsx)(me,{columns:e,sql:t.sql,onSqlChange:o})}var ye=a(3241);function ve(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function fe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){ve(e,t,a[t])}))}return e}function we(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t.push.apply(t,a)}return t}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}const Oe=[{description:"Sort by ascending",value:"ASC",icon:"sort-amount-up"},{description:"Sort by descending",value:"DESC",icon:"sort-amount-down"}];function Se({sql:e,onSqlChange:t,columns:a,showOffset:o}){var i,l;const u=(0,n.useCallback)((a=>{const r=we(fe({},e),{orderByDirection:a});t(r)}),[t,e]),c=(0,n.useCallback)((a=>{const r=we(fe({},e),{limit:Number.parseInt(a.currentTarget.value,10)});t(r)}),[t,e]),p=(0,n.useCallback)((a=>{const r=we(fe({},e),{offset:Number.parseInt(a.currentTarget.value,10)});t(r)}),[t,e]),b=(0,n.useCallback)((a=>{const r=we(fe({},e),{orderBy:(0,d.Kj)(null==a?void 0:a.value)});null===a&&(r.orderByDirection=void 0),t(r)}),[t,e]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.c,{label:"Order by",width:25,children:(0,r.jsxs)(ce.M,{children:[(0,r.jsx)(s.Select,{"aria-label":"Order by",options:a,value:(null===(i=e.orderBy)||void 0===i?void 0:i.property.name)?(0,E.toOption)(e.orderBy.property.name):null,isClearable:!0,menuShouldPortal:!0,onChange:b}),(0,r.jsx)(s.Space,{h:1.5}),(0,r.jsx)(s.RadioButtonGroup,{options:Oe,disabled:!(null==e||null===(l=e.orderBy)||void 0===l?void 0:l.property.name),value:e.orderByDirection,onChange:u})]})}),(0,r.jsx)(x.c,{label:"Limit",optional:!0,width:25,children:(0,r.jsx)(s.Input,{type:"number",min:0,id:(0,ye.uniqueId)("limit-"),value:e.limit||"",onChange:c})}),o&&(0,r.jsx)(x.c,{label:"Offset",optional:!0,width:25,children:(0,r.jsx)(s.Input,{type:"number",id:(0,ye.uniqueId)("offset-"),value:e.offset||"",onChange:p})})]})}function je({fields:e,query:t,onQueryChange:a,db:n}){const{onSqlChange:o}=de({query:t,onQueryChange:a,db:n});let i=[];var s,l;e&&(i=[{value:"",label:"Selected columns",options:null===(l=t.sql)||void 0===l||null===(s=l.columns)||void 0===s?void 0:s.map(((e,t)=>{var a,r;const n=e.name?`${e.name}(${null===(a=e.parameters)||void 0===a?void 0:a.map((e=>e.name))})`:null===(r=e.parameters)||void 0===r?void 0:r.map((e=>e.name));return{value:n,label:`${t+1} - ${n}`}})),expanded:!0},...e]);return(0,r.jsx)(Se,{sql:t.sql,onSqlChange:o,columns:i})}var xe=a(1777),Pe=a(750);function Ce(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function De(){return De=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},De.apply(this,arguments)}function qe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){Ce(e,t,a[t])}))}return e}function ke(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t.push.apply(t,a)}return t}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}const Te={id:Pe.Aq.uuid(),type:"group"},Ie="timeFilter",Be=[Ie],Ve=ke(qe({},Pe.d$.widgets),{text:ke(qe({},Pe.d$.widgets.text),{factory:function(e){return(0,r.jsx)(s.Input,{value:(null==e?void 0:e.value)||"",placeholder:null==e?void 0:e.placeholder,onChange:t=>null==e?void 0:e.setValue(t.currentTarget.value)})}}),number:ke(qe({},Pe.d$.widgets.number),{factory:function(e){return(0,r.jsx)(s.Input,{value:null==e?void 0:e.value,placeholder:null==e?void 0:e.placeholder,type:"number",onChange:t=>null==e?void 0:e.setValue(Number.parseInt(t.currentTarget.value,10))})}}),datetime:ke(qe({},Pe.d$.widgets.datetime),{factory:function(e){if("macros"===(null==e?void 0:e.operator))return(0,r.jsx)(s.Select,{id:e.id,"aria-label":"Macros value selector",menuShouldPortal:!0,options:Be.map(E.toOption),value:null==e?void 0:e.value,onChange:t=>e.setValue(t.value)});const t=(0,E.dateTime)(null==e?void 0:e.value).isValid()?(0,E.dateTime)(null==e?void 0:e.value).utc():void 0;return(0,r.jsx)(s.DateTimePicker,{onChange:t=>{null==e||e.setValue(null==t?void 0:t.format(Pe.d$.widgets.datetime.valueFormat))},date:t})},sqlFormatValue:(e,t,a,r,n,o)=>{if("macros"===r)return Be.includes(e)?e:void 0;if("string"==typeof Pe.d$.widgets.datetime.sqlFormatValue||"object"==typeof Pe.d$.widgets.datetime.sqlFormatValue)return;const i=Pe.d$.widgets.datetime.sqlFormatValue;return(null==i?void 0:i.call(Pe.d$.ctx,e,t,a,r,n,o))||""}})}),Ee=ke(qe({},Pe.d$.settings),{canRegroup:!1,maxNesting:1,canReorder:!1,showNot:!1,addRuleLabel:"Add",deleteLabel:"Remove",renderConjs:function(e){return(0,r.jsx)(s.Select,{id:null==e?void 0:e.id,"aria-label":"Conjunction","data-testid":f.components.SQLQueryEditor.filterConjunction,menuShouldPortal:!0,options:(null==e?void 0:e.conjunctionOptions)?Object.keys(null==e?void 0:e.conjunctionOptions).map(E.toOption):void 0,value:null==e?void 0:e.selectedConjunction,onChange:t=>null==e?void 0:e.setConjunction(t.value)})},renderField:function(e){var t;const a=(null==e||null===(t=e.config)||void 0===t?void 0:t.fields)||{};return(0,r.jsx)(s.Select,{id:null==e?void 0:e.id,width:25,"aria-label":"Field","data-testid":f.components.SQLQueryEditor.filterField,menuShouldPortal:!0,options:null==e?void 0:e.items.map((e=>{var t,r;const n=null===(r=a[e.key].mainWidgetProps)||void 0===r||null===(t=r.customProps)||void 0===t?void 0:t.icon;return{label:e.label,value:e.key,icon:n}})),value:null==e?void 0:e.selectedKey,onChange:t=>{null==e||e.setField(t.label)}})},renderButton:function(e){return(0,r.jsx)(s.Button,{type:"button",title:`${null==e?void 0:e.label} filter`,onClick:null==e?void 0:e.onClick,variant:"secondary",size:"md",icon:"Add"===(null==e?void 0:e.label)?"plus":"times"})},renderOperator:function(e){return(0,r.jsx)(s.Select,{options:null==e?void 0:e.items.map((e=>({label:e.label,value:e.key}))),"aria-label":"Operator","data-testid":f.components.SQLQueryEditor.filterOperator,menuShouldPortal:!0,value:null==e?void 0:e.selectedKey,onChange:t=>{null==e||e.setField(t.value||"")}})}}),$e=function(e){var t,a,r,n;const o=De({},function(e){if(null==e)throw new TypeError("Cannot destructure "+e);return e}(e.operators)),i=(null===(t=o.select_any_in.sqlFormatOp)||void 0===t?void 0:t.bind(e.ctx))||Me,s=(null===(a=o.select_any_in.formatOp)||void 0===a?void 0:a.bind(e.ctx))||Me,l=(null===(r=o.select_not_any_in.sqlFormatOp)||void 0===r?void 0:r.bind(e.ctx))||Me,d=(null===(n=o.select_not_any_in.formatOp)||void 0===n?void 0:n.bind(e.ctx))||Me;return ke(qe({},o),{select_any_in:ke(qe({},o.select_any_in),{formatOp:(e,t,a,r)=>s(e,t,_e(a),r),sqlFormatOp:(e,t,a,r,n,o,s,l)=>i(e,t,_e(a),r,n,o,s,l)}),select_not_any_in:ke(qe({},o.select_not_any_in),{formatOp:(e,t,a,r)=>d(e,t,_e(a),r),sqlFormatOp:(e,t,a,r,n,o,i,s)=>l(e,t,_e(a),r,n,o,i,s)}),macros:{label:"Macros",sqlFormatOp:(e,t,a)=>{if(a===Ie)return`$__timeFilter(${e})`;throw new Error("Invalid macro")}}})}(Pe.d$),Fe=Pe.d$.types.text.widgets.text,Ae=[...Fe.operators||[],"select_any_in","select_not_any_in"],Le=ke(qe({},Fe),{operators:Ae}),Qe=ke(qe({},Pe.d$.types),{text:ke(qe({},Pe.d$.types.text),{widgets:ke(qe({},Pe.d$.types.text.widgets),{text:Le})}),datetime:ke(qe({},Pe.d$.types.datetime),{widgets:ke(qe({},Pe.d$.types.datetime.widgets),{datetime:ke(qe({},Pe.d$.types.datetime.widgets.datetime),{operators:["macros",...Pe.d$.types.datetime.widgets.datetime.operators||[]]})})})}),Re=ke(qe({},Pe.d$),{widgets:Ve,settings:Ee,operators:$e,types:Qe}),Me=()=>"";function _e(e){return(0,ye.isString)(e)?e.split(","):e}function Ne(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ze(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){Ne(e,t,a[t])}))}return e}function Ge(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t.push.apply(t,a)}return t}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function Ue({sql:e,config:t,onSqlChange:a}){const[o,i]=(0,n.useState)(),s=(0,n.useMemo)((()=>ze({},Re,t)),[t]);(0,n.useEffect)((()=>{if(!o){var t;const a=Pe.Aq.checkTree(Pe.Aq.loadTree(null!==(t=e.whereJsonTree)&&void 0!==t?t:Te),s);i(a)}}),[s,e.whereJsonTree,o]),(0,n.useEffect)((()=>{e.whereJsonTree||i(Pe.Aq.checkTree(Pe.Aq.loadTree(Te),s))}),[s,e.whereJsonTree]);const l=(0,n.useCallback)(((t,r)=>{i(t);const n=Ge(ze({},e),{whereJsonTree:Pe.Aq.getTree(t),whereString:Pe.Aq.sqlFormat(t,r)});a(n)}),[a,e]);return o?(0,r.jsx)(Pe.XK,Ge(ze({},s),{value:o,onChange:l,renderBuilder:e=>(0,r.jsx)(Pe.M$,ze({},e))})):null}function He(e){return`\n    display: flex;\n    gap: 8px;\n    flex-direction: ${e};`}function We(e,t,a,r,n,o,i){try{var s=e[o](i),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,n)}function Xe(e){return function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function i(e){We(o,r,n,i,s,"next",e)}function s(e){We(o,r,n,i,s,"throw",e)}i(void 0)}))}}function Je({query:e,fields:t,onQueryChange:a,db:n}){const o=(0,xe.A)(Xe((function*(){return function(e){const t={};for(const a of e)t[a.value]={type:a.raqbFieldType||"text",valueSources:["value"],mainWidgetProps:{customProps:{icon:a.icon}}};return t}(t)})),[t]),{onSqlChange:i}=de({query:e,onQueryChange:a,db:n});return(0,r.jsx)(Ue,{config:{fields:o.value||{}},sql:e.sql,onSqlChange:e=>{!function(e,t){var a,r;t.some((t=>(t=>{var a,r;return"multi"in t&&t.multi&&((null===(a=e.whereString)||void 0===a?void 0:a.includes(`\${${t.name}}`))||(null===(r=e.whereString)||void 0===r?void 0:r.includes(`$${t.name}`)))})(t)))&&(e.whereString=null===(a=e.whereString)||void 0===a?void 0:a.replaceAll("')",")"),e.whereString=null===(r=e.whereString)||void 0===r?void 0:r.replaceAll("('","("))}(e,(0,P.getTemplateSrv)().getVariables()),i(e)}},JSON.stringify(o.value))}D.injectGlobal`
  .group--header {
    ${He("row")}
  }

  .group-or-rule {
    ${He("column")}
    .rule {
      flex-direction: row;
    }
  }

  .rule--body {
    ${He("row")}
  }

  .group--children {
    ${He("column")}
  }

  .group--conjunctions:empty {
    display: none;
  }
`;var Ke=a(6703);function Ze({columns:e,onParameterChange:t,value:a}){const o=(0,n.useId)();return(0,r.jsx)(x.c,{label:"Column",width:25,children:(0,r.jsx)(s.Select,{value:a,"data-testid":f.components.SQLQueryEditor.selectColumn,inputId:o,menuShouldPortal:!0,options:[{label:"*",value:"*"},...e],allowCustomValue:!0,onChange:e=>t(e.value)})})}function Ye(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function et(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){Ye(e,t,a[t])}))}return e}function tt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t.push.apply(t,a)}return t}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function at({columns:e,query:t,onSqlChange:a,onParameterChange:o,currentColumnIndex:i}){var l,u,c;const p=(0,s.useStyles2)(rt),b=null===(u=t.sql)||void 0===u||null===(l=u.columns)||void 0===l?void 0:l[i],m=(0,n.useCallback)((e=>{var r,n,o,i;const s=null===(n=t.sql)||void 0===n||null===(r=n.columns)||void 0===r?void 0:r[e];if(!s)return;s.parameters=s.parameters?[...s.parameters,{type:Ke._.FunctionParameter,name:""}]:[];const l=tt(et({},t.sql),{columns:null===(i=t.sql)||void 0===i||null===(o=i.columns)||void 0===o?void 0:o.map(((t,a)=>a===e?s:t))});a(l)}),[a,t.sql]),g=(0,n.useCallback)(((e,r)=>{var n,o,i,s,l;const d=null===(o=t.sql)||void 0===o||null===(n=o.columns)||void 0===n?void 0:n[e];if(!(null==d?void 0:d.parameters))return;d.parameters=null===(i=d.parameters)||void 0===i?void 0:i.filter(((e,t)=>t!==r));const u=tt(et({},t.sql),{columns:null===(l=t.sql)||void 0===l||null===(s=l.columns)||void 0===s?void 0:s.map(((t,a)=>a===e?d:t))});a(u)}),[a,t.sql]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.InlineLabel,{className:p.label,children:"("}),(0,r.jsx)(Ze,{columns:e,onParameterChange:e=>o(0)(e),value:(0,d.oG)(null==b||null===(c=b.parameters)||void 0===c?void 0:c[0])}),(h=i,!(null==b?void 0:b.parameters)||b.parameters.length<=1?null:b.parameters.map(((e,t)=>0===t?null:(0,r.jsxs)(s.Stack,{gap:2,children:[(0,r.jsx)(s.InlineLabel,{className:p.label,children:","}),(0,r.jsx)(s.Input,{onChange:e=>o(t)(e.currentTarget.value),value:e.name,"aria-label":`Parameter ${t} for column ${h}`,"data-testid":f.components.SQLQueryEditor.selectInputParameter,addonAfter:(0,r.jsx)(s.Button,{title:"Remove parameter",type:"button",icon:"times",variant:"secondary",size:"md",onClick:()=>g(h,t)})})]},t)))),(0,r.jsx)(s.Button,{type:"button",onClick:()=>m(i),variant:"secondary",size:"md",icon:"plus",title:"Add parameter"}),(0,r.jsx)(s.InlineLabel,{className:p.label,children:")"})]});var h}const rt=()=>({label:(0,D.css)({padding:0,margin:0,width:"unset"})});function nt(e,t,a,r,n,o,i){try{var s=e[o](i),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,n)}function ot(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function it(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){ot(e,t,a[t])}))}return e}function st(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t.push.apply(t,a)}return t}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function lt({query:e,onSqlChange:t,currentColumnIndex:a,db:o,columns:i}){var l,u;const c=(0,n.useId)(),p=null===(u=e.sql)||void 0===u||null===(l=u.columns)||void 0===l?void 0:l[a],b=(0,s.useStyles2)(dt),m=o.functions().find((e=>e.name===(null==p?void 0:p.name))),[g,h]=(0,n.useState)([]);(0,n.useEffect)((()=>{const t=function(){var t,a=(t=function*(){if(!m)return;const t=[];var a;for(const r of null!==(a=m.parameters)&&void 0!==a?a:[])r.options?t.push(yield r.options(e)):t.push([]);h(t)},function(){var e=this,a=arguments;return new Promise((function(r,n){var o=t.apply(e,a);function i(e){nt(o,r,n,i,s,"next",e)}function s(e){nt(o,r,n,i,s,"throw",e)}i(void 0)}))});return function(){return a.apply(this,arguments)}}();t()}),[null==p?void 0:p.name]);const y=(0,n.useCallback)(((r,n)=>o=>{var i,s,l,d;const u=null===(s=e.sql)||void 0===s||null===(i=s.columns)||void 0===i?void 0:i[a];if(!u)return;if(u.parameters||(u.parameters=[]),void 0===u.parameters[r])u.parameters[r]={type:Ke._.FunctionParameter,name:o};else if(null==o&&n){var c;u.parameters=u.parameters.map(((e,t)=>t===r?st(it({},e),{name:""}):e)),""===(null===(c=u.parameters[u.parameters.length-1])||void 0===c?void 0:c.name)&&(u.parameters=u.parameters.filter((e=>""!==e.name)))}else u.parameters=null==o?u.parameters.filter(((e,t)=>t!==r)):u.parameters.map(((e,t)=>t===r?st(it({},e),{name:o}):e));const p=st(it({},e.sql),{columns:null===(d=e.sql)||void 0===d||null===(l=d.columns)||void 0===l?void 0:l.map(((e,t)=>t===a?u:e))});t(p)}),[a,t,e.sql]);var v;return void 0===(null==p?void 0:p.name)?(0,r.jsx)(Ze,{columns:i,onParameterChange:e=>y(0)(e),value:(0,d.oG)(null==p||null===(v=p.parameters)||void 0===v?void 0:v[0])}):m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.InlineLabel,{className:b.label,children:"("}),(null==m?void 0:m.parameters)?null==m?void 0:m.parameters.map(((e,t)=>{var a;return(0,r.jsxs)(s.Stack,{alignItems:"flex-end",gap:2,children:[(0,r.jsx)(x.c,{label:e.name,width:25,optional:!e.required,children:(0,r.jsx)(r.Fragment,{children:e.options?(0,r.jsx)(s.Select,{value:(0,d.oG)(null==p?void 0:p.parameters[t]),options:null==g?void 0:g[t],"data-testid":f.components.SQLQueryEditor.selectFunctionParameter(e.name),inputId:c,menuShouldPortal:!0,allowCustomValue:!0,isClearable:!0,onChange:e=>y(t,!0)(null==e?void 0:e.value)}):(0,r.jsx)(s.Input,{onChange:e=>y(t,!0)(e.currentTarget.value),value:null==p||null===(a=p.parameters[t])||void 0===a?void 0:a.name,"data-testid":f.components.SQLQueryEditor.selectInputParameter})})}),m.parameters.length!==t+1&&(0,r.jsx)(s.InlineLabel,{className:b.label,children:","})]},t)})):null,(0,r.jsx)(s.InlineLabel,{className:b.label,children:")"})]}):(0,r.jsx)(at,{query:e,onSqlChange:t,currentColumnIndex:a,columns:i,onParameterChange:y})}const dt=()=>({label:(0,D.css)({padding:0,margin:0,width:"unset"})});function ut(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ct(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){ut(e,t,a[t])}))}return e}function pt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t.push.apply(t,a)}return t}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function bt({query:e,onQueryChange:t,db:a,columns:o}){var i,l;const u=(0,s.useStyles2)(mt),{onSqlChange:c}=de({query:e,onQueryChange:t,db:a}),p=[];e.format===C.gv.Timeseries&&(p.push({label:"time",value:"time"}),p.push({label:"value",value:"value"}));const b=(0,n.useCallback)(((t,a)=>r=>{var n,o,i,s;const l=pt(ct({},t),{name:null==r?void 0:r.value,parameters:[{type:Ke._.FunctionParameter,name:(null===(o=t.parameters)||void 0===o||null===(n=o[0])||void 0===n?void 0:n.name)||""}]}),d=pt(ct({},e.sql),{columns:null===(s=e.sql)||void 0===s||null===(i=s.columns)||void 0===i?void 0:i.map(((e,t)=>t===a?l:e))});c(d)}),[c,e.sql]),m=(0,n.useCallback)(((t,a)=>r=>{var n,o;let i=ct({},t);var s;null!==r?i=pt(ct({},t),{alias:`"${null==r||null===(s=r.value)||void 0===s?void 0:s.trim()}"`}):delete i.alias;const l=pt(ct({},e.sql),{columns:null===(o=e.sql)||void 0===o||null===(n=o.columns)||void 0===n?void 0:n.map(((e,t)=>t===a?i:e))});c(l)}),[c,e.sql]),g=(0,n.useCallback)((t=>()=>{var a;const r=[...(null===(a=e.sql)||void 0===a?void 0:a.columns)||[]];r.splice(t,1);const n=pt(ct({},e.sql),{columns:r});c(n)}),[c,e.sql]),h=(0,n.useCallback)((()=>{var t;const a=pt(ct({},e.sql),{columns:[...(null===(t=e.sql)||void 0===t?void 0:t.columns)||[],(0,d.JD)()]});c(a)}),[c,e.sql]),y=()=>{const e=[{label:"Aggregations",options:[]},{label:"Macros",options:[]}];for(const t of a.functions())t.name.startsWith("$__")?e[1].options.push({label:t.name,value:t.name}):e[0].options.push({label:t.name,value:t.name});return e};return(0,r.jsxs)(s.Stack,{gap:2,wrap:"wrap",direction:"column",children:[null===(l=e.sql)||void 0===l||null===(i=l.columns)||void 0===i?void 0:i.map(((t,n)=>(0,r.jsx)("div",{children:(0,r.jsxs)(s.Stack,{gap:2,alignItems:"end",children:[(0,r.jsx)(x.c,{label:"Data operations",optional:!0,width:25,children:(0,r.jsx)(s.Select,{value:t.name?(0,E.toOption)(t.name):null,inputId:`select-aggregation-${n}-${(0,ye.uniqueId)()}`,"data-testid":f.components.SQLQueryEditor.selectAggregation,isClearable:!0,menuShouldPortal:!0,allowCustomValue:!0,options:y(),onChange:b(t,n)})}),(0,r.jsx)(lt,{currentColumnIndex:n,columns:o,onSqlChange:c,query:e,db:a}),(0,r.jsx)(x.c,{label:"Alias",optional:!0,width:15,children:(0,r.jsx)(s.Select,{value:t.alias?(0,E.toOption)(t.alias):null,inputId:`select-alias-${n}-${(0,ye.uniqueId)()}`,"data-testid":f.components.SQLQueryEditor.selectAlias,options:p,onChange:m(t,n),isClearable:!0,menuShouldPortal:!0,allowCustomValue:!0})}),(0,r.jsx)(s.Button,{title:"Remove column",type:"button",icon:"trash-alt",variant:"secondary",size:"md",onClick:g(n)})]})},n))),(0,r.jsx)(s.Button,{type:"button",onClick:h,variant:"secondary",title:"Add column",size:"md",icon:"plus",className:u.addButton})]})}const mt=()=>({addButton:(0,D.css)({alignSelf:"flex-start"}),label:(0,D.css)({padding:0,margin:0,width:"unset"})});function gt(e,t,a,r,n,o,i){try{var s=e[o](i),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,n)}function ht(e){return function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function i(e){gt(o,r,n,i,s,"next",e)}function s(e){gt(o,r,n,i,s,"throw",e)}i(void 0)}))}}const yt=({query:e,db:t,queryRowFilter:a,onChange:n,onValidate:i,range:s})=>{var l;const d=(0,o.A)(ht((function*(){return yield t.fields(e)})),[t,e.dataset,e.table]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(ne.D,{children:[(0,r.jsx)(j.U,{children:(0,r.jsx)(bt,{columns:d.value||[],query:e,onQueryChange:n,db:t})}),a.filter&&(0,r.jsx)(j.U,{children:(0,r.jsx)(x.c,{label:"Filter by column value",optional:!0,children:(0,r.jsx)(Je,{fields:d.value||[],query:e,onQueryChange:n,db:t})})}),a.group&&(0,r.jsx)(j.U,{children:(0,r.jsx)(x.c,{label:"Group by column",children:(0,r.jsx)(he,{fields:d.value||[],query:e,onQueryChange:n,db:t})})}),a.order&&(0,r.jsx)(j.U,{children:(0,r.jsx)(je,{fields:d.value||[],query:e,onQueryChange:n,db:t})}),a.preview&&e.rawSql&&(0,r.jsx)(j.U,{children:(0,r.jsx)(ie,{rawSql:e.rawSql,datasourceType:null===(l=e.datasource)||void 0===l?void 0:l.type})})]}),(0,r.jsx)(te,{db:t,query:e,onValidate:i,range:s})]})};function vt(e,t,a,r,n,o,i){try{var s=e[o](i),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,n)}function ft(e){return function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function i(e){vt(o,r,n,i,s,"next",e)}function s(e){vt(o,r,n,i,s,"throw",e)}i(void 0)}))}}function wt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ot({datasource:e,query:t,onChange:a,onRunQuery:u,range:c,queryHeaderProps:p}){var b,m,g,h,y,v;const[f,w]=(0,n.useState)(!0),O=e.getDB(),{preconfiguredDatabase:S}=e;var j;const x=null!==(j=null==p?void 0:p.dialect)&&void 0!==j?j:"other",{loading:P,error:C}=(0,o.A)(ft((function*(){return()=>{void 0!==e.getDB(e.id).init&&e.getDB(e.id).init()}})),[e]),D=(0,l.T)(t),[q,k]=(0,n.useState)({filter:!!(null===(b=D.sql)||void 0===b?void 0:b.whereString),group:!!(null===(h=D.sql)||void 0===h||null===(g=h.groupBy)||void 0===g||null===(m=g[0])||void 0===m?void 0:m.property.name),order:!!(null===(v=D.sql)||void 0===v||null===(y=v.orderBy)||void 0===y?void 0:y.property.name),preview:!0}),[T,I]=(0,n.useState)(D);(0,n.useEffect)((()=>()=>{void 0!==e.getDB(e.id).dispose&&e.getDB(e.id).dispose()}),[e]);const B=(0,n.useCallback)((e=>{St(e)&&u&&u()}),[u]),V=(e,t=!0)=>{var r,n,o,i;I(e),a(e),(0,d.YW)(null===(r=e.sql)||void 0===r?void 0:r.columns)&&(null===(n=e.sql)||void 0===n?void 0:n.columns.some((e=>e.name)))&&!q.group&&k((o=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){wt(e,t,a[t])}))}return e}({},q),i=null!=(i={group:!0})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t.push.apply(t,a)}return t}(Object(i)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(i,e))})),o)),t&&B(e)};return P||C?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_,{db:O,preconfiguredDataset:S,onChange:e=>{I(e),a(e)},onRunQuery:u,onQueryRowChange:k,queryRowFilter:q,query:D,isQueryRunnable:f,dialect:x}),(0,r.jsx)(s.Space,{v:.5}),D.editorMode!==i.lX.Code&&(0,r.jsx)(yt,{db:O,query:D,onChange:e=>V(e,!1),queryRowFilter:q,onValidate:w,range:c}),D.editorMode===i.lX.Code&&(0,r.jsx)(ae,{db:O,query:D,queryToValidate:T,onChange:V,onRunQuery:u,onValidate:w,range:c})]})}const St=e=>Boolean(e.rawSql)}}]);
//# sourceMappingURL=sql-query-editor.js.map