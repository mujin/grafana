/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","react","@emotion/css","@grafana/runtime","@grafana/ui","lodash","rxjs","rxjs/operators"],((e,t,n,a,r,o,i,s)=>(()=>{"use strict";var l={44:(e,t,n)=>{var a=n(959),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var a,o={},c=null,u=null;for(a in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,a)&&!l.hasOwnProperty(a)&&(o[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===o[a]&&(o[a]=t[a]);return{$$typeof:r,type:e,key:c,ref:u,props:o,_owner:s.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},728:(e,t,n)=>{e.exports=n(44)},89:e=>{e.exports=n},781:t=>{t.exports=e},531:e=>{e.exports=a},7:e=>{e.exports=r},241:e=>{e.exports=o},959:e=>{e.exports=t},269:e=>{e.exports=i},59:e=>{e.exports=s}},c={};function u(e){var t=c[e];if(void 0!==t)return t.exports;var n=c[e]={exports:{}};return l[e](n,n.exports,u),n.exports}u.d=(e,t)=>{for(var n in t)u.o(t,n)&&!u.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var d={};u.r(d),u.d(d,{plugin:()=>ft});var p=u(781),h=u(728),m=u(89),g=u(959),f=u(7);const y=({children:e,title:t,description:n,isCollapsible:a=!1,isInitiallyOpen:r=!0,kind:o="section",className:i})=>{const{colors:s,typography:l,spacing:c}=(0,f.useTheme2)(),[u,d]=(0,g.useState)(!a||r),p=u?"angle-up":"angle-down",h="sub-section"===o,y=`${u?"Collapse":"Expand"} section ${t}`,b={header:(0,m.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,m.css)({margin:0}),subtitle:(0,m.css)({margin:0,fontWeight:l.fontWeightRegular}),descriptionText:(0,m.css)({marginTop:c(h?.25:.5),marginBottom:0,...l.bodySmall,color:s.text.secondary}),content:(0,m.css)({marginTop:c(2)})};return g.createElement("div",{className:i},g.createElement("div",{className:b.header},"section"===o?g.createElement("h3",{className:b.title},t):g.createElement("h6",{className:b.subtitle},t),a&&g.createElement(f.IconButton,{name:p,onClick:()=>d(!u),type:"button",size:"xl","aria-label":y})),n&&g.createElement("p",{className:b.descriptionText},n),u&&g.createElement("div",{className:b.content},e))},b=({children:e,...t})=>g.createElement(y,{...t,kind:"section"},e);function v(e){const{description:t,suffix:n,feature:a}=e,r=`Learn more about ${a}`,o=(0,f.useStyles2)(O);return g.createElement("span",{className:o.container},t,g.createElement("a",{"aria-label":r,href:`https://grafana.com/docs/grafana/next/datasources/${n}`,rel:"noreferrer",target:"_blank"},r))}const O=e=>({container:(0,m.css)({color:e.colors.text.secondary,a:(0,m.css)({color:e.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})});var j=u(531);const w=/^(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])$/,D=(e,t=w)=>!(e.match(t)||!e);function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const C=e=>{const[t,n]=(0,g.useState)((()=>!!e.value&&D(e.value,e.validationRegex)));var a;!function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=[]);var a=function(e,t){void 0===t&&(t=0);var n=(0,g.useRef)(!1),a=(0,g.useRef)(),r=(0,g.useRef)(e),o=(0,g.useCallback)((function(){return n.current}),[]),i=(0,g.useCallback)((function(){n.current=!1,a.current&&clearTimeout(a.current),a.current=setTimeout((function(){n.current=!0,r.current()}),t)}),[t]),s=(0,g.useCallback)((function(){n.current=null,a.current&&clearTimeout(a.current)}),[]);return(0,g.useEffect)((function(){r.current=e}),[e]),(0,g.useEffect)((function(){return i(),s}),[t]),[o,s,i]}(e,t),r=a[0],o=a[1],i=a[2];(0,g.useEffect)(i,n)}((()=>{n(D(e.value,e.validationRegex))}),500,[e.value]);const r={labelWidth:26,disabled:null!==(a=e.disabled)&&void 0!==a&&a,invalid:t,error:e.isInvalidError};return e.label&&(r.label=e.label,r.tooltip=e.tooltip||""),(0,h.jsx)(f.InlineField,(o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){T(e,t,n[t])}))}return e}({},r),i=null!=(i={children:(0,h.jsx)(f.Input,{type:"text",placeholder:e.placeholder||"0",width:e.width||40,onChange:t=>{e.onChange(t.currentTarget.value)},value:e.value,"aria-label":e.ariaLabel||"interval input"})})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(i)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(i,e))})),o));var o,i};function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){x(e,t,n[t])}))}return e}function S(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const N=({values:e,onChange:t,id:n})=>{const a=(0,f.useStyles2)(I);return(0,h.jsx)("div",{className:a.wrapper,children:e.length?e.map(((r,o)=>(0,h.jsxs)("div",{className:a.pair,children:[(0,h.jsx)(f.SegmentInput,{id:`${n}-key-${o}`,placeholder:"Tag name",value:r.key,onChange:n=>{t(e.map(((e,t)=>t===o?S(F({},e),{key:String(n)}):e)))}}),(0,h.jsx)(f.InlineLabel,{"aria-label":"equals",className:a.operator,children:"as"}),(0,h.jsx)(f.SegmentInput,{id:`${n}-value-${o}`,placeholder:"New name (optional)",value:r.value||"",onChange:n=>{t(e.map(((e,t)=>t===o?S(F({},e),{value:String(n)}):e)))}}),(0,h.jsx)(f.ToolbarButton,{onClick:()=>t([...e.slice(0,o),...e.slice(o+1)]),className:(0,m.cx)(a.removeTag,"query-part"),"aria-label":"Remove tag",type:"button",icon:"times"}),o===e.length-1?(0,h.jsx)(f.ToolbarButton,{onClick:()=>t([...e,{key:"",value:""}]),className:"query-part","aria-label":"Add tag",type:"button",icon:"plus"}):null]},o))):(0,h.jsx)(f.ToolbarButton,{icon:"plus",onClick:()=>t([...e,{key:"",value:""}]),className:"query-part","aria-label":"Add tag",type:"button"})})},I=e=>({wrapper:(0,m.css)({display:"flex",flexDirection:"column",gap:`${e.spacing(.5)} 0`}),pair:(0,m.css)({display:"flex",justifyContent:"start",alignItems:"center"}),operator:(0,m.css)({color:e.v1.palette.orange,width:"auto"}),removeTag:(0,m.css)({marginRight:e.spacing(.5)})});function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){E(e,t,n[t])}))}return e}function k(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function A({options:e,onOptionsChange:t}){const n=["loki","elasticsearch","grafana-splunk-datasource","grafana-opensearch-datasource","grafana-falconlogscale-datasource","googlecloud-logging-datasource"],a=(0,g.useMemo)((()=>function(e){var t;if(null==e?void 0:e.tracesToLogsV2)return e.tracesToLogsV2;if(!(null==e?void 0:e.tracesToLogs))return;const n={customQuery:!1};return n.datasourceUid=e.tracesToLogs.datasourceUid,n.tags=e.tracesToLogs.mapTagNamesEnabled?e.tracesToLogs.mappedTags:null===(t=e.tracesToLogs.tags)||void 0===t?void 0:t.map((e=>({key:e}))),n.filterByTraceID=e.tracesToLogs.filterByTraceID,n.filterBySpanID=e.tracesToLogs.filterBySpanID,n.spanStartTimeShift=e.tracesToLogs.spanStartTimeShift,n.spanEndTimeShift=e.tracesToLogs.spanEndTimeShift,n}(e.jsonData)||{customQuery:!1}),[e.jsonData]),{query:r="",tags:o,customQuery:i}=a,s=(0,g.useCallback)((n=>{t(k(P({},e),{jsonData:k(P({},e.jsonData),{tracesToLogsV2:P({},a,n),tracesToLogs:void 0})}))}),[t,e,a]);return(0,h.jsxs)("div",{className:(0,m.css)({width:"100%"}),children:[(0,h.jsx)(f.InlineFieldRow,{children:(0,h.jsx)(f.InlineField,{tooltip:"The logs data source the trace is going to navigate to",label:"Data source",labelWidth:26,children:(0,h.jsx)(j.DataSourcePicker,{inputId:"trace-to-logs-data-source-picker",filter:e=>n.includes(e.type),current:a.datasourceUid,noDefault:!0,width:40,onChange:e=>s({datasourceUid:e.uid}),onClear:()=>s({datasourceUid:void 0})})})}),(0,h.jsx)(f.InlineFieldRow,{children:(0,h.jsx)(C,{label:q("start"),tooltip:M("start","0"),value:a.spanStartTimeShift||"",onChange:e=>{s({spanStartTimeShift:e})},isInvalidError:B})}),(0,h.jsx)(f.InlineFieldRow,{children:(0,h.jsx)(C,{label:q("end"),tooltip:M("end","0"),value:a.spanEndTimeShift||"",onChange:e=>{s({spanEndTimeShift:e})},isInvalidError:B})}),(0,h.jsx)(f.InlineFieldRow,{children:(0,h.jsx)(f.InlineField,{tooltip:"Tags that will be used in the query. Default tags: 'cluster', 'hostname', 'namespace', 'pod', 'service.name', 'service.namespace'",label:"Tags",labelWidth:26,children:(0,h.jsx)(N,{values:null!=o?o:[],onChange:e=>s({tags:e})})})}),(0,h.jsx)(R,{disabled:i,type:"trace",id:"filterByTraceID",value:Boolean(a.filterByTraceID),onChange:e=>s({filterByTraceID:e})}),(0,h.jsx)(R,{disabled:i,type:"span",id:"filterBySpanID",value:Boolean(a.filterBySpanID),onChange:e=>s({filterBySpanID:e})}),(0,h.jsx)(f.InlineFieldRow,{children:(0,h.jsx)(f.InlineField,{tooltip:"Use a custom query with the possibility to interpolate variables from the trace or span",label:"Use custom query",labelWidth:26,children:(0,h.jsx)(f.InlineSwitch,{id:"customQuerySwitch",value:i,onChange:e=>s({customQuery:e.currentTarget.checked})})})}),i&&(0,h.jsx)(f.InlineField,{label:"Query",labelWidth:26,tooltip:"The query that will run when navigating from a trace to logs data source. Interpolate tags using the `$__tags` keyword",grow:!0,children:(0,h.jsx)(f.Input,{label:"Query",type:"text",allowFullScreen:!0,value:r,onChange:e=>s({query:e.currentTarget.value})})})]})}function R(e){return(0,h.jsx)(f.InlineFieldRow,{children:(0,h.jsx)(f.InlineField,{disabled:e.disabled,label:`Filter by ${e.type} ID`,labelWidth:26,grow:!0,tooltip:`Filters logs by ${e.type} ID, where the ${e.type} ID should be part of the log line`,children:(0,h.jsx)(f.InlineSwitch,{id:e.id,value:e.value,onChange:t=>e.onChange(t.currentTarget.checked)})})})}const q=e=>`Span ${e} time shift`,M=(e,t)=>`Shifts the ${e} time of the span. Default: ${t} (Time units can be used here, for example: 5s, -1m, 3h)`,B="Invalid time shift. See tooltip for examples.",J=({options:e,onOptionsChange:t})=>{let n=e.type;return n+="tempo"===e.type?"/configure-tempo-data-source/#trace-to-logs":"/#trace-to-logs",(0,h.jsx)(b,{title:"Trace to logs",description:(0,h.jsx)(v,{description:"Navigate from a trace span to the selected data source's logs.",suffix:n,feature:"trace to logs"}),isCollapsible:!0,isInitiallyOpen:!0,children:(0,h.jsx)(A,{options:e,onOptionsChange:t})})};function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){L(e,t,n[t])}))}return e}function G(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function $({options:e,onOptionsChange:t}){var n,a,r,o,i,s;const l=(0,f.useStyles2)(U);var c;return(0,h.jsxs)("div",{className:(0,m.css)({width:"100%"}),children:[(0,h.jsx)(f.InlineFieldRow,{className:l.row,children:(0,h.jsx)(f.InlineField,{tooltip:"The Prometheus data source the trace is going to navigate to",label:"Data source",labelWidth:26,children:(0,h.jsx)(j.DataSourcePicker,{inputId:"trace-to-metrics-data-source-picker",pluginId:"prometheus",current:null===(n=e.jsonData.tracesToMetrics)||void 0===n?void 0:n.datasourceUid,noDefault:!0,width:40,onChange:n=>(0,p.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",G(W({},e.jsonData.tracesToMetrics),{datasourceUid:n.uid})),onClear:()=>(0,p.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",G(W({},e.jsonData.tracesToMetrics),{datasourceUid:void 0}))})})}),(0,h.jsx)(f.InlineFieldRow,{children:(0,h.jsx)(C,{label:q("start"),tooltip:M("start","-2m"),value:(null===(a=e.jsonData.tracesToMetrics)||void 0===a?void 0:a.spanStartTimeShift)||"",onChange:n=>{(0,p.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",G(W({},e.jsonData.tracesToMetrics),{spanStartTimeShift:n}))},placeholder:"-2m",isInvalidError:B})}),(0,h.jsx)(f.InlineFieldRow,{children:(0,h.jsx)(C,{label:q("end"),tooltip:M("end","2m"),value:(null===(r=e.jsonData.tracesToMetrics)||void 0===r?void 0:r.spanEndTimeShift)||"",onChange:n=>{(0,p.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",G(W({},e.jsonData.tracesToMetrics),{spanEndTimeShift:n}))},placeholder:"2m",isInvalidError:B})}),(0,h.jsx)(f.InlineFieldRow,{children:(0,h.jsx)(f.InlineField,{tooltip:"Tags that will be used in the metrics query",label:"Tags",labelWidth:26,children:(0,h.jsx)(N,{values:null!==(c=null===(o=e.jsonData.tracesToMetrics)||void 0===o?void 0:o.tags)&&void 0!==c?c:[],onChange:n=>(0,p.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",G(W({},e.jsonData.tracesToMetrics),{tags:n}))})})}),null===(s=e.jsonData.tracesToMetrics)||void 0===s||null===(i=s.queries)||void 0===i?void 0:i.map(((n,a)=>(0,h.jsxs)("div",{className:l.queryRow,children:[(0,h.jsx)(f.InlineField,{label:"Link Label",labelWidth:26,tooltip:"Descriptive label for the linked query",children:(0,h.jsx)(f.Input,{label:"Link Label",type:"text",allowFullScreen:!0,value:n.name,width:40,onChange:n=>{var r,o;const i=(null!==(o=null===(r=e.jsonData.tracesToMetrics)||void 0===r?void 0:r.queries)&&void 0!==o?o:[]).map(((e,t)=>t===a?G(W({},e),{name:n.currentTarget.value}):e));(0,p.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",G(W({},e.jsonData.tracesToMetrics),{queries:i}))}})}),(0,h.jsx)(f.InlineField,{label:"Query",labelWidth:10,tooltip:"The Prometheus query that will run when navigating from a trace to metrics. Interpolate tags using the `$__tags` keyword",grow:!0,children:(0,h.jsx)(f.Input,{label:"Query",type:"text",allowFullScreen:!0,value:n.query,onChange:n=>{var r,o;const i=(null!==(o=null===(r=e.jsonData.tracesToMetrics)||void 0===r?void 0:r.queries)&&void 0!==o?o:[]).map(((e,t)=>t===a?G(W({},e),{query:n.currentTarget.value}):e));(0,p.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",G(W({},e.jsonData.tracesToMetrics),{queries:i}))}})}),(0,h.jsx)(f.Button,{variant:"destructive",title:"Remove query",icon:"times",type:"button",onClick:()=>{var n;const r=null===(n=e.jsonData.tracesToMetrics)||void 0===n?void 0:n.queries.filter(((e,t)=>t!==a));(0,p.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",G(W({},e.jsonData.tracesToMetrics),{queries:r}))}})]},a))),(0,h.jsx)(f.Button,{variant:"secondary",title:"Add query",icon:"plus",type:"button",onClick:()=>{var n,a;(0,p.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"tracesToMetrics",G(W({},e.jsonData.tracesToMetrics),{queries:[...null!==(a=null===(n=e.jsonData.tracesToMetrics)||void 0===n?void 0:n.queries)&&void 0!==a?a:[],{query:""}]}))},children:"Add query"})]})}const _=({options:e,onOptionsChange:t})=>{let n=e.type;return n+="tempo"===e.type?"/configure-tempo-data-source/#trace-to-metrics":"/#trace-to-metrics",(0,h.jsx)(b,{title:"Trace to metrics",description:(0,h.jsx)(v,{description:"Navigate from a trace span to the selected data source's metrics.",suffix:n,feature:"trace to metrics"}),isCollapsible:!0,isInitiallyOpen:!0,children:(0,h.jsx)($,{options:e,onOptionsChange:t})})},U=e=>({infoText:{paddingBottom:e.spacing(2),color:e.colors.text.secondary},row:(0,m.css)({label:"row",alignItems:"baseline"}),queryRow:(0,m.css)({label:"queryRow",display:"flex",flexFlow:"wrap"})}),V=({children:e,...t})=>g.createElement(y,{...t,kind:"sub-section"},e);function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q({options:e,onOptionsChange:t}){var n;const a=(0,f.useStyles2)(K);return(0,h.jsx)("div",{className:a.container,children:(0,h.jsx)(f.InlineFieldRow,{className:a.row,children:(0,h.jsx)(f.InlineField,{tooltip:"Displays the node graph above the trace view. Default: disabled",label:"Enable node graph",labelWidth:26,children:(0,h.jsx)(f.InlineSwitch,{id:"enableNodeGraph",value:null===(n=e.jsonData.nodeGraph)||void 0===n?void 0:n.enabled,onChange:n=>{return(0,p.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"nodeGraph",(a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){H(e,t,n[t])}))}return e}({},e.jsonData.nodeGraph),r=null!=(r={enabled:n.currentTarget.checked})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(r)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(r,e))})),a));var a,r}})})})})}const z=({options:e,onOptionsChange:t})=>{let n=e.type;return n+="tempo"===e.type?"/configure-tempo-data-source/#node-graph":"/#node-graph",(0,h.jsx)(V,{title:"Node graph",description:(0,h.jsx)(v,{description:"Show or hide the node graph visualization.",suffix:n,feature:"the node graph"}),children:(0,h.jsx)(Q,{options:e,onOptionsChange:t})})},K=e=>({infoText:(0,m.css)({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),container:(0,m.css)({label:"container",width:"100%"}),row:(0,m.css)({label:"row",alignItems:"baseline"})});function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){Z(e,t,n[t])}))}return e}function X(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const ee="None",te="Duration",ne="Tag";function ae({options:e,onOptionsChange:t}){var n,a,r;const o=(0,f.useStyles2)(oe),i=[ee,te,ne].map(p.toOption);return(0,h.jsxs)("div",{className:(0,m.css)({width:"100%"}),children:[(0,h.jsx)(f.InlineFieldRow,{className:o.row,children:(0,h.jsx)(f.InlineField,{label:"Label",labelWidth:26,tooltip:"Default: duration",grow:!0,children:(0,h.jsx)(f.Select,{inputId:"label",options:i,value:(null===(n=e.jsonData.spanBar)||void 0===n?void 0:n.type)||"",onChange:n=>{var a;(0,p.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"spanBar",X(Y({},e.jsonData.spanBar),{type:null!==(a=null==n?void 0:n.value)&&void 0!==a?a:""}))},placeholder:"Duration",isClearable:!0,"aria-label":"select-label-name",width:40})})}),(null===(a=e.jsonData.spanBar)||void 0===a?void 0:a.type)===ne&&(0,h.jsx)(f.InlineFieldRow,{className:o.row,children:(0,h.jsx)(f.InlineField,{label:"Tag key",labelWidth:26,tooltip:"Tag key which will be used to get the tag value. A span's attributes and resources will be searched for the tag key",children:(0,h.jsx)(f.Input,{type:"text",placeholder:"Enter tag key",onChange:n=>(0,p.updateDatasourcePluginJsonDataOption)({onOptionsChange:t,options:e},"spanBar",X(Y({},e.jsonData.spanBar),{tag:n.currentTarget.value})),value:(null===(r=e.jsonData.spanBar)||void 0===r?void 0:r.tag)||"",width:40})})})]})}const re=({options:e,onOptionsChange:t})=>{let n=e.type;return n+="tempo"===e.type?"/configure-tempo-data-source/#span-bar":"/#span-bar",(0,h.jsx)(V,{title:"Span bar",description:(0,h.jsx)(v,{description:"Add additional info next to the service and operation on a span bar row in the trace view.",suffix:n,feature:"the span bar"}),children:(0,h.jsx)(ae,{options:e,onOptionsChange:t})})},oe=e=>({infoText:(0,m.css)({label:"infoText",paddingBottom:e.spacing(2),color:e.colors.text.secondary}),row:(0,m.css)({label:"row",alignItems:"baseline"})}),ie=({dataSourceName:e,docsLink:t,hasRequiredFields:n=!0,className:a})=>{const r=(0,f.useTheme2)(),o={container:(0,m.css)({p:{margin:0},"p + p":{marginTop:r.spacing(2)}}),text:(0,m.css)({...r.typography.body,color:r.colors.text.secondary,a:(0,m.css)({color:r.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})})};return g.createElement("div",{className:(0,m.cx)(o.container,a)},g.createElement("p",{className:o.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",g.createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),n&&g.createElement("p",{className:o.text},g.createElement("i",null,"Fields marked with * are required")))},se=({config:e,onChange:t,description:n,urlPlaceholder:a,urlTooltip:r,urlLabel:o,className:i})=>{const s=void 0!==e.url&&/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(e.url),l={container:(0,m.css)({maxWidth:578})};return g.createElement(g.Fragment,null,g.createElement(b,{title:"Connection",description:n,className:(0,m.cx)(l.container,i)},g.createElement(f.InlineField,{htmlFor:"connection-url",label:o||"URL",labelWidth:24,tooltip:r||g.createElement(g.Fragment,null,"Specify a complete HTTP URL",g.createElement("br",null),"(for example https://example.com:8080)"),grow:!0,disabled:e.readOnly,required:!0,invalid:!s&&!e.readOnly,error:s?"":"Please enter a valid URL",interactive:!0},g.createElement(f.Input,{id:"connection-url","aria-label":"Data source connection URL",onChange:n=>t({...e,url:n.currentTarget.value}),value:e.url||"",placeholder:a||"URL"}))))},le=()=>({inlineFieldNoMarginRight:(0,m.css)({marginRight:0}),inlineFieldWithSecret:(0,m.css)({'[class$="layoutChildrenWrapper"]:first-child':{flexGrow:1}})}),ce=({user:e,passwordConfigured:t,userLabel:n="User",userTooltip:a="The username of the data source account",userPlaceholder:r="User",passwordLabel:o="Password",passwordTooltip:i="The password of the data source account",passwordPlaceholder:s="Password",onUserChange:l,onPasswordChange:c,onPasswordReset:u,readOnly:d})=>{const p=le(),h={lastInlineField:(0,m.css)({marginBottom:0})};return g.createElement(g.Fragment,null,g.createElement(f.InlineField,{className:p.inlineFieldNoMarginRight,label:n,labelWidth:24,tooltip:a,required:!0,htmlFor:"basic-auth-user-input",interactive:!0,grow:!0,disabled:d},g.createElement(f.Input,{id:"basic-auth-user-input",placeholder:r,value:e,onChange:e=>l(e.currentTarget.value),required:!0})),g.createElement(f.InlineField,{className:(0,m.cx)(p.inlineFieldNoMarginRight,p.inlineFieldWithSecret,h.lastInlineField),label:o,labelWidth:24,tooltip:i,required:!0,htmlFor:"basic-auth-password-input",interactive:!0,grow:!0,disabled:d},g.createElement(f.SecretInput,{id:"basic-auth-password-input",isConfigured:t,onReset:d?()=>{}:u,placeholder:s,onChange:e=>c(e.currentTarget.value),required:!0})))};var ue=(e=>(e.NoAuth="NoAuth",e.BasicAuth="BasicAuth",e.OAuthForward="OAuthForward",e.CrossSiteCredentials="CrossSiteCredentials",e))(ue||{});const de={[ue.BasicAuth]:{label:"Basic authentication",value:ue.BasicAuth,description:"Authenticate with your data source username and password"},[ue.CrossSiteCredentials]:{label:"Enable cross-site access control requests",value:ue.CrossSiteCredentials,description:"Allow cross-site Access-Control requests with your existing credentials and cookies. This enables the server to authenticate the user and perform authorized requests on their behalf on other domains."},[ue.OAuthForward]:{label:"Forward OAuth Identity",value:ue.OAuthForward,description:"Forward the OAuth access token (and if available: the OIDC ID token) of the user querying to the data source"},[ue.NoAuth]:{label:"No Authentication",value:ue.NoAuth,description:"Data source is available without authentication"}},pe=({selectedMethod:e,mostCommonMethod:t,visibleMethods:n,defaultOptionsOverrides:a,customMethods:r,onAuthMethodSelect:o,basicAuth:i,readOnly:s})=>{var l,c,u,d;const[p,h]=(0,g.useState)(!1),{colors:y,spacing:b}=(0,f.useTheme2)(),v=(0,g.useMemo)((()=>{var e;return null!=n?n:[ue.BasicAuth,ue.OAuthForward,ue.NoAuth,...null!=(e=null==r?void 0:r.map((e=>e.id)))?e:[]]}),[r,n]),O=v.length>1,j=(0,g.useMemo)((()=>{var e;const n=null!=(e=null==r?void 0:r.reduce(((e,t)=>(e[t.id]={label:t.label,value:t.id,description:t.description},e)),{}))?e:{},o={};let i;for(i in de)o[i]={...de[i],...null==a?void 0:a[i]};const s={...n,...o};return v.filter((e=>Boolean(s[e]))).map((e=>{const n=s[e];return e===t&&O?{...n,label:`${n.label} (most common)`}:n}))}),[v,r,a,t,O]);let w=e;O?e===ue.NoAuth&&t&&!p&&(w=t):w=v[0];let D=null;w===ue.BasicAuth&&i?D=g.createElement(ce,{...i,readOnly:s}):w.startsWith("custom-")&&(D=null!=(c=null==(l=null==r?void 0:r.find((e=>e.id===w)))?void 0:l.component)?c:null);const T=O?"Authentication methods":null!=(u=j[0].label)?u:"",C=O?"Choose an authentication method to access the data source":null!=(d=j[0].description)?d:"",x={authMethods:(0,m.css)({marginTop:b(2.5),...O&&{padding:b(2),border:`1px solid ${y.border.weak}`}}),selectedMethodFields:(0,m.css)({marginTop:b(1.5)})};return g.createElement(V,{title:T,description:C},g.createElement("div",{className:x.authMethods},O&&g.createElement(f.Field,{label:"Authentication method"},g.createElement(f.Select,{inputId:"auth-method-select",options:j,value:w,onChange:e=>{h(!0),o(e.value)},disabled:s})),D&&g.createElement("div",{className:x.selectedMethodFields},D)))},he=({children:e,enabled:t,label:n,tooltipText:a,onToggle:r,readOnly:o})=>{const{colors:i,spacing:s}=(0,f.useTheme2)(),l={container:(0,m.css)({marginTop:3}),checkboxContainer:(0,m.css)({display:"flex",alignItems:"center"}),infoIcon:(0,m.css)({marginTop:-2,marginLeft:5,color:i.text.secondary}),content:(0,m.css)({margin:s(1,0,2,3)})};return g.createElement("div",{className:l.container},g.createElement("div",{className:l.checkboxContainer},g.createElement(f.Checkbox,{value:t,label:n,onChange:()=>r(!t),disabled:o}),g.createElement(f.Tooltip,{placement:"top",content:a,interactive:!0},g.createElement(f.Icon,{name:"info-circle",className:l.infoIcon,size:"sm"}))),t&&e&&g.createElement("div",{className:l.content},e))},me=({enabled:e,certificateConfigured:t,onToggle:n,onCertificateChange:a,onCertificateReset:r,tooltips:o,readOnly:i})=>{var s;const l=le();return g.createElement(he,{enabled:e,label:"Add self-signed certificate",tooltipText:"Add your own Certificate Authority (CA) certificate on top of one generated by the certificate authorities for additional security measures",onToggle:e=>n(e),readOnly:i},g.createElement(f.InlineField,{label:"CA Certificate",labelWidth:24,tooltip:null!=(s=null==o?void 0:o.certificateLabel)?s:"Your self-signed certificate",required:!0,htmlFor:"self-signed-certificate-input",interactive:!0,grow:!0,className:(0,m.cx)(l.inlineFieldNoMarginRight,l.inlineFieldWithSecret),disabled:i},g.createElement(f.SecretTextArea,{id:"self-signed-certificate-input",isConfigured:t,onChange:e=>a(e.currentTarget.value),onReset:i?()=>{}:r,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})))},ge=({enabled:e,serverName:t,clientCertificateConfigured:n,clientKeyConfigured:a,onToggle:r,onServerNameChange:o,onClientCertificateChange:i,onClientKeyChange:s,onClientCertificateReset:l,onClientKeyReset:c,tooltips:u,readOnly:d})=>{var p,h,y;const b=le();return g.createElement(he,{enabled:e,label:"TLS Client Authentication",tooltipText:"Validate using TLS client authentication, in which the server authenticates the client",onToggle:e=>r(e),readOnly:d},g.createElement(f.InlineField,{label:"ServerName",labelWidth:24,tooltip:null!=(p=null==u?void 0:u.serverNameLabel)?p:"A Servername is used to verify the hostname on the returned certificate",required:!0,htmlFor:"client-auth-servername-input",interactive:!0,grow:!0,className:b.inlineFieldNoMarginRight,disabled:d},g.createElement(f.Input,{id:"client-auth-servername-input",placeholder:"domain.example.com",value:t,onChange:e=>o(e.currentTarget.value),required:!0})),g.createElement(f.InlineField,{label:"Client Certificate",labelWidth:24,tooltip:null!=(h=null==u?void 0:u.certificateLabel)?h:"The client certificate can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-certificate-input",interactive:!0,grow:!0,className:(0,m.cx)(b.inlineFieldNoMarginRight,b.inlineFieldWithSecret),disabled:d},g.createElement(f.SecretTextArea,{id:"client-auth-client-certificate-input",isConfigured:n,onChange:e=>i(e.currentTarget.value),onReset:d?()=>{}:l,placeholder:"Begins with --- BEGIN CERTIFICATE ---",rows:6,required:!0})),g.createElement(f.InlineField,{label:"Client Key",labelWidth:24,tooltip:null!=(y=null==u?void 0:u.keyLabel)?y:"The client key can be generated from a Certificate Authority or be self-signed",required:!0,htmlFor:"client-auth-client-key-input",interactive:!0,grow:!0,className:(0,m.cx)(b.inlineFieldNoMarginRight,b.inlineFieldWithSecret),disabled:d},g.createElement(f.SecretTextArea,{id:"client-auth-client-key-input",isConfigured:a,onChange:e=>s(e.currentTarget.value),onReset:d?()=>{}:c,placeholder:"Begins with --- RSA PRIVATE KEY CERTIFICATE ---",rows:6,required:!0})))},fe=({enabled:e,onToggle:t,readOnly:n})=>g.createElement(he,{enabled:e,label:"Skip TLS certificate validation",tooltipText:"Skipping TLS certificate validation is not recommended unless absolutely necessary or for testing",onToggle:e=>t(e),readOnly:n}),ye=({selfSignedCertificate:e,TLSClientAuth:t,skipTLSVerification:n,readOnly:a})=>{const{spacing:r}=(0,f.useTheme2)(),o={container:(0,m.css)({marginTop:r(3)})};return g.createElement(V,{className:o.container,title:"TLS settings",description:"Additional security measures that can be applied on top of authentication"},g.createElement(me,{...e,readOnly:a}),g.createElement(ge,{...t,readOnly:a}),g.createElement(fe,{...n,readOnly:a}))},be=({header:e,onChange:t,onBlur:n,onDelete:a,readOnly:r})=>{const{spacing:o}=(0,f.useTheme2)(),i=le(),s={container:(0,m.css)({alignItems:"center"}),input:(0,m.css)({minWidth:"100%"}),headerNameField:(0,m.css)({width:"40%",marginRight:0,paddingRight:o(1)}),headerValueField:(0,m.css)({width:"45%",marginRight:0}),removeHeaderBtn:(0,m.css)({margin:"0 0 3px 10px"})};return g.createElement(g.Fragment,null,g.createElement(f.InlineFieldRow,{className:s.container},g.createElement(f.InlineField,{label:"Header",labelWidth:9,grow:!0,className:s.headerNameField,htmlFor:`custom-header-${e.id}-name-input`,disabled:r},g.createElement(f.Input,{id:`custom-header-${e.id}-name-input`,placeholder:"X-Custom-Header",value:e.name,width:12,onChange:n=>t({...e,name:n.currentTarget.value}),onBlur:n,className:s.input})),g.createElement(f.InlineField,{label:"Value",labelWidth:9,grow:!0,className:(0,m.cx)(i.inlineFieldWithSecret,s.headerValueField),htmlFor:`custom-header-${e.id}-value-input`,disabled:r},g.createElement(f.SecretInput,{id:`custom-header-${e.id}-value-input`,isConfigured:e.configured,placeholder:"Header value",value:e.value,width:12,onChange:n=>t({...e,value:n.currentTarget.value}),onReset:r?()=>{}:()=>t({...e,configured:!1,value:""}),onBlur:n,className:s.input})),g.createElement(f.IconButton,{name:"trash-alt",tooltip:"Remove header",tooltipPlacement:"top",className:s.removeHeaderBtn,onClick:a,type:"button",disabled:r})))},ve=({headers:e,onChange:t,readOnly:n})=>{const{spacing:a}=(0,f.useTheme2)(),[r,o]=(0,g.useState)(e.map((e=>({...e,id:Oe(),value:""}))));(0,g.useEffect)((()=>{o((t=>{let n=!1;const a=t.map((t=>{var a;const r=null==(a=e.find((e=>e.name===t.name)))?void 0:a.configured;return void 0!==r&&t.configured!==r?(n=!0,{...t,configured:r}):t}));return n?a:t}))}),[e]);const i=()=>{t(r.map((({name:e,value:t,configured:n})=>({name:e,value:t,configured:n}))))},s={container:(0,m.css)({marginTop:a(3)}),addHeaderButton:(0,m.css)({marginTop:a(1.5)})};return g.createElement("div",{className:s.container},g.createElement(V,{title:"HTTP headers",description:"Pass along additional context and metadata about the request/response",isCollapsible:!0,isInitiallyOpen:r.length>0},g.createElement("div",null,r.map((e=>g.createElement(be,{key:e.id,header:e,onChange:e=>((e,t)=>{o(r.map((n=>n.id===e?{...t}:n)))})(e.id,e),onDelete:()=>(e=>{const n=r.findIndex((t=>t.id===e));if(-1===n)return;const a=[...r];a.splice(n,1),o(a),t(a.map((({name:e,value:t,configured:n})=>({name:e,value:t,configured:n}))))})(e.id),onBlur:i,readOnly:n})))),g.createElement("div",{className:s.addHeaderButton},g.createElement(f.Button,{icon:"plus",variant:"secondary",fill:"outline",onClick:()=>{o([...r,{id:Oe(),name:"",value:"",configured:!1}])},disabled:n},0===r.length?"Add header":"Add another header"))))};function Oe(){return Math.random().toString(16).slice(2)}const je=({selectedMethod:e,mostCommonMethod:t,visibleMethods:n,defaultOptionsOverrides:a,customMethods:r,onAuthMethodSelect:o,basicAuth:i,TLS:s,customHeaders:l,readOnly:c=!1})=>{const u={container:(0,m.css)({maxWidth:578})};return g.createElement("div",{className:u.container},g.createElement(b,{title:"Authentication"},g.createElement(pe,{selectedMethod:e,mostCommonMethod:t,customMethods:r,visibleMethods:n,defaultOptionsOverrides:a,onAuthMethodSelect:o,basicAuth:i,readOnly:c}),s&&g.createElement(ye,{...s,readOnly:c}),l&&g.createElement(ve,{...l,readOnly:c})))},we="httpHeaderName",De="httpHeaderValue";function Te({config:e,onChange:t}){return{selectedMethod:Ce(e),onAuthMethodSelect:xe(e,t),basicAuth:Fe(e,t),TLS:Se(e,t),customHeaders:Ne(e,t),readOnly:e.readOnly}}function Ce(e){return e.basicAuth?ue.BasicAuth:e.withCredentials?ue.CrossSiteCredentials:e.jsonData.oauthPassThru?ue.OAuthForward:ue.NoAuth}function xe(e,t){return n=>{t({...e,basicAuth:n===ue.BasicAuth,withCredentials:n===ue.CrossSiteCredentials,jsonData:{...e.jsonData,oauthPassThru:n===ue.OAuthForward}})}}function Fe(e,t){return{user:e.basicAuthUser,passwordConfigured:e.secureJsonFields.basicAuthPassword,onUserChange:n=>t({...e,basicAuthUser:n}),onPasswordChange:n=>t({...e,secureJsonData:{...e.secureJsonData,basicAuthPassword:n}}),onPasswordReset:()=>t({...e,secureJsonData:{...e.secureJsonData,basicAuthPassword:""},secureJsonFields:{...e.secureJsonFields,basicAuthPassword:!1}})}}function Se(e,t){var n,a,r;return{selfSignedCertificate:{enabled:Boolean(e.jsonData.tlsAuthWithCACert),certificateConfigured:!!(null==(n=e.secureJsonFields)?void 0:n.tlsCACert),onToggle:n=>t(n?{...e,jsonData:{...e.jsonData,tlsAuthWithCACert:n}}:{...e,jsonData:{...e.jsonData,tlsAuthWithCACert:n},secureJsonData:{...e.secureJsonData,tlsCACert:""},secureJsonFields:{...e.secureJsonFields,tlsCACert:!1}}),onCertificateChange:n=>t({...e,secureJsonData:{...e.secureJsonData,tlsCACert:n}}),onCertificateReset:()=>t({...e,secureJsonData:{...e.secureJsonData,tlsCACert:""},secureJsonFields:{...e.secureJsonFields,tlsCACert:!1}})},TLSClientAuth:{enabled:e.jsonData.tlsAuth,serverName:e.jsonData.serverName,clientCertificateConfigured:!!(null==(a=e.secureJsonFields)?void 0:a.tlsClientCert),clientKeyConfigured:!!(null==(r=e.secureJsonFields)?void 0:r.tlsClientKey),onToggle:n=>t(n?{...e,jsonData:{...e.jsonData,tlsAuth:n}}:{...e,jsonData:{...e.jsonData,tlsAuth:n,serverName:""},secureJsonData:{...e.secureJsonData,tlsClientCert:"",tlsClientKey:""},secureJsonFields:{...e.secureJsonFields,tlsClientCert:!1,tlsClientKey:!1}}),onServerNameChange:n=>t({...e,jsonData:{...e.jsonData,serverName:n}}),onClientCertificateChange:n=>t({...e,secureJsonData:{...e.secureJsonData,tlsClientCert:n}}),onClientCertificateReset:()=>t({...e,secureJsonData:{...e.secureJsonData,tlsClientCert:""},secureJsonFields:{...e.secureJsonFields,tlsClientCert:!1}}),onClientKeyChange:n=>t({...e,secureJsonData:{...e.secureJsonData,tlsClientKey:n}}),onClientKeyReset:()=>t({...e,secureJsonData:{...e.secureJsonData,tlsClientKey:""},secureJsonFields:{...e.secureJsonFields,tlsClientKey:!1}})},skipTLSVerification:{enabled:e.jsonData.tlsSkipVerify,onToggle:n=>t({...e,jsonData:{...e.jsonData,tlsSkipVerify:n}})}}}function Ne(e,t){return{headers:Object.keys(e.jsonData).filter((e=>e.startsWith(we))).sort().map((t=>{var n;const a=t.slice(14);return{name:e.jsonData[t],configured:null!=(n=e.secureJsonFields[`${De}${a}`])&&n}})),onChange:n=>{const a=Object.fromEntries(Object.entries(e.jsonData).filter((([e])=>!e.startsWith(we)))),r=Object.fromEntries(Object.entries(e.secureJsonData||{}).filter((([e])=>!e.startsWith(De)))),o=Object.fromEntries(Object.entries(e.secureJsonFields).filter((([e])=>!e.startsWith(De))));n.forEach(((e,t)=>{a[`${we}${t+1}`]=e.name,e.configured?o[`${De}${t+1}`]=!0:r[`${De}${t+1}`]=e.value})),t({...e,jsonData:a,secureJsonData:r,secureJsonFields:o})}}}const Ie=({config:e,onChange:t,className:n})=>{const a={container:(0,m.css)({maxWidth:578})};return g.createElement(V,{title:"Advanced HTTP settings",className:(0,m.cx)(a.container,n)},g.createElement(f.InlineField,{htmlFor:"advanced-http-cookies",label:"Allowed cookies",labelWidth:24,tooltip:"Grafana proxy deletes forwarded cookies by default. Specify cookies by name that should be forwarded to the data source.",disabled:e.readOnly,grow:!0},g.createElement(f.TagsInput,{id:"advanced-http-cookies",placeholder:"New cookie (hit enter to add)",tags:e.jsonData.keepCookies,onChange:n=>{t({...e,jsonData:{...e.jsonData,keepCookies:n}})}})),g.createElement(f.InlineField,{htmlFor:"advanced-http-timeout",label:"Timeout",labelWidth:24,tooltip:"HTTP request timeout in seconds",disabled:e.readOnly,grow:!0},g.createElement(f.Input,{id:"advanced-http-timeout",type:"number",min:0,placeholder:"Timeout in seconds","aria-label":"Timeout in seconds",value:e.jsonData.timeout,onChange:n=>{t({...e,jsonData:{...e.jsonData,timeout:parseInt(n.currentTarget.value,10)}})}})))};function Ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){Ee(e,t,n[t])}))}return e}const ke=e=>({container:(0,m.css)({marginBottom:e.spacing(2),maxWidth:"900px"})});var Ae=u(241),Re=function(){return Re=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Re.apply(this,arguments)};function qe(){var e=(0,g.useRef)(!1),t=(0,g.useCallback)((function(){return e.current}),[]);return(0,g.useEffect)((function(){return e.current=!0,function(){e.current=!1}}),[]),t}function Me(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={loading:!1});var a=(0,g.useRef)(0),r=qe(),o=(0,g.useState)(n),i=o[0],s=o[1],l=(0,g.useCallback)((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=++a.current;return i.loading||s((function(e){return Re(Re({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return r()&&o===a.current&&s({value:e,loading:!1}),e}),(function(e){return r()&&o===a.current&&s({error:e,loading:!1}),e}))}),t);return[i,l]}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Be=function(e){var t;t=function(){e()},(0,g.useEffect)(t,[])},Je={error:7e3,info:3e3,success:3e3,warning:5e3},Le=e=>{const t=(n=(0,f.useTheme2)(),(0,m.css)({position:"absolute",zIndex:n.zIndex.portal,top:0,right:10}));var n;const[a,r]=(0,g.useState)(!1),[o,i]=(0,g.useState)();return(0,g.useEffect)((()=>()=>{o&&clearTimeout(o)}),[o]),(0,g.useEffect)((()=>{if(""!==e.text){r(!0);const t=setTimeout((()=>{r(!1)}),Je[e.severity]);i(t)}}),[e.severity,e.text]),(0,h.jsx)(h.Fragment,{children:a&&(0,h.jsx)(f.Alert,{className:t,elevated:!0,onRemove:()=>r(!1),severity:e.severity,title:e.text})})};function We(e,t,n,a,r,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(a,r)}function Ge(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var o=e.apply(t,n);function i(e){We(o,a,r,i,s,"next",e)}function s(e){We(o,a,r,i,s,"throw",e)}i(void 0)}))}}function $e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){$e(e,t,n[t])}))}return e}function Ue(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Ve=e=>({tracesCascader:(0,m.css)({label:"tracesCascader",marginRight:e.spacing(1)})}),He=[{label:"No traces found",value:"no_traces",isLeaf:!0}],Qe={"[No traces in time range]":"__NO_TRACES__"};var ze=u(269),Ke=u(59);function Ze(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){Ze(e,t,n[t])}))}return e}function Xe(e){return e.sort(((e,t)=>e[0]-t[0])),e.reduce(((e,t)=>{if(!e.length)return[t];const n=e.slice(-1)[0],[a,r]=n,[o,i]=t;return i<r?e:o>r?[...e,t]:[...e.slice(0,-1),[a,i]]}),[]).reduce(((e,t)=>e+(t[1]-t[0])),0)}function et(e){const t={};let n;for(let a=0;n=e(a),n;a++){t[n.id]?t[n.id].span=n.span:t[n.id]={span:n.span,children:[]};for(const e of n.parentIds)e&&(t[e]?t[e].children.push(n.id):t[e]={span:void 0,children:[n.id]})}return t}function tt(e,t,n){return{main:`${nt(e)}ms (${nt(e/t*100)}%)`,secondary:`${nt(n)}ms (${nt(n/e*100)}%)`}}function nt(e){return parseFloat(e.toFixed(2))}function at(){return[new p.MutableDataFrame({fields:[{name:p.NodeGraphDataFrameFieldNames.id,type:p.FieldType.string},{name:p.NodeGraphDataFrameFieldNames.title,type:p.FieldType.string},{name:p.NodeGraphDataFrameFieldNames.subTitle,type:p.FieldType.string},{name:p.NodeGraphDataFrameFieldNames.mainStat,type:p.FieldType.string,config:{displayName:"Total time (% of trace)"}},{name:p.NodeGraphDataFrameFieldNames.secondaryStat,type:p.FieldType.string,config:{displayName:"Self time (% of total)"}},{name:p.NodeGraphDataFrameFieldNames.color,type:p.FieldType.number,config:{color:{mode:"continuous-GrYlRd"},displayName:"Self time / Trace duration"}}],meta:{preferredVisualisationType:"nodeGraph"}}),new p.MutableDataFrame({fields:[{name:p.NodeGraphDataFrameFieldNames.id,type:p.FieldType.string},{name:p.NodeGraphDataFrameFieldNames.target,type:p.FieldType.string},{name:p.NodeGraphDataFrameFieldNames.source,type:p.FieldType.string}],meta:{preferredVisualisationType:"nodeGraph"}})]}function rt(e){const t=e.map(ot),n=new p.MutableDataFrame({fields:[{name:"traceID",type:p.FieldType.string,values:[]},{name:"spanID",type:p.FieldType.string,values:[]},{name:"parentSpanID",type:p.FieldType.string,values:[]},{name:"operationName",type:p.FieldType.string,values:[]},{name:"serviceName",type:p.FieldType.string,values:[]},{name:"serviceTags",type:p.FieldType.other,values:[]},{name:"startTime",type:p.FieldType.number,values:[]},{name:"duration",type:p.FieldType.number,values:[]},{name:"logs",type:p.FieldType.other,values:[]},{name:"tags",type:p.FieldType.other,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"zipkin"}}});for(const e of t)n.add(e);return n}function ot(e){var t,n,a,r;const o={traceID:e.traceId,spanID:e.id,parentSpanID:e.parentId,operationName:e.name,serviceName:(null===(t=e.localEndpoint)||void 0===t?void 0:t.serviceName)||(null===(n=e.remoteEndpoint)||void 0===n?void 0:n.serviceName)||"unknown",serviceTags:st(e),startTime:e.timestamp/1e3,duration:e.duration/1e3,logs:null!==(r=null===(a=e.annotations)||void 0===a?void 0:a.map(it))&&void 0!==r?r:[],tags:Object.keys(e.tags||{}).reduce(((t,n)=>"error"===n?(t.push({key:"error",value:!0}),t.push({key:"errorValue",value:e.tags.error}),t):(t.push({key:n,value:e.tags[n]}),t)),[])};var i,s;return e.kind&&(o.tags=[{key:"kind",value:e.kind},...null!==(i=o.tags)&&void 0!==i?i:[]]),e.shared&&(o.tags=[{key:"shared",value:e.shared},...null!==(s=o.tags)&&void 0!==s?s:[]]),o}function it(e){return{timestamp:e.timestamp,fields:[{key:"annotation",value:e.value}]}}function st(e){const t=e.localEndpoint||e.remoteEndpoint;return t?[lt("ipv4",t.ipv4),lt("ipv6",t.ipv6),lt("port",t.port),lt("endpointType",e.localEndpoint?"local":"remote")].filter((e=>Boolean(e))):[]}function lt(e,t){if(t)return{key:e,value:t}}function ct(e,t,n,a,r,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(a,r)}function ut(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var o=e.apply(t,n);function i(e){ct(o,a,r,i,s,"next",e)}function s(e){ct(o,a,r,i,s,"throw",e)}i(void 0)}))}}function dt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){dt(e,t,n[t])}))}return e}function ht(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class mt extends j.DataSourceWithBackend{query(e){const t=e.targets[0];if("upload"===t.queryType){if(!this.uploadedJson)return(0,ze.of)({data:[]});try{var n;const e=JSON.parse(this.uploadedJson);return(0,ze.of)(function(e,t=!1){let n=(null==e?void 0:e.data)?[rt(null==e?void 0:e.data)]:[];return t&&n.push(...function(e){const{nodes:t,edges:n}=function(e){const t=[],n=[],a=function(e){let t=0,n=1/0;for(const a of e)a.timestamp<n&&(n=a.timestamp),a.timestamp+a.duration>t&&(t=a.timestamp+a.duration);return t-n}(e),r=et((t=>{if(!(t>=e.length))return{span:e[t],id:e[t].id,parentIds:e[t].parentId?[e[t].parentId]:[]}}));for(const s of e){var o,i;const e=Xe(r[s.id].children.map((e=>{const t=r[e].span;return[t.timestamp,t.timestamp+t.duration]}))),l=s.duration-e,c=tt(s.duration/1e3,a/1e3,l/1e3);t.push({[p.NodeGraphDataFrameFieldNames.id]:s.id,[p.NodeGraphDataFrameFieldNames.title]:(null===(o=s.localEndpoint)||void 0===o?void 0:o.serviceName)||(null===(i=s.remoteEndpoint)||void 0===i?void 0:i.serviceName)||"unknown",[p.NodeGraphDataFrameFieldNames.subTitle]:s.name,[p.NodeGraphDataFrameFieldNames.mainStat]:c.main,[p.NodeGraphDataFrameFieldNames.secondaryStat]:c.secondary,[p.NodeGraphDataFrameFieldNames.color]:l/a}),s.parentId&&r[s.parentId].span&&n.push({[p.NodeGraphDataFrameFieldNames.id]:s.parentId+"--"+s.id,[p.NodeGraphDataFrameFieldNames.target]:s.id,[p.NodeGraphDataFrameFieldNames.source]:s.parentId})}return{nodes:t,edges:n}}(e),[a,r]=at();for(const e of t)a.add(e);for(const e of n)r.add(e);return[a,r]}(null==e?void 0:e.data)),{data:n}}({data:e},null===(n=this.nodeGraph)||void 0===n?void 0:n.enabled))}catch(e){return(0,ze.of)({error:{message:"JSON is not valid Zipkin format"},data:[]})}}return t.query?super.query(e).pipe((0,Ke.map)((e=>{var t;return(null===(t=this.nodeGraph)||void 0===t?void 0:t.enabled)?function(e){if(!e.data||0===e.data.length)return e;const t=(0,p.toDataFrame)(e.data[0]),n=[...e.data];return n.push(...function(e){const{nodes:t,edges:n}=function(e){const t=[],n=[],a=new p.DataFrameView(e),r=function(e){let t=0,n=1/0;for(let a=0;a<e.length;a++){const r=e.get(a);r.startTime<n&&(n=r.startTime),r.startTime+r.duration>t&&(t=r.startTime+r.duration)}return t-n}(a),o=et((t=>{if(t>=e.length)return;const n=a.get(t);return{span:Ye({},n),id:n.spanID,parentIds:n.parentSpanID?[n.parentSpanID]:[]}}));for(let e=0;e<a.length;e++){const s=a.get(e),l=Xe(o[s.spanID].children.map((e=>{const t=o[e].span;return[t.startTime,t.startTime+t.duration]}))),c=s.duration-l,u=tt(s.duration,r,c);var i;t.push({[p.NodeGraphDataFrameFieldNames.id]:s.spanID,[p.NodeGraphDataFrameFieldNames.title]:null!==(i=s.serviceName)&&void 0!==i?i:"",[p.NodeGraphDataFrameFieldNames.subTitle]:s.operationName,[p.NodeGraphDataFrameFieldNames.mainStat]:u.main,[p.NodeGraphDataFrameFieldNames.secondaryStat]:u.secondary,[p.NodeGraphDataFrameFieldNames.color]:c/r}),s.parentSpanID&&o[s.parentSpanID].span&&n.push({[p.NodeGraphDataFrameFieldNames.id]:s.parentSpanID+"--"+s.spanID,[p.NodeGraphDataFrameFieldNames.target]:s.spanID,[p.NodeGraphDataFrameFieldNames.source]:s.parentSpanID})}return{nodes:t,edges:n}}(e),[a,r]=at();for(const e of t)a.add(e);for(const e of n)r.add(e);return[a,r]}(t)),ht(pt({},e),{data:n})}(e):e}))):(0,ze.of)(gt)}metadataRequest(e,t){var n=this;return ut((function*(){return yield n.getResource(e,t)}))()}testDatasource(){var e=this,t=()=>super.testDatasource;return ut((function*(){return yield t().call(e)}))()}getQueryDisplayText(e){return e.query}interpolateVariablesInQueries(e,t){return e&&0!==e.length?e.map((e=>pt(ht(pt({},e),{datasource:this.getRef()}),this.applyTemplateVariables(e,t)))):[]}applyTemplateVariables(e,t){const n=pt({},e);var a;return ht(pt({},n),{query:this.templateSrv.replace(null!==(a=e.query)&&void 0!==a?a:"",t)})}constructor(e,t=(0,j.getTemplateSrv)()){super(e),dt(this,"templateSrv",void 0),dt(this,"uploadedJson",void 0),dt(this,"nodeGraph",void 0),dt(this,"spanBar",void 0),this.templateSrv=t,this.uploadedJson=null,this.nodeGraph=e.jsonData.nodeGraph}}const gt={data:[(0,p.createDataFrame)({fields:[{name:"trace",type:p.FieldType.trace,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"zipkin"}}})]},ft=new p.DataSourcePlugin(mt).setQueryEditor((({query:e,onChange:t,onRunQuery:n,datasource:a})=>{const[r,o]=(0,g.useState)(!1),[i,s]=(0,g.useState)(""),l=function(e,t){const[n,a]=Me(Ge((function*(){try{const t=yield e.metadataRequest("services");return t?t.sort().map((e=>({label:e,value:e,isLeaf:!1}))):[]}catch(e){const n=`Failed to load spans from Zipkin: ${(e instanceof Error?e:"An unknown error occurred").toString()}`;throw t(n),e}})),[e]);return Be((()=>{a()})),n}(a,s),c=(0,f.useTheme2)(),u=(0,f.useStyles2)(Ve),{onLoadOptions:d,allOptions:p}=function(e,t){const n=qe(),[a,r]=(0,g.useState)({}),[,o]=Me(function(){var a=Ge((function*(a){try{const t=yield e.metadataRequest("spans",{serviceName:a});n()&&r((e=>{const n=(0,Ae.fromPairs)(t.map((e=>[e,void 0])));return Ue(_e({},e),{[a]:n})}))}catch(e){const n=`Failed to load spans from Zipkin: ${(e instanceof Error?e:"An unknown error occurred").toString()}`;throw t(n),e}}));return function(e){return a.apply(this,arguments)}}(),[e,a]),[,i]=Me(function(){var a=Ge((function*(a,o){const i={serviceName:a,spanName:o};try{const t=yield e.metadataRequest("traces",i);if(n()){const e=t.length?(0,Ae.fromPairs)(t.map((e=>{const t=e.find((e=>!e.parentId));return[`${t.name} [${Math.floor(t.duration/1e3)} ms]`,t.traceId]}))):Qe;r((t=>{const n=t[a];return Ue(_e({},t),{[a]:Ue(_e({},n),{[o]:e})})}))}}catch(e){const n=`Failed to load spans from Zipkin: ${(e instanceof Error?e:"An unknown error occurred").toString()}`;throw t(n),e}}));return function(e,t){return a.apply(this,arguments)}}(),[e]);return{onLoadOptions:(0,g.useCallback)((e=>{const t=e[0].value;if(1===e.length)o(t);else if(2===e.length){const n=e[1].value;i(t,n)}}),[o,i]),allOptions:a}}(a,s),y=(0,g.useCallback)(((a,r)=>{if(3===r.length){const a=r[2].value;t(Ue(_e({},e),{query:a})),n()}}),[t,n,e]);(0,g.useEffect)((()=>{e.queryType||t(Ue(_e({},e),{queryType:"traceID"}))}),[e,t]);let b=function(e,t){return(0,g.useMemo)((()=>{let n=[];return e.value&&e.value.length?n=e.value.map((e=>Ue(_e({},e),{children:t[e.value]&&Object.keys(t[e.value]).map((n=>({label:n,value:n,isLeaf:!1,children:t[e.value][n]&&Object.keys(t[e.value][n]).map((a=>({label:a,value:t[e.value][n][a]})))})))}))):e.value&&!e.value.length&&(n=He),n}),[e,t])}(l,p);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(f.Modal,{title:"Upload trace",isOpen:r,onDismiss:()=>o(!1),children:(0,h.jsx)("div",{className:(0,m.css)({padding:c.spacing(2)}),children:(0,h.jsx)(f.FileDropzone,{options:{multiple:!1},onLoad:r=>{a.uploadedJson=r,t(Ue(_e({},e),{queryType:"upload"})),o(!1),n()}})})}),(0,h.jsx)(f.InlineFieldRow,{children:(0,h.jsx)(f.InlineField,{label:"Query type",grow:!0,children:(0,h.jsxs)(f.HorizontalGroup,{spacing:"sm",align:"center",justify:"space-between",children:[(0,h.jsx)(f.RadioButtonGroup,{options:[{value:"traceID",label:"TraceID"}],value:e.queryType||"traceID",onChange:n=>t(Ue(_e({},e),{queryType:n})),size:"md"}),(0,h.jsx)(f.Button,{variant:"secondary",size:"sm",onClick:()=>{o(!0)},children:"Import trace"})]})})}),"traceID"===e.queryType&&(0,h.jsxs)(f.InlineFieldRow,{children:[(0,h.jsx)(f.ButtonCascader,{options:b,onChange:y,loadData:d,variant:"secondary",buttonProps:{className:u.tracesCascader},children:"Traces"}),(0,h.jsx)("div",{className:"gf-form gf-form--grow flex-shrink-1 min-width-15",children:(0,h.jsx)(f.QueryField,{query:e.query,onChange:n=>{const a=Ue(_e({},e),{query:n});t(a)},onRunQuery:n,placeholder:"Insert Trace ID (run with Shift+Enter)",portalOrigin:"zipkin"})})]}),i&&(0,h.jsx)(Le,{text:i,severity:"error"})]})})).setConfigEditor((({options:e,onOptionsChange:t})=>{const n=(0,f.useStyles2)(ke);return(0,h.jsxs)("div",{className:n.container,children:[(0,h.jsx)(ie,{dataSourceName:"Zipkin",docsLink:"https://grafana.com/docs/grafana/latest/datasources/zipkin",hasRequiredFields:!1}),(0,h.jsx)(f.Divider,{spacing:4}),(0,h.jsx)(se,{config:e,onChange:t,urlPlaceholder:"http://localhost:9411"}),(0,h.jsx)(f.Divider,{spacing:4}),(0,h.jsx)(je,Pe({},Te({config:e,onChange:t}))),(0,h.jsx)(f.Divider,{spacing:4}),(0,h.jsx)(J,{options:e,onOptionsChange:t}),(0,h.jsx)(f.Divider,{spacing:4}),(0,h.jsx)(_,{options:e,onOptionsChange:t}),(0,h.jsx)(f.Divider,{spacing:4}),(0,h.jsx)(b,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!1,children:(0,h.jsxs)(f.Stack,{gap:5,direction:"column",children:[(0,h.jsx)(Ie,{config:e,onChange:t}),j.config.secureSocksDSProxyEnabled&&(0,h.jsx)(f.SecureSocksProxySettings,{options:e,onOptionsChange:t}),(0,h.jsx)(z,{options:e,onOptionsChange:t}),(0,h.jsx)(re,{options:e,onOptionsChange:t})]})})]})}));return d})()));
//# sourceMappingURL=module.js.map